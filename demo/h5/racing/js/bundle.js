var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();!function s(a,o,h){function l(e,t){if(!o[e]){if(!a[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(u)return u(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var r=o[e]={exports:{}};a[e][0].call(r.exports,function(t){return l(a[e][1][t]||t)},r,r.exports,s,a,o,h)}return o[e].exports}for(var u="function"==typeof require&&require,t=0;t<h.length;t++)l(h[t]);return l}({1:[function(t,e,i){var l,u,n=window.Laya=(l=window,document,u={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function(t,e){return 1==arguments.length?u.__presubstr.call(this,t):u.__presubstr.call(this,t,0<e?e:this.length+e)},__init:function(t){t.forEach(function(t){t.__init$&&t.__init$()})},__isClass:function(t){return t&&(t.__isclass||t==Object||t==String||t==Array)},__newvec:function(t,e){var i=[];i.length=t;for(var n=0;n<t;n++)i[n]=e;return i},__extend:function(t,e){for(var i in e)if(e.hasOwnProperty(i)){var n=Object.getOwnPropertyDescriptor(e,i),r=n.get,s=n.set;r||s?r&&s?Object.defineProperty(t,i,n):(r&&Object.defineProperty(t,i,r),s&&Object.defineProperty(t,i,s)):t[i]=e[i]}function a(){u.un(this,"constructor",t)}a.prototype=e.prototype,t.prototype=new a,u.un(t.prototype,"__imps",u.__copy({},e.prototype.__imps))},__copy:function(t,e){if(!e)return null;for(var i in t=t||{},e)t[i]=e[i];return t},__package:function(t,e){if(!u.__packages[t]){u.__packages[t]=!0;var i=l,n=t.split(".");if(1<n.length)for(var r=0,s=n.length-1;r<s;r++){var a=i[n[r]];i=a||(i[n[r]]={})}i[n[n.length-1]]||(i[n[n.length-1]]=e||{})}},__hasOwnProperty:function(t,e){return e=e||this,Object.hasOwnProperty.call(e,t)||function t(e,i){if(Object.hasOwnProperty.call(i.prototype,e))return!0;var n=i.prototype.__super;return null==n?null:t(e,n)}(t,e.__class)},__typeof:function(t,e){if(!t||!e)return!1;if(e===String)return"string"==typeof t;if(e===Number)return"number"==typeof t;if(e.__interface__)e=e.__interface__;else if("string"!=typeof e)return t instanceof e;return t.__imps&&t.__imps[e]||t.__class==e},__as:function(t,e){return this.__typeof(t,e)?t:null},__int:function(t){return t?parseInt(t):0},interface:function(t,e){u.__package(t,{});var i=u.__internals,n=i[t]=i[t]||{self:t};if(e){var r=e.split(",");n.extend=[];for(var s=0;s<r.length;s++){var a=r[s];i[a]=i[a]||{self:a},n.extend.push(i[a])}}var o=l,h=t.split(".");for(s=0;s<h.length-1;s++)o=o[h[s]];o[h[h.length-1]]={__interface__:t}},class:function(t,e,i,n){if(i&&u.__extend(t,i),e)if(u.__package(e,t),u.__classmap[e]=t,0<e.indexOf(".")){if(0==e.indexOf("laya.")){var r=e.split(".");n=n||r[r.length-1],u[n]&&console.log("Warning!,this class["+n+"] already exist:",u[n]),u[n]=t}}else"Main"==e?l.Main=t:(u[e]&&console.log("Error!,this class["+e+"] already exist:",u[e]),u[e]=t);var s=u.un,a=t.prototype;s(a,"hasOwnProperty",u.__hasOwnProperty),s(a,"__class",t),s(a,"__super",i),s(a,"__className",e),s(t,"__super",i),s(t,"__className",e),s(t,"__isclass",!0),s(t,"super",function(t){this.__super.call(t)})},imps:function(t,e){if(!e)return null;var r=t.__imps||u.un(t,"__imps",{});function s(t){var e,i;if((e=u.__internals[t])&&(r[t]=!0,i=e.extend))for(var n=0;n<i.length;n++)s(i[n].self)}for(var i in e)s(i)},superSet:function(t,e,i,n){var r=t.prototype["_$set_"+i];r&&r.call(e,n)},superGet:function(t,e,i){var n=t.prototype["_$get_"+i];return n?n.call(e):null},getset:function(t,e,i,n,r){t?(n&&(e["_$GET_"+i]=n),r&&(e["_$SET_"+i]=r)):(n&&u.un(e,"_$get_"+i,n),r&&u.un(e,"_$set_"+i,r)),n&&r?Object.defineProperty(e,i,{get:n,set:r,enumerable:!1,configurable:!0}):(n&&Object.defineProperty(e,i,{get:n,enumerable:!1,configurable:!0}),r&&Object.defineProperty(e,i,{set:r,enumerable:!1,configurable:!0}))},static:function(i,n){for(var r=0,t=n.length;r<t;r+=2)if("length"==n[r])i.length=n[r+1].call(i);else{function e(){var e=n[r],t=n[r+1];Object.defineProperty(i,e,{get:function(){return delete this[e],this[e]=t.call(this)},set:function(t){delete this[e],this[e]=t},enumerable:!0,configurable:!0})}e()}},un:function(t,e,i){return i||(i=t[e]),u.__propun.value=i,Object.defineProperty(t,e,u.__propun),i},uns:function(e,t){t.forEach(function(t){u.un(e,t)})}},l.console=l.console||{log:function(){}},l.trace=l.console.log,Error.prototype.throwError=function(){throw arguments},Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),u);!function(m,s,T){T.un,T.uns;var E=T.static,I=T.class,g=T.getset,P=T.__newvec;T.interface("laya.ui.ISelect"),T.interface("laya.d3.core.IClone"),T.interface("laya.filters.IFilter"),T.interface("laya.resource.IDispose"),T.interface("laya.webgl.submit.ISubmit"),T.interface("laya.resource.ICreateResource"),T.interface("laya.webgl.canvas.save.ISaveData"),T.interface("laya.d3.core.scene.IOctreeObject"),T.interface("laya.resource.ISingletonElement");g(1,T,"alertGlobalError",null,function(t){var s=0;Vt.window.onerror=t?function(t,e,i,n,r){s++<5&&r&&alert("出错啦，请把此信息截图给研发商\n"+t+"\n"+r.stack)}:null}),T.init=function(t,e,i){for(var n=[],r=2,s=arguments.length;r<s;r++)n.push(arguments[r]);if(!T._isinit){T._isinit=!0,ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=T._arrayBufferSlice),Vt.__init__(),T.systemTimer=new Ni(!1),T.startTimer=new Ni(!1),T.physicsTimer=new Ni(!1),T.updateTimer=new Ni(!1),T.lateTimer=new Ni(!1),T.timer=new Ni(!1),T.loader=new Jn,mn.__init__(),en.inner_enable(),r=0;for(var a=n.length;r<a;r++)n[r]&&n[r].enable&&n[r].enable();return qi.isConchApp&&Ki.enableNative(),Se.beginCheck(),T._currentStage=T.stage=new Ps,gn.rootPath=gn._basePath=T._getUrlPath(),T.render=new qi(0,0),T.stage.size(t,e),m.stage=T.stage,Sn.__init__(),De.__init__(),wi.instance.__init__(T.stage,qi.canvas),Ta.__init__(),Li.autoStopMusic=!0,qi.canvas}},T._getUrlPath=function(){var t=Vt.window.location,e=t.pathname;return e=":"==e.charAt(2)?e.substring(1):e,gn.getPath("file:"==t.protocol?e:t.protocol+"//"+t.host+t.pathname)},T._arrayBufferSlice=function(t,e){var i=new Uint8Array(this,t,e-t),n=new Uint8Array(i.length);return n.set(i),n.buffer},T._runScript=function(t){return Vt.window[T._evcode](t)},T.enableDebugPanel=function(t){if(void 0===t&&(t="libs/laya.debugtool.js"),T.DebugPanel)T.DebugPanel.enable();else{var e=Vt.createElement("script");e.onload=function(){T.DebugPanel.enable()},e.src=t,Vt.document.body.appendChild(e)}},T.stage=null,T.systemTimer=null,T.startTimer=null,T.physicsTimer=null,T.updateTimer=null,T.lateTimer=null,T.timer=null,T.loader=null,T.version="2.1.0beta",T.render=null,T._currentStage=null,T._isinit=!1,T.isWXOpenDataContext=!1,T.isWXPosMsg=!1,E(T,["_evcode",function(){return this._evcode="eval"}]);var f=function(){function h(t){if(this.arrColor=[],null==t)return this.strColor="#00000000",this.numColor=0,void(this.arrColor=[0,0,0,0]);var e=0,i=0,n=0;if("string"==typeof t)if(0<=t.indexOf("rgba(")||0<=t.indexOf("rgb(")){var r,s,a=t;for(r=a.indexOf("("),s=a.indexOf(")"),a=a.substring(r+1,s),this.arrColor=a.split(","),i=this.arrColor.length,e=0;e<i;e++)this.arrColor[e]=parseFloat(this.arrColor[e]),e<3&&(this.arrColor[e]=Math.round(this.arrColor[e]));n=4==this.arrColor.length?256*(256*(256*this.arrColor[0]+this.arrColor[1])+this.arrColor[2])+Math.round(255*this.arrColor[3]):256*(256*this.arrColor[0]+this.arrColor[1])+this.arrColor[2],this.strColor=t}else{if("#"===(this.strColor=t).charAt(0)&&(t=t.substr(1)),3===(i=t.length)||4===i){var o="";for(e=0;e<i;e++)o+=t[e]+t[e];t=o}n=parseInt(t,16)}else n=t,this.strColor=nt.toHexColor(n);0<=this.strColor.indexOf("rgba")||9===this.strColor.length?(this.arrColor=[((4278190080&n)>>>24)/255,((16711680&n)>>16)/255,((65280&n)>>8)/255,(255&n)/255],this.numColor=(4278190080&n)>>>24|(16711680&n)>>8|(65280&n)<<8|(255&n)<<24):(this.arrColor=[((16711680&n)>>16)/255,((65280&n)>>8)/255,(255&n)/255,1],this.numColor=4278190080|(16711680&n)>>16|65280&n|(255&n)<<16),this.arrColor.__id=++h._COLODID}return I(h,"laya.utils.ColorUtils"),h._initDefault=function(){for(var t in h._DEFAULT={},h._COLOR_MAP)h._SAVE[t]=h._DEFAULT[t]=new h(h._COLOR_MAP[t]);return h._DEFAULT},h._initSaveMap=function(){for(var t in h._SAVE_SIZE=0,h._SAVE={},h._DEFAULT)h._SAVE[t]=h._DEFAULT[t]},h.create=function(t){var e=t+"",i=h._SAVE[e];return null!=i?i:(h._SAVE_SIZE<1e3&&h._initSaveMap(),h._SAVE[e]=new h(t))},h._SAVE={},h._SAVE_SIZE=0,h._COLOR_MAP={purple:"#800080",orange:"#ffa500",white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#808080"},h._DEFAULT=h._initDefault(),h._COLODID=1,h}(),n=function(){function g(){}return I(g,"laya.renders.LayaGLQuickRunner"),g.__init__=function(){g.map[515]=g.alpha_transform_drawLayaGL,g.map[513]=g.alpha_drawLayaGL,g.map[514]=g.transform_drawLayaGL,g.map[8194]=g.transform_drawNodes,g.map[259]=g.alpha_transform_drawTexture,g.map[257]=g.alpha_drawTexture,g.map[258]=g.transform_drawTexture,g.map[8704]=g.drawLayaGL_drawNodes},g.transform_drawTexture=function(t,e,i,n){t._style;var r=t.texture;e.saveTransform(g.curMat),e.transformByMatrix(t.transform,i,n),e.drawTexture(r,-t.pivotX,-t.pivotY,t._width||r.width,t._height||r.height),e.restoreTransform(g.curMat)},g.alpha_drawTexture=function(t,e,i,n){var r,s=t._style,a=t.texture;if(.01<(r=s.alpha)||t._needRepaint()){var o=e.globalAlpha;e.globalAlpha*=r,e.drawTexture(a,i-s.pivotX+a.offsetX,n-s.pivotY+a.offsetY,t._width||a.width,t._height||a.height),e.globalAlpha=o}},g.alpha_transform_drawTexture=function(t,e,i,n){var r,s=t._style,a=t.texture;if(.01<(r=s.alpha)||t._needRepaint()){var o=e.globalAlpha;e.globalAlpha*=r,e.saveTransform(g.curMat),e.transformByMatrix(t.transform,i,n),e.drawTexture(a,-s.pivotX+a.offsetX,-s.pivotY+a.offsetY,t._width||a.width,t._height||a.height),e.restoreTransform(g.curMat),e.globalAlpha=o}},g.alpha_transform_drawLayaGL=function(t,e,i,n){var r,s=t._style;if(.01<(r=s.alpha)||t._needRepaint()){var a=e.globalAlpha;e.globalAlpha*=r,e.saveTransform(g.curMat),e.transformByMatrix(t.transform,i,n),t._graphics&&t._graphics._render(t,e,-s.pivotX,-s.pivotY),e.restoreTransform(g.curMat),e.globalAlpha=a}},g.alpha_drawLayaGL=function(t,e,i,n){var r,s=t._style;if(.01<(r=s.alpha)||t._needRepaint()){var a=e.globalAlpha;e.globalAlpha*=r,t._graphics&&t._graphics._render(t,e,i-s.pivotX,n-s.pivotY),e.globalAlpha=a}},g.transform_drawLayaGL=function(t,e,i,n){var r=t._style;e.saveTransform(g.curMat),e.transformByMatrix(t.transform,i,n),t._graphics&&t._graphics._render(t,e,-r.pivotX,-r.pivotY),e.restoreTransform(g.curMat)},g.transform_drawNodes=function(t,e,i,n){var r=t._getBit(256)&&e.drawCallOptimize(!0),s=t._style;e.saveTransform(g.curMat),e.transformByMatrix(t.transform,i,n),i=-s.pivotX,n=-s.pivotY;var a,o=t._children,h=o.length;if(s.viewport){var l=s.viewport,u=l.x,c=l.y,_=l.right,d=l.bottom,f=NaN,p=NaN;for(m=0;m<h;++m)(a=o[m])._visible&&(f=a._x)<_&&f+a.width>u&&(p=a._y)<d&&p+a.height>c&&a.render(e,i,n)}else for(var m=0;m<h;++m)(a=o[m])._visible&&a.render(e,i,n);e.restoreTransform(g.curMat),r&&e.drawCallOptimize(!1)},g.drawLayaGL_drawNodes=function(t,e,i,n){var r=t._getBit(256)&&e.drawCallOptimize(!0),s=t._style;i-=s.pivotX,n-=s.pivotY,t._graphics&&t._graphics._render(t,e,i,n);var a,o=t._children,h=o.length;if(s.viewport){var l=s.viewport,u=l.x,c=l.y,_=l.right,d=l.bottom,f=NaN,p=NaN;for(m=0;m<h;++m)(a=o[m])._visible&&(f=a._x)<_&&f+a.width>u&&(p=a._y)<d&&p+a.height>c&&a.render(e,i,n)}else for(var m=0;m<h;++m)(a=o[m])._visible&&a.render(e,i,n);r&&e.drawCallOptimize(!1)},g.map={},E(g,["curMat",function(){return this.curMat=new It}]),g}(),F=function(){function s(t,e,i,n,r){var s;void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),(s=r||new Float32Array(4))[0]=t,s[1]=e,s[2]=i,s[3]=n,this.elements=s}I(s,"laya.d3.math.Native.ConchQuaternion");var t=s.prototype;return T.imps(t,{"laya.d3.core.IClone":!0}),t.scaling=function(t,e){var i=e.elements,n=this.elements;i[0]=n[0]*t,i[1]=n[1]*t,i[2]=n[2]*t,i[3]=n[3]*t},t.normalize=function(t){s._normalizeArray(this.elements,t.elements)},t.length=function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3];return Math.sqrt(e*e+i*i+n*n+r*r)},t.rotateX=function(t,e){var i=e.elements,n=this.elements;t*=.5;var r=n[0],s=n[1],a=n[2],o=n[3],h=Math.sin(t),l=Math.cos(t);i[0]=r*l+o*h,i[1]=s*l+a*h,i[2]=a*l-s*h,i[3]=o*l-r*h},t.rotateY=function(t,e){var i=e.elements,n=this.elements;t*=.5;var r=n[0],s=n[1],a=n[2],o=n[3],h=Math.sin(t),l=Math.cos(t);i[0]=r*l-a*h,i[1]=s*l+o*h,i[2]=a*l+r*h,i[3]=o*l-s*h},t.rotateZ=function(t,e){var i=e.elements,n=this.elements;t*=.5;var r=n[0],s=n[1],a=n[2],o=n[3],h=Math.sin(t),l=Math.cos(t);i[0]=r*l+s*h,i[1]=s*l-r*h,i[2]=a*l+o*h,i[3]=o*l-a*h},t.getYawPitchRoll=function(t){B.transformQuat(B.ForwardRH,this,s.TEMPVector31),B.transformQuat(B.Up,this,s.TEMPVector32);var e=s.TEMPVector32.elements;s.angleTo(B.ZERO,s.TEMPVector31,s.TEMPVector33);var i=s.TEMPVector33.elements;i[0]==Math.PI/2?(i[1]=s.arcTanAngle(e[2],e[0]),i[2]=0):i[0]==-Math.PI/2?(i[1]=s.arcTanAngle(-e[2],-e[0]),i[2]=0):(gt.createRotationY(-i[1],s.TEMPMatrix0),gt.createRotationX(-i[0],s.TEMPMatrix1),B.transformCoordinate(s.TEMPVector32,s.TEMPMatrix0,s.TEMPVector32),B.transformCoordinate(s.TEMPVector32,s.TEMPMatrix1,s.TEMPVector32),i[2]=s.arcTanAngle(e[1],-e[0])),i[1]<=-Math.PI&&(i[1]=Math.PI),i[2]<=-Math.PI&&(i[2]=Math.PI),i[1]>=Math.PI&&i[2]>=Math.PI&&(i[1]=0,i[2]=0,i[0]=Math.PI-i[0]);var n=t.elements;n[0]=i[1],n[1]=i[0],n[2]=i[2]},t.invert=function(t){var e=t.elements,i=this.elements,n=i[0],r=i[1],s=i[2],a=i[3],o=n*n+r*r+s*s+a*a,h=o?1/o:0;e[0]=-n*h,e[1]=-r*h,e[2]=-s*h,e[3]=a*h},t.identity=function(){var t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=1},t.fromArray=function(t,e){void 0===e&&(e=0),this.elements[0]=t[e+0],this.elements[1]=t[e+1],this.elements[2]=t[e+2],this.elements[3]=t[e+3]},t.cloneTo=function(t){var e,i,n;if((i=this.elements)!==(n=t.elements))for(e=0;e<4;++e)n[e]=i[e]},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t.equals=function(t){var e=this.elements,i=t.elements;return k.nearEqual(e[0],i[0])&&k.nearEqual(e[1],i[1])&&k.nearEqual(e[2],i[2])&&k.nearEqual(e[3],i[3])},t.lengthSquared=function(){var t=this.elements[0],e=this.elements[1],i=this.elements[2],n=this.elements[3];return t*t+e*e+i*i+n*n},g(0,t,"w",function(){return this.elements[3]},function(t){this.elements[3]=t}),g(0,t,"z",function(){return this.elements[2]},function(t){this.elements[2]=t}),g(0,t,"y",function(){return this.elements[1]},function(t){this.elements[1]=t}),g(0,t,"x",function(){return this.elements[0]},function(t){this.elements[0]=t}),s._dotArray=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},s._normalizeArray=function(t,e){var i=t[0],n=t[1],r=t[2],s=t[3],a=i*i+n*n+r*r+s*s;0<a&&(a=1/Math.sqrt(a),e[0]=i*a,e[1]=n*a,e[2]=r*a,e[3]=s*a)},s._lerpArray=function(t,e,i,n){var r=1-i;0<=s._dotArray(t,e)?(n[0]=r*t[0]+i*e[0],n[1]=r*t[1]+i*e[1],n[2]=r*t[2]+i*e[2],n[3]=r*t[3]+i*e[3]):(n[0]=r*t[0]-i*e[0],n[1]=r*t[1]-i*e[1],n[2]=r*t[2]-i*e[2],n[3]=r*t[3]-i*e[3]),s._normalizeArray(n,n)},s.createFromYawPitchRoll=function(t,e,i,n){var r=.5*i,s=.5*e,a=.5*t,o=Math.sin(r),h=Math.cos(r),l=Math.sin(s),u=Math.cos(s),c=Math.sin(a),_=Math.cos(a),d=n.elements;d[0]=_*l*h+c*u*o,d[1]=c*u*h-_*l*o,d[2]=_*u*o-c*l*h,d[3]=_*u*h+c*l*o},s.multiply=function(t,e,i){var n=t.elements,r=e.elements,s=i.elements,a=n[0],o=n[1],h=n[2],l=n[3],u=r[0],c=r[1],_=r[2],d=r[3],f=o*_-h*c,p=h*u-a*_,m=a*c-o*u,g=a*u+o*c+h*_;s[0]=a*d+u*l+f,s[1]=o*d+c*l+p,s[2]=h*d+_*l+m,s[3]=l*d-g},s.arcTanAngle=function(t,e){return 0==t?1==e?Math.PI/2:-Math.PI/2:0<t?Math.atan(e/t):t<0?0<e?Math.atan(e/t)+Math.PI:Math.atan(e/t)-Math.PI:0},s.angleTo=function(t,e,i){B.subtract(e,t,s.TEMPVector30),B.normalize(s.TEMPVector30,s.TEMPVector30),i.elements[0]=Math.asin(s.TEMPVector30.y),i.elements[1]=s.arcTanAngle(-s.TEMPVector30.z,-s.TEMPVector30.x)},s.createFromAxisAngle=function(t,e,i){var n=i.elements,r=t.elements;e*=.5;var s=Math.sin(e);n[0]=s*r[0],n[1]=s*r[1],n[2]=s*r[2],n[3]=Math.cos(e)},s.createFromMatrix3x3=function(t,e){var i,n=e.elements,r=t.elements,s=r[0]+r[4]+r[8];if(0<s)i=Math.sqrt(s+1),n[3]=.5*i,i=.5/i,n[0]=(r[5]-r[7])*i,n[1]=(r[6]-r[2])*i,n[2]=(r[1]-r[3])*i;else{var a=0;r[4]>r[0]&&(a=1),r[8]>r[3*a+a]&&(a=2);var o=(a+1)%3,h=(a+2)%3;i=Math.sqrt(r[3*a+a]-r[3*o+o]-r[3*h+h]+1),n[a]=.5*i,i=.5/i,n[3]=(r[3*o+h]-r[3*h+o])*i,n[o]=(r[3*o+a]+r[3*a+o])*i,n[h]=(r[3*h+a]+r[3*a+h])*i}},s.createFromMatrix4x4=function(t,e){var i,n,r=t.elements,s=e.elements,a=r[0]+r[5]+r[10];0<a?(i=Math.sqrt(a+1),s[3]=.5*i,i=.5/i,s[0]=(r[6]-r[9])*i,s[1]=(r[8]-r[2])*i,s[2]=(r[1]-r[4])*i):r[0]>=r[5]&&r[0]>=r[10]?(n=.5/(i=Math.sqrt(1+r[0]-r[5]-r[10])),s[0]=.5*i,s[1]=(r[1]+r[4])*n,s[2]=(r[2]+r[8])*n,s[3]=(r[6]-r[9])*n):r[5]>r[10]?(n=.5/(i=Math.sqrt(1+r[5]-r[0]-r[10])),s[0]=(r[4]+r[1])*n,s[1]=.5*i,s[2]=(r[9]+r[6])*n,s[3]=(r[8]-r[2])*n):(n=.5/(i=Math.sqrt(1+r[10]-r[0]-r[5])),s[0]=(r[8]+r[2])*n,s[1]=(r[9]+r[6])*n,s[2]=.5*i,s[3]=(r[1]-r[4])*n)},s.slerp=function(t,e,i,n){var r,s,a,o,h,l=t.elements,u=e.elements,c=n.elements,_=l[0],d=l[1],f=l[2],p=l[3],m=u[0],g=u[1],v=u[2],T=u[3];return(s=_*m+d*g+f*v+p*T)<0&&(s=-s,m=-m,g=-g,v=-v,T=-T),h=1e-6<1-s?(r=Math.acos(s),a=Math.sin(r),o=Math.sin((1-i)*r)/a,Math.sin(i*r)/a):(o=1-i,i),c[0]=o*_+h*m,c[1]=o*d+h*g,c[2]=o*f+h*v,c[3]=o*p+h*T,c},s.lerp=function(t,e,i,n){s._lerpArray(t.elements,e.elements,i,n.elements)},s.add=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements;n[0]=r[0]+s[0],n[1]=r[1]+s[1],n[2]=r[2]+s[2],n[3]=r[3]+s[3]},s.dot=function(t,e){return s._dotArray(t.elements,e.elements)},s.rotationLookAt=function(t,e,i){s.lookAt(B.ZERO,t,e,i)},s.lookAt=function(t,e,i,n){ht.lookAt(t,e,i,s._tempMatrix3x3),s.rotationMatrix(s._tempMatrix3x3,n)},s.invert=function(t,e){var i=t.elements,n=e.elements,r=t.lengthSquared();k.isZero(r)||(r=1/r,n[0]=-i[0]*r,n[1]=-i[1]*r,n[2]=-i[2]*r,n[3]=i[3]*r)},s.rotationMatrix=function(t,e){var i=t.elements,n=i[0],r=i[1],s=i[2],a=i[3],o=i[4],h=i[5],l=i[6],u=i[7],c=i[8],_=e.elements,d=NaN,f=NaN,p=n+o+c;0<p?(d=Math.sqrt(p+1),_[3]=.5*d,d=.5/d,_[0]=(h-u)*d,_[1]=(l-s)*d,_[2]=(r-a)*d):_[3]=o<=n&&c<=n?(f=.5/(d=Math.sqrt(1+n-o-c)),_[0]=.5*d,_[1]=(r+a)*f,_[2]=(s+l)*f,(h-u)*f):c<o?(f=.5/(d=Math.sqrt(1+o-n-c)),_[0]=(a+r)*f,_[1]=.5*d,_[2]=(u+h)*f,(l-s)*f):(f=.5/(d=Math.sqrt(1+c-n-o)),_[0]=(l+s)*f,_[1]=(u+h)*f,_[2]=.5*d,(r-a)*f)},s.DEFAULT=new s,E(s,["TEMPVector30",function(){return this.TEMPVector30=new B},"TEMPVector31",function(){return this.TEMPVector31=new B},"TEMPVector32",function(){return this.TEMPVector32=new B},"TEMPVector33",function(){return this.TEMPVector33=new B},"TEMPMatrix0",function(){return this.TEMPMatrix0=new gt},"TEMPMatrix1",function(){return this.TEMPMatrix1=new gt},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new ht},"NAN",function(){return this.NAN=new s(NaN,NaN,NaN,NaN)}]),s}(),e=function(){function t(t,e,i,n){this.elements=null,void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0);var r=this.elements=new Float32Array(4);r[0]=t,r[1]=e,r[2]=i,r[3]=n}I(t,"laya.d3.math.Native.ConchVector4");var e=t.prototype;return T.imps(e,{"laya.d3.core.IClone":!0}),e.fromArray=function(t,e){void 0===e&&(e=0),this.elements[0]=t[e+0],this.elements[1]=t[e+1],this.elements[2]=t[e+2],this.elements[3]=t[e+3]},e.cloneTo=function(t){var e=t.elements,i=this.elements;e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},e.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},g(0,e,"w",function(){return this.elements[3]},function(t){this.elements[3]=t}),g(0,e,"z",function(){return this.elements[2]},function(t){this.elements[2]=t}),g(0,e,"y",function(){return this.elements[1]},function(t){this.elements[1]=t}),g(0,e,"x",function(){return this.elements[0]},function(t){this.elements[0]=t}),t.lerp=function(t,e,i,n){var r=n.elements,s=t.elements,a=e.elements,o=s[0],h=s[1],l=s[2],u=s[3];r[0]=o+i*(a[0]-o),r[1]=h+i*(a[1]-h),r[2]=l+i*(a[2]-l),r[3]=u+i*(a[3]-u)},t.transformByM4x4=function(t,e,i){var n=t.elements,r=n[0],s=n[1],a=n[2],o=n[3],h=e.elements,l=i.elements;l[0]=r*h[0]+s*h[4]+a*h[8]+o*h[12],l[1]=r*h[1]+s*h[5]+a*h[9]+o*h[13],l[2]=r*h[2]+s*h[6]+a*h[10]+o*h[14],l[3]=r*h[3]+s*h[7]+a*h[11]+o*h[15]},t.equals=function(t,e){var i=t.elements,n=e.elements;return k.nearEqual(Math.abs(i[0]),Math.abs(n[0]))&&k.nearEqual(Math.abs(i[1]),Math.abs(n[1]))&&k.nearEqual(Math.abs(i[2]),Math.abs(n[2]))&&k.nearEqual(Math.abs(i[3]),Math.abs(n[3]))},t.normalize=function(t,e){var i=t.elements,n=e.elements,r=t.length();0<r&&(n[0]=i[0]*r,n[1]=i[1]*r,n[2]=i[2]*r,n[3]=i[3]*r)},t.add=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements;n[0]=r[0]+s[0],n[1]=r[1]+s[1],n[2]=r[2]+s[2],n[3]=r[3]+s[3]},t.subtract=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements;n[0]=r[0]-s[0],n[1]=r[1]-s[1],n[2]=r[2]-s[2],n[3]=r[3]-s[3]},t.multiply=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements;n[0]=r[0]*s[0],n[1]=r[1]*s[1],n[2]=r[2]*s[2],n[3]=r[3]*s[3]},t.scale=function(t,e,i){var n=i.elements,r=t.elements;n[0]=r[0]*e,n[1]=r[1]*e,n[2]=r[2]*e,n[3]=r[3]*e},t.Clamp=function(t,e,i,n){var r=t.elements,s=r[0],a=r[1],o=r[2],h=r[3],l=e.elements,u=l[0],c=l[1],_=l[2],d=l[3],f=i.elements,p=f[0],m=f[1],g=f[2],v=f[3],T=n.elements;s=(s=p<s?p:s)<u?u:s,a=(a=m<a?m:a)<c?c:a,o=(o=g<o?g:o)<_?_:o,h=(h=v<h?v:h)<d?d:h,T[0]=s,T[1]=a,T[2]=o,T[3]=h},t.distanceSquared=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],s=i[1]-n[1],a=i[2]-n[2],o=i[3]-n[3];return r*r+s*s+a*a+o*o},t.distance=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],s=i[1]-n[1],a=i[2]-n[2],o=i[3]-n[3];return Math.sqrt(r*r+s*s+a*a+o*o)},t.dot=function(t,e){var i=t.elements,n=e.elements;return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]+i[3]*n[3]},t.min=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements;n[0]=Math.min(r[0],s[0]),n[1]=Math.min(r[1],s[1]),n[2]=Math.min(r[2],s[2]),n[3]=Math.min(r[3],s[3])},t.max=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements;n[0]=Math.max(r[0],s[0]),n[1]=Math.max(r[1],s[1]),n[2]=Math.max(r[2],s[2]),n[3]=Math.max(r[3],s[3])},E(t,["ZERO",function(){return this.ZERO=new t},"ONE",function(){return this.ONE=new t(1,1,1,1)},"UnitX",function(){return this.UnitX=new t(1,0,0,0)},"UnitY",function(){return this.UnitY=new t(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new t(0,0,1,0)},"UnitW",function(){return this.UnitW=new t(0,0,0,1)}]),t}(),B=function(){function a(t,e,i,n){var r;this.elements=null,void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),r=n||new Float32Array(3),(this.elements=r)[0]=t,r[1]=e,r[2]=i}I(a,"laya.d3.math.Native.ConchVector3");var t=a.prototype;return T.imps(t,{"laya.d3.core.IClone":!0}),t.setValue=function(t,e,i){this.elements[0]=t,this.elements[1]=e,this.elements[2]=i},t.fromArray=function(t,e){void 0===e&&(e=0),this.elements[0]=t[e+0],this.elements[1]=t[e+1],this.elements[2]=t[e+2]},t.cloneTo=function(t){var e=t.elements,i=this.elements;e[0]=i[0],e[1]=i[1],e[2]=i[2]},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t.toDefault=function(){this.elements[0]=0,this.elements[1]=0,this.elements[2]=0},g(0,t,"z",function(){return this.elements[2]},function(t){this.elements[2]=t}),g(0,t,"y",function(){return this.elements[1]},function(t){this.elements[1]=t}),g(0,t,"x",function(){return this.elements[0]},function(t){this.elements[0]=t}),a.distanceSquared=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],s=i[1]-n[1],a=i[2]-n[2];return r*r+s*s+a*a},a.distance=function(t,e){var i=t.elements,n=e.elements,r=i[0]-n[0],s=i[1]-n[1],a=i[2]-n[2];return Math.sqrt(r*r+s*s+a*a)},a.min=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements;n[0]=Math.min(r[0],s[0]),n[1]=Math.min(r[1],s[1]),n[2]=Math.min(r[2],s[2])},a.max=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements;n[0]=Math.max(r[0],s[0]),n[1]=Math.max(r[1],s[1]),n[2]=Math.max(r[2],s[2])},a.transformQuat=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements,a=r[0],o=r[1],h=r[2],l=s[0],u=s[1],c=s[2],_=s[3],d=_*a+u*h-c*o,f=_*o+c*a-l*h,p=_*h+l*o-u*a,m=-l*a-u*o-c*h;n[0]=d*_+m*-l+f*-c-p*-u,n[1]=f*_+m*-u+p*-l-d*-c,n[2]=p*_+m*-c+d*-u-f*-l},a.scalarLength=function(t){var e=t.elements,i=e[0],n=e[1],r=e[2];return Math.sqrt(i*i+n*n+r*r)},a.scalarLengthSquared=function(t){var e=t.elements,i=e[0],n=e[1],r=e[2];return i*i+n*n+r*r},a.normalize=function(t,e){var i=t.elements,n=e.elements,r=i[0],s=i[1],a=i[2],o=r*r+s*s+a*a;0<o&&(o=1/Math.sqrt(o),n[0]=i[0]*o,n[1]=i[1]*o,n[2]=i[2]*o)},a.multiply=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements;n[0]=r[0]*s[0],n[1]=r[1]*s[1],n[2]=r[2]*s[2]},a.scale=function(t,e,i){var n=i.elements,r=t.elements;n[0]=r[0]*e,n[1]=r[1]*e,n[2]=r[2]*e},a.lerp=function(t,e,i,n){var r=n.elements,s=t.elements,a=e.elements,o=s[0],h=s[1],l=s[2];r[0]=o+i*(a[0]-o),r[1]=h+i*(a[1]-h),r[2]=l+i*(a[2]-l)},a.transformV3ToV3=function(t,e,i){var n=a._tempVector4;a.transformV3ToV4(t,e,n);var r=n.elements,s=i.elements;s[0]=r[0],s[1]=r[1],s[2]=r[2]},a.transformV3ToV4=function(t,e,i){var n=t.elements,r=n[0],s=n[1],a=n[2],o=e.elements,h=i.elements;h[0]=r*o[0]+s*o[4]+a*o[8]+o[12],h[1]=r*o[1]+s*o[5]+a*o[9]+o[13],h[2]=r*o[2]+s*o[6]+a*o[10]+o[14],h[3]=r*o[3]+s*o[7]+a*o[11]+o[15]},a.TransformNormal=function(t,e,i){var n=t.elements,r=n[0],s=n[1],a=n[2],o=e.elements,h=i.elements;h[0]=r*o[0]+s*o[4]+a*o[8],h[1]=r*o[1]+s*o[5]+a*o[9],h[2]=r*o[2]+s*o[6]+a*o[10]},a.transformCoordinate=function(t,e,i){var n=t.elements,r=n[0],s=n[1],a=n[2],o=e.elements,h=r*o[3]+s*o[7]+a*o[11]+o[15],l=i.elements;l[0]=r*o[0]+s*o[4]+a*o[8]+o[12]/h,l[1]=r*o[1]+s*o[5]+a*o[9]+o[13]/h,l[2]=r*o[2]+s*o[6]+a*o[10]+o[14]/h},a.Clamp=function(t,e,i,n){var r=t.elements,s=r[0],a=r[1],o=r[2],h=e.elements,l=h[0],u=h[1],c=h[2],_=i.elements,d=_[0],f=_[1],p=_[2],m=n.elements;s=(s=d<s?d:s)<l?l:s,a=(a=f<a?f:a)<u?u:a,o=(o=p<o?p:o)<c?c:o,m[0]=s,m[1]=a,m[2]=o},a.add=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements;n[0]=r[0]+s[0],n[1]=r[1]+s[1],n[2]=r[2]+s[2]},a.subtract=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements;n[0]=r[0]-s[0],n[1]=r[1]-s[1],n[2]=r[2]-s[2]},a.cross=function(t,e,i){var n=t.elements,r=e.elements,s=i.elements,a=n[0],o=n[1],h=n[2],l=r[0],u=r[1],c=r[2];s[0]=o*c-h*u,s[1]=h*l-a*c,s[2]=a*u-o*l},a.dot=function(t,e){var i=t.elements,n=e.elements;return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]},a.equals=function(t,e){var i=t.elements,n=e.elements;return k.nearEqual(i[0],n[0])&&k.nearEqual(i[1],n[1])&&k.nearEqual(i[2],n[2])},a.ZERO=new a(0,0,0),a.ONE=new a(1,1,1),a.NegativeUnitX=new a(-1,0,0),a.UnitX=new a(1,0,0),a.UnitY=new a(0,1,0),a.UnitZ=new a(0,0,1),a.ForwardRH=new a(0,0,-1),a.ForwardLH=new a(0,0,1),a.Up=new a(0,1,0),a.NAN=new a(NaN,NaN,NaN),E(a,["_tempVector4",function(){return this._tempVector4=new e}]),a}(),a=function(){function o(){}I(o,"laya.webgl.canvas.save.SaveBase");var t=o.prototype;return T.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._dataObj[this._valueName]=this._value,(o.POOL[o.POOL._length++]=this)._newSubmit&&(t._curSubmit=yt.RENDERBASE)},o._createArray=function(){var t=[];return t._length=0,t},o._init=function(){var t=o._namemap={};return t[1]="ALPHA",t[2]="fillStyle",t[8]="font",t[256]="lineWidth",t[512]="strokeStyle",t[8192]="_mergeID",t[1024]=t[2048]=t[4096]=[],t[16384]="textBaseline",t[32768]="textAlign",t[65536]="_nBlendType",t[1048576]="shader",t[2097152]="filters",t[8388608]="_colorFiler",t},o.save=function(t,e,i,n){if((t._saveMark._saveuse&e)!==e){t._saveMark._saveuse|=e;var r=o.POOL,s=0<r._length?r[--r._length]:new o;s._value=i[s._valueName=o._namemap[e]],s._dataObj=i,s._newSubmit=n;var a=t._save;a[a._length++]=s}},o.POOL=laya.webgl.canvas.save.SaveBase._createArray(),o._namemap=o._init(),o}(),r=function(){function t(){this._id=nt.getGID(),this._resetComp()}I(t,"laya.components.Component");var e=t.prototype;return T.imps(e,{"laya.resource.IDestroy":!0,"laya.resource.ISingletonElement":!0}),e._isScript=function(){return!1},e._resetComp=function(){this._indexInList=-1,this._enabled=!0,this._awaked=!1,this.owner=null},e._getIndexInList=function(){return this._indexInList},e._setIndexInList=function(t){this._indexInList=t},e._onAdded=function(){},e._onAwake=function(){},e._onEnable=function(){},e._onDisable=function(){},e._onEnableInScene=function(){},e._onDisableInScene=function(){},e._onDestroy=function(){},e.onReset=function(){},e._parse=function(t){},e._cloneTo=function(t){},e._setActive=function(t){t?(this._awaked||(this._awaked=!0,this._onAwake()),this._enabled&&this._onEnable()):this._enabled&&this._onDisable()},e._setActiveInScene=function(t){t?this._onEnableInScene():this._onDisableInScene()},e.destroy=function(){this.owner&&this.owner._destroyComponent(this)},e._destroy=function(){this.owner.activeInHierarchy&&this._enabled&&(this._setActive(!1),this._isScript()&&this.onDisable()),this.owner._scene&&this._setActiveInScene(!1),this._onDestroy(),this._destroyed=!0,this.onReset!==laya.components.Component.prototype.onReset?(this.onReset(),this._resetComp(),p.recoverByClass(this)):this._resetComp()},g(0,e,"destroyed",function(){return this._destroyed}),g(0,e,"isSingleton",function(){return!0}),g(0,e,"enabled",function(){return this._enabled},function(t){this._enabled=t,this.owner&&(t?this.owner.activeInHierarchy&&this._onEnable():this.owner.activeInHierarchy&&this._onDisable())}),g(0,e,"id",function(){return this._id}),t}(),i=function(){function t(){}return I(t,"GameConfig"),t.init=function(){(0,Cn.regClass)("game.core.GameSceneManager",$r)},t.width=640,t.height=1136,t.scaleMode="fixedwidth",t.screenMode="vertical",t.alignV="top",t.alignH="left",t.startScene="scene/GameScene.scene",t.sceneRoot="",t.debug=!1,t.stat=!1,t.physicsDebug=!1,t.exportSceneToJson=!0,t.__init$=function(){t.init()},t}(),o=function(){var h;function e(){this._$0__events=null}I(e,"laya.events.EventDispatcher");var t=e.prototype;return t.hasListener=function(t){return!!(this._$0__events&&this._$0__events[t])},t.event=function(t,e){if(!this._$0__events||!this._$0__events[t])return!1;var i=this._$0__events[t];if(i.run)i.once&&delete this._$0__events[t],null!=e?i.runWith(e):i.run();else{for(var n=0,r=i.length;n<r;n++){var s=i[n];s&&(null!=e?s.runWith(e):s.run()),s&&!s.once||(i.splice(n,1),n--,r--)}0===i.length&&this._$0__events&&delete this._$0__events[t]}return!0},t.on=function(t,e,i,n){return this._createListener(t,e,i,n,!1)},t.once=function(t,e,i,n){return this._createListener(t,e,i,n,!0)},t._createListener=function(t,e,i,n,r,s){void 0===s&&(s=!0),s&&this.off(t,e,i,r);var a=h.create(e||this,i,n,r);this._$0__events||(this._$0__events={});var o=this._$0__events;return o[t]?o[t].run?o[t]=[o[t],a]:o[t].push(a):o[t]=a,this},t.off=function(t,e,i,n){if(void 0===n&&(n=!1),!this._$0__events||!this._$0__events[t])return this;var r=this._$0__events[t];if(null!=r)if(r.run)e&&r.caller!==e||null!=i&&r.method!==i||n&&!r.once||(delete this._$0__events[t],r.recover());else{for(var s=0,a=0,o=r.length;a<o;a++){var h=r[a];h?!h||e&&h.caller!==e||null!=i&&h.method!==i||n&&!h.once||(s++,r[a]=null,h.recover()):s++}s===o&&delete this._$0__events[t]}return this},t.offAll=function(t){var e=this._$0__events;if(!e)return this;if(t)this._recoverHandlers(e[t]),delete e[t];else{for(var i in e)this._recoverHandlers(e[i]);this._$0__events=null}return this},t.offAllCaller=function(t){if(t&&this._$0__events)for(var e in this._$0__events)this.off(e,t,null);return this},t._recoverHandlers=function(t){if(t)if(t.run)t.recover();else for(var e=t.length-1;-1<e;e--)t[e]&&(t[e].recover(),t[e]=null)},t.isMouseEvent=function(t){return e.MOUSE_EVENTS[t]||!1},e.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},e.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0}),h=function(t){function r(t,e,i,n){r.__super.call(this,t,e,i,n)}return I(r,"",y),r.prototype.recover=function(){0<this._id&&(this._id=0,r._pool.push(this.clear()))},r.create=function(t,e,i,n){return void 0===n&&(n=!0),r._pool.length?r._pool.pop().setTo(t,e,i,n):new r(t,e,i,n)},r._pool=[],r}()},e}(),y=function(){function r(t,e,i,n){this.once=!1,void(this._id=0)===n&&(n=!1),this.setTo(t,e,i,n)}I(r,"laya.utils.Handler");var t=r.prototype;return t.setTo=function(t,e,i,n){return this._id=r._gid++,this.caller=t,this.method=e,this.args=i,this.once=n,this},t.run=function(){if(null==this.method)return null;var t=this._id,e=this.method.apply(this.caller,this.args);return this._id===t&&this.once&&this.recover(),e},t.runWith=function(t){if(null==this.method)return null;var e=this._id;if(null==t)var i=this.method.apply(this.caller,this.args);else i=this.args||t.unshift?this.args?this.method.apply(this.caller,this.args.concat(t)):this.method.apply(this.caller,t):this.method.call(this.caller,t);return this._id===e&&this.once&&this.recover(),i},t.clear=function(){return this.caller=null,this.method=null,this.args=null,this},t.recover=function(){0<this._id&&(this._id=0,r._pool.push(this.clear()))},r.create=function(t,e,i,n){return void 0===n&&(n=!0),r._pool.length?r._pool.pop().setTo(t,e,i,n):new r(t,e,i,n)},r._pool=[],r._gid=1,r}(),t=function(){function t(){m.Laya3D?m.Laya3D.init(i.width,i.height):T.init(i.width,i.height,T.WebGL),T.Physics&&T.Physics.enable(),T.DebugPanel&&T.DebugPanel.enable(),T.stage.scaleMode=i.scaleMode,T.stage.screenMode=i.screenMode,T.stage.alignV=i.alignV,T.stage.alignH=i.alignH,T.stage.frameRate="fast",gn.exportSceneToJson=i.exportSceneToJson,(i.debug||"true"==nt.getQueryString("debug"))&&T.enableDebugPanel(),i.physicsDebug&&T.PhysicsDebugDraw&&T.PhysicsDebugDraw.enable(),i.stat&&$i.show(),T.alertGlobalError=!0,An.enable("version.json",y.create(this,this.onVersionLoaded),2)}I(t,"Main");var e=t.prototype;return e.onVersionLoaded=function(){Vi.enable("fileconfig.json",y.create(this,this.onConfigLoaded))},e.onConfigLoaded=function(){i.startScene&&xs.open(i.startScene)},t}(),l=function(){function t(){}return I(t,"game.util.GameUtil"),t.randomNumber=function(t,e){return Math.random()*(e-t)+t},t.randomInt=function(t,e){return Math.round(Math.random()*(e-t)+t)},t.randomIntNoMax=function(t,e){var i=Math.floor(Math.random()*(e-t)+t);return e<=i&&(i=e-1),i},t.lerp=function(t,e,i){return t+i*(e-t)},t}(),h=(function(){function t(){}I(t,"game.util.GameConst"),t.UNITY_ROOT="res/unity/Conventional/",t.UNITY_RES_ROOT="res/unity/Conventional/Assets/res/",t.PLATFORM_LEN=100,t.MAP_TYPE_SNOW=1,t.MAP_TYPE_DESERT=2,t.MAP_TYPE_GRASS=3}(),function(){function t(){this.time=NaN}I(t,"laya.d3.core.Keyframe");var e=t.prototype;return T.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){t.time=this.time},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t}()),u=function(){function t(){this.length=0,this.elements=[]}return I(t,"laya.d3.component.SingletonList"),t.prototype._add=function(t){this.length===this.elements.length?this.elements.push(t):this.elements[this.length]=t},t}(),V=function(){function L(){}return I(L,"laya.d3.utils.Utils3D"),L._convertToLayaVec3=function(t,e,i){e.x=i?-t.x():t.x(),e.y=t.y(),e.z=t.z()},L._convertToBulletVec3=function(t,e,i){e.setValue(i?-t.x:t.x,t.y,t.z)},L._rotationTransformScaleSkinAnimation=function(t,e,i,n,r,s,a,o,h,l,u,c){var _,d,f,p,m,g=L._tempArray16_0,v=L._tempArray16_1,T=L._tempArray16_2,y=n+n,E=r+r,x=s+s,S=n*y,C=r*y,I=r*E,R=s*y,A=s*E,M=s*x,D=a*y,b=a*E,w=a*x;for(g[15]=1,g[0]=1-I-M,g[1]=C+w,g[2]=R-b,g[4]=C-w,g[5]=1-S-M,g[6]=A+D,g[8]=R+b,g[9]=A-D,g[10]=1-S-I,v[15]=1,v[0]=o,v[5]=h,v[10]=l,_=0;_<4;_++)d=g[_],f=g[_+4],p=g[_+8],m=g[_+12],T[_]=d,T[_+4]=f,T[_+8]=p,T[_+12]=d*t+f*e+p*i+m;for(_=0;_<4;_++)d=T[_],f=T[_+4],p=T[_+8],m=T[_+12],u[_+c]=d*v[0]+f*v[1]+p*v[2]+m*v[3],u[_+c+4]=d*v[4]+f*v[5]+p*v[6]+m*v[7],u[_+c+8]=d*v[8]+f*v[9]+p*v[10]+m*v[11],u[_+c+12]=d*v[12]+f*v[13]+p*v[14]+m*v[15]},L._createSceneByJsonForMaker=function(t,e,i){var n=L._createNodeByJsonForMaker(t,e,i);return L._addComponentByJsonForMaker(t,e,i),n},L._createNodeByJsonForMaker=function(t,e,i){var n;switch(t.type){case"Scene3D":n=new Rs;break;case"Sprite3D":n=new es;break;case"MeshSprite3D":n=new pa,e&&e.push(n);break;case"SkinnedMeshSprite3D":n=new aa;break;case"ShuriKenParticle3D":n=new Ca;break;case"Terrain":n=new ws;break;case"Camera":n=new Ia;break;case"DirectionLight":n=new Sa;break;case"PointLight":n=new la;break;case"SpotLight":n=new ma;break;case"TrailSprite3D":n=new xa;break;default:var r=Cn.getClass(t.props.runtime);n=new r}var s=t.child;if(s)for(var a=0,o=s.length;a<o;a++){var h=L._createNodeByJsonForMaker(s[a],e,i);n.addChild(h)}var l=t.compId;n.compId=l,n._parse(t.props,null),i&&(i._idMap[l]=n),L._compIdToNode[l]=n;var u=t.components;if(u)for(var c=0,_=u.length;c<_;c++){var d=u[c];if(!(r=Vt.window.Laya[d.type]))r=Vt.window,d.type.split(".").forEach(function(t){r=r[t]});if("function"==typeof r){var f=new r;i&&(i._idMap[d.compId]=f,console.log(d.compId))}else console.warn("Utils3D:Unkown component type.")}return n},L._addComponentByJsonForMaker=function(t,e,i){var n=t.compId,r=L._compIdToNode[n],s=t.child;if(s)for(var a=0,o=s.length;a<o;a++)L._addComponentByJsonForMaker(s[a],e,i);var h=t.components;if(h)for(var l=0,u=h.length;l<u;l++){var c=h[l];if(!(d=Vt.window.Laya[c.type])){var _=c.type.split("."),d=Vt.window;_.forEach(function(t){d=d[t]})}if("function"==typeof d){var f=i._idMap[c.compId];r.addComponentIntance(f),f._parse(c)}else console.warn("Utils3D:Unkown component type.")}},L._createSprite3DInstance=function(t,e,i){var n;switch(t.type){case"Scene3D":n=new Rs;break;case"Sprite3D":n=new es;break;case"MeshSprite3D":n=new pa,i&&i.push(n);break;case"SkinnedMeshSprite3D":n=new aa;break;case"ShuriKenParticle3D":n=new Ca;break;case"Terrain":n=new ws;break;case"Camera":n=new Ia;break;case"DirectionLight":n=new Sa;break;case"PointLight":n=new la;break;case"SpotLight":n=new ma;break;case"TrailSprite3D":n=new xa;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var r=t.child;if(r)for(var s=0,a=r.length;s<a;s++){var o=L._createSprite3DInstance(r[s],e,i);n.addChild(o)}return e[t.instanceID]=n},L._createComponentInstance=function(t,e){var i=e[t.instanceID];i._parse(t.props,e);var n=t.child;if(n)for(var r=0,s=n.length;r<s;r++)L._createComponentInstance(n[r],e);var a=t.components;if(a)for(var o=0,h=a.length;o<h;o++){var l=a[o],u=Vt.window.Laya[l.type];if(!u){var c=l.type.split(".");u=Vt.window,c.forEach(function(t){u=u[t]})}if("function"==typeof u)i.addComponent(u)._parse(l);else console.warn("Unkown component type.")}},L._createNodeByJson02=function(t,e){var i={},n=L._createSprite3DInstance(t,i,e);return L._createComponentInstance(t,i),n},L._computeBoneAndAnimationDatasByBindPoseMatrxix=function(t,e,i,n,r,s){var a,o,h=0,l=0,u=t.length;for(a=0;a<u;h+=t[a].keyframeWidth,l+=16,a++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(e[h+0],e[h+1],e[h+2],e[h+3],e[h+4],e[h+5],e[h+6],e[h+7],e[h+8],e[h+9],n,l),0!=a&&(o=16*t[a].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(n,o,n,l,n,l));var c=i.length;for(a=0;a<c;a++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(n,16*s[a],i[a],r,16*a)},L._computeAnimationDatasByArrayAndMatrixFast=function(t,e,i,n){for(var r=0,s=t.length;r<s;r++)laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(e,16*n[r],t[r],i,16*r)},L._computeBoneAndAnimationDatasByBindPoseMatrxixOld=function(t,e,i,n,r){var s,a,o=0,h=0,l=t.length;for(s=0;s<l;o+=t[s].keyframeWidth,h+=16,s++)laya.d3.utils.Utils3D._rotationTransformScaleSkinAnimation(e[o+7],e[o+8],e[o+9],e[o+3],e[o+4],e[o+5],e[o+6],e[o+0],e[o+1],e[o+2],n,h),0!=s&&(a=16*t[s].parentIndex,laya.d3.utils.Utils3D.mulMatrixByArray(n,a,n,h,n,h));var u=i.length;for(s=0;s<u;s++){var c=16*s;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(n,c,i[s],r,c)}},L._computeAnimationDatasByArrayAndMatrixFastOld=function(t,e,i){for(var n=t.length,r=0;r<n;r++){var s=16*r;laya.d3.utils.Utils3D.mulMatrixByArrayAndMatrixFast(e,s,t[r],i,s)}},L._computeRootAnimationData=function(t,e,i){for(var n=0,r=0,s=0,a=t.length;n<a;r+=t[n].keyframeWidth,s+=16,n++)laya.d3.utils.Utils3D.createAffineTransformationArray(e[r+0],e[r+1],e[r+2],e[r+3],e[r+4],e[r+5],e[r+6],e[r+7],e[r+8],e[r+9],i,s)},L.transformVector3ArrayByQuat=function(t,e,i,n,r){var s=t[e],a=t[e+1],o=t[e+2],h=i.x,l=i.y,u=i.z,c=i.w,_=c*s+l*o-u*a,d=c*a+u*s-h*o,f=c*o+h*a-l*s,p=-h*s-l*a-u*o;n[r]=_*c+p*-h+d*-u-f*-l,n[r+1]=d*c+p*-l+f*-h-_*-u,n[r+2]=f*c+p*-u+_*-l-d*-h},L.mulMatrixByArray=function(t,e,i,n,r,s){var a,o,h,l,u;if(r===i){for(i=L._tempArray16_3,a=0;a<16;++a)i[a]=r[s+a];n=0}for(a=0;a<4;a++)o=t[e+a],h=t[e+a+4],l=t[e+a+8],u=t[e+a+12],r[s+a]=o*i[n+0]+h*i[n+1]+l*i[n+2]+u*i[n+3],r[s+a+4]=o*i[n+4]+h*i[n+5]+l*i[n+6]+u*i[n+7],r[s+a+8]=o*i[n+8]+h*i[n+9]+l*i[n+10]+u*i[n+11],r[s+a+12]=o*i[n+12]+h*i[n+13]+l*i[n+14]+u*i[n+15]},L.mulMatrixByArrayFast=function(t,e,i,n,r,s){var a,o,h,l,u;for(a=0;a<4;a++)o=t[e+a],h=t[e+a+4],l=t[e+a+8],u=t[e+a+12],r[s+a]=o*i[n+0]+h*i[n+1]+l*i[n+2]+u*i[n+3],r[s+a+4]=o*i[n+4]+h*i[n+5]+l*i[n+6]+u*i[n+7],r[s+a+8]=o*i[n+8]+h*i[n+9]+l*i[n+10]+u*i[n+11],r[s+a+12]=o*i[n+12]+h*i[n+13]+l*i[n+14]+u*i[n+15]},L.mulMatrixByArrayAndMatrixFast=function(t,e,i,n,r){var s,a,o,h,l,u=i.elements,c=u[0],_=u[1],d=u[2],f=u[3],p=u[4],m=u[5],g=u[6],v=u[7],T=u[8],y=u[9],E=u[10],x=u[11],S=u[12],C=u[13],I=u[14],R=u[15],A=e,M=e+4,D=e+8,b=e+12,w=r,L=r+4,O=r+8,N=r+12;for(s=0;s<4;s++)a=t[A+s],o=t[M+s],h=t[D+s],l=t[b+s],n[w+s]=a*c+o*_+h*d+l*f,n[L+s]=a*p+o*m+h*g+l*v,n[O+s]=a*T+o*y+h*E+l*x,n[N+s]=a*S+o*C+h*I+l*R},L.createAffineTransformationArray=function(t,e,i,n,r,s,a,o,h,l,u,c){var _=n+n,d=r+r,f=s+s,p=n*_,m=n*d,g=n*f,v=r*d,T=r*f,y=s*f,E=a*_,x=a*d,S=a*f;u[c+0]=(1-(v+y))*o,u[c+1]=(m+S)*o,u[c+2]=(g-x)*o,u[c+3]=0,u[c+4]=(m-S)*h,u[c+5]=(1-(p+y))*h,u[c+6]=(T+E)*h,u[c+7]=0,u[c+8]=(g+x)*l,u[c+9]=(T-E)*l,u[c+10]=(1-(p+v))*l,u[c+11]=0,u[c+12]=t,u[c+13]=e,u[c+14]=i,u[c+15]=1},L.transformVector3ArrayToVector3ArrayCoordinate=function(t,e,i,n,r){var s=t[e+0],a=t[e+1],o=t[e+2],h=i.elements,l=s*h[3]+a*h[7]+o*h[11]+h[15];n[r]=s*h[0]+a*h[4]+o*h[8]+h[12]/l,n[r+1]=s*h[1]+a*h[5]+o*h[9]+h[13]/l,n[r+2]=s*h[2]+a*h[6]+o*h[10]+h[14]/l},L.transformLightingMapTexcoordArray=function(t,e,i,n,r){n[r+0]=t[e+0]*i.x+i.z,n[r+1]=1-((1-t[e+1])*i.y+i.w)},L.getURLVerion=function(t){var e=t.indexOf("?");return 0<=e?t.substr(e):null},L._createAffineTransformationArray=function(t,e,i,n){var r=e.x,s=e.y,a=e.z,o=e.w,h=r+r,l=s+s,u=a+a,c=r*h,_=r*l,d=r*u,f=s*l,p=s*u,m=a*u,g=o*h,v=o*l,T=o*u,y=i.x,E=i.y,x=i.z;n[0]=(1-(f+m))*y,n[1]=(_+T)*y,n[2]=(d-v)*y,n[3]=0,n[4]=(_-T)*E,n[5]=(1-(c+m))*E,n[6]=(p+g)*E,n[7]=0,n[8]=(d+v)*x,n[9]=(p-g)*x,n[10]=(1-(c+f))*x,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1},L._mulMatrixArray=function(t,e,i,n){var r,s,a,o,h,l=e.elements,u=l[0],c=l[1],_=l[2],d=l[3],f=l[4],p=l[5],m=l[6],g=l[7],v=l[8],T=l[9],y=l[10],E=l[11],x=l[12],S=l[13],C=l[14],I=l[15],R=n,A=n+4,M=n+8,D=n+12;for(r=0;r<4;r++)s=t[r],a=t[r+4],o=t[r+8],h=t[r+12],i[R+r]=s*u+a*c+o*_+h*d,i[A+r]=s*f+a*p+o*m+h*g,i[M+r]=s*v+a*T+o*y+h*E,i[D+r]=s*x+a*S+o*C+h*I},L.arcTanAngle=function(t,e){return 0==t?1==e?Math.PI/2:-Math.PI/2:0<t?Math.atan(e/t):t<0?0<e?Math.atan(e/t)+Math.PI:Math.atan(e/t)-Math.PI:0},L.angleTo=function(t,e,i){ln.subtract(e,t,Qt.TEMPVector30),ln.normalize(Qt.TEMPVector30,Qt.TEMPVector30),i.x=Math.asin(Qt.TEMPVector30.y),i.y=L.arcTanAngle(-Qt.TEMPVector30.z,-Qt.TEMPVector30.x)},L.transformQuat=function(t,e,i){var n=e,r=t.x,s=t.y,a=t.z,o=n[0],h=n[1],l=n[2],u=n[3],c=u*r+h*a-l*s,_=u*s+l*r-o*a,d=u*a+o*s-h*r,f=-o*r-h*s-l*a;i.x=c*u+f*-o+_*-l-d*-h,i.y=_*u+f*-h+d*-o-c*-l,i.z=d*u+f*-l+c*-h-_*-o},L.quaternionWeight=function(t,e,i){i.x=t.x*e,i.y=t.y*e,i.z=t.z*e,i.w=t.w},L.quaternionConjugate=function(t,e){e.x=-t.x,e.y=-t.y,e.z=-t.z,e.w=t.w},L.scaleWeight=function(t,e,i){var n=t.x,r=t.y,s=t.z;i.x=0<n?Math.pow(Math.abs(n),e):-Math.pow(Math.abs(n),e),i.y=0<r?Math.pow(Math.abs(r),e):-Math.pow(Math.abs(r),e),i.z=0<s?Math.pow(Math.abs(s),e):-Math.pow(Math.abs(s),e)},L.scaleBlend=function(t,e,i,n){var r=L._tempVector3_0,s=L._tempVector3_1;L.scaleWeight(t,1-i,r),L.scaleWeight(e,i,s);var a=.5<i?e:t;n.x=0<a.x?Math.abs(r.x*s.x):-Math.abs(r.x*s.x),n.y=0<a.y?Math.abs(r.y*s.y):-Math.abs(r.y*s.y),n.z=0<a.z?Math.abs(r.z*s.z):-Math.abs(r.z*s.z)},L.gammaToLinearSpace=function(t){return t<=.04045?t/12.92:t<1?Math.pow((t+.055)/1.055,2.4):Math.pow(t,2.4)},L.linearToGammaSpace=function(t){return t<=0?0:t<=.0031308?12.92*t:t<=1?1.055*Math.pow(t,.41666)-.055:Math.pow(t,.41666)},L.matrix4x4MultiplyFFF=function(t,e,i){var n,r,s,a,o;if(i===e)for(e=new Float32Array(16),n=0;n<16;++n)e[n]=i[n];var h=e[0],l=e[1],u=e[2],c=e[3],_=e[4],d=e[5],f=e[6],p=e[7],m=e[8],g=e[9],v=e[10],T=e[11],y=e[12],E=e[13],x=e[14],S=e[15];for(n=0;n<4;n++)r=t[n],s=t[n+4],a=t[n+8],o=t[n+12],i[n]=r*h+s*l+a*u+o*c,i[n+4]=r*_+s*d+a*f+o*p,i[n+8]=r*m+s*g+a*v+o*T,i[n+12]=r*y+s*E+a*x+o*S},L.matrix4x4MultiplyFFFForNative=function(t,e,i){Nt.instance.matrix4x4Multiply(t,e,i)},L.matrix4x4MultiplyMFM=function(t,e,i){L.matrix4x4MultiplyFFF(t.elements,e,i.elements)},L._buildTexture2D=function(t,e,i,n,r){void 0===r&&(r=!1);var s=new ea(t,e,i,r,!0);return s.anisoLevel=1,s.filterMode=0,Yi._generateTexture2D(s,t,e,n),s},L._drawBound=function(t,e,i){t.lineCount+12>t.maxLineCount&&(t.maxLineCount+=12);var n=L._tempVector3_0,r=L._tempVector3_1,s=e.min,a=e.max;n.setValue(s.x,s.y,s.z),r.setValue(a.x,s.y,s.z),t.addLine(n,r,i,i),n.setValue(s.x,s.y,s.z),r.setValue(s.x,s.y,a.z),t.addLine(n,r,i,i),n.setValue(a.x,s.y,s.z),r.setValue(a.x,s.y,a.z),t.addLine(n,r,i,i),n.setValue(s.x,s.y,a.z),r.setValue(a.x,s.y,a.z),t.addLine(n,r,i,i),n.setValue(s.x,s.y,s.z),r.setValue(s.x,a.y,s.z),t.addLine(n,r,i,i),n.setValue(s.x,s.y,a.z),r.setValue(s.x,a.y,a.z),t.addLine(n,r,i,i),n.setValue(a.x,s.y,s.z),r.setValue(a.x,a.y,s.z),t.addLine(n,r,i,i),n.setValue(a.x,s.y,a.z),r.setValue(a.x,a.y,a.z),t.addLine(n,r,i,i),n.setValue(s.x,a.y,s.z),r.setValue(a.x,a.y,s.z),t.addLine(n,r,i,i),n.setValue(s.x,a.y,s.z),r.setValue(s.x,a.y,a.z),t.addLine(n,r,i,i),n.setValue(a.x,a.y,s.z),r.setValue(a.x,a.y,a.z),t.addLine(n,r,i,i),n.setValue(s.x,a.y,a.z),r.setValue(a.x,a.y,a.z),t.addLine(n,r,i,i)},L._getHierarchyPath=function(t,e,i){i.length=0;for(var n=e;n!==t;){var r=n._parent;if(!r)return null;i.push(r.getChildIndex(n)),n=r}return i},L._getNodeByHierarchyPath=function(t,e){for(var i=t,n=e.length-1;0<=n;n--)i=i.getChildAt(e[n]);return i},L._createNodeByJson=function(t,e){var i;switch(t.type){case"Scene3D":i=new Rs;break;case"Sprite3D":i=new es;break;case"MeshSprite3D":i=new pa,e&&e.push(i);break;case"SkinnedMeshSprite3D":i=new aa;break;case"ShuriKenParticle3D":i=new Ca;break;case"Terrain":i=new ws;break;case"Camera":i=new Ia;break;case"DirectionLight":i=new Sa;break;case"PointLight":i=new la;break;case"SpotLight":i=new ma;break;case"TrailSprite3D":i=new xa;break;default:throw new Error("Utils3D:unidentified class type in (.lh) file.")}var n=t.child;if(n)for(var r=0,s=n.length;r<s;r++){var a=L._createNodeByJson(n[r],e);i.addChild(a)}var o=t.components;if(o)for(var h=0,l=o.length;h<l;h++){var u=o[h];if(!(_=Vt.window.Laya[u.type])){var c=u.type.split("."),_=Vt.window;c.forEach(function(t){_=_[t]})}if("function"==typeof _)i.addComponent(_)._parse(u);else console.warn("Unkown component type.")}return i._parse(t.props,null),i},L._tempArray16_0=new Float32Array(16),L._tempArray16_1=new Float32Array(16),L._tempArray16_2=new Float32Array(16),L._tempArray16_3=new Float32Array(16),E(L,["_tempVector3_0",function(){return this._tempVector3_0=new ln},"_tempVector3_1",function(){return this._tempVector3_1=new ln},"_tempVector3_2",function(){return this._tempVector3_2=new ln},"_tempColor0",function(){return this._tempColor0=new pe},"_compIdToNode",function(){return this._compIdToNode=new Object}]),L}(),p=function(){function s(){}return I(s,"laya.utils.Pool"),s.getPoolBySign=function(t){return s._poolDic[t]||(s._poolDic[t]=[])},s.clearBySign=function(t){s._poolDic[t]&&(s._poolDic[t].length=0)},s.recover=function(t,e){e.__InPool||(e.__InPool=!0,s.getPoolBySign(t).push(e))},s.recoverByClass=function(t){if(t){var e=t.__className||t.constructor._$gid;e&&s.recover(e,t)}},s._getClassSign=function(t){var e=t.__className||t._$gid;return e||(t._$gid=e=nt.getGID()+""),e},s.createByClass=function(t){return s.getItemByClass(s._getClassSign(t),t)},s.getItemByClass=function(t,e){if(!s._poolDic[t])return new e;var i=s.getPoolBySign(t);if(i.length){var n=i.pop();n.__InPool=!1}else n=new e;return n},s.getItemByCreateFun=function(t,e,i){var n=s.getPoolBySign(t),r=n.length?n.pop():e.call(i);return r.__InPool=!1,r},s.getItem=function(t){var e=s.getPoolBySign(t),i=e.length?e.pop():null;return i&&(i.__InPool=!1),i},s.POOLSIGN="__InPool",s._poolDic={},s}(),c=function(){function t(){this._vertexBuffer=null,this._indexBuffer=null,this._bufferState=null}return I(t,"laya.d3.resource.models.SkyMesh"),t.prototype._render=function(t){},t}(),R=(function(){function r(){this.reset()}I(r,"laya.utils.HTMLChar");var t=r.prototype;t.setData=function(t,e,i,n){return this.char=t,this.charNum=t.charCodeAt(0),this.x=this.y=0,this.width=e,this.height=i,this.style=n,this.isWord=!r._isWordRegExp.test(t),this},t.reset=function(){return this.x=this.y=this.width=this.height=0,this.isWord=!1,this.char=null,this.charNum=0,this.style=null,this},t.recover=function(){p.recover("HTMLChar",this.reset())},t._isChar=function(){return!0},t._getCSSStyle=function(){return this.style},r.create=function(){return p.getItemByClass("HTMLChar",r)},r._isWordRegExp=new RegExp("[\\w.]","")}(),function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}I(t,"laya.maths.Point");var e=t.prototype;return e.setTo=function(t,e){return this.x=t,this.y=e,this},e.reset=function(){return this.x=this.y=0,this},e.recover=function(){p.recover("Point",this.reset())},e.distance=function(t,e){return Math.sqrt((this.x-t)*(this.x-t)+(this.y-e)*(this.y-e))},e.toString=function(){return this.x+","+this.y},e.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(0<t){var e=1/t;this.x*=e,this.y*=e}},e.copy=function(t){return this.setTo(t.x,t.y)},t.create=function(){return p.getItemByClass("Point",t)},t.TEMP=new t,t.EMPTY=new t,t}()),_=function(){function N(){}return I(N,"laya.d3.animation.AnimationClipParser04"),N.READ_DATA=function(){N._DATA.offset=N._reader.getUint32(),N._DATA.size=N._reader.getUint32()},N.READ_BLOCK=function(){for(var t=N._BLOCK.count=N._reader.getUint16(),e=N._BLOCK.blockStarts=[],i=N._BLOCK.blockLengths=[],n=0;n<t;n++)e.push(N._reader.getUint32()),i.push(N._reader.getUint32())},N.READ_STRINGS=function(){var t=N._reader.getUint32(),e=N._reader.getUint16(),i=N._reader.pos;N._reader.pos=t+N._DATA.offset;for(var n=0;n<e;n++)N._strings[n]=N._reader.readUTFString();N._reader.pos=i},N.parse=function(t,e,i){N._animationClip=t,N._reader=e,N._version=i,N.READ_DATA(),N.READ_BLOCK(),N.READ_STRINGS();for(var n=0,r=N._BLOCK.count;n<r;n++){var s=e.getUint16(),a=N._strings[s],o=N["READ_"+a];if(null==o)throw new Error("model file err,no this function:"+s+" "+a);o.call(null)}N._version=null,N._reader=null,N._animationClip=null},N.READ_ANIMATIONS=function(){var t,e=0,i=0,n=N._reader,r=(n.__getBuffer(),[]),s=n.getUint16();for(r.length=s,e=0;e<s;e++)r[e]=n.getFloat32();var a=N._animationClip;a.name=N._strings[n.getUint16()];var o=a._duration=n.getFloat32();a.islooping=!!n.getByte(),a._frameRate=n.getInt16();var h=n.getInt16(),l=a._nodes;l.count=h;var u=a._nodesMap={},c=a._nodesDic={};for(e=0;e<h;e++){t=new Fe,l.setNodeByIndex(e,t),t._indexInList=e;var _=t.type=n.getUint8(),d=n.getUint16();for(t._setOwnerPathCount(d),i=0;i<d;i++)t._setOwnerPathByIndex(i,N._strings[n.getUint16()]);var f=t._joinOwnerPath("/"),p=u[f];p||(u[f]=p=[]),p.push(t),t.propertyOwner=N._strings[n.getUint16()];var m=n.getUint16();for(t._setPropertyCount(m),i=0;i<m;i++)t._setPropertyByIndex(i,N._strings[n.getUint16()]);var g=f+"."+t.propertyOwner+"."+t._joinProperty(".");(c[g]=t).fullPath=g;var v=n.getUint16();t._setKeyframeCount(v);switch(_){case 0:break;case 1:case 3:case 4:t.data=qi.supportWebGLPlusAnimation?new B:new ln;break;case 2:t.data=qi.supportWebGLPlusAnimation?new F:new Qt;break;default:throw"AnimationClipParser04:unknown type."}switch(N._version){case"LAYAANIMATION:04":for(i=0;i<v;i++)switch(_){case 0:var T=new Gn;t._setKeyframeByIndex(i,T),T.time=r[n.getUint16()],T.inTangent=n.getFloat32(),T.outTangent=n.getFloat32(),T.value=n.getFloat32();break;case 1:case 3:case 4:var y=new Ln;if(t._setKeyframeByIndex(i,y),y.time=r[n.getUint16()],qi.supportWebGLPlusAnimation){for(var E=y.data=new Float32Array(9),x=0;x<3;x++)E[x]=n.getFloat32();for(x=0;x<3;x++)E[3+x]=n.getFloat32();for(x=0;x<3;x++)E[6+x]=n.getFloat32()}else{var S=y.inTangent,C=y.outTangent,I=y.value;S.x=n.getFloat32(),S.y=n.getFloat32(),S.z=n.getFloat32(),C.x=n.getFloat32(),C.y=n.getFloat32(),C.z=n.getFloat32(),I.x=n.getFloat32(),I.y=n.getFloat32(),I.z=n.getFloat32()}break;case 2:var R=new Yn;if(t._setKeyframeByIndex(i,R),R.time=r[n.getUint16()],qi.supportWebGLPlusAnimation){for(E=R.data=new Float32Array(12),x=0;x<4;x++)E[x]=n.getFloat32();for(x=0;x<4;x++)E[4+x]=n.getFloat32();for(x=0;x<4;x++)E[8+x]=n.getFloat32()}else{var A=R.inTangent,M=R.outTangent,D=R.value;A.x=n.getFloat32(),A.y=n.getFloat32(),A.z=n.getFloat32(),A.w=n.getFloat32(),M.x=n.getFloat32(),M.y=n.getFloat32(),M.z=n.getFloat32(),M.w=n.getFloat32(),D.x=n.getFloat32(),D.y=n.getFloat32(),D.z=n.getFloat32(),D.w=n.getFloat32()}break;default:throw"AnimationClipParser04:unknown type."}break;case"LAYAANIMATION:COMPRESSION_04":for(i=0;i<v;i++)switch(_){case 0:T=new Gn,t._setKeyframeByIndex(i,T),T.time=r[n.getUint16()],T.inTangent=Je.convertToNumber(n.getUint16()),T.outTangent=Je.convertToNumber(n.getUint16()),T.value=Je.convertToNumber(n.getUint16());break;case 1:case 3:case 4:if(y=new Ln,t._setKeyframeByIndex(i,y),y.time=r[n.getUint16()],qi.supportWebGLPlusAnimation){for(E=y.data=new Float32Array(9),x=0;x<3;x++)E[x]=Je.convertToNumber(n.getUint16());for(x=0;x<3;x++)E[3+x]=Je.convertToNumber(n.getUint16());for(x=0;x<3;x++)E[6+x]=Je.convertToNumber(n.getUint16())}else S=y.inTangent,C=y.outTangent,I=y.value,S.x=Je.convertToNumber(n.getUint16()),S.y=Je.convertToNumber(n.getUint16()),S.z=Je.convertToNumber(n.getUint16()),C.x=Je.convertToNumber(n.getUint16()),C.y=Je.convertToNumber(n.getUint16()),C.z=Je.convertToNumber(n.getUint16()),I.x=Je.convertToNumber(n.getUint16()),I.y=Je.convertToNumber(n.getUint16()),I.z=Je.convertToNumber(n.getUint16());break;case 2:if(R=new Yn,t._setKeyframeByIndex(i,R),R.time=r[n.getUint16()],qi.supportWebGLPlusAnimation){for(E=R.data=new Float32Array(12),x=0;x<4;x++)E[x]=Je.convertToNumber(n.getUint16());for(x=0;x<4;x++)E[4+x]=Je.convertToNumber(n.getUint16());for(x=0;x<4;x++)E[8+x]=Je.convertToNumber(n.getUint16())}else A=R.inTangent,M=R.outTangent,D=R.value,A.x=Je.convertToNumber(n.getUint16()),A.y=Je.convertToNumber(n.getUint16()),A.z=Je.convertToNumber(n.getUint16()),A.w=Je.convertToNumber(n.getUint16()),M.x=Je.convertToNumber(n.getUint16()),M.y=Je.convertToNumber(n.getUint16()),M.z=Je.convertToNumber(n.getUint16()),M.w=Je.convertToNumber(n.getUint16()),D.x=Je.convertToNumber(n.getUint16()),D.y=Je.convertToNumber(n.getUint16()),D.z=Je.convertToNumber(n.getUint16()),D.w=Je.convertToNumber(n.getUint16());break;default:throw"AnimationClipParser04:unknown type."}}}var b=n.getUint16();for(e=0;e<b;e++){var w,L=new xn;L.time=Math.min(o,n.getFloat32()),L.eventName=N._strings[n.getUint16()];var O=n.getUint16();for(0<O&&(L.params=w=[]),i=0;i<O;i++){switch(n.getByte()){case 0:w.push(!!n.getByte());break;case 1:w.push(n.getInt32());break;case 2:w.push(n.getFloat32());break;case 3:w.push(N._strings[n.getUint16()]);break;default:throw new Error("unknown type.")}}a.addEvent(L)}},N._animationClip=null,N._reader=null,N._strings=[],N._version=null,E(N,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),N}(),d=function(){function N(){}return I(N,"laya.d3.animation.AnimationClipParser03"),N.READ_DATA=function(){N._DATA.offset=N._reader.getUint32(),N._DATA.size=N._reader.getUint32()},N.READ_BLOCK=function(){for(var t=N._BLOCK.count=N._reader.getUint16(),e=N._BLOCK.blockStarts=[],i=N._BLOCK.blockLengths=[],n=0;n<t;n++)e.push(N._reader.getUint32()),i.push(N._reader.getUint32())},N.READ_STRINGS=function(){var t=N._reader.getUint32(),e=N._reader.getUint16(),i=N._reader.pos;N._reader.pos=t+N._DATA.offset;for(var n=0;n<e;n++)N._strings[n]=N._reader.readUTFString();N._reader.pos=i},N.parse=function(t,e){N._animationClip=t;(N._reader=e).__getBuffer();N.READ_DATA(),N.READ_BLOCK(),N.READ_STRINGS();for(var i=0,n=N._BLOCK.count;i<n;i++){var r=e.getUint16(),s=N._strings[r],a=N["READ_"+s];if(null==a)throw new Error("model file err,no this function:"+r+" "+s);a.call(null)}},N.READ_ANIMATIONS=function(){var t,e=0,i=0,n=N._reader,r=(n.__getBuffer(),[]),s=n.getUint16();for(r.length=s,e=0;e<s;e++)r[e]=n.getFloat32();var a=N._animationClip;a.name=N._strings[n.getUint16()];var o=a._duration=n.getFloat32();a.islooping=!!n.getByte(),a._frameRate=n.getInt16();var h=n.getInt16(),l=a._nodes;l.count=h;var u=a._nodesMap={},c=a._nodesDic={};for(e=0;e<h;e++){t=new Fe,l.setNodeByIndex(e,t),t._indexInList=e;var _=t.type=n.getUint8(),d=n.getUint16();for(t._setOwnerPathCount(d),i=0;i<d;i++)t._setOwnerPathByIndex(i,N._strings[n.getUint16()]);var f=t._joinOwnerPath("/"),p=u[f];p||(u[f]=p=[]),p.push(t),t.propertyOwner=N._strings[n.getUint16()];var m=n.getUint16();for(t._setPropertyCount(m),i=0;i<m;i++)t._setPropertyByIndex(i,N._strings[n.getUint16()]);var g=f+"."+t.propertyOwner+"."+t._joinProperty(".");(c[g]=t).fullPath=g;var v=n.getUint16();t._setKeyframeCount(v);switch(_){case 0:break;case 1:case 3:case 4:t.data=qi.supportWebGLPlusAnimation?new B:new ln;break;case 2:t.data=qi.supportWebGLPlusAnimation?new F:new Qt;break;default:throw"AnimationClipParser03:unknown type."}for(i=0;i<v;i++)switch(_){case 0:var T=new Gn;t._setKeyframeByIndex(i,T),T.time=r[n.getUint16()],T.inTangent=n.getFloat32(),T.outTangent=n.getFloat32(),T.value=n.getFloat32();break;case 1:case 3:case 4:var y=new Ln;if(t._setKeyframeByIndex(i,y),y.time=r[n.getUint16()],qi.supportWebGLPlusAnimation){for(var E=y.data=new Float32Array(9),x=0;x<3;x++)E[x]=n.getFloat32();for(x=0;x<3;x++)E[3+x]=n.getFloat32();for(x=0;x<3;x++)E[6+x]=n.getFloat32()}else{var S=y.inTangent,C=y.outTangent,I=y.value;S.x=n.getFloat32(),S.y=n.getFloat32(),S.z=n.getFloat32(),C.x=n.getFloat32(),C.y=n.getFloat32(),C.z=n.getFloat32(),I.x=n.getFloat32(),I.y=n.getFloat32(),I.z=n.getFloat32()}break;case 2:var R=new Yn;if(t._setKeyframeByIndex(i,R),R.time=r[n.getUint16()],qi.supportWebGLPlusAnimation){for(E=R.data=new Float32Array(12),x=0;x<4;x++)E[x]=n.getFloat32();for(x=0;x<4;x++)E[4+x]=n.getFloat32();for(x=0;x<4;x++)E[8+x]=n.getFloat32()}else{var A=R.inTangent,M=R.outTangent,D=R.value;A.x=n.getFloat32(),A.y=n.getFloat32(),A.z=n.getFloat32(),A.w=n.getFloat32(),M.x=n.getFloat32(),M.y=n.getFloat32(),M.z=n.getFloat32(),M.w=n.getFloat32(),D.x=n.getFloat32(),D.y=n.getFloat32(),D.z=n.getFloat32(),D.w=n.getFloat32()}break;default:throw"AnimationClipParser03:unknown type."}}var b=n.getUint16();for(e=0;e<b;e++){var w,L=new xn;L.time=Math.min(o,n.getFloat32()),L.eventName=N._strings[n.getUint16()];var O=n.getUint16();for(0<O&&(L.params=w=[]),i=0;i<O;i++){switch(n.getByte()){case 0:w.push(!!n.getByte());break;case 1:w.push(n.getInt32());break;case 2:w.push(n.getFloat32());break;case 3:w.push(N._strings[n.getUint16()]);break;default:throw new Error("unknown type.")}}a.addEvent(L)}},N._animationClip=null,N._reader=null,N._strings=[],E(N,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),N}(),v=function(){function s(){}I(s,"laya.display.cmd.ClipRectCmd");var t=s.prototype;return t.recover=function(){p.recover("ClipRectCmd",this)},t.run=function(t,e,i){t.clipRect(this.x+e,this.y+i,this.width,this.height)},g(0,t,"cmdID",function(){return"ClipRect"}),s.create=function(t,e,i,n){var r=p.getItemByClass("ClipRectCmd",s);return r.x=t,r.y=e,r.width=i,r.height=n,r},s.ID="ClipRect",s}(),x=function(){function n(t,e,i,n){this._initialSize=NaN,this._rootNode=null,this._looseness=NaN,this._minSize=NaN,this.count=0,this._motionObjects=new On,t<i&&(console.warn("Minimum node size must be at least as big as the initial world size. Was: "+i+" Adjusted to: "+t),i=t),this._initialSize=t,this._minSize=i,this._looseness=Math.min(Math.max(n,1),2),this._rootNode=new b(this,null,t,e)}I(n,"laya.d3.core.scene.BoundsOctree");var t=n.prototype;return t._getMaxDepth=function(t,e){e++;var i=t._children;if(null!=i)for(var n=e,r=0,s=i.length;r<s;r++){var a=i[r];a&&(e=Math.max(this._getMaxDepth(a,n),e))}return e},t._grow=function(t){var e=0<=t.x?1:-1,i=0<=t.y?1:-1,n=0<=t.z?1:-1,r=this._rootNode,s=this._rootNode.baseLength/2,a=2*this._rootNode.baseLength,o=this._rootNode.center,h=new ln(o.x+e*s,o.y+i*s,o.z+n*s);if(this._rootNode=new b(this,null,a,h),r.hasAnyObjects()){for(var l=this._rootNode._bestFitChild(r.center),u=P(8,null),c=0;c<8;c++)c==l&&(r._parent=this._rootNode,u[c]=r);this._rootNode._children=u}},t.add=function(t){for(var e=0;!this._rootNode.add(t);){var i=n._tempVector30;if(ln.subtract(t.bounds.getCenter(),this._rootNode.center,i),this._grow(i),20<++e)throw"Aborted Add operation as it seemed to be going on forever ("+(e-1)+") attempts at growing the octree."}this.count++},t.remove=function(t){var e=t._getOctreeNode().remove(t);return e&&this.count--,e},t.update=function(t){var e=0,i=t._getOctreeNode();if(i){for(;!i._update(t);)if(this._grow(t.bounds.getCenter()),20<++e)throw"Aborted Add operation as it seemed to be going on forever ("+(e-1)+") attempts at growing the octree.";return!0}return!1},t.shrinkRootIfPossible=function(){this._rootNode=this._rootNode.shrinkIfPossible(this._initialSize)},t.addMotionObject=function(t){this._motionObjects.add(t)},t.removeMotionObject=function(t){this._motionObjects.remove(t)},t.updateMotionObjects=function(){for(var t=this._motionObjects.elements,e=0,i=this._motionObjects.length;e<i;e++){var n=t[e];this.update(n),n._setIndexInMotionList(-1)}this._motionObjects.length=0},t.isCollidingWithBoundBox=function(t){return this._rootNode.isCollidingWithBoundBox(t)},t.isCollidingWithRay=function(t,e){return void 0===e&&(e=Number.MAX_VALUE),this._rootNode.isCollidingWithRay(t,e)},t.getCollidingWithBoundBox=function(t,e){this._rootNode.getCollidingWithBoundBox(t,e)},t.getCollidingWithRay=function(t,e,i){void 0===i&&(i=Number.MAX_VALUE),this._rootNode.getCollidingWithRay(t,e,i)},t.getCollidingWithFrustum=function(t){this._rootNode.getCollidingWithFrustum(t)},t.getMaxBounds=function(){return this._rootNode.getBound()},t.drawAllBounds=function(t){var e=this._getMaxDepth(this._rootNode,-1);this._rootNode.drawAllBounds(t,-1,e)},t.drawAllObjects=function(t){var e=this._getMaxDepth(this._rootNode,-1);this._rootNode.drawAllObjects(t,-1,e)},E(n,["_tempVector30",function(){return this._tempVector30=new ln}]),n}(),S=function(){function r(){}I(r,"laya.display.cmd.RotateCmd");var t=r.prototype;return t.recover=function(){p.recover("RotateCmd",this)},t.run=function(t,e,i){t._rotate(this.angle,this.pivotX+e,this.pivotY+i)},g(0,t,"cmdID",function(){return"Rotate"}),r.create=function(t,e,i){var n=p.getItemByClass("RotateCmd",r);return n.angle=t,n.pivotX=e,n.pivotY=i,n},r.ID="Rotate",r}(),C=function(){function l(){}I(l,"laya.display.cmd.DrawPolyCmd");var t=l.prototype;return t.recover=function(){this.points=null,this.fillColor=null,this.lineColor=null,p.recover("DrawPolyCmd",this)},t.run=function(t,e,i){t._drawPoly(this.x+e,this.y+i,this.points,this.fillColor,this.lineColor,this.lineWidth,this.isConvexPolygon,this.vid)},g(0,t,"cmdID",function(){return"DrawPoly"}),l.create=function(t,e,i,n,r,s,a,o){var h=p.getItemByClass("DrawPolyCmd",l);return h.x=t,h.y=e,h.points=i,h.fillColor=n,h.lineColor=r,h.lineWidth=s,h.isConvexPolygon=a,h.vid=o,h},l.ID="DrawPoly",l}(),A=function(){function a(){this._data=[],this._ndata=0,this._tex=null,this._imgId=0,this._clipid=-1,this._enbale=!1,this._colorFiler=null,this._clipMatrix=new It}I(a,"laya.webgl.text.CharSubmitCache");var t=a.prototype;return t.clear=function(){this._tex=null,this._imgId=-1,this._ndata=0,this._enbale=!1,this._colorFiler=null},t.destroy=function(){this.clear(),this._data.length=0,this._data=null},t.add=function(t,e,i,n,r,s){0<this._ndata&&(this._tex!=e||this._imgId!=i||0<=this._clipid&&this._clipid!=t._clipInfoID)&&this.submit(t),this._clipid=t._clipInfoID,t._globalClipMatrix.copyTo(this._clipMatrix),this._tex=e,this._imgId=i,this._colorFiler=t._colorFiler,this._data[this._ndata]=n,this._data[this._ndata+1]=r,this._data[this._ndata+2]=s,this._ndata+=3},t.getPos=function(){return 0==a.__nPosPool?new Array(8):a.__posPool[--a.__nPosPool]},t.enable=function(t,e){t!==this._enbale&&(this._enbale=t,this._enbale||this.submit(e))},t.submit=function(t){var e=this._ndata;if(e){var i=t._mesh,n=t._colorFiler;t._colorFiler=this._colorFiler;var r=rr.create(t,i,Ot.create(1,0));t._submits[t._submits._length++]=t._curSubmit=r,r.shaderValue.textureHost=this._tex,r._key.other=this._imgId,t._colorFiler=n,t._copyClipInfo(r,this._clipMatrix),r.clipInfoID=this._clipid;for(var s=0;s<e;s+=3)i.addQuad(this._data[s],this._data[s+1],this._data[s+2],!0),a.__posPool[a.__nPosPool++]=this._data[s];e/=3,r._numEle+=6*e,i.indexNum+=6*e,i.vertNum+=4*e,t._drawCount+=e,this._ndata=0,$i.loopCount%100==0&&(this._data.length=0)}},a.__posPool=[],a.__nPosPool=0,a}(),M=function(){function t(){}I(t,"laya.d3.core.render.command.Command");var e=t.prototype;return e.run=function(){},e.recover=function(){},t}(),D=function(){function h(t,e){this._id=0,this._vertexStride=0,this._vertexElementsDic=null,this._shaderValues=null,this._defineDatas=null,this.vertexElements=null,this._id=++h._uniqueIDCounter,this._defineDatas=new jt,this._vertexElementsDic={},this._vertexStride=t;var i=(this.vertexElements=e).length;this._shaderValues=new xe(null);for(var n=0;n<i;n++){var r=e[n],s=r.elementUsage;this._vertexElementsDic[s]=r;var a=new Int32Array(5),o=w.getElementInfos(r.elementFormat);a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=this._vertexStride,a[4]=r.offset,this._shaderValues.setAttribute(s,a)}}I(h,"laya.d3.graphics.VertexDeclaration");var t=h.prototype;return t.getVertexElementByUsage=function(t){return this._vertexElementsDic[t]},t.unBinding=function(){},g(0,t,"vertexStride",function(){return this._vertexStride}),g(0,t,"id",function(){return this._id}),h._uniqueIDCounter=1,h}(),b=function(){function c(t,e,i,n){this._octree=null,this._parent=null,this._children=null,this._isContaion=!1,this.baseLength=0,this._bounds=new Qe(new ln,new ln),this._objects=[],this.center=new ln,this._setValues(t,e,i,n)}I(c,"laya.d3.core.scene.BoundsOctreeNode");var t=c.prototype;return t._setValues=function(t,e,i,n){this._octree=t,this._parent=e,this.baseLength=i,n.cloneTo(this.center);var r=this._bounds.min,s=this._bounds.max,a=t._looseness*i/2;r.setValue(n.x-a,n.y-a,n.z-a),s.setValue(n.x+a,n.y+a,n.z+a)},t._getChildBound=function(t){if(null!=this._children&&this._children[t])return this._children[t]._bounds;var e=this.baseLength/4,i=this.baseLength/2*this._octree._looseness/2,n=c._tempBoundBox,r=n.min,s=n.max;switch(t){case 0:r.x=this.center.x-e-i,r.y=this.center.y+e-i,r.z=this.center.z-e-i,s.x=this.center.x-e+i,s.y=this.center.y+e+i,s.z=this.center.z-e+i;break;case 1:r.x=this.center.x+e-i,r.y=this.center.y+e-i,r.z=this.center.z-e-i,s.x=this.center.x+e+i,s.y=this.center.y+e+i,s.z=this.center.z-e+i;break;case 2:r.x=this.center.x-e-i,r.y=this.center.y+e-i,r.z=this.center.z+e-i,s.x=this.center.x-e+i,s.y=this.center.y+e+i,s.z=this.center.z+e+i;break;case 3:r.x=this.center.x+e-i,r.y=this.center.y+e-i,r.z=this.center.z+e-i,s.x=this.center.x+e+i,s.y=this.center.y+e+i,s.z=this.center.z+e+i;break;case 4:r.x=this.center.x-e-i,r.y=this.center.y-e-i,r.z=this.center.z-e-i,s.x=this.center.x-e+i,s.y=this.center.y-e+i,s.z=this.center.z-e+i;break;case 5:r.x=this.center.x+e-i,r.y=this.center.y-e-i,r.z=this.center.z-e-i,s.x=this.center.x+e+i,s.y=this.center.y-e+i,s.z=this.center.z-e+i;break;case 6:r.x=this.center.x-e-i,r.y=this.center.y-e-i,r.z=this.center.z+e-i,s.x=this.center.x-e+i,s.y=this.center.y-e+i,s.z=this.center.z+e+i;break;case 7:r.x=this.center.x+e-i,r.y=this.center.y-e-i,r.z=this.center.z+e-i,s.x=this.center.x+e+i,s.y=this.center.y-e+i,s.z=this.center.z+e+i}return n},t._getChildCenter=function(t){if(null!=this._children)return this._children[t].center;var e=this.baseLength/4,i=c._tempVector30;switch(t){case 0:i.x=this.center.x-e,i.y=this.center.y+e,i.z=this.center.z-e;break;case 1:i.x=this.center.x+e,i.y=this.center.y+e,i.z=this.center.z-e;break;case 2:i.x=this.center.x-e,i.y=this.center.y+e,i.z=this.center.z+e;break;case 3:i.x=this.center.x+e,i.y=this.center.y+e,i.z=this.center.z+e;break;case 4:i.x=this.center.x-e,i.y=this.center.y-e,i.z=this.center.z-e;break;case 5:i.x=this.center.x+e,i.y=this.center.y-e,i.z=this.center.z-e;break;case 6:i.x=this.center.x-e,i.y=this.center.y-e,i.z=this.center.z+e;break;case 7:i.x=this.center.x+e,i.y=this.center.y-e,i.z=this.center.z+e}return i},t._getChild=function(t){var e=this.baseLength/4;switch(this._children||(this._children=P(8,null)),t){case 0:return this._children[0]||(this._children[0]=new c(this._octree,this,this.baseLength/2,new ln(this.center.x+-e,this.center.y+e,this.center.z-e)));case 1:return this._children[1]||(this._children[1]=new c(this._octree,this,this.baseLength/2,new ln(this.center.x+e,this.center.y+e,this.center.z-e)));case 2:return this._children[2]||(this._children[2]=new c(this._octree,this,this.baseLength/2,new ln(this.center.x-e,this.center.y+e,this.center.z+e)));case 3:return this._children[3]||(this._children[3]=new c(this._octree,this,this.baseLength/2,new ln(this.center.x+e,this.center.y+e,this.center.z+e)));case 4:return this._children[4]||(this._children[4]=new c(this._octree,this,this.baseLength/2,new ln(this.center.x-e,this.center.y-e,this.center.z-e)));case 5:return this._children[5]||(this._children[5]=new c(this._octree,this,this.baseLength/2,new ln(this.center.x+e,this.center.y-e,this.center.z-e)));case 6:return this._children[6]||(this._children[6]=new c(this._octree,this,this.baseLength/2,new ln(this.center.x-e,this.center.y-e,this.center.z+e)));case 7:return this._children[7]||(this._children[7]=new c(this._octree,this,this.baseLength/2,new ln(this.center.x+e,this.center.y-e,this.center.z+e)));default:throw"BoundsOctreeNode: unknown index."}},t._shouldMerge=function(){for(var t=this._objects.length,e=0;e<8;e++){var i=this._children[e];if(i){if(null!=i._children)return!1;t+=i._objects.length}}return t<=8},t._mergeChildren=function(){for(var t=0;t<8;t++){var e=this._children[t];if(e){e._parent=null;for(var i=e._objects,n=i.length-1;0<=n;n--){var r=i[n];this._objects.push(r),r._setOctreeNode(this)}}}this._children=null},t._merge=function(){if(null===this._children){var t=this._parent;t&&t._shouldMerge()&&(t._mergeChildren(),t._merge())}},t._checkAddNode=function(t){if(null==this._children){if(this._objects.length<8||this.baseLength/2<this._octree._minSize)return this;for(var e=this._objects.length-1;0<=e;e--){var i=this._objects[e],n=this._bestFitChild(i.bounds.getCenter());c._encapsulates(this._getChildBound(n),i.bounds._getBoundBox())&&(this._objects.splice(this._objects.indexOf(i),1),this._getChild(n)._add(i))}}var r=this._bestFitChild(t.bounds.getCenter());return c._encapsulates(this._getChildBound(r),t.bounds._getBoundBox())?this._getChild(r)._checkAddNode(t):this},t._add=function(t){var e=this._checkAddNode(t);e._objects.push(t),t._setOctreeNode(e)},t._remove=function(t){var e=this._objects.indexOf(t);this._objects.splice(e,1),t._setOctreeNode(null),this._merge()},t._addUp=function(t){return 1===st.boxContainsBox(this._bounds,t.bounds._getBoundBox())?(this._add(t),!0):!!this._parent&&this._parent._addUp(t)},t._getCollidingWithFrustum=function(t,e,i,n){if(i){var r=e.containsBoundBox(this._bounds);if($i.octreeNodeCulling++,0===r)return;i=2===r}this._isContaion=!i;for(var s=t.camera,a=t.scene,o=0,h=this._objects.length;o<h;o++){var l=this._objects[o];if(s._isLayerVisible(l._owner.layer)&&l._enable){if(i&&($i.frustumCulling++,!l._needRender(e)))continue;l._distanceForSort=ln.distance(l.bounds.getCenter(),n);for(var u=l._renderElements,c=0,_=u.length;c<_;c++){var d=u[c],f=a._getRenderQueue(d.material.renderQueue);f.isTransparent?d.addToTransparentRenderQueue(t,f):d.addToOpaqueRenderQueue(t,f)}}}if(null!=this._children)for(o=0;o<8;o++){var p=this._children[o];p&&p._getCollidingWithFrustum(t,e,i,n)}},t._getCollidingWithBoundBox=function(t,e,i){if(e){var n=st.boxContainsBox(this._bounds,t);if(0===n)return;e=2===n}if(e)for(var r=0,s=this._objects.length;r<s;r++){var a=this._objects[r];st.intersectsBoxAndBox(a.bounds._getBoundBox(),t)&&i.push(a)}if(null!=this._children)for(r=0;r<8;r++){this._children[r]._getCollidingWithBoundBox(t,e,i)}},t._bestFitChild=function(t){return(t.x<=this.center.x?0:1)+(t.y>=this.center.y?0:4)+(t.z<=this.center.z?0:2)},t._update=function(t){if(1===st.boxContainsBox(this._bounds,t.bounds._getBoundBox())){var e=this._checkAddNode(t);if(e!==t._getOctreeNode()){e._objects.push(t),t._setOctreeNode(e);var i=this._objects.indexOf(t);this._objects.splice(i,1),this._merge()}return!0}if(this._parent){var n=this._parent._addUp(t);return n&&(i=this._objects.indexOf(t),this._objects.splice(i,1),this._merge()),n}return!1},t.add=function(t){return!!c._encapsulates(this._bounds,t.bounds._getBoundBox())&&(this._add(t),!0)},t.remove=function(t){return t._getOctreeNode()===this&&(this._remove(t),!0)},t.update=function(t){return t._getOctreeNode()===this&&this._update(t)},t.shrinkIfPossible=function(t){if(this.baseLength<2*t)return this;for(var e=-1,i=0,n=this._objects.length;i<n;i++){var r=this._objects[i],s=this._bestFitChild(r.bounds.getCenter());if(0!=i&&s!=e)return this;var a=this._getChildBound(s);if(!c._encapsulates(a,r.bounds._getBoundBox()))return this;0==i&&(e=s)}if(null==this._children){if(-1!=e){var o=this._getChildCenter(e);this._setValues(this._octree,null,this.baseLength/2,o)}return this}var h=!1;for(i=0,n=this._children.length;i<n;i++){var l=this._children[i];if(l&&l.hasAnyObjects()){if(h)return this;if(0<=e&&e!=i)return this;h=!0,e=i}}if(-1==e)return this;var u=this._children[e];return u._parent=null,u},t.hasAnyObjects=function(){if(0<this._objects.length)return!0;if(null!=this._children)for(var t=0;t<8;t++){var e=this._children[t];if(e&&e.hasAnyObjects())return!0}return!1},t.getCollidingWithBoundBox=function(t,e){this._getCollidingWithBoundBox(t,!0,e)},t.getCollidingWithRay=function(t,e,i){void 0===i&&(i=Number.MAX_VALUE);var n=st.intersectsRayAndBoxRD(t,this._bounds);if(!(-1==n||i<n)){for(var r=0,s=this._objects.length;r<s;r++){var a=this._objects[r];-1!==(n=st.intersectsRayAndBoxRD(t,a.bounds._getBoundBox()))&&n<=i&&e.push(a)}if(null!=this._children)for(r=0;r<8;r++){this._children[r].getCollidingWithRay(t,e,i)}}},t.getCollidingWithFrustum=function(t){var e=t.camera.transform.position,i=t.camera.boundFrustum;this._getCollidingWithFrustum(t,i,!0,e)},t.isCollidingWithBoundBox=function(t){if(!st.intersectsBoxAndBox(this._bounds,t))return!1;for(var e=0,i=this._objects.length;e<i;e++){var n=this._objects[e];if(st.intersectsBoxAndBox(n.bounds._getBoundBox(),t))return!0}if(null!=this._children)for(e=0;e<8;e++){if(this._children[e].isCollidingWithBoundBox(t))return!0}return!1},t.isCollidingWithRay=function(t,e){void 0===e&&(e=Number.MAX_VALUE);var i=st.intersectsRayAndBoxRD(t,this._bounds);if(-1==i||e<i)return!1;for(var n=0,r=this._objects.length;n<r;n++){var s=this._objects[n];if(-1!==(i=st.intersectsRayAndBoxRD(t,s.bounds._getBoundBox()))&&i<=e)return!0}if(null!=this._children)for(n=0;n<8;n++){if(this._children[n].isCollidingWithRay(t,e))return!0}return!1},t.getBound=function(){return this._bounds},t.drawAllBounds=function(t,e,i){if(null!==this._children||0!=this._objects.length){e++;var n=c._tempColor0;if(this._isContaion)n.r=0,n.g=0,n.b=1;else{var r=i?e/i:0;n.r=1-r,n.g=r,n.b=0}if(n.a=.3,V._drawBound(t,this._bounds,n),null!=this._children)for(var s=0;s<8;s++){var a=this._children[s];a&&a.drawAllBounds(t,e,i)}}},t.drawAllObjects=function(t,e,i){e++;var n=c._tempColor0;if(this._isContaion)n.r=0,n.g=0,n.b=1;else{var r=i?e/i:0;n.r=1-r,n.g=r,n.b=0}n.a=1;for(var s=0,a=this._objects.length;s<a;s++)V._drawBound(t,this._objects[s].bounds._getBoundBox(),n);if(null!=this._children)for(s=0;s<8;s++){var o=this._children[s];o&&o.drawAllObjects(t,e,i)}},c._encapsulates=function(t,e){return 1==st.boxContainsBox(t,e)},c._NUM_OBJECTS_ALLOWED=8,E(c,["_tempVector3",function(){return this._tempVector3=new ln},"_tempVector30",function(){return this._tempVector30=new ln},"_tempVector31",function(){return this._tempVector31=new ln},"_tempColor0",function(){return this._tempColor0=new pe},"_tempBoundBox",function(){return this._tempBoundBox=new Qe(new ln,new ln)}]),c}(),w=function(){function i(){}return I(i,"laya.d3.graphics.VertexElementFormat"),i.getElementInfos=function(t){var e=i._elementInfos[t];if(e)return e;throw"VertexElementFormat: this vertexElementFormat is not implement."},i.Single="single",i.Vector2="vector2",i.Vector3="vector3",i.Vector4="vector4",i.Color="color",i.Byte4="byte4",i.Short2="short2",i.Short4="short4",i.NormalizedShort2="normalizedshort2",i.NormalizedShort4="normalizedshort4",i.HalfVector2="halfvector2",i.HalfVector4="halfvector4",E(i,["_elementInfos",function(){return this._elementInfos={single:[1,5126,0],vector2:[2,5126,0],vector3:[3,5126,0],vector4:[4,5126,0],color:[4,5126,0],byte4:[4,5121,0],short2:[2,5126,0],short4:[4,5126,0],normalizedshort2:[2,5126,0],normalizedshort4:[4,5126,0],halfvector2:[2,5126,0],halfvector4:[4,5126,0]}}]),i}(),L=function(){function t(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,this._glBuffer=Nt.instance.createBuffer()}I(t,"laya.webgl.utils.Buffer");var e=t.prototype;return e._bindForVAO=function(){},e.bind=function(){return!1},e.destroy=function(){this._glBuffer&&(Nt.instance.deleteBuffer(this._glBuffer),this._glBuffer=null)},g(0,e,"bufferUsage",function(){return this._bufferUsage}),t._bindedVertexBuffer=null,t._bindedIndexBuffer=null,t}(),O=function(){function t(){this._hitResultsPoolIndex=0,this._contactPonintsPoolIndex=0,this._collisions={},this._hitResultsPool=[],this._contactPointsPool=[],this._collisionsPool=[]}I(t,"laya.d3.physics.CollisionTool");var e=t.prototype;return e.getHitResult=function(){var t=this._hitResultsPool[this._hitResultsPoolIndex++];return t||(t=new En,this._hitResultsPool.push(t)),t},e.recoverAllHitResultsPool=function(){this._hitResultsPoolIndex=0},e.getContactPoints=function(){var t=this._contactPointsPool[this._contactPonintsPoolIndex++];return t||(t=new Ee,this._contactPointsPool.push(t)),t},e.recoverAllContactPointsPool=function(){this._contactPonintsPoolIndex=0},e.getCollision=function(t,e){var i,n=t.id,r=e.id,s=this._collisions[n];return s&&(i=s[r]),i||(s||(s={},this._collisions[n]=s),(i=0===this._collisionsPool.length?new vn:this._collisionsPool.pop())._colliderA=t,i._colliderB=e,s[r]=i),i},e.recoverCollision=function(t){var e=t._colliderA.id,i=t._colliderB.id;this._collisions[e][i]=null,this._collisionsPool.push(t)},e.garbageCollection=function(){for(var t in this._hitResultsPoolIndex=0,this._hitResultsPool.length=0,this._contactPonintsPoolIndex=0,this._contactPointsPool.length=0,this._collisionsPool.length=0,this._collisionsPool){var e=this._collisionsPool[t],i=!0;for(var n in e)e[n]?i=!1:delete e[n];i&&delete this._collisionsPool[t]}},t}(),N=function(){function t(){this.json=null}return I(t,"laya.components.Prefab"),t.prototype.create=function(){return this.json?Qi.createByData(null,this.json):null},t}(),U=function(){function u(){}I(u,"laya.display.cmd.DrawPieCmd");var t=u.prototype;return t.recover=function(){this.fillColor=null,this.lineColor=null,p.recover("DrawPieCmd",this)},t.run=function(t,e,i){t._drawPie(this.x+e,this.y+i,this.radius,this._startAngle,this._endAngle,this.fillColor,this.lineColor,this.lineWidth,this.vid)},g(0,t,"startAngle",function(){return 180*this._startAngle/Math.PI},function(t){this._startAngle=t*Math.PI/180}),g(0,t,"endAngle",function(){return 180*this._endAngle/Math.PI},function(t){this._endAngle=t*Math.PI/180}),g(0,t,"cmdID",function(){return"DrawPie"}),u.create=function(t,e,i,n,r,s,a,o,h){var l=p.getItemByClass("DrawPieCmd",u);return l.x=t,l.y=e,l.radius=i,l._startAngle=n,l._endAngle=r,l.fillColor=s,l.lineColor=a,l.lineWidth=o,l.vid=h,l},u.ID="DrawPie",u}(),z=function(){function t(){}return I(t,"laya.layagl.LayaGLRunner"),t.uploadShaderUniforms=function(t,e,i,n){for(var r=i._data,s=e.getArrayData(),a=0,o=0,h=s.length;o<h;o++){var l=s[o];if(n||-1!==l.textureID){var u=r[l.dataOffset];null!=u&&(a+=l.fun.call(l.caller,l,u))}}return a},t.uploadCustomUniform=function(t,e,i,n){var r=0,s=e[i];return s&&null!=n&&(r+=s.fun.call(s.caller,s,n)),r},t.uploadShaderUniformsForNative=function(t,e,i){var n=0;0<i._runtimeCopyValues.length&&(n=1);var r=i._data;return t.uploadShaderUniforms(e,r,n)},t}(),G=function(){function t(){this._destroyed=!1,this._emissionRate=0,this._bursts=null,this.enbale=!1,this._destroyed=!1,this.emissionRate=10,this._bursts=[]}I(t,"laya.d3.core.particleShuriKen.module.Emission");var e=t.prototype;return T.imps(e,{"laya.resource.IDestroy":!0,"laya.d3.core.IClone":!0}),e.destroy=function(){this._bursts=null,this._destroyed=!0},e.getBurstsCount=function(){return this._bursts.length},e.getBurstByIndex=function(t){return this._bursts[t]},e.addBurst=function(t){var e=this._bursts.length;if(0<e)for(var i=0;i<e;i++)this._bursts[i].time>t.time&&this._bursts.splice(i,0,t);this._bursts.push(t)},e.removeBurst=function(t){var e=this._bursts.indexOf(t);-1!==e&&this._bursts.splice(e,1)},e.removeBurstByIndex=function(t){this._bursts.splice(t,1)},e.clearBurst=function(){this._bursts.length=0},e.cloneTo=function(t){var e=t,i=e._bursts;i.length=this._bursts.length;for(var n=0,r=this._bursts.length;n<r;n++){var s=i[n];s?this._bursts[n].cloneTo(s):i[n]=this._bursts[n].clone()}e._emissionRate=this._emissionRate,e.enbale=this.enbale},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},g(0,e,"destroyed",function(){return this._destroyed}),g(0,e,"emissionRate",function(){return this._emissionRate},function(t){if(t<0)throw new Error("ParticleBaseShape:emissionRate value must large or equal than 0.");this._emissionRate=t}),t}(),k=function(){function i(){}return I(i,"laya.d3.math.MathUtils3D"),i.isZero=function(t){return Math.abs(t)<i.zeroTolerance},i.nearEqual=function(t,e){return!!i.isZero(t-e)},i.fastInvSqrt=function(t){return i.isZero(t)?t:1/Math.sqrt(t)},E(i,["zeroTolerance",function(){return this.zeroTolerance=1e-6},"MaxValue",function(){return this.MaxValue=340282347e30},"MinValue",function(){return this.MinValue=-340282347e30}]),i}(),H=function(){function t(t){this.script=null,this.codes={},this.funs={},this.curUseID=-1,this.funnames="",this.script=t;for(var e=0,i=0,n=0;!((e=t.indexOf("#begin",e))<0);){for(n=e+5;!((n=t.indexOf("#end",n))<0)&&"i"===t.charAt(n+4);)n+=5;if(n<0)throw"add include err,no #end:"+t;i=t.indexOf("\n",e);var r=ui.splitToWords(t.substr(e,i-e),null);"code"==r[1]?this.codes[r[2]]=t.substr(i+1,n-i-1):"function"==r[1]&&(i=t.indexOf("function",e),i+="function".length,this.funs[r[3]]=t.substr(i+1,n-i-1),this.funnames+=r[3]+";"),e=n+1}}I(t,"laya.webgl.utils.InlcudeFile");var e=t.prototype;return e.getWith=function(t){var e=t?this.codes[t]:this.script;if(!e)throw"get with error:"+t;return e},e.getFunsScript=function(t){var e="";for(var i in this.funs)0<=t.indexOf(i+";")&&(e+=this.funs[i]);return e},t}(),W=function(){function t(){this._nativeVertexArrayObject=null,this._bindedIndexBuffer=null,this._nativeVertexArrayObject=Nt.instance.createVertexArray()}I(t,"laya.webgl.BufferStateBase");var e=t.prototype;return e.bind=function(){t._curBindedBufferState!==this&&(Nt.instance.bindVertexArray(this._nativeVertexArrayObject),t._curBindedBufferState=this)},e.unBind=function(){if(t._curBindedBufferState!==this)throw"BufferState: must call bind() function first.";Nt.instance.bindVertexArray(null),t._curBindedBufferState=null},e.bindForNative=function(){Nt.instance.bindVertexArray(this._nativeVertexArrayObject),t._curBindedBufferState=this},e.unBindForNative=function(){Nt.instance.bindVertexArray(null),t._curBindedBufferState=null},e.destroy=function(){Nt.instance.deleteVertexArray(this._nativeVertexArrayObject)},t._curBindedBufferState=null,t}(),X=(function(){function t(t,e,i){this.x=0,this.y=0,this.g=0,this.f=0,this.h=0,this.by=0,this.parent=null,this.opened=null,this.closed=null,this.tested=null,this.retainCount=null,this.walkable=!1,void 0===i&&(i=!0),this.x=t,this.y=e,this.walkable=i}I(t,"PathFinding.core.Node",null,"Node$1")}(),function(){function t(){this._destroyed=!1}I(t,"laya.d3.core.GeometryElement");var e=t.prototype;return T.imps(e,{"laya.resource.IDestroy":!0}),e._getType=function(){throw"GeometryElement:must override it."},e._prepareRender=function(t){return!0},e._render=function(t){throw"GeometryElement:must override it."},e.destroy=function(){this._destroyed||(this._destroyed=!0)},g(0,e,"destroyed",function(){return this._destroyed}),t._typeCounter=0,t}()),Y=function(){function t(){}I(t,"laya.display.cmd.SaveCmd");var e=t.prototype;return e.recover=function(){p.recover("SaveCmd",this)},e.run=function(t,e,i){t.save()},g(0,e,"cmdID",function(){return"Save"}),t.create=function(){return p.getItemByClass("SaveCmd",t)},t.ID="Save",t}(),Z=function(){function h(){}I(h,"laya.display.cmd.DrawCircleCmd");var t=h.prototype;return t.recover=function(){this.fillColor=null,this.lineColor=null,p.recover("DrawCircleCmd",this)},t.run=function(t,e,i){t._drawCircle(this.x+e,this.y+i,this.radius,this.fillColor,this.lineColor,this.lineWidth,this.vid)},g(0,t,"cmdID",function(){return"DrawCircle"}),h.create=function(t,e,i,n,r,s,a){var o=p.getItemByClass("DrawCircleCmd",h);return o.x=t,o.y=e,o.radius=i,o.fillColor=n,o.lineColor=r,o.lineWidth=s,o.vid=a,o},h.ID="DrawCircle",h}(),j=function(){function s(){}I(s,"laya.webgl.WebGLContext");var t=s.prototype;return t.getContextAttributes=function(){return null},t.isContextLost=function(){},t.getSupportedExtensions=function(){return null},t.getExtension=function(t){return null},t.activeTexture=function(t){},t.attachShader=function(t,e){},t.bindAttribLocation=function(t,e,i){},t.bindBuffer=function(t,e){},t.bindFramebuffer=function(t,e){},t.bindRenderbuffer=function(t,e){},t.bindTexture=function(t,e){},t.useTexture=function(t){},t.blendColor=function(t,e,i,n){},t.blendEquation=function(t){},t.blendEquationSeparate=function(t,e){},t.blendFunc=function(t,e){},t.blendFuncSeparate=function(t,e,i,n){},t.bufferData=function(t,e,i){},t.bufferSubData=function(t,e,i){},t.checkFramebufferStatus=function(t){return null},t.clear=function(t){},t.clearColor=function(t,e,i,n){},t.clearDepth=function(t){},t.clearStencil=function(t){},t.colorMask=function(t,e,i,n){},t.compileShader=function(t){},t.copyTexImage2D=function(t,e,i,n,r,s,a,o){},t.copyTexSubImage2D=function(t,e,i,n,r,s,a,o){},t.createBuffer=function(){},t.createFramebuffer=function(){},t.createProgram=function(){},t.createRenderbuffer=function(){},t.createShader=function(t){},t.createTexture=function(){return null},t.cullFace=function(t){},t.deleteBuffer=function(t){},t.deleteFramebuffer=function(t){},t.deleteProgram=function(t){},t.deleteRenderbuffer=function(t){},t.deleteShader=function(t){},t.deleteTexture=function(t){},t.depthFunc=function(t){},t.depthMask=function(t){},t.depthRange=function(t,e){},t.detachShader=function(t,e){},t.disable=function(t){},t.disableVertexAttribArray=function(t){},t.drawArrays=function(t,e,i){},t.drawElements=function(t,e,i,n){},t.enable=function(t){},t.enableVertexAttribArray=function(t){},t.finish=function(){},t.flush=function(){},t.framebufferRenderbuffer=function(t,e,i,n){},t.framebufferTexture2D=function(t,e,i,n,r){},t.frontFace=function(t){return null},t.generateMipmap=function(t){return null},t.getActiveAttrib=function(t,e){return null},t.getActiveUniform=function(t,e){return null},t.getAttribLocation=function(t,e){return 0},t.getParameter=function(t){return null},t.getBufferParameter=function(t,e){return null},t.getError=function(){return null},t.getFramebufferAttachmentParameter=function(t,e,i){},t.getProgramParameter=function(t,e){return 0},t.getProgramInfoLog=function(t){return null},t.getRenderbufferParameter=function(t,e){return null},t.getShaderPrecisionFormat=function(t){return null},t.getShaderParameter=function(t,e){},t.getShaderInfoLog=function(t){return null},t.getShaderSource=function(t){return null},t.getTexParameter=function(t,e){},t.getUniform=function(t,e){},t.getUniformLocation=function(t,e){return null},t.getVertexAttrib=function(t,e){return null},t.getVertexAttribOffset=function(t,e){return null},t.hint=function(t,e){},t.isBuffer=function(t){},t.isEnabled=function(t){},t.isFramebuffer=function(t){},t.isProgram=function(t){},t.isRenderbuffer=function(t){},t.isShader=function(t){},t.isTexture=function(t){},t.lineWidth=function(t){},t.linkProgram=function(t){},t.pixelStorei=function(t,e){},t.polygonOffset=function(t,e){},t.readPixels=function(t,e,i,n,r,s,a){},t.renderbufferStorage=function(t,e,i,n){},t.sampleCoverage=function(t,e){},t.scissor=function(t,e,i,n){},t.shaderSource=function(t,e){},t.stencilFunc=function(t,e,i){},t.stencilFuncSeparate=function(t,e,i,n){},t.stencilMask=function(t){},t.stencilMaskSeparate=function(t,e){},t.stencilOp=function(t,e,i){},t.stencilOpSeparate=function(t,e,i,n){},t.texImage2D=function(t){},t.texParameterf=function(t,e,i){},t.texParameteri=function(t,e,i){},t.texSubImage2D=function(t){},t.uniform1f=function(t,e){},t.uniform1fv=function(t,e){},t.uniform1i=function(t,e){},t.uniform1iv=function(t,e){},t.uniform2f=function(t,e,i){},t.uniform2fv=function(t,e){},t.uniform2i=function(t,e,i){},t.uniform2iv=function(t,e){},t.uniform3f=function(t,e,i,n){},t.uniform3fv=function(t,e){},t.uniform3i=function(t,e,i,n){},t.uniform3iv=function(t,e){},t.uniform4f=function(t,e,i,n,r){},t.uniform4fv=function(t,e){},t.uniform4i=function(t,e,i,n,r){},t.uniform4iv=function(t,e){},t.uniformMatrix2fv=function(t,e,i){},t.uniformMatrix3fv=function(t,e,i){},t.uniformMatrix4fv=function(t,e,i){},t.useProgram=function(t){},t.validateProgram=function(t){},t.vertexAttrib1f=function(t,e){},t.vertexAttrib1fv=function(t,e){},t.vertexAttrib2f=function(t,e,i){},t.vertexAttrib2fv=function(t,e){},t.vertexAttrib3f=function(t,e,i,n){},t.vertexAttrib3fv=function(t,e){},t.vertexAttrib4f=function(t,e,i,n,r){},t.vertexAttrib4fv=function(t,e){},t.vertexAttribPointer=function(t,e,i,n,r,s){},t.viewport=function(t,e,i,n){},t.configureBackBuffer=function(t,e,i,n,r){void 0===n&&(n=!0),void 0===r&&(r=!1)},t.compressedTexImage2D=function(t){},t.createVertexArray=function(){throw"not implemented"},t.bindVertexArray=function(t){throw"not implemented"},t.deleteVertexArray=function(t){throw"not implemented"},t.isVertexArray=function(t){throw"not implemented"},s._forceSupportVAOPlatform=function(){return Vt.onMiniGame&&Vt.onIOS||Vt.onBDMiniGame||Vt.onQGMiniGame},s.__init__=function(t){if(laya.webgl.WebGLContext._checkExtensions(t),!en._isWebGL2&&!qi.isConchApp){m._setupVertexArrayObject&&(s._forceSupportVAOPlatform()?m._forceSetupVertexArrayObject(t):m._setupVertexArrayObject(t));var e=(t.rawgl||t).getExtension("OES_vertex_array_object");if(e){var i=t;i.createVertexArray=function(){return e.createVertexArrayOES()},i.bindVertexArray=function(t){e.bindVertexArrayOES(t)},i.deleteVertexArray=function(t){e.deleteVertexArrayOES(t)},i.isVertexArray=function(t){e.isVertexArrayOES(t)}}}},s._getExtension=function(t,e){var i=s._extentionVendorPrefixes;for(var n in i){var r=t.getExtension(i[n]+e);if(r)return r}return null},s._checkExtensions=function(t){s._extTextureFilterAnisotropic=s._getExtension(t,"EXT_texture_filter_anisotropic"),s._compressedTextureS3tc=s._getExtension(t,"WEBGL_compressed_texture_s3tc"),s._compressedTexturePvrtc=s._getExtension(t,"WEBGL_compressed_texture_pvrtc"),s._compressedTextureEtc1=s._getExtension(t,"WEBGL_compressed_texture_etc1"),s._forceSupportVAOPlatform()||(s._angleInstancedArrays=s._getExtension(t,"ANGLE_instanced_arrays"))},s.__init_native=function(){if(qi.supportWebGLPlusRendering){var t=s;t.activeTexture=t.activeTextureForNative,t.bindTexture=t.bindTextureForNative}},s.useProgram=function(t,e){return s._useProgram!==e&&(t.useProgram(e),s._useProgram=e,!0)},s.setDepthTest=function(t,e){e!==s._depthTest&&((s._depthTest=e)?t.enable(2929):t.disable(2929))},s.setDepthMask=function(t,e){e!==s._depthMask&&(s._depthMask=e,t.depthMask(e))},s.setDepthFunc=function(t,e){e!==s._depthFunc&&(s._depthFunc=e,t.depthFunc(e))},s.setBlend=function(t,e){e!==s._blend&&((s._blend=e)?t.enable(3042):t.disable(3042))},s.setBlendFunc=function(t,e,i){(e!==s._sFactor||i!==s._dFactor)&&(s._sFactor=s._srcAlpha=e,s._dFactor=s._dstAlpha=i,t.blendFunc(e,i))},s.setBlendFuncSeperate=function(t,e,i,n,r){e===s._sFactor&&i===s._dFactor&&n===s._srcAlpha&&r===s._dstAlpha||(s._sFactor=e,s._dFactor=i,s._srcAlpha=n,s._dstAlpha=r,t.blendFuncSeparate(e,i,n,r))},s.setCullFace=function(t,e){e!==s._cullFace&&((s._cullFace=e)?t.enable(2884):t.disable(2884))},s.setFrontFace=function(t,e){e!==s._frontFace&&(s._frontFace=e,t.frontFace(e))},s.activeTexture=function(t,e){s._activedTextureID!==e&&(t.activeTexture(e),s._activedTextureID=e)},s.bindTexture=function(t,e,i){s._activeTextures[s._activedTextureID-33984]!==i&&(t.bindTexture(e,i),s._activeTextures[s._activedTextureID-33984]=i)},s.useProgramForNative=function(t,e){return t.useProgram(e),!0},s.setDepthTestForNative=function(t,e){e?t.enable(2929):t.disable(2929)},s.setDepthMaskForNative=function(t,e){t.depthMask(e)},s.setDepthFuncForNative=function(t,e){t.depthFunc(e)},s.setBlendForNative=function(t,e){e?t.enable(3042):t.disable(3042)},s.setBlendFuncForNative=function(t,e,i){t.blendFunc(e,i)},s.setCullFaceForNative=function(t,e){e?t.enable(2884):t.disable(2884)},s.setFrontFaceForNative=function(t,e){t.frontFace(e)},s.activeTextureForNative=function(t,e){t.activeTexture(e)},s.bindTextureForNative=function(t,e,i){t.bindTexture(e,i)},s.bindVertexArrayForNative=function(t,e){t.bindVertexArray(e)},s.DEPTH_BUFFER_BIT=256,s.STENCIL_BUFFER_BIT=1024,s.COLOR_BUFFER_BIT=16384,s.POINTS=0,s.LINES=1,s.LINE_LOOP=2,s.LINE_STRIP=3,s.TRIANGLES=4,s.TRIANGLE_STRIP=5,s.TRIANGLE_FAN=6,s.ZERO=0,s.ONE=1,s.SRC_COLOR=768,s.ONE_MINUS_SRC_COLOR=769,s.SRC_ALPHA=770,s.ONE_MINUS_SRC_ALPHA=771,s.DST_ALPHA=772,s.ONE_MINUS_DST_ALPHA=773,s.DST_COLOR=774,s.ONE_MINUS_DST_COLOR=775,s.SRC_ALPHA_SATURATE=776,s.FUNC_ADD=32774,s.BLEND_EQUATION=32777,s.BLEND_EQUATION_RGB=32777,s.BLEND_EQUATION_ALPHA=34877,s.FUNC_SUBTRACT=32778,s.FUNC_REVERSE_SUBTRACT=32779,s.BLEND_DST_RGB=32968,s.BLEND_SRC_RGB=32969,s.BLEND_DST_ALPHA=32970,s.BLEND_SRC_ALPHA=32971,s.CONSTANT_COLOR=32769,s.ONE_MINUS_CONSTANT_COLOR=32770,s.CONSTANT_ALPHA=32771,s.ONE_MINUS_CONSTANT_ALPHA=32772,s.BLEND_COLOR=32773,s.ARRAY_BUFFER=34962,s.ELEMENT_ARRAY_BUFFER=34963,s.ARRAY_BUFFER_BINDING=34964,s.ELEMENT_ARRAY_BUFFER_BINDING=34965,s.STREAM_DRAW=35040,s.STATIC_DRAW=35044,s.DYNAMIC_DRAW=35048,s.BUFFER_SIZE=34660,s.BUFFER_USAGE=34661,s.CURRENT_VERTEX_ATTRIB=34342,s.FRONT=1028,s.BACK=1029,s.CULL_FACE=2884,s.FRONT_AND_BACK=1032,s.BLEND=3042,s.DITHER=3024,s.STENCIL_TEST=2960,s.DEPTH_TEST=2929,s.SCISSOR_TEST=3089,s.POLYGON_OFFSET_FILL=32823,s.SAMPLE_ALPHA_TO_COVERAGE=32926,s.SAMPLE_COVERAGE=32928,s.NO_ERROR=0,s.INVALID_ENUM=1280,s.INVALID_VALUE=1281,s.INVALID_OPERATION=1282,s.OUT_OF_MEMORY=1285,s.CW=2304,s.CCW=2305,s.LINE_WIDTH=2849,s.ALIASED_POINT_SIZE_RANGE=33901,s.ALIASED_LINE_WIDTH_RANGE=33902,s.CULL_FACE_MODE=2885,s.FRONT_FACE=2886,s.DEPTH_RANGE=2928,s.DEPTH_WRITEMASK=2930,s.DEPTH_CLEAR_VALUE=2931,s.DEPTH_FUNC=2932,s.STENCIL_CLEAR_VALUE=2961,s.STENCIL_FUNC=2962,s.STENCIL_FAIL=2964,s.STENCIL_PASS_DEPTH_FAIL=2965,s.STENCIL_PASS_DEPTH_PASS=2966,s.STENCIL_REF=2967,s.STENCIL_VALUE_MASK=2963,s.STENCIL_WRITEMASK=2968,s.STENCIL_BACK_FUNC=34816,s.STENCIL_BACK_FAIL=34817,s.STENCIL_BACK_PASS_DEPTH_FAIL=34818,s.STENCIL_BACK_PASS_DEPTH_PASS=34819,s.STENCIL_BACK_REF=36003,s.STENCIL_BACK_VALUE_MASK=36004,s.STENCIL_BACK_WRITEMASK=36005,s.VIEWPORT=2978,s.SCISSOR_BOX=3088,s.COLOR_CLEAR_VALUE=3106,s.COLOR_WRITEMASK=3107,s.UNPACK_ALIGNMENT=3317,s.PACK_ALIGNMENT=3333,s.MAX_TEXTURE_SIZE=3379,s.MAX_VIEWPORT_DIMS=3386,s.SUBPIXEL_BITS=3408,s.RED_BITS=3410,s.GREEN_BITS=3411,s.BLUE_BITS=3412,s.ALPHA_BITS=3413,s.DEPTH_BITS=3414,s.STENCIL_BITS=3415,s.POLYGON_OFFSET_UNITS=10752,s.POLYGON_OFFSET_FACTOR=32824,s.TEXTURE_BINDING_2D=32873,s.SAMPLE_BUFFERS=32936,s.SAMPLES=32937,s.SAMPLE_COVERAGE_VALUE=32938,s.SAMPLE_COVERAGE_INVERT=32939,s.NUM_COMPRESSED_TEXTURE_FORMATS=34466,s.COMPRESSED_TEXTURE_FORMATS=34467,s.DONT_CARE=4352,s.FASTEST=4353,s.NICEST=4354,s.GENERATE_MIPMAP_HINT=33170,s.BYTE=5120,s.UNSIGNED_BYTE=5121,s.SHORT=5122,s.UNSIGNED_SHORT=5123,s.INT=5124,s.UNSIGNED_INT=5125,s.FLOAT=5126,s.DEPTH_COMPONENT=6402,s.ALPHA=6406,s.RGB=6407,s.RGBA=6408,s.LUMINANCE=6409,s.LUMINANCE_ALPHA=6410,s.UNSIGNED_SHORT_4_4_4_4=32819,s.UNSIGNED_SHORT_5_5_5_1=32820,s.UNSIGNED_SHORT_5_6_5=33635,s.FRAGMENT_SHADER=35632,s.VERTEX_SHADER=35633,s.MAX_VERTEX_ATTRIBS=34921,s.MAX_VERTEX_UNIFORM_VECTORS=36347,s.MAX_VARYING_VECTORS=36348,s.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,s.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,s.MAX_TEXTURE_IMAGE_UNITS=34930,s.MAX_FRAGMENT_UNIFORM_VECTORS=36349,s.SHADER_TYPE=35663,s.DELETE_STATUS=35712,s.LINK_STATUS=35714,s.VALIDATE_STATUS=35715,s.ATTACHED_SHADERS=35717,s.ACTIVE_UNIFORMS=35718,s.ACTIVE_ATTRIBUTES=35721,s.SHADING_LANGUAGE_VERSION=35724,s.CURRENT_PROGRAM=35725,s.NEVER=512,s.LESS=513,s.EQUAL=514,s.LEQUAL=515,s.GREATER=516,s.NOTEQUAL=517,s.GEQUAL=518,s.ALWAYS=519,s.KEEP=7680,s.REPLACE=7681,s.INCR=7682,s.DECR=7683,s.INVERT=5386,s.INCR_WRAP=34055,s.DECR_WRAP=34056,s.VENDOR=7936,s.RENDERER=7937,s.VERSION=7938,s.NEAREST=9728,s.LINEAR=9729,s.NEAREST_MIPMAP_NEAREST=9984,s.LINEAR_MIPMAP_NEAREST=9985,s.NEAREST_MIPMAP_LINEAR=9986,s.LINEAR_MIPMAP_LINEAR=9987,s.TEXTURE_MAG_FILTER=10240,s.TEXTURE_MIN_FILTER=10241,s.TEXTURE_WRAP_S=10242,s.TEXTURE_WRAP_T=10243,s.TEXTURE_2D=3553,s.TEXTURE_3D=32879,s.TEXTURE=5890,s.TEXTURE_CUBE_MAP=34067,s.TEXTURE_BINDING_CUBE_MAP=34068,s.TEXTURE_CUBE_MAP_POSITIVE_X=34069,s.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,s.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,s.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,s.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,s.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,s.MAX_CUBE_MAP_TEXTURE_SIZE=34076,s.TEXTURE0=33984,s.TEXTURE1=33985,s.TEXTURE2=33986,s.TEXTURE3=33987,s.TEXTURE4=33988,s.TEXTURE5=33989,s.TEXTURE6=33990,s.TEXTURE7=33991,s.TEXTURE8=33992,s.TEXTURE9=33993,s.TEXTURE10=33994,s.TEXTURE11=33995,s.TEXTURE12=33996,s.TEXTURE13=33997,s.TEXTURE14=33998,s.TEXTURE15=33999,s.TEXTURE16=34e3,s.TEXTURE17=34001,s.TEXTURE18=34002,s.TEXTURE19=34003,s.TEXTURE20=34004,s.TEXTURE21=34005,s.TEXTURE22=34006,s.TEXTURE23=34007,s.TEXTURE24=34008,s.TEXTURE25=34009,s.TEXTURE26=34010,s.TEXTURE27=34011,s.TEXTURE28=34012,s.TEXTURE29=34013,s.TEXTURE30=34014,s.TEXTURE31=34015,s.ACTIVE_TEXTURE=34016,s.REPEAT=10497,s.CLAMP_TO_EDGE=33071,s.MIRRORED_REPEAT=33648,s.FLOAT_VEC2=35664,s.FLOAT_VEC3=35665,s.FLOAT_VEC4=35666,s.INT_VEC2=35667,s.INT_VEC3=35668,s.INT_VEC4=35669,s.BOOL=35670,s.BOOL_VEC2=35671,s.BOOL_VEC3=35672,s.BOOL_VEC4=35673,s.FLOAT_MAT2=35674,s.FLOAT_MAT3=35675,s.FLOAT_MAT4=35676,s.SAMPLER_2D=35678,s.SAMPLER_CUBE=35680,s.VERTEX_ATTRIB_ARRAY_ENABLED=34338,s.VERTEX_ATTRIB_ARRAY_SIZE=34339,s.VERTEX_ATTRIB_ARRAY_STRIDE=34340,s.VERTEX_ATTRIB_ARRAY_TYPE=34341,s.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,s.VERTEX_ATTRIB_ARRAY_POINTER=34373,s.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,s.COMPILE_STATUS=35713,s.LOW_FLOAT=36336,s.MEDIUM_FLOAT=36337,s.HIGH_FLOAT=36338,s.LOW_INT=36339,s.MEDIUM_INT=36340,s.HIGH_INT=36341,s.FRAMEBUFFER=36160,s.RENDERBUFFER=36161,s.RGBA4=32854,s.RGB5_A1=32855,s.RGB565=36194,s.DEPTH_COMPONENT16=33189,s.STENCIL_INDEX=6401,s.STENCIL_INDEX8=36168,s.DEPTH_STENCIL=34041,s.RENDERBUFFER_WIDTH=36162,s.RENDERBUFFER_HEIGHT=36163,s.RENDERBUFFER_INTERNAL_FORMAT=36164,s.RENDERBUFFER_RED_SIZE=36176,s.RENDERBUFFER_GREEN_SIZE=36177,s.RENDERBUFFER_BLUE_SIZE=36178,s.RENDERBUFFER_ALPHA_SIZE=36179,s.RENDERBUFFER_DEPTH_SIZE=36180,s.RENDERBUFFER_STENCIL_SIZE=36181,s.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,s.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,s.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,s.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,s.COLOR_ATTACHMENT0=36064,s.DEPTH_ATTACHMENT=36096,s.STENCIL_ATTACHMENT=36128,s.DEPTH_STENCIL_ATTACHMENT=33306,s.NONE=0,s.FRAMEBUFFER_COMPLETE=36053,s.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,s.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,s.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,s.FRAMEBUFFER_UNSUPPORTED=36061,s.FRAMEBUFFER_BINDING=36006,s.RENDERBUFFER_BINDING=36007,s.MAX_RENDERBUFFER_SIZE=34024,s.INVALID_FRAMEBUFFER_OPERATION=1286,s.UNPACK_FLIP_Y_WEBGL=37440,s.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,s.CONTEXT_LOST_WEBGL=37442,s.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,s.BROWSER_DEFAULT_WEBGL=37444,s._extTextureFilterAnisotropic=null,s._compressedTextureS3tc=null,s._compressedTexturePvrtc=null,s._compressedTextureEtc1=null,s._angleInstancedArrays=null,s._glTextureIDs=[33984,33985,33986,33987,33988,33989,33990,33991],s._useProgram=null,s._depthTest=!0,s._depthMask=!0,s._depthFunc=513,s._blend=!1,s._sFactor=1,s._dFactor=0,s._srcAlpha=1,s._dstAlpha=0,s._cullFace=!1,s._frontFace=2305,s._activedTextureID=33984,E(s,["_extentionVendorPrefixes",function(){return this._extentionVendorPrefixes=["","WEBKIT_","MOZ_"]},"_activeTextures",function(){return this._activeTextures=new Array(8)}]),s}(),K=function(){function t(){}return I(t,"laya.d3.loaders.MeshReader"),t.read=function(t,e,i){var n=new Ce(t);n.pos=0;var r=n.readUTFString();switch(r){case"LAYAMODEL:0301":case"LAYAMODEL:0400":case"LAYAMODEL:0401":pi.parse(n,r,e,i);break;case"LAYAMODEL:05":case"LAYAMODEL:COMPRESSION_05":fi.parse(n,r,e,i);break;default:throw new Error("MeshReader: unknown mesh version.")}e._setSubMeshes(i)},t}(),q=function(){function t(){this.char="",this.tex=null,this.deleted=!1,this.pos=0,this.width=0,this.height=0,this.bmpWidth=0,this.bmpHeight=0,this.orix=0,this.oriy=0,this.touchTick=0,this.isSpace=!1,this.uv=new Array(8)}return I(t,"laya.webgl.text.CharRenderInfo"),t.prototype.touch=function(){var t=$i.loopCount;this.touchTick!=t&&this.tex.touchRect(this,t),this.touchTick=t},t}(),Q=function(){function r(){}return I(r,"laya.webgl.utils.RenderState2D"),r.mat2MatArray=function(t,e){var i=t,n=e;return n[0]=i.a,n[1]=i.b,n[2]=r.EMPTYMAT4_ARRAY[2],n[3]=r.EMPTYMAT4_ARRAY[3],n[4]=i.c,n[5]=i.d,n[6]=r.EMPTYMAT4_ARRAY[6],n[7]=r.EMPTYMAT4_ARRAY[7],n[8]=r.EMPTYMAT4_ARRAY[8],n[9]=r.EMPTYMAT4_ARRAY[9],n[10]=r.EMPTYMAT4_ARRAY[10],n[11]=r.EMPTYMAT4_ARRAY[11],n[12]=i.tx,n[13]=i.ty,n[14]=r.EMPTYMAT4_ARRAY[14],n[15]=r.EMPTYMAT4_ARRAY[15],e},r.restoreTempArray=function(){r.TEMPMAT4_ARRAY[0]=1,r.TEMPMAT4_ARRAY[1]=0,r.TEMPMAT4_ARRAY[4]=0,r.TEMPMAT4_ARRAY[5]=1,r.TEMPMAT4_ARRAY[12]=0,r.TEMPMAT4_ARRAY[13]=0},r.clear=function(){r.worldScissorTest=!1,r.worldAlpha=1},r._MAXSIZE=99999999,r.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r.worldMatrix4=r.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r.matWVP=null,r.worldAlpha=1,r.worldScissorTest=!1,r.worldShaderDefines=null,r.worldFilters=null,r.width=0,r.height=0,E(r,["worldMatrix",function(){return this.worldMatrix=new It}]),r}(),$=function(){function t(){this._sp=null,this._one=null,this._cmds=null,this._vectorgraphArray=null,this._graphicBounds=null,this.autoDestroy=!1,this._render=this._renderEmpty,this._createData()}I(t,"laya.display.Graphics");var e=t.prototype;return e._createData=function(){},e._clearData=function(){},e._destroyData=function(){},e.destroy=function(){this.clear(!0),this._graphicBounds&&this._graphicBounds.destroy(),this._graphicBounds=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0,this._sp._setRenderType(0),this._sp=null),this._destroyData()},e.clear=function(t){if(void 0===t&&(t=!0),t){var e=this._one;if(this._cmds){var i=0,n=this._cmds.length;for(i=0;i<n;i++)(e=this._cmds[i]).recover();this._cmds.length=0}else e&&e.recover()}else this._cmds=null;if(this._one=null,this._render=this._renderEmpty,this._clearData(),this._sp&&(this._sp._renderType&=-513,this._sp._setRenderType(this._sp._renderType)),this._repaint(),this._vectorgraphArray){for(i=0,n=this._vectorgraphArray.length;i<n;i++)pt.getInstance().deleteShape(this._vectorgraphArray[i]);this._vectorgraphArray.length=0}},e._clearBoundsCache=function(){this._graphicBounds&&this._graphicBounds.reset()},e._initGraphicBounds=function(){this._graphicBounds||(this._graphicBounds=ni.create(),this._graphicBounds._graphics=this)},e._repaint=function(){this._clearBoundsCache(),this._sp&&this._sp.repaint()},e._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},e.getBounds=function(t){return void 0===t&&(t=!1),this._initGraphicBounds(),this._graphicBounds.getBounds(t)},e.getBoundPoints=function(t){return void 0===t&&(t=!1),this._initGraphicBounds(),this._graphicBounds.getBoundPoints(t)},e.drawImage=function(t,e,i,n,r){if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),!t)return null;if(n||(n=t.sourceWidth),r||(r=t.sourceHeight),t.getIsReady()){var s=n/t.sourceWidth,a=r/t.sourceHeight;if(n=t.width*s,r=t.height*a,n<=0||r<=0)return null;e+=t.offsetX*s,i+=t.offsetY*a}this._sp&&(this._sp._renderType|=512,this._sp._setRenderType(this._sp._renderType));var o=tt.create.call(this,t,e,i,n,r);return null==this._one?(this._one=o,this._render=this._renderOneImg):this._saveToCmd(null,o),this._repaint(),o},e.drawTexture=function(t,e,i,n,r,s,a,o,h){if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=1),!t||a<.01)return null;if(!t.getIsReady())return null;if(n||(n=t.sourceWidth),r||(r=t.sourceHeight),t.getIsReady()){var l=n/t.sourceWidth,u=r/t.sourceHeight;if(n=t.width*l,r=t.height*u,n<=0||r<=0)return null;e+=t.offsetX*l,i+=t.offsetY*u}this._sp&&(this._sp._renderType|=512,this._sp._setRenderType(this._sp._renderType));var c=He.create.call(this,t,e,i,n,r,s,a,o,h);return this._repaint(),this._saveToCmd(null,c)},e.drawTextures=function(t,e){return t?this._saveToCmd(qi._context.drawTextures,St.create.call(this,t,e)):null},e.drawTriangles=function(t,e,i,n,r,s,a,o,h,l){return void 0===o&&(o=1),this._saveToCmd(qi._context.drawTriangles,Rn.create.call(this,t,e,i,n,r,s,a,o,h,l))},e.fillTexture=function(t,e,i,n,r,s,a){return void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s="repeat"),t&&t.getIsReady()?this._saveToCmd(qi._context._fillTexture,Et.create.call(this,t,e,i,n,r,s,a||R.EMPTY,{})):null},e._saveToCmd=function(t,e){return this._sp&&(this._sp._renderType|=512,this._sp._setRenderType(this._sp._renderType)),null==this._one?(this._one=e,this._render=this._renderOne):(this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(e)),this._repaint(),e},e.clipRect=function(t,e,i,n){return this._saveToCmd(qi._context.clipRect,v.create.call(this,t,e,i,n))},e.fillText=function(t,e,i,n,r,s){return this._saveToCmd(qi._context.fillText,xi.create.call(this,t,e,i,n||Os.defaultFontStr(),r,s))},e.fillBorderText=function(t,e,i,n,r,s,a,o){return this._saveToCmd(qi._context.fillBorderText,Ze.create.call(this,t,e,i,n||Os.defaultFontStr(),r,s,a,o))},e.fillWords=function(t,e,i,n,r){return this._saveToCmd(qi._context.fillWords,Be.create.call(this,t,e,i,n||Os.defaultFontStr(),r))},e.fillBorderWords=function(t,e,i,n,r,s,a){return this._saveToCmd(qi._context.fillBorderWords,Di.create.call(this,t,e,i,n||Os.defaultFontStr(),r,s,a))},e.strokeText=function(t,e,i,n,r,s,a){return this._saveToCmd(qi._context.fillBorderText,me.create.call(this,t,e,i,n||Os.defaultFontStr(),null,r,s,a))},e.alpha=function(t){return this._saveToCmd(qi._context.alpha,Xe.create.call(this,t))},e.transform=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=0),this._saveToCmd(qi._context._transform,Ve.create.call(this,t,e,i))},e.rotate=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=0),this._saveToCmd(qi._context._rotate,S.create.call(this,t,e,i))},e.scale=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),this._saveToCmd(qi._context._scale,ze.create.call(this,t,e,i,n))},e.translate=function(t,e){return this._saveToCmd(qi._context.translate,zi.create.call(this,t,e))},e.save=function(){return this._saveToCmd(qi._context._save,Y.create.call(this))},e.restore=function(){return this._saveToCmd(qi._context.restore,at.create.call(this))},e.replaceText=function(t){this._repaint();var e=this._cmds;if(e){for(var i=e.length-1;-1<i;i--)if(this._isTextCmd(e[i]))return e[i].text=t,!0}else if(this._one&&this._isTextCmd(this._one))return this._one.text=t,!0;return!1},e._isTextCmd=function(t){var e=t.cmdID;return"FillText"==e||"StrokeText"==e||"FillBorderText"==e},e.replaceTextColor=function(t){this._repaint();var e=this._cmds;if(e)for(var i=e.length-1;-1<i;i--)this._isTextCmd(e[i])&&this._setTextCmdColor(e[i],t);else this._one&&this._isTextCmd(this._one)&&this._setTextCmdColor(this._one,t)},e._setTextCmdColor=function(t,e){switch(t.cmdID){case"FillText":case"StrokeText":t.color=e;break;case"FillBorderText":case"FillBorderWords":case"FillBorderText":t.fillColor=e}},e.loadImage=function(t,e,i,n,r,s){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0);var a=Hn.getRes(t);a?a.getIsReady()?this.drawImage(a,e,i,n,r):a.once("ready",this,this.drawImage,[a,e,i,n,r]):((a=new xr).load(t),Hn.cacheRes(t,a),a.once("ready",this,this.drawImage,[a,e,i,n,r])),null!=s&&(a.getIsReady()?s.call(this._sp):a.on("ready",this._sp,s))},e._renderEmpty=function(t,e,i,n){},e._renderAll=function(t,e,i,n){for(var r=this._cmds,s=0,a=r.length;s<a;s++)r[s].run(e,i,n)},e._renderOne=function(t,e,i,n){e.sprite=t,this._one.run(e,i,n)},e._renderOneImg=function(t,e,i,n){e.sprite=t,this._one.run(e,i,n)},e.drawLine=function(t,e,i,n,r,s){void 0===s&&(s=1);var a=s<1||s%2==0?0:.5;return this._saveToCmd(qi._context._drawLine,ft.create.call(this,t+a,e+a,i+a,n+a,r,s,0))},e.drawLines=function(t,e,i,n,r){if(void 0===r&&(r=1),!i||i.length<4)return null;var s=r<1||r%2==0?0:.5;return this._saveToCmd(qi._context._drawLines,sn.create.call(this,t+s,e+s,i,n,r,0))},e.drawCurves=function(t,e,i,n,r){return void 0===r&&(r=1),this._saveToCmd(qi._context.drawCurves,Ge.create.call(this,t,e,i,n,r))},e.drawRect=function(t,e,i,n,r,s,a){void 0===a&&(a=1);var o=1<=a&&s?a/2:0,h=s?a:0;return this._saveToCmd(qi._context.drawRect,et.create.call(this,t+o,e+o,i-h,n-h,r,s,a))},e.drawCircle=function(t,e,i,n,r,s){void 0===s&&(s=1);var a=1<=s&&r?s/2:0;return this._saveToCmd(qi._context._drawCircle,Z.create.call(this,t,e,i-a,n,r,s,0))},e.drawPie=function(t,e,i,n,r,s,a,o){void 0===o&&(o=1);var h=1<=o&&a?o/2:0,l=a?o:0;return this._saveToCmd(qi._context._drawPie,U.create.call(this,t+h,e+h,i-l,nt.toRadian(n),nt.toRadian(r),s,a,o,0))},e.drawPoly=function(t,e,i,n,r,s){void 0===s&&(s=1);var a=!1;a=!(6<i.length);var o=1<=s&&r?s%2==0?0:.5:0;return this._saveToCmd(qi._context._drawPoly,C.create.call(this,t+o,e+o,i,n,r,s,a,0))},e.drawPath=function(t,e,i,n,r){return this._saveToCmd(qi._context._drawPath,qt.create.call(this,t,e,i,n,r))},e.draw9Grid=function(t,e,i,n,r,s){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),this._saveToCmd(null,ke.create(t,e,i,n,r,s))},g(0,e,"cmds",function(){return this._cmds},function(t){this._sp&&(this._sp._renderType|=512,this._sp._setRenderType(this._sp._renderType)),this._cmds=t,this._render=this._renderAll,this._repaint()}),t}(),J=function(){function e(){this._attatched=!1,this._indexInCompound=-1,this._compoundParent=null,this._attatchedCollisionObject=null,this._referenceCount=0,this.needsCustomCollisionCallback=!1,this._scale=new ln(1,1,1),this._centerMatrix=new gt,this._localOffset=new ln(0,0,0),this._localRotation=new Qt(0,0,0,1)}I(e,"laya.d3.physics.shape.ColliderShape");var t=e.prototype;return T.imps(t,{"laya.d3.core.IClone":!0}),t._setScale=function(t){this._compoundParent?this.updateLocalTransformations():(e._nativeScale.setValue(t.x,t.y,t.z),this._nativeShape.setLocalScaling(e._nativeScale))},t._addReference=function(){this._referenceCount++},t._removeReference=function(){this._referenceCount--},t.updateLocalTransformations=function(){if(this._compoundParent){var t=e._tempVector30;ln.multiply(this.localOffset,this._scale,t),e._createAffineTransformation(t,this.localRotation,this._centerMatrix.elements)}else e._createAffineTransformation(this.localOffset,this.localRotation,this._centerMatrix.elements)},t.cloneTo=function(t){var e=t;this._localOffset.cloneTo(e.localOffset),this._localRotation.cloneTo(e.localRotation),e.localOffset=e.localOffset,e.localRotation=e.localRotation},t.clone=function(){return null},t.destroy=function(){this._nativeShape&&(In._physics3D.destroy(this._nativeShape),this._nativeShape=null)},g(0,t,"localRotation",function(){return this._localRotation},function(t){this._localRotation=t,this._compoundParent&&this._compoundParent._updateChildTransform(this)}),g(0,t,"localOffset",function(){return this._localOffset},function(t){this._localOffset=t,this._compoundParent&&this._compoundParent._updateChildTransform(this)}),g(0,t,"type",function(){return this._type}),e._creatShape=function(t){var e;switch(t.type){case"BoxColliderShape":var i=t.size;e=i?new Xn(i[0],i[1],i[2]):new Xn;break;case"SphereColliderShape":e=new sr(t.radius);break;case"CapsuleColliderShape":e=new Gr(t.radius,t.height,t.orientation);break;case"MeshColliderShape":var n=new ar;t.mesh&&(n.mesh=Hn.getRes(t.mesh)),e=n;break;case"ConeColliderShape":e=new Er(t.radius,t.height,t.orientation);break;case"CylinderColliderShape":e=new Sr(t.radius,t.height,t.orientation);break;default:throw"unknown shape type."}if(t.center){var r=e.localOffset;r.fromArray(t.center),e.localOffset=r}return e},e._createAffineTransformation=function(t,e,i){var n=e.x,r=e.y,s=e.z,a=e.w,o=n+n,h=r+r,l=s+s,u=n*o,c=n*h,_=n*l,d=r*h,f=r*l,p=s*l,m=a*o,g=a*h,v=a*l;i[0]=1-(d+p),i[1]=c+v,i[2]=_-g,i[3]=0,i[4]=c-v,i[5]=1-(u+p),i[6]=f+m,i[7]=0,i[8]=_+g,i[9]=f-m,i[10]=1-(u+d),i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1},e.SHAPEORIENTATION_UPX=0,e.SHAPEORIENTATION_UPY=1,e.SHAPEORIENTATION_UPZ=2,e.SHAPETYPES_BOX=0,e.SHAPETYPES_SPHERE=1,e.SHAPETYPES_CYLINDER=2,e.SHAPETYPES_CAPSULE=3,e.SHAPETYPES_CONVEXHULL=4,e.SHAPETYPES_COMPOUND=5,e.SHAPETYPES_STATICPLANE=6,e.SHAPETYPES_CONE=7,E(e,["_tempVector30",function(){return this._tempVector30=new ln},"_nativeScale",function(){return this._nativeScale=new In._physics3D.btVector3(1,1,1)},"_nativeVector30",function(){return this._nativeVector30=new In._physics3D.btVector3(0,0,0)},"_nativQuaternion0",function(){return this._nativQuaternion0=new In._physics3D.btQuaternion(0,0,0,1)},"_nativeTransform0",function(){return this._nativeTransform0=new In._physics3D.btTransform}]),e}(),tt=function(){function a(){}I(a,"laya.display.cmd.DrawImageCmd");var t=a.prototype;return t.recover=function(){this.texture._removeReference(),this.texture=null,p.recover("DrawImageCmd",this)},t.run=function(t,e,i){t.drawTexture(this.texture,this.x+e,this.y+i,this.width,this.height)},g(0,t,"cmdID",function(){return"DrawImage"}),a.create=function(t,e,i,n,r){var s=p.getItemByClass("DrawImageCmd",a);return(s.texture=t)._addReference(),s.x=e,s.y=i,s.width=n,s.height=r,s},a.ID="DrawImage",a}(),et=function(){function h(){}I(h,"laya.display.cmd.DrawRectCmd");var t=h.prototype;return t.recover=function(){this.fillColor=null,this.lineColor=null,p.recover("DrawRectCmd",this)},t.run=function(t,e,i){t.drawRect(this.x+e,this.y+i,this.width,this.height,this.fillColor,this.lineColor,this.lineWidth)},g(0,t,"cmdID",function(){return"DrawRect"}),h.create=function(t,e,i,n,r,s,a){var o=p.getItemByClass("DrawRectCmd",h);return o.x=t,o.y=e,o.width=i,o.height=n,o.fillColor=r,o.lineColor=s,o.lineWidth=a,o},h.ID="DrawRect",h}(),it=function(){function t(t,e,i){this.i=null,this.x=null,this.y=null,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=null,this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return I(t,"laya.webgl.shapes.EarcutNode"),t}(),nt=function(){function o(){}return I(o,"laya.utils.Utils"),o.toRadian=function(t){return t*o._pi2},o.toAngle=function(t){return t*o._pi},o.toHexColor=function(t){if(t<0||isNaN(t))return null;for(var e=t.toString(16);e.length<6;)e="0"+e;return"#"+e},o.getGID=function(){return o._gid++},o.concatArray=function(t,e){if(!e)return t;if(!t)return e;var i=0,n=e.length;for(i=0;i<n;i++)t.push(e[i]);return t},o.clearArray=function(t){return t&&(t.length=0),t},o.copyArray=function(t,e){if(t||(t=[]),!e)return t;t.length=e.length;var i=0,n=e.length;for(i=0;i<n;i++)t[i]=e[i];return t},o.getGlobalRecByPoints=function(t,e,i,n,r){var s,a;s=R.create().setTo(e,i),s=t.localToGlobal(s),a=R.create().setTo(n,r),a=t.localToGlobal(a);var o=ve._getWrapRec([s.x,s.y,a.x,a.y]);return s.recover(),a.recover(),o},o.getGlobalPosAndScale=function(t){return o.getGlobalRecByPoints(t,0,0,1,1)},o.bind=function(t,e){return t.bind(e)},o.measureText=function(t,e){return Ki.measureText(t,e)},o.updateOrder=function(t){if(!t||t.length<2)return!1;for(var e,i=1,n=0,r=t.length,s=NaN;i<r;){for(e=t[n=i],s=t[n]._zOrder;-1<--n&&t[n]._zOrder>s;)t[n+1]=t[n];t[n+1]=e,i++}return!0},o.transPointList=function(t,e,i){var n=0,r=t.length;for(n=0;n<r;n+=2)t[n]+=e,t[n+1]+=i},o.parseInt=function(t,e){void 0===e&&(e=0);var i=Vt.window.parseInt(t,e);return isNaN(i)?0:i},o.getFileExtension=function(t){o._extReg.lastIndex=t.lastIndexOf(".");var e=o._extReg.exec(t);return e&&1<e.length?e[1].toLowerCase():null},o.getTransformRelativeToWindow=function(t,e,i){var n=T.stage,r=laya.utils.Utils.getGlobalPosAndScale(t),s=n._canvasTransform.clone(),a=s.tx,o=s.ty;s.rotate(-Math.PI/180*T.stage.canvasDegree),s.scale(T.stage.clientScaleX,T.stage.clientScaleY);var h=T.stage.canvasDegree%180!=0,l=NaN,u=NaN;h?(l=i+r.y,u=e+r.x,l*=s.d,u*=s.a,90==T.stage.canvasDegree?(l=a-l,u+=o):(l+=a,u=o-u)):(l=e+r.x,u=i+r.y,l*=s.a,u*=s.d,l+=a,u+=o),u+=T.stage._safariOffsetY;var c=NaN,_=NaN;return _=h?(c=s.d*r.height,s.a*r.width):(c=s.a*r.width,s.d*r.height),{x:l,y:u,scaleX:c,scaleY:_}},o.fitDOMElementInArea=function(t,e,i,n,r,s){t._fitLayaAirInitialized||(t._fitLayaAirInitialized=!0,t.style.transformOrigin=t.style.webKittransformOrigin="left top",t.style.position="absolute");var a=o.getTransformRelativeToWindow(e,i,n);t.style.transform=t.style.webkitTransform="scale("+a.scaleX+","+a.scaleY+") rotate("+T.stage.canvasDegree+"deg)",t.style.width=r+"px",t.style.height=s+"px",t.style.left=a.x+"px",t.style.top=a.y+"px"},o.isOkTextureList=function(t){if(!t)return!1;var e,i=0,n=t.length;for(i=0;i<n;i++)if(!(e=t[i])||!e._getSource())return!1;return!0},o.isOKCmdList=function(t){if(!t)return!1;var e=0,i=t.length;for(e=0;e<i;e++)t[e];return!0},o.getQueryString=function(t){if(Vt.onMiniGame)return null;if(!m.location||!m.location.search)return null;var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),i=m.location.search.substr(1).match(e);return null!=i?unescape(i[2]):null},o._gid=1,o._pi=180/Math.PI,o._pi2=Math.PI/180,o._extReg=/\.(\w+)\??/g,o.parseXMLFromString=function(t){var e;if(t=t.replace(/>\s+</g,"><"),-1<(e=(new DOMParser).parseFromString(t,"text/xml")).firstChild.textContent.indexOf("This page contains the following errors"))throw new Error(e.firstChild.firstChild.textContent);return e},o}(),Ct=function(){function t(t,e){this._frame=null,this._startFrame=null,this.tiles=null,this.type=0,this.randomRow=!1,this.rowIndex=0,this.cycles=0,this.enableUVChannels=0,this.enable=!1,this.tiles=new un(1,1),this.type=0,this.randomRow=!0,this.rowIndex=0,this.cycles=1,this.enableUVChannels=1,this._frame=t,this._startFrame=e}I(t,"laya.d3.core.particleShuriKen.module.TextureSheetAnimation");var e=t.prototype;return T.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this.tiles.cloneTo(e.tiles),e.type=this.type,e.randomRow=this.randomRow,this._frame.cloneTo(e._frame),this._startFrame.cloneTo(e._startFrame),e.cycles=this.cycles,e.enableUVChannels=this.enableUVChannels,e.enable=this.enable},e.clone=function(){var t,e;switch(this._frame.type){case 0:t=Gi.createByConstant(this._frame.constant);break;case 1:t=Gi.createByOverTime(this._frame.frameOverTimeData.clone());break;case 2:t=Gi.createByRandomTwoConstant(this._frame.constantMin,this._frame.constantMax);break;case 3:t=Gi.createByRandomTwoOverTime(this._frame.frameOverTimeDataMin.clone(),this._frame.frameOverTimeDataMax.clone())}switch(this._startFrame.type){case 0:e=mi.createByConstant(this._startFrame.constant);break;case 1:e=mi.createByRandomTwoConstant(this._startFrame.constantMin,this._startFrame.constantMax)}var i=new this.constructor(t,e);return this.tiles.cloneTo(i.tiles),i.type=this.type,i.randomRow=this.randomRow,i.cycles=this.cycles,i.enableUVChannels=this.enableUVChannels,i.enable=this.enable,i},g(0,e,"startFrame",function(){return this._startFrame}),g(0,e,"frame",function(){return this._frame}),t}(),rt=function(){function t(){}I(t,"laya.events.Event");var e=t.prototype;return e.setTo=function(t,e,i){return this.type=t,this.currentTarget=e,this.target=i,this},e.stopPropagation=function(){this._stoped=!0},g(0,e,"stageY",function(){return T.stage.mouseY}),g(0,e,"stageX",function(){return T.stage.mouseX}),g(0,e,"keyLocation",function(){return this.nativeEvent.location||this.nativeEvent.keyLocation}),g(0,e,"charCode",function(){return this.nativeEvent.charCode}),g(0,e,"shiftKey",function(){return this.nativeEvent.shiftKey}),g(0,e,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),g(0,e,"altKey",function(){return this.nativeEvent.altKey}),g(0,e,"touches",function(){if(!this.nativeEvent)return null;var t=this.nativeEvent.touches;if(t)for(var e=T.stage,i=0,n=t.length;i<n;i++){var r=t[i],s=R.TEMP;s.setTo(r.clientX,r.clientY),e._canvasTransform.invertTransformPoint(s),e.transform.invertTransformPoint(s),r.stageX=s.x,r.stageY=s.y}return t}),t.EMPTY=new t,t.MOUSE_DOWN="mousedown",t.MOUSE_UP="mouseup",t.CLICK="click",t.RIGHT_MOUSE_DOWN="rightmousedown",t.RIGHT_MOUSE_UP="rightmouseup",t.RIGHT_CLICK="rightclick",t.MOUSE_MOVE="mousemove",t.MOUSE_OVER="mouseover",t.MOUSE_OUT="mouseout",t.MOUSE_WHEEL="mousewheel",t.ROLL_OVER="mouseover",t.ROLL_OUT="mouseout",t.DOUBLE_CLICK="doubleclick",t.CHANGE="change",t.CHANGED="changed",t.RESIZE="resize",t.ADDED="added",t.REMOVED="removed",t.DISPLAY="display",t.UNDISPLAY="undisplay",t.ERROR="error",t.COMPLETE="complete",t.LOADED="loaded",t.READY="ready",t.PROGRESS="progress",t.INPUT="input",t.RENDER="render",t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.KEY_DOWN="keydown",t.KEY_PRESS="keypress",t.KEY_UP="keyup",t.FRAME="enterframe",t.DRAG_START="dragstart",t.DRAG_MOVE="dragmove",t.DRAG_END="dragend",t.ENTER="enter",t.SELECT="select",t.BLUR="blur",t.FOCUS="focus",t.VISIBILITY_CHANGE="visibilitychange",t.FOCUS_CHANGE="focuschange",t.PLAYED="played",t.PAUSED="paused",t.STOPPED="stopped",t.START="start",t.END="end",t.COMPONENT_ADDED="componentadded",t.COMPONENT_REMOVED="componentremoved",t.RELEASED="released",t.LINK="link",t.LABEL="label",t.FULL_SCREEN_CHANGE="fullscreenchange",t.DEVICE_LOST="devicelost",t.TRANSFORM_CHANGED="transformchanged",t.ANIMATION_CHANGED="animationchanged",t.TRAIL_FILTER_CHANGE="trailfilterchange",t.TRIGGER_ENTER="triggerenter",t.TRIGGER_STAY="triggerstay",t.TRIGGER_EXIT="triggerexit",t}(),st=function(){function H(){}return I(H,"laya.d3.math.CollisionUtils"),H.distancePlaneToPoint=function(t,e){return ln.dot(t.normal,e)-t.distance},H.distanceBoxToPoint=function(t,e){var i=t.min,n=i.x,r=i.y,s=i.z,a=t.max,o=a.x,h=a.y,l=a.z,u=e.x,c=e.y,_=e.z,d=0;return u<n&&(d+=(n-u)*(n-u)),o<u&&(d+=(o-u)*(o-u)),c<r&&(d+=(r-c)*(r-c)),h<c&&(d+=(h-c)*(h-c)),_<s&&(d+=(s-_)*(s-_)),l<_&&(d+=(l-_)*(l-_)),Math.sqrt(d)},H.distanceBoxToBox=function(t,e){var i=t.min,n=i.x,r=i.y,s=i.z,a=t.max,o=a.x,h=a.y,l=a.z,u=e.min,c=u.x,_=u.y,d=u.z,f=e.max,p=f.x,m=f.y,g=f.z,v=0,T=NaN;return p<n?v+=(T=n-p)*T:o<c&&(v+=(T=c-o)*T),m<r?v+=(T=r-m)*T:h<_&&(v+=(T=_-h)*T),g<s?v+=(T=s-g)*T:l<d&&(v+=(T=d-l)*T),Math.sqrt(v)},H.distanceSphereToPoint=function(t,e){var i=Math.sqrt(ln.distanceSquared(t.center,e));return i-=t.radius,Math.max(i,0)},H.distanceSphereToSphere=function(t,e){var i=Math.sqrt(ln.distanceSquared(t.center,e.center));return i-=t.radius+e.radius,Math.max(i,0)},H.intersectsRayAndTriangleRD=function(t,e,i,n,r){var s=t.origin,a=s.x,o=s.y,h=s.z,l=t.direction,u=l.x,c=l.y,_=l.z,d=e.x,f=e.y,p=e.z,m=i.x,g=i.y,v=i.z,T=n.x,y=n.y,E=n.z,x=H._tempV30.x,S=H._tempV30.y,C=H._tempV30.z;x=m-d,S=g-f,C=v-p;var I=H._tempV31.x,R=H._tempV31.y,A=H._tempV31.z;I=T-d,R=y-f,A=E-p;var M=H._tempV32.x,D=H._tempV32.y,b=H._tempV32.z,w=x*(M=c*A-_*R)+S*(D=_*I-u*A)+C*(b=u*R-c*I);if(k.isZero(w))return 0,!1;var L=1/w,O=H._tempV33.x,N=H._tempV33.y,P=H._tempV33.z,F=(O=a-d)*M+(N=o-f)*D+(P=h-p)*b;if((F*=L)<0||1<F)return 0,!1;var B=H._tempV34.x,V=H._tempV34.y,U=H._tempV34.z,z=u*(B=N*C-P*S)+c*(V=P*x-O*C)+_*(U=O*S-N*x);if((z*=L)<0||1<F+z)return 0,!1;var G=I*B+R*V+A*U;return(G*=L)<0?(0,!1):(G,!0)},H.intersectsRayAndTriangleRP=function(t,e,i,n,r){return H.intersectsRayAndTriangleRD(t,e,i,n,NaN)?(ln.scale(t.direction,NaN,H._tempV30),ln.add(t.origin,H._tempV30,r),!0):(r=ln._ZERO,!1)},H.intersectsRayAndPoint=function(t,e){ln.subtract(t.origin,e,H._tempV30);var i=ln.dot(H._tempV30,t.direction),n=ln.dot(H._tempV30,H._tempV30)-k.zeroTolerance;return!(0<n&&0<i)&&!(i*i-n<0)},H.intersectsRayAndRay=function(t,e,i){var n=t.origin,r=n.x,s=n.y,a=n.z,o=t.direction,h=o.x,l=o.y,u=o.z,c=e.origin,_=c.x,d=c.y,f=c.z,p=e.direction,m=p.x,g=p.y,v=p.z;ln.cross(o,p,H._tempV30);var T=H._tempV30,y=ln.scalarLength(H._tempV30);if(k.isZero(y)&&k.nearEqual(_,r)&&k.nearEqual(d,s)&&k.nearEqual(f,a))return ln._ZERO,!0;y*=y;var E=_-r,x=d-s,S=f-a,C=m,I=g,R=v,A=T.x,M=T.y,D=T.z,b=(E*I*D+x*R*A+S*C*M-E*R*M-x*C*D-S*I*A)/y;I=l,R=u,C=h;ln.scale(o,b,H._tempV30),ln.scale(p,b,H._tempV31),ln.add(n,H._tempV30,H._tempV32),ln.add(c,H._tempV31,H._tempV33);var w=H._tempV32,L=H._tempV33;return k.nearEqual(L.x,w.x)&&k.nearEqual(L.y,w.y)&&k.nearEqual(L.z,w.z)?(H._tempV32,!0):(ln._ZERO,!1)},H.intersectsPlaneAndTriangle=function(t,e,i,n){var r=H.intersectsPlaneAndPoint(t,e),s=H.intersectsPlaneAndPoint(t,i),a=H.intersectsPlaneAndPoint(t,n);return r==Pt.PlaneIntersectionType_Front&&s==Pt.PlaneIntersectionType_Front&&a==Pt.PlaneIntersectionType_Front?Pt.PlaneIntersectionType_Front:r==Pt.PlaneIntersectionType_Back&&s==Pt.PlaneIntersectionType_Back&&a==Pt.PlaneIntersectionType_Back?Pt.PlaneIntersectionType_Back:Pt.PlaneIntersectionType_Intersecting},H.intersectsRayAndPlaneRD=function(t,e,i){var n=e.normal,r=ln.dot(n,t.direction);if(k.isZero(r))return 0,!1;var s=ln.dot(n,t.origin);return!((-e.distance-s)/r<0)||(0,!1)},H.intersectsRayAndPlaneRP=function(t,e,i){return H.intersectsRayAndPlaneRD(t,e,NaN)?(ln.scale(t.direction,NaN,H._tempV30),ln.add(t.origin,H._tempV30,H._tempV31),H._tempV31,!0):(ln._ZERO,!1)},H.intersectsRayAndBoxRD=function(t,e){var i=t.origin,n=i.x,r=i.y,s=i.z,a=t.direction,o=a.x,h=a.y,l=a.z,u=e.min,c=u.x,_=u.y,d=u.z,f=e.max,p=f.x,m=f.y,g=f.z,v=0,T=k.MaxValue;if(k.isZero(o)){if(n<c||p<n)return-1}else{var y=1/o,E=(c-n)*y,x=(p-n)*y;if(x<E){var S=E;E=x,x=S}if(v=Math.max(E,v),(T=Math.min(x,T))<v)return-1}if(k.isZero(h)){if(r<_||m<r)return-1}else{var C=1/h,I=(_-r)*C,R=(m-r)*C;if(R<I){var A=I;I=R,R=A}if(v=Math.max(I,v),(T=Math.min(R,T))<v)return-1}if(k.isZero(l)){if(s<d||g<s)return-1}else{var M=1/l,D=(d-s)*M,b=(g-s)*M;if(b<D){var w=D;D=b,b=w}if(v=Math.max(D,v),(T=Math.min(b,T))<v)return-1}return v},H.intersectsRayAndBoxRP=function(t,e,i){var n=H.intersectsRayAndBoxRD(t,e);return-1===n?ln._ZERO.cloneTo(i):(ln.scale(t.direction,n,H._tempV30),ln.add(t.origin,H._tempV30,H._tempV31),H._tempV31.cloneTo(i)),n},H.intersectsRayAndSphereRD=function(t,e){var i=e.radius;ln.subtract(t.origin,e.center,H._tempV30);var n=ln.dot(H._tempV30,t.direction),r=ln.dot(H._tempV30,H._tempV30)-i*i;if(0<r&&0<n)return-1;var s=n*n-r;if(s<0)return-1;var a=-n-Math.sqrt(s);return a<0&&(a=0),a},H.intersectsRayAndSphereRP=function(t,e,i){var n=H.intersectsRayAndSphereRD(t,e);return-1===n?ln._ZERO.cloneTo(i):(ln.scale(t.direction,n,H._tempV30),ln.add(t.origin,H._tempV30,H._tempV31),H._tempV31.cloneTo(i)),n},H.intersectsSphereAndTriangle=function(t,e,i,n){var r=t.center,s=t.radius;return H.closestPointPointTriangle(r,e,i,n,H._tempV30),ln.subtract(H._tempV30,r,H._tempV31),ln.dot(H._tempV31,H._tempV31)<=s*s},H.intersectsPlaneAndPoint=function(t,e){var i=ln.dot(t.normal,e)+t.distance;return 0<i?Pt.PlaneIntersectionType_Front:i<0?Pt.PlaneIntersectionType_Back:Pt.PlaneIntersectionType_Intersecting},H.intersectsPlaneAndPlane=function(t,e){ln.cross(t.normal,e.normal,H._tempV30);var i=ln.dot(H._tempV30,H._tempV30);return!k.isZero(i)},H.intersectsPlaneAndPlaneRL=function(t,e,i){var n=t.normal,r=e.normal;ln.cross(n,r,H._tempV34);var s=ln.dot(H._tempV34,H._tempV34);return!k.isZero(s)&&(ln.scale(r,t.distance,H._tempV30),ln.scale(n,e.distance,H._tempV31),ln.subtract(H._tempV30,H._tempV31,H._tempV32),ln.cross(H._tempV32,H._tempV34,H._tempV33),ln.normalize(H._tempV34,H._tempV34),new Re(H._tempV33,H._tempV34),!0)},H.intersectsPlaneAndBox=function(t,e){var i=t.distance,n=t.normal,r=n.x,s=n.y,a=n.z,o=e.min,h=o.x,l=o.y,u=o.z,c=e.max,_=c.x,d=c.y,f=c.z;H._tempV30.x=0<r?h:_,H._tempV30.y=0<s?l:d,H._tempV30.z=0<a?u:f,H._tempV31.x=0<r?_:h,H._tempV31.y=0<s?d:l,H._tempV31.z=0<a?f:u;var p=ln.dot(n,H._tempV30);return 0<p+i?Pt.PlaneIntersectionType_Front:(p=ln.dot(n,H._tempV31))+i<0?Pt.PlaneIntersectionType_Back:Pt.PlaneIntersectionType_Intersecting},H.intersectsPlaneAndSphere=function(t,e){var i=e.radius,n=ln.dot(t.normal,e.center)+t.distance;return i<n?Pt.PlaneIntersectionType_Front:n<-i?Pt.PlaneIntersectionType_Back:Pt.PlaneIntersectionType_Intersecting},H.intersectsBoxAndBox=function(t,e){var i=t.min,n=t.max,r=e.min,s=e.max;return!(i.x>s.x||r.x>n.x)&&(!(i.y>s.y||r.y>n.y)&&!(i.z>s.z||r.z>n.z))},H.intersectsBoxAndSphere=function(t,e){var i=e.center,n=e.radius;return ln.Clamp(i,t.min,t.max,H._tempV30),ln.distanceSquared(i,H._tempV30)<=n*n},H.intersectsSphereAndSphere=function(t,e){var i=t.radius+e.radius;return ln.distanceSquared(t.center,e.center)<=i*i},H.boxContainsPoint=function(t,e){var i=t.min,n=t.max;return i.x<=e.x&&n.x>=e.x&&i.y<=e.y&&n.y>=e.y&&i.z<=e.z&&n.z>=e.z?1:0},H.boxContainsBox=function(t,e){var i=t.min,n=i.x,r=i.y,s=i.z,a=t.max,o=a.x,h=a.y,l=a.z,u=e.min,c=u.x,_=u.y,d=u.z,f=e.max,p=f.x,m=f.y,g=f.z;return o<c||p<n?0:h<_||m<r?0:l<d||g<s?0:n<=c&&p<=o&&r<=_&&m<=h&&s<=d&&g<=l?1:2},H.boxContainsSphere=function(t,e){var i=t.min,n=i.x,r=i.y,s=i.z,a=t.max,o=a.x,h=a.y,l=a.z,u=e.center,c=u.x,_=u.y,d=u.z,f=e.radius;return ln.Clamp(u,i,a,H._tempV30),f*f<ln.distanceSquared(u,H._tempV30)?0:n+f<=c&&c<=o-f&&f<o-n&&r+f<=_&&_<=h-f&&f<h-r&&s+f<=d&&d<=l-f&&f<l-s?1:2},H.sphereContainsPoint=function(t,e){return ln.distanceSquared(e,t.center)<=t.radius*t.radius?1:0},H.sphereContainsTriangle=function(t,e,i,n){var r=H.sphereContainsPoint(t,e),s=H.sphereContainsPoint(t,i),a=H.sphereContainsPoint(t,n);return 1==r&&1==s&&1==a?1:H.intersectsSphereAndTriangle(t,e,i,n)?2:0},H.sphereContainsBox=function(t,e){var i=t.center,n=i.x,r=i.y,s=i.z,a=t.radius,o=e.min,h=o.x,l=o.y,u=o.z,c=e.max,_=c.x,d=c.y,f=c.z,p=H._tempV30;p.x,p.y,p.z;if(!H.intersectsBoxAndSphere(e,t))return 0;var m=a*a;return n-h,r-d,s-f,ln.scalarLengthSquared(H._tempV30)>m?2:(n-_,r-d,s-f,ln.scalarLengthSquared(H._tempV30)>m?2:(n-_,r-l,s-f,ln.scalarLengthSquared(H._tempV30)>m?2:(n-h,r-l,s-f,ln.scalarLengthSquared(H._tempV30)>m?2:(n-h,r-d,s-u,ln.scalarLengthSquared(H._tempV30)>m?2:(n-_,r-d,s-u,ln.scalarLengthSquared(H._tempV30)>m?2:(n-_,r-l,s-u,ln.scalarLengthSquared(H._tempV30)>m?2:(n-h,r-l,s-u,ln.scalarLengthSquared(H._tempV30)>m?2:1)))))))},H.sphereContainsSphere=function(t,e){var i=t.radius,n=e.radius,r=ln.distance(t.center,e.center);return i+n<r?0:i-n<r?2:1},H.closestPointPointTriangle=function(t,e,i,n,r){ln.subtract(i,e,H._tempV30),ln.subtract(n,e,H._tempV31),ln.subtract(t,e,H._tempV32),ln.subtract(t,i,H._tempV33),ln.subtract(t,n,H._tempV34);var s=ln.dot(H._tempV30,H._tempV32),a=ln.dot(H._tempV31,H._tempV32),o=ln.dot(H._tempV30,H._tempV33),h=ln.dot(H._tempV31,H._tempV33),l=ln.dot(H._tempV30,H._tempV34),u=ln.dot(H._tempV31,H._tempV34);if(s<=0&&a<=0)e.cloneTo(r);else if(0<=o&&h<=o)i.cloneTo(r);else{var c=s*h-o*a;if(c<=0&&0<=s&&o<=0){var _=s/(s-o);return ln.scale(H._tempV30,_,r),void ln.add(e,r,r)}if(0<=u&&l<=u)n.cloneTo(r);else{var d=l*a-s*u;if(d<=0&&0<=a&&u<=0){var f=a/(a-u);return ln.scale(H._tempV31,f,r),void ln.add(e,r,r)}var p=o*u-l*h;if(p<=0&&0<=h-o&&0<=l-u){var m=(h-o)/(h-o+(l-u));return ln.subtract(n,i,r),ln.scale(r,m,r),void ln.add(i,r,r)}var g=1/(p+d+c),v=d*g,T=c*g;ln.scale(H._tempV30,v,H._tempV35),ln.scale(H._tempV31,T,H._tempV36),ln.add(H._tempV35,H._tempV36,r),ln.add(e,r,r)}}},H.closestPointPlanePoint=function(t,e,i){var n=t.normal,r=ln.dot(n,e)-t.distance;ln.scale(n,r,H._tempV30),ln.subtract(e,H._tempV30,i)},H.closestPointBoxPoint=function(t,e,i){ln.max(e,t.min,H._tempV30),ln.min(H._tempV30,t.max,i)},H.closestPointSpherePoint=function(t,e,i){var n=t.center;ln.subtract(e,n,i),ln.normalize(i,i),ln.scale(i,t.radius,i),ln.add(i,n,i)},H.closestPointSphereSphere=function(t,e,i){var n=t.center;ln.subtract(e.center,n,i),ln.normalize(i,i),ln.scale(i,t.radius,i),ln.add(i,n,i)},E(H,["_tempV30",function(){return this._tempV30=new ln},"_tempV31",function(){return this._tempV31=new ln},"_tempV32",function(){return this._tempV32=new ln},"_tempV33",function(){return this._tempV33=new ln},"_tempV34",function(){return this._tempV34=new ln},"_tempV35",function(){return this._tempV35=new ln},"_tempV36",function(){return this._tempV36=new ln}]),H}(),at=function(){function t(){}I(t,"laya.display.cmd.RestoreCmd");var e=t.prototype;return e.recover=function(){p.recover("RestoreCmd",this)},e.run=function(t,e,i){t.restore()},g(0,e,"cmdID",function(){return"Restore"}),t.create=function(){return p.getItemByClass("RestoreCmd",t)},t.ID="Restore",t}(),ot=function(){function t(){this.reset()}I(t,"laya.display.css.SpriteStyle");var e=t.prototype;return e.reset=function(){return this.scaleX=this.scaleY=1,this.skewX=this.skewY=0,this.pivotX=this.pivotY=this.rotation=0,this.alpha=1,this.scrollRect&&this.scrollRect.recover(),this.scrollRect=null,this.viewport&&this.viewport.recover(),this.viewport=null,this.hitArea=null,this.dragging=null,this.blendMode=null,this},e.recover=function(){this!==t.EMPTY&&p.recover("SpriteStyle",this.reset())},t.create=function(){return p.getItemByClass("SpriteStyle",t)},t.EMPTY=new t,t}(),ht=function(){function h(){var t=this.elements=new Float32Array(9);t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1}I(h,"laya.d3.math.Matrix3x3");var t=h.prototype;return T.imps(t,{"laya.d3.core.IClone":!0}),t.determinant=function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],h=t[7],l=t[8];return e*(l*s-a*h)+i*(-l*r+a*o)+n*(h*r-s*o)},t.translate=function(t,e){var i=e.elements,n=this.elements,r=n[0],s=n[1],a=n[2],o=n[3],h=n[4],l=n[5],u=n[6],c=n[7],_=n[8],d=t.x,f=t.y;i[0]=r,i[1]=s,i[2]=a,i[3]=o,i[4]=h,i[5]=l,i[6]=d*r+f*o+u,i[7]=d*s+f*h+c,i[8]=d*a+f*l+_},t.rotate=function(t,e){var i=e.elements,n=this.elements,r=n[0],s=n[1],a=n[2],o=n[3],h=n[4],l=n[5],u=n[6],c=n[7],_=n[8],d=Math.sin(t),f=Math.cos(t);i[0]=f*r+d*o,i[1]=f*s+d*h,i[2]=f*a+d*l,i[3]=f*o-d*r,i[4]=f*h-d*s,i[5]=f*l-d*a,i[6]=u,i[7]=c,i[8]=_},t.scale=function(t,e){var i=e.elements,n=this.elements,r=t.x,s=t.y;i[0]=r*n[0],i[1]=r*n[1],i[2]=r*n[2],i[3]=s*n[3],i[4]=s*n[4],i[5]=s*n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8]},t.invert=function(t){var e=t.elements,i=this.elements,n=i[0],r=i[1],s=i[2],a=i[3],o=i[4],h=i[5],l=i[6],u=i[7],c=i[8],_=c*o-h*u,d=-c*a+h*l,f=u*a-o*l,p=n*_+r*d+s*f;p||(t=null),p=1/p,e[0]=_*p,e[1]=(-c*r+s*u)*p,e[2]=(h*r-s*o)*p,e[3]=d*p,e[4]=(c*n-s*l)*p,e[5]=(-h*n+s*a)*p,e[6]=f*p,e[7]=(-u*n+r*l)*p,e[8]=(o*n-r*a)*p},t.transpose=function(t){var e=t.elements,i=this.elements;if(t===this){var n=i[1],r=i[2],s=i[5];e[1]=i[3],e[2]=i[6],e[3]=n,e[5]=i[7],e[6]=r,e[7]=s}else e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8]},t.identity=function(){var t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1},t.cloneTo=function(t){var e,i,n;if((i=this.elements)!==(n=t.elements))for(e=0;e<9;++e)n[e]=i[e]},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},h.createFromTranslation=function(t,e){e.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t.x,e[7]=t.y,e[8]=1},h.createFromRotation=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[0]=r,i[1]=n,i[2]=0,i[3]=-n,i[4]=r,i[5]=0,i[6]=0,i[7]=0,i[8]=1},h.createFromScaling=function(t,e){var i=e.elements;i[0]=t.x,i[1]=0,i[2]=0,i[3]=0,i[4]=t.y,i[5]=0,i[6]=0,i[7]=0,i[8]=1},h.createFromMatrix4x4=function(t,e){e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10]},h.multiply=function(t,e,i){var n=i.elements,r=t.elements,s=e.elements,a=r[0],o=r[1],h=r[2],l=r[3],u=r[4],c=r[5],_=r[6],d=r[7],f=r[8],p=s[0],m=s[1],g=s[2],v=s[3],T=s[4],y=s[5],E=s[6],x=s[7],S=s[8];n[0]=p*a+m*l+g*_,n[1]=p*o+m*u+g*d,n[2]=p*h+m*c+g*f,n[3]=v*a+T*l+y*_,n[4]=v*o+T*u+y*d,n[5]=v*h+T*c+y*f,n[6]=E*a+x*l+S*_,n[7]=E*o+x*u+S*d,n[8]=E*h+x*c+S*f},h.lookAt=function(t,e,i,n){ln.subtract(t,e,h._tempV30),ln.normalize(h._tempV30,h._tempV30),ln.cross(i,h._tempV30,h._tempV31),ln.normalize(h._tempV31,h._tempV31),ln.cross(h._tempV30,h._tempV31,h._tempV32);var r=h._tempV30,s=h._tempV31,a=h._tempV32,o=n.elements;o[0]=s.x,o[3]=s.y,o[6]=s.z,o[1]=a.x,o[4]=a.y,o[7]=a.z,o[2]=r.x,o[5]=r.y,o[8]=r.z},h.DEFAULT=new h,E(h,["_tempV30",function(){return this._tempV30=new ln},"_tempV31",function(){return this._tempV31=new ln},"_tempV32",function(){return this._tempV32=new ln}]),h}(),lt=function(){function t(t,e,i){this.offset=0,this.elementFormat=null,this.elementUsage=0,this.offset=t,this.elementFormat=e,this.elementUsage=i}return I(t,"laya.d3.graphics.VertexElement"),t}(),ut=function(){function l(t){this._matrix=null,this._near=null,this._far=null,this._left=null,this._right=null,this._top=null,this._bottom=null,this._matrix=t,this._near=new Pt(new ln),this._far=new Pt(new ln),this._left=new Pt(new ln),this._right=new Pt(new ln),this._top=new Pt(new ln),this._bottom=new Pt(new ln),l._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}I(l,"laya.d3.math.BoundFrustum");var t=l.prototype;return t.equalsBoundFrustum=function(t){return this._matrix.equalsOtherMatrix(t.matrix)},t.equalsObj=function(t){if(t instanceof laya.d3.math.BoundFrustum){var e=t;return this.equalsBoundFrustum(e)}return!1},t.getPlane=function(t){switch(t){case 0:return this._near;case 1:return this._far;case 2:return this._left;case 3:return this._right;case 4:return this._top;case 5:return this._bottom;default:return null}},t.getCorners=function(t){l._get3PlaneInterPoint(this._near,this._bottom,this._right).cloneTo(t[0]),l._get3PlaneInterPoint(this._near,this._top,this._right).cloneTo(t[1]),l._get3PlaneInterPoint(this._near,this._top,this._left).cloneTo(t[2]),l._get3PlaneInterPoint(this._near,this._bottom,this._left).cloneTo(t[3]),l._get3PlaneInterPoint(this._far,this._bottom,this._right).cloneTo(t[4]),l._get3PlaneInterPoint(this._far,this._top,this._right).cloneTo(t[5]),l._get3PlaneInterPoint(this._far,this._top,this._left).cloneTo(t[6]),l._get3PlaneInterPoint(this._far,this._bottom,this._left).cloneTo(t[7])},t.containsPoint=function(t){for(var e=Pt.PlaneIntersectionType_Front,i=Pt.PlaneIntersectionType_Front,n=0;n<6;n++){switch(n){case 0:i=st.intersectsPlaneAndPoint(this._near,t);break;case 1:i=st.intersectsPlaneAndPoint(this._far,t);break;case 2:i=st.intersectsPlaneAndPoint(this._left,t);break;case 3:i=st.intersectsPlaneAndPoint(this._right,t);break;case 4:i=st.intersectsPlaneAndPoint(this._top,t);break;case 5:i=st.intersectsPlaneAndPoint(this._bottom,t)}switch(i){case Pt.PlaneIntersectionType_Back:return 0;case Pt.PlaneIntersectionType_Intersecting:e=Pt.PlaneIntersectionType_Intersecting}}switch(e){case Pt.PlaneIntersectionType_Intersecting:return 2;default:return 1}},t.containsBoundBox=function(t){for(var e=l._tempV30,i=l._tempV31,n=t.min,r=t.max,s=1,a=0;a<6;a++){var o=this.getPlane(a),h=o.normal;if(0<=h.x?(e.x=r.x,i.x=n.x):(e.x=n.x,i.x=r.x),0<=h.y?(e.y=r.y,i.y=n.y):(e.y=n.y,i.y=r.y),0<=h.z?(e.z=r.z,i.z=n.z):(e.z=n.z,i.z=r.z),st.intersectsPlaneAndPoint(o,e)===Pt.PlaneIntersectionType_Back)return 0;st.intersectsPlaneAndPoint(o,i)===Pt.PlaneIntersectionType_Back&&(s=2)}return s},t.containsBoundSphere=function(t){for(var e=Pt.PlaneIntersectionType_Front,i=Pt.PlaneIntersectionType_Front,n=0;n<6;n++){switch(n){case 0:i=st.intersectsPlaneAndSphere(this._near,t);break;case 1:i=st.intersectsPlaneAndSphere(this._far,t);break;case 2:i=st.intersectsPlaneAndSphere(this._left,t);break;case 3:i=st.intersectsPlaneAndSphere(this._right,t);break;case 4:i=st.intersectsPlaneAndSphere(this._top,t);break;case 5:i=st.intersectsPlaneAndSphere(this._bottom,t)}switch(i){case Pt.PlaneIntersectionType_Back:return 0;case Pt.PlaneIntersectionType_Intersecting:e=Pt.PlaneIntersectionType_Intersecting}}switch(e){case Pt.PlaneIntersectionType_Intersecting:return 2;default:return 1}},g(0,t,"bottom",function(){return this._bottom}),g(0,t,"top",function(){return this._top}),g(0,t,"left",function(){return this._left}),g(0,t,"far",function(){return this._far}),g(0,t,"near",function(){return this._near}),g(0,t,"right",function(){return this._right}),g(0,t,"matrix",function(){return this._matrix},function(t){this._matrix=t,l._getPlanesFromMatrix(this._matrix,this._near,this._far,this._left,this._right,this._top,this._bottom)}),l._getPlanesFromMatrix=function(t,e,i,n,r,s,a){var o=t.elements,h=o[0],l=o[1],u=o[2],c=o[3],_=o[4],d=o[5],f=o[6],p=o[7],m=o[8],g=o[9],v=o[10],T=o[11],y=o[12],E=o[13],x=o[14],S=o[15],C=e.normal;C.x=c+u,C.y=p+f,C.z=T+v,e.distance=S+x,e.normalize();var I=i.normal;I.x=c-u,I.y=p-f,I.z=T-v,i.distance=S-x,i.normalize();var R=n.normal;R.x=c+h,R.y=p+_,R.z=T+m,n.distance=S+y,n.normalize();var A=r.normal;A.x=c-h,A.y=p-_,A.z=T-m,r.distance=S-y,r.normalize();var M=s.normal;M.x=c-l,M.y=p-d,M.z=T-g,s.distance=S-E,s.normalize();var D=a.normal;D.x=c+l,D.y=p+d,D.z=T+g,a.distance=S+E,a.normalize()},l._get3PlaneInterPoint=function(t,e,i){var n=t.normal,r=e.normal,s=i.normal;ln.cross(r,s,l._tempV30),ln.cross(s,n,l._tempV31),ln.cross(n,r,l._tempV32);var a=ln.dot(n,l._tempV30),o=ln.dot(r,l._tempV31),h=ln.dot(s,l._tempV32);return ln.scale(l._tempV30,-t.distance/a,l._tempV33),ln.scale(l._tempV31,-e.distance/o,l._tempV34),ln.scale(l._tempV32,-i.distance/h,l._tempV35),ln.add(l._tempV33,l._tempV34,l._tempV36),ln.add(l._tempV35,l._tempV36,l._tempV37),l._tempV37},E(l,["_tempV30",function(){return this._tempV30=new ln},"_tempV31",function(){return this._tempV31=new ln},"_tempV32",function(){return this._tempV32=new ln},"_tempV33",function(){return this._tempV33=new ln},"_tempV34",function(){return this._tempV34=new ln},"_tempV35",function(){return this._tempV35=new ln},"_tempV36",function(){return this._tempV36=new ln},"_tempV37",function(){return this._tempV37=new ln}]),l}(),ct=function(){function U(){}return I(U,"laya.d3.core.particleShuriKen.ShurikenParticleData"),U._getStartLifetimeFromGradient=function(t,e){for(var i=1,n=t.gradientCount;i<n;i++){var r=t.getKeyByIndex(i);if(e<=r){var s=t.getKeyByIndex(i-1),a=(e-s)/(r-s);return ge.lerp(t.getValueByIndex(i-1),t.getValueByIndex(i),a)}}throw new Error("ShurikenParticleData: can't get value foam startLifeTimeGradient.")},U._randomInvertRoationArray=function(t,e,i,n,r){var s=NaN;n?(n.seed=r[6],s=n.getFloat(),r[6]=n.seed):s=Math.random(),e.z=s<i?(e.x=-t.x,e.y=-t.y,-t.z):(e.x=t.x,e.y=t.y,t.z)},U._randomInvertRoation=function(t,e,i,n){var r=NaN;return i?(i.seed=n[6],r=i.getFloat(),n[6]=i.seed):r=Math.random(),r<e&&(t=-t),t},U.create=function(t,e,i){var n=t.autoRandomSeed,r=t._rand,s=t._randomSeeds;switch(t.startColorType){case 0:var a=t.startColorConstant;U.startColor.x=a.x,U.startColor.y=a.y,U.startColor.z=a.z,U.startColor.w=a.w;break;case 2:n?on.lerp(t.startColorConstantMin,t.startColorConstantMax,Math.random(),U.startColor):(r.seed=s[3],on.lerp(t.startColorConstantMin,t.startColorConstantMax,r.getFloat(),U.startColor),s[3]=r.seed)}var o=t.colorOverLifetime;if(o&&o.enbale){var h=o.color;switch(h.type){case 0:U.startColor.x=U.startColor.x*h.constant.x,U.startColor.y=U.startColor.y*h.constant.y,U.startColor.z=U.startColor.z*h.constant.z,U.startColor.w=U.startColor.w*h.constant.w;break;case 2:var l=NaN;n?l=Math.random():(r.seed=s[10],l=r.getFloat(),s[10]=r.seed);var u=h.constantMin,c=h.constantMax;U.startColor.x=U.startColor.x*ge.lerp(u.x,c.x,l),U.startColor.y=U.startColor.y*ge.lerp(u.y,c.y,l),U.startColor.z=U.startColor.z*ge.lerp(u.z,c.z,l),U.startColor.w=U.startColor.w*ge.lerp(u.w,c.w,l)}}var _=U.startSize;switch(t.startSizeType){case 0:if(t.threeDStartSize){var d=t.startSizeConstantSeparate;_[0]=d.x,_[1]=d.y,_[2]=d.z}else _[0]=_[1]=_[2]=t.startSizeConstant;break;case 2:if(t.threeDStartSize){var f=t.startSizeConstantMinSeparate,p=t.startSizeConstantMaxSeparate;n?(_[0]=ge.lerp(f.x,p.x,Math.random()),_[1]=ge.lerp(f.y,p.y,Math.random()),_[2]=ge.lerp(f.z,p.z,Math.random())):(r.seed=s[4],_[0]=ge.lerp(f.x,p.x,r.getFloat()),_[1]=ge.lerp(f.y,p.y,r.getFloat()),_[2]=ge.lerp(f.z,p.z,r.getFloat()),s[4]=r.seed)}else n?_[0]=_[1]=_[2]=ge.lerp(t.startSizeConstantMin,t.startSizeConstantMax,Math.random()):(r.seed=s[4],_[0]=_[1]=_[2]=ge.lerp(t.startSizeConstantMin,t.startSizeConstantMax,r.getFloat()),s[4]=r.seed)}var m=t.sizeOverLifetime;if(m&&m.enbale&&1===m.size.type){var g=m.size;if(g.separateAxes)n?(_[0]=_[0]*ge.lerp(g.constantMinSeparate.x,g.constantMaxSeparate.x,Math.random()),_[1]=_[1]*ge.lerp(g.constantMinSeparate.y,g.constantMaxSeparate.y,Math.random()),_[2]=_[2]*ge.lerp(g.constantMinSeparate.z,g.constantMaxSeparate.z,Math.random())):(r.seed=s[11],_[0]=_[0]*ge.lerp(g.constantMinSeparate.x,g.constantMaxSeparate.x,r.getFloat()),_[1]=_[1]*ge.lerp(g.constantMinSeparate.y,g.constantMaxSeparate.y,r.getFloat()),_[2]=_[2]*ge.lerp(g.constantMinSeparate.z,g.constantMaxSeparate.z,r.getFloat()),s[11]=r.seed);else{var v=NaN;n?v=ge.lerp(g.constantMin,g.constantMax,Math.random()):(r.seed=s[11],v=ge.lerp(g.constantMin,g.constantMax,r.getFloat()),s[11]=r.seed),_[0]=_[0]*v,_[1]=_[1]*v,_[2]=_[2]*v}}var T=e.renderMode;if(1!==T)switch(t.startRotationType){case 0:if(t.threeDStartRotation){var y=t.startRotationConstantSeparate,E=U._tempVector30;U._randomInvertRoationArray(y,E,t.randomizeRotationDirection,n?null:r,s),U.startRotation[0]=E.x,U.startRotation[1]=E.y,U.startRotation[2]=4!==T?-E.z:E.z}else U.startRotation[0]=U._randomInvertRoation(t.startRotationConstant,t.randomizeRotationDirection,n?null:r,s),U.startRotation[1]=0,U.startRotation[2]=0;break;case 2:if(t.threeDStartRotation){var x=t.startRotationConstantMinSeparate,S=t.startRotationConstantMaxSeparate,C=U._tempVector30;n?(C.x=ge.lerp(x.x,S.x,Math.random()),C.y=ge.lerp(x.y,S.y,Math.random()),C.z=ge.lerp(x.z,S.z,Math.random())):(r.seed=s[5],C.x=ge.lerp(x.x,S.x,r.getFloat()),C.y=ge.lerp(x.y,S.y,r.getFloat()),C.z=ge.lerp(x.z,S.z,r.getFloat()),s[5]=r.seed),U._randomInvertRoationArray(C,C,t.randomizeRotationDirection,n?null:r,s),U.startRotation[0]=C.x,U.startRotation[1]=C.y,U.startRotation[2]=4!==T?-C.z:C.z}else n?U.startRotation[0]=U._randomInvertRoation(ge.lerp(t.startRotationConstantMin,t.startRotationConstantMax,Math.random()),t.randomizeRotationDirection,n?null:r,s):(r.seed=s[5],U.startRotation[0]=U._randomInvertRoation(ge.lerp(t.startRotationConstantMin,t.startRotationConstantMax,r.getFloat()),t.randomizeRotationDirection,n?null:r,s),s[5]=r.seed)}switch(t.startLifetimeType){case 0:U.startLifeTime=t.startLifetimeConstant;break;case 1:U.startLifeTime=U._getStartLifetimeFromGradient(t.startLifeTimeGradient,t.emissionTime);break;case 2:n?U.startLifeTime=ge.lerp(t.startLifetimeConstantMin,t.startLifetimeConstantMax,Math.random()):(r.seed=s[7],U.startLifeTime=ge.lerp(t.startLifetimeConstantMin,t.startLifetimeConstantMax,r.getFloat()),s[7]=r.seed);break;case 3:var I=t.emissionTime;n?U.startLifeTime=ge.lerp(U._getStartLifetimeFromGradient(t.startLifeTimeGradientMin,I),U._getStartLifetimeFromGradient(t.startLifeTimeGradientMax,I),Math.random()):(r.seed=s[7],U.startLifeTime=ge.lerp(U._getStartLifetimeFromGradient(t.startLifeTimeGradientMin,I),U._getStartLifetimeFromGradient(t.startLifeTimeGradientMax,I),r.getFloat()),s[7]=r.seed)}switch(t.startSpeedType){case 0:U.startSpeed=t.startSpeedConstant;break;case 2:n?U.startSpeed=ge.lerp(t.startSpeedConstantMin,t.startSpeedConstantMax,Math.random()):(r.seed=s[8],U.startSpeed=ge.lerp(t.startSpeedConstantMin,t.startSpeedConstantMax,r.getFloat()),s[8]=r.seed)}var R=t.textureSheetAnimation;if(R&&R.enable){var A=R.tiles,M=A.x,D=A.y,b=1/M,w=1/D,L=0,O=R.startFrame;switch(O.type){case 0:L=O.constant;break;case 1:n?L=ge.lerp(O.constantMin,O.constantMax,Math.random()):(r.seed=s[14],L=ge.lerp(O.constantMin,O.constantMax,r.getFloat()),s[14]=r.seed)}var N=R.frame;switch(N.type){case 0:L+=N.constant;break;case 2:n?L+=ge.lerp(N.constantMin,N.constantMax,Math.random()):(r.seed=s[15],L+=ge.lerp(N.constantMin,N.constantMax,r.getFloat()),s[15]=r.seed)}var P=0;switch(R.type){case 0:P=Math.floor(L/M);break;case 1:R.randomRow?n?P=Math.floor(Math.random()*D):(r.seed=s[13],P=Math.floor(r.getFloat()*D),s[13]=r.seed):P=R.rowIndex}var F=Math.floor(L%M);(U.startUVInfo=U.startUVInfo)[0]=b,U.startUVInfo[1]=w,U.startUVInfo[2]=F*b,U.startUVInfo[3]=P*w}else(U.startUVInfo=U.startUVInfo)[0]=1,U.startUVInfo[1]=1,U.startUVInfo[2]=0,U.startUVInfo[3]=0;switch(t.simulationSpace){case 0:var B=i.position;U.simulationWorldPostion[0]=B.x,U.simulationWorldPostion[1]=B.y,U.simulationWorldPostion[2]=B.z;var V=i.rotation;U.simulationWorldRotation[0]=V.x,U.simulationWorldRotation[1]=V.y,U.simulationWorldRotation[2]=V.z,U.simulationWorldRotation[3]=V.w;break;case 1:break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}},U.startLifeTime=NaN,U.startSpeed=NaN,E(U,["_tempVector30",function(){return this._tempVector30=new ln},"_tempQuaternion",function(){return this._tempQuaternion=new Qt},"startColor",function(){return this.startColor=new on},"startSize",function(){return this.startSize=new Float32Array(3)},"startRotation",function(){return this.startRotation=new Float32Array(3)},"startUVInfo",function(){return this.startUVInfo=new Float32Array(4)},"simulationWorldPostion",function(){return this.simulationWorldPostion=new Float32Array(3)},"simulationWorldRotation",function(){return this.simulationWorldRotation=new Float32Array(4)}]),U}(),_t=function(){function t(t){this._defaultState=null,this._statesMap={},this.playOnWake=!0,this._playType=-1,this._crossMark=0,this._crossDuration=-1,this._crossNodesOwnersIndicesMap={},this._crossNodesOwnersCount=0,this._crossNodesOwners=[],this._currentPlayState=null,this._states=[],this._playStateInfo=new Hi,this._crossPlayStateInfo=new Hi,this._srcCrossClipNodeIndices=[],this._destCrossClipNodeIndices=[],this.name=t,this.defaultWeight=1,this.blendingMode=laya.d3.component.AnimatorControllerLayer.BLENDINGMODE_OVERRIDE}I(t,"laya.d3.component.AnimatorControllerLayer");var e=t.prototype;return T.imps(e,{"laya.d3.core.IClone":!0}),e.getAnimatorState=function(t){var e=this._statesMap[t];return e||null},e.destroy=function(){this._statesMap=null,this._states=null,this._playStateInfo=null,this._crossPlayStateInfo=null,this._defaultState=null},e.cloneTo=function(t){var e=t;e.name=this.name,e.blendingMode=this.blendingMode,e.defaultWeight=this.defaultWeight,e.playOnWake=this.playOnWake},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},g(0,e,"defaultState",function(){return this._defaultState},function(t){this._defaultState=t,this._statesMap[t.name]=t}),t.BLENDINGMODE_OVERRIDE=0,t.BLENDINGMODE_ADDTIVE=1,t}(),dt=function(){function e(t,e,i){this._value=0,this._name2int=t,this._int2name=e,this._int2nameMap=i}I(e,"laya.webgl.shader.ShaderDefinesBase");var t=e.prototype;return t.add=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value|=t,this._value},t.addInt=function(t){return this._value|=t,this._value},t.remove=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value&=~t,this._value},t.isDefine=function(t){return(this._value&t)===t},t.getValue=function(){return this._value},t.setValue=function(t){this._value=t},t.toNameDic=function(){var t=this._int2nameMap[this._value];return t||e._toText(this._value,this._int2name,this._int2nameMap)},e._reg=function(t,e,i,n){n[i[t]=e]=t},e._toText=function(t,e,i){var n=i[t];if(n)return n;for(var r={},s=1,a=0;a<32&&!(t<(s=1<<a));a++)if(t&s){var o=e[s];o&&(r[o]="")}return i[t]=r},e._toInt=function(t,e){for(var i=t.split("."),n=0,r=0,s=i.length;r<s;r++){var a=e[i[r]];if(!a)throw new Error("Defines to int err:"+t+"/"+i[r]);n|=a}return n},e}(),ft=function(){function h(){}I(h,"laya.display.cmd.DrawLineCmd");var t=h.prototype;return t.recover=function(){p.recover("DrawLineCmd",this)},t.run=function(t,e,i){t._drawLine(e,i,this.fromX,this.fromY,this.toX,this.toY,this.lineColor,this.lineWidth,this.vid)},g(0,t,"cmdID",function(){return"DrawLine"}),h.create=function(t,e,i,n,r,s,a){var o=p.getItemByClass("DrawLineCmd",h);return o.fromX=t,o.fromY=e,o.toX=i,o.toY=n,o.lineColor=r,o.lineWidth=s,o.vid=a,o},h.ID="DrawLine",h}(),pt=function(){function t(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],Se.regCacheByFunction(nt.bind(this.startDispose,this),nt.bind(this.getCacheList,this))}I(t,"laya.utils.VectorGraphManager");var e=t.prototype;return e.getId=function(){return this._id++},e.addShape=function(t,e){this.shapeDic[t]=e,this.useDic[t]||(this.useDic[t]=!0)},e.addLine=function(t,e){this.shapeLineDic[t]=e,this.shapeLineDic[t]||(this.shapeLineDic[t]=!0)},e.getShape=function(t){this._checkKey&&null!=this.useDic[t]&&(this.useDic[t]=!0)},e.deleteShape=function(t){this.shapeDic[t]&&(this.shapeDic[t]=null,delete this.shapeDic[t]),this.shapeLineDic[t]&&(this.shapeLineDic[t]=null,delete this.shapeLineDic[t]),null!=this.useDic[t]&&delete this.useDic[t]},e.getCacheList=function(){var t,e=[];for(t in this.shapeDic)e.push(this.shapeDic[t]);for(t in this.shapeLineDic)e.push(this.shapeLineDic[t]);return e},e.startDispose=function(t){var e;for(e in this.useDic)this.useDic[e]=!1;this._checkKey=!0},e.endDispose=function(){if(this._checkKey){var t;for(t in this.useDic)this.useDic[t]||this.deleteShape(t);this._checkKey=!1}},t.getInstance=function(){return t.instance=t.instance||new t},t.instance=null,t}(),mt=function(){function M(){this.fontSizeInfo={},this.charRender=null,this.mapFont={},this.fontID=0,this.mapColor=[],this.colorID=0,this.fontScaleX=1,this.fontScaleY=1,this._curStrPos=0,this.bmpData32=null,this.lastFont=null,this.fontSizeW=0,this.fontSizeH=0,this.fontSizeOffX=0,this.fontSizeOffY=0,this.renderPerChar=!0,this.textureMem=0,this.fontStr=null,this.textAtlases=[],this.isoTextures=[],this.tmpAtlasPos=new R;var t=!1,e=T.MiniAdpter;e&&e.systemInfo&&e.systemInfo.system&&(t="ios 10.1.1"===e.systemInfo.system.toLowerCase()),Vt.onMiniGame&&!t&&(M.isWan1Wan=!0),Vt.onLimixiu&&(M.isWan1Wan=!0),this.charRender=qi.isConchApp?new Kr:new jr(M.atlasWidth,M.atlasWidth,M.scaleFontWithCtx,!M.isWan1Wan,!1),M.textRenderInst=this,T.textRender=this,M.atlasWidth2=M.atlasWidth*M.atlasWidth}I(M,"laya.webgl.text.TextRender");var t=M.prototype;return t.setFont=function(t){if(this.lastFont!=t){this.lastFont=t;var e=this.getFontSizeInfo(t._family),i=e>>24,n=e>>16&255,r=e>>8&255,s=255&e,a=t._size/M.standardFontSize;this.fontSizeOffX=Math.ceil(i*a),this.fontSizeOffY=Math.ceil(n*a),this.fontSizeW=Math.ceil(r*a),this.fontSizeH=Math.ceil(s*a),0<=t._font.indexOf("italic")?this.fontStr=t._font.replace("italic",""):this.fontStr=t._font}},t.getNextChar=function(t){var e=t.length,i=this._curStrPos;if(e<=i)return null;for(var n=i,r=0;n<e;n++){var s=t.charCodeAt(n);if(s>>>11==27){if(1==r)break;r=1,n++}else if(65038===s||65039===s);else if(8205==s)r=2;else if(0==r)r=1;else if(1==r)break}return this._curStrPos=n,t.substring(i,n)},t.filltext=function(t,e,i,n,r,s,a,o,h,l){if(void 0===l&&(l=0),!(e.length<=0)){var u=Tt.Parse(r),c=0;switch(h){case"center":c=ji.ENUM_TEXTALIGN_CENTER;break;case"right":c=ji.ENUM_TEXTALIGN_RIGHT}this._fast_filltext(t,e,null,i,n,u,s,a,o,c,l)}},t.fillWords=function(t,e,i,n,r,s,a,o){if(e&&!(e.length<=0)){var h=Tt.Parse(r);this._fast_filltext(t,null,e,i,n,h,s,a,o,0,0)}},t._fast_filltext=function(t,e,i,n,r,s,a,o,h,l,u){if(void 0===u&&(u=0),!(e&&e.length<1||i&&i.length<1)){if(h<0&&(h=0),this.setFont(s),this.fontScaleX=this.fontScaleY=1,!qi.isConchApp&&M.scaleFontWithCtx){var c=1,_=1;if(_=qi.isConchApp?(c=t._curMat.getScaleX(),t._curMat.getScaleY()):(c=t.getMatScaleX(),t.getMatScaleY()),c<1e-4||_<.1)return;1<c&&(this.fontScaleX=c),1<_&&(this.fontScaleY=_)}s._italic&&(t._italicDeg=13);var d=e,f=!i&&e instanceof laya.utils.WordText,p=e,m=!!i,g=f?d.pageChars:[],v=0;switch(f?(p=d._text,(v=d.width)<0&&(v=d.width=this.charRender.getWidth(this.fontStr,p))):v=p?this.charRender.getWidth(this.fontStr,p):0,l){case ji.ENUM_TEXTALIGN_CENTER:n-=v/2;break;case ji.ENUM_TEXTALIGN_RIGHT:n-=v}d&&g&&this.hasFreedText(g)&&(g=d.pageChars=[]);var T=null,y=this.renderPerChar=!f||M.forceSplitRender||m||f&&d.splitRender;if(!g||g.length<1)if(y){var E,x=0,S=0;for(this._curStrPos=0;;){if(m){var C=i[this._curStrPos++];C?(E=C.char,x=C.x,S=C.y):E=null}else E=this.getNextChar(p);if(!E)break;if(!(T=this.getCharRenderInfo(E,s,a,o,h,!1)))break;if(T.isSpace);else{var I=g[T.tex.id];if(I)I=I.words;else{var R={texgen:T.tex.genID,tex:T.tex,words:[]};I=(g[T.tex.id]=R).words}qi.isConchApp?I.push({ri:T,x:x,y:S,w:T.bmpWidth/this.fontScaleX,h:T.bmpHeight/this.fontScaleY}):I.push({ri:T,x:x+1/this.fontScaleX,y:S,w:(T.bmpWidth-2)/this.fontScaleX,h:(T.bmpHeight-1)/this.fontScaleY}),x+=T.width}}}else{var A=M.noAtlas||v*this.fontScaleX>M.atlasWidth;T=this.getCharRenderInfo(p,s,a,o,h,A),qi.isConchApp?g[0]={texgen:T.tex.genID,tex:T.tex,words:[{ri:T,x:0,y:0,w:T.bmpWidth/this.fontScaleX,h:T.bmpHeight/this.fontScaleY}]}:g[0]={texgen:T.tex.genID,tex:T.tex,words:[{ri:T,x:1/this.fontScaleX,y:0/this.fontScaleY,w:(T.bmpWidth-2)/this.fontScaleX,h:(T.bmpHeight-1)/this.fontScaleY}]}}this._drawResortedWords(t,n,r,g),t._italicDeg=0}},t._drawResortedWords=function(t,e,i,n){for(var r=t._charSubmitCache&&t._charSubmitCache._enbale,s=t._curMat,a=n.length,o=0;o<a;o++){var h=n[o];if(h){var l=h.words,u=l.length;if(!(u<=0))for(var c=n[o].tex,_=0;_<u;_++){var d=l[_],f=d.ri;f.isSpace||(f.touch(),t.drawTexAlign=!0,qi.isConchApp?t._drawTextureM(c.texture,e+d.x-f.orix,i+d.y-f.oriy,d.w,d.h,null,1,f.uv):t._inner_drawTexture(c.texture,c.texture.bitmap.id,e+d.x-f.orix,i+d.y-f.oriy,d.w,d.h,s,f.uv,1,r),t.touches&&t.touches.push(f))}}}},t.hasFreedText=function(t){for(var e=t.length,i=0;i<e;i++){var n=t[i];if(n){var r=n.tex;if(r.__destroyed||r.genID!=n.texgen)return!0}}return!1},t.getCharRenderInfo=function(t,e,i,n,r,s){void 0===s&&(s=!1);var a=this.mapFont[e._family];null==a&&(this.mapFont[e._family]=a=this.fontID++);var o=t+"_"+a+"_"+e._size+"_"+i;0<r&&(o+="_"+n+r),e._bold&&(o+="P"),1==this.fontScaleX&&1==this.fontScaleY||(o+=(20*this.fontScaleX|0)+"_"+(20*this.fontScaleY|0));var h=0,l=this.textAtlases.length,u=null,c=null;if(!s)for(h=0;h<l;h++)if(u=(c=this.textAtlases[h]).charMaps[o])return u.touch(),u;u=new q,this.charRender.scale(this.fontScaleX,this.fontScaleY),u.char=t,u.height=e._size;var _=e._size/3|0,d=null,f=Math.ceil(this.charRender.getWidth(this.fontStr,t)*this.fontScaleX);if(f>this.charRender.canvasWidth&&(this.charRender.canvasWidth=Math.min(2048,f+2*_)),s){d=this.charRender.getCharBmp(t,this.fontStr,r,i,n,u,_,_,_,_,null);var p=hs.getTextTexture(d.width,d.height);p.addChar(d,0,0,u.uv),u.tex=p,u.orix=_,u.oriy=_,p.ri=u,this.isoTextures.push(p)}else{var m=t.length,g=1*r,v=Math.ceil((this.fontSizeW+2*g)*this.fontScaleX),T=Math.ceil((this.fontSizeH+2*g)*this.fontScaleY);M.imgdtRect[0]=(_-this.fontSizeOffX-g)*this.fontScaleX|0,M.imgdtRect[1]=(_-this.fontSizeOffY-g)*this.fontScaleY|0,this.renderPerChar||1==m?(M.imgdtRect[2]=Math.max(f,v),M.imgdtRect[3]=Math.max(f,T)):(M.imgdtRect[2]=-1,M.imgdtRect[3]=T),d=this.charRender.getCharBmp(t,this.fontStr,r,i,n,u,_,_,_,_,M.imgdtRect),c=this.addBmpData(d,u),u.oriy=M.isWan1Wan?u.orix=_:(u.orix=this.fontSizeOffX+g,this.fontSizeOffY+g),c.charMaps[o]=u}return u},t.addBmpData=function(t,e){for(var i=t.width,n=t.height,r=this.textAtlases.length,s=null,a=!1,o=0;o<r&&!(a=(s=this.textAtlases[o]).getAEmpty(i,n,this.tmpAtlasPos));o++);if(!a){if(s=new Ie,this.textAtlases.push(s),!(a=s.getAEmpty(i,n,this.tmpAtlasPos)))throw"err1";this.cleanAtlases()}return a&&(s.texture.addChar(t,this.tmpAtlasPos.x,this.tmpAtlasPos.y,e.uv),e.tex=s.texture),s},t.GC=function(){for(var t=0,e=this.textAtlases.length,i=0,n=M.destroyAtlasDt,r=0,s=$i.loopCount,a=-1,o=0,h=null,l=null;t<e;t++){if(h=(l=this.textAtlases[t]).texture){h.curUsedCovRate,r+=h.curUsedCovRateAtlas;var u=l.usedRate-h.curUsedCovRateAtlas;o<u&&(o=u,a=t)}n<(i=s-l.texture.lastTouchTm)&&(M.showLog&&console.log(l.texture.id),l.destroy(),this.textAtlases[t]=this.textAtlases[e-1],e--,t--,a=-1)}for(this.textAtlases.length=e,e=this.isoTextures.length,t=0;t<e;t++)i=s-(h=this.isoTextures[t]).lastTouchTm,M.destroyUnusedTextureDt<i&&(h.ri.deleted=!0,h.ri.tex=null,h.destroy(),this.isoTextures[t]=this.isoTextures[e-1],e--,t--);this.isoTextures.length=e;var c=1<this.textAtlases.length&&2<=this.textAtlases.length-r;(M.atlasWidth*M.atlasWidth*4*this.textAtlases.length>M.cleanMem||c||M.simClean)&&(M.simClean=!1,M.showLog&&console.log("清理使用率低的贴图。总使用率:",r,":",this.textAtlases.length,"最差贴图:"+a),0<=a&&((l=this.textAtlases[a]).destroy(),this.textAtlases[a]=this.textAtlases[this.textAtlases.length-1],this.textAtlases.length=this.textAtlases.length-1)),hs.clean()},t.cleanAtlases=function(){},t.getCharBmp=function(t){},t.checkBmpLine=function(t,e,i,n){this.bmpData32.buffer!=t.data.buffer&&(this.bmpData32=new Uint32Array(t.data.buffer));for(var r=t.width*e+i,s=i;s<n;s++)if(0!=this.bmpData32[r++])return!0;return!1},t.updateBbx=function(t,e,i){void 0===i&&(i=!1);var n=t.width,r=t.height,s=0,a=e[1],o=0,h=a;if(this.checkBmpLine(t,a,0,n))for(;;){if(a<=(h=(a+o)/2|0)+1){e[1]=h;break}this.checkBmpLine(t,h,0,n)?a=h:o=h}if(e[3]>r)e[3]=r;else if(h=a=e[3],o=r,this.checkBmpLine(t,a,0,n))for(;;){if((h=(a+o)/2|0)-1<=a){e[3]=h;break}this.checkBmpLine(t,h,0,n)?a=h:o=h}if(!i){var l=e[0],u=n*e[1];for(h=e[1];h<e[3];h++){for(s=0;s<l;s++)if(0!=this.bmpData32[u+s]){l=s;break}u+=n}e[0]=l;var c=e[2];for(u=n*e[1],h=e[1];h<e[3];h++){for(s=c;s<n;s++)if(0!=this.bmpData32[u+s]){c=s;break}u+=n}e[2]=c}},t.getFontSizeInfo=function(t){var e=this.fontSizeInfo[t];if(null!=e)return e;var i="bold "+M.standardFontSize+"px "+t;if(M.isWan1Wan){this.fontSizeW=1.5*this.charRender.getWidth(i,"有"),this.fontSizeH=1.5*M.standardFontSize;var n=this.fontSizeW<<8|this.fontSizeH;return this.fontSizeInfo[t]=n}M.pixelBBX[0]=M.standardFontSize/2,M.pixelBBX[1]=M.standardFontSize/2,M.pixelBBX[2]=M.standardFontSize,M.pixelBBX[3]=M.standardFontSize;var r=16,s=16;this.charRender.scale(1,1),M.tmpRI.height=M.standardFontSize;var a=this.charRender.getCharBmp("g",i,0,"red",null,M.tmpRI,r,s,16,16);qi.isConchApp&&(a.data=new Uint8ClampedArray(a.data)),this.bmpData32=new Uint32Array(a.data.buffer),this.updateBbx(a,M.pixelBBX,!1),a=this.charRender.getCharBmp("有",i,0,"red",null,M.tmpRI,s,s,16,16),qi.isConchApp&&(a.data=new Uint8ClampedArray(a.data)),this.bmpData32=new Uint32Array(a.data.buffer),M.pixelBBX[2]<r+M.tmpRI.width&&(M.pixelBBX[2]=r+M.tmpRI.width),this.updateBbx(a,M.pixelBBX,!1),qi.isConchApp&&(s=r=0);var o=Math.max(r-M.pixelBBX[0],0)<<24|Math.max(s-M.pixelBBX[1],0)<<16|M.pixelBBX[2]-M.pixelBBX[0]<<8|M.pixelBBX[3]-M.pixelBBX[1]+1;return this.fontSizeInfo[t]=o},t.printDbgInfo=function(){for(var t in console.log("图集个数:"+this.textAtlases.length+",每个图集大小:"+M.atlasWidth+"x"+M.atlasWidth," 用canvas:",M.isWan1Wan),console.log("图集占用空间:"+M.atlasWidth*M.atlasWidth*4/1024/1024*this.textAtlases.length+"M"),console.log("缓存用到的字体:"),this.mapFont){var e=this.getFontSizeInfo(t),i=e>>24,n=e>>16&255,r=e>>8&255,s=255&e;console.log("    "+t," off:",i,n," size:",r,s)}var a=0;console.log("缓存数据:");var o=0,h=0;this.textAtlases.forEach(function(t){var e=t.texture.id,i=$i.loopCount-t.texture.lastTouchTm,n=0<i?i+"帧以前":"当前帧";for(var r in o+=t.texture.curUsedCovRate,h+=t.texture.curUsedCovRateAtlas,console.log("--图集(id:"+e+",当前使用率:"+(1e3*t.texture.curUsedCovRate|0)+"‰","当前图集使用率:",(100*t.texture.curUsedCovRateAtlas|0)+"%","图集使用率:",100*t.usedRate|0,"%, 使用于:"+n+")--:"),t.charMaps){var s=t.charMaps[r];console.log("     off:",s.orix,s.oriy," bmp宽高:",s.bmpWidth,s.bmpHeight,"无效:",s.deleted,"touchdt:",$i.loopCount-s.touchTick,"位置:",s.uv[0]*M.atlasWidth|0,s.uv[1]*M.atlasWidth|0,"字符:",s.char,"key:",r),a++}}),console.log("独立贴图文字("+this.isoTextures.length+"个):"),this.isoTextures.forEach(function(t){console.log("    size:",t._texW,t._texH,"touch间隔:",$i.loopCount-t.lastTouchTm,"char:",t.ri.char)}),console.log("总缓存:",a,"总使用率:",o,"总当前图集使用率:",h)},t.showAtlas=function(t,i,e,n,r,s){if(!this.textAtlases[t])return console.log("没有这个图集"),null;var a=new ts,o=this.textAtlases[t].texture,h={width:M.atlasWidth,height:M.atlasWidth,sourceWidth:M.atlasWidth,sourceHeight:M.atlasWidth,offsetX:0,offsetY:0,getIsReady:function(){return!0},_addReference:function(){},_removeReference:function(){},_getSource:function(){return o._getSource()},bitmap:{id:o.id},_uv:xr.DEF_UV};return a.size=function(t,e){return this.width=t,this.height=e,a.graphics.clear(),a.graphics.drawRect(0,0,a.width,a.height,i),a.graphics.drawTexture(h,0,0,a.width,a.height),this},a.graphics.drawRect(0,0,r,s,i),a.graphics.drawTexture(h,0,0,r,s),a.pos(e,n),T.stage.addChild(a),a},t.filltext_native=function(t,e,i,n,r,s,a,o,h,l,u){if(void 0===u&&(u=0),!(e&&e.length<=0||i&&i.length<1)){var c=Tt.Parse(s),_=0;switch(l){case"center":_=ji.ENUM_TEXTALIGN_CENTER;break;case"right":_=ji.ENUM_TEXTALIGN_RIGHT}return this._fast_filltext(t,e,i,n,r,c,a,o,h,_,u)}},M.useOldCharBook=!1,M.atlasWidth=2048,M.noAtlas=!1,M.forceSplitRender=!1,M.forceWholeRender=!1,M.scaleFontWithCtx=!0,M.standardFontSize=32,M.destroyAtlasDt=10,M.checkCleanTextureDt=2e3,M.destroyUnusedTextureDt=3e3,M.cleanMem=104857600,M.isWan1Wan=!1,M.showLog=!1,M.debugUV=!1,M.atlasWidth2=4194304,M.textRenderInst=null,M.simClean=!1,E(M,["tmpRI",function(){return this.tmpRI=new q},"pixelBBX",function(){return this.pixelBBX=[0,0,0,0]},"imgdtRect",function(){return this.imgdtRect=[0,0,0,0]}]),M}(),gt=function(){function S(t,e,i,n,r,s,a,o,h,l,u,c,_,d,f,p,m){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=1),void 0===a&&(a=0),void 0===o&&(o=0),void 0===h&&(h=0),void 0===l&&(l=0),void 0===u&&(u=1),void 0===c&&(c=0),void 0===_&&(_=0),void 0===d&&(d=0),void 0===f&&(f=0),void 0===p&&(p=1);var g=this.elements=m||new Float32Array(16);g[0]=t,g[1]=e,g[2]=i,g[3]=n,g[4]=r,g[5]=s,g[6]=a,g[7]=o,g[8]=h,g[9]=l,g[10]=u,g[11]=c,g[12]=_,g[13]=d,g[14]=f,g[15]=p}I(S,"laya.d3.math.Matrix4x4");var t=S.prototype;return T.imps(t,{"laya.d3.core.IClone":!0}),t.setRotation=function(t){var e=t.x,i=t.y,n=t.z,r=t.w,s=e*e,a=i*i,o=n*n,h=e*i,l=n*r,u=n*e,c=i*r,_=i*n,d=e*r,f=this.elements;f[0]=1-2*(a+o),f[1]=2*(h+l),f[2]=2*(u-c),f[4]=2*(h-l),f[5]=1-2*(o+s),f[6]=2*(_+d),f[8]=2*(u+c),f[9]=2*(_-d),f[10]=1-2*(a+s)},t.setPosition=function(t){var e=this.elements;e[12]=t.x,e[13]=t.y,e[14]=t.z},t.getElementByRowColumn=function(t,e){if(t<0||3<t)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(e<0||3<e)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");return this.elements[4*t+e]},t.setElementByRowColumn=function(t,e,i){if(t<0||3<t)throw new Error("row","Rows and columns for matrices run from 0 to 3, inclusive.");if(e<0||3<e)throw new Error("column","Rows and columns for matrices run from 0 to 3, inclusive.");this.elements[4*t+e]=i},t.equalsOtherMatrix=function(t){var e=this.elements,i=t.elements;return k.nearEqual(e[0],i[0])&&k.nearEqual(e[1],i[1])&&k.nearEqual(e[2],i[2])&&k.nearEqual(e[3],i[3])&&k.nearEqual(e[4],i[4])&&k.nearEqual(e[5],i[5])&&k.nearEqual(e[6],i[6])&&k.nearEqual(e[7],i[7])&&k.nearEqual(e[8],i[8])&&k.nearEqual(e[9],i[9])&&k.nearEqual(e[10],i[10])&&k.nearEqual(e[11],i[11])&&k.nearEqual(e[12],i[12])&&k.nearEqual(e[13],i[13])&&k.nearEqual(e[14],i[14])&&k.nearEqual(e[15],i[15])},t.decomposeTransRotScale=function(t,e,i){var n=S._tempMatrix4x4;return this.decomposeTransRotMatScale(t,n,i)?(Qt.createFromMatrix4x4(n,e),!0):(e.identity(),!1)},t.decomposeTransRotMatScale=function(t,e,i){var n=this.elements,r=t,s=e.elements,a=i;r.x=n[12],r.y=n[13],r.z=n[14];var o=n[0],h=n[1],l=n[2],u=n[4],c=n[5],_=n[6],d=n[8],f=n[9],p=n[10],m=a.x=Math.sqrt(o*o+h*h+l*l),g=a.y=Math.sqrt(u*u+c*c+_*_),v=a.z=Math.sqrt(d*d+f*f+p*p);if(k.isZero(m)||k.isZero(g)||k.isZero(v))return s[1]=s[2]=s[3]=s[4]=s[6]=s[7]=s[8]=s[9]=s[11]=s[12]=s[13]=s[14]=0,s[0]=s[5]=s[10]=s[15]=1,!1;var T=S._tempVector0;T.x=d/v,T.y=f/v,T.z=p/v;var y=S._tempVector1;y.x=o/m,y.y=h/m,y.z=l/m;var E=S._tempVector2;ln.cross(T,y,E);var x=S._tempVector1;return ln.cross(E,T,x),s[3]=s[7]=s[11]=s[12]=s[13]=s[14]=0,s[15]=1,s[0]=x.x,s[1]=x.y,s[2]=x.z,s[4]=E.x,s[5]=E.y,s[6]=E.z,s[8]=T.x,s[9]=T.y,s[10]=T.z,s[0]*o+s[1]*h+s[2]*l<0&&(a[0]=-m),s[4]*u+s[5]*c+s[6]*_<0&&(a[1]=-g),s[8]*d+s[9]*f+s[10]*p<0&&(a[2]=-v),!0},t.decomposeYawPitchRoll=function(t){var e=Math.asin(-this.elements[9]);t.y=e,Math.cos(e)>k.zeroTolerance?(t.z=Math.atan2(this.elements[1],this.elements[5]),t.x=Math.atan2(this.elements[8],this.elements[10])):(t.z=Math.atan2(-this.elements[4],this.elements[0]),t.x=0)},t.normalize=function(){var t=this.elements,e=t[0],i=t[1],n=t[2],r=Math.sqrt(e*e+i*i+n*n);if(!r)return t[0]=0,t[1]=0,void(t[2]=0);1!=r&&(r=1/r,t[0]=e*r,t[1]=i*r,t[2]=n*r)},t.transpose=function(){var t,e;return e=(t=this.elements)[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},t.invert=function(t){var e=this.elements,i=t.elements,n=e[0],r=e[1],s=e[2],a=e[3],o=e[4],h=e[5],l=e[6],u=e[7],c=e[8],_=e[9],d=e[10],f=e[11],p=e[12],m=e[13],g=e[14],v=e[15],T=n*h-r*o,y=n*l-s*o,E=n*u-a*o,x=r*l-s*h,S=r*u-a*h,C=s*u-a*l,I=c*m-_*p,R=c*g-d*p,A=c*v-f*p,M=_*g-d*m,D=_*v-f*m,b=d*v-f*g,w=T*b-y*D+E*M+x*A-S*R+C*I;0!==Math.abs(w)&&(w=1/w,i[0]=(h*b-l*D+u*M)*w,i[1]=(s*D-r*b-a*M)*w,i[2]=(m*C-g*S+v*x)*w,i[3]=(d*S-_*C-f*x)*w,i[4]=(l*A-o*b-u*R)*w,i[5]=(n*b-s*A+a*R)*w,i[6]=(g*E-p*C-v*y)*w,i[7]=(c*C-d*E+f*y)*w,i[8]=(o*D-h*A+u*I)*w,i[9]=(r*A-n*D-a*I)*w,i[10]=(p*S-m*E+v*T)*w,i[11]=(_*E-c*S-f*T)*w,i[12]=(h*R-o*M-l*I)*w,i[13]=(n*M-r*R+s*I)*w,i[14]=(m*y-p*x-g*T)*w,i[15]=(c*x-_*y+d*T)*w)},t.identity=function(){var t=this.elements;t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1},t.cloneTo=function(t){var e,i,n;if((i=this.elements)!==(n=t.elements))for(e=0;e<16;++e)n[e]=i[e]},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t.getTranslationVector=function(t){var e=this.elements;t.x=e[12],t.y=e[13],t.z=e[14]},t.setTranslationVector=function(t){var e=this.elements,i=t;e[12]=i.x,e[13]=i.y,e[14]=i.z},t.getForward=function(t){var e=this.elements;t.x=-e[8],t.y=-e[9],t.z=-e[10]},t.setForward=function(t){var e=this.elements;e[8]=-t.x,e[9]=-t.y,e[10]=-t.z},S.createRotationX=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[1]=i[2]=i[3]=i[4]=i[7]=i[8]=i[11]=i[12]=i[13]=i[14]=0,i[0]=i[15]=1,i[5]=i[10]=r,i[6]=n,i[9]=-n},S.createRotationY=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[1]=i[3]=i[4]=i[6]=i[7]=i[9]=i[11]=i[12]=i[13]=i[14]=0,i[5]=i[15]=1,i[0]=i[10]=r,i[2]=-n,i[8]=n},S.createRotationZ=function(t,e){var i=e.elements,n=Math.sin(t),r=Math.cos(t);i[2]=i[3]=i[6]=i[7]=i[8]=i[9]=i[11]=i[12]=i[13]=i[14]=0,i[10]=i[15]=1,i[0]=i[5]=r,i[1]=n,i[4]=-n},S.createRotationYawPitchRoll=function(t,e,i,n){Qt.createFromYawPitchRoll(t,e,i,S._tempQuaternion),S.createRotationQuaternion(S._tempQuaternion,n)},S.createRotationAxis=function(t,e,i){var n=t.x,r=t.y,s=t.z,a=Math.cos(e),o=Math.sin(e),h=n*n,l=r*r,u=s*s,c=n*r,_=n*s,d=r*s,f=i.elements;f[3]=f[7]=f[11]=f[12]=f[13]=f[14]=0,f[15]=1,f[0]=h+a*(1-h),f[1]=c-a*c+o*s,f[2]=_-a*_-o*r,f[4]=c-a*c-o*s,f[5]=l+a*(1-l),f[6]=d-a*d+o*n,f[8]=_-a*_+o*r,f[9]=d-a*d-o*n,f[10]=u+a*(1-u)},S.createRotationQuaternion=function(t,e){var i=e.elements,n=t.x,r=t.y,s=t.z,a=t.w,o=n*n,h=r*r,l=s*s,u=n*r,c=s*a,_=s*n,d=r*a,f=r*s,p=n*a;i[3]=i[7]=i[11]=i[12]=i[13]=i[14]=0,i[15]=1,i[0]=1-2*(h+l),i[1]=2*(u+c),i[2]=2*(_-d),i[4]=2*(u-c),i[5]=1-2*(l+o),i[6]=2*(f+p),i[8]=2*(_+d),i[9]=2*(f-p),i[10]=1-2*(h+o)},S.createTranslate=function(t,e){var i=e.elements;i[4]=i[8]=i[1]=i[9]=i[2]=i[6]=i[3]=i[7]=i[11]=0,i[0]=i[5]=i[10]=i[15]=1,i[12]=t.x,i[13]=t.y,i[14]=t.z},S.createScaling=function(t,e){var i=e.elements;i[0]=t.x,i[5]=t.y,i[10]=t.z,i[1]=i[4]=i[8]=i[12]=i[9]=i[13]=i[2]=i[6]=i[14]=i[3]=i[7]=i[11]=0,i[15]=1},S.multiply=function(t,e,i){var n,r,s,a,o,h,l,u;if(r=i.elements,s=t.elements,r===(a=e.elements))for(a=new Float32Array(16),n=0;n<16;++n)a[n]=r[n];var c=a[0],_=a[1],d=a[2],f=a[3],p=a[4],m=a[5],g=a[6],v=a[7],T=a[8],y=a[9],E=a[10],x=a[11],S=a[12],C=a[13],I=a[14],R=a[15];for(n=0;n<4;n++)o=s[n],h=s[n+4],l=s[n+8],u=s[n+12],r[n]=o*c+h*_+l*d+u*f,r[n+4]=o*p+h*m+l*g+u*v,r[n+8]=o*T+h*y+l*E+u*x,r[n+12]=o*S+h*C+l*I+u*R},S.multiplyForNative=function(t,e,i){Nt.instance.matrix4x4Multiply(t.elements,e.elements,i.elements)},S.createFromQuaternion=function(t,e){var i=e.elements,n=t.x,r=t.y,s=t.z,a=t.w,o=n+n,h=r+r,l=s+s,u=n*o,c=r*o,_=r*h,d=s*o,f=s*h,p=s*l,m=a*o,g=a*h,v=a*l;i[0]=1-_-p,i[1]=c+v,i[2]=d-g,i[3]=0,i[4]=c-v,i[5]=1-u-p,i[6]=f+m,i[7]=0,i[8]=d+g,i[9]=f-m,i[10]=1-u-_,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1},S.createAffineTransformation=function(t,e,i,n){var r=n.elements,s=e.x,a=e.y,o=e.z,h=e.w,l=s+s,u=a+a,c=o+o,_=s*l,d=s*u,f=s*c,p=a*u,m=a*c,g=o*c,v=h*l,T=h*u,y=h*c,E=i.x,x=i.y,S=i.z;r[0]=(1-(p+g))*E,r[1]=(d+y)*E,r[2]=(f-T)*E,r[3]=0,r[4]=(d-y)*x,r[5]=(1-(_+g))*x,r[6]=(m+v)*x,r[7]=0,r[8]=(f+T)*S,r[9]=(m-v)*S,r[10]=(1-(_+p))*S,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1},S.createLookAt=function(t,e,i,n){var r=n.elements,s=S._tempVector0,a=S._tempVector1,o=S._tempVector2;ln.subtract(t,e,o),ln.normalize(o,o),ln.cross(i,o,s),ln.normalize(s,s),ln.cross(o,s,a),n.identity(),r[0]=s.x,r[4]=s.y,r[8]=s.z,r[1]=a.x,r[5]=a.y,r[9]=a.z,r[2]=o.x,r[6]=o.y,r[10]=o.z,r[12]=-ln.dot(s,t),r[13]=-ln.dot(a,t),r[14]=-ln.dot(o,t)},S.createPerspective=function(t,e,i,n,r){var s=1/Math.tan(.5*t),a=i/(s/e),o=i/s;S.createPerspectiveOffCenter(-a,a,-o,o,i,n,r)},S.createPerspectiveOffCenter=function(t,e,i,n,r,s,a){var o=a.elements,h=s/(s-r);o[1]=o[2]=o[3]=o[4]=o[6]=o[7]=o[12]=o[13]=o[15]=0,o[0]=2*r/(e-t),o[5]=2*r/(n-i),o[8]=(t+e)/(e-t),o[9]=(n+i)/(n-i),o[10]=-h,o[11]=-1,o[14]=-r*h},S.createOrthoOffCenter=function(t,e,i,n,r,s,a){var o=a.elements,h=1/(s-r);o[1]=o[2]=o[3]=o[4]=o[6]=o[8]=o[7]=o[9]=o[11]=0,o[15]=1,o[0]=2/(e-t),o[5]=2/(n-i),o[10]=-h,o[12]=(t+e)/(t-e),o[13]=(n+i)/(i-n),o[14]=-r*h},S.billboard=function(t,e,i,n,r,s){ln.subtract(t,e,S._tempVector0);var a=ln.scalarLengthSquared(S._tempVector0);k.isZero(a)?(ln.scale(r,-1,S._tempVector1),S._tempVector1.cloneTo(S._tempVector0)):ln.scale(S._tempVector0,1/Math.sqrt(a),S._tempVector0),ln.cross(n,S._tempVector0,S._tempVector2),ln.normalize(S._tempVector2,S._tempVector2),ln.cross(S._tempVector0,S._tempVector2,S._tempVector3);var o=S._tempVector2,h=S._tempVector3,l=S._tempVector0,u=t,c=s.elements;c[0]=o.x,c[1]=o.y,c[2]=o.z,c[3]=0,c[4]=h.x,c[5]=h.y,c[6]=h.z,c[7]=0,c[8]=l.x,c[9]=l.y,c[10]=l.z,c[11]=0,c[12]=u.x,c[13]=u.y,c[14]=u.z,c[15]=1},S.translation=function(t,e){var i=e.elements;i[0]=i[5]=i[10]=i[15]=1,i[12]=t.x,i[13]=t.y,i[14]=t.z},E(S,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new S},"_tempVector0",function(){return this._tempVector0=new ln},"_tempVector1",function(){return this._tempVector1=new ln},"_tempVector2",function(){return this._tempVector2=new ln},"_tempVector3",function(){return this._tempVector3=new ln},"_tempQuaternion",function(){return this._tempQuaternion=new Qt},"DEFAULT",function(){return this.DEFAULT=new S},"ZERO",function(){return this.ZERO=new S(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}]),S}(),vt=function(){var n;function t(){this._lastOriX=0,this._lastOriY=0,this.paths=[],this._curPath=null}I(t,"laya.webgl.canvas.Path");var e=t.prototype;return e.beginPath=function(t){this.paths.length=1,this._curPath=this.paths[0]=new n,this._curPath.convex=t},e.closePath=function(){this._curPath.loop=!0},e.newPath=function(){this._curPath=new n,this.paths.push(this._curPath)},e.addPoint=function(t,e){this._curPath.path.push(t,e)},e.push=function(t,e){this._curPath?0<this._curPath.path.length&&(this._curPath=new n,this.paths.push(this._curPath)):(this._curPath=new n,this.paths.push(this._curPath));var i=this._curPath;i.path=t.slice(),i.convex=e},e.reset=function(){this.paths.length=0},t.__init$=function(){n=function(){function t(){this.path=[],this.loop=!1,this.convex=!1}return I(t,""),t}()},t}(),Tt=function(){function i(t){this._font="14px Arial",this._family="Arial",this._size=14,this._italic=!1,this._bold=!1,this._id=i._gfontID++,this.setFont(t||this._font)}return I(i,"laya.utils.FontInfo"),i.prototype.setFont=function(t){var e=(this._font=t).split(" "),i=e.length;if(i<2)1==i&&0<e[0].indexOf("px")&&(this._size=parseInt(e[0]));else{for(var n=-1,r=0;r<i;r++)if(0<e[r].indexOf("px")||0<e[r].indexOf("pt")){n=r,this._size=parseInt(e[r]),this._size<=0&&(console.error("font parse error:"+t),this._size=14);break}var s=n+1,a=e[s];for(s++;s<i;s++)a+=" "+e[s];this._family=a.split(",")[0],this._italic=0<=e.indexOf("italic"),this._bold=0<=e.indexOf("bold")}},i.Parse=function(t){if(t===i._lastFont)return i._lastFontInfo;var e=i._cache[t];return e||(e=i._cache[t]=new i(t)),i._lastFont=t,i._lastFontInfo=e},i.EMPTY=new i(null),i._cache={},i._gfontID=0,i._lastFont="",i._lastFontInfo=null,i}(),yt=function(){function a(t){this.clipInfoID=-1,this._mesh=null,this._blendFn=null,this._id=0,this._renderType=0,this._parent=null,this._startIdx=0,this._numEle=0,this._ref=1,this.shaderValue=null,this._key=new Mt,void 0===t&&(t=1e4),this._renderType=t,this._id=++a.ID}I(a,"laya.webgl.submit.Submit");var t=a.prototype;return T.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.getID=function(){return this._id},t.releaseRender=function(){a.RENDERBASE!=this&&--this._ref<1&&((a.POOL[a._poolSize++]=this).shaderValue.release(),this.shaderValue=null,this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))},t.getRenderType=function(){return this._renderType},t.renderSubmit=function(){if(0===this._numEle||!this._mesh||0==this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t._getSource();if(!e)return 1;this.shaderValue.texture=e}var i=en.mainContext;return this._mesh.useMesh(i),this.shaderValue.upload(),cn.activeBlendFunction!==this._blendFn&&(j.setBlend(i,!0),this._blendFn(i),cn.activeBlendFunction=this._blendFn),i.drawElements(4,this._numEle,5123,this._startIdx),$i.renderBatches++,$i.trianglesFaces+=this._numEle/3,1},t._cloneInit=function(t,e,i,n){t._ref=1,t._mesh=i,t._id=this._id,t._key.copyFrom(this._key),t._parent=this,t._blendFn=this._blendFn,t._renderType=this._renderType,t._startIdx=n*$e.BYTES_PIDX,t._numEle=this._numEle,t.shaderValue=this.shaderValue,this.shaderValue.ref++,this._ref++},t.clone=function(t,e,i){return null},t.reUse=function(t,e){return 0},t.toString=function(){return"ibindex:"+this._startIdx+" num:"+this._numEle+" key="+this._key},a.__init__=function(){var t=a.RENDERBASE=new a(-1);t.shaderValue=new Ot(0,0),t.shaderValue.ALPHA=1,t._ref=4294967295},a.create=function(t,e,i){var n=a._poolSize?a.POOL[--a._poolSize]:new a;n._ref=1,n._mesh=e,n._key.clear(),n._startIdx=e.indexNum*$e.BYTES_PIDX,n._numEle=0;var r=t._nBlendType;n._blendFn=t._targets?cn.targetFns[r]:cn.fns[r],n.shaderValue=i,n.shaderValue.setValue(t._shader2D);var s=t._shader2D.filters;return s&&n.shaderValue.setFilters(s),n},a.createShape=function(t,e,i,n){var r=a._poolSize?a.POOL[--a._poolSize]:new a;r._mesh=e,r._numEle=i,r._startIdx=2*e.indexNum,r._ref=1,r.shaderValue=n,r.shaderValue.setValue(t._shader2D);var s=t._nBlendType;return r._key.blendShader=s,r._blendFn=t._targets?cn.targetFns[s]:cn.fns[s],r},a.TYPE_2D=1e4,a.TYPE_CANVAS=10003,a.TYPE_CMDSETRT=10004,a.TYPE_CUSTOM=10005,a.TYPE_BLURRT=10006,a.TYPE_CMDDESTORYPRERT=10007,a.TYPE_DISABLESTENCIL=10008,a.TYPE_OTHERIBVB=10009,a.TYPE_PRIMITIVE=10010,a.TYPE_RT=10011,a.TYPE_BLUR_RT=10012,a.TYPE_TARGET=10013,a.TYPE_CHANGE_VALUE=10014,a.TYPE_SHAPE=10015,a.TYPE_TEXTURE=10016,a.TYPE_FILLTEXTURE=10017,a.KEY_ONCE=-1,a.KEY_FILLRECT=1,a.KEY_DRAWTEXTURE=2,a.KEY_VG=3,a.KEY_TRIANGLES=4,a.RENDERBASE=null,a.ID=1,a.preRender=null,a._poolSize=0,a.POOL=[],a}(),Et=function(){function l(){}I(l,"laya.display.cmd.FillTextureCmd");var t=l.prototype;return t.recover=function(){this.texture=null,this.offset=null,this.other=null,p.recover("FillTextureCmd",this)},t.run=function(t,e,i){t.fillTexture(this.texture,this.x+e,this.y+i,this.width,this.height,this.type,this.offset,this.other)},g(0,t,"cmdID",function(){return"FillTexture"}),l.create=function(t,e,i,n,r,s,a,o){var h=p.getItemByClass("FillTextureCmd",l);return h.texture=t,h.x=e,h.y=i,h.width=n,h.height=r,h.type=s,h.offset=a,h.other=o,h},l.ID="FillTexture",l}(),xt=function(){function t(){this._glRender=null}I(t,"laya.filters.Filter");var e=t.prototype;return T.imps(e,{"laya.filters.IFilter":!0}),g(0,e,"type",function(){return-1}),t.BLUR=16,t.COLOR=32,t.GLOW=8,t._filter=function(t,e,i,n){var r=e,s=this._next;if(s){var a=t.filters,o=a.length;if(1==o&&32==a[0].type)return e.save(),e.setColorFilter(a[0]),s._fun.call(s,t,e,i,n),void e.restore();var h,l=Ot.create(1,0),u=R.TEMP,c=r._curMat,_=It.create();c.copyTo(_);var d=0,f=0,p=null,m=t._cacheStyle.filterCache||null;if(m&&0==t.getRepaint()){if((t._cacheStyle.hasGlowFilter||!1)&&(d=50,f=25),(h=t.getBounds()).width<=0||h.height<=0)return;h.width+=d,h.height+=d,u.x=h.x*_.a+h.y*_.c,u.y=h.y*_.d+h.x*_.b,h.x=u.x,h.y=u.y,u.x=h.width*_.a+h.height*_.c,u.y=h.height*_.d+h.width*_.b,h.width=u.x,h.height=u.y}else{t._isHaveGlowFilter()&&(d=50,f=25),(h=new ve).copyFrom(t.getSelfBounds()),h.x+=t.x,h.y+=t.y,h.x-=t.pivotX+4,h.y-=t.pivotY+4;var g=h.x,v=h.y;if(h.width+=d+8,h.height+=d+8,u.x=h.x*_.a+h.y*_.c,u.y=h.y*_.d+h.x*_.b,h.x=u.x,h.y=u.y,u.x=h.width*_.a+h.height*_.c,u.y=h.height*_.d+h.width*_.b,h.width=u.x,h.height=u.y,h.width<=0||h.height<=0)return;m&&ce.releaseRT(m),p=ce.getRT(h.width,h.height);var T=m=ce.getRT(h.width,h.height);t._getCacheStyle().filterCache=m,r.pushRT(),r.useRT(p);var y=t.x-g+f,E=t.y-v+f;s._fun.call(s,t,e,y,E),r.useRT(T);for(var x=0;x<o;x++){0!=x&&(r.useRT(p),r.drawTarget(T,0,0,h.width,h.height,It.TEMP.identity(),l,null,cn.TOINT.overlay),r.useRT(T));var S=a[x];switch(S.type){case 16:case 8:S._glRender&&S._glRender.render(p,e,h.width,h.height,S);break;case 32:r.setColorFilter(S),r.drawTarget(p,0,0,h.width,h.height,It.EMPTY.identity(),Ot.create(1,0)),r.setColorFilter(null)}}r.popRT()}if(i=i-f-t.x,n=n-f-t.y,u.setTo(i,n),_.transformPoint(u),i=u.x+h.x,n=u.y+h.y,r._drawRenderTexture(m,i,n,h.width,h.height,It.TEMP.identity(),1,da.defuv),p){var C=Yt.create([p],function(t){t.destroy()},this);p=null,e.addRenderObject(C)}_.destroy()}},t}(),St=function(){function n(){}I(n,"laya.display.cmd.DrawTexturesCmd");var t=n.prototype;return t.recover=function(){this.texture._removeReference(),this.texture=null,this.pos=null,p.recover("DrawTexturesCmd",this)},t.run=function(t,e,i){t.drawTextures(this.texture,this.pos,e,i)},g(0,t,"cmdID",function(){return"DrawTextures"}),n.create=function(t,e){var i=p.getItemByClass("DrawTexturesCmd",n);return(i.texture=t)._addReference(),i.pos=e,i},n.ID="DrawTextures",n}(),It=function(){function o(t,e,i,n,r,s,a){if(this._bTransform=!1,void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===r&&(r=0),void 0===s&&(s=0),void 0===a&&(a=0),null!=o._createFun)return o._createFun(t,e,i,n,r,s,a);this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s,this._checkTransform()}I(o,"laya.maths.Matrix");var t=o.prototype;return t.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this._bTransform=!1,this},t._checkTransform=function(){return this._bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},t.setTranslate=function(t,e){return this.tx=t,this.ty=e,this},t.translate=function(t,e){return this.tx+=t,this.ty+=e,this},t.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this._bTransform=!0,this},t.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.c,s=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=s*e-this.ty*i,this.ty=s*i+this.ty*e,this._bTransform=!0,this},t.skew=function(t,e){var i=Math.tan(t),n=Math.tan(e),r=this.a,s=this.b;return this.a+=n*this.c,this.b+=n*this.d,this.c+=i*r,this.d+=i*s,this},t.invertTransformPoint=function(t){var e=this.a,i=this.b,n=this.c,r=this.d,s=this.tx,a=e*r-i*n,o=r/a,h=-i/a,l=-n/a,u=e/a,c=(n*this.ty-r*s)/a,_=-(e*this.ty-i*s)/a;return t.setTo(o*t.x+l*t.y+c,h*t.x+u*t.y+_)},t.transformPoint=function(t){return t.setTo(this.a*t.x+this.c*t.y+this.tx,this.b*t.x+this.d*t.y+this.ty)},t.transformPointN=function(t){return t.setTo(this.a*t.x+this.c*t.y,this.b*t.x+this.d*t.y)},t.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},t.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},t.invert=function(){var t=this.a,e=this.b,i=this.c,n=this.d,r=this.tx,s=t*n-e*i;return this.a=n/s,this.b=-e/s,this.c=-i/s,this.d=t/s,this.tx=(i*this.ty-n*r)/s,this.ty=-(t*this.ty-e*r)/s,this},t.setTo=function(t,e,i,n,r,s){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=s,this},t.concat=function(t){var e=this.a,i=this.c,n=this.tx;return this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d,this.tx=n*t.a+this.ty*t.c+t.tx,this.ty=n*t.b+this.ty*t.d+t.ty,this},t.scaleEx=function(t,e){var i=this.a,n=this.b,r=this.c,s=this.d;this.d=(this.c=0!==n||0!==r?(this.a=t*i,this.b=t*n,e*r):(this.a=t*i,this.b=0*s,0*i),e*s),this._bTransform=!0},t.rotateEx=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.b,s=this.c,a=this.d;this.d=0!==r||0!==s?(this.a=e*n+i*s,this.b=e*r+i*a,this.c=-i*n+e*s,-i*r+e*a):(this.a=e*n,this.b=i*a,this.c=-i*n,e*a),this._bTransform=!0},t.clone=function(){var t=o.create();return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t._bTransform=this._bTransform,t},t.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t._bTransform=this._bTransform,t},t.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},t.destroy=function(){this.recover()},t.recover=function(){p.recover("Matrix",this.identity())},o.mul=function(t,e,i){var n=t.a,r=t.b,s=t.c,a=t.d,o=t.tx,h=t.ty,l=e.a,u=e.b,c=e.c,_=e.d,d=e.tx,f=e.ty;return i.ty=0!==u||0!==c?(i.a=n*l+r*c,i.b=n*u+r*_,i.c=s*l+a*c,i.d=s*u+a*_,i.tx=l*o+c*h+d,u*o+_*h+f):(i.a=n*l,i.b=r*_,i.c=s*l,i.d=a*_,i.tx=l*o+d,_*h+f),i},o.mul16=function(t,e,i){var n=t.a,r=t.b,s=t.c,a=t.d,o=t.tx,h=t.ty,l=e.a,u=e.b,c=e.c,_=e.d,d=e.tx,f=e.ty;return i[13]=0!==u||0!==c?(i[0]=n*l+r*c,i[1]=n*u+r*_,i[4]=s*l+a*c,i[5]=s*u+a*_,i[12]=l*o+c*h+d,u*o+_*h+f):(i[0]=n*l,i[1]=r*_,i[4]=s*l,i[5]=a*_,i[12]=l*o+d,_*h+f),i},o.create=function(){return p.getItemByClass("Matrix",o)},o.EMPTY=new o,o.TEMP=new o,o._createFun=null,o}(),Rt=function(){function t(){}return I(t,"laya.system.System"),t.changeDefinition=function(t,e){T[t]=e;var i=t+"=classObj";T._runScript(i)},t.__init__=function(){},t}(),At=function(){function p(){}return I(p,"laya.webgl.shapes.Earcut"),p.earcut=function(t,e,i){i=i||2;var n,r,s,a,o,h,l,u=e&&e.length,c=u?e[0]*i:t.length,_=p.linkedList(t,0,c,i,!0),d=[];if(!_)return d;if(u&&(_=p.eliminateHoles(t,e,_,i)),t.length>80*i){n=s=t[0],r=a=t[1];for(var f=i;f<c;f+=i)(o=t[f])<n&&(n=o),(h=t[f+1])<r&&(r=h),s<o&&(s=o),a<h&&(a=h);l=0!==(l=Math.max(s-n,a-r))?1/l:0}return p.earcutLinked(_,d,i,n,r,l),d},p.linkedList=function(t,e,i,n,r){var s,a;if(r===0<p.signedArea(t,e,i,n))for(s=e;s<i;s+=n)a=p.insertNode(s,t[s],t[s+1],a);else for(s=i-n;e<=s;s-=n)a=p.insertNode(s,t[s],t[s+1],a);return a&&p.equals(a,a.next)&&(p.removeNode(a),a=a.next),a},p.filterPoints=function(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!p.equals(n,n.next)&&0!==p.area(n.prev,n,n.next))n=n.next;else{if(p.removeNode(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e},p.earcutLinked=function(t,e,i,n,r,s,a){if(t){!a&&s&&p.indexCurve(t,n,r,s);for(var o,h,l=t;t.prev!==t.next;)if(o=t.prev,h=t.next,s?p.isEarHashed(t,n,r,s):p.isEar(t))e.push(o.i/i),e.push(t.i/i),e.push(h.i/i),p.removeNode(t),t=h.next,l=h.next;else if((t=h)===l){a?1===a?(t=p.cureLocalIntersections(t,e,i),p.earcutLinked(t,e,i,n,r,s,2)):2===a&&p.splitEarcut(t,e,i,n,r,s):p.earcutLinked(p.filterPoints(t,null),e,i,n,r,s,1);break}}},p.isEar=function(t){var e=t.prev,i=t,n=t.next;if(0<=p.area(e,i,n))return!1;for(var r=t.next.next;r!==t.prev;){if(p.pointInTriangle(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&0<=p.area(r.prev,r,r.next))return!1;r=r.next}return!0},p.isEarHashed=function(t,e,i,n){var r=t.prev,s=t,a=t.next;if(0<=p.area(r,s,a))return!1;for(var o=r.x<s.x?r.x<a.x?r.x:a.x:s.x<a.x?s.x:a.x,h=r.y<s.y?r.y<a.y?r.y:a.y:s.y<a.y?s.y:a.y,l=r.x>s.x?r.x>a.x?r.x:a.x:s.x>a.x?s.x:a.x,u=r.y>s.y?r.y>a.y?r.y:a.y:s.y>a.y?s.y:a.y,c=p.zOrder(o,h,e,i,n),_=p.zOrder(l,u,e,i,n),d=t.nextZ;d&&d.z<=_;){if(d!==t.prev&&d!==t.next&&p.pointInTriangle(r.x,r.y,s.x,s.y,a.x,a.y,d.x,d.y)&&0<=p.area(d.prev,d,d.next))return!1;d=d.nextZ}for(d=t.prevZ;d&&d.z>=c;){if(d!==t.prev&&d!==t.next&&p.pointInTriangle(r.x,r.y,s.x,s.y,a.x,a.y,d.x,d.y)&&0<=p.area(d.prev,d,d.next))return!1;d=d.prevZ}return!0},p.cureLocalIntersections=function(t,e,i){var n=t;do{var r=n.prev,s=n.next.next;!p.equals(r,s)&&p.intersects(r,n,n.next,s)&&p.locallyInside(r,s)&&p.locallyInside(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),p.removeNode(n),p.removeNode(n.next),n=t=s),n=n.next}while(n!==t);return n},p.splitEarcut=function(t,e,i,n,r,s){var a=t;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&p.isValidDiagonal(a,o)){var h=p.splitPolygon(a,o);return a=p.filterPoints(a,a.next),h=p.filterPoints(h,h.next),p.earcutLinked(a,e,i,n,r,s),void p.earcutLinked(h,e,i,n,r,s)}o=o.next}a=a.next}while(a!==t)},p.eliminateHoles=function(t,e,i,n){var r,s,a,o,h,l=[];for(r=0,s=e.length;r<s;r++)a=e[r]*n,o=r<s-1?e[r+1]*n:t.length,(h=p.linkedList(t,a,o,n,!1))===h.next&&(h.steiner=!0),l.push(p.getLeftmost(h));for(l.sort(p.compareX),r=0;r<l.length;r++)p.eliminateHole(l[r],i),i=p.filterPoints(i,i.next);return i},p.compareX=function(t,e){return t.x-e.x},p.eliminateHole=function(t,e){if(e=p.findHoleBridge(t,e)){var i=p.splitPolygon(e,t);p.filterPoints(i,i.next)}},p.findHoleBridge=function(t,e){var i,n=e,r=t.x,s=t.y,a=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var o=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=r&&a<o){if((a=o)===r){if(s===n.y)return n;if(s===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===a)return i.prev;var h,l=i,u=i.x,c=i.y,_=1/0;for(n=i.next;n!==l;)r>=n.x&&n.x>=u&&r!==n.x&&p.pointInTriangle(s<c?r:a,s,u,c,s<c?a:r,s,n.x,n.y)&&((h=Math.abs(s-n.y)/(r-n.x))<_||h===_&&n.x>i.x)&&p.locallyInside(n,t)&&(i=n,_=h),n=n.next;return i},p.indexCurve=function(t,e,i,n){for(var r=t;null===r.z&&(r.z=p.zOrder(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,(r=r.next)!==t;);r.prevZ.nextZ=null,r.prevZ=null,p.sortLinked(r)},p.sortLinked=function(t){var e,i,n,r,s,a,o,h,l=1;do{for(i=t,s=t=null,a=0;i;){for(a++,n=i,e=o=0;e<l&&(o++,n=n.nextZ);e++);for(h=l;0<o||0<h&&n;)0!==o&&(0===h||!n||i.z<=n.z)?(i=(r=i).nextZ,o--):(n=(r=n).nextZ,h--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,l*=2}while(1<a);return t},p.zOrder=function(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1},p.getLeftmost=function(t){for(var e=t,i=t;e.x<i.x&&(i=e),(e=e.next)!==t;);return i},p.pointInTriangle=function(t,e,i,n,r,s,a,o){return 0<=(r-a)*(e-o)-(t-a)*(s-o)&&0<=(t-a)*(n-o)-(i-a)*(e-o)&&0<=(i-a)*(s-o)-(r-a)*(n-o)},p.isValidDiagonal=function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!p.intersectsPolygon(t,e)&&p.locallyInside(t,e)&&p.locallyInside(e,t)&&p.middleInside(t,e)},p.area=function(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)},p.equals=function(t,e){return t.x===e.x&&t.y===e.y},p.intersects=function(t,e,i,n){return!!(p.equals(t,e)&&p.equals(i,n)||p.equals(t,n)&&p.equals(i,e))||0<p.area(t,e,i)!=0<p.area(t,e,n)&&0<p.area(i,n,t)!=0<p.area(i,n,e)},p.intersectsPolygon=function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&p.intersects(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1},p.locallyInside=function(t,e){return p.area(t.prev,t,t.next)<0?0<=p.area(t,e,t.next)&&0<=p.area(t,t.prev,e):p.area(t,e,t.prev)<0||p.area(t,t.next,e)<0},p.middleInside=function(t,e){for(var i=t,n=!1,r=(t.x+e.x)/2,s=(t.y+e.y)/2;i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),(i=i.next)!==t;);return n},p.splitPolygon=function(t,e){var i=new it(t.i,t.x,t.y),n=new it(e.i,e.x,e.y),r=t.next,s=e.prev;return(t.next=e).prev=t,(i.next=r).prev=i,(n.next=i).prev=n,(s.next=n).prev=s,n},p.insertNode=function(t,e,i,n){var r=new it(t,e,i);return n?(r.next=n.next,(r.prev=n).next.prev=r,n.next=r):(r.prev=r).next=r,r},p.removeNode=function(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)},p.signedArea=function(t,e,i,n){for(var r=0,s=e,a=i-n;s<i;s+=n)r+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return r},p}(),Mt=function(){function t(){this.blendShader=0,this.submitType=0,this.other=0,this.clear()}I(t,"laya.webgl.submit.SubmitKey");var e=t.prototype;return e.clear=function(){this.submitType=-1,this.blendShader=this.other=0},e.copyFrom=function(t){this.other=t.other,this.blendShader=t.blendShader,this.submitType=t.submitType},e.copyFrom2=function(t,e,i){this.other=i,this.submitType=e},e.equal3_2=function(t,e,i){return this.submitType===e&&this.other===i&&this.blendShader===t.blendShader},e.equal4_2=function(t,e,i){return this.submitType===e&&this.other===i&&this.blendShader===t.blendShader},e.equal_3=function(t){return this.submitType===t.submitType&&this.blendShader===t.blendShader},e.equal=function(t){return this.other===t.other&&this.submitType===t.submitType&&this.blendShader===t.blendShader},t}(),Dt=function(){function e(t,e,i){this._stride=0,this.vertNum=0,this.indexNum=0,this._applied=!1,this._vb=null,this._ib=null,this._vao=null,this._attribInfo=null,this._quadNum=0,this.canReuse=!1,this._stride=t,this._vb=new _s(t,35048),e?this._vb._resizeBuffer(e,!1):Tn.webGL2D_MeshAllocMaxMem&&this._vb._resizeBuffer(65536*t,!1),this._ib=new Ts,i&&this._ib._resizeBuffer(i,!1)}I(e,"laya.webgl.utils.Mesh2D");var t=e.prototype;return t.cloneWithNewVB=function(){var t=new e(this._stride,0,0);return t._ib=this._ib,t._quadNum=this._quadNum,t._attribInfo=this._attribInfo,t},t.cloneWithNewVBIB=function(){var t=new e(this._stride,0,0);return t._attribInfo=this._attribInfo,t},t.getVBW=function(){return this._vb.setNeedUpload(),this._vb},t.getVBR=function(){return this._vb},t.getIBR=function(){return this._ib},t.getIBW=function(){return this._ib.setNeedUpload(),this._ib},t.createQuadIB=function(t){this._quadNum=t,this._ib._resizeBuffer(6*t*2,!1),this._ib.byteLength=this._ib.bufferLength;for(var e=this._ib.getUint16Array(),i=0,n=0,r=0;r<t;r++)e[i++]=n,e[i++]=n+2,e[i++]=n+1,e[i++]=n,e[i++]=n+3,e[i++]=n+2,n+=4;this._ib.setNeedUpload()},t.setAttributes=function(t){if(this._attribInfo=t,this._attribInfo.length%3!=0)throw"Mesh2D setAttributes error!"},t.configVAO=function(t){if(!this._applied){this._applied=!0,this._vao||(this._vao=new kn),this._vao.bind(),this._vb._bindForVAO(),this._ib.setNeedUpload(),this._ib._bind_uploadForVAO();for(var e=this._attribInfo.length/3,i=0,n=0;n<e;n++){var r=this._attribInfo[i+1],s=this._attribInfo[i],a=this._attribInfo[i+2];t.enableVertexAttribArray(n),t.vertexAttribPointer(n,r,s,!1,this._stride,a),i+=3}this._vao.unBind()}},t.useMesh=function(t){this._applied||this.configVAO(t),this._vao.bind(),this._vb.bind(),this._ib._bind_upload()||this._ib.bind(),this._vb._bind_upload()||this._vb.bind()},t.getEleNum=function(){return this._ib.getBuffer().byteLength/2},t.releaseMesh=function(){},t.destroy=function(){},t.clearVB=function(){this._vb.clear()},e._gvaoid=0,e}(),bt=(function(){function t(){}I(t,"laya.d3.animation.AnimatorStateScript");var e=t.prototype;e.onStateEnter=function(){},e.onStateUpdate=function(){},e.onStateExit=function(){}}(),function(){function t(){this._material=null,this._mesh=Vn.instance}I(t,"laya.d3.resource.models.SkyRenderer");var e=t.prototype;return e._isAvailable=function(){return this._material&&this._mesh},e._render=function(t){if(this._material&&this._mesh){var e=Nt.instance,i=t.scene,n=t.camera;j.setCullFace(e,!1),j.setDepthFunc(e,515),j.setDepthMask(e,!1);var r=t.shader=this._material._shader.getSubShaderAt(0)._passes[0].withCompile(0,0,this._material._defineDatas.value),s=r.bind(),a=$i.loopCount!==r._uploadMark,o=r._uploadScene!==i||a;(o||s)&&(r.uploadUniforms(r._sceneUniformParamsMap,i._shaderValues,o),r._uploadScene=i);var h=r._uploadCamera!==n||a;(h||s)&&(r.uploadUniforms(r._cameraUniformParamsMap,n._shaderValues,h),r._uploadCamera=n);var l=r._uploadMaterial!==this._material||a;(l||s)&&(r.uploadUniforms(r._materialUniformParamsMap,this._material._shaderValues,l),r._uploadMaterial=this._material),this._mesh._bufferState.bind(),this._mesh._render(t),j.setDepthFunc(e,513),j.setDepthMask(e,!0)}},e.destroy=function(){this._material&&(this._material._removeReference(),this._material=null)},g(0,e,"mesh",function(){return this._mesh},function(t){this._mesh!==t&&(this._mesh=t)}),g(0,e,"material",function(){return this._material},function(t){this._material!==t&&(this._material&&this._material._removeReference(),t&&t._addReference(),this._material=t)}),t}()),wt=function(){function e(){this._batchRenderElementPool=[]}I(e,"laya.d3.graphics.DynamicBatchManager");var t=e.prototype;return t._clear=function(){this._batchRenderElementPoolIndex=0},t._getBatchRenderElementFromPool=function(){throw"StaticBatch:must override this function."},t.dispose=function(){},e._registerManager=function(t){e._managers.push(t)},e._managers=[],e}(),Lt=function(){function t(){this.updateMark=-1,this.indexInList=-1,this.batched=!1}return I(t,"laya.d3.core.render.BatchMark"),t}(),Ot=function(){function n(t,e){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this.ref=1,this._cacheID=0,this.clipMatDir=[99999999,0,0,99999999],this.clipMatPos=[0,0],this.clipOff=[0,0],this.defines=new er,this.mainID=t,this.subID=e,this.textureHost=null,this.texture=null,this.color=null,this.colorAdd=null,this.u_mmat2=null,this._cacheID=t|e,this._inClassCache=n._cache[this._cacheID],0<t&&!this._inClassCache&&(this._inClassCache=n._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}I(n,"laya.webgl.shader.d2.value.Value2D");var t=n.prototype;return t.setValue=function(t){},t._ShaderWithCompile=function(){return As.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,ha.create,this._attribLocation)},t.upload=function(){var t=Q;Q.worldMatrix4===Q.TEMPMAT4_ARRAY||this.defines.addInt(128),this.mmat=t.worldMatrix4,Q.matWVP&&(this.defines.addInt(2048),this.u_MvpMatrix=Q.matWVP.elements);var e=As.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();e._shaderValueWidth!==t.width||e._shaderValueHeight!==t.height?(this.size[0]=t.width,this.size[1]=t.height,e._shaderValueWidth=t.width,e._shaderValueHeight=t.height,e.upload(this,null)):e.upload(this,e._params2dQuick2||e._make2dQuick2())},t.setFilters=function(t){if(this.filters=t)for(var e,i=t.length,n=0;n<i;n++)(e=t[n])&&(this.defines.add(e.type),e.action.setValue(this))},t.clear=function(){this.defines._value=this.subID+(en.shaderHighPrecision?1024:0),this.clipOff[0]=0},t.release=function(){--this.ref<1&&(this._inClassCache&&(this._inClassCache[this._inClassCache._length++]=this),this.clear(),this.filters=null,this.ref=1,this.clipOff[0]=0)},n._initone=function(t,e){n._typeClass[t]=e,n._cache[t]=[],n._cache[t]._length=0},n.__init__=function(){n._initone(4,Wr),n._initone(512,Xr),n._initone(1,hr),n._initone(9,hr)},n.create=function(t,e){var i=n._cache[t|e];return i._length?i[--i._length]:new n._typeClass[t|e](e)},n._cache=[],n._typeClass=[],n.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n}(),Nt=function(){function t(){}I(t,"laya.layagl.LayaGL");var e=t.prototype;return e.createCommandEncoder=function(t,e,i){return void 0===t&&(t=128),void 0===e&&(e=64),void 0===i&&(i=!1),new Oi(this,t,e,i)},e.beginCommandEncoding=function(t){},e.endCommandEncoding=function(){},e.matrix4x4Multiply=function(t,e,i){},e.evaluateClipDatasRealTime=function(t,e,i,n){},t.getFrameCount=function(){return 0},t.syncBufferToRenderThread=function(t,e){void 0===e&&(e=0)},t.createArrayBufferRef=function(t,e,i){},t.createArrayBufferRefs=function(t,e,i,n){},t.EXECUTE_JS_THREAD_BUFFER=0,t.EXECUTE_RENDER_THREAD_BUFFER=1,t.EXECUTE_COPY_TO_RENDER=2,t.EXECUTE_COPY_TO_RENDER3D=3,t.ARRAY_BUFFER_TYPE_DATA=0,t.ARRAY_BUFFER_TYPE_CMD=1,t.ARRAY_BUFFER_REF_REFERENCE=0,t.ARRAY_BUFFER_REF_COPY=1,t.UPLOAD_SHADER_UNIFORM_TYPE_ID=0,t.UPLOAD_SHADER_UNIFORM_TYPE_DATA=1,t.instance=null,t}(),Pt=function(){function g(t,e){this.normal=null,this.distance=NaN,void 0===e&&(e=0),this.normal=t,this.distance=e}return I(g,"laya.d3.math.Plane"),g.prototype.normalize=function(){var t=this.normal.x,e=this.normal.y,i=this.normal.z,n=1/Math.sqrt(t*t+e*e+i*i);this.normal.x=t*n,this.normal.y=e*n,this.normal.z=i*n,this.distance*=n},g.createPlaneBy3P=function(t,e,i){var n=e.x-t.x,r=e.y-t.y,s=e.z-t.z,a=i.x-t.x,o=i.y-t.y,h=i.z-t.z,l=r*h-s*o,u=s*a-n*h,c=n*o-r*a,_=1/Math.sqrt(l*l+u*u+c*c),d=l*_,f=u*_,p=c*_;g._TEMPVec3.x=d,g._TEMPVec3.y=f,g._TEMPVec3.z=p;var m=-(d*t.x+f*t.y+p*t.z);return new g(g._TEMPVec3,m)},g.PlaneIntersectionType_Back=0,g.PlaneIntersectionType_Front=1,g.PlaneIntersectionType_Intersecting=2,E(g,["_TEMPVec3",function(){return this._TEMPVec3=new ln}]),g}(),Ft=function(){function u(t,e){this.center=null,this.radius=NaN,this.center=t,this.radius=e}I(u,"laya.d3.math.BoundSphere");var t=u.prototype;return T.imps(t,{"laya.d3.core.IClone":!0}),t.toDefault=function(){this.center.toDefault(),this.radius=0},t.intersectsRayDistance=function(t){return st.intersectsRayAndSphereRD(t,this)},t.intersectsRayPoint=function(t,e){return st.intersectsRayAndSphereRP(t,this,e)},t.cloneTo=function(t){var e=t;this.center.cloneTo(e.center),e.radius=this.radius},t.clone=function(){var t=new this.constructor(new ln,new ln);return this.cloneTo(t),t},u.createFromSubPoints=function(t,e,i,n){if(null==t)throw new Error("points");if(e<0||e>=t.length)throw new Error("start"+e+"Must be in the range [0, "+(t.length-1)+"]");if(i<0||e+i>t.length)throw new Error("count"+i+"Must be in the range <= "+t.length+"}");var r=e+i,s=u._tempVector3;s.x=0,s.y=0,s.z=0;for(var a=e;a<r;++a)ln.add(t[a],s,s);var o=n.center;ln.scale(s,1/i,o);var h=0;for(a=e;a<r;++a){var l=ln.distanceSquared(o,t[a]);h<l&&(h=l)}n.radius=Math.sqrt(h)},u.createfromPoints=function(t,e){if(null==t)throw new Error("points");u.createFromSubPoints(t,0,t.length,e)},E(u,["_tempVector3",function(){return this._tempVector3=new ln}]),u}(),Bt=function(){function o(){this._initBatchSprites=[],this._staticBatches={},this._batchRenderElementPoolIndex=0,this._batchRenderElementPool=[]}I(o,"laya.d3.graphics.StaticBatchManager");var t=o.prototype;return t._partition=function(t,e,i){for(var n=t[Math.floor((i+e)/2)];e<=i;){for(;this._compare(t[e],n)<0;)e++;for(;0<this._compare(t[i],n);)i--;if(e<i){var r=t[e];t[e]=t[i],t[i]=r,e++,i--}else if(e===i){e++;break}}return e},t._quickSort=function(t,e,i){if(1<t.length){var n=this._partition(t,e,i),r=n-1;e<r&&this._quickSort(t,e,r),n<i&&this._quickSort(t,n,i)}},t._compare=function(t,e){throw"StaticBatch:must override this function."},t._initStaticBatchs=function(t){throw"StaticBatch:must override this function."},t._getBatchRenderElementFromPool=function(){throw"StaticBatch:must override this function."},t._addBatchSprite=function(t){this._initBatchSprites.push(t)},t._clear=function(){this._batchRenderElementPoolIndex=0},t._garbageCollection=function(){throw"StaticBatchManager: must override it."},t.dispose=function(){this._staticBatches=null},o._registerManager=function(t){o._managers.push(t)},o._addToStaticBatchQueue=function(t,e){t instanceof laya.d3.core.RenderableSprite3D&&t.isStatic&&e.push(t);for(var i=0,n=t.numChildren;i<n;i++)o._addToStaticBatchQueue(t._children[i],e)},o.combine=function(t,e){e||(e=[],t&&o._addToStaticBatchQueue(t,e));var i=e.length;if(0<i){for(var n=0;n<i;n++){var r=e[n];r.isStatic&&r._addToInitStaticBatchManager()}for(var s=0,a=o._managers.length;s<a;s++){o._managers[s]._initStaticBatchs(t)}}},o._managers=[],o}(),Vt=function(){function p(){}return I(p,"laya.utils.Browser"),g(1,p,"container",function(){return p._container||(p.__init__(),(p._container=p.createElement("div")).id="layaContainer",p._document.body.appendChild(p._container)),p._container},function(t){p._container=t}),g(1,p,"pixelRatio",function(){if(p._pixelRatio<0)if(p.__init__(),-1<p.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)"))p._pixelRatio=2;else{var t=p.context,e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;(p._pixelRatio=(p._window.devicePixelRatio||1)/e)<1&&(p._pixelRatio=1)}return p._pixelRatio}),g(1,p,"document",function(){return p.__init__(),p._document}),g(1,p,"clientHeight",function(){return p.__init__(),p._window.innerHeight||p._document.body.clientHeight||p._document.documentElement.clientHeight}),g(1,p,"window",function(){return p._window||p.__init__()}),g(1,p,"height",function(){return p.__init__(),(T.stage&&T.stage.canvasRotation?p.clientWidth:p.clientHeight)*p.pixelRatio}),g(1,p,"width",function(){return p.__init__(),(T.stage&&T.stage.canvasRotation?p.clientHeight:p.clientWidth)*p.pixelRatio}),g(1,p,"clientWidth",function(){return p.__init__(),p._window.innerWidth||p._document.body.clientWidth}),p.__init__=function(){if(p._window)return p._window;var e=p._window=m,t=p._document=e.document,i=p.userAgent=e.navigator.userAgent,n=e._layalibs;if(n){n.sort(function(t,e){return t.i-e.i});for(var r=0;r<n.length;r++)n[r].f(e,t,T)}-1<i.indexOf("MiniGame")&&p.window.hasOwnProperty("wx")&&(T.MiniAdpter?T.MiniAdpter.enable():console.error("请先添加小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?nav=zh-ts-5-0-0")),-1<i.indexOf("SwanGame")&&(T.BMiniAdapter?T.BMiniAdapter.enable():console.error("请先添加百度小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?nav=zh-ts-5-0-0")),"function"==typeof getApp&&(T.KGMiniAdapter?T.KGMiniAdapter.enable():console.error("请先添加小米小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?nav=zh-ts-5-0-0")),-1<i.indexOf("OPPO")&&-1<i.indexOf("MiniGame")&&(T.QGMiniAdapter?T.QGMiniAdapter.enable():console.error("请先添加OPPO小游戏适配库")),e.trace=console.log,e.requestAnimationFrame=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(t){return e.setTimeout(t,1e3/60)};var s=t.body.style;s.margin=0,s.overflow="hidden",s["-webkit-user-select"]="none",s["-webkit-tap-highlight-color"]="rgba(200,200,200,0)";for(var a=t.getElementsByTagName("meta"),o=0,h=!1,l="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no";o<a.length;){var u=a[o];if("viewport"==u.name){u.content=l,h=!0;break}o++}h||((u=t.createElement("meta")).name="viewport",u.content=l,t.getElementsByTagName("head")[0].appendChild(u)),p.onMobile=!!m.isConchApp||-1<i.indexOf("Mobile"),p.onIOS=!!i.match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),p.onIPhone=-1<i.indexOf("iPhone"),p.onMac=-1<i.indexOf("Mac OS X"),p.onIPad=-1<i.indexOf("iPad"),p.onAndroid=-1<i.indexOf("Android")||-1<i.indexOf("Adr"),p.onWP=-1<i.indexOf("Windows Phone"),p.onQQBrowser=-1<i.indexOf("QQBrowser"),p.onMQQBrowser=-1<i.indexOf("MQQBrowser")||-1<i.indexOf("Mobile")&&-1<i.indexOf("QQ"),p.onIE=!!e.ActiveXObject||"ActiveXObject"in e,p.onWeiXin=-1<i.indexOf("MicroMessenger"),p.onSafari=-1<i.indexOf("Safari"),p.onPC=!p.onMobile,p.onMiniGame=-1<i.indexOf("MiniGame"),p.onBDMiniGame=-1<i.indexOf("SwanGame"),-1<i.indexOf("OPPO")&&-1<i.indexOf("MiniGame")&&(p.onQGMiniGame=!0,p.onMiniGame=!1),p.onLimixiu=-1<i.indexOf("limixiu"),p.onKGMiniGame=-1<i.indexOf("QuickGame"),p.supportLocalStorage=hn.__init__(),p.supportWebAudio=Li.__init__(),qi._mainCanvas=new Ys(!0);var c=qi._mainCanvas.source.style;c.position="absolute",c.top=c.left="0px",c.background="#000000",p.canvas=new Ys(!0),p.context=p.canvas.getContext("2d");var _=new Ys(!0);laya.utils.Browser.onQGMiniGame&&(_=qi._mainCanvas);var d=["webgl","experimental-webgl","webkit-3d","moz-webgl"],f=null;for(o=0;o<d.length;o++){try{f=_.source.getContext(d[o])}catch(t){}if(f){p._supportWebGL=!0;break}}return e},p.createElement=function(t){return p.__init__(),p._document.createElement(t)},p.getElementById=function(t){return p.__init__(),p._document.getElementById(t)},p.removeElement=function(t){t&&t.parentNode&&t.parentNode.removeChild(t)},p.now=function(){return Date.now()},p.userAgent=null,p.onMobile=!1,p.onIOS=!1,p.onMac=!1,p.onIPhone=!1,p.onIPad=!1,p.onAndroid=!1,p.onWP=!1,p.onQQBrowser=!1,p.onMQQBrowser=!1,p.onSafari=!1,p.onIE=!1,p.onWeiXin=!1,p.onPC=!1,p.onMiniGame=!1,p.onBDMiniGame=!1,p.onKGMiniGame=!1,p.onQGMiniGame=!1,p.onLimixiu=!1,p.onFirefox=!1,p.onEdge=!1,p.supportWebAudio=!1,p.supportLocalStorage=!1,p.canvas=null,p.context=null,p._window=null,p._document=null,p._container=null,p._pixelRatio=-1,p._supportWebGL=!1,p}(),Ut=function(){function l(t,e,i,n){this._children=[],this.transform=new fr(this,t,e,i,n)}I(l,"laya.d3.animation.AnimationNode");var t=l.prototype;return T.imps(t,{"laya.d3.core.IClone":!0}),t.addChild=function(t){t._parent=this,t.transform.setParent(this.transform),this._children.push(t)},t.removeChild=function(t){var e=this._children.indexOf(t);-1!==e&&this._children.splice(e,1)},t.getChildByName=function(t){for(var e=0,i=this._children.length;e<i;e++){var n=this._children[e];if(n.name===t)return n}return null},t.getChildByIndex=function(t){return this._children[t]},t.getChildCount=function(){return this._children.length},t.cloneTo=function(t){var e=t;e.name=this.name;for(var i=0,n=this._children.length;i<n;i++){var r=this._children[i],s=r.clone();e.addChild(s);var a=r.transform,o=s.transform,h=o.localPosition,l=o.localRotation,u=o.localScale;a.localPosition.cloneTo(h),a.localRotation.cloneTo(l),a.localScale.cloneTo(u),o.localPosition=h,o.localRotation=l,o.localScale=u}},t.clone=function(){var t=new l;return this.cloneTo(t),t},t._cloneNative=function(t,e,i,n,r,s,a){var o=a._nativeCurCloneCount;r[o]=s;var h=new l(new Float32Array(t.buffer,3*o*4,3),new Float32Array(e.buffer,4*o*4,4),new Float32Array(i.buffer,3*o*4,3),new Float32Array(n.buffer,16*o*4,16));return h._worldMatrixIndex=o,this._cloneToNative(h,t,e,i,n,r,o,a),h},t._cloneToNative=function(t,e,i,n,r,s,a,o){var h=t;h.name=this.name;for(var l=0,u=this._children.length;l<u;l++){var c=this._children[l];o._nativeCurCloneCount++;var _=c._cloneNative(e,i,n,r,s,a,o);h.addChild(_);var d=c.transform,f=_.transform,p=f.localPosition,m=f.localRotation,g=f.localScale;d.localPosition.cloneTo(p),d.localRotation.cloneTo(m),d.localScale.cloneTo(g),f.localPosition=p,f.localRotation=m,f.localScale=g}},l}(),zt=function(){function t(){this.ALPHA=1,this.shaderType=0,this.defines=new er,this.fillStyle=Ye.DEFAULT,this.strokeStyle=Ye.DEFAULT}return I(t,"laya.webgl.shader.d2.Shader2D"),t.prototype.destroy=function(){this.defines=null,this.filters=null},t.__init__=function(){var t,e;t="/*\n\ttexture和fillrect使用的。\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\t\t// 这个是全局的，不用再应用矩阵了。\nvarying vec2 cliped;\nuniform vec2 size;\nuniform vec2 clipOff;\t\t\t// 使用要把clip偏移。cacheas normal用. 只用了[0]\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\n#ifdef MVP3D\n\tuniform mat4 u_MvpMatrix;\n#endif\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n\tvec4 pos = vec4(posuv.xy,0.,1.);\n#ifdef WORLDMAT\n\tpos=mmat*pos;\n#endif\n\tvec4 pos1  =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#ifdef MVP3D\n\tgl_Position=u_MvpMatrix*pos1;\n#else\n\tgl_Position=pos1;\n#endif\n\tv_texcoordAlpha.xy = posuv.zw;\n\t//v_texcoordAlpha.z = attribColor.a/255.0;\n\tv_color = attribColor/255.0;\n\tv_color.xyz*=v_color.w;//反正后面也要预乘\n\t\n\tv_useTex = attribFlags.r/255.0;\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\t\n\tvec2 clpos = clipMatPos.xy;\n\t#ifdef WORLDMAT\n\t\t// 如果有mmat，需要修改clipMatPos,因为 这是cacheas normal （如果不是就错了）， clipMatPos被去掉了偏移\n\t\tif(clipOff[0]>0.0){\n\t\t\tclpos.x+=mmat[3].x;\t//tx\t最简单处理\n\t\t\tclpos.y+=mmat[3].y;\t//ty\n\t\t}\n\t#endif\n\tvec2 clippos = pos.xy - clpos;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//转成0到1之间。/clipw/clipw 表示clippos与normalize之后的clip朝向点积之后，再除以clipw\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n\n}",e="/*\n\ttexture和fillrect使用的。\n*/\n#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\nuniform sampler2D texture;\nvarying vec2 cliped;\n\n#ifdef BLUR_FILTER\nuniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoordAlpha.xy-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}\n#endif\n\n#ifdef COLOR_FILTER\nuniform vec4 colorAlpha;\nuniform mat4 colorMat;\n#endif\n\n#ifdef GLOW_FILTER\nuniform vec4 u_color;\nuniform vec4 u_blurInfo1;\nuniform vec4 u_blurInfo2;\n#endif\n\n#ifdef COLOR_ADD\nuniform vec4 colorAdd;\n#endif\n\n#ifdef FILLTEXTURE\t\nuniform vec4 u_TexRange;//startu,startv,urange, vrange\n#endif\nvoid main() {\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n\t\n#ifdef FILLTEXTURE\t\n   vec4 color= texture2D(texture, fract(v_texcoordAlpha.xy)*u_TexRange.zw + u_TexRange.xy);\n#else\n   vec4 color= texture2D(texture, v_texcoordAlpha.xy);\n#endif\n\n   if(v_useTex<=0.)color = vec4(1.,1.,1.,1.);\n   color.a*=v_color.w;\n   //color.rgb*=v_color.w;\n   color.rgb*=v_color.rgb;\n   gl_FragColor=color;\n   \n   #ifdef COLOR_ADD\n\tgl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\n\tgl_FragColor.xyz *= colorAdd.a;\n   #endif\n   \n   #ifdef BLUR_FILTER\n\tgl_FragColor =   blur();\n\tgl_FragColor.w*=v_color.w;   \n   #endif\n   \n   #ifdef COLOR_FILTER\n\tmat4 alphaMat =colorMat;\n\n\talphaMat[0][3] *= gl_FragColor.a;\n\talphaMat[1][3] *= gl_FragColor.a;\n\talphaMat[2][3] *= gl_FragColor.a;\n\n\tgl_FragColor = gl_FragColor * alphaMat;\n\tgl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n   #endif\n   \n   #ifdef GLOW_FILTER\n\tconst float c_IterationTime = 10.0;\n\tfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\n\tvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n\tvec2 vec2FilterDir = vec2(-(u_blurInfo1.z)/u_blurInfo2.x,-(u_blurInfo1.w)/u_blurInfo2.y);\n\tvec2 vec2FilterOff = vec2(u_blurInfo1.x/u_blurInfo2.x/c_IterationTime * 2.0,u_blurInfo1.y/u_blurInfo2.y/c_IterationTime * 2.0);\n\tfloat maxNum = u_blurInfo1.x * u_blurInfo1.y;\n\tvec2 vec2Off = vec2(0.0,0.0);\n\tfloat floatOff = c_IterationTime/2.0;\n\tfor(float i = 0.0;i<=c_IterationTime; ++i){\n\t\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\t\tvec4Color += texture2D(texture, v_texcoordAlpha.xy + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t\t}\n\t}\n\tgl_FragColor = vec4(u_color.rgb,vec4Color.a * u_blurInfo2.z);\n\tgl_FragColor.rgb *= gl_FragColor.a;   \n   #endif\n   \n}",As.preCompile2D(0,1,t,e,null),t="attribute vec4 position;\nattribute vec4 attribColor;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\nuniform mat4 u_mmat2;\n//uniform vec2 u_pos;\nuniform vec2 size;\nvarying vec4 color;\n//vec4 dirxy=vec4(0.9,0.1, -0.1,0.9);\n//vec4 clip=vec4(100.,30.,300.,600.);\nvarying vec2 cliped;\nvoid main(){\n\t\n#ifdef WORLDMAT\n\tvec4 pos=mmat*vec4(position.xy,0.,1.);\n\tgl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n#else\n\tgl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n#endif\t\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = position.xy - clipMatPos.xy;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//clipdir是带缩放的方向，由于上面clippos是在缩放后的空间计算的，所以需要把方向先normalize一下\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n  //pos2d.x = dot(clippos,dirx);\n  color=attribColor/255.;\n}",e="precision mediump float;\n//precision mediump float;\nvarying vec4 color;\n//uniform float alpha;\nvarying vec2 cliped;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor= color;// vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=color.a;\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n}",As.preCompile2D(0,4,t,e,null),t="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}",e="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}",As.preCompile2D(0,512,t,e,null)},t}(),Gt=function(){function t(){this.textureID=-1}return I(t,"laya.d3.shader.ShaderVariable"),t}(),Ht=function(){function t(t){this._minVertexDistance=NaN,this._widthMultiplier=NaN,this._time=NaN,this._widthCurve=null,this._colorGradient=null,this._textureMode=0,this._trialGeometry=null,this._totalLength=0,this._owner=null,this._curtime=0,this._trailRenderElementIndex=0,this._lastPosition=new ln,this.alignment=0,this._owner=t,this._initDefaultData(),this.addRenderElement()}I(t,"laya.d3.core.trail.TrailFilter");var e=t.prototype;return e.addRenderElement=function(){var t=this._owner._render,e=t._renderElements,i=t.sharedMaterials[0];i||(i=Hs.defaultMaterial);var n=new Wi;n.setTransform(this._owner._transform),n.render=t,n.material=i,this._trialGeometry=new Ir(this),n.setGeometry(this._trialGeometry),e.push(n)},e._update=function(t){var e=this._owner._render;this._curtime+=t.scene.timer._delta/1e3,e._shaderValues.setNumber(xa.CURTIME,this._curtime);var i=this._owner.transform.position,n=e._renderElements[0]._geometry;n._updateDisappear(),n._updateTrail(t.camera,this._lastPosition,i),n._updateVertexBufferUV(),i.cloneTo(this._lastPosition)},e._initDefaultData=function(){this.time=5,this.minVertexDistance=.1,this.widthMultiplier=1,this.textureMode=0;var t=[],e=new Gn;e.time=0,e.inTangent=0,e.outTangent=0,e.value=1,t.push(e);var i=new Gn;i.time=1,i.inTangent=0,i.outTangent=0,i.value=1,t.push(i),this.widthCurve=t;var n=new Fi(2,2);n.mode=0,n.addColorRGB(0,pe.WHITE),n.addColorRGB(1,pe.WHITE),n.addColorAlpha(0,1),n.addColorAlpha(1,1),this.colorGradient=n},e.destroy=function(){this._trialGeometry.destroy(),this._trialGeometry=null,this._widthCurve=null,this._colorGradient=null},g(0,e,"textureMode",function(){return this._textureMode},function(t){this._textureMode=t}),g(0,e,"colorGradient",function(){return this._colorGradient},function(t){this._colorGradient=t,this._owner._render._shaderValues.setBuffer(xa.GRADIENTCOLORKEY,t._rgbElements),this._owner._render._shaderValues.setBuffer(xa.GRADIENTALPHAKEY,t._alphaElements),0==t.mode?this._owner._render._defineDatas.add(xa.SHADERDEFINE_GRADIENTMODE_BLEND):this._owner._render._defineDatas.remove(xa.SHADERDEFINE_GRADIENTMODE_BLEND)}),g(0,e,"widthCurve",function(){return this._widthCurve},function(t){this._widthCurve=t;var e,i=new Float32Array(4*t.length),n=0,r=0;for(n=0,e=t.length;n<e;n++)i[r++]=t[n].time,i[r++]=t[n].inTangent,i[r++]=t[n].outTangent,i[r++]=t[n].value;this._owner._render._shaderValues.setBuffer(xa.WIDTHCURVE,i),this._owner._render._shaderValues.setInt(xa.WIDTHCURVEKEYLENGTH,t.length)}),g(0,e,"widthMultiplier",function(){return this._widthMultiplier},function(t){this._widthMultiplier=t}),g(0,e,"minVertexDistance",function(){return this._minVertexDistance},function(t){this._minVertexDistance=t}),g(0,e,"time",function(){return this._time},function(t){this._time=t,this._owner._render._shaderValues.setNumber(xa.LIFETIME,t)}),t.ALIGNMENT_VIEW=0,t.ALIGNMENT_TRANSFORM_Z=1,t}(),kt=function(){function t(t){this._temp=new Uint32Array(1),this.seeds=new Uint32Array(4),this.seeds[0]=t,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}I(t,"laya.d3.math.Rand");var e=t.prototype;return e.getUint=function(){return this._temp[0]=this.seeds[0]^this.seeds[0]<<11,this.seeds[0]=this.seeds[1],this.seeds[1]=this.seeds[2],this.seeds[2]=this.seeds[3],this.seeds[3]=this.seeds[3]^this.seeds[3]>>>19^this._temp[0]^this._temp[0]>>>8,this.seeds[3]},e.getFloat=function(){return this.getUint(),(8388607&this.seeds[3])*(1/8388607)},e.getSignedFloat=function(){return 2*this.getFloat()-1},g(0,e,"seed",function(){return this.seeds[0]},function(t){this.seeds[0]=t,this.seeds[1]=1812433253*this.seeds[0]+1,this.seeds[2]=1812433253*this.seeds[1]+1,this.seeds[3]=1812433253*this.seeds[2]+1}),t.getFloatFromInt=function(t){return 1/8388607*(8388607&t)},t.getByteFromInt=function(t){return(8388607&t)>>>15},t}(),Wt=function(){function m(){this._scene=null,this._eventList=[],this._multiTouchEnabled=!0,this._mouseTouch=new Ui,this._touchPool=[],this._touches=new Rr}I(m,"laya.d3.Input3D");var t=m.prototype;return t.__init__=function(t,e){this._scene=e;var i=this._eventList;t.oncontextmenu=function(t){return!1},t.addEventListener("mousedown",function(t){t.preventDefault(),i.push(t)}),t.addEventListener("mouseup",function(t){t.preventDefault(),i.push(t)},!0),t.addEventListener("mousemove",function(t){t.preventDefault(),i.push(t)},!0),t.addEventListener("touchstart",function(t){t.preventDefault(),i.push(t)}),t.addEventListener("touchend",function(t){t.preventDefault(),i.push(t)},!0),t.addEventListener("touchmove",function(t){t.preventDefault(),i.push(t)},!0),t.addEventListener("touchcancel",function(t){i.push(t)},!0)},t.touchCount=function(){return this._touches.length},t._getTouch=function(t){var e=this._touchPool[t];return e||(e=new ue,(this._touchPool[t]=e)._identifier=t),e},t._mouseTouchDown=function(){var t=this._mouseTouch,e=t.sprite;if(t._pressedSprite=e,t._pressedLoopCount=$i.loopCount,e){var i=e._scripts;if(i)for(var n=0,r=i.length;n<r;n++)i[n].onMouseDown()}},t._mouseTouchUp=function(){var t=0,e=0,i=this._mouseTouch,n=i._pressedSprite;i._pressedSprite=null,i._pressedLoopCount=-1;var r=i.sprite;if(r&&r===n){var s=r._scripts;if(s)for(t=0,e=s.length;t<e;t++)s[t].onMouseClick()}if(n){var a=n._scripts;if(a)for(t=0,e=a.length;t<e;t++)a[t].onMouseUp()}},t._mouseTouchRayCast=function(t){var e=m._tempHitResult0,i=m._tempVector20,n=m._tempRay0;e.succeeded=!1;var r=this._mouseTouch.mousePositionX,s=this._mouseTouch.mousePositionY;i.x=r,i.y=s;for(var a=t.length-1;0<=a;a--){var o=t[a],h=o.viewport;if(i.x>=h.x&&i.y>=h.y&&i.x<=h.width&&i.y<=h.height)if(o.viewportPointToRay(i,n),this._scene._physicsSimulation.rayCast(n,e)||0===o.clearFlag||1===o.clearFlag)break}var l=this._mouseTouch,u=l.sprite;if(e.succeeded){var c=e.collider.owner,_=(l.sprite=c)._scripts;if(u!==c&&_)for(var d=0,f=_.length;d<f;d++)_[d].onMouseEnter()}else l.sprite=null;if(u&&u!==c){var p=u._scripts;if(p)for(d=0,f=p.length;d<f;d++)p[d].onMouseOut()}},t._changeTouches=function(t,e){for(var i=0,n=0,r=this._touches.length,s=0,a=t.length;s<a;s++){var o=t[s],h=o.identifier;if(this._multiTouchEnabled||0===h){var l=this._getTouch(h),u=l._position,c=m._tempPoint;c.setTo(o.pageX,o.pageY),T.stage._canvasTransform.invertTransformPoint(c);var _=c.x,d=c.y;switch(e){case 0:this._touches.add(l),i+=_,n+=d;break;case 1:this._touches.remove(l),i-=_,n-=d;break;case 2:i=_-u.x,n=d-u.y}u.x=_,u.y=d}}var f=this._touches.length;this._mouseTouch.mousePositionY=0===f?this._mouseTouch.mousePositionX=0:(this._mouseTouch.mousePositionX=(this._mouseTouch.mousePositionX*r+i)/f,(this._mouseTouch.mousePositionY*r+n)/f)},t._update=function(){var t,e=0,i=0,n=0;t=this._eventList.length;var r=this._scene._cameraPool;if(0<t){for(e=0;e<t;e++){var s=this._eventList[e];switch(s.type){case"mousedown":this._mouseTouchDown();break;case"mouseup":this._mouseTouchUp();break;case"mousemove":var a=m._tempPoint;a.setTo(s.pageX,s.pageY),T.stage._canvasTransform.invertTransformPoint(a),this._mouseTouch.mousePositionX=a.x,this._mouseTouch.mousePositionY=a.y,this._mouseTouchRayCast(r);break;case"touchstart":var o=this._touches.length;this._changeTouches(s.changedTouches,0),this._mouseTouchRayCast(r),0===o&&this._mouseTouchDown();break;case"touchend":case"touchcancel":this._changeTouches(s.changedTouches,1),0===this._touches.length&&this._mouseTouchUp();break;case"touchmove":this._changeTouches(s.changedTouches,2),this._mouseTouchRayCast(r);break;default:throw"Input3D:unkonwn event type."}}this._eventList.length=0}var h=this._mouseTouch,l=h._pressedSprite;if(l&&$i.loopCount>h._pressedLoopCount){var u=l._scripts;if(u)for(i=0,n=u.length;i<n;i++)u[i].onMouseDrag()}var c=h.sprite;if(c){var _=c._scripts;if(_)for(i=0,n=_.length;i<n;i++)_[i].onMouseOver()}},t.getTouch=function(t){return t<this._touches.length?this._touches.elements[t]:null},g(0,t,"multiTouchEnabled",function(){return this._multiTouchEnabled},function(t){this._multiTouchEnabled=t}),E(m,["_tempPoint",function(){return this._tempPoint=new R},"_tempVector20",function(){return this._tempVector20=new un},"_tempRay0",function(){return this._tempRay0=new Re(new ln,new ln)},"_tempHitResult0",function(){return this._tempHitResult0=new En}]),m}(),Xt=function(){function t(){}return I(t,"laya.d3.core.pixelLine.PixelLineVertex"),g(0,t.prototype,"vertexDeclaration",function(){return t._vertexDeclaration}),g(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),E(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new D(28,[new lt(0,"vector3",0),new lt(12,"vector4",1)])}]),t}(),Yt=function(){function r(){this.fun=null,this._this=null,this.args=null,this._ref=1,this._key=new Mt}I(r,"laya.webgl.submit.SubmitCMD");var t=r.prototype;return T.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){return this.fun.apply(this._this,this.args),1},t.getRenderType=function(){return 0},t.reUse=function(t,e){return this._ref++,e},t.releaseRender=function(){if(--this._ref<1){var t=r.POOL;t[t._length++]=this}},t.clone=function(t,e,i){return null},r.create=function(t,e,i){var n=r.POOL._length?r.POOL[--r.POOL._length]:new r;return n.fun=e,n.args=t,n._this=i,n._ref=1,n._key.clear(),n},r.POOL=[],r.__init$=function(){r.POOL._length=0},r}(),Zt=function(){function t(t,e,i,n){this._position=null,this._normal=null,this._textureCoord0=null,this._textureCoord1=null,this._position=t,this._normal=e,this._textureCoord0=i,this._textureCoord1=n}I(t,"laya.d3.graphics.Vertex.VertexPositionTerrain");var e=t.prototype;return T.imps(e,{"laya.d3.graphics.IVertex":!0}),g(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),g(0,e,"textureCoord1",function(){return this._textureCoord1}),g(0,e,"textureCoord0",function(){return this._textureCoord0}),g(0,e,"normal",function(){return this._normal}),g(0,e,"position",function(){return this._position}),g(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),t.TERRAIN_POSITION0=0,t.TERRAIN_NORMAL0=1,t.TERRAIN_TEXTURECOORDINATE0=2,t.TERRAIN_TEXTURECOORDINATE1=3,E(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new D(40,[new lt(0,"vector3",0),new lt(12,"vector3",1),new lt(24,"vector2",2),new lt(32,"vector2",3)])}]),t}(),jt=function(){function t(){this.value=0}I(t,"laya.d3.shader.DefineDatas");var e=t.prototype;return T.imps(e,{"laya.d3.core.IClone":!0}),e.add=function(t){this.value|=t},e.remove=function(t){this.value&=~t},e.has=function(t){return 0<(this.value&t)},e.cloneTo=function(t){t.value=this.value},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t}(),Kt=function(){function t(){this.enable=!1,this.randomDirection=!1}I(t,"laya.d3.core.particleShuriKen.module.shape.BaseShape");var e=t.prototype;return T.imps(e,{"laya.d3.core.IClone":!0}),e._getShapeBoundBox=function(t){throw new Error("BaseShape: must override it.")},e._getSpeedBoundBox=function(t){throw new Error("BaseShape: must override it.")},e.generatePositionAndDirection=function(t,e,i,n){throw new Error("BaseShape: must override it.")},e._calculateProceduralBounds=function(t,e,i){this._getShapeBoundBox(t);var n=t.min,r=t.max;ln.multiply(n,e,n),ln.multiply(r,e,r);var s=new Qe(new ln,new ln);this.randomDirection?(s.min=new ln(-1,-1,-1),s.max=new ln(1,1,1)):this._getSpeedBoundBox(s);var a=new Qe(new ln,new ln),o=a.min,h=a.max;ln.scale(s.min,i.y,o),ln.scale(s.max,i.y,h),ln.add(t.min,o,o),ln.add(t.max,h,h),ln.min(t.min,o,t.min),ln.max(t.max,o,t.max);var l=new Qe(new ln,new ln),u=l.min,c=l.max;ln.scale(s.min,i.x,u),ln.scale(s.max,i.x,c),ln.min(l.min,c,o),ln.max(l.min,c,h),ln.min(t.min,o,t.min),ln.max(t.max,o,t.max)},e.cloneTo=function(t){t.enable=this.enable},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t}(),qt=function(){function a(){}I(a,"laya.display.cmd.DrawPathCmd");var t=a.prototype;return t.recover=function(){this.paths=null,this.brush=null,this.pen=null,p.recover("DrawPathCmd",this)},t.run=function(t,e,i){t._drawPath(this.x+e,this.y+i,this.paths,this.brush,this.pen)},g(0,t,"cmdID",function(){return"DrawPath"}),a.create=function(t,e,i,n,r){var s=p.getItemByClass("DrawPathCmd",a);return s.x=t,s.y=e,s.paths=i,s.brush=n,s.pen=r,s},a.ID="DrawPath",a}(),Qt=function(){function s(t,e,i,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),this.x=t,this.y=e,this.z=i,this.w=n}I(s,"laya.d3.math.Quaternion");var t=s.prototype;return T.imps(t,{"laya.d3.core.IClone":!0}),t.scaling=function(t,e){e.x=this.x*t,e.y=this.y*t,e.z=this.z*t,e.w=this.w*t},t.normalize=function(t){var e=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;0<e&&(e=1/Math.sqrt(e),t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e)},t.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.rotateX=function(t,e){t*=.5;var i=Math.sin(t),n=Math.cos(t);e.x=this.x*n+this.w*i,e.y=this.y*n+this.z*i,e.z=this.z*n-this.y*i,e.w=this.w*n-this.x*i},t.rotateY=function(t,e){t*=.5;var i=Math.sin(t),n=Math.cos(t);e.x=this.x*n-this.z*i,e.y=this.y*n+this.w*i,e.z=this.z*n+this.x*i,e.w=this.w*n-this.y*i},t.rotateZ=function(t,e){t*=.5;var i=Math.sin(t),n=Math.cos(t);e.x=this.x*n+this.y*i,e.y=this.y*n-this.x*i,e.z=this.z*n+this.w*i,e.w=this.w*n-this.z*i},t.getYawPitchRoll=function(t){ln.transformQuat(ln._ForwardRH,this,s.TEMPVector31),ln.transformQuat(ln._Up,this,s.TEMPVector32);var e=s.TEMPVector32;s.angleTo(ln._ZERO,s.TEMPVector31,s.TEMPVector33);var i=s.TEMPVector33;i.x==Math.PI/2?(i.y=s.arcTanAngle(e.z,e.x),i.z=0):i.x==-Math.PI/2?(i.y=s.arcTanAngle(-e.z,-e.x),i.z=0):(gt.createRotationY(-i.y,s.TEMPMatrix0),gt.createRotationX(-i.x,s.TEMPMatrix1),ln.transformCoordinate(s.TEMPVector32,s.TEMPMatrix0,s.TEMPVector32),ln.transformCoordinate(s.TEMPVector32,s.TEMPMatrix1,s.TEMPVector32),i.z=s.arcTanAngle(e.y,-e.x)),i.y<=-Math.PI&&(i.y=Math.PI),i.z<=-Math.PI&&(i.z=Math.PI),i.y>=Math.PI&&i.z>=Math.PI&&(i.y=0,i.z=0,i.x=Math.PI-i.x);var n=t;n.x=i.y,n.y=i.x,n.z=i.z},t.invert=function(t){var e=this.x,i=this.y,n=this.z,r=this.w,s=e*e+i*i+n*n+r*r,a=s?1/s:0;t.x=-e*a,t.y=-i*a,t.z=-n*a,t.w=r*a},t.identity=function(){this.x=0,this.y=0,this.z=0,this.w=1},t.fromArray=function(t,e){void 0===e&&(e=0),this.x=t[e+0],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3]},t.cloneTo=function(t){this!==t&&(t.x=this.x,t.y=this.y,t.z=this.z,t.w=this.w)},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t.equals=function(t){return k.nearEqual(this.x,t.x)&&k.nearEqual(this.y,t.y)&&k.nearEqual(this.z,t.z)&&k.nearEqual(this.w,t.w)},t.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},t.forNativeElement=function(t){t?(this.elements=t,this.elements[0]=this.x,this.elements[1]=this.y,this.elements[2]=this.z,this.elements[3]=this.w):this.elements=new Float32Array([this.x,this.y,this.z,this.w]),un.rewriteNumProperty(this,"x",0),un.rewriteNumProperty(this,"y",1),un.rewriteNumProperty(this,"z",2),un.rewriteNumProperty(this,"w",3)},s.createFromYawPitchRoll=function(t,e,i,n){var r=.5*i,s=.5*e,a=.5*t,o=Math.sin(r),h=Math.cos(r),l=Math.sin(s),u=Math.cos(s),c=Math.sin(a),_=Math.cos(a);n.x=_*l*h+c*u*o,n.y=c*u*h-_*l*o,n.z=_*u*o-c*l*h,n.w=_*u*h+c*l*o},s.multiply=function(t,e,i){var n=t.x,r=t.y,s=t.z,a=t.w,o=e.x,h=e.y,l=e.z,u=e.w,c=r*l-s*h,_=s*o-n*l,d=n*h-r*o,f=n*o+r*h+s*l;i.x=n*u+o*a+c,i.y=r*u+h*a+_,i.z=s*u+l*a+d,i.w=a*u-f},s.arcTanAngle=function(t,e){return 0==t?1==e?Math.PI/2:-Math.PI/2:0<t?Math.atan(e/t):t<0?0<e?Math.atan(e/t)+Math.PI:Math.atan(e/t)-Math.PI:0},s.angleTo=function(t,e,i){ln.subtract(e,t,s.TEMPVector30),ln.normalize(s.TEMPVector30,s.TEMPVector30),i.x=Math.asin(s.TEMPVector30.y),i.y=s.arcTanAngle(-s.TEMPVector30.z,-s.TEMPVector30.x)},s.createFromAxisAngle=function(t,e,i){e*=.5;var n=Math.sin(e);i.x=n*t.x,i.y=n*t.y,i.z=n*t.z,i.w=Math.cos(e)},s.createFromMatrix4x4=function(t,e){var i,n,r=t.elements,s=r[0]+r[5]+r[10];0<s?(i=Math.sqrt(s+1),e.w=.5*i,i=.5/i,e.x=(r[6]-r[9])*i,e.y=(r[8]-r[2])*i,e.z=(r[1]-r[4])*i):r[0]>=r[5]&&r[0]>=r[10]?(n=.5/(i=Math.sqrt(1+r[0]-r[5]-r[10])),e.x=.5*i,e.y=(r[1]+r[4])*n,e.z=(r[2]+r[8])*n,e.w=(r[6]-r[9])*n):r[5]>r[10]?(n=.5/(i=Math.sqrt(1+r[5]-r[0]-r[10])),e.x=(r[4]+r[1])*n,e.y=.5*i,e.z=(r[9]+r[6])*n,e.w=(r[8]-r[2])*n):(n=.5/(i=Math.sqrt(1+r[10]-r[0]-r[5])),e.x=(r[8]+r[2])*n,e.y=(r[9]+r[6])*n,e.z=.5*i,e.w=(r[1]-r[4])*n)},s.slerp=function(t,e,i,n){var r,s,a,o,h,l=t.x,u=t.y,c=t.z,_=t.w,d=e.x,f=e.y,p=e.z,m=e.w;return(s=l*d+u*f+c*p+_*m)<0&&(s=-s,d=-d,f=-f,p=-p,m=-m),h=1e-6<1-s?(r=Math.acos(s),a=Math.sin(r),o=Math.sin((1-i)*r)/a,Math.sin(i*r)/a):(o=1-i,i),n.x=o*l+h*d,n.y=o*u+h*f,n.z=o*c+h*p,n.w=o*_+h*m,n},s.lerp=function(t,e,i,n){var r=1-i;0<=s.dot(t,e)?(n.x=r*t.x+i*e.x,n.y=r*t.y+i*e.y,n.z=r*t.z+i*e.z,n.w=r*t.w+i*e.w):(n.x=r*t.x-i*e.x,n.y=r*t.y-i*e.y,n.z=r*t.z-i*e.z,n.w=r*t.w-i*e.w),n.normalize(n)},s.add=function(t,e,i){i.x=t.x+e.x,i.y=t.y+e.y,i.z=t.z+e.z,i.w=t.w+e.w},s.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},s.rotationLookAt=function(t,e,i){s.lookAt(ln._ZERO,t,e,i)},s.lookAt=function(t,e,i,n){ht.lookAt(t,e,i,s._tempMatrix3x3),s.rotationMatrix(s._tempMatrix3x3,n)},s.invert=function(t,e){var i=t.lengthSquared();k.isZero(i)||(i=1/i,e.x=-t.x*i,e.y=-t.y*i,e.z=-t.z*i,e.w=t.w*i)},s.rotationMatrix=function(t,e){var i=t.elements,n=i[0],r=i[1],s=i[2],a=i[3],o=i[4],h=i[5],l=i[6],u=i[7],c=i[8],_=NaN,d=NaN,f=n+o+c;0<f?(_=Math.sqrt(f+1),e.w=.5*_,_=.5/_,e.x=(h-u)*_,e.y=(l-s)*_,e.z=(r-a)*_):e.w=o<=n&&c<=n?(d=.5/(_=Math.sqrt(1+n-o-c)),e.x=.5*_,e.y=(r+a)*d,e.z=(s+l)*d,(h-u)*d):c<o?(d=.5/(_=Math.sqrt(1+o-n-c)),e.x=(a+r)*d,e.y=.5*_,e.z=(u+h)*d,(l-s)*d):(d=.5/(_=Math.sqrt(1+c-n-o)),e.x=(l+s)*d,e.y=(u+h)*d,e.z=.5*_,(r-a)*d)},s.DEFAULT=new s,E(s,["TEMPVector30",function(){return this.TEMPVector30=new ln},"TEMPVector31",function(){return this.TEMPVector31=new ln},"TEMPVector32",function(){return this.TEMPVector32=new ln},"TEMPVector33",function(){return this.TEMPVector33=new ln},"TEMPMatrix0",function(){return this.TEMPMatrix0=new gt},"TEMPMatrix1",function(){return this.TEMPMatrix1=new gt},"_tempMatrix3x3",function(){return this._tempMatrix3x3=new ht},"NAN",function(){return this.NAN=new s(NaN,NaN,NaN,NaN)}]),s}(),$t=function(){function t(){}return I(t,"laya.d3.utils.Physics3DUtils"),t.setColliderCollision=function(t,e,i){},t.getIColliderCollision=function(t,e){return!1},t.COLLISIONFILTERGROUP_DEFAULTFILTER=1,t.COLLISIONFILTERGROUP_STATICFILTER=2,t.COLLISIONFILTERGROUP_KINEMATICFILTER=4,t.COLLISIONFILTERGROUP_DEBRISFILTER=8,t.COLLISIONFILTERGROUP_SENSORTRIGGER=16,t.COLLISIONFILTERGROUP_CHARACTERFILTER=32,t.COLLISIONFILTERGROUP_CUSTOMFILTER1=64,t.COLLISIONFILTERGROUP_CUSTOMFILTER2=128,t.COLLISIONFILTERGROUP_CUSTOMFILTER3=256,t.COLLISIONFILTERGROUP_CUSTOMFILTER4=512,t.COLLISIONFILTERGROUP_CUSTOMFILTER5=1024,t.COLLISIONFILTERGROUP_CUSTOMFILTER6=2048,t.COLLISIONFILTERGROUP_CUSTOMFILTER7=4096,t.COLLISIONFILTERGROUP_CUSTOMFILTER8=8192,t.COLLISIONFILTERGROUP_CUSTOMFILTER9=16384,t.COLLISIONFILTERGROUP_CUSTOMFILTER10=32768,t.COLLISIONFILTERGROUP_ALLFILTER=-1,E(t,["gravity",function(){return this.gravity=new ln(0,-9.81,0)}]),t}(),Jt=function(){function t(t){this._angularVelocity=null,this.enbale=!1,this._angularVelocity=t}I(t,"laya.d3.core.particleShuriKen.module.RotationOverLifetime");var e=t.prototype;return T.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this._angularVelocity.cloneTo(e._angularVelocity),e.enbale=this.enbale},e.clone=function(){var t;switch(this._angularVelocity.type){case 0:t=this._angularVelocity.separateAxes?Xi.createByConstantSeparate(this._angularVelocity.constantSeparate.clone()):Xi.createByConstant(this._angularVelocity.constant);break;case 1:t=this._angularVelocity.separateAxes?Xi.createByGradientSeparate(this._angularVelocity.gradientX.clone(),this._angularVelocity.gradientY.clone(),this._angularVelocity.gradientZ.clone()):Xi.createByGradient(this._angularVelocity.gradient.clone());break;case 2:t=this._angularVelocity.separateAxes?Xi.createByRandomTwoConstantSeparate(this._angularVelocity.constantMinSeparate.clone(),this._angularVelocity.constantMaxSeparate.clone()):Xi.createByRandomTwoConstant(this._angularVelocity.constantMin,this._angularVelocity.constantMax);break;case 3:t=this._angularVelocity.separateAxes?Xi.createByRandomTwoGradientSeparate(this._angularVelocity.gradientXMin.clone(),this._angularVelocity.gradientYMin.clone(),this._angularVelocity.gradientZMin.clone(),this._angularVelocity.gradientWMin.clone(),this._angularVelocity.gradientXMax.clone(),this._angularVelocity.gradientYMax.clone(),this._angularVelocity.gradientZMax.clone(),this._angularVelocity.gradientWMax.clone()):Xi.createByRandomTwoGradient(this._angularVelocity.gradientMin.clone(),this._angularVelocity.gradientMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e},g(0,e,"angularVelocity",function(){return this._angularVelocity}),t}(),te=function(){function t(){}I(t,"laya.d3.core.trail.VertexTrail");var e=t.prototype;return T.imps(e,{"laya.d3.graphics.IVertex":!0}),g(0,e,"vertexDeclaration",function(){return t._vertexDeclaration1}),g(1,t,"vertexDeclaration2",function(){return t._vertexDeclaration2}),g(1,t,"vertexDeclaration1",function(){return t._vertexDeclaration1}),t.TRAIL_POSITION0=0,t.TRAIL_OFFSETVECTOR=1,t.TRAIL_TIME0=2,t.TRAIL_TEXTURECOORDINATE0Y=3,t.TRAIL_TEXTURECOORDINATE0X=4,E(t,["_vertexDeclaration1",function(){return this._vertexDeclaration1=new D(32,[new lt(0,"vector3",0),new lt(12,"vector3",1),new lt(24,"single",2),new lt(28,"single",3)])},"_vertexDeclaration2",function(){return this._vertexDeclaration2=new D(4,[new lt(0,"single",4)])}]),t}(),ee=(function(){function t(t,e){this.submitStartPos=0,this.submitEndPos=0,this.context=null,this.touches=[],this.submits=[],this.sprite=null,this._mesh=null,this._pathMesh=null,this._triangleMesh=null,this.meshlist=[],this._oldMesh=null,this._oldPathMesh=null,this._oldTriMesh=null,this._oldMeshList=null,this.oldTx=0,this.oldTy=0,this.cachedClipInfo=new It,this.invMat=new It,this.context=t,this.sprite=e,t._globalClipMatrix.copyTo(this.cachedClipInfo)}I(t,"laya.webgl.canvas.WebGLCacheAsNormalCanvas");var e=t.prototype;e.startRec=function(){this.context._charSubmitCache._enbale&&(this.context._charSubmitCache.enable(!1,this.context),this.context._charSubmitCache.enable(!0,this.context)),this.context._incache=!0,this.touches.length=0,this.context.touches=this.touches,this.context._globalClipMatrix.copyTo(this.cachedClipInfo),this.submits.length=0,this.submitStartPos=this.context._submits._length;for(var t=0,e=this.meshlist.length;t<e;t++){var i=this.meshlist[t];i.canReuse?i.releaseMesh():i.destroy()}this.meshlist.length=0,this._mesh=or.getAMesh(!1),this._pathMesh=Yr.getAMesh(!1),this._triangleMesh=Fr.getAMesh(!1),this.meshlist.push(this._mesh),this.meshlist.push(this._pathMesh),this.meshlist.push(this._triangleMesh),this.context._curSubmit=yt.RENDERBASE,this._oldMesh=this.context._mesh,this._oldPathMesh=this.context._pathMesh,this._oldTriMesh=this.context._triangleMesh,this._oldMeshList=this.context.meshlist,this.context._mesh=this._mesh,this.context._pathMesh=this._pathMesh,this.context._triangleMesh=this._triangleMesh,this.context.meshlist=this.meshlist,this.oldTx=this.context._curMat.tx,this.oldTy=this.context._curMat.ty,this.context._curMat.tx=0,this.context._curMat.ty=0,this.context._curMat.copyTo(this.invMat),this.invMat.invert()},e.endRec=function(){this.context._charSubmitCache._enbale&&(this.context._charSubmitCache.enable(!1,this.context),this.context._charSubmitCache.enable(!0,this.context));var t=this.context._submits;this.submitEndPos=t._length;for(var e=this.submitEndPos-this.submitStartPos,i=0;i<e;i++)this.submits.push(t[this.submitStartPos+i]);t._length-=e,this.context._mesh=this._oldMesh,this.context._pathMesh=this._oldPathMesh,this.context._triangleMesh=this._oldTriMesh,this.context.meshlist=this._oldMeshList,this.context._curSubmit=yt.RENDERBASE,this.context._curMat.tx=this.oldTx,this.context._curMat.ty=this.oldTy,this.context.touches=null,this.context._incache=!1},e.isCacheValid=function(){var t=this.context._globalClipMatrix;return t.a==this.cachedClipInfo.a&&t.b==this.cachedClipInfo.b&&t.c==this.cachedClipInfo.c&&t.d==this.cachedClipInfo.d&&t.tx==this.cachedClipInfo.tx&&t.ty==this.cachedClipInfo.ty},e.flushsubmit=function(){var e=yt.RENDERBASE;this.submits.forEach(function(t){t!=yt.RENDERBASE&&(yt.preRender=e,(e=t).renderSubmit())})},e.releaseMem=function(){},E(t,["matI",function(){return this.matI=new It}])}(),function(){function p(){}return I(p,"laya.d3.utils.Picker"),p.calculateCursorRay=function(t,e,i,n,r,s){var a=t.x,o=t.y,h=p._tempVector30,l=h;l.x=a,l.y=o,l.z=e.minDepth;var u=p._tempVector31,c=u;c.x=a,c.y=o,c.z=e.maxDepth;var _=s.origin,d=p._tempVector32;e.unprojectFromWVP(h,i,n,r,_),e.unprojectFromWVP(u,i,n,r,d);var f=s.direction;f.x=d.x-_.x,f.y=d.y-_.y,f.z=d.z-_.z,ln.normalize(s.direction,s.direction)},p.rayIntersectsTriangle=function(t,e,i,n){var r=p._tempVector30,s=p._tempVector31;ln.subtract(i,e,r),ln.subtract(n,e,s);var a,o=p._tempVector32;if(ln.cross(t.direction,s,o),(a=ln.dot(r,o))>-Number.MIN_VALUE&&a<Number.MIN_VALUE)return Number.NaN;var h,l=1/a,u=p._tempVector33;if(ln.subtract(t.origin,e,u),h=ln.dot(u,o),(h*=l)<0||1<h)return Number.NaN;var c,_,d=p._tempVector34;return ln.cross(u,r,d),c=ln.dot(t.direction,d),(c*=l)<0||1<h+c?Number.NaN:(_=ln.dot(s,d),(_*=l)<0?Number.NaN:_)},E(p,["_tempVector30",function(){return this._tempVector30=new ln},"_tempVector31",function(){return this._tempVector31=new ln},"_tempVector32",function(){return this._tempVector32=new ln},"_tempVector33",function(){return this._tempVector33=new ln},"_tempVector34",function(){return this._tempVector34=new ln}]),p}()),ie=function(){function o(){this.reset()}I(o,"laya.display.css.CacheStyle");var t=o.prototype;return t.needBitmapCache=function(){return this.cacheForFilters||!!this.mask},t.needEnableCanvasRender=function(){return"none"!=this.userSetCache||this.cacheForFilters||!!this.mask},t.releaseContext=function(){this.canvas&&this.canvas.size&&(p.recover("CacheCanvas",this.canvas),this.canvas.size(0,0),this.canvas.width=0,this.canvas.height=0),this.canvas=null},t.createContext=function(){if(!this.canvas){this.canvas=p.getItem("CacheCanvas")||new Ys(!1);var t=this.canvas.context;t||(t=this.canvas.getContext("2d"))}},t.releaseFilterCache=function(){var t=this.filterCache;t&&(t.destroy(),t.recycle(),this.filterCache=null)},t.recover=function(){this!==o.EMPTY&&p.recover("SpriteCache",this.reset())},t.reset=function(){return this.releaseContext(),this.releaseFilterCache(),this.cacheAs="none",this.enableCanvasRender=!1,this.userSetCache="none",this.cacheForFilters=!1,this.staticCache=!1,this.reCache=!0,this.mask=null,this.maskParent=null,this.filterCache=null,this.filters=null,this.hasGlowFilter=!1,this.cacheRect&&this.cacheRect.recover(),this.cacheRect=null,this},t._calculateCacheRect=function(t,e,i,n){var r,s=t._cacheStyle;if(s.cacheRect||(s.cacheRect=ve.create()),"bitmap"===e?((r=t.getSelfBounds()).width=r.width+32,r.height=r.height+32,r.x=r.x-t.pivotX,r.y=r.y-t.pivotY,r.x=r.x-16,r.y=r.y-16,r.x=Math.floor(r.x+i)-i,r.y=Math.floor(r.y+n)-n,r.width=Math.floor(r.width),r.height=Math.floor(r.height),s.cacheRect.copyFrom(r)):s.cacheRect.setTo(-t._style.pivotX,-t._style.pivotY,1,1),r=s.cacheRect,t._style.scrollRect){var a=t._style.scrollRect;r.x-=a.x,r.y-=a.y}return o._scaleInfo.setTo(1,1),o._scaleInfo},o.create=function(){return p.getItemByClass("SpriteCache",o)},o.EMPTY=new o,o.CANVAS_EXTEND_EDGE=16,E(o,["_scaleInfo",function(){return this._scaleInfo=new R}]),o}(),ne=(function(){function t(){}I(t,"laya.d3.core.GradientMode"),t.Blend=0,t.Fixed=1}(),function(){function t(){}I(t,"laya.display.css.BoundsStyle");var e=t.prototype;return e.reset=function(){return this.bounds&&this.bounds.recover(),this.userBounds&&this.userBounds.recover(),this.bounds=null,this.userBounds=null,this.temBM=null,this},e.recover=function(){p.recover("BoundsStyle",this.reset())},t.create=function(){return p.getItemByClass("BoundsStyle",t)},t}()),re=function(){function r(){this._mat=new It}I(r,"laya.webgl.canvas.save.SaveTranslate");var t=r.prototype;return T.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._mat.copyTo(t._curMat),r.POOL[r.POOL._length++]=this},r.save=function(t){var e=r.POOL,i=0<e._length?e[--e._length]:new r;t._curMat.copyTo(i._mat);var n=t._save;n[n._length++]=i},r.POOL=a._createArray(),r}(),se=function(){function t(t,e,i){this._time=NaN,this._minCount=0,this._maxCount=0,this._time=t,this._minCount=e,this._maxCount=i}I(t,"laya.d3.core.particleShuriKen.module.Burst");var e=t.prototype;return T.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;e._time=this._time,e._minCount=this._minCount,e._maxCount=this._maxCount},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},g(0,e,"maxCount",function(){return this._maxCount}),g(0,e,"minCount",function(){return this._minCount}),g(0,e,"time",function(){return this._time}),t}(),ae=function(){function t(t){void 0===t&&(t=!1),this.isTransparent=t,this.elements=[]}I(t,"laya.d3.core.render.RenderQueue");var e=t.prototype;return e._compare=function(t,e){var i=t.material.renderQueue-e.material.renderQueue;return 0!==i?i:(this.isTransparent?e.render._distanceForSort-t.render._distanceForSort:t.render._distanceForSort-e.render._distanceForSort)+e.render.sortingFudge-t.render.sortingFudge},e._partitionRenderObject=function(t,e){for(var i=this.elements[Math.floor((e+t)/2)];t<=e;){for(;this._compare(this.elements[t],i)<0;)t++;for(;0<this._compare(this.elements[e],i);)e--;if(t<e){var n=this.elements[t];this.elements[t]=this.elements[e],this.elements[e]=n,t++,e--}else if(t===e){t++;break}}return t},e._quickSort=function(t,e){if(1<this.elements.length){var i=this._partitionRenderObject(t,e),n=i-1;t<n&&this._quickSort(t,n),i<e&&this._quickSort(i,e)}},e._render=function(t,e,i,n){for(var r=0,s=this.elements.length;r<s;r++)this.elements[r]._render(t,e,i,n)},e.clear=function(){this.elements.length=0,this.lastTransparentRenderElement=null,this.lastTransparentBatched=!1},t}(),oe=function(){function s(t,e,i,n){this.minDepth=0,this.maxDepth=1,this.x=t,this.y=e,this.width=i,this.height=n}I(s,"laya.d3.math.Viewport");var t=s.prototype;return t.project=function(t,e,i){ln.transformV3ToV3(t,e,i);var n=e.elements,r=t.x*n[3]+t.y*n[7]+t.z*n[11]+n[15];1!==r&&(i.x=i.x/r,i.y=i.y/r,i.z=i.z/r),i.x=.5*(i.x+1)*this.width+this.x,i.y=.5*(1-i.y)*this.height+this.y,i.z=i.z*(this.maxDepth-this.minDepth)+this.minDepth},t.project1=function(t,e,i){var n=ln._tempVector4;ln.transformV3ToV4(t,e,n);var r=n.w;r<.1&&-1e-6<r&&(r=1e-6),n.x/=r,n.y/=r,n.z/=r,i.x=(n.x+1)*this.width/2+this.x,i.y=(1-n.y)*this.height/2+this.y,i.z=n.w},t.unprojectFromMat=function(t,e,i){var n=e.elements;i.x=(t.x-this.x)/this.width*2-1,i.y=-((t.y-this.y)/this.height*2-1);var r=(this.maxDepth-this.minDepth)/2;i.z=(t.z-this.minDepth-r)/r;var s=i.x*n[3]+i.y*n[7]+i.z*n[11]+n[15];ln.transformV3ToV3(i,e,i),1!==s&&(i.x=i.x/s,i.y=i.y/s,i.z=i.z/s)},t.unprojectFromWVP=function(t,e,i,n,r){gt.multiply(e,i,s._tempMatrix4x4),n&&gt.multiply(s._tempMatrix4x4,n,s._tempMatrix4x4),s._tempMatrix4x4.invert(s._tempMatrix4x4),this.unprojectFromMat(t,s._tempMatrix4x4,r)},t.cloneTo=function(t){t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t.minDepth=this.minDepth,t.maxDepth=this.maxDepth},E(s,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new gt}]),s}(),he=function(){function t(){this._context=null,this._compositeShader=We.find("PostProcessComposite"),this._compositeShaderData=new xe,this._compositeDefineData=new jt,this._effects=[],this._context=new Oe,this._context.compositeShaderData=this._compositeShaderData,this._context.compositeDefineData=this._compositeDefineData}I(t,"laya.d3.component.PostProcess");var e=t.prototype;return e._init=function(t,e){this._context.camera=t,this._context.command=e},e._render=function(){var t=Js.getTemporary(Ei.clientWidth,Ei.clientHeight,0,3),e=this._context.camera.getRenderTexture();this._context.command.clear(),this._context.source=t,this._context.destination=e;for(var i=0,n=this._effects.length;i<n;i++)this._effects[i].render(this._context);Js.setReleaseTemporary(t);var r=this._context.tempRenderTextures;for(i=0,n=r.length;i<n;i++)Js.setReleaseTemporary(r[i])},e.addEffect=function(t){this._effects.push(t)},e.removeEffect=function(t){var e=this._effects.indexOf(t);-1!==e&&this._effects.splice(e,1)},t.__init__=function(){t.SHADERDEFINE_BLOOM_LOW=t.shaderDefines.registerDefine("BLOOM_LOW"),t.SHADERDEFINE_BLOOM=t.shaderDefines.registerDefine("BLOOM")},t.SHADERDEFINE_BLOOM_LOW=0,t.SHADERDEFINE_BLOOM=0,E(t,["SHADERVALUE_MAINTEX",function(){return this.SHADERVALUE_MAINTEX=We.propertyNameToID("u_MainTex")},"SHADERVALUE_BLOOMTEX",function(){return this.SHADERVALUE_BLOOMTEX=We.propertyNameToID("u_BloomTex")},"SHADERVALUE_AUTOEXPOSURETEX",function(){return this.SHADERVALUE_AUTOEXPOSURETEX=We.propertyNameToID("u_AutoExposureTex")},"SHADERVALUE_BLOOM_DIRTTEX",function(){return this.SHADERVALUE_BLOOM_DIRTTEX=We.propertyNameToID("u_Bloom_DirtTex")},"SHADERVALUE_BLOOMTEX_TEXELSIZE",function(){return this.SHADERVALUE_BLOOMTEX_TEXELSIZE=We.propertyNameToID("u_BloomTex_TexelSize")},"SHADERVALUE_BLOOM_DIRTTILEOFFSET",function(){return this.SHADERVALUE_BLOOM_DIRTTILEOFFSET=We.propertyNameToID("u_Bloom_DirtTileOffset")},"SHADERVALUE_BLOOM_SETTINGS",function(){return this.SHADERVALUE_BLOOM_SETTINGS=We.propertyNameToID("u_Bloom_Settings")},"SHADERVALUE_BLOOM_COLOR",function(){return this.SHADERVALUE_BLOOM_COLOR=We.propertyNameToID("u_Bloom_Color")},"shaderDefines",function(){return this.shaderDefines=new ii}]),t}(),le=function(){function t(){}return I(t,"laya.d3.graphics.Vertex.VertexShuriKenParticle"),t.PARTICLE_CORNERTEXTURECOORDINATE0=0,t.PARTICLE_POSITION0=1,t.PARTICLE_COLOR0=2,t.PARTICLE_TEXTURECOORDINATE0=3,t.PARTICLE_SHAPEPOSITIONSTARTLIFETIME=4,t.PARTICLE_DIRECTIONTIME=5,t.PARTICLE_STARTCOLOR0=6,t.PARTICLE_ENDCOLOR0=7,t.PARTICLE_STARTSIZE=8,t.PARTICLE_STARTROTATION=9,t.PARTICLE_STARTSPEED=10,t.PARTICLE_RANDOM0=11,t.PARTICLE_RANDOM1=12,t.PARTICLE_SIMULATIONWORLDPOSTION=13,t.PARTICLE_SIMULATIONWORLDROTATION=14,t}(),ue=function(){function t(){this._indexInList=-1,this._identifier=-1,this._position=new un}I(t,"laya.d3.Touch");var e=t.prototype;return T.imps(e,{"laya.resource.ISingletonElement":!0}),e._getIndexInList=function(){return this._indexInList},e._setIndexInList=function(t){this._indexInList=t},g(0,e,"position",function(){return this._position}),g(0,e,"identifier",function(){return this._identifier}),t}(),ce=function(){function s(){}return I(s,"laya.resource.WebGLRTMgr"),s.getRT=function(t,e){e|=0,1e4<=(t|=0)&&console.error("getRT error! w too big");var i,n=1e4*e+t,r=s.dict[n];return r&&0<r.length?(i=r.pop())._mgrKey=n:(i=new da(t,e,1,-1))._mgrKey=n,i},s.releaseRT=function(t){if(!(t._mgrKey<=0)){var e=s.dict[t._mgrKey];!e&&(e=[],s.dict[t._mgrKey]=e),t._mgrKey=0,e.push(t)}},s.dict={},s}(),_e=function(){function t(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null,this.width=-1,this.pageChars=[],this.startID=0,this.startIDStroke=0,this.lastGCCnt=0,this.splitRender=!1}I(t,"laya.utils.WordText");var e=t.prototype;return e.setText=function(t){this.changed=!0,this._text=t,this.width=-1,this.cleanCache()},e.toString=function(){return this._text},e.charCodeAt=function(t){return this._text?this._text.charCodeAt(t):NaN},e.charAt=function(t){return this._text?this._text.charAt(t):null},e.cleanCache=function(){this.pageChars.forEach(function(t){var e=t.tex;t.words;1==t.words.length&&e&&e.ri&&e.destroy()}),this.pageChars=[],this.startID=0},g(0,e,"length",function(){return this._text?this._text.length:0}),t}(),de=function(){function t(){}return I(t,"laya.ui.Styles"),t.labelColor="#000000",t.buttonStateNum=3,t.scrollBarMinNum=15,t.scrollBarDelayTime=500,E(t,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),t}(),fe=function(){function x(){this._boundingSphere=null,this._boundingBox=null,this._sizeOfY=null,this._currentLODLevel=0,this._lastDistanceToEye=NaN,this._originalBoundingSphere=null,this._originalBoundingBox=null,this._originalBoundingBoxCorners=null,this._bUseStrip=!1,this._gridSize=NaN,this._beginGridX=0,this._beginGridZ=0,this._LODError=null,x.__init__(),this._currentLODLevel=0}I(x,"laya.d3.terrain.TerrainLeaf");var t=x.prototype;return t.calcVertextNorml=function(t,e,i,n,r,s){var a=0,o=0;o=-1*x.getHeightFromTerrainHeightData(t-1,e-1,i,n,r),o+=-1*x.getHeightFromTerrainHeightData(t-1,e,i,n,r),o+=-1*x.getHeightFromTerrainHeightData(t-1,e+1,i,n,r),o+=1*x.getHeightFromTerrainHeightData(t+1,e-1,i,n,r),o+=1*x.getHeightFromTerrainHeightData(t+1,e,i,n,r),o+=1*x.getHeightFromTerrainHeightData(t+1,e+1,i,n,r),a=-1*x.getHeightFromTerrainHeightData(t-1,e-1,i,n,r),a+=-1*x.getHeightFromTerrainHeightData(t,e-1,i,n,r),a+=-1*x.getHeightFromTerrainHeightData(t+1,e-1,i,n,r),a+=1*x.getHeightFromTerrainHeightData(t-1,e+1,i,n,r),a+=1*x.getHeightFromTerrainHeightData(t,e+1,i,n,r),a+=1*x.getHeightFromTerrainHeightData(t+1,e+1,i,n,r),s.x=-o,s.y=6,s.z=-a,ln.normalize(s,s)},t.calcVertextNormlUV=function(t,e,i,n,r){r.x=t/i,r.y=e/n,r.z=e/n},t.calcVertextBuffer=function(t,e,i,n,r,s,a,o,h,l,u,c){if(1==c&&!x.__ADAPT_MATRIX__){x.__ADAPT_MATRIX__=new gt;var _=new gt;gt.createRotationY(Math.PI,x.__ADAPT_MATRIX__),gt.createTranslate(new ln(0,0,(u-1)*r),_),gt.multiply(_,x.__ADAPT_MATRIX__,x.__ADAPT_MATRIX__),x.__ADAPT_MATRIX_INV__=new gt,x.__ADAPT_MATRIX__.invert(x.__ADAPT_MATRIX_INV__)}this._gridSize=r,this._beginGridX=t*x.CHUNK_GRID_NUM+i,this._beginGridZ=e*x.CHUNK_GRID_NUM+n;for(var d=a*o,f=2147483647,p=-2147483648,m=new ln,g=0,v=x.LEAF_GRID_NUM+1;g<v;g++)for(var T=0,y=x.LEAF_GRID_NUM+1;T<y;T++)x.__VECTOR3__.x=(this._beginGridX+T)*this._gridSize,x.__VECTOR3__.z=(this._beginGridZ+g)*this._gridSize,x.__VECTOR3__.y=h[(this._beginGridZ+g)*l+(this._beginGridX+T)],f=x.__VECTOR3__.y<f?x.__VECTOR3__.y:f,p=x.__VECTOR3__.y>p?x.__VECTOR3__.y:p,x.__ADAPT_MATRIX__&&ln.transformV3ToV3(x.__VECTOR3__,x.__ADAPT_MATRIX__,x.__VECTOR3__),s[d]=x.__VECTOR3__.x,s[++d]=x.__VECTOR3__.y,s[++d]=x.__VECTOR3__.z,d++,this.calcVertextNormlUV(this._beginGridX+T,this._beginGridZ+g,l,u,m),s[d]=m.x,s[++d]=m.y,s[++d]=m.z,s[++d]=(i+T)/x.CHUNK_GRID_NUM,s[++d]=(n+g)/x.CHUNK_GRID_NUM,s[++d]=this._beginGridX+T,s[++d]=this._beginGridZ+g,d++;this._sizeOfY=new un(f-1,p+1),this.calcLODErrors(h,l,u),this.calcOriginalBoudingBoxAndSphere()},t.calcSkirtVertextBuffer=function(t,e,i,n,r,s,a,o,h,l,u){this._gridSize=r,this._beginGridX=t*x.CHUNK_GRID_NUM+i,this._beginGridZ=e*x.CHUNK_GRID_NUM+n;var c=a*o,_=0,d=0,f=x.LEAF_GRID_NUM+1,p=new ln,m=0,g=0;for(_=0;_<2;_++)for(d=0;d<f;d++)x.__VECTOR3__.x=(this._beginGridX+d)*this._gridSize,x.__VECTOR3__.y=1==_?h[this._beginGridZ*l+(this._beginGridX+d)]:-this._gridSize,x.__VECTOR3__.z=(this._beginGridZ+0)*this._gridSize,x.__ADAPT_MATRIX__&&ln.transformV3ToV3(x.__VECTOR3__,x.__ADAPT_MATRIX__,x.__VECTOR3__),s[c]=x.__VECTOR3__.x,s[++c]=x.__VECTOR3__.y,s[++c]=x.__VECTOR3__.z,c++,m=0==_?this._beginGridZ-1:this._beginGridZ,this.calcVertextNormlUV(this._beginGridX+d,m,l,u,p),s[c]=p.x,s[++c]=p.y,s[++c]=p.z,s[++c]=(i+d)/x.CHUNK_GRID_NUM,s[++c]=(n+0)/x.CHUNK_GRID_NUM,s[++c]=this._beginGridX+d,s[++c]=m,c++;for(_=0;_<2;_++)for(d=0;d<f;d++)x.__VECTOR3__.x=(this._beginGridX+d)*this._gridSize,x.__VECTOR3__.y=0==_?h[(this._beginGridZ+x.LEAF_GRID_NUM)*l+(this._beginGridX+d)]:-this._gridSize,x.__VECTOR3__.z=(this._beginGridZ+x.LEAF_GRID_NUM)*this._gridSize,x.__ADAPT_MATRIX__&&ln.transformV3ToV3(x.__VECTOR3__,x.__ADAPT_MATRIX__,x.__VECTOR3__),s[c]=x.__VECTOR3__.x,s[++c]=x.__VECTOR3__.y,s[++c]=x.__VECTOR3__.z,c++,m=0==_?this._beginGridZ+x.LEAF_GRID_NUM:this._beginGridZ+x.LEAF_GRID_NUM+1,this.calcVertextNormlUV(this._beginGridX+d,m,l,u,p),s[c]=p.x,s[++c]=p.y,s[++c]=p.z,s[++c]=(i+d)/x.CHUNK_GRID_NUM,s[++c]=(n+x.LEAF_GRID_NUM)/x.CHUNK_GRID_NUM,s[++c]=this._beginGridX+d,s[++c]=m,c++;for(_=0;_<2;_++)for(d=0;d<f;d++)x.__VECTOR3__.x=(this._beginGridX+0)*this._gridSize,x.__VECTOR3__.y=0==_?h[(this._beginGridZ+d)*l+(this._beginGridX+0)]:-this._gridSize,x.__VECTOR3__.z=(this._beginGridZ+d)*this._gridSize,x.__ADAPT_MATRIX__&&ln.transformV3ToV3(x.__VECTOR3__,x.__ADAPT_MATRIX__,x.__VECTOR3__),s[c]=x.__VECTOR3__.x,s[++c]=x.__VECTOR3__.y,s[++c]=x.__VECTOR3__.z,c++,g=0==_?this._beginGridX:this._beginGridX-1,this.calcVertextNormlUV(g,this._beginGridZ+d,l,u,p),s[c]=p.x,s[++c]=p.y,s[++c]=p.z,s[++c]=(i+0)/x.CHUNK_GRID_NUM,s[++c]=(n+d)/x.CHUNK_GRID_NUM,s[++c]=g,s[++c]=this._beginGridZ+d,c++;for(_=0;_<2;_++)for(d=0;d<f;d++)x.__VECTOR3__.x=(this._beginGridX+x.LEAF_GRID_NUM)*this._gridSize,x.__VECTOR3__.y=1==_?h[(this._beginGridZ+d)*l+(this._beginGridX+x.LEAF_GRID_NUM)]:-this._gridSize,x.__VECTOR3__.z=(this._beginGridZ+d)*this._gridSize,x.__ADAPT_MATRIX__&&ln.transformV3ToV3(x.__VECTOR3__,x.__ADAPT_MATRIX__,x.__VECTOR3__),s[c]=x.__VECTOR3__.x,s[++c]=x.__VECTOR3__.y,s[++c]=x.__VECTOR3__.z,c++,g=0==_?this._beginGridX+x.LEAF_GRID_NUM+1:this._beginGridX+x.LEAF_GRID_NUM,this.calcVertextNormlUV(g,this._beginGridZ+d,l,u,p),s[c]=p.x,s[++c]=p.y,s[++c]=p.z,s[++c]=(i+x.LEAF_GRID_NUM)/x.CHUNK_GRID_NUM,s[++c]=(n+d)/x.CHUNK_GRID_NUM,s[++c]=g,s[++c]=this._beginGridZ+d,c++},t.calcOriginalBoudingBoxAndSphere=function(){var t=new ln(this._beginGridX*this._gridSize,this._sizeOfY.x,this._beginGridZ*this._gridSize),e=new ln((this._beginGridX+x.LEAF_GRID_NUM)*this._gridSize,this._sizeOfY.y,(this._beginGridZ+x.LEAF_GRID_NUM)*this._gridSize);x.__ADAPT_MATRIX__&&(ln.transformV3ToV3(t,x.__ADAPT_MATRIX__,t),ln.transformV3ToV3(e,x.__ADAPT_MATRIX__,e)),this._originalBoundingBox=new Qe(t,e);var i=new ln;ln.subtract(e,t,i),ln.scale(i,.5,i);var n=new ln;ln.add(t,i,n),this._originalBoundingSphere=new Ft(n,ln.scalarLength(i)),this._originalBoundingBoxCorners=P(8,null),this._originalBoundingBox.getCorners(this._originalBoundingBoxCorners),this._boundingBox=new Qe(new ln(-.5,-.5,-.5),new ln(.5,.5,.5)),this._boundingSphere=new Ft(new ln(0,0,0),1)},t.calcLeafBoudingBox=function(t){for(var e=0;e<8;e++)ln.transformCoordinate(this._originalBoundingBoxCorners[e],t,Bn._tempBoundBoxCorners[e]);Qe.createfromPoints(Bn._tempBoundBoxCorners,this._boundingBox)},t.calcLeafBoudingSphere=function(t,e){ln.transformCoordinate(this._originalBoundingSphere.center,t,this._boundingSphere.center),this._boundingSphere.radius=this._originalBoundingSphere.radius*e},t.calcLODErrors=function(t,e,i){this._LODError=new Float32Array(x._maxLODLevel+1);for(var n=1,r=0,s=x._maxLODLevel+1;r<s;r++){for(var a=0,o=0,h=x.LEAF_GRID_NUM;o<h;o+=n)for(var l=0,u=x.LEAF_GRID_NUM;l<u;l+=n)for(var c=t[(this._beginGridZ+o)*e+(this._beginGridX+l)],_=t[(this._beginGridZ+o)*e+(this._beginGridX+l)+n],d=t[(this._beginGridZ+o+n)*e+(this._beginGridX+l)],f=t[(this._beginGridZ+o+n)*e+(this._beginGridX+l)+n],p=0;p<n;p++)for(var m=p/n,g=0;g<n;g++){var v=g/n,T=t[(this._beginGridZ+o+p)*e+(this._beginGridX+l)+g],y=v+m<=1?c+(_-c)*v+(d-c)*m:f+(d-f)*(1-v)+(_-f)*(1-m),E=Math.abs(y-T);a=Math.max(a,E)}n*=2,this._LODError[r]=a}},t.determineLod=function(t,e,i,n){var r=ln.distance(t,this._boundingSphere.center),s=x._maxLODLevel;if(!n){if(this._lastDistanceToEye==r)return this._currentLODLevel;this._lastDistanceToEye>r&&(s=this._currentLODLevel)}for(var a=s;1<=a;a--)if(ws.LOD_DISTANCE_FACTOR*this._LODError[a]/r*e<i){this._currentLODLevel=a;break}return this._lastDistanceToEye=r,this._currentLODLevel},x.__init__=function(){if(!x._bInit){var t=x.CHUNK_GRID_NUM/x.LEAF_GRID_NUM*(x.CHUNK_GRID_NUM/x.LEAF_GRID_NUM);x._planeLODIndex=P(t);var e=0,i=0,n=0,r=0,s=0,a=0,o=null,h=null;for(e=0;e<t;e++)x._planeLODIndex[e]=new Array(x._maxLODLevel+1);for(e=0,r=x._maxLODLevel+1;e<r;e++)x._planeLODIndex[0][e]=x.calcPlaneLODIndex(e);for(e=1;e<t;e++)for(a=e*x.LEAF_PLANE_VERTEXT_COUNT,i=0,s=x._maxLODLevel+1;i<s;i++){for(o=x._planeLODIndex[0][i],h=new Uint16Array(o.length),n=0;n<o.length;n++)h[n]=o[n]+a;x._planeLODIndex[e][i]=h}for(x._skirtLODIndex=P(t),e=0;e<t;e++)x._skirtLODIndex[e]=new Array(x._maxLODLevel+1);for(e=0,r=x._maxLODLevel+1;e<r;e++)x._skirtLODIndex[0][e]=x.calcSkirtLODIndex(e);for(e=1;e<t;e++)for(a=e*x.LEAF_SKIRT_VERTEXT_COUNT,i=0,s=x._maxLODLevel+1;i<s;i++){for(o=x._skirtLODIndex[0][i],h=new Uint16Array(o.length),n=0;n<o.length;n++)h[n]=o[n]+a;x._skirtLODIndex[e][i]=h}x._bInit=!0}},x.getPlaneLODIndex=function(t,e){return x._planeLODIndex[t][e]},x.getSkirtLODIndex=function(t,e){return x._skirtLODIndex[t][e]},x.calcPlaneLODIndex=function(t){x._maxLODLevel<t&&(t=x._maxLODLevel);var e=x.LEAF_GRID_NUM+1,i=0,n=null,r=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/Math.pow(2,t);n=new Uint16Array(r*r*6);for(var s=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/r,a=0;a<x.LEAF_GRID_NUM;a+=s)for(var o=0;o<x.LEAF_GRID_NUM;o+=s)n[i]=(a+s)*e+o,n[++i]=a*e+o,n[++i]=a*e+o+s,n[++i]=a*e+o+s,n[++i]=(a+s)*e+o+s,n[++i]=(a+s)*e+o,i++;return n},x.calcSkirtLODIndex=function(t){x._maxLODLevel<t&&(t=x._maxLODLevel);var e=x.CHUNK_GRID_NUM/x.LEAF_GRID_NUM*(x.CHUNK_GRID_NUM/x.LEAF_GRID_NUM)*x.LEAF_PLANE_VERTEXT_COUNT,i=x.LEAF_GRID_NUM+1,n=0,r=null,s=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/Math.pow(2,t);r=new Uint16Array(4*s*6);for(var a=laya.d3.terrain.TerrainLeaf.LEAF_GRID_NUM/s,o=0;o<4;o++){for(var h=0;h<x.LEAF_GRID_NUM;h+=a)r[n]=e+i+h,r[++n]=e+h,r[++n]=e+h+a,r[++n]=e+h+a,r[++n]=e+i+h+a,r[++n]=e+i+h,n++;e+=2*i}return r},x.getHeightFromTerrainHeightData=function(t,e,i,n,r){return i[(e=r<=(e=e<0?0:e)?r-1:e)*n+(t=n<=(t=t<0?0:t)?n-1:t)]},x.CHUNK_GRID_NUM=64,x.LEAF_GRID_NUM=32,x.__ADAPT_MATRIX__=null,x.__ADAPT_MATRIX_INV__=null,x._planeLODIndex=null,x._skirtLODIndex=null,x._bInit=!1,E(x,["LEAF_PLANE_VERTEXT_COUNT",function(){return this.LEAF_PLANE_VERTEXT_COUNT=(x.LEAF_GRID_NUM+1)*(x.LEAF_GRID_NUM+1)},"LEAF_SKIRT_VERTEXT_COUNT",function(){return this.LEAF_SKIRT_VERTEXT_COUNT=2*(x.LEAF_GRID_NUM+1)*4},"LEAF_VERTEXT_COUNT",function(){return this.LEAF_VERTEXT_COUNT=x.LEAF_PLANE_VERTEXT_COUNT+x.LEAF_SKIRT_VERTEXT_COUNT},"LEAF_PLANE_MAX_INDEX_COUNT",function(){return this.LEAF_PLANE_MAX_INDEX_COUNT=x.LEAF_GRID_NUM*x.LEAF_GRID_NUM*6},"LEAF_SKIRT_MAX_INDEX_COUNT",function(){return this.LEAF_SKIRT_MAX_INDEX_COUNT=4*x.LEAF_GRID_NUM*6},"LEAF_MAX_INDEX_COUNT",function(){return this.LEAF_MAX_INDEX_COUNT=x.LEAF_PLANE_MAX_INDEX_COUNT+x.LEAF_SKIRT_MAX_INDEX_COUNT},"__VECTOR3__",function(){return this.__VECTOR3__=new ln},"_maxLODLevel",function(){return this._maxLODLevel=Math.log2(x.LEAF_GRID_NUM)}]),x}(),pe=function(){function t(t,e,i,n){this.r=NaN,this.g=NaN,this.b=NaN,this.a=NaN,void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===n&&(n=1),this.r=t,this.g=e,this.b=i,this.a=n}I(t,"laya.d3.math.Color");var e=t.prototype;return T.imps(e,{"laya.d3.core.IClone":!0}),e.toLinear=function(t){t.r=V.gammaToLinearSpace(this.r),t.g=V.gammaToLinearSpace(this.g),t.b=V.gammaToLinearSpace(this.b)},e.toGamma=function(t){t.r=V.linearToGammaSpace(this.r),t.g=V.linearToGammaSpace(this.g),t.b=V.linearToGammaSpace(this.b)},e.cloneTo=function(t){var e=t;e.r=this.r,e.g=this.g,e.b=this.b,e.a=this.a},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},e.forNativeElement=function(t){t?(this.elements=t,this.elements[0]=this.r,this.elements[1]=this.g,this.elements[2]=this.b,this.elements[3]=this.a):this.elements=new Float32Array([this.r,this.g,this.b,this.a]),un.rewriteNumProperty(this,"r",0),un.rewriteNumProperty(this,"g",1),un.rewriteNumProperty(this,"b",2),un.rewriteNumProperty(this,"a",3)},E(t,["RED",function(){return this.RED=new t(1,0,0,1)},"GREEN",function(){return this.GREEN=new t(0,1,0,1)},"BLUE",function(){return this.BLUE=new t(0,0,1,1)},"CYAN",function(){return this.CYAN=new t(0,1,1,1)},"YELLOW",function(){return this.YELLOW=new t(1,.92,.016,1)},"MAGENTA",function(){return this.MAGENTA=new t(1,0,1,1)},"GRAY",function(){return this.GRAY=new t(.5,.5,.5,1)},"WHITE",function(){return this.WHITE=new t(1,1,1,1)},"BLACK",function(){return this.BLACK=new t(0,0,0,1)}]),t}(),me=function(){function h(){}I(h,"laya.display.cmd.StrokeTextCmd");var t=h.prototype;return t.recover=function(){p.recover("StrokeTextCmd",this)},t.run=function(t,e,i){t.strokeWord(this.text,this.x+e,this.y+i,this.font,this.color,this.lineWidth,this.textAlign)},g(0,t,"cmdID",function(){return"StrokeText"}),h.create=function(t,e,i,n,r,s,a){var o=p.getItemByClass("StrokeTextCmd",h);return o.text=t,o.x=e,o.y=i,o.font=n,o.color=r,o.lineWidth=s,o.textAlign=a,o},h.ID="StrokeText",h}(),ge=function(){function r(){}return I(r,"laya.maths.MathUtil"),r.subtractVector3=function(t,e,i){i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2]},r.lerp=function(t,e,i){return t*(1-i)+e*i},r.scaleVector3=function(t,e,i){i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e},r.lerpVector3=function(t,e,i,n){var r=t[0],s=t[1],a=t[2];n[0]=r+i*(e[0]-r),n[1]=s+i*(e[1]-s),n[2]=a+i*(e[2]-a)},r.lerpVector4=function(t,e,i,n){var r=t[0],s=t[1],a=t[2],o=t[3];n[0]=r+i*(e[0]-r),n[1]=s+i*(e[1]-s),n[2]=a+i*(e[2]-a),n[3]=o+i*(e[3]-o)},r.slerpQuaternionArray=function(t,e,i,n,r,s,a){var o,h,l,u,c,_=t[e+0],d=t[e+1],f=t[e+2],p=t[e+3],m=i[n+0],g=i[n+1],v=i[n+2],T=i[n+3];return(h=_*m+d*g+f*v+p*T)<0&&(h=-h,m=-m,g=-g,v=-v,T=-T),c=1e-6<1-h?(o=Math.acos(h),l=Math.sin(o),u=Math.sin((1-r)*o)/l,Math.sin(r*o)/l):(u=1-r,r),s[a+0]=u*_+c*m,s[a+1]=u*d+c*g,s[a+2]=u*f+c*v,s[a+3]=u*p+c*T,s},r.getRotation=function(t,e,i,n){return Math.atan2(n-e,i-t)/Math.PI*180},r.sortBigFirst=function(t,e){return t==e?0:t<e?1:-1},r.sortSmallFirst=function(t,e){return t==e?0:t<e?-1:1},r.sortNumBigFirst=function(t,e){return parseFloat(e)-parseFloat(t)},r.sortNumSmallFirst=function(t,e){return parseFloat(t)-parseFloat(e)},r.sortByKey=function(i,t,e){var n;return void 0===t&&(t=!1),void 0===e&&(e=!0),n=t?e?r.sortNumBigFirst:r.sortBigFirst:e?r.sortNumSmallFirst:r.sortSmallFirst,function(t,e){return n(t[i],e[i])}},r}(),ve=function(){function l(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=t,this.y=e,this.width=i,this.height=n}I(l,"laya.maths.Rectangle");var t=l.prototype;return t.setTo=function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this},t.reset=function(){return this.x=this.y=this.width=this.height=0,this},t.recover=function(){this!=l.TEMP&&this!=l.EMPTY?p.recover("Rectangle",this.reset()):console.log("recover Temp or Empty:",this)},t.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},t.contains=function(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.right&&e>=this.y&&e<this.bottom)},t.intersects=function(t){return!(t.x>this.x+this.width||t.x+t.width<this.x||t.y>this.y+this.height||t.y+t.height<this.y)},t.intersection=function(t,e){return this.intersects(t)?(e||(e=new l),e.x=Math.max(this.x,t.x),e.y=Math.max(this.y,t.y),e.width=Math.min(this.right,t.right)-e.x,e.height=Math.min(this.bottom,t.bottom)-e.y,e):null},t.union=function(t,e){return e||(e=new l),this.clone(e),t.width<=0||t.height<=0?e:(e.addPoint(t.x,t.y),e.addPoint(t.right,t.bottom),this)},t.clone=function(t){return t||(t=new l),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},t.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},t.equals=function(t){return!(!t||t.x!==this.x||t.y!==this.y||t.width!==this.width||t.height!==this.height)},t.addPoint=function(t,e){return this.x>t&&(this.width+=this.x-t,this.x=t),this.y>e&&(this.height+=this.y-e,this.y=e),this.width<t-this.x&&(this.width=t-this.x),this.height<e-this.y&&(this.height=e-this.y),this},t._getBoundPoints=function(){var t=l._temB;return(t.length=0)==this.width||0==this.height||t.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),t},t.isEmpty=function(){return this.width<=0||this.height<=0},g(0,t,"bottom",function(){return this.y+this.height}),g(0,t,"right",function(){return this.x+this.width}),l.create=function(){return p.getItemByClass("Rectangle",l)},l._getBoundPointS=function(t,e,i,n){var r=l._temA;return(r.length=0)==i||0==n||r.push(t,e,t+i,e,t,e+n,t+i,e+n),r},l._getWrapRec=function(t,e){if(!t||t.length<1)return e?e.setTo(0,0,0,0):l.TEMP.setTo(0,0,0,0);e=e||laya.maths.Rectangle.create();var i,n,r,s,a,o=t.length,h=R.TEMP;for(r=a=-(n=s=99999),i=0;i<o;i+=2)h.x=t[i],h.y=t[i+1],n=n<h.x?n:h.x,s=s<h.y?s:h.y,r=r>h.x?r:h.x,a=a>h.y?a:h.y;return e.setTo(n,s,r-n,a-s)},l.EMPTY=new l,l.TEMP=new l,l._temB=[],l._temA=[],l}(),Te=function(){function t(){this._controlPoints=[new R,new R,new R],this._calFun=this.getPoint2}I(t,"laya.maths.Bezier");var e=t.prototype;return e._switchPoint=function(t,e){var i=this._controlPoints.shift();i.setTo(t,e),this._controlPoints.push(i)},e.getPoint2=function(t,e){var i=this._controlPoints[0],n=this._controlPoints[1],r=this._controlPoints[2],s=Math.pow(1-t,2)*i.x+2*t*(1-t)*n.x+Math.pow(t,2)*r.x,a=Math.pow(1-t,2)*i.y+2*t*(1-t)*n.y+Math.pow(t,2)*r.y;e.push(s,a)},e.getPoint3=function(t,e){var i=this._controlPoints[0],n=this._controlPoints[1],r=this._controlPoints[2],s=this._controlPoints[3],a=Math.pow(1-t,3)*i.x+3*n.x*t*(1-t)*(1-t)+3*r.x*t*t*(1-t)+s.x*Math.pow(t,3),o=Math.pow(1-t,3)*i.y+3*n.y*t*(1-t)*(1-t)+3*r.y*t*t*(1-t)+s.y*Math.pow(t,3);e.push(a,o)},e.insertPoints=function(t,e){var i,n=NaN;for(i=1/(t=0<t?t:5),n=0;n<=1;n+=i)this._calFun(n,e)},e.getBezierPoints=function(t,e,i){void 0===e&&(e=5),void 0===i&&(i=2);var n,r=0;if((n=t.length)<2*(i+1))return[];var s=[];switch(i){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=i;)this._controlPoints.push(R.create());for(r=0;r<2*i;r+=2)this._switchPoint(t[r],t[r+1]);for(r=2*i;r<n;r+=2)this._switchPoint(t[r],t[r+1]),r/2%i==0&&this.insertPoints(e,s);return s},E(t,["I",function(){return this.I=new t}]),t}(),ye=function(){function y(){}return I(y,"laya.d3.graphics.FrustumCulling"),y.__init__=function(){qi.supportWebGLPlusCulling&&(y._cullingBufferLength=0,y._cullingBuffer=new Float32Array(4096))},y._drawTraversalCullingBound=function(t,e){t.length;for(var i=t.elements,n=0,r=t.length;n<r;n++){var s=y._tempColor0;s.r=0,s.g=1,s.b=0,s.a=1,V._drawBound(e,i[n].bounds._getBoundBox(),s)}},y._traversalCulling=function(t,e,i,n){for(var r=n.length,s=n.elements,a=t.boundFrustum,o=t._transform.position,h=0;h<r;h++){var l=s[h];if(t._isLayerVisible(l._owner._layer)&&l._enable)if($i.frustumCulling++,!t.useOcclusionCulling||l._needRender(a)){l._visible=!0;var u=l.bounds;l._distanceForSort=ln.distance(u.getCenter(),o);for(var c=l._renderElements,_=0,d=c.length;_<d;_++){var f=c[_],p=e._getRenderQueue(f.material.renderQueue);p.isTransparent?f.addToTransparentRenderQueue(i,p):f.addToOpaqueRenderQueue(i,p)}}else l._visible=!1;else l._visible=!1}},y.renderObjectCulling=function(t,e,i,n){var r=0,s=0,a=e._opaqueQueue,o=e._transparentQueue;a.clear(),o.clear();var h=Bt._managers;for(r=0,s=h.length;r<s;r++)h[r]._clear();var l=wt._managers;for(r=0,s=l.length;r<s;r++)l[r]._clear();var u=e._octree;if(u?(u.updateMotionObjects(),u.shrinkRootIfPossible(),u.getCollidingWithFrustum(i)):y._traversalCulling(t,e,i,n),In._config.debugFrustumCulling){var c=e._debugTool;c.clear(),u?(u.drawAllBounds(c),u.drawAllObjects(c)):y._drawTraversalCullingBound(n,c)}var _=a.elements.length;0<_&&a._quickSort(0,_-1),0<(_=o.elements.length)&&o._quickSort(0,_-1)},y.renderObjectCullingNative=function(t,e,i,n){var r=0,s=0,a=0,o=0,h=e._opaqueQueue,l=e._transparentQueue;h.clear(),l.clear();var u=Bt._managers;for(r=0,s=u.length;r<s;r++)u[r]._clear();var c=wt._managers;for(r=0,s=c.length;r<s;r++)c[r]._clear();var _=n.length,d=n.elements;for(r=0;r<_;r++)d[r].bounds;t.boundFrustum;y.cullingNative(t._boundFrustumBuffer,y._cullingBuffer,e._cullingBufferIndices,_,e._cullingBufferResult);var f=i.camera._transform.position;for(r=0;r<_;r++){var p=d[r];if(t._isLayerVisible(p._owner._layer)&&p._enable&&e._cullingBufferResult[r]){p._visible=!0,p._distanceForSort=ln.distance(p.bounds.getCenter(),f);var m=p._renderElements;for(a=0,o=m.length;a<o;a++){var g=m[a],v=e._getRenderQueue(g.material.renderQueue);v.isTransparent?g.addToTransparentRenderQueue(i,v):g.addToOpaqueRenderQueue(i,v)}}else p._visible=!1}var T=h.elements.length;0<T&&h._quickSort(0,T-1),0<(T=l.elements.length)&&l._quickSort(0,T-1)},y.cullingNative=function(t,e,i,n,r){return Nt.instance.culling(t,e,i,n,r)},y._cullingBufferLength=0,y._cullingBuffer=null,E(y,["_tempVector3",function(){return this._tempVector3=new ln},"_tempColor0",function(){return this._tempColor0=new pe}]),y}(),Ee=function(){function t(){this._idCounter=0,this.colliderA=null,this.colliderB=null,this.distance=0,this.normal=new ln,this.positionOnA=new ln,this.positionOnB=new ln,this._id=++this._idCounter}return I(t,"laya.d3.physics.ContactPoint"),t}(),xe=function(){function n(t){this._ownerResource=null,this._data=null,this._int32Data=null,this._float32Data=null,this._nativeArray=null,this._frameCount=0,this._runtimeCopyValues=[],this._ownerResource=t,this._initData()}I(n,"laya.d3.shader.ShaderData");var t=n.prototype;return T.imps(t,{"laya.d3.core.IClone":!0}),t._initData=function(){this._data=new Object},t.getData=function(){return this._data},t.getBool=function(t){return this._data[t]},t.setBool=function(t,e){this._data[t]=e},t.getInt=function(t){return this._data[t]},t.setInt=function(t,e){this._data[t]=e},t.getNumber=function(t){return this._data[t]},t.setNumber=function(t,e){this._data[t]=e},t.getVector2=function(t){return this._data[t]},t.setVector2=function(t,e){this._data[t]=e},t.getVector3=function(t){return this._data[t]},t.setVector3=function(t,e){this._data[t]=e},t.getVector=function(t){return this._data[t]},t.setVector=function(t,e){this._data[t]=e},t.getQuaternion=function(t){return this._data[t]},t.setQuaternion=function(t,e){this._data[t]=e},t.getMatrix4x4=function(t){return this._data[t]},t.setMatrix4x4=function(t,e){this._data[t]=e},t.getBuffer=function(t){return this._data[t]},t.setBuffer=function(t,e){this._data[t]=e},t.setTexture=function(t,e){var i=this._data[t];this._data[t]=e,this._ownerResource&&0<this._ownerResource.referenceCount&&(i&&i._removeReference(),e&&e._addReference())},t.getTexture=function(t){return this._data[t]},t.setAttribute=function(t,e){this._data[t]=e},t.getAttribute=function(t){return this._data[t]},t.getLength=function(){return this._data.length},t.setLength=function(t){this._data.length=t},t.cloneTo=function(t){var e=t._data;for(var i in this._data){var n=this._data[i];if(null!=n)if("number"==typeof n)e[i]=n;else if("number"==typeof n&&Math.floor(n)==n)e[i]=n;else if("boolean"==typeof n)e[i]=n;else if(n instanceof laya.d3.math.Vector2){var r=e[i]||(e[i]=new un);n.cloneTo(r),e[i]=r}else if(n instanceof laya.d3.math.Vector3){var s=e[i]||(e[i]=new ln);n.cloneTo(s),e[i]=s}else if(n instanceof laya.d3.math.Vector4){var a=e[i]||(e[i]=new on);n.cloneTo(a),e[i]=a}else if(n instanceof laya.d3.math.Matrix4x4){var o=e[i]||(e[i]=new gt);n.cloneTo(o),e[i]=o}else n instanceof laya.resource.BaseTexture&&(e[i]=n)}},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t.cloneToForNative=function(t){var e=t;0<this._int32Data.length-e._int32Data.length&&e.needRenewArrayBufferForNative(this._int32Data.length),e._int32Data.set(this._int32Data,0);var i=e._nativeArray,n=this._nativeArray.length;i.length=n;for(var r=0;r<n;r++){var s=this._nativeArray[r];if(s)if("number"==typeof s)i[r]=s,e.setNumber(r,s);else if("number"==typeof s&&Math.floor(s)==s)i[r]=s,e.setInt(r,s);else if("boolean"==typeof s)i[r]=s,e.setBool(r,s);else if(s instanceof laya.d3.math.Vector2){var a=i[r]||(i[r]=new un);s.cloneTo(a),i[r]=a,e.setVector2(r,a)}else if(s instanceof laya.d3.math.Vector3){var o=i[r]||(i[r]=new ln);s.cloneTo(o),i[r]=o,e.setVector3(r,o)}else if(s instanceof laya.d3.math.Vector4){var h=i[r]||(i[r]=new on);s.cloneTo(h),i[r]=h,e.setVector(r,h)}else if(s instanceof laya.d3.math.Matrix4x4){var l=i[r]||(i[r]=new gt);s.cloneTo(l),i[r]=l,e.setMatrix4x4(r,l)}else s instanceof laya.resource.BaseTexture&&(i[r]=s,e.setTexture(r,s))}},t._initDataForNative=function(){this._frameCount=-1,this._runtimeCopyValues.length=0,this._nativeArray=[],this._data=new ArrayBuffer(32),this._int32Data=new Int32Array(this._data),this._float32Data=new Float32Array(this._data),Nt.createArrayBufferRef(this._data,0,!0)},t.needRenewArrayBufferForNative=function(t){if(t>=this._int32Data.length){var e=4*(t+1),i=this._int32Data,n=this._data.conchRef,r=this._data._ptrID;this._data=new ArrayBuffer(e),this._int32Data=new Int32Array(this._data),this._float32Data=new Float32Array(this._data),this._data.conchRef=n,this._data._ptrID=r,i&&this._int32Data.set(i,0),conch.updateArrayBufferRef(this._data._ptrID,n.isSyncToRender(),this._data)}},t.getDataForNative=function(){return this._nativeArray},t.getIntForNative=function(t){return this._int32Data[t]},t.setIntForNative=function(t,e){this.needRenewArrayBufferForNative(t),this._int32Data[t]=e,this._nativeArray[t]=e},t.getBoolForNative=function(t){return 1==this._int32Data[t]},t.setBoolForNative=function(t,e){this.needRenewArrayBufferForNative(t),this._int32Data[t]=e,this._nativeArray[t]=e},t.getNumberForNative=function(t){return this._float32Data[t]},t.setNumberForNative=function(t,e){this.needRenewArrayBufferForNative(t),this._float32Data[t]=e,this._nativeArray[t]=e},t.getMatrix4x4ForNative=function(t){return this._nativeArray[t]},t.setMatrix4x4ForNative=function(t,e){this.needRenewArrayBufferForNative(t),this._nativeArray[t]=e;var i=this.setReferenceForNative(e.elements);this._int32Data[t]=i},t.getVectorForNative=function(t){return this._nativeArray[t]},t.setVectorForNative=function(t,e){this.needRenewArrayBufferForNative(t),(this._nativeArray[t]=e).elements||e.forNativeElement();var i=this.setReferenceForNative(e.elements);this._int32Data[t]=i},t.getVector2ForNative=function(t){return this._nativeArray[t]},t.setVector2ForNative=function(t,e){this.needRenewArrayBufferForNative(t),(this._nativeArray[t]=e).elements||e.forNativeElement();var i=this.setReferenceForNative(e.elements);this._int32Data[t]=i},t.getVector3ForNative=function(t){return this._nativeArray[t]},t.setVector3ForNative=function(t,e){this.needRenewArrayBufferForNative(t),(this._nativeArray[t]=e).elements||e.forNativeElement();var i=this.setReferenceForNative(e.elements);this._int32Data[t]=i},t.getQuaternionForNative=function(t){return this._nativeArray[t]},t.setQuaternionForNative=function(t,e){this.needRenewArrayBufferForNative(t),(this._nativeArray[t]=e).elements||e.forNativeElement();var i=this.setReferenceForNative(e.elements);this._int32Data[t]=i},t.getBufferForNative=function(t){return this._nativeArray[t]},t.setBufferForNative=function(t,e){this.needRenewArrayBufferForNative(t),this._nativeArray[t]=e;var i=this.setReferenceForNative(e);this._int32Data[t]=i},t.getAttributeForNative=function(t){return this._nativeArray[t]},t.setAttributeForNative=function(t,e){(this._nativeArray[t]=e)._ptrID||Nt.createArrayBufferRef(e,0,!0),Nt.syncBufferToRenderThread(e),this._int32Data[t]=e._ptrID},t.getTextureForNative=function(t){return this._nativeArray[t]},t.setTextureForNative=function(t,e){if(e){this.needRenewArrayBufferForNative(t);var i=this._nativeArray[t];this._nativeArray[t]=e,this._int32Data[t]=e._glTexture.id,this._ownerResource&&0<this._ownerResource.referenceCount&&(i&&i._removeReference(),e&&e._addReference())}},t.setReferenceForNative=function(t){this.clearRuntimeCopyArray();var e=0,i=0;return n._SET_RUNTIME_VALUE_MODE_REFERENCE_?(Nt.createArrayBufferRefs(t,0,!0,0),e=0,i=t.getPtrID(e)):(Nt.createArrayBufferRefs(t,0,!0,1),e=t.getRefNum()-1,i=t.getPtrID(e),this._runtimeCopyValues.push({obj:t,refID:e,ptrID:i})),Nt.syncBufferToRenderThread(t,e),i},t.clearRuntimeCopyArray=function(){var t=Nt.getFrameCount();if(this._frameCount!=t){this._frameCount=t;for(var e=0,i=this._runtimeCopyValues.length;e<i;e++){this._runtimeCopyValues[e].obj.clearRefNum()}this._runtimeCopyValues.length=0}},n.setRuntimeValueMode=function(t){n._SET_RUNTIME_VALUE_MODE_REFERENCE_=t},n._SET_RUNTIME_VALUE_MODE_REFERENCE_=!0,n}(),Se=function(){function r(){}return I(r,"laya.utils.CacheManger"),r.regCacheByFunction=function(t,e){var i;r.unRegCacheByFunction(t,e),i={tryDispose:t,getCacheList:e},r._cacheList.push(i)},r.unRegCacheByFunction=function(t,e){var i,n=0;for(i=r._cacheList.length,n=0;n<i;n++)if(r._cacheList[n].tryDispose==t&&r._cacheList[n].getCacheList==e)return void r._cacheList.splice(n,1)},r.forceDispose=function(){var t=0,e=r._cacheList.length;for(t=0;t<e;t++)r._cacheList[t].tryDispose(!0)},r.beginCheck=function(t){void 0===t&&(t=15e3),T.systemTimer.loop(t,null,r._checkLoop)},r.stopCheck=function(){T.systemTimer.clear(null,r._checkLoop)},r._checkLoop=function(){var t=r._cacheList;if(!(t.length<1)){var e,i=Vt.now(),n=0;for(e=n=t.length;0<n&&(t[r._index=++r._index%e].tryDispose(!1),!(Vt.now()-i>r.loopTimeLimit));)n--}},r.loopTimeLimit=2,r._cacheList=[],r._index=0,r}(),Ce=function(){function e(t){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,t?(this._u8d_=new Uint8Array(t),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this._resizeBuffer(this._allocated_)}I(e,"laya.utils.Byte");var t=e.prototype;return t._resizeBuffer=function(e){try{var t=new Uint8Array(e);null!=this._u8d_&&(this._u8d_.length<=e?t.set(this._u8d_):t.set(this._u8d_.subarray(0,e))),this._u8d_=t,this._d_=new DataView(t.buffer)}catch(t){throw"Invalid typed array length:"+e}},t.getString=function(){return this.readString()},t.readString=function(){return this._rUTF(this.getUint16())},t.getFloat32Array=function(t,e){return this.readFloat32Array(t,e)},t.readFloat32Array=function(t,e){var i=t+e;i=i>this._length?this._length:i;var n=new Float32Array(this._d_.buffer.slice(t,i));return this._pos_=i,n},t.getUint8Array=function(t,e){return this.readUint8Array(t,e)},t.readUint8Array=function(t,e){var i=t+e;i=i>this._length?this._length:i;var n=new Uint8Array(this._d_.buffer.slice(t,i));return this._pos_=i,n},t.getInt16Array=function(t,e){return this.readInt16Array(t,e)},t.readInt16Array=function(t,e){var i=t+e;i=i>this._length?this._length:i;var n=new Int16Array(this._d_.buffer.slice(t,i));return this._pos_=i,n},t.getFloat32=function(){return this.readFloat32()},t.readFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var t=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,t},t.getFloat64=function(){return this.readFloat64()},t.readFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var t=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,t},t.writeFloat32=function(t){this._ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,t,this._xd_),this._pos_+=4},t.writeFloat64=function(t){this._ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,t,this._xd_),this._pos_+=8},t.getInt32=function(){return this.readInt32()},t.readInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var t=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,t},t.getUint32=function(){return this.readUint32()},t.readUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var t=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,t},t.writeInt32=function(t){this._ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,t,this._xd_),this._pos_+=4},t.writeUint32=function(t){this._ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,t,this._xd_),this._pos_+=4},t.getInt16=function(){return this.readInt16()},t.readInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var t=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,t},t.getUint16=function(){return this.readUint16()},t.readUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var t=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,t},t.writeUint16=function(t){this._ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,t,this._xd_),this._pos_+=2},t.writeInt16=function(t){this._ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,t,this._xd_),this._pos_+=2},t.getUint8=function(){return this.readUint8()},t.readUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._u8d_[this._pos_++]},t.writeUint8=function(t){this._ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,t),this._pos_++},t._getUInt8=function(t){return this._readUInt8(t)},t._readUInt8=function(t){return this._d_.getUint8(t)},t._getUint16=function(t){return this._readUint16(t)},t._readUint16=function(t){return this._d_.getUint16(t,this._xd_)},t._getMatrix=function(){return this._readMatrix()},t._readMatrix=function(){return new It(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32())},t._rUTF=function(t){var e=this._pos_+t,i=0,n=String.fromCharCode,r=this._u8d_,s=[],a=0;for(s.length=1e3;this._pos_<e;)(i=r[this._pos_++])<128?0!=i&&(s[a++]=n(i)):s[a++]=i<224?n((63&i)<<6|127&r[this._pos_++]):i<240?n((31&i)<<12|(127&r[this._pos_++])<<6|127&r[this._pos_++]):n((15&i)<<18|(127&r[this._pos_++])<<12|r[this._pos_++]<<6&127|127&r[this._pos_++]),0;return s.length=a,s.join("")},t.getCustomString=function(t){return this.readCustomString(t)},t.readCustomString=function(t){for(var e="",i=0,n=0,r=String.fromCharCode,s=this._u8d_;0<t;)if((n=s[this._pos_])<128)e+=r(n),this._pos_++,t--;else for(i=n-128,this._pos_++,t-=i;0<i;)n=s[this._pos_++],e+=r(s[this._pos_++]<<8|n),i--;return e},t.clear=function(){this._pos_=0,this.length=0},t.__getBuffer=function(){return this._d_.buffer},t.writeUTFBytes=function(t){for(var e=0,i=(t+="").length;e<i;e++){var n=t.charCodeAt(e);n<=127?this.writeByte(n):n<=2047?(this._ensureWrite(this._pos_+2),this._u8d_.set([192|n>>6,128|63&n],this._pos_),this._pos_+=2):n<=65535?(this._ensureWrite(this._pos_+3),this._u8d_.set([224|n>>12,128|n>>6&63,128|63&n],this._pos_),this._pos_+=3):(this._ensureWrite(this._pos_+4),this._u8d_.set([240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n],this._pos_),this._pos_+=4)}},t.writeUTFString=function(t){var e=this.pos;this.writeUint16(1),this.writeUTFBytes(t);var i=this.pos-e-2;this._d_.setUint16(e,i,this._xd_)},t.readUTFString=function(){return this.readUTFBytes(this.getUint16())},t.getUTFString=function(){return this.readUTFString()},t.readUTFBytes=function(t){if(void 0===t&&(t=-1),0===t)return"";var e=this.bytesAvailable;if(e<t)throw"readUTFBytes error - Out of bounds";return t=0<t?t:e,this._rUTF(t)},t.getUTFBytes=function(t){return void 0===t&&(t=-1),this.readUTFBytes(t)},t.writeByte=function(t){this._ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,t),this._pos_+=1},t.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},t.getByte=function(){return this.readByte()},t._ensureWrite=function(t){this._length<t&&(this._length=t),this._allocated_<t&&(this.length=t)},t.writeArrayBuffer=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=0),e<0||i<0)throw"writeArrayBuffer error - Out of bounds";0==i&&(i=t.byteLength-e),this._ensureWrite(this._pos_+i);var n=new Uint8Array(t);this._u8d_.set(n.subarray(e,e+i),this._pos_),this._pos_+=i},t.readArrayBuffer=function(t){var e;return e=this._u8d_.buffer.slice(this._pos_,this._pos_+t),this._pos_=this._pos_+t,e},g(0,t,"pos",function(){return this._pos_},function(t){this._pos_=t}),g(0,t,"bytesAvailable",function(){return this._length-this._pos_}),g(0,t,"length",function(){return this._length},function(t){this._allocated_<t?this._resizeBuffer(this._allocated_=Math.floor(Math.max(t,2*this._allocated_))):this._allocated_>t&&this._resizeBuffer(this._allocated_=t),this._length=t}),g(0,t,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function(t){this._xd_="littleEndian"===t}),g(0,t,"buffer",function(){var t=this._d_.buffer;return t.byteLength===this._length?t:t.slice(0,this._length)}),e.getSystemEndian=function(){if(!e._sysEndian){var t=new ArrayBuffer(2);new DataView(t).setInt16(0,256,!0),e._sysEndian=256===new Int16Array(t)[0]?"littleEndian":"bigEndian"}return e._sysEndian},e.BIG_ENDIAN="bigEndian",e.LITTLE_ENDIAN="littleEndian",e._sysEndian=null,e}(),Ie=function(){function r(){this.texWidth=1024,this.texHeight=1024,this.atlasgrid=null,this.protectDist=1,this.texture=null,this.charMaps={},this.texHeight=this.texWidth=mt.atlasWidth,this.texture=hs.getTextTexture(this.texWidth,this.texHeight),256<this.texWidth/r.atlasGridW&&(r.atlasGridW=Math.ceil(this.texWidth/256)),this.atlasgrid=new ei(this.texWidth/r.atlasGridW,this.texHeight/r.atlasGridW,this.texture.id)}I(r,"laya.webgl.text.TextAtlas");var t=r.prototype;return t.setProtecteDist=function(t){this.protectDist=t},t.getAEmpty=function(t,e,i){var n=this.atlasgrid.addRect(1,Math.ceil(t/r.atlasGridW),Math.ceil(e/r.atlasGridW),i);return n&&(i.x*=r.atlasGridW,i.y*=r.atlasGridW),n},t.destroy=function(){for(var t in this.charMaps){this.charMaps[t].deleted=!0}this.texture.discard()},t.printDebugInfo=function(){},g(0,t,"usedRate",function(){return this.atlasgrid._used}),r.atlasGridW=16,r}(),Re=function(){function t(t,e){this.origin=null,this.direction=null,this.origin=t,this.direction=e}return I(t,"laya.d3.math.Ray"),t}(),Ae=function(){function M(t,e){this._nativeDiscreteDynamicsWorld=null,this._nativeCollisionWorld=null,this._nativeDispatcher=null,this._nativeCollisionConfiguration=null,this._nativeBroadphase=null,this._nativeSolverInfo=null,this._nativeDispatchInfo=null,this._nativeClosestRayResultCallback=null,this._nativeAllHitsRayResultCallback=null,this._nativeClosestConvexResultCallback=null,this._nativeAllConvexResultCallback=null,this._updatedRigidbodies=0,this.maxSubSteps=1,this.fixedTimeStep=1/60,this._gravity=new ln(0,-10,0),this._nativeVector3Zero=new In._physics3D.btVector3(0,0,0),this._nativeDefaultQuaternion=new In._physics3D.btQuaternion(0,0,0,-1),this._collisionsUtils=new O,this._previousFrameCollisions=[],this._currentFrameCollisions=[],this._physicsUpdateList=new Tr,this._characters=[],void 0===e&&(e=0),this.maxSubSteps=t.maxSubSteps,this.fixedTimeStep=t.fixedTimeStep;var i=In._physics3D;this._nativeCollisionConfiguration=new i.btDefaultCollisionConfiguration,this._nativeDispatcher=new i.btCollisionDispatcher(this._nativeCollisionConfiguration),this._nativeBroadphase=new i.btDbvtBroadphase,this._nativeBroadphase.getOverlappingPairCache().setInternalGhostPairCallback(new i.btGhostPairCallback);var n=t.flags;if(1&n)this._nativeCollisionWorld=new i.btCollisionWorld(this._nativeDispatcher,this._nativeBroadphase,this._nativeCollisionConfiguration);else{if(2&n)throw"PhysicsSimulation:SoftBody processing is not yet available";var r=new i.btSequentialImpulseConstraintSolver;this._nativeDiscreteDynamicsWorld=new i.btDiscreteDynamicsWorld(this._nativeDispatcher,this._nativeBroadphase,r,this._nativeCollisionConfiguration),this._nativeCollisionWorld=this._nativeDiscreteDynamicsWorld}this._nativeDiscreteDynamicsWorld&&(this._nativeSolverInfo=this._nativeDiscreteDynamicsWorld.getSolverInfo(),this._nativeDispatchInfo=this._nativeDiscreteDynamicsWorld.getDispatchInfo()),this._nativeClosestRayResultCallback=new i.ClosestRayResultCallback(this._nativeVector3Zero,this._nativeVector3Zero),this._nativeAllHitsRayResultCallback=new i.AllHitsRayResultCallback(this._nativeVector3Zero,this._nativeVector3Zero),this._nativeClosestConvexResultCallback=new i.ClosestConvexResultCallback(this._nativeVector3Zero,this._nativeVector3Zero),this._nativeAllConvexResultCallback=new i.AllConvexResultCallback(this._nativeVector3Zero,this._nativeVector3Zero),i._btGImpactCollisionAlgorithm_RegisterAlgorithm(this._nativeDispatcher.a)}I(M,"laya.d3.physics.PhysicsSimulation");var t=M.prototype;return t._simulate=function(t){this._updatedRigidbodies=0,this._nativeDiscreteDynamicsWorld?this._nativeDiscreteDynamicsWorld.stepSimulation(t,this.maxSubSteps,this.fixedTimeStep):this._nativeCollisionWorld.PerformDiscreteCollisionDetection()},t._destroy=function(){var t=In._physics3D;this._nativeDiscreteDynamicsWorld?(t.destroy(this._nativeDiscreteDynamicsWorld),this._nativeDiscreteDynamicsWorld=null):(t.destroy(this._nativeCollisionWorld),this._nativeCollisionWorld=null),t.destroy(this._nativeBroadphase),this._nativeBroadphase=null,t.destroy(this._nativeDispatcher),this._nativeDispatcher=null,t.destroy(this._nativeCollisionConfiguration),this._nativeCollisionConfiguration=null},t._addPhysicsCollider=function(t,e,i){this._nativeCollisionWorld.addCollisionObject(t._nativeColliderObject,e,i)},t._removePhysicsCollider=function(t){this._nativeCollisionWorld.removeCollisionObject(t._nativeColliderObject)},t._addRigidBody=function(t,e,i){if(!this._nativeDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";this._nativeCollisionWorld.addRigidBody(t._nativeColliderObject,e,i)},t._removeRigidBody=function(t){if(!this._nativeDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";this._nativeCollisionWorld.removeRigidBody(t._nativeColliderObject)},t._addCharacter=function(t,e,i){if(!this._nativeDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";this._nativeCollisionWorld.addCollisionObject(t._nativeColliderObject,e,i),this._nativeCollisionWorld.addAction(t._nativeKinematicCharacter)},t._removeCharacter=function(t){if(!this._nativeDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";this._nativeCollisionWorld.removeCollisionObject(t._nativeColliderObject),this._nativeCollisionWorld.removeAction(t._nativeKinematicCharacter)},t.raycastFromTo=function(t,e,i,n,r){void 0===n&&(n=$t.COLLISIONFILTERGROUP_ALLFILTER),void 0===r&&(r=$t.COLLISIONFILTERGROUP_ALLFILTER);var s=this._nativeClosestRayResultCallback,a=M._nativeTempVector30,o=M._nativeTempVector31;if(a.setValue(-t.x,t.y,t.z),o.setValue(-e.x,e.y,e.z),s.set_m_rayFromWorld(a),s.set_m_rayToWorld(o),s.set_m_collisionFilterGroup(n),s.set_m_collisionFilterMask(r),s.set_m_collisionObject(null),s.set_m_closestHitFraction(1),this._nativeCollisionWorld.rayTest(a,o,s),s.hasHit()){if(i){i.succeeded=!0,i.collider=Pn._physicObjectsMap[s.get_m_collisionObject().getUserIndex()],i.hitFraction=s.get_m_closestHitFraction();var h=s.get_m_hitPointWorld(),l=i.point;l.x=-h.x(),l.y=h.y(),l.z=h.z();var u=s.get_m_hitNormalWorld(),c=i.normal;c.x=-u.x(),c.y=u.y(),c.z=u.z()}return!0}return i&&(i.succeeded=!1),!1},t.raycastAllFromTo=function(t,e,i,n,r){void 0===n&&(n=$t.COLLISIONFILTERGROUP_ALLFILTER),void 0===r&&(r=$t.COLLISIONFILTERGROUP_ALLFILTER);var s=this._nativeAllHitsRayResultCallback,a=M._nativeTempVector30,o=M._nativeTempVector31;i.length=0,a.setValue(-t.x,t.y,t.z),o.setValue(-e.x,e.y,e.z),s.set_m_rayFromWorld(a),s.set_m_rayToWorld(o),s.set_m_collisionFilterGroup(n),s.set_m_collisionFilterMask(r);var h=s.get_m_collisionObjects(),l=s.get_m_hitPointWorld(),u=s.get_m_hitNormalWorld(),c=s.get_m_hitFractions();h.clear(),l.clear(),u.clear(),c.clear(),this._nativeCollisionWorld.rayTest(a,o,s);var _=h.size();if(0<_){this._collisionsUtils.recoverAllHitResultsPool();for(var d=0;d<_;d++){var f=this._collisionsUtils.getHitResult();i.push(f),f.succeeded=!0,f.collider=Pn._physicObjectsMap[h.at(d).getUserIndex()],f.hitFraction=c.at(d);var p=l.at(d),m=f.point;m.x=-p.x(),m.y=p.y(),m.z=p.z();var g=u.at(d),v=f.normal;v.x=-g.x(),v.y=g.y(),v.z=g.z()}return!0}return!1},t.rayCast=function(t,e,i,n,r){void 0===i&&(i=2147483647),void 0===n&&(n=$t.COLLISIONFILTERGROUP_ALLFILTER),void 0===r&&(r=$t.COLLISIONFILTERGROUP_ALLFILTER);var s=t.origin,a=M._tempVector30;return ln.normalize(t.direction,a),ln.scale(a,i,a),ln.add(s,a,a),this.raycastFromTo(s,a,e,n,r)},t.rayCastAll=function(t,e,i,n,r){void 0===i&&(i=2147483647),void 0===n&&(n=$t.COLLISIONFILTERGROUP_ALLFILTER),void 0===r&&(r=$t.COLLISIONFILTERGROUP_ALLFILTER);var s=t.origin,a=M._tempVector30;return ln.normalize(t.direction,a),ln.scale(a,i,a),ln.add(s,a,a),this.raycastAllFromTo(s,a,e,n,r)},t.shapeCast=function(t,e,i,n,r,s,a,o,h){void 0===a&&(a=$t.COLLISIONFILTERGROUP_ALLFILTER),void 0===o&&(o=$t.COLLISIONFILTERGROUP_ALLFILTER),void 0===h&&(h=0);var l=this._nativeClosestConvexResultCallback,u=M._nativeTempVector30,c=M._nativeTempVector31,_=M._nativeTempQuaternion0,d=M._nativeTempQuaternion1,f=M._nativeTempTransform0,p=M._nativeTempTransform1,m=t._nativeShape;if(u.setValue(-e.x,e.y,e.z),c.setValue(-i.x,i.y,i.z),l.set_m_collisionFilterGroup(a),l.set_m_collisionFilterMask(o),f.setOrigin(u),p.setOrigin(c),r?(_.setValue(-r.x,r.y,r.z,-r.w),f.setRotation(_)):f.setRotation(this._nativeDefaultQuaternion),s?(d.setValue(-s.x,s.y,s.z,-s.w),p.setRotation(d)):p.setRotation(this._nativeDefaultQuaternion),l.set_m_hitCollisionObject(null),l.set_m_closestHitFraction(1),this._nativeCollisionWorld.convexSweepTest(m,f,p,l,h),l.hasHit()){if(n){n.succeeded=!0,n.collider=Pn._physicObjectsMap[l.get_m_hitCollisionObject().getUserIndex()],n.hitFraction=l.get_m_closestHitFraction();var g=l.get_m_hitPointWorld(),v=l.get_m_hitNormalWorld(),T=n.point,y=n.normal;T.x=-g.x(),T.y=g.y(),T.z=g.z(),y.x=-v.x(),y.y=v.y(),y.z=v.z()}return!0}return n&&(n.succeeded=!1),!1},t.shapeCastAll=function(t,e,i,n,r,s,a,o,h){void 0===a&&(a=$t.COLLISIONFILTERGROUP_ALLFILTER),void 0===o&&(o=$t.COLLISIONFILTERGROUP_ALLFILTER),void 0===h&&(h=0);var l=this._nativeAllConvexResultCallback,u=M._nativeTempVector30,c=M._nativeTempVector31,_=M._nativeTempQuaternion0,d=M._nativeTempQuaternion1,f=M._nativeTempTransform0,p=M._nativeTempTransform1,m=t._nativeShape;n.length=0,u.setValue(-e.x,e.y,e.z),c.setValue(-i.x,i.y,i.z),l.set_m_collisionFilterGroup(a),l.set_m_collisionFilterMask(o),f.setOrigin(u),p.setOrigin(c),r?(_.setValue(-r.x,r.y,r.z,-r.w),f.setRotation(_)):f.setRotation(this._nativeDefaultQuaternion),s?(d.setValue(-s.x,s.y,s.z,-s.w),p.setRotation(d)):p.setRotation(this._nativeDefaultQuaternion);var g=l.get_m_collisionObjects();g.clear(),this._nativeCollisionWorld.convexSweepTest(m,f,p,l,h);var v=g.size();if(0<v){for(var T=l.get_m_hitPointWorld(),y=l.get_m_hitNormalWorld(),E=l.get_m_hitFractions(),x=0;x<v;x++){var S=this._collisionsUtils.getHitResult();n.push(S),S.succeeded=!0,S.collider=Pn._physicObjectsMap[g.at(x).getUserIndex()],S.hitFraction=E.at(x);var C=T.at(x),I=S.point;I.x=-C.x(),I.y=C.y(),I.z=C.z();var R=y.at(x),A=S.normal;A.x=-R.x(),A.y=R.y(),A.z=R.z()}return!0}return!1},t.addConstraint=function(t,e){if(void 0===e&&(e=!1),!this._nativeDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";this._nativeDiscreteDynamicsWorld.addConstraint(t._nativeConstraint,e),t._simulation=this},t.removeConstraint=function(t){if(!this._nativeDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";this._nativeDiscreteDynamicsWorld.removeConstraint(t._nativeConstraint)},t._updatePhysicsTransformFromRender=function(){for(var t=this._physicsUpdateList.elements,e=0,i=this._physicsUpdateList.length;e<i;e++){var n=t[e];n._derivePhysicsTransformation(!1),n._inPhysicUpdateListIndex=-1}this._physicsUpdateList.length=0},t._updateCharacters=function(){for(var t=0,e=this._characters.length;t<e;t++){var i=this._characters[t];i._updateTransformComponent(i._nativeColliderObject.getWorldTransform())}},t._updateCollisions=function(){this._collisionsUtils.recoverAllContactPointsPool();var t=this._currentFrameCollisions;this._currentFrameCollisions=this._previousFrameCollisions,this._currentFrameCollisions.length=0,this._previousFrameCollisions=t;for(var e=$i.loopCount,i=this._nativeDispatcher.getNumManifolds(),n=0;n<i;n++){var r=this._nativeDispatcher.getManifoldByIndexInternal(n),s=Pn._physicObjectsMap[r.getBody0().getUserIndex()],a=Pn._physicObjectsMap[r.getBody1().getUserIndex()],o=null,h=!1,l=null;if((s.isTrigger||a.isTrigger)&&(s.owner._needProcessTriggers||a.owner._needProcessTriggers))for(var u=r.getNumContacts(),c=0;c<u;c++){var _=r.getContactPoint(c),d=_.getDistance();if(d<=0){l=(o=this._collisionsUtils.getCollision(s,a)).contacts,(h=o._updateFrame!==e)&&(o._isTrigger=!0,l.length=0);break}}else if((s.owner._needProcessCollisions||a.owner._needProcessCollisions)&&(s._enableProcessCollisions||a._enableProcessCollisions))for(u=r.getNumContacts(),c=0;c<u;c++)if((d=(_=r.getContactPoint(c)).getDistance())<=0){var f=this._collisionsUtils.getContactPoints();f.colliderA=s,f.colliderB=a,f.distance=d;var p=_.get_m_normalWorldOnB(),m=f.normal;m.x=-p.x(),m.y=p.y(),m.z=p.z();var g=_.get_m_positionWorldOnA(),v=f.positionOnA;v.x=-g.x(),v.y=g.y(),v.z=g.z();var T=_.get_m_positionWorldOnB(),y=f.positionOnB;y.x=-T.x(),y.y=T.y(),y.z=T.z(),o||(l=(o=this._collisionsUtils.getCollision(s,a)).contacts,(h=o._updateFrame!==e)&&(o._isTrigger=!1,l.length=0)),l.push(f)}o&&h&&(this._currentFrameCollisions.push(o),o._setUpdateFrame(e))}},t._eventScripts=function(){for(var t=$i.loopCount,e=0,i=this._currentFrameCollisions.length;e<i;e++){var n=this._currentFrameCollisions[e],r=n._colliderA,s=n._colliderB;if(!r.destroyed&&!s.destroyed)if(t-n._lastUpdateFrame==1){var a=r.owner,o=a._scripts;if(o)if(n._isTrigger){if(a._needProcessTriggers)for(var h=0,l=o.length;h<l;h++)o[h].onTriggerStay(s)}else if(a._needProcessCollisions)for(h=0,l=o.length;h<l;h++)n.other=s,o[h].onCollisionStay(n);var u=s.owner,c=u._scripts;if(c)if(n._isTrigger){if(u._needProcessTriggers)for(h=0,l=c.length;h<l;h++)c[h].onTriggerStay(r)}else if(u._needProcessCollisions)for(h=0,l=c.length;h<l;h++)n.other=r,c[h].onCollisionStay(n)}else{if(o=(a=r.owner)._scripts)if(n._isTrigger){if(a._needProcessTriggers)for(h=0,l=o.length;h<l;h++)o[h].onTriggerEnter(s)}else if(a._needProcessCollisions)for(h=0,l=o.length;h<l;h++)n.other=s,o[h].onCollisionEnter(n);if(c=(u=s.owner)._scripts)if(n._isTrigger){if(u._needProcessTriggers)for(h=0,l=c.length;h<l;h++)c[h].onTriggerEnter(r)}else if(u._needProcessCollisions)for(h=0,l=c.length;h<l;h++)n.other=r,c[h].onCollisionEnter(n)}}for(e=0,i=this._previousFrameCollisions.length;e<i;e++){var _=this._previousFrameCollisions[e],d=_._colliderA,f=_._colliderB;if(!d.destroyed&&!f.destroyed&&t-_._updateFrame==1){if(this._collisionsUtils.recoverCollision(_),o=(a=d.owner)._scripts)if(_._isTrigger){if(a._needProcessTriggers)for(h=0,l=o.length;h<l;h++)o[h].onTriggerExit(f)}else if(a._needProcessCollisions)for(h=0,l=o.length;h<l;h++)_.other=f,o[h].onCollisionExit(_);if(c=(u=f.owner)._scripts)if(_._isTrigger){if(u._needProcessTriggers)for(h=0,l=c.length;h<l;h++)c[h].onTriggerExit(d)}else if(u._needProcessCollisions)for(h=0,l=c.length;h<l;h++)_.other=d,c[h].onCollisionExit(_)}}},t.clearForces=function(){if(!this._nativeDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";this._nativeDiscreteDynamicsWorld.clearForces()},g(0,t,"speculativeContactRestitution",function(){if(!this._nativeDiscreteDynamicsWorld)throw"Simulation:Cannot Cannot perform this action when the physics engine is set to CollisionsOnly";return this._nativeDiscreteDynamicsWorld.getApplySpeculativeContactRestitution()},function(t){if(!this._nativeDiscreteDynamicsWorld)throw"Simulation:Cannot Cannot perform this action when the physics engine is set to CollisionsOnly";this._nativeDiscreteDynamicsWorld.setApplySpeculativeContactRestitution(t)}),g(0,t,"gravity",function(){if(!this._nativeDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";return this._gravity},function(t){if(!this._nativeDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";this._gravity=t;var e=M._nativeTempVector30;e.setValue(-t.x,t.y,t.z),this._nativeDiscreteDynamicsWorld.setGravity(e)}),g(0,t,"continuousCollisionDetection",function(){return this._nativeDispatchInfo.get_m_useContinuous()},function(t){this._nativeDispatchInfo.set_m_useContinuous(t)}),M.createConstraint=function(){},M.PHYSICSENGINEFLAGS_NONE=0,M.PHYSICSENGINEFLAGS_COLLISIONSONLY=1,M.PHYSICSENGINEFLAGS_SOFTBODYSUPPORT=2,M.PHYSICSENGINEFLAGS_MULTITHREADED=4,M.PHYSICSENGINEFLAGS_USEHARDWAREWHENPOSSIBLE=8,M.SOLVERMODE_RANDMIZE_ORDER=1,M.SOLVERMODE_FRICTION_SEPARATE=2,M.SOLVERMODE_USE_WARMSTARTING=4,M.SOLVERMODE_USE_2_FRICTION_DIRECTIONS=16,M.SOLVERMODE_ENABLE_FRICTION_DIRECTION_CACHING=32,M.SOLVERMODE_DISABLE_VELOCITY_DEPENDENT_FRICTION_DIRECTION=64,M.SOLVERMODE_CACHE_FRIENDLY=128,M.SOLVERMODE_SIMD=256,M.SOLVERMODE_INTERLEAVE_CONTACT_AND_FRICTION_CONSTRAINTS=512,M.SOLVERMODE_ALLOW_ZERO_LENGTH_FRICTION_DIRECTIONS=1024,M.disableSimulation=!1,E(M,["_nativeTempVector30",function(){return this._nativeTempVector30=new In._physics3D.btVector3(0,0,0)},"_nativeTempVector31",function(){return this._nativeTempVector31=new In._physics3D.btVector3(0,0,0)},"_nativeTempQuaternion0",function(){return this._nativeTempQuaternion0=new In._physics3D.btQuaternion(0,0,0,1)},"_nativeTempQuaternion1",function(){return this._nativeTempQuaternion1=new In._physics3D.btQuaternion(0,0,0,1)},"_nativeTempTransform0",function(){return this._nativeTempTransform0=new In._physics3D.btTransform},"_nativeTempTransform1",function(){return this._nativeTempTransform1=new In._physics3D.btTransform},"_tempVector30",function(){return this._tempVector30=new ln}]),M}(),Me=function(){function o(){this._type=0,this._constant=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=null,this._constantMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}I(o,"laya.d3.core.particleShuriKen.module.GradientVelocity");var t=o.prototype;return T.imps(t,{"laya.d3.core.IClone":!0}),t.cloneTo=function(t){var e=t;e._type=this._type,this._constant.cloneTo(e._constant),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),this._constantMin.cloneTo(e._constantMin),this._constantMax.cloneTo(e._constantMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},g(0,t,"gradientZMax",function(){return this._gradientZMax}),g(0,t,"gradientZMin",function(){return this._gradientZMin}),g(0,t,"gradientYMin",function(){return this._gradientYMin}),g(0,t,"gradientY",function(){return this._gradientY}),g(0,t,"gradientXMax",function(){return this._gradientXMax}),g(0,t,"constantMax",function(){return this._constantMax}),g(0,t,"gradientX",function(){return this._gradientX}),g(0,t,"gradientZ",function(){return this._gradientZ}),g(0,t,"type",function(){return this._type}),g(0,t,"gradientXMin",function(){return this._gradientXMin}),g(0,t,"gradientYMax",function(){return this._gradientYMax}),g(0,t,"constant",function(){return this._constant}),g(0,t,"constantMin",function(){return this._constantMin}),o.createByConstant=function(t){var e=new o;return e._type=0,e._constant=t,e},o.createByGradient=function(t,e,i){var n=new o;return n._type=1,n._gradientX=t,n._gradientY=e,n._gradientZ=i,n},o.createByRandomTwoConstant=function(t,e){var i=new o;return i._type=2,i._constantMin=t,i._constantMax=e,i},o.createByRandomTwoGradient=function(t,e,i,n,r,s){var a=new o;return a._type=3,a._gradientXMin=t,a._gradientXMax=e,a._gradientYMin=i,a._gradientYMax=n,a._gradientZMin=r,a._gradientZMax=s,a},o}(),De=function(){function r(){}return I(r,"laya.events.KeyBoardManager"),r.__init__=function(){r._addEvent("keydown"),r._addEvent("keypress"),r._addEvent("keyup")},r._addEvent=function(e){Vt.document.addEventListener(e,function(t){laya.events.KeyBoardManager._dispatch(t,e)},!0)},r._dispatch=function(t,e){if(r.enabled){r._event._stoped=!1,r._event.nativeEvent=t,r._event.keyCode=t.keyCode||t.which||t.charCode,"keydown"===e?r._pressKeys[r._event.keyCode]=!0:"keyup"===e&&(r._pressKeys[r._event.keyCode]=null);for(var i=T.stage.focus&&null!=T.stage.focus.event&&T.stage.focus.displayedInStage?T.stage.focus:T.stage,n=i;n;)n.event(e,r._event.setTo(e,n,i)),n=n.parent}},r.hasKeyDown=function(t){return r._pressKeys[t]},r._pressKeys={},r.enabled=!0,E(r,["_event",function(){return this._event=new rt}]),r}(),be=function(){function r(){}return I(r,"laya.ui.UIUtils"),r.fillArray=function(t,e,i){var n=t.concat();if(e)for(var r=e.split(","),s=0,a=Math.min(n.length,r.length);s<a;s++){var o=r[s];n[s]="true"==o||"false"!=o&&o,null!=i&&(n[s]=i(o))}return n},r.toColor=function(t){return nt.toHexColor(t)},r.gray=function(t,e){void 0===e&&(e=!0),e?r.addFilter(t,r.grayFilter):r.clearFilter(t,Lr)},r.addFilter=function(t,e){var i=t.filters||[];i.push(e),t.filters=i},r.clearFilter=function(t,e){var i=t.filters;if(null!=i&&0<i.length){for(var n=i.length-1;-1<n;n--){var r=i[n];T.__typeof(r,e)&&i.splice(n,1)}t.filters=i}},r._getReplaceStr=function(t){return r.escapeSequence[t]},r.adptString=function(t){return t.replace(/\\(\w)/g,r._getReplaceStr)},r.getBindFun=function(t){var e=r._funMap.get(t);if(null==e){var i='"'+t+'"',n="(function(data){if(data==null)return;with(data){try{\nreturn "+(i=i.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";e=T._runScript(n),r._funMap.set(t,e)}return e},E(r,["grayFilter",function(){return this.grayFilter=new Lr([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"\t"}},"_funMap",function(){return this._funMap=new mn}]),r}(),we=function(){function t(){this.alphaMap=null,this.detailID=null,this.normalMap=null}return I(t,"laya.d3.terrain.unit.ChunkInfo"),t}(),Le=function(){function t(){this.speed=1,this.clipStart=0,this.clipEnd=1,this._nodeOwners=[]}I(t,"laya.d3.component.AnimatorState");var e=t.prototype;return T.imps(e,{"laya.d3.core.IClone":!0}),e._resetFrameIndices=function(){for(var t=0,e=this._currentFrameIndices.length;t<e;t++)this._currentFrameIndices[t]=-1},e.addScript=function(t){var e=new t;return this._scripts=this._scripts||[],this._scripts.push(e),e},e.getScript=function(t){if(this._scripts)for(var e=0,i=this._scripts.length;e<i;e++){var n=this._scripts[e];if(T.__typeof(n,t))return n}return null},e.getScripts=function(t){var e;if(this._scripts)for(var i=0,n=this._scripts.length;i<n;i++){var r=this._scripts[i];T.__typeof(r,t)&&(e=e||[]).push(r)}return e},e.cloneTo=function(t){var e=t;e.name=this.name,e.speed=this.speed,e.clipStart=this.clipStart,e.clipEnd=this.clipEnd,e.clip=this._clip},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},g(0,e,"clip",function(){return this._clip},function(t){this._clip=t,this._currentFrameIndices=new Int16Array(t._nodes.count),this._resetFrameIndices()}),t}(),Oe=function(){function t(){this.source=null,this.destination=null,this.camera=null,this.compositeShaderData=null,this.compositeDefineData=null,this.command=null,this.tempRenderTextures=[]}return I(t,"laya.d3.core.render.PostProcessRenderContext"),t}(),Ne=function(){function t(){this.indexInList=-1,this.referenceCount=0,this.updateMark=-1,this.type=-1,this.fullPath=null,this.propertyOwner=null,this.property=null,this.defaultValue=null,this.crossFixedValue=null}return I(t,"laya.d3.component.KeyframeNodeOwner"),t.prototype.saveCrossFixedValue=function(){var t=this.propertyOwner;if(t)switch(this.type){case 0:for(var e=this.property,i=e.length-1,n=0;n<i&&(t=t[e[n]]);n++);this.crossFixedValue=t[e[i]];break;case 1:var r=t.localPosition;this.crossFixedValue||(this.crossFixedValue=new ln),this.crossFixedValue.x=r.x,this.crossFixedValue.y=r.y,this.crossFixedValue.z=r.z;break;case 2:var s=t.localRotation;this.crossFixedValue||(this.crossFixedValue=new Qt),this.crossFixedValue.x=s.x,this.crossFixedValue.y=s.y,this.crossFixedValue.z=s.z,this.crossFixedValue.w=s.w;break;case 3:var a=t.localScale;this.crossFixedValue||(this.crossFixedValue=new ln),this.crossFixedValue.x=a.x,this.crossFixedValue.y=a.y,this.crossFixedValue.z=a.z;break;case 4:var o=t.localRotationEuler;this.crossFixedValue||(this.crossFixedValue=new ln),this.crossFixedValue.x=o.x,this.crossFixedValue.y=o.y,this.crossFixedValue.z=o.z;break;default:throw"Animator:unknown type."}},t}(),Pe=function(){function t(t){this._color=null,this.enbale=!1,this._color=t}I(t,"laya.d3.core.particleShuriKen.module.ColorOverLifetime");var e=t.prototype;return e.cloneTo=function(t){var e=t;this._color.cloneTo(e._color),e.enbale=this.enbale},e.clone=function(){var t;switch(this._color.type){case 0:t=Zi.createByConstant(this._color.constant.clone());break;case 1:t=Zi.createByGradient(this._color.gradient.clone());break;case 2:t=Zi.createByRandomTwoConstant(this._color.constantMin.clone(),this._color.constantMax.clone());break;case 3:t=Zi.createByRandomTwoGradient(this._color.gradientMin.clone(),this._color.gradientMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e},g(0,e,"color",function(){return this._color}),t}(),Fe=function(){function t(){this._indexInList=0,this.type=0,this.fullPath=null,this.propertyOwner=null,this.data=null,this._ownerPath=[],this._propertys=[],this._keyFrames=[]}I(t,"laya.d3.animation.KeyframeNode");var e=t.prototype;return e._setOwnerPathCount=function(t){this._ownerPath.length=t},e._setOwnerPathByIndex=function(t,e){this._ownerPath[t]=e},e._joinOwnerPath=function(t){return this._ownerPath.join(t)},e._setPropertyCount=function(t){this._propertys.length=t},e._setPropertyByIndex=function(t,e){this._propertys[t]=e},e._joinProperty=function(t){return this._propertys.join(t)},e._setKeyframeCount=function(t){this._keyFrames.length=t},e._setKeyframeByIndex=function(t,e){this._keyFrames[t]=e},e.getOwnerPathByIndex=function(t){return this._ownerPath[t]},e.getPropertyByIndex=function(t){return this._propertys[t]},e.getKeyframeByIndex=function(t){return this._keyFrames[t]},g(0,e,"keyFramesCount",function(){return this._keyFrames.length}),g(0,e,"propertyCount",function(){return this._propertys.length}),g(0,e,"ownerPathCount",function(){return this._ownerPath.length}),t}(),Be=function(){function a(){}I(a,"laya.display.cmd.FillWordsCmd");var t=a.prototype;return t.recover=function(){this.words=null,p.recover("FillWordsCmd",this)},t.run=function(t,e,i){t.fillWords(this.words,this.x+e,this.y+i,this.font,this.color)},g(0,t,"cmdID",function(){return"FillWords"}),a.create=function(t,e,i,n,r){var s=p.getItemByClass("FillWordsCmd",a);return s.words=t,s.x=e,s.y=i,s.font=n,s.color=r,s},a.ID="FillWords",a}(),Ve=function(){function r(){}I(r,"laya.display.cmd.TransformCmd");var t=r.prototype;return t.recover=function(){this.matrix=null,p.recover("TransformCmd",this)},t.run=function(t,e,i){t._transform(this.matrix,this.pivotX+e,this.pivotY+i)},g(0,t,"cmdID",function(){return"Transform"}),r.create=function(t,e,i){var n=p.getItemByClass("TransformCmd",r);return n.matrix=t,n.pivotX=e,n.pivotY=i,n},r.ID="Transform",r}(),Ue=function(){function o(){}return I(o,"laya.utils.Ease"),o.linearNone=function(t,e,i,n){return i*t/n+e},o.linearIn=function(t,e,i,n){return i*t/n+e},o.linearInOut=function(t,e,i,n){return i*t/n+e},o.linearOut=function(t,e,i,n){return i*t/n+e},o.bounceIn=function(t,e,i,n){return i-o.bounceOut(n-t,0,i,n)+e},o.bounceInOut=function(t,e,i,n){return t<.5*n?.5*o.bounceIn(2*t,0,i,n)+e:.5*o.bounceOut(2*t-n,0,i,n)+.5*i+e},o.bounceOut=function(t,e,i,n){return(t/=n)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},o.backIn=function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*(t/=n)*t*((r+1)*t-r)+e},o.backInOut=function(t,e,i,n,r){return void 0===r&&(r=1.70158),(t/=.5*n)<1?.5*i*(t*t*((1+(r*=1.525))*t-r))+e:i/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},o.backOut=function(t,e,i,n,r){return void 0===r&&(r=1.70158),i*((t=t/n-1)*t*((r+1)*t+r)+1)+e},o.elasticIn=function(t,e,i,n,r,s){var a;return void 0===r&&(r=0),void 0===s&&(s=0),0==t?e:1==(t/=n)?e+i:(s||(s=.3*n),a=!r||0<i&&r<i||i<0&&r<-i?(r=i,s/4):s/o.PI2*Math.asin(i/r),-r*Math.pow(2,10*(t-=1))*Math.sin((t*n-a)*o.PI2/s)+e)},o.elasticInOut=function(t,e,i,n,r,s){var a;return void 0===r&&(r=0),void 0===s&&(s=0),0==t?e:2==(t/=.5*n)?e+i:(s||(s=n*(.3*1.5)),a=!r||0<i&&r<i||i<0&&r<-i?(r=i,s/4):s/o.PI2*Math.asin(i/r),t<1?r*Math.pow(2,10*(t-=1))*Math.sin((t*n-a)*o.PI2/s)*-.5+e:r*Math.pow(2,-10*(t-=1))*Math.sin((t*n-a)*o.PI2/s)*.5+i+e)},o.elasticOut=function(t,e,i,n,r,s){var a;return void 0===r&&(r=0),void 0===s&&(s=0),0==t?e:1==(t/=n)?e+i:(s||(s=.3*n),a=!r||0<i&&r<i||i<0&&r<-i?(r=i,s/4):s/o.PI2*Math.asin(i/r),r*Math.pow(2,-10*t)*Math.sin((t*n-a)*o.PI2/s)+i+e)},o.strongIn=function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},o.strongInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t*t*t+e:.5*i*((t-=2)*t*t*t*t+2)+e},o.strongOut=function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},o.sineInOut=function(t,e,i,n){return.5*-i*(Math.cos(Math.PI*t/n)-1)+e},o.sineIn=function(t,e,i,n){return-i*Math.cos(t/n*o.HALF_PI)+i+e},o.sineOut=function(t,e,i,n){return i*Math.sin(t/n*o.HALF_PI)+e},o.quintIn=function(t,e,i,n){return i*(t/=n)*t*t*t*t+e},o.quintInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t*t*t+e:.5*i*((t-=2)*t*t*t*t+2)+e},o.quintOut=function(t,e,i,n){return i*((t=t/n-1)*t*t*t*t+1)+e},o.quartIn=function(t,e,i,n){return i*(t/=n)*t*t*t+e},o.quartInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t*t+e:.5*-i*((t-=2)*t*t*t-2)+e},o.quartOut=function(t,e,i,n){return-i*((t=t/n-1)*t*t*t-1)+e},o.cubicIn=function(t,e,i,n){return i*(t/=n)*t*t+e},o.cubicInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t*t+e:.5*i*((t-=2)*t*t+2)+e},o.cubicOut=function(t,e,i,n){return i*((t=t/n-1)*t*t+1)+e},o.quadIn=function(t,e,i,n){return i*(t/=n)*t+e},o.quadInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*i*t*t+e:.5*-i*(--t*(t-2)-1)+e},o.quadOut=function(t,e,i,n){return-i*(t/=n)*(t-2)+e},o.expoIn=function(t,e,i,n){return 0==t?e:i*Math.pow(2,10*(t/n-1))+e-.001*i},o.expoInOut=function(t,e,i,n){return 0==t?e:t==n?e+i:(t/=.5*n)<1?.5*i*Math.pow(2,10*(t-1))+e:.5*i*(2-Math.pow(2,-10*--t))+e},o.expoOut=function(t,e,i,n){return t==n?e+i:i*(1-Math.pow(2,-10*t/n))+e},o.circIn=function(t,e,i,n){return-i*(Math.sqrt(1-(t/=n)*t)-1)+e},o.circInOut=function(t,e,i,n){return(t/=.5*n)<1?.5*-i*(Math.sqrt(1-t*t)-1)+e:.5*i*(Math.sqrt(1-(t-=2)*t)+1)+e},o.circOut=function(t,e,i,n){return i*Math.sqrt(1-(t=t/n-1)*t)+e},o.HALF_PI=.5*Math.PI,o.PI2=2*Math.PI,o}(),ze=function(){function s(){}I(s,"laya.display.cmd.ScaleCmd");var t=s.prototype;return t.recover=function(){p.recover("ScaleCmd",this)},t.run=function(t,e,i){t._scale(this.scaleX,this.scaleY,this.pivotX+e,this.pivotY+i)},g(0,t,"cmdID",function(){return"Scale"}),s.create=function(t,e,i,n){var r=p.getItemByClass("ScaleCmd",s);return r.scaleX=t,r.scaleY=e,r.pivotX=i,r.pivotY=n,r},s.ID="Scale",s}(),Ge=function(){function a(){}I(a,"laya.display.cmd.DrawCurvesCmd");var t=a.prototype;return t.recover=function(){this.points=null,this.lineColor=null,p.recover("DrawCurvesCmd",this)},t.run=function(t,e,i){t.drawCurves(this.x+e,this.y+i,this.points,this.lineColor,this.lineWidth)},g(0,t,"cmdID",function(){return"DrawCurves"}),a.create=function(t,e,i,n,r){var s=p.getItemByClass("DrawCurvesCmd",a);return s.x=t,s.y=e,s.points=i,s.lineColor=n,s.lineWidth=r,s},a.ID="DrawCurves",a}(),He=function(){function u(){this.colorFlt=null}I(u,"laya.display.cmd.DrawTextureCmd");var t=u.prototype;return t.recover=function(){this.texture._removeReference(),this.texture=null,this.matrix=null,p.recover("DrawTextureCmd",this)},t.run=function(t,e,i){t.drawTextureWithTransform(this.texture,this.x,this.y,this.width,this.height,this.matrix,e,i,this.alpha,this.blendMode,this.colorFlt)},g(0,t,"cmdID",function(){return"DrawTexture"}),u.create=function(t,e,i,n,r,s,a,o,h){var l=p.getItemByClass("DrawTextureCmd",u);return(l.texture=t)._addReference(),l.x=e,l.y=i,l.width=n,l.height=r,l.matrix=s,l.alpha=a,l.color=o,l.blendMode=h,o&&(l.colorFlt=new Lr,l.colorFlt.setColor(o)),l},u.ID="DrawTexture",u}(),ke=function(){function o(){}I(o,"laya.display.cmd.Draw9GridTexture");var t=o.prototype;return t.recover=function(){this.texture._removeReference(),p.recover("Draw9GridTexture",this)},t.run=function(t,e,i){t.drawTextureWithSizeGrid(this.texture,this.x,this.y,this.width,this.height,this.sizeGrid,e,i)},g(0,t,"cmdID",function(){return"Draw9GridTexture"}),o.create=function(t,e,i,n,r,s){var a=p.getItemByClass("Draw9GridTexture",o);return(a.texture=t)._addReference(),a.x=e,a.y=i,a.width=n,a.height=r,a.sizeGrid=s,a},o.ID="Draw9GridTexture",o}(),We=function(){function r(t,e,i,n){this._attributeMap=null,this._uniformMap=null,this._enableInstancing=!1,this._subShaders=[],this._name=t,this._attributeMap=e,this._uniformMap=i,this._enableInstancing=n}I(r,"laya.d3.shader.Shader3D");var t=r.prototype;return t.addSubShader=function(t){this._subShaders.push(t),t._owner=this},t.getSubShaderAt=function(t){return this._subShaders[t]},r.propertyNameToID=function(t){if(null!=r._propertyNameMap[t])return r._propertyNameMap[t];var e=r._propertyNameCounter++;return r._propertyNameMap[t]=e},r.addInclude=function(t,e){ui.addInclude(t,e)},r.registerPublicDefine=function(t){var e=Math.pow(2,r._publicCounter++);return r._globleDefines[e]=t,e},r.compileShader=function(t,e,i,n,r,s){var a=laya.d3.shader.Shader3D.find(t);if(a){var o=a.getSubShaderAt(e);if(o){var h=o._passes[i];h?en.shaderHighPrecision?h.withCompile(n,r,s):h.withCompile(n-laya.d3.shader.Shader3D.SHADERDEFINE_HIGHPRECISION,r,s):console.warn("Shader3D: unknown passIndex.")}else console.warn("Shader3D: unknown subShaderIndex.")}else console.warn("Shader3D: unknown shader name.")},r.add=function(t,e,i,n){return void 0===n&&(n=!1),laya.d3.shader.Shader3D._preCompileShader[t]=new r(t,e,i,n)},r.find=function(t){return laya.d3.shader.Shader3D._preCompileShader[t]},r.RENDER_STATE_CULL=0,r.RENDER_STATE_BLEND=1,r.RENDER_STATE_BLEND_SRC=2,r.RENDER_STATE_BLEND_DST=3,r.RENDER_STATE_BLEND_SRC_RGB=4,r.RENDER_STATE_BLEND_DST_RGB=5,r.RENDER_STATE_BLEND_SRC_ALPHA=6,r.RENDER_STATE_BLEND_DST_ALPHA=7,r.RENDER_STATE_BLEND_CONST_COLOR=8,r.RENDER_STATE_BLEND_EQUATION=9,r.RENDER_STATE_BLEND_EQUATION_RGB=10,r.RENDER_STATE_BLEND_EQUATION_ALPHA=11,r.RENDER_STATE_DEPTH_TEST=12,r.RENDER_STATE_DEPTH_WRITE=13,r.PERIOD_CUSTOM=0,r.PERIOD_MATERIAL=1,r.PERIOD_SPRITE=2,r.PERIOD_CAMERA=3,r.PERIOD_SCENE=4,r.SHADERDEFINE_HIGHPRECISION=0,r._propertyNameCounter=0,r._propertyNameMap={},r._publicCounter=0,r._globleDefines=[],r._preCompileShader={},r.debugMode=!1,r}(),Xe=function(){function i(){}I(i,"laya.display.cmd.AlphaCmd");var t=i.prototype;return t.recover=function(){p.recover("AlphaCmd",this)},t.run=function(t,e,i){t.alpha(this.alpha)},g(0,t,"cmdID",function(){return"Alpha"}),i.create=function(t){var e=p.getItemByClass("AlphaCmd",i);return e.alpha=t,e},i.ID="Alpha",i}(),Ye=function(){function i(t){this._color=null,this.setValue(t)}I(i,"laya.webgl.canvas.DrawStyle");var t=i.prototype;return t.setValue=function(t){this._color=t?t instanceof laya.utils.ColorUtils?t:f.create(t):f.create("#000000")},t.reset=function(){this._color=f.create("#000000")},t.toInt=function(){return this._color.numColor},t.equal=function(t){return"string"==typeof t?this._color.strColor===t:t instanceof laya.utils.ColorUtils&&this._color.numColor===t.numColor},t.toColorStr=function(){return this._color.strColor},i.create=function(t){if(t){var e=t instanceof laya.utils.ColorUtils?t:f.create(t);return e._drawStyle||(e._drawStyle=new i(t))}return i.DEFAULT},E(i,["DEFAULT",function(){return this.DEFAULT=new i("#000000")}]),i}(),Ze=function(){function l(){}I(l,"laya.display.cmd.FillBorderTextCmd");var t=l.prototype;return t.recover=function(){p.recover("FillBorderTextCmd",this)},t.run=function(t,e,i){t.fillBorderText(this.text,this.x+e,this.y+i,this.font,this.fillColor,this.borderColor,this.lineWidth,this.textAlign)},g(0,t,"cmdID",function(){return"FillBorderText"}),l.create=function(t,e,i,n,r,s,a,o){var h=p.getItemByClass("FillBorderTextCmd",l);return h.text=t,h.x=e,h.y=i,h.font=n,h.fillColor=r,h.borderColor=s,h.lineWidth=a,h.textAlign=o,h},l.ID="FillBorderText",l}(),je=function(){function t(){this.cull=0,this.blend=0,this.srcBlend=0,this.dstBlend=0,this.srcBlendRGB=0,this.dstBlendRGB=0,this.srcBlendAlpha=0,this.dstBlendAlpha=0,this.blendConstColor=null,this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=0,this.depthWrite=!1,this.cull=2,this.blend=0,this.srcBlend=1,this.dstBlend=0,this.srcBlendRGB=1,this.dstBlendRGB=0,this.srcBlendAlpha=1,this.dstBlendAlpha=0,this.blendConstColor=new on(1,1,1,1),this.blendEquation=0,this.blendEquationRGB=0,this.blendEquationAlpha=0,this.depthTest=515,this.depthWrite=!0}I(t,"laya.d3.core.material.RenderState");var e=t.prototype;return T.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;e.cull=this.cull,e.blend=this.blend,e.srcBlend=this.srcBlend,e.dstBlend=this.dstBlend,e.srcBlendRGB=this.srcBlendRGB,e.dstBlendRGB=this.dstBlendRGB,e.srcBlendAlpha=this.srcBlendAlpha,e.dstBlendAlpha=this.dstBlendAlpha,this.blendConstColor.cloneTo(e.blendConstColor),e.blendEquation=this.blendEquation,e.blendEquationRGB=this.blendEquationRGB,e.blendEquationAlpha=this.blendEquationAlpha,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t.CULL_NONE=0,t.CULL_FRONT=1,t.CULL_BACK=2,t.BLEND_DISABLE=0,t.BLEND_ENABLE_ALL=1,t.BLEND_ENABLE_SEPERATE=2,t.BLENDPARAM_ZERO=0,t.BLENDPARAM_ONE=1,t.BLENDPARAM_SRC_COLOR=768,t.BLENDPARAM_ONE_MINUS_SRC_COLOR=769,t.BLENDPARAM_DST_COLOR=774,t.BLENDPARAM_ONE_MINUS_DST_COLOR=775,t.BLENDPARAM_SRC_ALPHA=770,t.BLENDPARAM_ONE_MINUS_SRC_ALPHA=771,t.BLENDPARAM_DST_ALPHA=772,t.BLENDPARAM_ONE_MINUS_DST_ALPHA=773,t.BLENDPARAM_SRC_ALPHA_SATURATE=776,t.BLENDEQUATION_ADD=0,t.BLENDEQUATION_SUBTRACT=1,t.BLENDEQUATION_REVERSE_SUBTRACT=2,t.DEPTHTEST_OFF=0,t.DEPTHTEST_NEVER=512,t.DEPTHTEST_LESS=513,t.DEPTHTEST_EQUAL=514,t.DEPTHTEST_LEQUAL=515,t.DEPTHTEST_GREATER=516,t.DEPTHTEST_NOTEQUAL=517,t.DEPTHTEST_GEQUAL=518,t.DEPTHTEST_ALWAYS=519,t}(),Ke=(function(){function t(){}I(t,"laya.d3.core.render.PostProcessEffect"),t.prototype.render=function(t){}}(),function(){function n(){this._saveuse=0}I(n,"laya.webgl.canvas.save.SaveMark");var t=n.prototype;return T.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!0},t.restore=function(t){t._saveMark=this._preSaveMark,n.POOL[n.POOL._length++]=this},n.Create=function(t){var e=n.POOL,i=0<e._length?e[--e._length]:new n;return i._saveuse=0,i._preSaveMark=t._saveMark,t._saveMark=i},n.POOL=a._createArray(),n}()),qe=function(){function t(){}return I(t,"UIConfig"),t.touchScrollEnable=!0,t.mouseWheelEnable=!0,t.showButtons=!0,t.popupBgColor="#000000",t.popupBgAlpha=.5,t.closeDialogOnSide=!0,t}(),Qe=function(){function r(t,e){this.min=null,this.max=null,this.min=t,this.max=e}I(r,"laya.d3.math.BoundBox");var t=r.prototype;return T.imps(t,{"laya.d3.core.IClone":!0}),t._rotateExtents=function(t,e,i){var n=t.x,r=t.y,s=t.z,a=e.elements;i.x=Math.abs(a[0]*n)+Math.abs(a[4]*r)+Math.abs(a[8]*s),i.y=Math.abs(a[1]*n)+Math.abs(a[5]*r)+Math.abs(a[9]*s),i.z=Math.abs(a[2]*n)+Math.abs(a[6]*r)+Math.abs(a[10]*s)},t.getCorners=function(t){t.length=8;var e=this.min.x,i=this.min.y,n=this.min.z,r=this.max.x,s=this.max.y,a=this.max.z;t[0]=new ln(e,s,a),t[1]=new ln(r,s,a),t[2]=new ln(r,i,a),t[3]=new ln(e,i,a),t[4]=new ln(e,s,n),t[5]=new ln(r,s,n),t[6]=new ln(r,i,n),t[7]=new ln(e,i,n)},t.getCenter=function(t){ln.add(this.min,this.max,t),ln.scale(t,.5,t)},t.getExtent=function(t){ln.subtract(this.max,this.min,t),ln.scale(t,.5,t)},t.setCenterAndExtent=function(t,e){ln.subtract(t,e,this.min),ln.add(t,e,this.max)},t.tranform=function(t,e){var i=r._tempVector30,n=r._tempVector31;this.getCenter(i),this.getExtent(n),ln.transformCoordinate(i,t,i),this._rotateExtents(n,t,n),e.setCenterAndExtent(i,n)},t.toDefault=function(){this.min.toDefault(),this.max.toDefault()},t.cloneTo=function(t){var e=t;this.min.cloneTo(e.min),this.max.cloneTo(e.max)},t.clone=function(){var t=new this.constructor(new ln,new ln);return this.cloneTo(t),t},r.createfromPoints=function(t,e){if(null==t)throw new Error("points");var i=e.min,n=e.max;i.x=Number.MAX_VALUE,i.y=Number.MAX_VALUE,i.z=Number.MAX_VALUE,n.x=-Number.MAX_VALUE,n.y=-Number.MAX_VALUE,n.z=-Number.MAX_VALUE;for(var r=0,s=t.length;r<s;++r)ln.min(i,t[r],i),ln.max(n,t[r],n)},r.merge=function(t,e,i){ln.min(t.min,e.min,i.min),ln.max(t.max,e.max,i.max)},E(r,["_tempVector30",function(){return this._tempVector30=new ln},"_tempVector31",function(){return this._tempVector31=new ln}]),r}(),$e=function(){function t(){}return I(t,"laya.webgl.utils.CONST3D2D"),t.BYTES_PE=4,t.BYTES_PIDX=2,t.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],t.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],t._TMPARRAY=[],t._OFFSETX=0,t._OFFSETY=0,t}(),Je=function(){function n(){}return I(n,"laya.d3.math.HalfFloatUtils"),n.__init__=function(){for(var t=0;t<256;++t){var e=t-127;n._shiftTable[256|t]=e<-27?(n._baseTable[0|t]=0,n._baseTable[256|t]=32768,n._shiftTable[0|t]=24):e<-14?(n._baseTable[0|t]=1024>>-e-14,n._baseTable[256|t]=1024>>-e-14|32768,n._shiftTable[0|t]=-e-1,-e-1):e<=15?(n._baseTable[0|t]=e+15<<10,n._baseTable[256|t]=e+15<<10|32768,n._shiftTable[0|t]=13):e<128?(n._baseTable[0|t]=31744,n._baseTable[256|t]=64512,n._shiftTable[0|t]=24):(n._baseTable[0|t]=31744,n._baseTable[256|t]=64512,n._shiftTable[0|t]=13)}for(n._mantissaTable[0]=0,t=1;t<1024;++t){var i=t<<13;for(e=0;0==(8388608&i);)e-=8388608,i<<=1;i&=-8388609,e+=947912704,n._mantissaTable[t]=i|e}for(t=1024;t<2048;++t)n._mantissaTable[t]=939524096+(t-1024<<13);for(n._exponentTable[0]=0,t=1;t<31;++t)n._exponentTable[t]=t<<23;for(n._exponentTable[31]=1199570944,n._exponentTable[32]=2147483648,t=33;t<63;++t)n._exponentTable[t]=2147483648+(t-32<<23);for(n._exponentTable[63]=3347054592,n._offsetTable[0]=0,t=1;t<64;++t)n._offsetTable[t]=32===t?0:1024},n.roundToFloat16Bits=function(t){n._floatView[0]=t;var e=n._uint32View[0],i=e>>23&511;return n._baseTable[i]+((8388607&e)>>n._shiftTable[i])},n.convertToNumber=function(t){var e=t>>10;return n._uint32View[0]=n._mantissaTable[n._offsetTable[e]+(1023&t)]+n._exponentTable[e],n._floatView[0]},E(n,["_buffer",function(){return this._buffer=new ArrayBuffer(4)},"_floatView",function(){return this._floatView=new Float32Array(n._buffer)},"_uint32View",function(){return this._uint32View=new Uint32Array(n._buffer)},"_baseTable",function(){return this._baseTable=new Uint32Array(512)},"_shiftTable",function(){return this._shiftTable=new Uint32Array(512)},"_mantissaTable",function(){return this._mantissaTable=new Uint32Array(2048)},"_exponentTable",function(){return this._exponentTable=new Uint32Array(64)},"_offsetTable",function(){return this._offsetTable=new Uint32Array(64)}]),n}(),ti=function(){function t(t,e,i,n){this._attributeMap=null,this._uniformMap=null,this._publicDefines=null,this._publicDefinesMap=null,this._spriteDefines=null,this._spriteDefinesMap=null,this._materialDefines=null,this._materialDefinesMap=null,this._owner=null,this._flags={},this._passes=[],this._publicDefines=[],this._publicDefinesMap={},this._spriteDefines=[],this._spriteDefinesMap={},this._materialDefines=[],this._materialDefinesMap={},this._addDefines(this._publicDefines,this._publicDefinesMap,We._globleDefines),i&&this._addDefines(this._spriteDefines,this._spriteDefinesMap,i.defines),n&&this._addDefines(this._materialDefines,this._materialDefinesMap,n.defines),this._attributeMap=t,this._uniformMap=e}I(t,"laya.d3.shader.SubShader");var e=t.prototype;return e._addDefines=function(t,e,i){for(var n in i){var r=i[n],s=parseInt(n);e[t[s]=r]=s}},e.getMaterialDefineByName=function(t){return this._materialDefinesMap[t]},e.setFlag=function(t,e){e?this._flags[t]=e:delete this._flags[t]},e.getFlag=function(t){return this._flags[t]},e.addShaderPass=function(t,e,i){var n=new Zr(this,t,e,i);return this._passes.push(n),n},t}(),ei=function(){function t(t,e,i){this.atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,void(this._used=0)===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._cells=null,this._rowInfo=null,this.atlasID=i,this._init(t,e)}I(t,"laya.webgl.text.AtlasGrid");var e=t.prototype;return e.addRect=function(t,e,i,n){return!!this._get(e,i,n)&&(this._fill(n.x,n.y,e,i,t),this._texCount++,!0)},e._release=function(){this._cells=null,this._rowInfo=null},e._init=function(t,e){return this._width=t,this._height=e,this._release(),0!=this._width&&(this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=new Uint8Array(this._height),this._used=0,this._clear(),!0)},e._get=function(t,e,i){if(t>this._width||e>this._height)return!1;for(var n=-1,r=-1,s=this._width,a=this._height,o=this._cells,h=0;h<a;h++)if(!(this._rowInfo[h]<t))for(var l=0;l<s;){var u=3*(h*s+l);if(0!=o[u]||o[u+1]<t||o[u+2]<e)l+=o[u+1];else{n=l,r=h;for(var c=0;c<t;c++)if(o[3*c+u+2]<e){n=-1;break}if(!(n<0))return i.x=n,i.y=r,!0;l+=o[u+1]}}return!1},e._fill=function(t,e,i,n,r){var s=this._width,a=this._height;this._check(t+i<=s&&e+n<=a);for(var o=e;o<n+e;++o){this._check(this._rowInfo[o]>=i),this._rowInfo[o]-=i;for(var h=0;h<i;h++){var l=3*(t+o*s+h);this._check(0==this._cells[l]),this._cells[l]=r,this._cells[l+1]=i,this._cells[l+2]=n}}if(0<t)for(o=0;o<n;++o){var u=0;for(h=t-1;0<=h&&0==this._cells[3*((e+o)*s+h)];--h,++u);for(h=u;0<h;--h)this._cells[3*((e+o)*s+t-h)+1]=h,this._check(0<h)}if(0<e)for(h=t;h<t+i;++h){for(u=0,o=e-1;0<=o&&0==this._cells[3*(h+o*s)];--o,u++);for(o=u;0<o;--o)this._cells[3*(h+(e-o)*s)+2]=o,this._check(0<o)}this._used+=i*n/(this._width*this._height)},e._check=function(t){0==t&&console.log("xtexMerger 错误啦")},e._clear=function(){for(var t=this._texCount=0;t<this._height;t++)this._rowInfo[t]=this._width;for(var e=0;e<this._height;e++)for(var i=0;i<this._width;i++){var n=3*(e*this._width+i);this._cells[n]=0,this._cells[n+1]=this._width-i,this._cells[n+2]=this._width-e}},t}(),ii=function(){function t(t){if(this._counter=0,this.defines={},t)for(var e in this._counter=t._counter,t.defines)this.defines[e]=t.defines[e]}return I(t,"laya.d3.shader.ShaderDefines"),t.prototype.registerDefine=function(t){var e=Math.pow(2,this._counter++);return this.defines[e]=t,e},t}(),ni=function(){function v(){this._cacheBoundsType=!1}I(v,"laya.display.GraphicsBounds");var t=v.prototype;return t.destroy=function(){this._graphics=null,this._cacheBoundsType=!1,this._temp&&(this._temp.length=0),this._rstBoundPoints&&(this._rstBoundPoints.length=0),this._bounds&&this._bounds.recover(),this._bounds=null,p.recover("GraphicsBounds",this)},t.reset=function(){this._temp&&(this._temp.length=0)},t.getBounds=function(t){return void 0===t&&(t=!1),(!this._bounds||!this._temp||this._temp.length<1||t!=this._cacheBoundsType)&&(this._bounds=ve._getWrapRec(this.getBoundPoints(t),this._bounds)),this._cacheBoundsType=t,this._bounds},t.getBoundPoints=function(t){return void 0===t&&(t=!1),(!this._temp||this._temp.length<1||t!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints(t)),this._cacheBoundsType=t,this._rstBoundPoints=nt.copyArray(this._rstBoundPoints,this._temp)},t._getCmdPoints=function(t){void 0===t&&(t=!1);qi._context;var e,i=this._graphics.cmds;if((e=this._temp||(this._temp=[])).length=0,i||null==this._graphics._one||(v._tempCmds.length=0,v._tempCmds.push(this._graphics._one),i=v._tempCmds),!i)return e;var n=v._tempMatrixArrays;n.length=0;var r=v._initMatrix;r.identity();for(var s,a,o=v._tempMatrix,h=0,l=i.length;h<l;h++)switch((s=i[h]).cmdID){case"Alpha":n.push(r),r=r.clone();break;case"Restore":r=n.pop();break;case"Scale":o.identity(),o.translate(-s.pivotX,-s.pivotY),o.scale(s.scaleX,s.scaleY),o.translate(s.pivotX,s.pivotY),this._switchMatrix(r,o);break;case"Rotate":o.identity(),o.translate(-s.pivotX,-s.pivotY),o.rotate(s.angle),o.translate(s.pivotX,s.pivotY),this._switchMatrix(r,o);break;case"Translate":o.identity(),o.translate(s.tx,s.ty),this._switchMatrix(r,o);break;case"Transform":o.identity(),o.translate(-s.pivotX,-s.pivotY),o.concat(s.matrix),o.translate(s.pivotX,s.pivotY),this._switchMatrix(r,o);break;case"DrawImage":case"FillTexture":v._addPointArrToRst(e,ve._getBoundPointS(s.x,s.y,s.width,s.height),r);break;case"DrawTexture":r.copyTo(o),s.matrix&&o.concat(s.matrix),v._addPointArrToRst(e,ve._getBoundPointS(s.x,s.y,s.width,s.height),o);break;case"DrawImage":if(a=s.texture,t)s.width&&s.height?v._addPointArrToRst(e,ve._getBoundPointS(s.x,s.y,s.width,s.height),r):v._addPointArrToRst(e,ve._getBoundPointS(s.x,s.y,a.width,a.height),r);else{var u=(s.width||a.sourceWidth)/a.width,c=(s.height||a.sourceHeight)/a.height,_=u*a.sourceWidth,d=c*a.sourceHeight,f=0<a.offsetX?a.offsetX:0,p=0<a.offsetY?a.offsetY:0;f*=u,p*=c,v._addPointArrToRst(e,ve._getBoundPointS(s.x-f,s.y-p,_,d),r)}break;case"FillTexture":s.width&&s.height?v._addPointArrToRst(e,ve._getBoundPointS(s.x,s.y,s.width,s.height),r):(a=s.texture,v._addPointArrToRst(e,ve._getBoundPointS(s.x,s.y,a.width,a.height),r));break;case"DrawTexture":var m;m=s.matrix?(r.copyTo(o),o.concat(s.matrix),o):r,t?s.width&&s.height?v._addPointArrToRst(e,ve._getBoundPointS(s.x,s.y,s.width,s.height),m):(a=s.texture,v._addPointArrToRst(e,ve._getBoundPointS(s.x,s.y,a.width,a.height),m)):(a=s.texture,u=(s.width||a.sourceWidth)/a.width,c=(s.height||a.sourceHeight)/a.height,_=u*a.sourceWidth,d=c*a.sourceHeight,f=0<a.offsetX?a.offsetX:0,p=0<a.offsetY?a.offsetY:0,f*=u,p*=c,v._addPointArrToRst(e,ve._getBoundPointS(s.x-f,s.y-p,_,d),m));break;case"DrawRect":v._addPointArrToRst(e,ve._getBoundPointS(s.x,s.y,s.width,s.height),r);break;case"DrawCircle":v._addPointArrToRst(e,ve._getBoundPointS(s.x-s.radius,s.y-s.radius,s.radius+s.radius,s.radius+s.radius),r);break;case"DrawLine":v._tempPoints.length=0;var g;g=.5*s.lineWidth,s.fromX==s.toX?v._tempPoints.push(s.fromX+g,s.fromY,s.toX+g,s.toY,s.fromX-g,s.fromY,s.toX-g,s.toY):s.fromY==s.toY?v._tempPoints.push(s.fromX,s.fromY+g,s.toX,s.toY+g,s.fromX,s.fromY-g,s.toX,s.toY-g):v._tempPoints.push(s.fromX,s.fromY,s.toX,s.toY),v._addPointArrToRst(e,v._tempPoints,r);break;case"DrawCurves":v._addPointArrToRst(e,Te.I.getBezierPoints(s.points),r,s.x,s.y);break;case"DrawLines":case"DrawPoly":v._addPointArrToRst(e,s.points,r,s.x,s.y);break;case"DrawPath":v._addPointArrToRst(e,this._getPathPoints(s.paths),r,s.x,s.y);break;case"DrawPie":v._addPointArrToRst(e,this._getPiePoints(s.x,s.y,s.radius,s.startAngle,s.endAngle),r)}return 200<e.length?e=nt.copyArray(e,ve._getWrapRec(e)._getBoundPoints()):8<e.length&&(e=bi.scanPList(e)),e},t._switchMatrix=function(t,e){e.concat(t),e.copyTo(t)},t._getPiePoints=function(t,e,i,n,r){var s=v._tempPoints;v._tempPoints.length=0;var a=Math.PI/180,o=r-n;if(360<=o||o<=-360)return s.push(t-i,e-i),s.push(t+i,e-i),s.push(t+i,e+i),s.push(t-i,e+i),s;s.push(t,e);var h=o%360;h<0&&(h+=360);var l=n+h,u=n*a,c=l*a;s.push(t+i*Math.cos(u),e+i*Math.sin(u)),s.push(t+i*Math.cos(c),e+i*Math.sin(c));for(var _=90*Math.ceil(n/90),d=90*Math.floor(l/90),f=_;f<=d;f+=90){var p=f*a;s.push(t+i*Math.cos(p),e+i*Math.sin(p))}return s},t._getPathPoints=function(t){var e,i,n=0,r=v._tempPoints;for(r.length=0,e=t.length,n=0;n<e;n++)1<(i=t[n]).length&&(r.push(i[1],i[2]),3<i.length&&r.push(i[3],i[4]));return r},v.create=function(){return p.getItemByClass("GraphicsBounds",v)},v._addPointArrToRst=function(t,e,i,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var s,a=0;for(s=e.length,a=0;a<s;a+=2)v._addPointToRst(t,e[a]+n,e[a+1]+r,i)},v._addPointToRst=function(t,e,i,n){var r=R.TEMP;r.setTo(e||0,i||0),n.transformPoint(r),t.push(r.x,r.y)},v._tempPoints=[],v._tempMatrixArrays=[],v._tempCmds=[],E(v,["_tempMatrix",function(){return this._tempMatrix=new It},"_initMatrix",function(){return this._initMatrix=new It}]),v}(),ri=function(){function s(){this._matrix=new It}I(s,"laya.webgl.canvas.save.SaveTransform");var t=s.prototype;return T.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){t._curMat=this._savematrix,s.POOL[s.POOL._length++]=this},s.save=function(t){var e=t._saveMark;if(2048!=(2048&e._saveuse)){e._saveuse|=2048;var i=s.POOL,n=0<i._length?i[--i._length]:new s;n._savematrix=t._curMat,t._curMat=t._curMat.copyTo(n._matrix);var r=t._save;r[r._length++]=n}},s.POOL=a._createArray(),s}(),si=function(){function t(){this._strsToID={},this._idToStrs=[],this._length=0}I(t,"laya.utils.StringKey");var e=t.prototype;return e.add=function(t){var e=this._strsToID[t];return null!=e?e:(this._idToStrs[this._length]=t,this._strsToID[t]=this._length++)},e.getID=function(t){var e=this._strsToID[t];return null==e?-1:e},e.getName=function(t){var e=this._idToStrs[t];return null==e?void 0:e},t}(),ai=function(){function r(){this._clipInfoID=-1,this.incache=!1,this._globalClipMatrix=new It,this._clipRect=new ve}I(r,"laya.webgl.canvas.save.SaveClipRect");var t=r.prototype;return T.imps(t,{"laya.webgl.canvas.save.ISaveData":!0}),t.isSaveMark=function(){return!1},t.restore=function(t){this._globalClipMatrix.copyTo(t._globalClipMatrix),this._clipRect.clone(t._clipRect),t._clipInfoID=this._clipInfoID,r.POOL[r.POOL._length++]=this,t._clipInCache=this.incache},r.save=function(t){if(131072!=(131072&t._saveMark._saveuse)){t._saveMark._saveuse|=131072;var e=r.POOL,i=0<e._length?e[--e._length]:new r;t._globalClipMatrix.copyTo(i._globalClipMatrix),t._clipRect.clone(i._clipRect),i._clipInfoID=t._clipInfoID,i.incache=t._clipInCache;var n=t._save;n[n._length++]=i}},r.POOL=a._createArray(),r}(),oi=function(){function r(){}return I(r,"laya.d3.core.particleShuriKen.module.shape.ShapeUtils"),r._randomPointUnitArcCircle=function(t,e,i){var n=NaN;n=i?i.getFloat()*t:Math.random()*t,e.x=Math.cos(n),e.y=Math.sin(n)},r._randomPointInsideUnitArcCircle=function(t,e,i){r._randomPointUnitArcCircle(t,e,i);var n=NaN;n=i?Math.pow(i.getFloat(),.5):Math.pow(Math.random(),.5),e.x=e.x*n,e.y=e.y*n},r._randomPointUnitCircle=function(t,e){var i=NaN;i=e?e.getFloat()*Math.PI*2:Math.random()*Math.PI*2,t.x=Math.cos(i),t.y=Math.sin(i)},r._randomPointInsideUnitCircle=function(t,e){r._randomPointUnitCircle(t);var i=NaN;i=e?Math.pow(e.getFloat(),.5):Math.pow(Math.random(),.5),t.x=t.x*i,t.y=t.y*i},r._randomPointUnitSphere=function(t,e){var i=NaN,n=NaN;n=e?(i=t.z=2*e.getFloat()-1,e.getFloat()*Math.PI*2):(i=t.z=2*Math.random()-1,Math.random()*Math.PI*2);var r=Math.sqrt(1-i*i);t.x=r*Math.cos(n),t.y=r*Math.sin(n)},r._randomPointInsideUnitSphere=function(t,e){r._randomPointUnitSphere(t);var i=NaN;i=e?Math.pow(e.getFloat(),1/3):Math.pow(Math.random(),1/3),t.x=t.x*i,t.y=t.y*i,t.z=t.z*i},r._randomPointInsideHalfUnitBox=function(t,e){t.z=e?(t.x=e.getFloat()-.5,t.y=e.getFloat()-.5,e.getFloat()-.5):(t.x=Math.random()-.5,t.y=Math.random()-.5,Math.random()-.5)},r}(),hi=function(){function t(){this.ambientColor=null,this.diffuseColor=null,this.specularColor=null}return I(t,"laya.d3.terrain.unit.MaterialInfo"),t}(),li=function(){function t(t,e){this._position=null,this._textureCoordinate0=null,this._position=t,this._textureCoordinate0=e}I(t,"laya.d3.graphics.Vertex.VertexPositionTexture0");var e=t.prototype;return T.imps(e,{"laya.d3.graphics.IVertex":!0}),g(0,e,"vertexDeclaration",function(){return t._vertexDeclaration}),g(0,e,"textureCoordinate0",function(){return this._textureCoordinate0}),g(0,e,"position",function(){return this._position}),g(1,t,"vertexDeclaration",function(){return t._vertexDeclaration}),E(t,["_vertexDeclaration",function(){return this._vertexDeclaration=new D(20,[new lt(0,"vector3",0),new lt(12,"vector2",2)])}]),t}(),ui=function(){function v(t,e,i,n){this._clearCR=new RegExp("\r","g");var r=this;function s(t){t=t.replace(r._clearCR,"");var e=[],i=new vi(e);return r._compileToTree(i,t.split("\n"),0,e,n),i}var a=Vt.now();this._VS=s(t),this._PS=s(e),this._nameMap=i,2<Vt.now()-a&&console.log("ShaderCompile use time:"+(Vt.now()-a)+"  size:"+t.length+"/"+e.length)}I(v,"laya.webgl.utils.ShaderCompile");var t=v.prototype;return t._compileToTree=function(t,e,i,n,r){var s,a,o,h,l,u,c,_=0,d=0,f=0,p=0;for(d=i;d<e.length;d++)if(!((o=e[d]).length<1)&&0!==(_=o.indexOf("//"))){if(0<=_&&(o=o.substr(0,_)),s=c||new vi(n),c=null,s.text=o,s.noCompile=!0,0<=(_=o.indexOf("#"))){for(h="#",p=_+1,f=o.length;p<f;p++){var m=o.charAt(p);if(" "===m||"\t"===m||"?"===m)break;h+=m}switch(s.name=h){case"#ifdef":case"#ifndef":if(s.src=o,s.noCompile=null!=o.match(/[!&|()=<>]/),s.noCompile?console.log("function():Boolean{return "+o.substr(_+s.name.length)+"}"):(u=o.replace(/^\s*/,"").split(/\s+/),s.setCondition(u[1],"#ifdef"===h?1:2),s.text="//"+s.text),s.setParent(t),t=s,r)for(u=o.substr(p).split(v._splitToWordExps3),p=0;p<u.length;p++)(o=u[p]).length&&(r[o]=!0);continue;case"#if":if(s.src=o,s.noCompile=!0,s.setParent(t),t=s,r)for(u=o.substr(p).split(v._splitToWordExps3),p=0;p<u.length;p++)(o=u[p]).length&&"defined"!=o&&(r[o]=!0);continue;case"#else":s.src=o,a=(t=t.parent).childs[t.childs.length-1],s.noCompile=a.noCompile,s.noCompile||(s.condition=a.condition,s.conditionType=1==a.conditionType?2:1,s.text="//"+s.text+" "+a.text+" "+s.conditionType),s.setParent(t),t=s;continue;case"#endif":a=(t=t.parent).childs[t.childs.length-1],s.noCompile=a.noCompile,s.noCompile||(s.text="//"+s.text),s.setParent(t);continue;case"#include":u=v.splitToWords(o,null);var g=v.includes[u[1]];if(!g)throw"ShaderCompile error no this include file:"+u[1];if((_=u[0].indexOf("?"))<0){s.setParent(t),o=g.getWith("with"==u[2]?u[3]:null),this._compileToTree(s,o.split("\n"),0,n,r),s.text="";continue}s.setCondition(u[0].substr(_+1),1),s.text=g.getWith("with"==u[2]?u[3]:null);break;case"#import":l=(u=v.splitToWords(o,null))[1],n.push({node:s,file:v.includes[l],ofs:s.text.length});continue}}else{if((a=t.childs[t.childs.length-1])&&!a.name){0<n.length&&v.splitToWords(o,a),c=s,a.text+="\n"+o;continue}0<n.length&&v.splitToWords(o,s)}s.setParent(t)}},t.createShader=function(t,e,i,n){var r={},s="";if(t)for(var a in t)s+="#define "+a+"\n",r[a]=!0;var o=this._VS.toscript(r,[]),h=this._PS.toscript(r,[]);return(i||As.create)(s+o.join("\n"),s+h.join("\n"),e,this._nameMap,n)},v._parseOne=function(t,e,i,n,r,s){var a={type:v.shaderParamsMap[i[n+1]],name:i[n+2],size:isNaN(parseInt(i[n+3]))?1:parseInt(i[n+3])};return s&&("attribute"==r?t.push(a):e.push(a)),":"==i[n+3]&&(a.type=i[n+4],n+=2),n+=2},v.addInclude=function(t,e){if(!e||0===e.length)throw new Error("add shader include file err:"+t);if(v.includes[t])throw new Error("add shader include file err, has add:"+t);v.includes[t]=new H(e)},v.preGetParams=function(t,e){var i=[t,e],n={},r=[],s=[],a={},o=[];n.attributes=r,n.uniforms=s,n.defines=a;for(var h=0,l=0,u=0;u<2;u++){i[u]=i[u].replace(v._removeAnnotation,"");var c,_=i[u].match(v._reg);for(h=0,l=_.length;h<l;h++){var d=_[h];if("attribute"==d||"uniform"==d)h=v._parseOne(r,s,_,h,d,!0);else{if("#define"==d){o[d=_[++h]]=1;continue}if("#ifdef"==d){a[c=_[++h]]=a[c]||[];for(h++;h<l;h++)if("attribute"==(d=_[h])||"uniform"==d)h=v._parseOne(r,s,_,h,d,o[c]);else if("#else"==d)for(h++;h<l;h++)if("attribute"==(d=_[h])||"uniform"==d)h=v._parseOne(r,s,_,h,d,!o[c]);else if("#endif"==d)break}}}}return n},v.splitToWords=function(t,e){for(var i,n,r=[],s=-1,a=0,o=t.length;a<o;a++)if(i=t.charAt(a),0<=" \t=+-*/&%!<>()'\",;".indexOf(i)){if(0<=s&&1<a-s&&(n=t.substr(s,a-s),r.push(n)),'"'==i||"'"==i){var h=t.indexOf(i,a+1);if(h<0)throw"Sharder err:"+t;r.push(t.substr(a+1,h-a-1)),a=h,s=-1;continue}"("==i&&e&&0<r.length&&(n=r[r.length-1]+";","vec4;main;".indexOf(n)<0&&(e.useFuns+=n)),s=-1}else s<0&&(s=a);return s<o&&1<o-s&&(n=t.substr(s,o-s),r.push(n)),r},v.IFDEF_NO=0,v.IFDEF_YES=1,v.IFDEF_ELSE=2,v.IFDEF_PARENT=3,v._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),v._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),v._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g"),v.includes={},E(v,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]),v}(),ci=(function(){function t(){}return I(t,"laya.webgl.VertexArrayObject"),t}()(function(){var r={};function c(t,e){var i;r[t]=!0,void 0!==e&&(i=e,m.console&&m.console.error&&m.console.error(i))}var i=function t(e){var i=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(var n=0;n<this.attribs.length;n++){var r=new t.VertexAttrib(i);this.attribs[n]=r}this.maxAttrib=0};(i.VertexAttrib=function(t){this.enabled=!1,this.buffer=null,this.size=4,this.type=t.FLOAT,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};var n=function(n){var e,i,h=this;this.gl=n,i=(e=n).getError,e.getError=function(){for(;(t=i.apply(e))!=e.NO_ERROR&&(r[t]=!0),t!=e.NO_ERROR;);for(var t in r)if(r[t])return delete r[t],parseInt(t);return e.NO_ERROR};var l=this.original={getParameter:n.getParameter,enableVertexAttribArray:n.enableVertexAttribArray,disableVertexAttribArray:n.disableVertexAttribArray,bindBuffer:n.bindBuffer,getVertexAttrib:n.getVertexAttrib,vertexAttribPointer:n.vertexAttribPointer};n.getParameter=function(t){return t==h.VERTEX_ARRAY_BINDING_OES?h.currentVertexArrayObject==h.defaultVertexArrayObject?null:h.currentVertexArrayObject:l.getParameter.apply(this,arguments)},n.enableVertexAttribArray=function(t){var e=h.currentVertexArrayObject;return e.maxAttrib=Math.max(e.maxAttrib,t),e.attribs[t].enabled=!0,l.enableVertexAttribArray.apply(this,arguments)},n.disableVertexAttribArray=function(t){var e=h.currentVertexArrayObject;return e.maxAttrib=Math.max(e.maxAttrib,t),e.attribs[t].enabled=!1,l.disableVertexAttribArray.apply(this,arguments)},n.bindBuffer=function(t,e){switch(t){case n.ARRAY_BUFFER:h.currentArrayBuffer=e;break;case n.ELEMENT_ARRAY_BUFFER:h.currentVertexArrayObject.elementArrayBuffer=e}return l.bindBuffer.apply(this,arguments)},n.getVertexAttrib=function(t,e){var i=h.currentVertexArrayObject.attribs[t];switch(e){case n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:return i.buffer;case n.VERTEX_ATTRIB_ARRAY_ENABLED:return i.enabled;case n.VERTEX_ATTRIB_ARRAY_SIZE:return i.size;case n.VERTEX_ATTRIB_ARRAY_STRIDE:return i.stride;case n.VERTEX_ATTRIB_ARRAY_TYPE:return i.type;case n.VERTEX_ATTRIB_ARRAY_NORMALIZED:return i.normalized;default:return l.getVertexAttrib.apply(this,arguments)}},n.vertexAttribPointer=function(t,e,i,n,r,s){var a=h.currentVertexArrayObject;a.maxAttrib=Math.max(a.maxAttrib,t);var o=a.attribs[t];return o.buffer=h.currentArrayBuffer,o.size=e,o.type=i,o.normalized=n,o.stride=r,o.offset=s,o.recache(),l.vertexAttribPointer.apply(this,arguments)},n.instrumentExtension&&n.instrumentExtension(this,"OES_vertex_array_object"),n.canvas&&n.canvas.addEventListener&&n.canvas.addEventListener("webglcontextrestored",function(){var t;t="OESVertexArrayObject emulation library context restored",m.console&&m.console.log&&m.console.log(t),h.reset_()},!0),this.reset_()};n.prototype.VERTEX_ARRAY_BINDING_OES=34229,n.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(var t=0;t<this.vertexArrayObjects.length;++t)this.vertexArrayObjects.isAlive=!1;var e=this.gl;this.maxVertexAttribs=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.defaultVertexArrayObject=new i(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},n.prototype.createVertexArrayOES=function(){var t=new i(this);return this.vertexArrayObjects.push(t),t},n.prototype.deleteVertexArrayOES=function(t){t.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(t),1),this.currentVertexArrayObject==t&&this.bindVertexArrayOES(null)},n.prototype.isVertexArrayOES=function(t){return!!(t&&t instanceof i&&t.hasBeenBound&&t.ext==this)},n.prototype.bindVertexArrayOES=function(t){var e=this.gl;if(!t||t.isAlive){var i=this.original,n=this.currentVertexArrayObject;this.currentVertexArrayObject=t||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;var r=this.currentVertexArrayObject;if(n!=r){n&&r.elementArrayBuffer==n.elementArrayBuffer||i.bindBuffer.call(e,e.ELEMENT_ARRAY_BUFFER,r.elementArrayBuffer);for(var s=this.currentArrayBuffer,a=Math.max(n?n.maxAttrib:0,r.maxAttrib),o=0;o<=a;o++){var h=r.attribs[o],l=n?n.attribs[o]:null;if(n&&h.enabled==l.enabled||(h.enabled?i.enableVertexAttribArray.call(e,o):i.disableVertexAttribArray.call(e,o)),h.enabled){var u=!1;n&&h.buffer==l.buffer||(s!=h.buffer&&(i.bindBuffer.call(e,e.ARRAY_BUFFER,h.buffer),s=h.buffer),u=!0),(u||h.cached!=l.cached)&&i.vertexAttribPointer.call(e,o,h.size,h.type,h.normalized,h.stride,h.offset)}}this.currentArrayBuffer!=s&&i.bindBuffer.call(e,e.ARRAY_BUFFER,this.currentArrayBuffer)}}else c(e.INVALID_OPERATION,"bindVertexArrayOES: attempt to bind deleted arrayObject")},m._setupVertexArrayObject=function(t){var e=t.getSupportedExtensions;t.getSupportedExtensions=function(){var t=e.call(this)||[];return t.indexOf("OES_vertex_array_object")<0&&t.push("OES_vertex_array_object"),t};var i=t.getExtension;t.getExtension=function(t){var e=i.call(this,t);return e||("OES_vertex_array_object"!==t?null:(this.__OESVertexArrayObject||(console.log("Setup OES_vertex_array_object polyfill"),this.__OESVertexArrayObject=new n(this)),this.__OESVertexArrayObject))}},m._forceSetupVertexArrayObject=function(t){var e=t.getSupportedExtensions;t.getSupportedExtensions=function(){var t=e.call(this)||[];return t.indexOf("OES_vertex_array_object")<0&&t.push("OES_vertex_array_object"),t};var i=t.getExtension;t.getExtension=function(t){if("OES_vertex_array_object"===t)return this.__OESVertexArrayObject||(console.log("Setup OES_vertex_array_object polyfill"),this.__OESVertexArrayObject=new n(this)),this.__OESVertexArrayObject;var e=i.call(this,t);return e||null}}}()),function(){function e(){this._defaultPhysicsMemory=16,this._editerEnvironment=!1,this.isAntialias=!0,this.isAlpha=!1,this.premultipliedAlpha=!0,this.isStencil=!0,this.octreeCulling=!1,this.octreeInitialSize=64,this.octreeMinNodeSize=2,this.octreeLooseness=1.25,this.debugFrustumCulling=!1,this.octreeInitialCenter=new ln(0,0,0)}I(e,"Config3D");var t=e.prototype;return T.imps(t,{"laya.d3.core.IClone":!0}),t.cloneTo=function(t){var e=t;e._defaultPhysicsMemory=this._defaultPhysicsMemory,e._editerEnvironment=this._editerEnvironment,e.isAntialias=this.isAntialias,e.isAlpha=this.isAlpha,e.premultipliedAlpha=this.premultipliedAlpha,e.isStencil=this.isStencil,e.octreeCulling=this.octreeCulling,this.octreeInitialCenter.cloneTo(e.octreeInitialCenter),e.octreeMinNodeSize=this.octreeMinNodeSize,e.octreeLooseness=this.octreeLooseness,e.debugFrustumCulling=this.debugFrustumCulling},t.clone=function(){var t=new e;return this.cloneTo(t),t},g(0,t,"defaultPhysicsMemory",function(){return this._defaultPhysicsMemory},function(t){if(t<16)throw"defaultPhysicsMemory must large than 16M";this._defaultPhysicsMemory=t}),E(e,["_default",function(){return this._default=new e}]),e}()),_i=(function(){function t(){}I(t,"laya.d3.math.ContainmentType"),t.Disjoint=0,t.Contains=1,t.Intersects=2}(),function(){function v(){this._currentPSSM=-1,this._shadowMapCount=3,this._maxDistance=200,this._ratioOfDistance=1/this._shadowMapCount,this._statesDirty=!0,this._shadowMapTextureSize=1024,this._scene=null,this._PCFType=0,this._shaderValueLightVP=null,this._spiltDistance=new Array(4),this._globalParallelLightDir=new ln(0,-1,0),this._boundingSphere=new Array(4),this._boundingBox=new Array(4),this._frustumPos=new Array(16),this._uniformDistance=new Array(4),this._logDistance=new Array(4),this._dimension=new Array(4),this._tempLookAt3=new ln,this._tempLookAt4=new on,this._tempValue=new on,this._tempPos=new ln,this._tempLightUp=new ln,this._tempMin=new on,this._tempMax=new on,this._tempMatrix44=new gt,this._splitFrustumCulling=new ut(gt.DEFAULT),this._tempScaleMatrix44=new gt,this._shadowPCFOffset=new un(1/1024,1/1024),this._shaderValueDistance=new on,this.cameras=[],this._shaderValueVPs=[];var t=0;for(t=0;t<this._spiltDistance.length;t++)this._spiltDistance[t]=0;for(t=0;t<this._dimension.length;t++)this._dimension[t]=new un;for(t=0;t<this._frustumPos.length;t++)this._frustumPos[t]=new ln;for(t=0;t<this._boundingBox.length;t++)this._boundingBox[t]=new Qe(new ln,new ln);for(t=0;t<this._boundingSphere.length;t++)this._boundingSphere[t]=new Ft(new ln,0);gt.createScaling(new ln(.5,.5,1),this._tempScaleMatrix44),this._tempScaleMatrix44.elements[12]=.5,this._tempScaleMatrix44.elements[13]=.5}I(v,"laya.d3.shadowMap.ParallelSplitShadowMap");var t=v.prototype;return t.setInfo=function(t,e,i,n,r,s){3<r&&(this._shadowMapCount=3),this._scene=t,this._maxDistance=e,this.shadowMapCount=r,this._globalParallelLightDir=i,this._ratioOfDistance=1/this._shadowMapCount;for(var a=0;a<this._spiltDistance.length;a++)this._spiltDistance[a]=0;this._shadowMapTextureSize=n,this._shadowPCFOffset.x=1/this._shadowMapTextureSize,this._shadowPCFOffset.y=1/this._shadowMapTextureSize,this.setPCFType(s),this._statesDirty=!0},t.setPCFType=function(t){this._PCFType=t;var e=this._scene._defineDatas;switch(this._PCFType){case 0:e.add(Rs.SHADERDEFINE_SHADOW_PCF_NO),e.remove(Rs.SHADERDEFINE_SHADOW_PCF1),e.remove(Rs.SHADERDEFINE_SHADOW_PCF2),e.remove(Rs.SHADERDEFINE_SHADOW_PCF3);break;case 1:e.add(Rs.SHADERDEFINE_SHADOW_PCF1),e.remove(Rs.SHADERDEFINE_SHADOW_PCF_NO),e.remove(Rs.SHADERDEFINE_SHADOW_PCF2),e.remove(Rs.SHADERDEFINE_SHADOW_PCF3);break;case 2:e.add(Rs.SHADERDEFINE_SHADOW_PCF2),e.remove(Rs.SHADERDEFINE_SHADOW_PCF_NO),e.remove(Rs.SHADERDEFINE_SHADOW_PCF1),e.remove(Rs.SHADERDEFINE_SHADOW_PCF3);break;case 3:e.add(Rs.SHADERDEFINE_SHADOW_PCF3),e.remove(Rs.SHADERDEFINE_SHADOW_PCF_NO),e.remove(Rs.SHADERDEFINE_SHADOW_PCF1),e.remove(Rs.SHADERDEFINE_SHADOW_PCF2)}},t.getPCFType=function(){return this._PCFType},t.setFarDistance=function(t){this._maxDistance!=t&&(this._maxDistance=t,this._statesDirty=!0)},t.getFarDistance=function(){return this._maxDistance},t._beginSampler=function(t,e){if(t<0||t>this._shadowMapCount)throw new Error("ParallelSplitShadowMap: beginSample invalid index");this._currentPSSM=t,this._update(e)},t.endSampler=function(t){this._currentPSSM=-1},t._calcAllLightCameraInfo=function(t){if(1===this._shadowMapCount)this._beginSampler(0,t),this.endSampler(t);else for(var e=0,i=this._shadowMapCount+1;e<i;e++)this._beginSampler(e,t),this.endSampler(t)},t._recalculate=function(t,e,i){this._calcSplitDistance(t),this._calcBoundingBox(e,i),this._rebuildRenderInfo()},t._update=function(t){var e=t.nearPlane,i=t.fieldOfView,n=t.aspectRatio;(this._statesDirty||this.lastNearPlane!==e||this.lastFieldOfView!==i||this.lastAspectRatio!==n)&&(this._recalculate(e,i,n),this._uploadShaderValue(),this._statesDirty=!1,this.lastNearPlane=e,this.lastFieldOfView=i,this.lastAspectRatio=n),this._calcLightViewProject(t)},t._uploadShaderValue=function(){var t=this._scene._defineDatas;switch(this._shadowMapCount){case 1:t.add(Rs.SHADERDEFINE_SHADOW_PSSM1),t.remove(Rs.SHADERDEFINE_SHADOW_PSSM2),t.remove(Rs.SHADERDEFINE_SHADOW_PSSM3);break;case 2:t.add(Rs.SHADERDEFINE_SHADOW_PSSM2),t.remove(Rs.SHADERDEFINE_SHADOW_PSSM1),t.remove(Rs.SHADERDEFINE_SHADOW_PSSM3);break;case 3:t.add(Rs.SHADERDEFINE_SHADOW_PSSM3),t.remove(Rs.SHADERDEFINE_SHADOW_PSSM1),t.remove(Rs.SHADERDEFINE_SHADOW_PSSM2)}var e=this._scene._shaderValues;switch(e.setVector(Rs.SHADOWDISTANCE,this._shaderValueDistance),e.setBuffer(Rs.SHADOWLIGHTVIEWPROJECT,this._shaderValueLightVP),e.setVector2(Rs.SHADOWMAPPCFOFFSET,this._shadowPCFOffset),this._shadowMapCount){case 3:e.setTexture(Rs.SHADOWMAPTEXTURE1,this.cameras[1].renderTarget),e.setTexture(Rs.SHADOWMAPTEXTURE2,this.cameras[2].renderTarget),e.setTexture(Rs.SHADOWMAPTEXTURE3,this.cameras[3].renderTarget);break;case 2:e.setTexture(Rs.SHADOWMAPTEXTURE1,this.cameras[1].renderTarget),e.setTexture(Rs.SHADOWMAPTEXTURE2,this.cameras[2].renderTarget);break;case 1:e.setTexture(Rs.SHADOWMAPTEXTURE1,this.cameras[1].renderTarget)}},t._calcSplitDistance=function(t){var e=this._maxDistance,i=1/this._shadowMapCount,n=0;for(n=0;n<=this._shadowMapCount;n++)this._uniformDistance[n]=t+(e-t)*n*i;var r=e/t;for(n=0;n<=this._shadowMapCount;n++){var s=Math.pow(r,n*i);this._logDistance[n]=t*s}for(n=0;n<=this._shadowMapCount;n++)this._spiltDistance[n]=this._uniformDistance[n]*this._ratioOfDistance+this._logDistance[n]*(1-this._ratioOfDistance);this._shaderValueDistance.x=this._spiltDistance[1],this._shaderValueDistance.y=this._spiltDistance[2],this._shaderValueDistance.z=this._spiltDistance[3],this._shaderValueDistance.w=0},t._calcBoundingBox=function(t,e){var i,n,r,s,a=3.1415926*t/180,o=Math.tan(a/2),h=NaN,l=NaN,u=NaN,c=0;for(c=0;c<=this._shadowMapCount;c++){l=(h=(u=this._spiltDistance[c])*o)*e;var _=this._frustumPos[4*c+0];_.x=-l,_.y=-h,_.z=-u,(_=this._frustumPos[4*c+1]).x=l,_.y=-h,_.z=-u,(_=this._frustumPos[4*c+2]).x=-l,_.y=h,_.z=-u,(_=this._frustumPos[4*c+3]).x=l,_.y=h,_.z=-u,(_=this._dimension[c]).x=l,_.y=h}for(c=1;c<=this._shadowMapCount;c++)i=this._dimension[c],(n=this._boundingBox[c].min).x=-i.x,n.y=-i.y,n.z=-this._spiltDistance[c],(r=this._boundingBox[c].max).x=i.x,r.y=i.y,r.z=-this._spiltDistance[c-1],(s=this._boundingSphere[c].center).x=.5*(n.x+r.x),s.y=.5*(n.y+r.y),s.z=.5*(n.z+r.z),this._boundingSphere[c].radius=.5*Math.sqrt(Math.pow(r.x-n.x,2)+Math.pow(r.y-n.y,2)+Math.pow(r.z-n.z,2));n=this._boundingBox[0].min,i=this._dimension[this._shadowMapCount],n.x=-i.x,n.y=-i.y,n.z=-this._spiltDistance[this._shadowMapCount],(r=this._boundingBox[0].max).x=i.x,r.y=i.y,r.z=-this._spiltDistance[0],(s=this._boundingSphere[0].center).x=.5*(n.x+r.x),s.y=.5*(n.y+r.y),s.z=.5*(n.z+r.z),this._boundingSphere[0].radius=.5*Math.sqrt(Math.pow(r.x-n.x,2)+Math.pow(r.y-n.y,2)+Math.pow(r.z-n.z,2))},t.calcSplitFrustum=function(t){0<this._currentPSSM?gt.createPerspective(3.1416*t.fieldOfView/180,t.aspectRatio,this._spiltDistance[this._currentPSSM-1],this._spiltDistance[this._currentPSSM],this._tempMatrix44):gt.createPerspective(3.1416*t.fieldOfView/180,t.aspectRatio,this._spiltDistance[0],this._spiltDistance[this._shadowMapCount],this._tempMatrix44),gt.multiply(this._tempMatrix44,t.viewMatrix,this._tempMatrix44),this._splitFrustumCulling.matrix=this._tempMatrix44},t._rebuildRenderInfo=function(){var t=this._shadowMapCount+1,e=0;for(this.cameras.length=t,e=0;e<t;e++){if(!this.cameras[e]){var i=new Ia;i.name="lightCamera"+e,i.clearColor=new on(1,1,1,1),this.cameras[e]=i}var n=this.cameras[e].renderTarget;null!=n&&n.width==this._shadowMapTextureSize&&n.height==this._shadowMapTextureSize||(n&&n.destroy(),(n=new Js(this._shadowMapTextureSize,this._shadowMapTextureSize,1,0)).filterMode=0,this.cameras[e].renderTarget=n)}},t._calcLightViewProject=function(t){var e=this._boundingSphere[this._currentPSSM],i=t.transform.worldMatrix;e.radius;e.center.cloneTo(this._tempLookAt3),ln.transformV3ToV4(this._tempLookAt3,i,this._tempLookAt4);var n=this._tempLookAt3,r=this._tempLookAt4;n.x=r.x,n.y=r.y,n.z=r.z;var s=this._tempLightUp;t.transform.worldMatrix.getForward(v._tempVector30);var a=v._tempVector30;s.x=a.x,s.y=1,s.z=a.z,ln.normalize(this._tempLightUp,this._tempLightUp),ln.scale(this._globalParallelLightDir,4*e.radius,this._tempPos),ln.subtract(this._tempLookAt3,this._tempPos,this._tempPos);var o=this.cameras[this._currentPSSM];o.transform.position=this._tempPos,o.transform.lookAt(this._tempLookAt3,this._tempLightUp,!1);var h=this._tempMax,l=this._tempMin;h.x=h.y=h.z=-1e5,h.w=1,l.x=l.y=l.z=1e5,l.w=1,gt.multiply(o.viewMatrix,i,this._tempMatrix44);var u=this._tempValue,c=[];c.length=8,this._boundingBox[this._currentPSSM].getCorners(c);for(var _=0;_<8;_++){var d=c[_];u.x=d.x,u.y=d.y,u.z=d.z,u.w=1,on.transformByM4x4(this._tempValue,this._tempMatrix44,this._tempValue),l.x=u.x<l.x?u.x:l.x,l.y=u.y<l.y?u.y:l.y,l.z=u.z<l.z?u.z:l.z,h.x=u.x>h.x?u.x:h.x,h.y=u.y>h.y?u.y:h.y,h.z=u.z>h.z?u.z:h.z}on.add(this._tempMax,this._tempMin,this._tempValue),u.x*=.5,u.y*=.5,u.z*=.5,u.w=1,on.transformByM4x4(this._tempValue,o.transform.worldMatrix,this._tempValue);var f=Math.abs(-this._tempMax.z),p=f>this._maxDistance?f:this._maxDistance;ln.scale(this._globalParallelLightDir,p,this._tempPos);var m=this._tempPos;m.x=u.x-m.x,m.y=u.y-m.y,m.z=u.z-m.z,o.transform.position=this._tempPos,o.transform.lookAt(this._tempLookAt3,this._tempLightUp,!1),gt.createOrthoOffCenter(l.x,h.x,l.y,h.y,1,p+.5*(h.z-l.z),o.projectionMatrix);var g=o.projectionViewMatrix;v.multiplyMatrixOutFloat32Array(this._tempScaleMatrix44,g,this._shaderValueVPs[this._currentPSSM]),this._scene._shaderValues.setBuffer(Rs.SHADOWLIGHTVIEWPROJECT,this._shaderValueLightVP)},t.setShadowMapTextureSize=function(t){t!==this._shadowMapTextureSize&&(this._shadowMapTextureSize=t,this._shadowPCFOffset.x=1/this._shadowMapTextureSize,this._shadowPCFOffset.y=1/this._shadowMapTextureSize,this._statesDirty=!0)},t.disposeAllRenderTarget=function(){for(var t=0,e=this._shadowMapCount+1;t<e;t++)this.cameras[t].renderTarget&&(this.cameras[t].renderTarget.destroy(),this.cameras[t].renderTarget=null)},g(0,t,"shadowMapCount",function(){return this._shadowMapCount},function(t){if(t=(t=0<t?t:1)<=3?t:3,this._shadowMapCount!=t){this._shadowMapCount=t,this._ratioOfDistance=1/this._shadowMapCount,this._statesDirty=!0,this._shaderValueLightVP=new Float32Array(16*t),this._shaderValueVPs.length=t;for(var e=0;e<t;e++)this._shaderValueVPs[e]=new Float32Array(this._shaderValueLightVP.buffer,64*e)}}),v.multiplyMatrixOutFloat32Array=function(t,e,i){var n,r,s,a,o,h,l;for(r=t.elements,s=e.elements,n=0;n<4;n++)a=r[n],o=r[n+4],h=r[n+8],l=r[n+12],i[n]=a*s[0]+o*s[1]+h*s[2]+l*s[3],i[n+4]=a*s[4]+o*s[5]+h*s[6]+l*s[7],i[n+8]=a*s[8]+o*s[9]+h*s[10]+l*s[11],i[n+12]=a*s[12]+o*s[13]+h*s[14]+l*s[15]},v.MAX_PSSM_COUNT=3,E(v,["_tempVector30",function(){return this._tempVector30=new ln}]),v}()),di=function(){function f(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new rt}I(f,"laya.events.TouchManager");var t=f.prototype;return t._clearTempArrs=function(){f._oldArr.length=0,f._newArr.length=0,f._tEleArr.length=0},t.getTouchFromArr=function(t,e){var i,n,r=0;for(i=e.length,r=0;r<i;r++)if((n=e[r]).id==t)return n;return null},t.removeTouchFromArr=function(t,e){var i=0;for(i=e.length-1;0<=i;i--)e[i].id==t&&e.splice(i,1)},t.createTouchO=function(t,e){var i;return(i=p.getItem("TouchData")||{}).id=e,i.tar=t,i},t.onMouseDown=function(t,e,i){var n,r,s,a;(void 0===i&&(i=!1),this.enable)&&(n=this.getTouchFromArr(e,this.preOvers),s=this.getEles(t,null,f._tEleArr),n?n.tar=t:(r=this.createTouchO(t,e),this.preOvers.push(r)),Vt.onMobile&&this.sendEvents(s,"mouseover"),a=i?this.preDowns:this.preRightDowns,(n=this.getTouchFromArr(e,a))?n.tar=t:(r=this.createTouchO(t,e),a.push(r)),this.sendEvents(s,i?"mousedown":"rightmousedown"),this._clearTempArrs())},t.sendEvents=function(t,e){var i,n,r,s=0;for(i=t.length,this._event._stoped=!1,n=t[0],s=0;s<i;s++){if((r=t[s]).destroyed)return;if(r.event(e,this._event.setTo(e,r,n)),this._event._stoped)break}},t.getEles=function(t,e,i){for(i?i.length=0:i=[];t&&t!=e;)i.push(t),t=t.parent;return i},t.checkMouseOutAndOverOfMove=function(t,e,i){if(void 0===i&&(i=0),e!=t){var n,r,s=0,a=0;if(e.contains(t))r=this.getEles(t,e,f._tEleArr),this.sendEvents(r,"mouseover");else if(t.contains(e))r=this.getEles(e,t,f._tEleArr),this.sendEvents(r,"mouseout");else{var o,h;(r=f._tEleArr).length=0,o=this.getEles(e,null,f._oldArr),h=this.getEles(t,null,f._newArr),a=o.length;var l=0;for(s=0;s<a;s++){if(n=o[s],0<=(l=h.indexOf(n))){h.splice(l,h.length-l);break}r.push(n)}0<r.length&&this.sendEvents(r,"mouseout"),0<h.length&&this.sendEvents(h,"mouseover")}}},t.onMouseMove=function(t,e){var i,n;this.enable&&((i=this.getTouchFromArr(e,this.preOvers))?(this.checkMouseOutAndOverOfMove(t,i.tar),i.tar=t,n=this.getEles(t,null,f._tEleArr)):(n=this.getEles(t,null,f._tEleArr),this.sendEvents(n,"mouseover"),this.preOvers.push(this.createTouchO(t,e))),this.sendEvents(n,"mousemove"),this._clearTempArrs())},t.getLastOvers=function(){return(f._tEleArr.length=0)<this.preOvers.length&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,f._tEleArr):(f._tEleArr.push(T.stage),f._tEleArr)},t.stageMouseOut=function(){var t;t=this.getLastOvers(),this.preOvers.length=0,this.sendEvents(t,"mouseout")},t.onMouseUp=function(t,e,i){if(void 0===i&&(i=!1),this.enable){var n,r,s,a,o,h,l=0,u=0,c=Vt.onMobile;if(r=this.getEles(t,null,f._tEleArr),this.sendEvents(r,i?"mouseup":"rightmouseup"),h=i?this.preDowns:this.preRightDowns,n=this.getTouchFromArr(e,h)){var _,d=Vt.now();if(_=d-this._lastClickTime<300,this._lastClickTime=d,t==n.tar)o=r;else for(s=this.getEles(n.tar,null,f._oldArr),(o=f._newArr).length=0,u=s.length,l=0;l<u;l++)a=s[l],0<=r.indexOf(a)&&o.push(a);0<o.length&&this.sendEvents(o,i?"click":"rightclick"),i&&_&&this.sendEvents(o,"doubleclick"),this.removeTouchFromArr(e,h),n.tar=null,p.recover("TouchData",n)}else;(n=this.getTouchFromArr(e,this.preOvers))&&c&&((o=this.getEles(n.tar,null,o))&&0<o.length&&this.sendEvents(o,"mouseout"),this.removeTouchFromArr(e,this.preOvers),n.tar=null,p.recover("TouchData",n)),this._clearTempArrs()}},f._oldArr=[],f._newArr=[],f._tEleArr=[],E(f,["I",function(){return this.I=new f}]),f}(),fi=function(){function N(){}return I(N,"laya.d3.loaders.LoadModelV05"),N.parse=function(t,e,i,n){N._mesh=i,N._subMeshes=n,N._version=e,N._readData=t,N.READ_DATA(),N.READ_BLOCK(),N.READ_STRINGS();for(var r=0,s=N._BLOCK.count;r<s;r++){N._readData.pos=N._BLOCK.blockStarts[r];var a=N._readData.getUint16(),o=N._strings[a],h=N["READ_"+o];if(null==h)throw new Error("model file err,no this function:"+a+" "+o);h.call(null)}N._mesh._bindPoseIndices=new Uint16Array(N._bindPoseIndices),N._bindPoseIndices.length=0,N._strings.length=0,N._readData=null,N._version=null,N._mesh=null,N._subMeshes=null},N._readString=function(){return N._strings[N._readData.getUint16()]},N.READ_DATA=function(){N._DATA.offset=N._readData.getUint32(),N._DATA.size=N._readData.getUint32()},N.READ_BLOCK=function(){for(var t=N._BLOCK.count=N._readData.getUint16(),e=N._BLOCK.blockStarts=[],i=N._BLOCK.blockLengths=[],n=0;n<t;n++)e.push(N._readData.getUint32()),i.push(N._readData.getUint32())},N.READ_STRINGS=function(){var t=N._readData.getUint32(),e=N._readData.getUint16(),i=N._readData.pos;N._readData.pos=t+N._DATA.offset;for(var n=0;n<e;n++)N._strings[n]=N._readData.readUTFString();N._readData.pos=i},N.READ_MESH=function(){var t=0,e=0,i=(N._readString(),N._readData.__getBuffer()),n=N._readData.getInt16(),r=N._DATA.offset;for(t=0;t<n;t++){var s=r+N._readData.getUint32(),a=N._readData.getUint32(),o=N._readString(),h=Si.getVertexDeclaration(o,!1),l=h.vertexStride,u=new ArrayBuffer(l*a),c=new Float32Array(u),_=o.split(","),d=_.length;switch(N._version){case"LAYAMODEL:05":c=new Float32Array(i.slice(s,s+a*l));break;case"LAYAMODEL:COMPRESSION_05":var f=N._readData.pos;c=new Float32Array(u);var p=new Uint8Array(u);N._readData.pos=s;for(var m=0;m<a;m++)for(var g=0,v=m*l,T=0;T<d;T++)switch(_[T]){case"POSITION":c[g=v/4]=Je.convertToNumber(N._readData.getUint16()),c[g+1]=Je.convertToNumber(N._readData.getUint16()),c[g+2]=Je.convertToNumber(N._readData.getUint16()),v+=12;break;case"NORMAL":c[g=v/4]=N._readData.getUint8()/127.5-1,c[g+1]=N._readData.getUint8()/127.5-1,c[g+2]=N._readData.getUint8()/127.5-1,v+=12;break;case"COLOR":c[g=v/4]=N._readData.getUint8()/255,c[g+1]=N._readData.getUint8()/255,c[g+2]=N._readData.getUint8()/255,c[g+3]=N._readData.getUint8()/255,v+=16;break;case"UV":case"UV1":c[g=v/4]=Je.convertToNumber(N._readData.getUint16()),c[g+1]=Je.convertToNumber(N._readData.getUint16()),v+=8;break;case"BLENDWEIGHT":c[g=v/4]=N._readData.getUint8()/255,c[g+1]=N._readData.getUint8()/255,c[g+2]=N._readData.getUint8()/255,c[g+3]=N._readData.getUint8()/255,v+=16;break;case"BLENDINDICES":p[v]=N._readData.getUint8(),p[v+1]=N._readData.getUint8(),p[v+2]=N._readData.getUint8(),p[v+3]=N._readData.getUint8(),v+=4;break;case"TANGENT":c[g=v/4]=N._readData.getUint8()/127.5-1,c[g+1]=N._readData.getUint8()/127.5-1,c[g+2]=N._readData.getUint8()/127.5-1,c[g+3]=N._readData.getUint8()/127.5-1,v+=16}N._readData.pos=f}var y=new zn(u.byteLength,35044,!0);y.vertexDeclaration=h,y.setData(c),N._mesh._vertexBuffers.push(y),N._mesh._vertexCount+=y.vertexCount,e+=4*c.length}var E=r+N._readData.getUint32(),x=N._readData.getUint32(),S=new Uint16Array(i.slice(E,E+x)),C=new dr("ushort",x/2,35044,!0);C.setData(S),N._mesh._indexBuffer=C,N._mesh._setBuffer(N._mesh._vertexBuffers,C),e+=2*C.indexCount,N._mesh._setCPUMemory(e),N._mesh._setGPUMemory(e);var I=N._mesh._boneNames=[],R=N._readData.getUint16();for(I.length=R,t=0;t<R;t++)I[t]=N._strings[N._readData.getUint16()];var A=N._readData.getUint32(),M=N._readData.getUint32(),D=new Float32Array(i.slice(r+A,r+A+M)),b=D.length,w=b/16,L=N._mesh._inverseBindPosesBuffer=new ArrayBuffer(4*b);for(N._mesh._inverseBindPoses=P(w),t=0;t<b;t+=16){var O=new gt(D[t+0],D[t+1],D[t+2],D[t+3],D[t+4],D[t+5],D[t+6],D[t+7],D[t+8],D[t+9],D[t+10],D[t+11],D[t+12],D[t+13],D[t+14],D[t+15],new Float32Array(L,4*t,16));N._mesh._inverseBindPoses[t/16]=O}return!0},N.READ_SUBMESH=function(){var t=N._readData.__getBuffer(),e=new Cr(N._mesh),i=N._readData.getInt16(),n=N._readData.getUint32(),r=N._readData.getUint32(),s=N._mesh._indexBuffer;e._indexBuffer=s,e._indexStart=n,e._indexCount=r,e._indices=new Uint16Array(s.getData().buffer,2*n,r);var a=N._mesh._vertexBuffers[i];e._vertexBuffer=a;var o=N._DATA.offset,h=e._subIndexBufferStart,l=e._subIndexBufferCount,u=e._boneIndicesList,c=N._readData.getUint16();h.length=c,l.length=c,u.length=c;for(var _=N._mesh._skinDataPathMarks,d=N._bindPoseIndices,f=N._subMeshes.length,p=0;p<c;p++){h[p]=N._readData.getUint32(),l[p]=N._readData.getUint32();for(var m=N._readData.getUint32(),g=N._readData.getUint32(),v=u[p]=new Uint16Array(t.slice(o+m,o+m+g)),T=0,y=v.length;T<y;T++){var E=v[T],x=d.indexOf(E);-1===x?(v[T]=d.length,d.push(E),_.push([f,p,T])):v[T]=x}}return N._subMeshes.push(e),!0},N._strings=[],N._readData=null,N._version=null,N._mesh=null,N._subMeshes=null,N._bindPoseIndices=[],E(N,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),N}(),pi=function(){function C(){}return I(C,"laya.d3.loaders.LoadModelV04"),C.parse=function(t,e,i,n){C._mesh=i,C._subMeshes=n,C._version=e,C._readData=t,C.READ_DATA(),C.READ_BLOCK(),C.READ_STRINGS();for(var r=0,s=C._BLOCK.count;r<s;r++){C._readData.pos=C._BLOCK.blockStarts[r];var a=C._readData.getUint16(),o=C._strings[a],h=C["READ_"+o];if(null==h)throw new Error("model file err,no this function:"+a+" "+o);h.call(null)}C._mesh._bindPoseIndices=new Uint16Array(C._bindPoseIndices),C._bindPoseIndices.length=0,C._strings.length=0,C._readData=null,C._version=null,C._mesh=null,C._subMeshes=null},C._readString=function(){return C._strings[C._readData.getUint16()]},C.READ_DATA=function(){C._DATA.offset=C._readData.getUint32(),C._DATA.size=C._readData.getUint32()},C.READ_BLOCK=function(){for(var t=C._BLOCK.count=C._readData.getUint16(),e=C._BLOCK.blockStarts=[],i=C._BLOCK.blockLengths=[],n=0;n<t;n++)e.push(C._readData.getUint32()),i.push(C._readData.getUint32())},C.READ_STRINGS=function(){var t=C._readData.getUint32(),e=C._readData.getUint16(),i=C._readData.pos;C._readData.pos=t+C._DATA.offset;for(var n=0;n<e;n++)C._strings[n]=C._readData.readUTFString();C._readData.pos=i},C.READ_MESH=function(){C._readString();var t=C._readData.__getBuffer(),e=0,i=0,n=C._readData.getInt16(),r=C._DATA.offset;for(e=0;e<n;e++){var s,a=r+C._readData.getUint32(),o=C._readData.getUint32(),h=new Float32Array(t.slice(a,a+o)),l=C._readString();switch(C._version){case"LAYAMODEL:0301":case"LAYAMODEL:0400":s=Si.getVertexDeclaration(l);break;case"LAYAMODEL:0401":s=Si.getVertexDeclaration(l,!1);break;default:throw new Error("LoadModelV03: unknown version.")}if(!s)throw new Error("LoadModelV03: unknown vertexDeclaration.");var u=new zn(4*h.length,35044,!0);u.vertexDeclaration=s,u.setData(h),C._mesh._vertexBuffers.push(u),C._mesh._vertexCount+=u.vertexCount,i+=4*h.length}var c=r+C._readData.getUint32(),_=C._readData.getUint32(),d=new Uint16Array(t.slice(c,c+_)),f=new dr("ushort",_/2,35044,!0);f.setData(d),i+=2*(C._mesh._indexBuffer=f).indexCount,C._mesh._setBuffer(C._mesh._vertexBuffers,f),C._mesh._setCPUMemory(i),C._mesh._setGPUMemory(i);var p=C._mesh._boneNames=[],m=C._readData.getUint16();for(p.length=m,e=0;e<m;e++)p[e]=C._strings[C._readData.getUint16()];C._readData.pos+=8;var g=C._readData.getUint32(),v=C._readData.getUint32(),T=new Float32Array(t.slice(r+g,r+g+v)),y=T.length,E=y/16,x=C._mesh._inverseBindPosesBuffer=new ArrayBuffer(4*y);for(C._mesh._inverseBindPoses=P(E),e=0;e<y;e+=16){var S=new gt(T[e+0],T[e+1],T[e+2],T[e+3],T[e+4],T[e+5],T[e+6],T[e+7],T[e+8],T[e+9],T[e+10],T[e+11],T[e+12],T[e+13],T[e+14],T[e+15],new Float32Array(x,4*e,16));C._mesh._inverseBindPoses[e/16]=S}return!0},C.READ_SUBMESH=function(){var t=C._readData.__getBuffer(),e=new Cr(C._mesh),i=C._readData.getInt16();C._readData.getUint32(),C._readData.getUint32();var n=C._readData.getUint32(),r=C._readData.getUint32(),s=C._mesh._indexBuffer;e._indexBuffer=s,e._indexStart=n,e._indexCount=r,e._indices=new Uint16Array(s.getData().buffer,2*n,r);var a=C._mesh._vertexBuffers[i];e._vertexBuffer=a;var o=C._DATA.offset,h=e._subIndexBufferStart,l=e._subIndexBufferCount,u=e._boneIndicesList,c=C._readData.getUint16();h.length=c,l.length=c,u.length=c;for(var _=C._mesh._skinDataPathMarks,d=C._bindPoseIndices,f=C._subMeshes.length,p=0;p<c;p++){h[p]=C._readData.getUint32(),l[p]=C._readData.getUint32();for(var m=C._readData.getUint32(),g=C._readData.getUint32(),v=u[p]=new Uint16Array(t.slice(o+m,o+m+g)),T=0,y=v.length;T<y;T++){var E=v[T],x=d.indexOf(E);-1===x?(v[T]=d.length,d.push(E),_.push([f,p,T])):v[T]=x}}return C._subMeshes.push(e),!0},C._strings=[],C._readData=null,C._version=null,C._mesh=null,C._subMeshes=null,C._bindPoseIndices=[],E(C,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),C}(),mi=function(){function n(){this._type=0,this._constant=NaN,this._constantMin=NaN,this._constantMax=NaN}I(n,"laya.d3.core.particleShuriKen.module.StartFrame");var t=n.prototype;return T.imps(t,{"laya.d3.core.IClone":!0}),t.cloneTo=function(t){var e=t;e._type=this._type,e._constant=this._constant,e._constantMin=this._constantMin,e._constantMax=this._constantMax},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},g(0,t,"constantMin",function(){return this._constantMin}),g(0,t,"constant",function(){return this._constant}),g(0,t,"constantMax",function(){return this._constantMax}),g(0,t,"type",function(){return this._type}),n.createByConstant=function(t){var e=new n;return e._type=0,e._constant=t,e},n.createByRandomTwoConstant=function(t,e){var i=new n;return i._type=1,i._constantMin=t,i._constantMax=e,i},n}(),gi=function(){function t(t){this._velocity=null,this.enbale=!1,this.space=0,this._velocity=t}I(t,"laya.d3.core.particleShuriKen.module.VelocityOverLifetime");var e=t.prototype;return T.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this._velocity.cloneTo(e._velocity),e.enbale=this.enbale,e.space=this.space},e.clone=function(){var t;switch(this._velocity.type){case 0:t=Me.createByConstant(this._velocity.constant.clone());break;case 1:t=Me.createByGradient(this._velocity.gradientX.clone(),this._velocity.gradientY.clone(),this._velocity.gradientZ.clone());break;case 2:t=Me.createByRandomTwoConstant(this._velocity.constantMin.clone(),this._velocity.constantMax.clone());break;case 3:t=Me.createByRandomTwoGradient(this._velocity.gradientXMin.clone(),this._velocity.gradientYMin.clone(),this._velocity.gradientZMin.clone(),this._velocity.gradientXMax.clone(),this._velocity.gradientYMax.clone(),this._velocity.gradientZMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e.space=this.space,e},g(0,e,"velocity",function(){return this._velocity}),t}(),vi=function(){function i(t){this.childs=[],this.text="",this.parent=null,this.name=null,this.noCompile=!1,this.includefiles=null,this.condition=null,this.conditionType=0,this.useFuns="",this.z=0,this.src=null,this.includefiles=t}I(i,"laya.webgl.utils.ShaderNode");var t=i.prototype;return t.setParent=function(t){t.childs.push(this),this.z=t.z+1,this.parent=t},t.setCondition=function(t,e){t&&(this.conditionType=e,t=t.replace(/(\s*$)/g,""),this.condition=function(){return this[t]},this.condition.__condition=t)},t.toscript=function(t,e){return this._toscript(t,e,++i.__id)},t._toscript=function(n,r,s){if(this.childs.length<1&&!this.text)return r;r.length;if(this.condition){var t=!!this.condition.call(n);if(2===this.conditionType&&(t=!t),!t)return r}if(this.text&&r.push(this.text),0<this.childs.length&&this.childs.forEach(function(t,e,i){t._toscript(n,r,s)}),0<this.includefiles.length&&0<this.useFuns.length)for(var e,i=0,a=this.includefiles.length;i<a;i++)this.includefiles[i].curUseID!=s&&0<(e=this.includefiles[i].file.getFunsScript(this.useFuns)).length&&(this.includefiles[i].curUseID=s,r[0]=e+r[0]);return r},i.__id=1,i}(),Ti=function(){function l(){}return I(l,"laya.d3.shader.ShaderInit3D"),l.__init__=function(){var t,e;(l._rangeAttenTex=V._buildTexture2D(1024,1,2,Yi.lightAttenTexture)).wrapModeU=1,l._rangeAttenTex.wrapModeV=1,l._rangeAttenTex.lock=!0,We.SHADERDEFINE_HIGHPRECISION=We.registerPublicDefine("HIGHPRECISION"),Rs.SHADERDEFINE_FOG=We.registerPublicDefine("FOG"),Rs.SHADERDEFINE_DIRECTIONLIGHT=We.registerPublicDefine("DIRECTIONLIGHT"),Rs.SHADERDEFINE_POINTLIGHT=We.registerPublicDefine("POINTLIGHT"),Rs.SHADERDEFINE_SPOTLIGHT=We.registerPublicDefine("SPOTLIGHT"),Rs.SHADERDEFINE_CAST_SHADOW=We.registerPublicDefine("CASTSHADOW"),Rs.SHADERDEFINE_SHADOW_PSSM1=We.registerPublicDefine("SHADOWMAP_PSSM1"),Rs.SHADERDEFINE_SHADOW_PSSM2=We.registerPublicDefine("SHADOWMAP_PSSM2"),Rs.SHADERDEFINE_SHADOW_PSSM3=We.registerPublicDefine("SHADOWMAP_PSSM3"),Rs.SHADERDEFINE_SHADOW_PCF_NO=We.registerPublicDefine("SHADOWMAP_PCF_NO"),Rs.SHADERDEFINE_SHADOW_PCF1=We.registerPublicDefine("SHADOWMAP_PCF1"),Rs.SHADERDEFINE_SHADOW_PCF2=We.registerPublicDefine("SHADOWMAP_PCF2"),Rs.SHADERDEFINE_SHADOW_PCF3=We.registerPublicDefine("SHADOWMAP_PCF3"),Rs.SHADERDEFINE_REFLECTMAP=We.registerPublicDefine("REFLECTMAP"),We.addInclude("Lighting.glsl","\nstruct DirectionLight {\n\tvec3 Color;\n\tvec3 Direction;\n};\n\nstruct PointLight {\n\tvec3 Color;\n\tvec3 Position;\n\tfloat Range;\n};\n\nstruct SpotLight {\n\tvec3 Color;\n\tvec3 Position;\n\tvec3 Direction;\n\tfloat Spot;\n\tfloat Range;\n};\n\n// Laya中使用衰减纹理\nfloat LayaAttenuation(in vec3 L,in float invLightRadius) {\n\tfloat fRatio = clamp(length(L) * invLightRadius,0.0,1.0);\n\tfRatio *= fRatio;\n\treturn 1.0 / (1.0 + 25.0 * fRatio)* clamp(4.0*(1.0 - fRatio),0.0,1.0); //fade to black as if 4 pixel texture\n}\n\n// Same as Just Cause 2 and Crysis 2 (you can read GPU Pro 1 book for more information)\nfloat BasicAttenuation(in vec3 L,in float invLightRadius) {\n\tvec3 distance = L * invLightRadius;\n\tfloat attenuation = clamp(1.0 - dot(distance, distance),0.0,1.0); // Equals float attenuation = saturate(1.0f - dot(L, L) / (lightRadius *  lightRadius));\n\treturn attenuation * attenuation;\n}\n\n// Inspired on http://fools.slindev.com/viewtopic.php?f=11&t=21&view=unread#unread\nfloat NaturalAttenuation(in vec3 L,in float invLightRadius) {\n\tfloat attenuationFactor = 30.0;\n\tvec3 distance = L * invLightRadius;\n\tfloat attenuation = dot(distance, distance); // Equals float attenuation = dot(L, L) / (lightRadius *  lightRadius);\n\tattenuation = 1.0 / (attenuation * attenuationFactor + 1.0);\n\t// Second we move down the function therewith it reaches zero at abscissa 1:\n\tattenuationFactor = 1.0 / (attenuationFactor + 1.0); //attenuationFactor contains now the value we have to subtract\n\tattenuation = max(attenuation - attenuationFactor, 0.0); // The max fixes a bug.\n\t// Finally we expand the equation along the y-axis so that it starts with a function value of 1 again.\n\tattenuation /= 1.0 - attenuationFactor;\n\treturn attenuation;\n}\n\nvoid LayaAirBlinnPhongLight (in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir,in vec3 lightColor, in vec3 lightVec,out vec3 diffuseColor,out vec3 specularColor) {\n\tmediump vec3 h = normalize(viewDir-lightVec);\n\tlowp float ln = max (0.0, dot (-lightVec,normal));\n\tfloat nh = max (0.0, dot (h,normal));\n\tdiffuseColor=lightColor * ln;\n\tspecularColor=lightColor *specColor*pow (nh, specColorIntensity*128.0) * gloss;\n}\n\nvoid LayaAirBlinnPhongDiectionLight (in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in DirectionLight light,out vec3 diffuseColor,out vec3 specularColor) {\n\tvec3 lightVec=normalize(light.Direction);\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.Color,lightVec,diffuseColor,specularColor);\n}\n\nvoid LayaAirBlinnPhongPointLight (in vec3 pos,in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in PointLight light,out vec3 diffuseColor,out vec3 specularColor) {\n\tvec3 lightVec =  pos-light.Position;\n\t//if( length(lightVec) > light.Range )\n\t//\treturn;\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.Color,lightVec/length(lightVec),diffuseColor,specularColor);\n\tfloat attenuate = LayaAttenuation(lightVec, 1.0/light.Range);\n\tdiffuseColor *= attenuate;\n\tspecularColor*= attenuate;\n}\n\nvoid LayaAirBlinnPhongSpotLight (in vec3 pos,in vec3 specColor,in float specColorIntensity,in vec3 normal,in vec3 gloss, in vec3 viewDir, in SpotLight light,out vec3 diffuseColor,out vec3 specularColor) {\n\tvec3 lightVec =  pos-light.Position;\n\t//if( length(lightVec) > light.Range)\n\t//\treturn;\n\n\tvec3 normalLightVec=lightVec/length(lightVec);\n\tLayaAirBlinnPhongLight(specColor,specColorIntensity,normal,gloss,viewDir,light.Color,normalLightVec,diffuseColor,specularColor);\n\tvec2 cosAngles=cos(vec2(light.Spot,light.Spot*0.5)*0.5);//ConeAttenuation\n\tfloat dl=dot(normalize(light.Direction),normalLightVec);\n\tdl*=smoothstep(cosAngles[0],cosAngles[1],dl);\n\tfloat attenuate = LayaAttenuation(lightVec, 1.0/light.Range)*dl;\n\tdiffuseColor *=attenuate;\n\tspecularColor *=attenuate;\n}\n\nvec3 NormalSampleToWorldSpace(vec3 normalMapSample, vec3 unitNormal, vec3 tangent,vec3 binormal) {\n\tvec3 normalT =vec3(2.0*normalMapSample.x - 1.0,1.0-2.0*normalMapSample.y,2.0*normalMapSample.z - 1.0);\n\n\t// Build orthonormal basis.\n\tvec3 N = normalize(unitNormal);\n\tvec3 T = normalize(tangent);\n\tvec3 B = normalize(binormal);\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN*normalT;\n\n\treturn bumpedNormal;\n}\n\nvec3 NormalSampleToWorldSpace1(vec4 normalMapSample, vec3 tangent, vec3 binormal, vec3 unitNormal) {\n\tvec3 normalT;\n\tnormalT.x = 2.0 * normalMapSample.x - 1.0;\n\tnormalT.y = 1.0 - 2.0 * normalMapSample.y;\n\tnormalT.z = sqrt(1.0 - clamp(dot(normalT.xy, normalT.xy), 0.0, 1.0));\n\n\tvec3 T = normalize(tangent);\n\tvec3 B = normalize(binormal);\n\tvec3 N = normalize(unitNormal);\n\tmat3 TBN = mat3(T, B, N);\n\n\t// Transform from tangent space to world space.\n\tvec3 bumpedNormal = TBN * normalize(normalT);\n\n\treturn bumpedNormal;\n}\n\nvec3 DecodeLightmap(vec4 color) {\n\treturn color.rgb*color.a*5.0;\n}\n\nvec2 TransformUV(vec2 texcoord,vec4 tilingOffset) {\n\tvec2 transTexcoord=vec2(texcoord.x,texcoord.y-1.0)*tilingOffset.xy+vec2(tilingOffset.z,-tilingOffset.w);\n\ttransTexcoord.y+=1.0;\n\treturn transTexcoord;\n}\n\nvec4 remapGLPositionZ(vec4 position) {\n\tposition.z=position.z * 2.0 - position.w;\n\treturn position;\n}\n\nmat3 inverse(mat3 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n  float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n  float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n  float b01 = a22 * a11 - a12 * a21;\n  float b11 = -a22 * a10 + a12 * a20;\n  float b21 = a21 * a10 - a11 * a20;\n\n  float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n              b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n              b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n}\n\n"),We.addInclude("ShadowHelper.glsl","uniform sampler2D u_shadowMap1;\nuniform sampler2D u_shadowMap2;\nuniform sampler2D u_shadowMap3;\nuniform vec2\t  u_shadowPCFoffset;\nuniform vec4     u_shadowPSSMDistance;\nvec4 packDepth(const in float depth)\n{\n\tconst vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);\n\tconst vec4 bitMask\t= vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);\n\tvec4 res = mod(depth*bitShift*vec4(255), vec4(256))/vec4(255);\n\tres -= res.xxyz * bitMask;\n\treturn res;\n}\nfloat unpackDepth(const in vec4 rgbaDepth)\n{\n\tconst vec4 bitShift = vec4(1.0/(256.0*256.0*256.0), 1.0/(256.0*256.0), 1.0/256.0, 1.0);\n\tfloat depth = dot(rgbaDepth, bitShift);\n\treturn depth;\n}\nfloat tex2DPCF( sampler2D shadowMap,vec2 texcoord,vec2 invsize,float zRef )\n{\n\tvec2 texelpos =texcoord / invsize;\n\tvec2 lerps = fract( texelpos );\n\tfloat sourcevals[4];\n\tsourcevals[0] = float( unpackDepth(texture2D(shadowMap,texcoord)) > zRef );\n\tsourcevals[1] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x,0))) > zRef );\n\tsourcevals[2] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(0,invsize.y))) > zRef );\n\tsourcevals[3] = float( unpackDepth(texture2D(shadowMap,texcoord + vec2(invsize.x, invsize.y) )) > zRef );\n\treturn mix( mix(sourcevals[0],sourcevals[2],lerps.y),mix(sourcevals[1],sourcevals[3],lerps.y),lerps.x );\n}\nfloat getShadowPSSM3( sampler2D shadowMap1,sampler2D shadowMap2,sampler2D shadowMap3,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\tnPSNum += int(posViewZ>pssmDistance.z);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\telse if( nPSNum == 2 )\n\t{\n\t\tlightVP = lightShadowVP[3];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t} \n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap3,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 2 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap3,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM2( sampler2D shadowMap1,sampler2D shadowMap2,mat4 lightShadowVP[4],vec4 pssmDistance,vec2 shadowPCFOffset,vec3 worldPos,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tint nPSNum = int(posViewZ>pssmDistance.x);\n\tnPSNum += int(posViewZ>pssmDistance.y);\n\t//真SB,webgl不支持在PS中直接访问数组\n\tmat4 lightVP;\n\tif( nPSNum == 0 )\n\t{\n\t\tlightVP = lightShadowVP[1];\n\t}\n\telse if( nPSNum == 1 )\n\t{\n\t\tlightVP = lightShadowVP[2];\n\t}\n\tvec4 vLightMVPPos = lightVP * vec4(worldPos,1.0);\n\t//为了效率，在CPU计算/2.0 + 0.5\n\t//vec3 vText = (vLightMVPPos.xyz / vLightMVPPos.w)/2.0 + 0.5;\n\tvec3 vText = vLightMVPPos.xyz / vLightMVPPos.w;\n\tfloat fMyZ = vText.z - zBias;\n\t/*\n\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\tbool bInFrustum = all( bInFrustumVec );\n\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\tbool bFrustumTest = all( bFrustumTestVec );\n\tif ( bFrustumTest ) \n\t*/\n\tif( fMyZ <= 1.0 )\n\t{\n\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,\tfMyZ );\n\t\t\tvalue = value/4.0;\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF2\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap2,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tvec4 color = texture2D( shadowMap2,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n\t\t}\n#endif\n#ifdef SHADOWMAP_PCF_NO\n\t\tvec4 color;\n\t\tif ( nPSNum == 0 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap1,vText.xy );\n\t\t}\n\t\telse if( nPSNum == 1 )\n\t\t{\n\t\t\tcolor = texture2D( shadowMap2,vText.xy );\n\t\t}\n\t\tzdepth = unpackDepth(color);\n\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t}\n\treturn value;\n}\nfloat getShadowPSSM1( sampler2D shadowMap1,vec4 lightMVPPos,vec4 pssmDistance,vec2 shadowPCFOffset,float posViewZ,float zBias )\n{\n\tfloat value = 1.0;\n\tif( posViewZ < pssmDistance.x )\n\t{\n\t\tvec3 vText = lightMVPPos.xyz / lightMVPPos.w;\n\t\tfloat fMyZ = vText.z - zBias;\n\t\t/*\n\t\tbvec4 bInFrustumVec = bvec4 ( vText.x >= 0.0, vText.x <= 1.0, vText.y >= 0.0, vText.y <= 1.0 );\n\t\tbool bInFrustum = all( bInFrustumVec );\n\t\tbvec2 bFrustumTestVec = bvec2( bInFrustum, fMyZ <= 1.0 );\n\t\tbool bFrustumTest = all( bFrustumTestVec );\n\t\t*/\n\t\tif ( fMyZ <= 1.0 ) \n\t\t{\n\t\t\tfloat zdepth=0.0;\n#ifdef SHADOWMAP_PCF3\n\t\t\tvalue =  tex2DPCF( shadowMap1, vText.xy,shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.xy),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(shadowPCFOffset.x,0),shadowPCFOffset,fMyZ );\n\t\t\tvalue += tex2DPCF( shadowMap1, vText.xy+vec2(0,shadowPCFOffset.y),shadowPCFOffset,fMyZ );\n\t\t\tvalue = value/4.0;\n#endif\n#ifdef SHADOWMAP_PCF2\t\t\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF1\n\t\t\tvalue = tex2DPCF( shadowMap1,vText.xy,shadowPCFOffset,fMyZ);\n#endif\n#ifdef SHADOWMAP_PCF_NO\t\t\n\t\t\tvec4 color = texture2D( shadowMap1,vText.xy );\n\t\t\tzdepth = unpackDepth(color);\n\t\t\tvalue = float(fMyZ < zdepth);\n#endif\n\t\t}\n\t}\n\treturn value;\n}"),We.addInclude("BRDF.glsl","struct LayaGI\n{\n\tvec3 diffuse;\n\tvec3 specular;\n};\n\nvec4 LayaAirBRDF(in vec3 diffuseColor, in vec3 specularColor, in float oneMinusReflectivity, in float smoothness, in vec3 normal, in vec3 viewDir, in vec3 lightDir, in vec3 lightColor, in LayaGI gi)\n{\n\tfloat perceptualRoughness = SmoothnessToPerceptualRoughness(smoothness);\n\tvec3 halfDir = SafeNormalize(viewDir - lightDir);\n\t\n\tfloat nv = abs(dot(normal, viewDir));\n\t\n\tfloat nl = clamp(dot(normal,   -lightDir),  0.0, 1.0);\n\tfloat nh = clamp(dot(normal,     halfDir),  0.0, 1.0);\n\tfloat lv = clamp(dot(lightDir,   viewDir),  0.0, 1.0);\n\tfloat lh = clamp(dot(lightDir,  -halfDir),  0.0, 1.0);\n\t\n\tfloat diffuseTerm = DisneyDiffuse(nv, nl, lh, perceptualRoughness) * nl;\n\t\n\tfloat roughness = PerceptualRoughnessToRoughness(perceptualRoughness);\n\t\n\t//#if UNITY_BRDF_GGX\n\tfloat V = SmithJointGGXVisibilityTerm(nl, nv, roughness);\n\tfloat D = GGXTerm(nh, roughness);\n\t\n\tfloat specularTerm = V * D * PI;\n\t\n\tspecularTerm = sqrt(max(0.0001, specularTerm));\n\tspecularTerm = max(0.0, specularTerm * nl);\n\t\n\tfloat surfaceReduction = 1.0 - 0.28 * roughness * perceptualRoughness;\n\tfloat grazingTerm = clamp(smoothness + (1.0 - oneMinusReflectivity), 0.0, 1.0);\n\t\n\tvec4 color;\n\tcolor.rgb = diffuseColor * (gi.diffuse + lightColor * diffuseTerm) \n\t\t\t  + specularTerm * lightColor * FresnelTerm (specularColor, lh)\n\t\t\t  + surfaceReduction * gi.specular * FresnelLerp(specularColor, vec3(grazingTerm), nv);\n\t\n\treturn color;\n}"),We.addInclude("PBRUtils.glsl","struct DirectionLight\n{\n\tvec3 Color;\n\tvec3 Direction;\n};\n\nstruct PointLight\n{\n\tvec3 Color;\n\tvec3 Position;\n\tfloat Range;\n};\n\nstruct SpotLight\n{\n\tvec3 Color;\n\tvec3 Position;\n\tvec3 Direction;\n\tfloat SpotAngle;\n\tfloat Range;\n};\n\nvec3 UnpackScaleNormal(in vec2 uv0)\n{\n\t#ifdef NORMALTEXTURE\n\t\tvec3 normalT;\n\t\tvec4 normalMapSample = texture2D(u_NormalTexture, uv0);\n\t\tnormalT.x = 2.0 * normalMapSample.x - 1.0;\n\t\tnormalT.y = 1.0 - 2.0 * normalMapSample.y;\n\t\tnormalT.xy *= u_normalScale;\n\t\tnormalT.z = sqrt(1.0 - clamp(dot(normalT.xy, normalT.xy), 0.0, 1.0));\n\t\t\n\t\tvec3 T = normalize(v_Tangent);\n\t\tvec3 B = normalize(v_Binormal);\n\t\tvec3 N = normalize(v_Normal);\n\t\tmat3 TBN = mat3(T, B, N);\n\t\t\n\t\tvec3 bumpedNormal = TBN * normalize(normalT);\n\t\treturn bumpedNormal;\n\t#else\n\t\treturn normalize(v_Normal);\n\t#endif\n}\n\nvec4 DielectricSpecularColor = vec4(0.220916301, 0.220916301, 0.220916301, 1.0 - 0.220916301);\n\nfloat PI = 3.14159265359;\n\nvec3 FresnelTerm (in vec3 F0, in float cosA)\n{\n\treturn F0 + (vec3(1.0) - F0) * pow(1.0 - cosA, 5.0);\n}\n\nvec3 FresnelLerp (in vec3 F0, in vec3 F90, float cosA)\n{\n    float t = pow(1.0 - cosA, 5.0);\n    return mix(F0, F90, t);\n}\n\nfloat PerceptualRoughnessToRoughness(in float perceptualRoughness)\n{\n\treturn perceptualRoughness * perceptualRoughness;\n}\n\nfloat PerceptualRoughnessToSpecularPower(in float perceptualRoughness)\n{\n\tfloat m = PerceptualRoughnessToRoughness(perceptualRoughness);\n\tfloat sq = max(0.0001, m * m);\n\tfloat n = (2.0 / sq) - 2.0;\n\tn = max(n, 0.0001);\n\treturn n;\n}\n\nfloat RoughnessToPerceptualRoughness(in float roughness)\n{\n\treturn sqrt(roughness);\n}\n\nfloat SmoothnessToRoughness(in float smoothness)\n{\n\treturn (1.0 - smoothness) * (1.0 - smoothness);\n}\n\nfloat SmoothnessToPerceptualRoughness(in float smoothness)\n{\n\treturn (1.0 - smoothness);\n}\n\nvec3 SafeNormalize(in vec3 inVec)\n{\n\tfloat dp3 = max(0.001,dot(inVec,inVec));\n\treturn inVec * (1.0 / sqrt(dp3));\n}\n\nfloat DisneyDiffuse(in float NdotV, in float NdotL, in float LdotH, in float perceptualRoughness)\n{\n\tfloat fd90 = 0.5 + 2.0 * LdotH * LdotH * perceptualRoughness;\n\tfloat lightScatter\t= (1.0 + (fd90 - 1.0) * pow(1.0 - NdotL,5.0));\n\tfloat viewScatter\t= (1.0 + (fd90 - 1.0) * pow(1.0 - NdotV,5.0));\n\n\treturn lightScatter * viewScatter;\n}\n\nfloat SmithJointGGXVisibilityTerm (float NdotL, float NdotV, float roughness)\n{\n\tfloat a = roughness;\n\tfloat lambdaV = NdotL * (NdotV * (1.0 - a) + a);\n\tfloat lambdaL = NdotV * (NdotL * (1.0 - a) + a);\n\n\treturn 0.5 / (lambdaV + lambdaL + 0.00001);\n}\n\nfloat GGXTerm (float NdotH, float roughness)\n{\n\tfloat a2 = roughness * roughness;\n\tfloat d = (NdotH * a2 - NdotH) * NdotH + 1.0;\n\treturn 0.31830988618 * a2 / (d * d + 0.0000001);\n}\n\nfloat OneMinusReflectivityFromMetallic(in float metallic)\n{\n\tfloat oneMinusDielectricSpec = DielectricSpecularColor.a;\n\treturn oneMinusDielectricSpec - metallic * oneMinusDielectricSpec;\n}\n\nfloat SpecularStrength(vec3 specular)\n{\n    //(SHADER_TARGET < 30)return specular.r; \n    return max (max (specular.r, specular.g), specular.b);\n}\n\nvec3 DiffuseAndSpecularFromMetallic(in vec3 diffuseColor, in float metallic, out vec3 specularColor, out float oneMinusReflectivity)\n{\n\tspecularColor = mix(DielectricSpecularColor.rgb, diffuseColor, metallic);\n\toneMinusReflectivity = OneMinusReflectivityFromMetallic(metallic);\n\treturn diffuseColor * oneMinusReflectivity;\n}\n\nvec3 EnergyConservationBetweenDiffuseAndSpecular(in vec3 diffuseColor, in vec3 specularColor, out float oneMinusReflectivity)\n{\n\toneMinusReflectivity = 1.0 - SpecularStrength(specularColor);\n\treturn diffuseColor * oneMinusReflectivity;\n}\n\nvec4 Occlusion(in vec2 uv0){\n\t#ifdef OCCLUSIONTEXTURE\n\t\tvec4 occlusionTextureColor = texture2D(u_OcclusionTexture, uv0);\n\t\tfloat occ = occlusionTextureColor.g;\n\t\tfloat oneMinusT = 1.0 - u_occlusionStrength;\n\t\tfloat lerpOneTo = oneMinusT + occ * u_occlusionStrength;\n\t\treturn occlusionTextureColor * lerpOneTo;\n\t#else\n\t\treturn vec4(1.0);\n\t#endif\n}\n\nvec2 ParallaxOffset(in vec3 viewDir){\n\t#ifdef PARALLAXTEXTURE\n\t\tfloat h = texture2D(u_ParallaxTexture, v_Texcoord0).g;\n\t\th = h * u_parallaxScale - u_parallaxScale / 2.0;\n\t\tvec3 v = viewDir;\n\t\tv.z += 0.42;\n\t\tvec2 offset = h * (v.xy / v.z);\n\t\treturn v_Texcoord0 + offset;\n\t#else\n\t\treturn v_Texcoord0;\n\t#endif\n}\n\nvec3 ReflectCubeMap(in vec3 viewDir, in vec3 normal){\n\t#ifdef REFLECTMAP\n\t\tvec3 incident = -viewDir;\n\t\tvec3 reflectionVector = reflect(incident, normal);\n\t\tvec3 reflectionColor = textureCube(u_ReflectTexture, vec3(-reflectionVector.x, reflectionVector.yz)).rgb;\n\t\treturn reflectionColor * u_ReflectIntensity;\n\t#else\n\t\treturn vec3(0.0);\n\t#endif\n}\n\nfloat LayaAttenuation(in vec3 L, in float invLightRadius)\n{\n\tfloat fRatio = clamp(length(L) * invLightRadius, 0.0, 1.0);\n\tfRatio *= fRatio;\n\treturn 1.0 / (1.0 + 25.0 * fRatio) * clamp(4.0*(1.0 - fRatio), 0.0, 1.0); //fade to black as if 4 pixel texture\n}\n\nvec3 LayaPreMultiplyAlpha(vec3 diffColor, float alpha, float oneMinusReflectivity, out float outModifiedAlpha)\n{\n\t#ifdef ALPHAPREMULTIPLY\n\t\tdiffColor *= alpha;\n\t\toutModifiedAlpha = 1.0 - oneMinusReflectivity + alpha * oneMinusReflectivity;\n\t#else\n\t\toutModifiedAlpha = alpha;\n\t#endif\n\treturn diffColor;\n}\n\n"),We.addInclude("PBRStandardLighting.glsl",'#include "PBRUtils.glsl"\n#include "BRDF.glsl"\n\nvec4 PBRStandardLight(in vec4 albedoColor, in float metallic, in float smoothness, in vec3 normal, in vec3 viewDir, in vec3 lightDir, in vec3 lightColor, in LayaGI gi)\n{\n\tfloat oneMinusReflectivity;\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat alpha;\n\t\n\tdiffuseColor = DiffuseAndSpecularFromMetallic (albedoColor.rgb, metallic, specularColor, oneMinusReflectivity);\n\t\n\tdiffuseColor = LayaPreMultiplyAlpha(diffuseColor, albedoColor.a, oneMinusReflectivity, alpha);\n\t\n\tvec4 color = LayaAirBRDF(diffuseColor, specularColor, oneMinusReflectivity, smoothness, normal, viewDir, lightDir, lightColor, gi);\n\tcolor.a = alpha;\n\treturn color;\n}\n\nvec4 PBRStandardDiectionLight (in vec4 albedoColor, in float metallic, in float smoothness, in vec3 normal, in vec3 viewDir, in DirectionLight light, in LayaGI gi)\n{\n\tvec3 lightVec = normalize(light.Direction);\n\treturn PBRStandardLight(albedoColor, metallic, smoothness, normal, viewDir, lightVec, light.Color, gi);\n}\n\nvec4 PBRStandardPointLight (in vec4 albedoColor, in float metallic, in float smoothness, in vec3 normal, in vec3 viewDir, in PointLight light, in vec3 pos, in LayaGI gi)\n{\n\tvec3 lightCoord = (u_PointLightMatrix * vec4(pos, 1.0)).xyz;\n\tfloat distance = dot(lightCoord, lightCoord);\n\tfloat attenuate = texture2D(u_RangeTexture, vec2(distance)).w;\n\tvec3 lightVec = normalize(pos - light.Position);\n\treturn PBRStandardLight(albedoColor, metallic, smoothness, normal, viewDir, lightVec, light.Color, gi) * attenuate;\n}\n\nvec4 PBRStandardSpotLight (in vec4 albedoColor, in float metallic, in float smoothness, in vec3 normal, in vec3 viewDir, in SpotLight light, in vec3 pos, in LayaGI gi)\n{\n\tvec3 lightVec =  pos - light.Position;\n\tvec3 normalLightVec = normalize(lightVec);\n\tvec2 cosAngles = cos(vec2(light.SpotAngle, light.SpotAngle*0.5) * 0.5);//ConeAttenuation\n\tfloat dl = dot(normalize(light.Direction), normalLightVec);\n\tdl *= smoothstep(cosAngles[0], cosAngles[1], dl);\n\tfloat attenuate = LayaAttenuation(lightVec, 1.0/light.Range) * dl;\n\treturn PBRStandardLight(albedoColor, metallic, smoothness, normal, viewDir, lightVec, light.Color, gi) * attenuate;\n}\n\n//vec4 PBRStandardSpotLight1 (in vec4 albedoColor, in float metallic, in float smoothness, in vec3 normal, in vec3 viewDir, in SpotLight light, in vec3 pos, in LayaGI gi)\n//{\n//\tvec4 lightCoord = u_SpotLightMatrix * vec4(pos, 1.0);\n//\t\n//\tfloat distance = dot(lightCoord, lightCoord);\n//\tfloat attenuate = (lightCoord.z < 0.0) ? texture2D(u_RangeTexture, vec2(distance)).w : 0.0;\n//\t//float attenuate = (lightCoord.z < 0.0) ? texture2D(u_AngleTexture, vec2(lightCoord.x / lightCoord.w + 0.5, lightCoord.y / lightCoord.w + 0.5)).r * texture2D(u_RangeTexture, vec2(distance)).w : 0.0;\n//\t//vec2 _uv = vec2(pos.x * 180.0/(2.0 * pos.z) + 0.5, pos.y * 180.0/(2.0 * pos.z) + 0.5);\n//\tvec3 lightVec = normalize(pos - light.Position);\n//\treturn PBRStandardLight(albedoColor, metallic, smoothness, normal, viewDir, lightVec, light.Color, gi) * attenuate;\n//}\n\nvec2 MetallicGloss(in float albedoTextureAlpha, in vec2 uv0)\n{\n\tvec2 mg;\n\t\n\t#ifdef METALLICGLOSSTEXTURE\n\t\tvec4 metallicGlossTextureColor = texture2D(u_MetallicGlossTexture, uv0);\n\t\t#ifdef SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\n\t\t\tmg.r = metallicGlossTextureColor.r;\n\t\t\tmg.g = albedoTextureAlpha;\n\t\t#else\n\t\t    mg = metallicGlossTextureColor.ra;\n\t\t#endif\n\t\tmg.g *= u_smoothnessScale;\n\t#else\n\t\tmg.r = u_metallic;\n\t\t#ifdef SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\n\t\t\tmg.g = albedoTextureAlpha * u_smoothnessScale;\n\t\t#else\n\t\t\tmg.g = u_smoothness;\n\t\t#endif\n\t#endif\n\t\n\treturn mg;\n}\n\n'),We.addInclude("PBRSpecularLighting.glsl",'#include "PBRUtils.glsl"\n#include "BRDF.glsl"\n\nvec4 PBRSpecularLight(in vec4 albedoColor, in vec3 specularColor, in float smoothness, in vec3 normal, in vec3 viewDir, in vec3 lightDir, in vec3 lightColor, in LayaGI gi)\n{\n\tfloat oneMinusReflectivity;\n\tvec3 diffuseColor;\n\tfloat alpha;\n\t\n\tdiffuseColor = EnergyConservationBetweenDiffuseAndSpecular (albedoColor.rgb, specularColor, oneMinusReflectivity);\n\t\n\tdiffuseColor = LayaPreMultiplyAlpha(diffuseColor, albedoColor.a, oneMinusReflectivity, alpha);\n\t\n\tvec4 color = LayaAirBRDF(diffuseColor, specularColor, oneMinusReflectivity, smoothness, normal, viewDir, lightDir, lightColor, gi);\n\tcolor.a = alpha;\n\treturn color;\n}\n\nvec4 PBRSpecularDiectionLight (in vec4 albedoColor, in vec3 specularColor, in float smoothness, in vec3 normal, in vec3 viewDir, in DirectionLight light, in LayaGI gi)\n{\n\tvec3 lightVec = normalize(light.Direction);\n\treturn PBRSpecularLight(albedoColor, specularColor, smoothness, normal, viewDir, lightVec, light.Color, gi);\n}\n\nvec4 PBRSpecularPointLight (in vec4 albedoColor, in vec3 specularColor, in float smoothness, in vec3 normal, in vec3 viewDir, in PointLight light, in vec3 pos, in LayaGI gi)\n{\n\tvec3 lightCoord = (u_PointLightMatrix * vec4(pos, 1.0)).xyz;\n\tfloat distance = dot(lightCoord, lightCoord);\n\tfloat attenuate = texture2D(u_RangeTexture, vec2(distance)).w;\n\tvec3 lightVec = normalize(pos - light.Position);\n\treturn PBRSpecularLight(albedoColor, specularColor, smoothness, normal, viewDir, lightVec, light.Color, gi) * attenuate;\n}\n\nvec4 PBRSpecularSpotLight (in vec4 albedoColor, in vec3 specularColor, in float smoothness, in vec3 normal, in vec3 viewDir, in SpotLight light, in vec3 pos, in LayaGI gi)\n{\n\tvec3 lightVec =  pos - light.Position;\n\tvec3 normalLightVec = normalize(lightVec);\n\tvec2 cosAngles = cos(vec2(light.SpotAngle, light.SpotAngle*0.5) * 0.5);//ConeAttenuation\n\tfloat dl = dot(normalize(light.Direction), normalLightVec);\n\tdl *= smoothstep(cosAngles[0], cosAngles[1], dl);\n\tfloat attenuate = LayaAttenuation(lightVec, 1.0/light.Range) * dl;\n\treturn PBRSpecularLight(albedoColor, specularColor, smoothness, normal, viewDir, lightVec, light.Color, gi) * attenuate;\n}\n\n//vec4 PBRStandardSpotLight1 (in vec4 albedoColor, in float metallic, in float smoothness, in vec3 normal, in vec3 viewDir, in SpotLight light, in vec3 pos, in LayaGI gi)\n//{\n//\tvec4 lightCoord = u_SpotLightMatrix * vec4(pos, 1.0);\n//\t\n//\tfloat distance = dot(lightCoord, lightCoord);\n//\tfloat attenuate = (lightCoord.z < 0.0) ? texture2D(u_RangeTexture, vec2(distance)).w : 0.0;\n//\t//float attenuate = (lightCoord.z < 0.0) ? texture2D(u_AngleTexture, vec2(lightCoord.x / lightCoord.w + 0.5, lightCoord.y / lightCoord.w + 0.5)).r * texture2D(u_RangeTexture, vec2(distance)).w : 0.0;\n//\t//vec2 _uv = vec2(pos.x * 180.0/(2.0 * pos.z) + 0.5, pos.y * 180.0/(2.0 * pos.z) + 0.5);\n//\tvec3 lightVec = normalize(pos - light.Position);\n//\treturn PBRStandardLight(albedoColor, metallic, smoothness, normal, viewDir, lightVec, light.Color, gi) * attenuate;\n//}\n\nvec4 SpecularGloss(float albedoTextureAlpha, in vec2 uv0)\n{\n    vec4 sg;\n\t\n\t#ifdef SPECULARTEXTURE\n\t\tvec4 specularTextureColor = texture2D(u_SpecularTexture, uv0);\n\t\t#ifdef SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\n\t\t\tsg.rgb = specularTextureColor.rgb;\n\t\t\tsg.a = albedoTextureAlpha;\n\t\t#else\n\t\t\tsg = specularTextureColor;\n\t\t#endif\n\t\tsg.a *= u_smoothnessScale;\n\t#else\n\t\tsg.rgb = u_SpecularColor.rgb;\n\t\t#ifdef SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA\n\t\t\tsg.a = albedoTextureAlpha * u_smoothnessScale;\n\t\t#else\n\t\t\tsg.a = u_smoothness;\n\t\t#endif\n\t#endif\n\t\n    return sg;\n}\n\n'),We.addInclude("Colors.glsl",'#include "StdLib.glsl";\n\n#define EPSILON 1.0e-4\n\n// Quadratic color thresholding\n// curve = (threshold - knee, knee * 2, 0.25 / knee)\nmediump vec4 quadraticThreshold(mediump vec4 color, mediump float threshold, mediump vec3 curve) {\n\t// Pixel brightness\n\tmediump float br = max3(color.r, color.g, color.b);\n\n\t// Under-threshold part: quadratic curve\n\tmediump float rq = clamp(br - curve.x, 0.0, curve.y);\n\trq = curve.z * rq * rq;\n\n\t// Combine and apply the brightness response curve.\n\tcolor *= max(rq, br - threshold) / max(br, EPSILON);\n\n\treturn color;\n}\n\n//\n// sRGB transfer functions\n// Fast path ref: http://chilliant.blogspot.com.au/2012/08/srgb-approximations-for-hlsl.html?m=1\n//\nmediump vec3 SRGBToLinear(mediump vec3 c) {\n\t#ifdef USE_VERY_FAST_SRGB\n\t\treturn c * c;\n\t#elif defined(USE_FAST_SRGB)\n\t\treturn c * (c * (c * 0.305306011 + 0.682171111) + 0.012522878);\n\t#else\n\t\tmediump vec3 linearRGBLo = c / 12.92;\n\t\tmediump vec3 power=vec3(2.4, 2.4, 2.4);\n\t\tmediump vec3 linearRGBHi = positivePow((c + 0.055) / 1.055, power);\n\t\tmediump vec3 linearRGB =vec3((c.r<=0.04045) ? linearRGBLo.r : linearRGBHi.r,(c.g<=0.04045) ? linearRGBLo.g : linearRGBHi.g,(c.b<=0.04045) ? linearRGBLo.b : linearRGBHi.b);\n\t\treturn linearRGB;\n\t#endif\n}\n\nmediump vec3 LinearToSRGB(mediump vec3 c) {\n\t#ifdef USE_VERY_FAST_SRGB\n\t\treturn sqrt(c);\n\t#elif defined(USE_FAST_SRGB)\n\t\treturn max(1.055 * PositivePow(c, 0.416666667) - 0.055, 0.0);\n\t#else\n\t\tmediump vec3 sRGBLo = c * 12.92;\n\t\tmediump vec3 power=vec3(1.0 / 2.4, 1.0 / 2.4, 1.0 / 2.4);\n\t\tmediump vec3 sRGBHi = (positivePow(c, power) * 1.055) - 0.055;\n\t\tmediump vec3 sRGB =vec3((c.r<=0.0031308) ? sRGBLo.r : sRGBHi.r,(c.g<=0.0031308) ? sRGBLo.g : sRGBHi.g,(c.b<=0.0031308) ? sRGBLo.b : sRGBHi.b);\n\t\treturn sRGB;\n\t#endif\n}'),We.addInclude("Sampling.glsl","// Better, temporally stable box filtering\n// [Jimenez14] http://goo.gl/eomGso\n// . . . . . . .\n// . A . B . C .\n// . . D . E . .\n// . F . G . H .\n// . . I . J . .\n// . K . L . M .\n// . . . . . . .\nmediump vec4 downsampleBox13Tap(sampler2D tex, vec2 uv, vec2 texelSize)\n{\n    mediump vec4 A = texture2D(tex, uv + texelSize * vec2(-1.0, -1.0));\n    mediump vec4 B = texture2D(tex, uv + texelSize * vec2( 0.0, -1.0));\n    mediump vec4 C = texture2D(tex, uv + texelSize * vec2( 1.0, -1.0));\n    mediump vec4 D = texture2D(tex, uv + texelSize * vec2(-0.5, -0.5));\n    mediump vec4 E = texture2D(tex, uv + texelSize * vec2( 0.5, -0.5));\n    mediump vec4 F = texture2D(tex, uv + texelSize * vec2(-1.0,  0.0));\n    mediump vec4 G = texture2D(tex, uv);\n    mediump vec4 H = texture2D(tex, uv + texelSize * vec2( 1.0,  0.0));\n    mediump vec4 I = texture2D(tex, uv + texelSize * vec2(-0.5,  0.5));\n    mediump vec4 J = texture2D(tex, uv + texelSize * vec2( 0.5,  0.5));\n    mediump vec4 K = texture2D(tex, uv + texelSize * vec2(-1.0,  1.0));\n    mediump vec4 L = texture2D(tex, uv + texelSize * vec2( 0.0,  1.0));\n    mediump vec4 M = texture2D(tex, uv + texelSize * vec2( 1.0,  1.0));\n\n\tmediump vec2 scale= vec2(0.5, 0.125);\n    mediump vec2 div = (1.0 / 4.0) * scale;\n\n    mediump vec4 o = (D + E + I + J) * div.x;\n    o += (A + B + G + F) * div.y;\n    o += (B + C + H + G) * div.y;\n    o += (F + G + L + K) * div.y;\n    o += (G + H + M + L) * div.y;\n\n    return o;\n}\n\n// Standard box filtering\nmediump vec4 downsampleBox4Tap(sampler2D tex, vec2 uv, vec2 texelSize)\n{\n    vec4 d = texelSize.xyxy * vec4(-1.0, -1.0, 1.0, 1.0);\n\n    mediump vec4 s =  texture2D(tex, uv + d.xy);\n    s += texture2D(tex, uv + d.zy);\n    s += texture2D(tex, uv + d.xw);\n    s += texture2D(tex, uv + d.zw);\n\n    return s * (1.0 / 4.0);\n}\n\n// 9-tap bilinear upsampler (tent filter)\n// . . . . . . .\n// . 1 . 2 . 1 .\n// . . . . . . .\n// . 2 . 4 . 2 .\n// . . . . . . .\n// . 1 . 2 . 1 .\n// . . . . . . .\nmediump vec4 upsampleTent(sampler2D tex, vec2 uv, vec2 texelSize, vec4 sampleScale)\n{\n    vec4 d = texelSize.xyxy * vec4(1.0, 1.0, -1.0, 0.0) * sampleScale;\n\n    mediump vec4 s =  texture2D(tex, uv - d.xy);\n    s += texture2D(tex, uv - d.wy) * 2.0;\n    s += texture2D(tex, uv - d.zy);\n\n    s += texture2D(tex, uv + d.zw) * 2.0;\n    s += texture2D(tex, uv) * 4.0;\n    s += texture2D(tex,\tuv + d.xw) * 2.0;\n\n    s += texture2D(tex, uv + d.zy);\n    s += texture2D(tex, uv + d.wy) * 2.0;\n    s += texture2D(tex, uv + d.xy);\n\n    return s * (1.0 / 16.0);\n}\n\n// Standard box filtering\nmediump vec4 upsampleBox(sampler2D tex, vec2 uv, vec2 texelSize, vec4 sampleScale)\n{\n    vec4 d = texelSize.xyxy * vec4(-1.0, -1.0, 1.0, 1.0) * (sampleScale * 0.5);\n\n    mediump vec4 s =  texture2D(tex, uv + d.xy);\n    s += texture2D(tex, uv + d.zy);\n    s += texture2D(tex, uv + d.xw);\n    s += texture2D(tex, uv + d.zw);\n\n    return s * (1.0 / 4.0);\n}"),We.addInclude("StdLib.glsl","#define HALF_MAX       65504.0 // (2 - 2^-10) * 2^15\n\n#define FLT_EPSILON    1.192092896e-07 // Smallest positive number, such that 1.0 + FLT_EPSILON != 1.0\n\nmediump vec4 safeHDR(mediump vec4 c)\n{\n    return min(c, HALF_MAX);\n}\n\nfloat max3(float a, float b, float c)\n{\n    return max(max(a, b), c);\n}\n\nvec3 positivePow(vec3 base, vec3 power)\n{\n    return pow(max(abs(base), vec3(FLT_EPSILON, FLT_EPSILON, FLT_EPSILON)), power);\n}");var i={a_Position:0,a_Color:1,a_Normal:3,a_Texcoord0:2,a_Texcoord1:7,a_BoneWeights:6,a_BoneIndices:5,a_Tangent0:4,a_MvpMatrix:12,a_WorldMat:8},n={u_Bones:0,u_DiffuseTexture:1,u_SpecularTexture:1,u_NormalTexture:1,u_AlphaTestValue:1,u_DiffuseColor:1,u_MaterialSpecular:1,u_Shininess:1,u_TilingOffset:1,u_WorldMat:2,u_MvpMatrix:2,u_LightmapScaleOffset:2,u_LightMap:2,u_CameraPos:3,u_ReflectTexture:4,u_ReflectIntensity:4,u_FogStart:4,u_FogRange:4,u_FogColor:4,"u_DirectionLight.Color":4,"u_DirectionLight.Direction":4,"u_PointLight.Position":4,"u_PointLight.Range":4,"u_PointLight.Color":4,"u_SpotLight.Position":4,"u_SpotLight.Direction":4,"u_SpotLight.Range":4,"u_SpotLight.Spot":4,"u_SpotLight.Color":4,u_AmbientColor:4,u_shadowMap1:4,u_shadowMap2:4,u_shadowMap3:4,u_shadowPSSMDistance:4,u_lightShadowVP:4,u_shadowPCFoffset:4,u_Curved:3},r={s_Cull:0,s_Blend:1,s_BlendSrc:2,s_BlendDst:3,s_DepthTest:12,s_DepthWrite:13};t='#include "Lighting.glsl";\n\nattribute vec4 a_Position;\n\n#ifdef GPU_INSTANCE\n\tattribute mat4 a_MvpMatrix;\n#else\n\tuniform mat4 u_MvpMatrix;\n#endif\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))||(defined(LIGHTMAP)&&defined(UV))\n\tattribute vec2 a_Texcoord0;\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#if defined(LIGHTMAP)&&defined(UV1)\n\tattribute vec2 a_Texcoord1;\n#endif\n\n#ifdef LIGHTMAP\n\tuniform vec4 u_LightmapScaleOffset;\n\tvarying vec2 v_LightMapUV;\n#endif\n\n#ifdef COLOR\n\tattribute vec4 a_Color;\n\tvarying vec4 v_Color;\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tattribute vec3 a_Normal;\n\tvarying vec3 v_Normal; \n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_ViewDir; \n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\tattribute vec4 a_Tangent0;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(RECEIVESHADOW)\n\t#ifdef GPU_INSTANCE\n\t\tattribute mat4 a_WorldMat;\n\t#else\n\t\tuniform mat4 u_WorldMat;\n\t#endif\n\tvarying vec3 v_PositionWorld;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n  varying vec4 v_lightMVPPos;\n  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nuniform float u_Curved;\n\nvoid main_castShadow()\n{\n\tvec4 position;\n\t#ifdef BONE\n\t\tmat4 skinTransform = u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tposition=skinTransform*a_Position;\n\t#else\n\t\tposition=a_Position;\n\t#endif\n\t#ifdef GPU_INSTANCE\n\t\tgl_Position = a_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * position;\n\t#endif\n\n\t//TODO没考虑UV动画呢\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tv_Texcoord0=a_Texcoord0;\n\t#endif\n\tgl_Position=remapGLPositionZ(gl_Position);\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n\tvec4 position;\n\t#ifdef BONE\n\t\tmat4 skinTransform = u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tposition=skinTransform*a_Position;\n\t#else\n\t\tposition=a_Position;\n\t#endif\n\n\n\t#ifdef GPU_INSTANCE\n\t\tgl_Position = a_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * position;\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(RECEIVESHADOW)\n\t\tmat4 worldMat;\n\t\t#ifdef GPU_INSTANCE\n\t\t\tworldMat = a_WorldMat;\n\t\t#else\n\t\t\tworldMat = u_WorldMat;\n\t\t#endif\n\t#endif\n\t\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tmat3 worldInvMat;\n\t\t#ifdef BONE\n\t\t\tworldInvMat=inverse(mat3(worldMat*skinTransform));\n\t\t#else\n\t\t\tworldInvMat=inverse(mat3(worldMat));\n\t\t#endif  \n\t\tv_Normal=a_Normal*worldInvMat;\n\t\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\t\tv_Tangent=a_Tangent0.xyz*worldInvMat;\n\t\t\tv_Binormal=cross(v_Normal,v_Tangent)*a_Tangent0.w;\n\t\t#endif\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(RECEIVESHADOW)\n\t\tv_PositionWorld=(worldMat*position).xyz;\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tv_ViewDir=u_CameraPos-v_PositionWorld;\n\t\tfloat viewLen = length(v_ViewDir)*u_Curved;\n\t\tgl_Position.y -= viewLen*viewLen*0.001;\n\t#endif\n\n\t#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\t\t#ifdef TILINGOFFSET\n\t\t\tv_Texcoord0=TransformUV(a_Texcoord0,u_TilingOffset);\n\t\t#else\n\t\t\tv_Texcoord0=a_Texcoord0;\n\t\t#endif\n\t#endif\n\n\t#ifdef LIGHTMAP\n\t\t#ifdef SCALEOFFSETLIGHTINGMAPUV\n\t\t\t#ifdef UV1\n\t\t\t\tv_LightMapUV=vec2(a_Texcoord1.x,1.0-a_Texcoord1.y)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t\t#else\n\t\t\t\tv_LightMapUV=vec2(a_Texcoord0.x,1.0-a_Texcoord0.y)*u_LightmapScaleOffset.xy+u_LightmapScaleOffset.zw;\n\t\t\t#endif \n\t\t\tv_LightMapUV.y=1.0-v_LightMapUV.y;\n\t\t#else\n\t\t\t#ifdef UV1\n\t\t\t\tv_LightMapUV=a_Texcoord1;\n\t\t\t#else\n\t\t\t\tv_LightMapUV=a_Texcoord0;\n\t\t\t#endif \n\t\t#endif \n\t#endif\n\n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\t\tv_Color=a_Color;\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1 \n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n\tgl_Position=remapGLPositionZ(gl_Position);\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif\n}',e='#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Lighting.glsl";\n\nuniform vec4 u_DiffuseColor;\n\n#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\tvarying vec4 v_Color;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvarying vec3 v_ViewDir; \n#endif\n\n#ifdef ALPHATEST\n\tuniform float u_AlphaTestValue;\n#endif\n\n#ifdef DIFFUSEMAP\n\tuniform sampler2D u_DiffuseTexture;\n#endif\n\n\n\n#if defined(DIFFUSEMAP)||((defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&(defined(SPECULARMAP)||defined(NORMALMAP)))\n\tvarying vec2 v_Texcoord0;\n#endif\n\n#ifdef LIGHTMAP\n\tvarying vec2 v_LightMapUV;\n\tuniform sampler2D u_LightMap;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tuniform vec3 u_MaterialSpecular;\n\tuniform float u_Shininess;\n\t#ifdef SPECULARMAP \n\t\tuniform sampler2D u_SpecularTexture;\n\t#endif\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\tuniform vec3 u_FogColor;\n#endif\n\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\tvarying vec3 v_Normal;\n#endif\n\n#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\tuniform sampler2D u_NormalTexture;\n\tvarying vec3 v_Tangent;\n\tvarying vec3 v_Binormal;\n#endif\n\n#ifdef DIRECTIONLIGHT\n\tuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\n\tuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\n\tuniform SpotLight u_SpotLight;\n#endif\n\nuniform vec3 u_AmbientColor;\n\n\n#if defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(RECEIVESHADOW)\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#include "ShadowHelper.glsl"\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\nvoid main_castShadow()\n{\n\t//gl_FragColor=vec4(v_posViewZ,0.0,0.0,1.0);\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_DiffuseTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\nvoid main_normal()\n{\n\tvec3 globalDiffuse=u_AmbientColor;\n\t#ifdef LIGHTMAP\t\n\t\tglobalDiffuse += DecodeLightmap(texture2D(u_LightMap, v_LightMapUV));\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tvec3 normal;\n\t\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))&&defined(NORMALMAP)\n\t\t\tvec3 normalMapSample = texture2D(u_NormalTexture, v_Texcoord0).rgb;\n\t\t\tnormal = normalize(NormalSampleToWorldSpace(normalMapSample, v_Normal, v_Tangent,v_Binormal));\n\t\t#else\n\t\t\tnormal = normalize(v_Normal);\n\t\t#endif\n\t\tvec3 viewDir= normalize(v_ViewDir);\n\t#endif\n\t\n\tvec4 mainColor=u_DiffuseColor;\n\t#ifdef DIFFUSEMAP\n\t\tvec4 difTexColor=texture2D(u_DiffuseTexture, v_Texcoord0);\n\t\tmainColor=mainColor*difTexColor;\n\t#endif \n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\t\tmainColor=mainColor*v_Color;\n\t#endif \n    \n\t#ifdef ALPHATEST\n\t\tif(mainColor.a<u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n  \n\t\n\tvec3 diffuse = vec3(0.0);\n\tvec3 specular= vec3(0.0);\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tvec3 dif,spe;\n\t\t#ifdef SPECULARMAP\n\t\t\tvec3 gloss=texture2D(u_SpecularTexture, v_Texcoord0).rgb;\n\t\t#else\n\t\t\t#ifdef DIFFUSEMAP\n\t\t\t\tvec3 gloss=vec3(difTexColor.a);\n\t\t\t#else\n\t\t\t\tvec3 gloss=vec3(1.0);\n\t\t\t#endif\n\t\t#endif\n\t#endif\n\n\t\n\t#ifdef DIRECTIONLIGHT\n\t\tLayaAirBlinnPhongDiectionLight(u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_DirectionLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n \n\t#ifdef POINTLIGHT\n\t\tLayaAirBlinnPhongPointLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_PointLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n\n\t#ifdef SPOTLIGHT\n\t\tLayaAirBlinnPhongSpotLight(v_PositionWorld,u_MaterialSpecular,u_Shininess,normal,gloss,viewDir,u_SpotLight,dif,spe);\n\t\tdiffuse+=dif;\n\t\tspecular+=spe;\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3(u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2(u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1(u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t\t#endif\n\t\tgl_FragColor =vec4(mainColor.rgb*(globalDiffuse + diffuse*shadowValue),mainColor.a);\n\t#else\n\t\tgl_FragColor =vec4(mainColor.rgb*(globalDiffuse + diffuse),mainColor.a);\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\t#ifdef RECEIVESHADOW\n\t\t\tgl_FragColor.rgb+=specular*shadowValue;\n\t\t#else\n\t\t\tgl_FragColor.rgb+=specular;\n\t\t#endif\n\t#endif\n\t  \n\t#ifdef FOG\n\t\tfloat lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\n\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\t\t\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif  \n}\n\n';var s=We.add("BLINNPHONG",!0),a=new ti(i,n,aa.shaderDefines,Ls.shaderDefines);s.addSubShader(a),a.addShaderPass(t,e,r),i={a_Position:0,a_Color:1},n={u_MvpMatrix:2,u_Color:1,u_WorldMat:2,u_CameraPos:3,u_Curved:3},r={s_Cull:0,s_Blend:1,s_BlendSrc:2,s_BlendDst:3,s_DepthTest:12,s_DepthWrite:13},t='#include "Lighting.glsl";\n\nattribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\nuniform vec4 u_Color;\nattribute vec4 a_Color;\nvarying vec4 v_Color;\n\n\nvoid main()\n{\n\tgl_Position = u_MvpMatrix * a_Position;\n\tv_Color=a_Color*u_Color;\n\tgl_Position=remapGLPositionZ(gl_Position);\n}',e="#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec4 v_Color;\nuniform vec4 u_Color;\n\nvoid main()\n{\n  gl_FragColor = v_Color * u_Color; \n}\n\n",s=We.add("LineShader"),a=new ti(i,n),s.addSubShader(a),a.addShaderPass(t,e,r),i={a_Position:0,a_Normal:3,a_Tangent0:4,a_Texcoord0:2,a_BoneWeights:6,a_BoneIndices:5,a_MvpMatrix:12,a_WorldMat:8},n={u_Bones:0,u_MvpMatrix:2,u_WorldMat:2,u_CameraPos:3,u_AlphaTestValue:1,u_AlbedoColor:1,u_EmissionColor:1,u_AlbedoTexture:1,u_NormalTexture:1,u_ParallaxTexture:1,u_MetallicGlossTexture:1,u_OcclusionTexture:1,u_EmissionTexture:1,u_metallic:1,u_smoothness:1,u_smoothnessScale:1,u_occlusionStrength:1,u_normalScale:1,u_parallaxScale:1,u_TilingOffset:1,"u_DirectionLight.Direction":4,"u_DirectionLight.Color":4,u_PointLightMatrix:4,"u_PointLight.Position":4,"u_PointLight.Range":4,"u_PointLight.Color":4,"u_SpotLight.Position":4,"u_SpotLight.Direction":4,"u_SpotLight.Range":4,"u_SpotLight.SpotAngle":4,"u_SpotLight.Color":4,u_RangeTexture:4,u_ReflectTexture:4,u_ReflectIntensity:4,u_AmbientColor:4,u_shadowMap1:4,u_shadowMap2:4,u_shadowMap3:4,u_shadowPSSMDistance:4,u_lightShadowVP:4,u_shadowPCFoffset:4,u_FogStart:4,u_FogRange:4,u_FogColor:4,u_Curved:3},r={s_Cull:0,s_Blend:1,s_BlendSrc:2,s_BlendDst:3,s_DepthTest:12,s_DepthWrite:13},t='#include "Lighting.glsl";\n\nattribute vec4 a_Position;\nattribute vec3 a_Normal;\nattribute vec4 a_Tangent0;\nattribute vec2 a_Texcoord0;\n\n#ifdef GPU_INSTANCE\n\tattribute mat4 a_MvpMatrix;\n#else\n\tuniform mat4 u_MvpMatrix;\n#endif\n\n#ifdef GPU_INSTANCE\n\tattribute mat4 a_WorldMat;\n#else\n\tuniform mat4 u_WorldMat;\n#endif\n\nuniform vec3 u_CameraPos;\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec3 v_PositionWorld;\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n\t  varying vec4 v_lightMVPPos;\n\t  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvoid main_castShadow()\n{\n\tvec4 position;\n\t#ifdef BONE\n\t\tmat4 skinTransform = u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tposition=skinTransform*a_Position;\n\t#else\n\t\tposition=a_Position;\n\t#endif\n\t#ifdef GPU_INSTANCE\n\t\tgl_Position = a_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * position;\n\t#endif\n\t \n\t//TODO没考虑UV动画呢\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tv_Texcoord0 = a_Texcoord0;\n\t#endif\n\tgl_Position=remapGLPositionZ(gl_Position);\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n\tvec4 position;\n\t#ifdef BONE\n\t\tmat4 skinTransform = u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tposition=skinTransform*a_Position;\n\t#else\n\t\tposition=a_Position;\n\t#endif\n\t#ifdef GPU_INSTANCE\n\t\tgl_Position = a_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * position;\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(RECEIVESHADOW)\n\t\tmat4 worldMat;\n\t\t#ifdef GPU_INSTANCE\n\t\t\tworldMat = a_WorldMat;\n\t\t#else\n\t\t\tworldMat = u_WorldMat;\n\t\t#endif\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tmat3 worldInvMat;\n\t\t#ifdef BONE\n\t\t\tworldInvMat=inverse(mat3(worldMat*skinTransform));\n\t\t#else\n\t\t\tworldInvMat=inverse(mat3(worldMat));\n\t\t#endif  \n\t\tv_Normal=a_Normal*worldInvMat;\n\t\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))\n\t\t\tv_Tangent=a_Tangent0.xyz*worldInvMat;\n\t\t\tv_Binormal=cross(v_Normal,v_Tangent)*a_Tangent0.w;\n\t\t#endif\n\t#endif\n\t\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(RECEIVESHADOW)\n\t\tv_PositionWorld=(worldMat*position).xyz;\n\t#endif\n\t\n  \n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tv_ViewDir=u_CameraPos-v_PositionWorld;\n\t#endif\n\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=TransformUV(a_Texcoord0,u_TilingOffset);\n\t#else\n\t\tv_Texcoord0=a_Texcoord0;\n\t#endif\n  \n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1 \n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n\tgl_Position=remapGLPositionZ(gl_Position);\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif\n}',e='#ifdef FSHIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec3 v_PositionWorld;\n\nuniform vec3 u_AmbientColor;\nuniform vec4 u_AlbedoColor;\n\n#ifdef ALBEDOTEXTURE\n\tuniform sampler2D u_AlbedoTexture;\n#endif\n#ifdef METALLICGLOSSTEXTURE\n\tuniform sampler2D u_MetallicGlossTexture;\n#endif\n#ifdef NORMALTEXTURE\n\tuniform sampler2D u_NormalTexture;\n\tuniform float u_normalScale;\n#endif\n#ifdef PARALLAXTEXTURE\n\tuniform sampler2D u_ParallaxTexture;\n\tuniform float u_parallaxScale;\n#endif\n#ifdef OCCLUSIONTEXTURE\n\tuniform sampler2D u_OcclusionTexture;\n\tuniform float u_occlusionStrength;\n#endif\n#ifdef EMISSION\n\t#ifdef EMISSIONTEXTURE\n\t\tuniform sampler2D u_EmissionTexture;\n\t#endif\n\tuniform vec4 u_EmissionColor;\n#endif\n#ifdef REFLECTMAP\n\tuniform samplerCube u_ReflectTexture;\n\tuniform float u_ReflectIntensity;\n#endif\n\nuniform float u_AlphaTestValue;\nuniform float u_metallic;\nuniform float u_smoothness;\nuniform float u_smoothnessScale;\n\nuniform sampler2D u_RangeTexture;\n//uniform sampler2D u_AngleTexture;\nuniform mat4 u_PointLightMatrix;\n//uniform mat4 u_SpotLightMatrix;\n\n#include "PBRStandardLighting.glsl"\n#include "ShadowHelper.glsl"\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\n#ifdef DIRECTIONLIGHT\n\tuniform DirectionLight u_DirectionLight;\n#endif\n#ifdef POINTLIGHT\n\tuniform PointLight u_PointLight;\n#endif\n#ifdef SPOTLIGHT\n\tuniform SpotLight u_SpotLight;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\tuniform vec3 u_FogColor;\n#endif\n\nvoid main_castShadow()\n{\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_AlbedoTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\n\nvoid main_normal()\n{\t\n\tvec3 viewDir = normalize(v_ViewDir);\n\t\n\tvec2 uv0 = ParallaxOffset(viewDir);\n\t\n\tvec2 mg;\n\tvec4 albedoColor;\n\t#ifdef ALBEDOTEXTURE\n\t\tvec4 abledoTextureColor = texture2D(u_AlbedoTexture, uv0);\n\t\talbedoColor = abledoTextureColor * u_AlbedoColor;\n\t\tmg = MetallicGloss(abledoTextureColor.a, uv0);\n\t#else\n\t\talbedoColor = u_AlbedoColor;\n\t\tmg = MetallicGloss(1.0, uv0);\n\t#endif\n\t\n\t#ifdef ALPHATEST\n\t\tif(albedoColor.a < u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n\t\n\tvec3 normal = UnpackScaleNormal(uv0);\n  \n\tLayaGI gi;\n\tgi.diffuse = u_AmbientColor * Occlusion(uv0).rgb;\n\tgi.specular = ReflectCubeMap(viewDir, normal);\n  \n\tvec4 color = vec4(0.0);\n\t\n\t#ifdef DIRECTIONLIGHT\n\t\tcolor += PBRStandardDiectionLight(albedoColor, mg.r, mg.g, normal, viewDir, u_DirectionLight, gi);\n\t#endif\n \n\t#ifdef POINTLIGHT\n\t\tcolor.a = 0.0;\n\t\tcolor += PBRStandardPointLight(albedoColor, mg.r, mg.g, normal, viewDir, u_PointLight, v_PositionWorld, gi);\n\t#endif\n\t\n\t#ifdef SPOTLIGHT\n\t\tcolor.a = 0.0;\n\t\tcolor += PBRStandardSpotLight(albedoColor, mg.r, mg.g, normal, viewDir, u_SpotLight, v_PositionWorld, gi);\n\t#endif\n\t\n\t#ifdef EMISSION\n\t\tvec4 emissionColor = u_EmissionColor;\n\t\t#ifdef EMISSIONTEXTURE\n\t\t\temissionColor *=  texture2D(u_EmissionTexture, uv0);\n\t\t#endif\n\t\tcolor.rgb += emissionColor.rgb;\n\t#endif\n\t\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t\t#endif\n\t\tgl_FragColor = vec4(color.rgb * shadowValue, color.a);\n\t#else\n\t\tgl_FragColor = color;\n\t#endif\n\t\n\t#ifdef FOG\n\t\tfloat lerpFact = clamp((1.0 / gl_FragCoord.w - u_FogStart) / u_FogRange, 0.0, 1.0);\n\t\tgl_FragColor.rgb = mix(gl_FragColor.rgb, u_FogColor, lerpFact);\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\t\t\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif  \n}',s=We.add("PBRStandard",!0),a=new ti(i,n,aa.shaderDefines,Xs.shaderDefines),s.addSubShader(a),a.addShaderPass(t,e,r),i={a_Position:0,a_Normal:3,a_Tangent0:4,a_Texcoord0:2,a_BoneWeights:6,a_BoneIndices:5,a_MvpMatrix:12,a_WorldMat:8},n={u_Bones:0,u_MvpMatrix:2,u_WorldMat:2,u_CameraPos:3,u_AlphaTestValue:1,u_AlbedoColor:1,u_SpecularColor:1,u_EmissionColor:1,u_AlbedoTexture:1,u_NormalTexture:1,u_ParallaxTexture:1,u_SpecularTexture:1,u_OcclusionTexture:1,u_EmissionTexture:1,u_smoothness:1,u_smoothnessScale:1,u_occlusionStrength:1,u_normalScale:1,u_parallaxScale:1,u_TilingOffset:1,"u_DirectionLight.Direction":4,"u_DirectionLight.Color":4,u_PointLightMatrix:4,"u_PointLight.Position":4,"u_PointLight.Range":4,"u_PointLight.Color":4,"u_SpotLight.Position":4,"u_SpotLight.Direction":4,"u_SpotLight.Range":4,"u_SpotLight.SpotAngle":4,"u_SpotLight.Color":4,u_RangeTexture:4,u_ReflectTexture:4,u_ReflectIntensity:4,u_AmbientColor:4,u_shadowMap1:4,u_shadowMap2:4,u_shadowMap3:4,u_shadowPSSMDistance:4,u_lightShadowVP:4,u_shadowPCFoffset:4,u_FogStart:4,u_FogRange:4,u_FogColor:4,u_Curved:3},r={s_Cull:0,s_Blend:1,s_BlendSrc:2,s_BlendDst:3,s_DepthTest:12,s_DepthWrite:13},t='#include "Lighting.glsl";\n\nattribute vec4 a_Position;\nattribute vec3 a_Normal;\nattribute vec4 a_Tangent0;\nattribute vec2 a_Texcoord0;\n\n#ifdef GPU_INSTANCE\n\tattribute mat4 a_MvpMatrix;\n#else\n\tuniform mat4 u_MvpMatrix;\n#endif\n\n#ifdef GPU_INSTANCE\n\tattribute mat4 a_WorldMat;\n#else\n\tuniform mat4 u_WorldMat;\n#endif\nuniform vec3 u_CameraPos;\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec3 v_PositionWorld;\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n  #ifdef SHADOWMAP_PSSM1 \n\t  varying vec4 v_lightMVPPos;\n\t  uniform mat4 u_lightShadowVP[4];\n  #endif\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvoid main_castShadow()\n{\n\tvec4 position;\n\t#ifdef BONE\n\t\tmat4 skinTransform = u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tposition=skinTransform*a_Position;\n\t#else\n\t\tposition=a_Position;\n\t#endif\n\t#ifdef GPU_INSTANCE\n\t\tgl_Position = a_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * position;\n\t#endif\n\t \n\t//TODO没考虑UV动画呢\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tv_Texcoord0 = a_Texcoord0;\n\t#endif\n\tgl_Position=remapGLPositionZ(gl_Position);\n\tv_posViewZ = gl_Position.z;\n}\n\nvoid main_normal()\n{\n\tvec4 position;\n\t#ifdef BONE\n\t\tmat4 skinTransform = u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tposition=skinTransform*a_Position;\n\t#else\n\t\tposition=a_Position;\n\t#endif\n\t#ifdef GPU_INSTANCE\n\t\tgl_Position = a_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * position;\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(RECEIVESHADOW)\n\t\tmat4 worldMat;\n\t\t#ifdef GPU_INSTANCE\n\t\t\tworldMat = a_WorldMat;\n\t\t#else\n\t\t\tworldMat = u_WorldMat;\n\t\t#endif\n\t#endif\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tmat3 worldInvMat;\n\t\t#ifdef BONE\n\t\t\tworldInvMat=inverse(mat3(worldMat*skinTransform));\n\t\t#else\n\t\t\tworldInvMat=inverse(mat3(worldMat));\n\t\t#endif  \n\t\tv_Normal=a_Normal*worldInvMat;\n\t\t#if (defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT))\n\t\t\tv_Tangent=a_Tangent0.xyz*worldInvMat;\n\t\t\tv_Binormal=cross(v_Normal,v_Tangent)*a_Tangent0.w;\n\t\t#endif\n\t#endif\n\t\n\t\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(RECEIVESHADOW)\n\t\tv_PositionWorld=(worldMat*position).xyz;\n\t#endif\n\t\n  \n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tv_ViewDir=u_CameraPos-v_PositionWorld;\n\t#endif\n\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=TransformUV(a_Texcoord0,u_TilingOffset);\n\t#else\n\t\tv_Texcoord0=a_Texcoord0;\n\t#endif\n  \n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1 \n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n\tgl_Position=remapGLPositionZ(gl_Position);\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif\n}',e='#ifdef FSHIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nvarying vec2 v_Texcoord0;\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec3 v_PositionWorld;\n\nuniform vec3 u_AmbientColor;\nuniform vec4 u_AlbedoColor;\nuniform vec4 u_SpecularColor;\n\n#ifdef ALBEDOTEXTURE\n\tuniform sampler2D u_AlbedoTexture;\n#endif\n#ifdef SPECULARTEXTURE\n\tuniform sampler2D u_SpecularTexture;\n#endif\n#ifdef NORMALTEXTURE\n\tuniform sampler2D u_NormalTexture;\n\tuniform float u_normalScale;\n#endif\n#ifdef PARALLAXTEXTURE\n\tuniform sampler2D u_ParallaxTexture;\n\tuniform float u_parallaxScale;\n#endif\n#ifdef OCCLUSIONTEXTURE\n\tuniform sampler2D u_OcclusionTexture;\n\tuniform float u_occlusionStrength;\n#endif\n#ifdef EMISSION\n\t#ifdef EMISSIONTEXTURE\n\t\tuniform sampler2D u_EmissionTexture;\n\t#endif\n\tuniform vec4 u_EmissionColor;\n#endif\n#ifdef REFLECTMAP\n\tuniform samplerCube u_ReflectTexture;\n\tuniform float u_ReflectIntensity;\n#endif\n\nuniform float u_AlphaTestValue;\nuniform float u_metallic;\nuniform float u_smoothness;\nuniform float u_smoothnessScale;\n\nuniform sampler2D u_RangeTexture;\n//uniform sampler2D u_AngleTexture;\nuniform mat4 u_PointLightMatrix;\n//uniform mat4 u_SpotLightMatrix;\n\n#include "PBRSpecularLighting.glsl"\n#include "ShadowHelper.glsl"\n\nvarying float v_posViewZ;\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\n\n#ifdef DIRECTIONLIGHT\n\tuniform DirectionLight u_DirectionLight;\n#endif\n#ifdef POINTLIGHT\n\tuniform PointLight u_PointLight;\n#endif\n#ifdef SPOTLIGHT\n\tuniform SpotLight u_SpotLight;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\tuniform vec3 u_FogColor;\n#endif\n\nvoid main_castShadow()\n{\n\tgl_FragColor=packDepth(v_posViewZ);\n\t#if defined(DIFFUSEMAP)&&defined(ALPHATEST)\n\t\tfloat alpha = texture2D(u_AlbedoTexture,v_Texcoord0).w;\n\t\tif( alpha < u_AlphaTestValue )\n\t\t{\n\t\t\tdiscard;\n\t\t}\n\t#endif\n}\n\nvoid main_normal()\n{\t\n\tvec3 viewDir = normalize(v_ViewDir);\n\t\n\tvec2 uv0 = ParallaxOffset(viewDir);\n\t\n\tvec4 sg;\n\tvec4 albedoColor;\n\t#ifdef ALBEDOTEXTURE\n\t\tvec4 albedoTextureColor = texture2D(u_AlbedoTexture, uv0);\n\t\talbedoColor = albedoTextureColor * u_AlbedoColor;\n\t\tsg = SpecularGloss(albedoTextureColor.a, uv0);\n\t#else\n\t\talbedoColor = u_AlbedoColor;\n\t\tsg = SpecularGloss(1.0, uv0);\n\t#endif\n\t\n\t#ifdef ALPHATEST\n\t\tif(albedoColor.a < u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n  \n\tvec3 normal = UnpackScaleNormal(uv0);\n\t\n\tLayaGI gi;\n\tgi.diffuse = u_AmbientColor * Occlusion(uv0).rgb;\n\tgi.specular = ReflectCubeMap(viewDir, normal);\n\t\n\t//float a = (sg.r+sg.g+sg.b) / 3.0;\n  \n\tvec4 color = vec4(0.0);\n\t\n\t#ifdef DIRECTIONLIGHT\n\t\tcolor += PBRSpecularDiectionLight(albedoColor, sg.rgb, sg.a, normal, viewDir, u_DirectionLight, gi);\n\t#endif\n \n\t#ifdef POINTLIGHT\n\t\tcolor.a = 0.0;\n\t\tcolor += PBRSpecularPointLight(albedoColor, sg.rgb, sg.a, normal, viewDir, u_PointLight, v_PositionWorld, gi);\n\t#endif\n\t\n\t#ifdef SPOTLIGHT\n\t\tcolor.a = 0.0;\n\t\tcolor += PBRSpecularSpotLight(albedoColor, sg.rgb, sg.a, normal, viewDir, u_SpotLight, v_PositionWorld, gi);\n\t#endif\n\t\n\t#ifdef EMISSION\n\t\tvec4 emissionColor = u_EmissionColor;\n\t\t#ifdef EMISSIONTEXTURE\n\t\t\temissionColor *=  texture2D(u_EmissionTexture, uv0);\n\t\t#endif\n\t\tcolor.rgb += emissionColor.rgb;\n\t#endif\n\t\n\t#ifdef RECEIVESHADOW\n\t\tfloat shadowValue = 1.0;\n\t\t#ifdef SHADOWMAP_PSSM3\n\t\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif\n\t\t#ifdef SHADOWMAP_PSSM2\n\t\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t\t#endif \n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t\t#endif\n\t\tgl_FragColor = vec4(color.rgb * shadowValue, color.a);\n\t#else\n\t\tgl_FragColor = color;\n\t#endif\n\t\n\t#ifdef FOG\n\t\tfloat lerpFact = clamp((1.0 / gl_FragCoord.w - u_FogStart) / u_FogRange, 0.0, 1.0);\n\t\tgl_FragColor.rgb = mix(gl_FragColor.rgb, u_FogColor, lerpFact);\n\t#endif\n}\n\nvoid main()\n{\n\t#ifdef CASTSHADOW\t\t\n\t\tmain_castShadow();\n\t#else\n\t\tmain_normal();\n\t#endif  \n}\n\n',s=We.add("PBRSpecular",!0),a=new ti(i,n,aa.shaderDefines,Ns.shaderDefines),s.addSubShader(a),a.addShaderPass(t,e,r),i={a_Position:0,a_Color:1,a_Texcoord0:2,a_BoneWeights:6,a_BoneIndices:5,a_MvpMatrix:12},n={u_Bones:0,u_AlbedoTexture:1,u_AlbedoColor:1,u_TilingOffset:1,u_AlphaTestValue:1,u_MvpMatrix:2,u_FogStart:4,u_FogRange:4,u_FogColor:4,u_WorldMat:2,u_CameraPos:3,u_Curved:3},r={s_Cull:0,s_Blend:1,s_BlendSrc:2,s_BlendDst:3,s_DepthTest:12,s_DepthWrite:13},t='#include "Lighting.glsl";\n\nattribute vec4 a_Position;\n\nattribute vec2 a_Texcoord0;\n\n#ifdef GPU_INSTANCE\n\tattribute mat4 a_MvpMatrix;\n#else\n\tuniform mat4 u_MvpMatrix;\n#endif\n\nattribute vec4 a_Color;\nvarying vec4 v_Color;\nvarying vec2 v_Texcoord0;\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\n\nuniform vec3 u_CameraPos;\nuniform mat4 u_WorldMat;\nuniform float u_Curved;\n\n\nvoid main() {\n\tvec4 position;\n\t#ifdef BONE\n\t\tmat4 skinTransform = u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tposition=skinTransform*a_Position;\n\t#else\n\t\tposition=a_Position;\n\t#endif\n\t#ifdef GPU_INSTANCE\n\t\tgl_Position = a_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * position;\n\t#endif\n\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=TransformUV(a_Texcoord0,u_TilingOffset);\n\t#else\n\t\tv_Texcoord0=a_Texcoord0;\n\t#endif\n\n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\t\tv_Color = a_Color;\n\t#endif\n\n\tvec3 v_PositionWorld= (u_WorldMat*position).xyz;\n\tvec3 v_ViewDir=u_CameraPos-v_PositionWorld;\n\tfloat viewLen = length(v_ViewDir)*u_Curved;\n\tgl_Position.y -= viewLen*viewLen*0.001;\n\t\n\tgl_Position=remapGLPositionZ(gl_Position);\n}',e="#ifdef FSHIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\tvarying vec4 v_Color;\n#endif\n\n#ifdef ALBEDOTEXTURE\n\tuniform sampler2D u_AlbedoTexture;\n\tvarying vec2 v_Texcoord0;\n#endif\n\nuniform vec4 u_AlbedoColor;\n\n#ifdef ALPHATEST\n\tuniform float u_AlphaTestValue;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\nvoid main()\n{\n\tvec4 color =  u_AlbedoColor;\n\t#ifdef ALBEDOTEXTURE\n\t\tcolor *= texture2D(u_AlbedoTexture, v_Texcoord0);\n\t#endif\n\t#if defined(COLOR)&&defined(ENABLEVERTEXCOLOR)\n\t\tcolor *= v_Color;\n\t#endif\n\t\n\t#ifdef ALPHATEST\n\t\tif(color.a < u_AlphaTestValue)\n\t\t\tdiscard;\n\t#endif\n\t\n\tgl_FragColor = color;\n\t\n\t#ifdef FOG\n\t\tfloat lerpFact = clamp((1.0 / gl_FragCoord.w - u_FogStart) / u_FogRange, 0.0, 1.0);\n\t\t#ifdef ADDTIVEFOG\n\t\t\tgl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.0), lerpFact);\n\t\t#else\n\t\t\tgl_FragColor.rgb = mix(gl_FragColor.rgb, u_FogColor, lerpFact);\n\t\t#endif\n\t#endif\n\t\n}\n\n",s=We.add("Unlit",!0),a=new ti(i,n,aa.shaderDefines,Ws.shaderDefines),s.addSubShader(a),a.addShaderPass(t,e,r),i={a_Position:0,a_Texcoord0:2,a_BoneWeights:6,a_BoneIndices:5,a_MvpMatrix:12},n={u_Bones:0,u_AlbedoTexture:1,u_AlbedoColor:1,u_TilingOffset:1,u_AlphaTestValue:1,u_MvpMatrix:2,u_FogStart:4,u_FogRange:4,u_FogColor:4,u_WorldMat:2,u_CameraPos:3,u_Curved:3},r={s_Cull:0,s_Blend:1,s_BlendSrc:2,s_BlendDst:3,s_DepthTest:12,s_DepthWrite:13},t='#include "Lighting.glsl";\n\nattribute vec4 a_Position;\nattribute vec4 a_Color;\nattribute vec2 a_Texcoord0;\n\n#ifdef GPU_INSTANCE\n\tattribute mat4 a_MvpMatrix;\n#else\n\tuniform mat4 u_MvpMatrix;\n#endif\n\nuniform vec3 u_CameraPos;\nuniform mat4 u_WorldMat;\nuniform float u_Curved;\n\nvarying vec4 v_Color;\nvarying vec2 v_Texcoord0;\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\n#ifdef BONE\n\tconst int c_MaxBoneCount = 24;\n\tattribute vec4 a_BoneIndices;\n\tattribute vec4 a_BoneWeights;\n\tuniform mat4 u_Bones[c_MaxBoneCount];\n#endif\n\nvoid main()\n{\n\tvec4 position;\n\t#ifdef BONE\n\t\tmat4 skinTransform = u_Bones[int(a_BoneIndices.x)] * a_BoneWeights.x;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.y)] * a_BoneWeights.y;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.z)] * a_BoneWeights.z;\n\t\tskinTransform += u_Bones[int(a_BoneIndices.w)] * a_BoneWeights.w;\n\t\tposition=skinTransform*a_Position;\n\t#else\n\t\tposition=a_Position;\n\t#endif\n\t#ifdef GPU_INSTANCE\n\t\tgl_Position = a_MvpMatrix * position;\n\t#else\n\t\tgl_Position = u_MvpMatrix * position;\n\t#endif\n\n\tvec3 v_PositionWorld= (u_WorldMat*position).xyz;\n\tvec3 v_ViewDir=u_CameraPos-v_PositionWorld;\n\tfloat viewLen = length(v_ViewDir)*u_Curved;\n\tgl_Position.y -= viewLen*viewLen*0.001;\n\t\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0=TransformUV(a_Texcoord0,u_TilingOffset);\n\t#else\n\t\tv_Texcoord0=a_Texcoord0;\n\t#endif\n\t\t\n\tv_Color = a_Color;\n\tgl_Position=remapGLPositionZ(gl_Position);\n}',e="#ifdef FSHIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#ifdef COLOR\n\tvarying vec4 v_Color;\n#endif\nvarying vec2 v_Texcoord0;\n\n#ifdef MAINTEXTURE\n\tuniform sampler2D u_AlbedoTexture;\n#endif\n\nuniform vec4 u_AlbedoColor;\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\nvoid main()\n{\n\tvec4 color =  2.0 * u_AlbedoColor;\n\t#ifdef COLOR\n\t\tcolor *= v_Color;\n\t#endif\n\t#ifdef MAINTEXTURE\n\t\tcolor *= texture2D(u_AlbedoTexture, v_Texcoord0);\n\t#endif\n\t\n\tgl_FragColor = color;\n\t\n\t#ifdef FOG\n\t\tfloat lerpFact = clamp((1.0 / gl_FragCoord.w - u_FogStart) / u_FogRange, 0.0, 1.0);\n\t\t#ifdef ADDTIVEFOG\n\t\t\tgl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.0), lerpFact);\n\t\t#else\n\t\t\tgl_FragColor.rgb = mix(gl_FragColor.rgb, u_FogColor, lerpFact);\n\t\t#endif\n\t#endif\n}\n\n",s=We.add("Effect",!0),a=new ti(i,n,aa.shaderDefines,Zs.shaderDefines),s.addSubShader(a),a.addShaderPass(t,e,r),i={a_CornerTextureCoordinate:0,a_MeshPosition:1,a_MeshColor:2,a_MeshTextureCoordinate:3,a_ShapePositionStartLifeTime:4,a_DirectionTime:5,a_StartColor:6,a_EndColor:7,a_StartSize:8,a_StartRotation0:9,a_StartSpeed:10,a_Random0:11,a_Random1:12,a_SimulationWorldPostion:13,a_SimulationWorldRotation:14},n={u_Tintcolor:1,u_TilingOffset:1,u_texture:1,u_WorldPosition:2,u_WorldRotation:2,u_PositionScale:2,u_SizeScale:2,u_ScalingMode:2,u_Gravity:2,u_ThreeDStartRotation:2,u_StretchedBillboardLengthScale:2,u_StretchedBillboardSpeedScale:2,u_SimulationSpace:2,u_CurrentTime:2,u_ColorOverLifeGradientAlphas:2,u_ColorOverLifeGradientColors:2,u_MaxColorOverLifeGradientAlphas:2,u_MaxColorOverLifeGradientColors:2,u_VOLVelocityConst:2,u_VOLVelocityGradientX:2,u_VOLVelocityGradientY:2,u_VOLVelocityGradientZ:2,u_VOLVelocityConstMax:2,u_VOLVelocityGradientMaxX:2,u_VOLVelocityGradientMaxY:2,u_VOLVelocityGradientMaxZ:2,u_VOLSpaceType:2,u_SOLSizeGradient:2,u_SOLSizeGradientX:2,u_SOLSizeGradientY:2,u_SOLSizeGradientZ:2,u_SOLSizeGradientMax:2,u_SOLSizeGradientMaxX:2,u_SOLSizeGradientMaxY:2,u_SOLSizeGradientMaxZ:2,u_ROLAngularVelocityConst:2,u_ROLAngularVelocityConstSeprarate:2,u_ROLAngularVelocityGradient:2,u_ROLAngularVelocityGradientX:2,u_ROLAngularVelocityGradientY:2,u_ROLAngularVelocityGradientZ:2,u_ROLAngularVelocityConstMax:2,u_ROLAngularVelocityConstMaxSeprarate:2,u_ROLAngularVelocityGradientMax:2,u_ROLAngularVelocityGradientMaxX:2,u_ROLAngularVelocityGradientMaxY:2,u_ROLAngularVelocityGradientMaxZ:2,u_ROLAngularVelocityGradientMaxW:2,u_TSACycles:2,u_TSASubUVLength:2,u_TSAGradientUVs:2,u_TSAMaxGradientUVs:2,u_CameraPos:3,u_CameraDirection:3,u_CameraUp:3,u_View:3,u_Projection:3,u_FogStart:4,u_FogRange:4,u_FogColor:4,u_Curved:3},r={s_Cull:0,s_Blend:1,s_BlendSrc:2,s_BlendDst:3,s_DepthTest:12,s_DepthWrite:13},t='#include "Lighting.glsl";\n\n#ifdef HIGHPRECISION\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\n#if defined(SPHERHBILLBOARD)||defined(STRETCHEDBILLBOARD)||defined(HORIZONTALBILLBOARD)||defined(VERTICALBILLBOARD)\n\tattribute vec4 a_CornerTextureCoordinate;\n#endif\n#ifdef RENDERMODE_MESH\n\tattribute vec3 a_MeshPosition;\n\tattribute vec4 a_MeshColor;\n\tattribute vec2 a_MeshTextureCoordinate;\n\tvarying vec4 v_MeshColor;\n#endif\n\nattribute vec4 a_ShapePositionStartLifeTime;\nattribute vec4 a_DirectionTime;\nattribute vec4 a_StartColor;\nattribute vec3 a_StartSize;\nattribute vec3 a_StartRotation0;\nattribute float a_StartSpeed;\n#if defined(COLOROVERLIFETIME)||defined(RANDOMCOLOROVERLIFETIME)||defined(SIZEOVERLIFETIMERANDOMCURVES)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n  attribute vec4 a_Random0;\n#endif\n#if defined(TEXTURESHEETANIMATIONRANDOMCURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  attribute vec4 a_Random1;\n#endif\nattribute vec3 a_SimulationWorldPostion;\nattribute vec4 a_SimulationWorldRotation;\n\nvarying float v_Discard;\nvarying vec4 v_Color;\n#ifdef DIFFUSEMAP\n\tvarying vec2 v_TextureCoordinate;\n#endif\n\nuniform float u_CurrentTime;\nuniform vec3 u_Gravity;\n\nuniform vec3 u_WorldPosition;\nuniform vec4 u_WorldRotation;\nuniform bool u_ThreeDStartRotation;\nuniform int u_ScalingMode;\nuniform vec3 u_PositionScale;\nuniform vec3 u_SizeScale;\nuniform mat4 u_View;\nuniform mat4 u_Projection;\n\n#ifdef STRETCHEDBILLBOARD\n\tuniform vec3 u_CameraPosition;\n#endif\nuniform vec3 u_CameraDirection;//TODO:只有几种广告牌模式需要用\nuniform vec3 u_CameraUp;\n\nuniform  float u_StretchedBillboardLengthScale;\nuniform  float u_StretchedBillboardSpeedScale;\nuniform int u_SimulationSpace;\n\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  uniform  int  u_VOLSpaceType;\n#endif\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)\n  uniform  vec3 u_VOLVelocityConst;\n#endif\n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n  uniform  vec2 u_VOLVelocityGradientX[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientY[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientZ[4];//x为key,y为速度\n#endif\n#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n  uniform  vec3 u_VOLVelocityConstMax;\n#endif\n#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n  uniform  vec2 u_VOLVelocityGradientMaxX[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientMaxY[4];//x为key,y为速度\n  uniform  vec2 u_VOLVelocityGradientMaxZ[4];//x为key,y为速度\n#endif\n\n#ifdef COLOROVERLIFETIME\n  uniform  vec4 u_ColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_ColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n#endif\n#ifdef RANDOMCOLOROVERLIFETIME\n  uniform  vec4 u_ColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_ColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n  uniform  vec4 u_MaxColorOverLifeGradientColors[4];//x为key,yzw为Color\n  uniform  vec2 u_MaxColorOverLifeGradientAlphas[4];//x为key,y为Alpha\n#endif\n\n\n#if defined(SIZEOVERLIFETIMECURVE)||defined(SIZEOVERLIFETIMERANDOMCURVES)\n  uniform  vec2 u_SOLSizeGradient[4];//x为key,y为尺寸\n#endif\n#ifdef SIZEOVERLIFETIMERANDOMCURVES\n  uniform  vec2 u_SOLSizeGradientMax[4];//x为key,y为尺寸\n#endif\n#if defined(SIZEOVERLIFETIMECURVESEPERATE)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\n  uniform  vec2 u_SOLSizeGradientX[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientY[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientZ[4];//x为key,y为尺寸\n#endif\n#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n  uniform  vec2 u_SOLSizeGradientMaxX[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientMaxY[4];//x为key,y为尺寸\n  uniform  vec2 u_SOLSizeGradientMaxZ[4];//x为key,y为尺寸\n#endif\n\n\n#ifdef ROTATIONOVERLIFETIME\n  #if defined(ROTATIONOVERLIFETIMECONSTANT)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\n    uniform  float u_ROLAngularVelocityConst;\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n    uniform  float u_ROLAngularVelocityConstMax;\n  #endif\n  #if defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n    uniform  vec2 u_ROLAngularVelocityGradient[4];//x为key,y为旋转\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n    uniform  vec2 u_ROLAngularVelocityGradientMax[4];//x为key,y为旋转\n  #endif\n#endif\n#ifdef ROTATIONOVERLIFETIMESEPERATE\n  #if defined(ROTATIONOVERLIFETIMECONSTANT)||defined(ROTATIONOVERLIFETIMERANDOMCONSTANTS)\n    uniform  vec3 u_ROLAngularVelocityConstSeprarate;\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n    uniform  vec3 u_ROLAngularVelocityConstMaxSeprarate;\n  #endif\n  #if defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\n    uniform  vec2 u_ROLAngularVelocityGradientX[4];\n    uniform  vec2 u_ROLAngularVelocityGradientY[4];\n    uniform  vec2 u_ROLAngularVelocityGradientZ[4];\n  #endif\n  #ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n    uniform  vec2 u_ROLAngularVelocityGradientMaxX[4];\n    uniform  vec2 u_ROLAngularVelocityGradientMaxY[4];\n    uniform  vec2 u_ROLAngularVelocityGradientMaxZ[4];\n\tuniform  vec2 u_ROLAngularVelocityGradientMaxW[4];\n  #endif\n#endif\n\n#if defined(TEXTURESHEETANIMATIONCURVE)||defined(TEXTURESHEETANIMATIONRANDOMCURVE)\n  uniform  float u_TSACycles;\n  uniform  vec2 u_TSASubUVLength;\n  uniform  vec2 u_TSAGradientUVs[4];//x为key,y为frame\n#endif\n#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\n  uniform  vec2 u_TSAMaxGradientUVs[4];//x为key,y为frame\n#endif\n\n#ifdef FOG\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#ifdef TILINGOFFSET\n\tuniform vec4 u_TilingOffset;\n#endif\n\n\nuniform vec3 u_CameraPos;\nuniform float u_Curved;\n\n\nvec3 rotationByEuler(in vec3 vector,in vec3 rot)\n{\n\tfloat halfRoll = rot.z * 0.5;\n    float halfPitch = rot.x * 0.5;\n\tfloat halfYaw = rot.y * 0.5;\n\n\tfloat sinRoll = sin(halfRoll);\n\tfloat cosRoll = cos(halfRoll);\n\tfloat sinPitch = sin(halfPitch);\n\tfloat cosPitch = cos(halfPitch);\n\tfloat sinYaw = sin(halfYaw);\n\tfloat cosYaw = cos(halfYaw);\n\n\tfloat quaX = (cosYaw * sinPitch * cosRoll) + (sinYaw * cosPitch * sinRoll);\n\tfloat quaY = (sinYaw * cosPitch * cosRoll) - (cosYaw * sinPitch * sinRoll);\n\tfloat quaZ = (cosYaw * cosPitch * sinRoll) - (sinYaw * sinPitch * cosRoll);\n\tfloat quaW = (cosYaw * cosPitch * cosRoll) + (sinYaw * sinPitch * sinRoll);\n\t\n\t//vec4 q=vec4(quaX,quaY,quaZ,quaW);\n\t//vec3 temp = cross(q.xyz, vector) + q.w * vector;\n\t//return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\n\t\n\tfloat x = quaX + quaX;\n    float y = quaY + quaY;\n    float z = quaZ + quaZ;\n    float wx = quaW * x;\n    float wy = quaW * y;\n    float wz = quaW * z;\n\tfloat xx = quaX * x;\n    float xy = quaX * y;\n\tfloat xz = quaX * z;\n    float yy = quaY * y;\n    float yz = quaY * z;\n    float zz = quaZ * z;\n\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\n                ((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\n                ((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\n\t\n}\n\n//假定axis已经归一化\nvec3 rotationByAxis(in vec3 vector,in vec3 axis, in float angle)\n{\n\tfloat halfAngle = angle * 0.5;\n\tfloat sin = sin(halfAngle);\n\t\n\tfloat quaX = axis.x * sin;\n\tfloat quaY = axis.y * sin;\n\tfloat quaZ = axis.z * sin;\n\tfloat quaW = cos(halfAngle);\n\t\n\t//vec4 q=vec4(quaX,quaY,quaZ,quaW);\n\t//vec3 temp = cross(q.xyz, vector) + q.w * vector;\n\t//return (cross(temp, -q.xyz) + dot(q.xyz,vector) * q.xyz + q.w * temp);\n\t\n\tfloat x = quaX + quaX;\n    float y = quaY + quaY;\n    float z = quaZ + quaZ;\n    float wx = quaW * x;\n    float wy = quaW * y;\n    float wz = quaW * z;\n\tfloat xx = quaX * x;\n    float xy = quaX * y;\n\tfloat xz = quaX * z;\n    float yy = quaY * y;\n    float yz = quaY * z;\n    float zz = quaZ * z;\n\n    return vec3(((vector.x * ((1.0 - yy) - zz)) + (vector.y * (xy - wz))) + (vector.z * (xz + wy)),\n                ((vector.x * (xy + wz)) + (vector.y * ((1.0 - xx) - zz))) + (vector.z * (yz - wx)),\n                ((vector.x * (xz - wy)) + (vector.y * (yz + wx))) + (vector.z * ((1.0 - xx) - yy)));\n\t\n}\n\nvec3 rotationByQuaternions(in vec3 v,in vec4 q) \n{\n\treturn v + 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\n}\n\n \n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)||defined(SIZEOVERLIFETIMECURVE)||defined(SIZEOVERLIFETIMECURVESEPERATE)||defined(SIZEOVERLIFETIMERANDOMCURVES)||defined(SIZEOVERLIFETIMERANDOMCURVESSEPERATE)\nfloat getCurValueFromGradientFloat(in vec2 gradientNumbers[4],in float normalizedAge)\n{\n\tfloat curValue;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientNumber=gradientNumbers[i];\n\t\tfloat key=gradientNumber.x;\n\t\tif(key>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientNumber=gradientNumbers[i-1];\n\t\t\tfloat lastKey=lastGradientNumber.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\tcurValue=mix(lastGradientNumber.y,gradientNumber.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn curValue;\n}\n#endif\n\n#if defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)||defined(ROTATIONOVERLIFETIMECURVE)||defined(ROTATIONOVERLIFETIMERANDOMCURVES)\nfloat getTotalValueFromGradientFloat(in vec2 gradientNumbers[4],in float normalizedAge)\n{\n\tfloat totalValue=0.0;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientNumber=gradientNumbers[i];\n\t\tfloat key=gradientNumber.x;\n\t\tvec2 lastGradientNumber=gradientNumbers[i-1];\n\t\tfloat lastValue=lastGradientNumber.y;\n\t\t\n\t\tif(key>=normalizedAge){\n\t\t\tfloat lastKey=lastGradientNumber.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\ttotalValue+=(lastValue+mix(lastValue,gradientNumber.y,age))/2.0*a_ShapePositionStartLifeTime.w*(normalizedAge-lastKey);\n\t\t\tbreak;\n\t\t}\n\t\telse{\n\t\t\ttotalValue+=(lastValue+gradientNumber.y)/2.0*a_ShapePositionStartLifeTime.w*(key-lastGradientNumber.x);\n\t\t}\n\t}\n\treturn totalValue;\n}\n#endif\n\n#if defined(COLOROVERLIFETIME)||defined(RANDOMCOLOROVERLIFETIME)\nvec4 getColorFromGradient(in vec2 gradientAlphas[4],in vec4 gradientColors[4],in float normalizedAge)\n{\n\tvec4 overTimeColor;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientAlpha=gradientAlphas[i];\n\t\tfloat alphaKey=gradientAlpha.x;\n\t\tif(alphaKey>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientAlpha=gradientAlphas[i-1];\n\t\t\tfloat lastAlphaKey=lastGradientAlpha.x;\n\t\t\tfloat age=(normalizedAge-lastAlphaKey)/(alphaKey-lastAlphaKey);\n\t\t\toverTimeColor.a=mix(lastGradientAlpha.y,gradientAlpha.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\t\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec4 gradientColor=gradientColors[i];\n\t\tfloat colorKey=gradientColor.x;\n\t\tif(colorKey>=normalizedAge)\n\t\t{\n\t\t\tvec4 lastGradientColor=gradientColors[i-1];\n\t\t\tfloat lastColorKey=lastGradientColor.x;\n\t\t\tfloat age=(normalizedAge-lastColorKey)/(colorKey-lastColorKey);\n\t\t\toverTimeColor.rgb=mix(gradientColors[i-1].yzw,gradientColor.yzw,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn overTimeColor;\n}\n#endif\n\n\n#if defined(TEXTURESHEETANIMATIONCURVE)||defined(TEXTURESHEETANIMATIONRANDOMCURVE)\nfloat getFrameFromGradient(in vec2 gradientFrames[4],in float normalizedAge)\n{\n\tfloat overTimeFrame;\n\tfor(int i=1;i<4;i++)\n\t{\n\t\tvec2 gradientFrame=gradientFrames[i];\n\t\tfloat key=gradientFrame.x;\n\t\tif(key>=normalizedAge)\n\t\t{\n\t\t\tvec2 lastGradientFrame=gradientFrames[i-1];\n\t\t\tfloat lastKey=lastGradientFrame.x;\n\t\t\tfloat age=(normalizedAge-lastKey)/(key-lastKey);\n\t\t\toverTimeFrame=mix(lastGradientFrame.y,gradientFrame.y,age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn floor(overTimeFrame);\n}\n#endif\n\n#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\nvec3 computeParticleLifeVelocity(in float normalizedAge)\n{\n  vec3 outLifeVelocity;\n  #ifdef VELOCITYOVERLIFETIMECONSTANT\n\t outLifeVelocity=u_VOLVelocityConst; \n  #endif\n  #ifdef VELOCITYOVERLIFETIMECURVE\n     outLifeVelocity= vec3(getCurValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge));\n  #endif\n  #ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n\t outLifeVelocity=mix(u_VOLVelocityConst,u_VOLVelocityConstMax,vec3(a_Random1.y,a_Random1.z,a_Random1.w)); \n  #endif\n  #ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n     outLifeVelocity=vec3(mix(getCurValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxX,normalizedAge),a_Random1.y),\n\t                 mix(getCurValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxY,normalizedAge),a_Random1.z),\n\t\t\t\t\t mix(getCurValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge),getCurValueFromGradientFloat(u_VOLVelocityGradientMaxZ,normalizedAge),a_Random1.w));\n  #endif\n\t\t\t\t\t\n  return outLifeVelocity;\n} \n#endif\n\nvec3 computeParticlePosition(in vec3 startVelocity, in vec3 lifeVelocity,in float age,in float normalizedAge,vec3 gravityVelocity,vec4 worldRotation)\n{\n   vec3 startPosition;\n   vec3 lifePosition;\n   #if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t#ifdef VELOCITYOVERLIFETIMECONSTANT\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=lifeVelocity*age;\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMECURVE\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=vec3(getTotalValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge));\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMERANDOMCONSTANT\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=lifeVelocity*age;\n\t#endif\n\t#ifdef VELOCITYOVERLIFETIMERANDOMCURVE\n\t\t  startPosition=startVelocity*age;\n\t\t  lifePosition=vec3(mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxX,normalizedAge),a_Random1.y)\n\t      ,mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxY,normalizedAge),a_Random1.z)\n\t      ,mix(getTotalValueFromGradientFloat(u_VOLVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_VOLVelocityGradientMaxZ,normalizedAge),a_Random1.w));\n\t#endif\n\t\n\tvec3 finalPosition;\n\tif(u_VOLSpaceType==0){\n\t  if(u_ScalingMode!=2)\n\t   finalPosition =rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition),worldRotation);\n\t  else\n\t   finalPosition =rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition+lifePosition,worldRotation);\n\t}\n\telse{\n\t  if(u_ScalingMode!=2)\n\t    finalPosition = rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition),worldRotation)+lifePosition;\n\t  else\n\t    finalPosition = rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation)+lifePosition;\n\t}\n  #else\n\t startPosition=startVelocity*age;\n\t vec3 finalPosition;\n\t if(u_ScalingMode!=2)\n\t   finalPosition = rotationByQuaternions(u_PositionScale*(a_ShapePositionStartLifeTime.xyz+startPosition),worldRotation);\n\t else\n\t   finalPosition = rotationByQuaternions(u_PositionScale*a_ShapePositionStartLifeTime.xyz+startPosition,worldRotation);\n  #endif\n  \n  if(u_SimulationSpace==0)\n    finalPosition=finalPosition+a_SimulationWorldPostion;\n  else if(u_SimulationSpace==1) \n    finalPosition=finalPosition+u_WorldPosition;\n  \n  finalPosition+=0.5*gravityVelocity*age;\n \n  return  finalPosition;\n}\n\n\nvec4 computeParticleColor(in vec4 color,in float normalizedAge)\n{\n\t#ifdef COLOROVERLIFETIME\n\t  color*=getColorFromGradient(u_ColorOverLifeGradientAlphas,u_ColorOverLifeGradientColors,normalizedAge);\n\t#endif\n\t\n\t#ifdef RANDOMCOLOROVERLIFETIME\n\t  color*=mix(getColorFromGradient(u_ColorOverLifeGradientAlphas,u_ColorOverLifeGradientColors,normalizedAge),getColorFromGradient(u_MaxColorOverLifeGradientAlphas,u_MaxColorOverLifeGradientColors,normalizedAge),a_Random0.y);\n\t#endif\n\n    return color;\n}\n\nvec2 computeParticleSizeBillbard(in vec2 size,in float normalizedAge)\n{\n\t#ifdef SIZEOVERLIFETIMECURVE\n\t\tsize*=getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge);\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVES\n\t    size*=mix(getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMax,normalizedAge),a_Random0.z); \n\t#endif\n\t#ifdef SIZEOVERLIFETIMECURVESEPERATE\n\t\tsize*=vec2(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge));\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n\t    size*=vec2(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxX,normalizedAge),a_Random0.z)\n\t    ,mix(getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxY,normalizedAge),a_Random0.z));\n\t#endif\n\treturn size;\n}\n\n#ifdef RENDERMODE_MESH\nvec3 computeParticleSizeMesh(in vec3 size,in float normalizedAge)\n{\n\t#ifdef SIZEOVERLIFETIMECURVE\n\t\tsize*=getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge);\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVES\n\t    size*=mix(getCurValueFromGradientFloat(u_SOLSizeGradient,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMax,normalizedAge),a_Random0.z); \n\t#endif\n\t#ifdef SIZEOVERLIFETIMECURVESEPERATE\n\t\tsize*=vec3(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientZ,normalizedAge));\n\t#endif\n\t#ifdef SIZEOVERLIFETIMERANDOMCURVESSEPERATE\n\t    size*=vec3(mix(getCurValueFromGradientFloat(u_SOLSizeGradientX,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxX,normalizedAge),a_Random0.z)\n\t    ,mix(getCurValueFromGradientFloat(u_SOLSizeGradientY,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxY,normalizedAge),a_Random0.z)\n\t\t,mix(getCurValueFromGradientFloat(u_SOLSizeGradientZ,normalizedAge),getCurValueFromGradientFloat(u_SOLSizeGradientMaxZ,normalizedAge),a_Random0.z));\n\t#endif\n\treturn size;\n}\n#endif\n\nfloat computeParticleRotationFloat(in float rotation,in float age,in float normalizedAge)\n{ \n\t#ifdef ROTATIONOVERLIFETIME\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConst*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);\n\t\t#endif\n\t#endif\n\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConstSeprarate.z*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConstSeprarate.z,u_ROLAngularVelocityConstMaxSeprarate.z,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,normalizedAge),a_Random0.w));\n\t\t#endif\n\t#endif\n\treturn rotation;\n}\n\n#if defined(RENDERMODE_MESH)&&(defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE))\nvec3 computeParticleRotationVec3(in vec3 rotation,in float age,in float normalizedAge)\n{ \n\t#ifdef ROTATIONOVERLIFETIME\n\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tfloat ageRot=u_ROLAngularVelocityConst*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge);\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tfloat ageRot=mix(u_ROLAngularVelocityConst,u_ROLAngularVelocityConstMax,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradient,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMax,normalizedAge),a_Random0.w);\n\t\t#endif\n\t#endif\n\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t\t#ifdef ROTATIONOVERLIFETIMECONSTANT\n\t\t\tvec3 ageRot=u_ROLAngularVelocityConstSeprarate*age;\n\t        rotation+=ageRot;\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMECURVE\n\t\t\trotation+=vec3(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge));\n\t\t#endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCONSTANTS\n\t\t\tvec3 ageRot=mix(u_ROLAngularVelocityConstSeprarate,u_ROLAngularVelocityConstMaxSeprarate,a_Random0.w)*age;\n\t        rotation+=ageRot;\n\t    #endif\n\t\t#ifdef ROTATIONOVERLIFETIMERANDOMCURVES\n\t\t\trotation+=vec3(mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientX,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxX,normalizedAge),a_Random0.w)\n\t        ,mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientY,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxY,normalizedAge),a_Random0.w)\n\t        ,mix(getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientZ,normalizedAge),getTotalValueFromGradientFloat(u_ROLAngularVelocityGradientMaxZ,normalizedAge),a_Random0.w));\n\t\t#endif\n\t#endif\n\treturn rotation;\n}\n#endif\n\nvec2 computeParticleUV(in vec2 uv,in float normalizedAge)\n{ \n\t#ifdef TEXTURESHEETANIMATIONCURVE\n\t\tfloat cycleNormalizedAge=normalizedAge*u_TSACycles;\n\t\tfloat frame=getFrameFromGradient(u_TSAGradientUVs,cycleNormalizedAge-floor(cycleNormalizedAge));\n\t\tfloat totalULength=frame*u_TSASubUVLength.x;\n\t\tfloat floorTotalULength=floor(totalULength);\n\t    uv.x+=totalULength-floorTotalULength;\n\t\tuv.y+=floorTotalULength*u_TSASubUVLength.y;\n    #endif\n\t#ifdef TEXTURESHEETANIMATIONRANDOMCURVE\n\t\tfloat cycleNormalizedAge=normalizedAge*u_TSACycles;\n\t\tfloat uvNormalizedAge=cycleNormalizedAge-floor(cycleNormalizedAge);\n\t    float frame=floor(mix(getFrameFromGradient(u_TSAGradientUVs,uvNormalizedAge),getFrameFromGradient(u_TSAMaxGradientUVs,uvNormalizedAge),a_Random1.x));\n\t\tfloat totalULength=frame*u_TSASubUVLength.x;\n\t\tfloat floorTotalULength=floor(totalULength);\n\t    uv.x+=totalULength-floorTotalULength;\n\t\tuv.y+=floorTotalULength*u_TSASubUVLength.y;\n    #endif\n\treturn uv;\n}\n\nvoid main()\n{\n\tfloat age = u_CurrentTime - a_DirectionTime.w;\n\tfloat normalizedAge = age/a_ShapePositionStartLifeTime.w;\n\tvec3 lifeVelocity;\n\tif(normalizedAge<1.0){ \n\tvec3 startVelocity=a_DirectionTime.xyz*a_StartSpeed;\n\t#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t\tlifeVelocity= computeParticleLifeVelocity(normalizedAge);//计算粒子生命周期速度\n\t#endif \n\tvec3 gravityVelocity=u_Gravity*age;\n\t\n\tvec4 worldRotation;\n\tif(u_SimulationSpace==0)\n\t\tworldRotation=a_SimulationWorldRotation;\n\telse\n\t\tworldRotation=u_WorldRotation;\n\t\n\tvec3 center=computeParticlePosition(startVelocity, lifeVelocity, age, normalizedAge,gravityVelocity,worldRotation);//计算粒子位置\n   \n   #ifdef SPHERHBILLBOARD\n\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        vec3 cameraUpVector =normalize(u_CameraUp);//TODO:是否外面归一化\n        vec3 sideVector = normalize(cross(u_CameraDirection,cameraUpVector));\n        vec3 upVector = normalize(cross(sideVector,u_CameraDirection));\n\t    corner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n\t\t#if defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE)\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tvec3 rotation=vec3(a_StartRotation0.xy,computeParticleRotationFloat(a_StartRotation0.z,age,normalizedAge));\n\t\t\t\tcenter += u_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,rotation);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n\t\t\t\tfloat c = cos(rot);\n\t\t\t\tfloat s = sin(rot);\n\t\t\t\tmat2 rotation= mat2(c, -s, s, c);\n\t\t\t\tcorner=rotation*corner;\n\t\t\t\tcenter += u_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);\n\t\t\t}\n\t\t#else\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tcenter += u_SizeScale.xzy*rotationByEuler(corner.x*sideVector+corner.y*upVector,a_StartRotation0);\n\t\t\t}\n\t\t\telse{\n\t\t\t\tfloat c = cos(a_StartRotation0.x);\n\t\t\t\tfloat s = sin(a_StartRotation0.x);\n\t\t\t\tmat2 rotation= mat2(c, -s, s, c);\n\t\t\t\tcorner=rotation*corner;\n\t\t\t\tcenter += u_SizeScale.xzy*(corner.x*sideVector+corner.y*upVector);\n\t\t\t}\n\t\t#endif\n   #endif\n   \n   #ifdef STRETCHEDBILLBOARD\n\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n\tvec3 velocity;\n\t#if defined(VELOCITYOVERLIFETIMECONSTANT)||defined(VELOCITYOVERLIFETIMECURVE)||defined(VELOCITYOVERLIFETIMERANDOMCONSTANT)||defined(VELOCITYOVERLIFETIMERANDOMCURVE)\n\t    if(u_VOLSpaceType==0)\n\t\t  velocity=rotationByQuaternions(u_SizeScale*(startVelocity+lifeVelocity),worldRotation)+gravityVelocity;\n\t    else\n\t\t  velocity=rotationByQuaternions(u_SizeScale*startVelocity,worldRotation)+lifeVelocity+gravityVelocity;\n    #else\n\t    velocity= rotationByQuaternions(u_SizeScale*startVelocity,worldRotation)+gravityVelocity;\n    #endif\t\n\t\tvec3 cameraUpVector = normalize(velocity);\n\t\tvec3 direction = normalize(center-u_CameraPosition);\n        vec3 sideVector = normalize(cross(direction,normalize(velocity)));\n\t\t\n\t\tsideVector=u_SizeScale.xzy*sideVector;\n\t\tcameraUpVector=length(vec3(u_SizeScale.x,0.0,0.0))*cameraUpVector;\n\t\t\n\t    vec2 size=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n\t\t\n\t    const mat2 rotaionZHalfPI=mat2(0.0, -1.0, 1.0, 0.0);\n\t    corner=rotaionZHalfPI*corner;\n\t    corner.y=corner.y-abs(corner.y);\n\t\t\n\t    float speed=length(velocity);//TODO:\n\t    center +=sign(u_SizeScale.x)*(sign(u_StretchedBillboardLengthScale)*size.x*corner.x*sideVector+(speed*u_StretchedBillboardSpeedScale+size.y*u_StretchedBillboardLengthScale)*corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef HORIZONTALBILLBOARD\n\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        const vec3 cameraUpVector=vec3(0.0,0.0,1.0);\n\t    const vec3 sideVector = vec3(-1.0,0.0,0.0);\n\t\t\n\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n        float c = cos(rot);\n        float s = sin(rot);\n        mat2 rotation= mat2(c, -s, s, c);\n\t    corner=rotation*corner*cos(0.78539816339744830961566084581988);//TODO:临时缩小cos45,不确定U3D原因\n\t\tcorner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n        center +=u_SizeScale.xzy*(corner.x*sideVector+ corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef VERTICALBILLBOARD\n\t\tvec2 corner=a_CornerTextureCoordinate.xy;//Billboard模式z轴无效\n        const vec3 cameraUpVector =vec3(0.0,1.0,0.0);\n        vec3 sideVector = normalize(cross(u_CameraDirection,cameraUpVector));\n\t\t\n\t\tfloat rot = computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n        float c = cos(rot);\n        float s = sin(rot);\n        mat2 rotation= mat2(c, -s, s, c);\n\t    corner=rotation*corner*cos(0.78539816339744830961566084581988);//TODO:临时缩小cos45,不确定U3D原因\n\t\tcorner*=computeParticleSizeBillbard(a_StartSize.xy,normalizedAge);\n        center +=u_SizeScale.xzy*(corner.x*sideVector+ corner.y*cameraUpVector);\n   #endif\n   \n   #ifdef RENDERMODE_MESH\n\t    vec3 size=computeParticleSizeMesh(a_StartSize,normalizedAge);\n\t\t#if defined(ROTATIONOVERLIFETIME)||defined(ROTATIONOVERLIFETIMESEPERATE)\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tvec3 rotation=vec3(a_StartRotation0.xy,computeParticleRotationFloat(a_StartRotation0.z, age,normalizedAge));\n\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByEuler(a_MeshPosition*size,rotation),worldRotation);\n\t\t\t}\n\t\t\telse{\n\t\t\t\t#ifdef ROTATIONOVERLIFETIME\n\t\t\t\t\tfloat angle=computeParticleRotationFloat(a_StartRotation0.x, age,normalizedAge);\n\t\t\t\t\tif(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){\n\t\t\t\t\t\tcenter+= (rotationByQuaternions(rotationByAxis(u_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),angle),worldRotation));//已验证\n\t\t\t\t\t}\n\t\t\t\t\telse{\n\t\t\t\t\t\t#ifdef SHAPE\n\t\t\t\t\t\t\tcenter+= u_SizeScale.xzy*(rotationByQuaternions(rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),angle),worldRotation));\n\t\t\t\t\t\t#else\n\t\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\t\tcenter+=rotationByAxis(u_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle);//已验证\n\t\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\t\tcenter+=rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),angle),worldRotation);//已验证\n\t\t\t\t\t\t#endif\n\t\t\t\t\t}\n\t\t\t\t#endif\n\t\t\t\t#ifdef ROTATIONOVERLIFETIMESEPERATE\n\t\t\t\t\t//TODO:是否应合并if(u_ThreeDStartRotation)分支代码,待测试\n\t\t\t\t\tvec3 angle=computeParticleRotationVec3(vec3(0.0,0.0,-a_StartRotation0.x), age,normalizedAge);\n\t\t\t\t\tcenter+= (rotationByQuaternions(rotationByEuler(u_SizeScale*a_MeshPosition*size,vec3(angle.x,angle.y,angle.z)),worldRotation));//已验证\n\t\t\t\t#endif\t\t\n\t\t\t}\n\t\t#else\n\t\t\tif(u_ThreeDStartRotation){\n\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByEuler(a_MeshPosition*size,a_StartRotation0),worldRotation);//已验证\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif(a_ShapePositionStartLifeTime.x!=0.0||a_ShapePositionStartLifeTime.y!=0.0){\n\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\tcenter+= rotationByAxis(u_SizeScale*a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x);\n\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\tcenter+= (rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,normalize(cross(vec3(0.0,0.0,1.0),vec3(a_ShapePositionStartLifeTime.xy,0.0))),a_StartRotation0.x),worldRotation));//已验证\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\t#ifdef SHAPE\n\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\tcenter+= u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x);\n\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,-1.0,0.0),a_StartRotation0.x),worldRotation);\t\n\t\t\t\t\t#else\n\t\t\t\t\t\tif(u_SimulationSpace==0)\n\t\t\t\t\t\t\tcenter+= rotationByAxis(u_SizeScale*a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x);\n\t\t\t\t\t\telse if(u_SimulationSpace==1)\n\t\t\t\t\t\t\tcenter+= rotationByQuaternions(u_SizeScale*rotationByAxis(a_MeshPosition*size,vec3(0.0,0.0,-1.0),a_StartRotation0.x),worldRotation);//已验证\n\t\t\t\t\t#endif\n\t\t\t\t}\n\t\t\t}\n\t\t#endif\n\t\tv_MeshColor=a_MeshColor;\n   #endif\n   \n    gl_Position=u_Projection*u_View*vec4(center,1.0);\n    v_Color = computeParticleColor(a_StartColor, normalizedAge);\n\t#ifdef DIFFUSEMAP\n\t\t#if defined(SPHERHBILLBOARD)||defined(STRETCHEDBILLBOARD)||defined(HORIZONTALBILLBOARD)||defined(VERTICALBILLBOARD)\n\t\t\tv_TextureCoordinate =computeParticleUV(a_CornerTextureCoordinate.zw, normalizedAge);\n\t\t#endif\n\t\t#ifdef RENDERMODE_MESH\n\t\t\tv_TextureCoordinate =computeParticleUV(a_MeshTextureCoordinate, normalizedAge);\n\t\t#endif\n\t\t\n\t\t#ifdef TILINGOFFSET\n\t\t\tv_TextureCoordinate=vec2(v_TextureCoordinate.x,1.0-v_TextureCoordinate.y)*u_TilingOffset.xy+vec2(u_TilingOffset.z,-u_TilingOffset.w);//需要特殊处理\n\t\t\tv_TextureCoordinate=vec2(v_TextureCoordinate.x,1.0-v_TextureCoordinate.y);//需要特殊处理\n\t\t#endif\n\t#endif\n    v_Discard=0.0;\n\t  \n\t#ifdef FOG\n\t\tv_PositionWorld=center;\n\t#endif\n\t\n\tvec3 v_ViewDir=u_CameraPos-center;\n\tfloat viewLen = length(v_ViewDir)*u_Curved;\n\tgl_Position.y -= viewLen*viewLen*0.001;\n\n   }\n   else\n\t{\n\t\tv_Discard=1.0;\n\t}\n\n\tgl_Position=remapGLPositionZ(gl_Position);\n}\n\n',e="#ifdef HIGHPRECISION\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n\nvarying float v_Discard;\nvarying vec4 v_Color;\nvarying vec2 v_TextureCoordinate;\nuniform sampler2D u_texture;\nuniform vec4 u_Tintcolor;\n\n#ifdef RENDERMODE_MESH\n\tvarying vec4 v_MeshColor;\n#endif\n\n#ifdef FOG\n\tvarying vec3 v_PositionWorld;\n\tuniform vec3 u_CameraPosition;\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\t#ifdef ADDTIVEFOG\n\t#else\n\t\tuniform vec3 u_FogColor;\n\t#endif\n#endif\n\n\nvoid main()\n{\t\n\t#ifdef RENDERMODE_MESH\n\t\tgl_FragColor=v_MeshColor;\n\t#else\n\t\tgl_FragColor=vec4(1.0);\t\n\t#endif\n\t\t\n\t#ifdef DIFFUSEMAP\n\t\tif(v_Discard!=0.0)\n\t\t\tdiscard;\n\t\t#ifdef TINTCOLOR\n\t\t\tgl_FragColor*=texture2D(u_texture,v_TextureCoordinate)*u_Tintcolor*2.0*v_Color;\n\t\t#else\n\t\t\tgl_FragColor*=texture2D(u_texture,v_TextureCoordinate)*v_Color;\n\t\t#endif\n\t#else\n\t\t#ifdef TINTCOLOR\n\t\t\tgl_FragColor*=u_Tintcolor*2.0*v_Color;\n\t\t#else\n\t\t\tgl_FragColor*=v_Color;\n\t\t#endif\n\t#endif\n\t\n\t#ifdef FOG\n\t\t//vec3 toEye=u_CameraPosition-v_PositionWorld;\n\t\t//float toEyeLength=length(toEye);\n\t\t//toEye/=toEyeLength;\n\t\t//float lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\n\t\tfloat lerpFact=clamp((1.0/gl_FragCoord.w-u_FogStart)/u_FogRange,0.0,1.0);\n\n\t\t#ifdef ADDTIVEFOG\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,vec3(0.0,0.0,0.0),lerpFact);\n\t\t#else\n\t\t\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n\t\t#endif\n\t#endif\n}",s=We.add("PARTICLESHURIKEN"),a=new ti(i,n,Ca.shaderDefines,js.shaderDefines),s.addSubShader(a),a.addShaderPass(t,e,r),i={a_Position:0},n={u_TintColor:1,u_Exposure:1,u_Rotation:1,u_CubeTexture:1,u_MvpMatrix:3},t='#include "Lighting.glsl";\n\nattribute vec4 a_Position;\nuniform mat4 u_MvpMatrix;\nuniform float u_Rotation;\nvarying vec3 v_Texcoord;\n\n\nvec4 rotateAroundYInDegrees (vec4 vertex, float degrees)\n{\n\tfloat angle = degrees * 3.141593 / 180.0;\n\tfloat sina=sin(angle);\n\tfloat cosa=cos(angle);\n\tmat2 m = mat2(cosa, -sina, sina, cosa);\n\treturn vec4(m*vertex.xz, vertex.yw).xzyw;\n}\n\t\t\nvoid main()\n{\n\tvec4 position=rotateAroundYInDegrees(a_Position,u_Rotation);\n\tgl_Position = (u_MvpMatrix*position).xyww;\n\tv_Texcoord=vec3(-a_Position.x,a_Position.yz);//转换坐标系\n\tgl_Position=remapGLPositionZ(gl_Position);\n}\n',e="#ifdef HIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec3 v_Texcoord;\n\nuniform samplerCube u_CubeTexture;\nuniform float u_Exposure;\nuniform vec4 u_TintColor;\n\n\nvoid main()\n{\t\n\tvec3 color=textureCube(u_CubeTexture, v_Texcoord).rgb*u_TintColor.rgb*u_Exposure*2.0;\n\tgl_FragColor=vec4(color,1.0);\n}\n\n",s=We.add("SkyBox"),a=new ti(i,n),s.addSubShader(a),a.addShaderPass(t,e),i={a_Position:0},n={u_SunSize:1,u_SunSizeConvergence:1,u_AtmosphereThickness:1,u_SkyTint:1,u_GroundTint:1,u_Exposure:1,u_MvpMatrix:3,"u_DirectionLight.Direction":4,"u_DirectionLight.Color":4},t="#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include \"Lighting.glsl\";\n\n#define OUTER_RADIUS 1.025\n#define RAYLEIGH (mix(0.0, 0.0025, pow(u_AtmosphereThickness,2.5)))// Rayleigh constant Rayleigh为夜空光和极光亮度单位\n#define MIE 0.0010             // Mie constant 米氏散射\n#define SUN_BRIGHTNESS 20.0    // Sun brightness\n#define MAX_SCATTER 50.0 // Maximum scattering value, to prevent math overflows on Adrenos\n\nconst float SKY_GROUND_THRESHOLD = 0.02;\nconst float outerRadius = OUTER_RADIUS;\nconst float outerRadius2 = OUTER_RADIUS*OUTER_RADIUS;\nconst float innerRadius = 1.0;\nconst float innerRadius2 = 1.0;\nconst float cameraHeight = 0.0001;\n\nconst float HDSundiskIntensityFactor = 15.0;\nconst float simpleSundiskIntensityFactor = 27.0;\n\nconst float sunScale = 400.0 * SUN_BRIGHTNESS;\nconst float kmESun = MIE * SUN_BRIGHTNESS;\nconst float km4PI = MIE * 4.0 * 3.14159265;\nconst float scale = 1.0 / (OUTER_RADIUS - 1.0);\nconst float scaleDepth = 0.25;\nconst float scaleOverScaleDepth = (1.0 / (OUTER_RADIUS - 1.0)) / 0.25;\nconst float samples = 2.0; // THIS IS UNROLLED MANUALLY, DON'T TOUCH\n\n// RGB wavelengths        .35 (.62=158), .43 (.68=174), .525 (.75=190)\nconst vec3 c_DefaultScatteringWavelength = vec3(0.65, 0.57, 0.475);//默认散射波长\nconst vec3 c_VariableRangeForScatteringWavelength = vec3(0.15, 0.15, 0.15);//散射播放的可变范围\n\nattribute vec4 a_Position;\n\nuniform mat4 u_MvpMatrix;\nuniform vec3 u_SkyTint;\nuniform vec3 u_GroundTint;\nuniform float u_Exposure;\nuniform float u_AtmosphereThickness;\nuniform DirectionLight u_DirectionLight;\n\nvarying vec3 v_GroundColor;\nvarying vec3 v_SkyColor;\n\n#ifdef SUN_HIGH_QUALITY\n\tvarying vec3 v_Vertex;\n#elif defined(SUN_SIMPLE)\n\tvarying vec3 v_RayDir;\n#else\n\tvarying float v_SkyGroundFactor;\n#endif\n\n#if defined(SUN_HIGH_QUALITY)||defined(SUN_SIMPLE)\n\tvarying vec3 v_SunColor;\n#endif\n\n// Calculates the Rayleigh phase function\nfloat getRayleighPhase(vec3 light, vec3 ray) \n{\n\tfloat eyeCos = dot(light, ray);\n\treturn 0.75 + 0.75*eyeCos*eyeCos;\n}\n\nfloat scaleAngle(float inCos)\n{\n\tfloat x = 1.0 - inCos;\n\treturn 0.25 * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\n\nvoid main () {\n\tgl_Position = (u_MvpMatrix*a_Position).xyww;\n\n\tvec3 skyTintInGammaSpace = u_SkyTint;//支持非GAMMA空间后要调整\n\tvec3 scatteringWavelength = mix(c_DefaultScatteringWavelength-c_VariableRangeForScatteringWavelength,c_DefaultScatteringWavelength+c_VariableRangeForScatteringWavelength,vec3(1.0) - skyTintInGammaSpace); // using Tint in sRGB+ gamma allows for more visually linear interpolation and to keep (0.5) at (128, gray in sRGB) point\n\tvec3 invWavelength = 1.0 / pow(scatteringWavelength, vec3(4.0));\n\n\tfloat krESun = RAYLEIGH * SUN_BRIGHTNESS;\n\tfloat kr4PI = RAYLEIGH * 4.0 * 3.14159265;\n\n\tvec3 cameraPos = vec3(0.0,innerRadius + cameraHeight,0.0); // The camera's current position\n\n\t// Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n\tvec3 eyeRay = normalize(a_Position.xyz);\n\n\tfloat far = 0.0;\n\tvec3 cIn, cOut;\n\tif (eyeRay.y >= 0.0) {// Sky\n\t\t// Calculate the length of the \"atmosphere\"\n\t\tfar = sqrt(outerRadius2 + innerRadius2 * eyeRay.y * eyeRay.y - innerRadius2) - innerRadius * eyeRay.y;\n\n\t\t// Calculate the ray's starting position, then calculate its scattering offset\n\t\tfloat height = innerRadius + cameraHeight;\n\t\tfloat depth = exp(scaleOverScaleDepth * -cameraHeight);\n\t\tfloat startAngle = dot(eyeRay, cameraPos) / height;\n\t\tfloat startOffset = depth*scaleAngle(startAngle);\n\n\t\t// Initialize the scattering loop variables\n\t\tfloat sampleLength = far / samples;\n\t\tfloat scaledLength = sampleLength * scale;\n\t\tvec3 sampleRay = eyeRay * sampleLength;\n\t\tvec3 samplePoint = cameraPos + sampleRay * 0.5;\n\n\t\tvec3 frontColor = vec3(0.0);\n\t\t//unrolling this manually to avoid some platform for loop slow\n\t\t{\n\t\t\tfloat height = length(samplePoint);\n\t\t\tfloat depth = exp(scaleOverScaleDepth * (innerRadius - height));\n\t\t\tfloat lightAngle = dot(-u_DirectionLight.Direction, samplePoint) / height;\n\t\t\tfloat cameraAngle = dot(eyeRay, samplePoint) / height;\n\t\t\tfloat scatter = (startOffset + depth*(scaleAngle(lightAngle) - scaleAngle(cameraAngle)));\n\t\t\tvec3 attenuate = exp(-clamp(scatter, 0.0, MAX_SCATTER) * (invWavelength * kr4PI + km4PI));\n\n\t\t\tfrontColor += attenuate * (depth * scaledLength);\n\t\t\tsamplePoint += sampleRay;\n\t\t}\n\t\t{\n\t\t\tfloat height = length(samplePoint);\n\t\t\tfloat depth = exp(scaleOverScaleDepth * (innerRadius - height));\n\t\t\tfloat lightAngle = dot(-u_DirectionLight.Direction, samplePoint) / height;\n\t\t\tfloat cameraAngle = dot(eyeRay, samplePoint) / height;\n\t\t\tfloat scatter = (startOffset + depth*(scaleAngle(lightAngle) - scaleAngle(cameraAngle)));\n\t\t\tvec3 attenuate = exp(-clamp(scatter, 0.0, MAX_SCATTER) * (invWavelength * kr4PI + km4PI));\n\n\t\t\tfrontColor += attenuate * (depth * scaledLength);\n\t\t\tsamplePoint += sampleRay;\n\t\t}\n\n\t\t// Finally, scale the Mie and Rayleigh colors and set up the varying variables for the pixel shader\n\t\tcIn = frontColor * (invWavelength * krESun);\n\t\tcOut = frontColor * kmESun;\n\t} else {// Ground\n\t\tfar = (-cameraHeight) / (min(-0.001, eyeRay.y));\n\t\tvec3 pos = cameraPos + far * eyeRay;\n\n\t\t// Calculate the ray's starting position, then calculate its scattering offset\n\t\tfloat depth = exp((-cameraHeight) * (1.0/scaleDepth));\n\t\tfloat cameraAngle = dot(-eyeRay, pos);\n\t\tfloat lightAngle = dot(-u_DirectionLight.Direction, pos);\n\t\tfloat cameraScale = scaleAngle(cameraAngle);\n\t\tfloat lightScale = scaleAngle(lightAngle);\n\t\tfloat cameraOffset = depth*cameraScale;\n\t\tfloat temp = lightScale + cameraScale;\n\n\t\t// Initialize the scattering loop variables\n\t\tfloat sampleLength = far / samples;\n\t\tfloat scaledLength = sampleLength * scale;\n\t\tvec3 sampleRay = eyeRay * sampleLength;\n\t\tvec3 samplePoint = cameraPos + sampleRay * 0.5;\n\n\t\t// Now loop through the sample rays\n\t\tvec3 frontColor = vec3(0.0, 0.0, 0.0);\n\t\tvec3 attenuate;\n\n\t\t// Loop removed because we kept hitting SM2.0 temp variable limits. Doesn't affect the image too much.\n\t\t{\n\t\t\tfloat height = length(samplePoint);\n\t\t\tfloat depth = exp(scaleOverScaleDepth * (innerRadius - height));\n\t\t\tfloat scatter = depth*temp - cameraOffset;\n\t\t\tattenuate = exp(-clamp(scatter, 0.0, MAX_SCATTER) * (invWavelength * kr4PI + km4PI));\n\t\t\tfrontColor += attenuate * (depth * scaledLength);\n\t\t\tsamplePoint += sampleRay;\n\t\t}\n\n\t\tcIn = frontColor * (invWavelength * krESun + kmESun);\n\t\tcOut = clamp(attenuate, 0.0, 1.0);\n\t}\n\n\t#ifdef SUN_HIGH_QUALITY\n\t\tv_Vertex = -a_Position.xyz;\n\t#elif defined(SUN_SIMPLE) \n\t\tv_RayDir = -eyeRay;\n\t#else\n\t\tv_SkyGroundFactor = -eyeRay.y / SKY_GROUND_THRESHOLD;\n\t#endif\n\n\t// if we want to calculate color in vprog:\n\t// in case of linear: multiply by _Exposure in here (even in case of lerp it will be common multiplier, so we can skip mul in fshader)\n\tv_GroundColor = u_Exposure * (cIn + u_GroundTint*u_GroundTint * cOut);//u_GroundColor*u_GroundColor is gamma space convert to linear space\n\tv_SkyColor    = u_Exposure * (cIn * getRayleighPhase(-u_DirectionLight.Direction, -eyeRay));\n\n\t\n\t// The sun should have a stable intensity in its course in the sky. Moreover it should match the highlight of a purely specular material.\n\t// This matching was done using the Unity3D standard shader BRDF1 on the 5/31/2017\n\t// Finally we want the sun to be always bright even in LDR thus the normalization of the lightColor for low intensity.\n\tfloat lightColorIntensity = clamp(length(u_DirectionLight.Color), 0.25, 1.0);\n\n\t#ifdef SUN_HIGH_QUALITY \n\t\tv_SunColor = HDSundiskIntensityFactor * clamp(cOut,0.0,1.0) * u_DirectionLight.Color / lightColorIntensity;\n\t#elif defined(SUN_SIMPLE) \n\t\tv_SunColor = simpleSundiskIntensityFactor * clamp(cOut * sunScale,0.0,1.0) * u_DirectionLight.Color / lightColorIntensity;\n\t#endif\n\tgl_Position=remapGLPositionZ(gl_Position);\n}\n",e='#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Lighting.glsl";\n\nconst float MIE_G = -0.990;\nconst float MIE_G2 = 0.9801;\nconst float SKY_GROUND_THRESHOLD = 0.02;\n\nuniform float u_SunSize;\nuniform float u_SunSizeConvergence;\nuniform DirectionLight u_DirectionLight;\n\n\nvarying vec3 v_GroundColor;\nvarying vec3 v_SkyColor;\n\n\n#ifdef SUN_HIGH_QUALITY\n\tvarying vec3 v_Vertex;\n#elif defined(SUN_SIMPLE)\n\tvarying vec3 v_RayDir;\n#else\n\tvarying float v_SkyGroundFactor;\n#endif\n\n#if defined(SUN_HIGH_QUALITY)||defined(SUN_SIMPLE)\n\tvarying vec3 v_SunColor;\n#endif\n\n// Calculates the Mie phase function\nfloat getMiePhase(float eyeCos, float eyeCos2) {\n\tfloat temp = 1.0 + MIE_G2 - 2.0 * MIE_G * eyeCos;\n\ttemp = pow(temp, pow(u_SunSize,0.65) * 10.0);\n\ttemp = max(temp,1.0e-4); // prevent division by zero, esp. in half precision\n\ttemp = 1.5 * ((1.0 - MIE_G2) / (2.0 + MIE_G2)) * (1.0 + eyeCos2) / temp;\n\treturn temp;\n}\n\n// Calculates the sun shape\nfloat calcSunAttenuation(vec3 lightPos, vec3 ray) {\n\t#ifdef SUN_HIGH_QUALITY\n\t\tfloat focusedEyeCos = pow(clamp(dot(lightPos, ray),0.0,1.0), u_SunSizeConvergence);\n\t\treturn getMiePhase(-focusedEyeCos, focusedEyeCos * focusedEyeCos);\n\t#else //SUN_SIMPLE\n\t\tvec3 delta = lightPos - ray;\n\t\tfloat dist = length(delta);\n\t\tfloat spot = 1.0 - smoothstep(0.0, u_SunSize, dist);\n\t\treturn spot * spot;\n\t#endif\n}\n\nvoid main() {\n\t// if y > 1 [eyeRay.y < -SKY_GROUND_THRESHOLD] - ground\n\t// if y >= 0 and < 1 [eyeRay.y <= 0 and > -SKY_GROUND_THRESHOLD] - horizon\n\t// if y < 0 [eyeRay.y > 0] - sky\n\tvec3 col = vec3(0.0, 0.0, 0.0);\n\n\t#ifdef SUN_HIGH_QUALITY\n\t\tvec3 ray = normalize(v_Vertex);\n\t\tfloat y = ray.y / SKY_GROUND_THRESHOLD;\n\t#elif defined(SUN_SIMPLE) \n\t\tvec3 ray = v_RayDir;\n\t\tfloat y = ray.y / SKY_GROUND_THRESHOLD;\t\n\t#else\n\t\tfloat y = v_SkyGroundFactor;\n\t#endif\n\n\t// if we did precalculate color in vprog: just do lerp between them\n\tcol = mix(v_SkyColor, v_GroundColor, clamp(y,0.0,1.0));\n\n\t#if defined(SUN_HIGH_QUALITY)||defined(SUN_SIMPLE)\n\t\tif (y < 0.0)\n\t\t\tcol += v_SunColor * calcSunAttenuation(-u_DirectionLight.Direction, -ray);\n\t#endif\n\n\tcol = sqrt(col);//linear space convert to gamma space\n\tgl_FragColor=vec4(col,1.0);\n}\n\n',s=We.add("SkyBoxProcedural"),a=new ti(i,n,null,Fs.shaderDefines),s.addSubShader(a),a.addShaderPass(t,e),i={a_Position:0,a_Normal:3,a_Texcoord0:2},n={u_MvpMatrix:2,u_WorldMat:2,u_CameraPos:3,u_LightmapScaleOffset:2,u_LightMap:2,u_SplatAlphaTexture:1,u_DiffuseTexture1:1,u_DiffuseTexture2:1,u_DiffuseTexture3:1,u_DiffuseTexture4:1,u_DiffuseTexture5:1,u_DiffuseScaleOffset1:1,u_DiffuseScaleOffset2:1,u_DiffuseScaleOffset3:1,u_DiffuseScaleOffset4:1,u_DiffuseScaleOffset5:1,u_FogStart:4,u_FogRange:4,u_FogColor:4,"u_DirectionLight.Direction":4,"u_DirectionLight.Color":4,"u_PointLight.Position":4,"u_PointLight.Range":4,"u_PointLight.Attenuation":4,"u_PointLight.Color":4,"u_SpotLight.Position":4,"u_SpotLight.Direction":4,"u_SpotLight.Range":4,"u_SpotLight.Spot":4,"u_SpotLight.Color":4,u_AmbientColor:4,u_shadowMap1:4,u_shadowMap2:4,u_shadowMap3:4,u_shadowPSSMDistance:4,u_lightShadowVP:4,u_shadowPCFoffset:4},r={s_Cull:0,s_Blend:1,s_BlendSrc:2,s_BlendDst:3,s_DepthTest:12,s_DepthWrite:13},t='#include "Lighting.glsl";\n\nattribute vec4 a_Position;\nattribute vec2 a_Texcoord0;\n\nuniform mat4 u_MvpMatrix;\n\nvarying vec2 v_Texcoord0;\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(LIGHTMAP)\n\tattribute vec3 a_Normal;\n\tvarying vec3 v_Normal;\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n\tuniform mat4 u_WorldMat;\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#ifdef LIGHTMAP\n\tvarying vec2 v_LightMapUV;\n\tuniform vec4 u_LightmapScaleOffset;\n#endif\n\n#ifdef RECEIVESHADOW\n\tvarying float v_posViewZ;\n\t#ifdef SHADOWMAP_PSSM1 \n\t\tvarying vec4 v_lightMVPPos;\n\t\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n#endif\n\nvoid main()\n{\n\tgl_Position = u_MvpMatrix * a_Position;\n  \n\tv_Texcoord0 = a_Texcoord0;\n  \n\t#ifdef LIGHTMAP\n\t\tv_LightMapUV = vec2(a_Texcoord0.x, 1.0 - a_Texcoord0.y) * u_LightmapScaleOffset.xy + u_LightmapScaleOffset.zw;\n\t\tv_LightMapUV.y = 1.0 - v_LightMapUV.y;\n\t#endif\n  \n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t\tv_Normal = a_Normal;\n\t#endif\n\n\t#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)||(defined(RECEIVESHADOW)&&defined(SHADOWMAP_PSSM1))\n\t\tv_PositionWorld=(u_WorldMat*a_Position).xyz;\n\t#endif\n\n\t#ifdef RECEIVESHADOW\n\t\tv_posViewZ = gl_Position.w;\n\t\t#ifdef SHADOWMAP_PSSM1\n\t\t\tv_lightMVPPos = u_lightShadowVP[0] * vec4(v_PositionWorld,1.0);\n\t\t#endif\n\t#endif\n\tgl_Position=remapGLPositionZ(gl_Position);\n}',e='#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Lighting.glsl";\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)\n\tuniform vec3 u_CameraPos;\n\tvarying vec3 v_Normal;\n\tvarying vec3 v_PositionWorld;\n#endif\n\n#ifdef FOG\n\tuniform float u_FogStart;\n\tuniform float u_FogRange;\n\tuniform vec3 u_FogColor;\n#endif\n\n\n#ifdef DIRECTIONLIGHT\n\tuniform DirectionLight u_DirectionLight;\n#endif\n\n#ifdef POINTLIGHT\n\tuniform PointLight u_PointLight;\n#endif\n\n#ifdef SPOTLIGHT\n\tuniform SpotLight u_SpotLight;\n#endif\n\n#include "ShadowHelper.glsl"\n#ifdef RECEIVESHADOW\n\t#if defined(SHADOWMAP_PSSM2)||defined(SHADOWMAP_PSSM3)\n\tuniform mat4 u_lightShadowVP[4];\n\t#endif\n\t#ifdef SHADOWMAP_PSSM1 \n\tvarying vec4 v_lightMVPPos;\n\t#endif\n#endif\nvarying float v_posViewZ;\n\nuniform vec3 u_AmbientColor;\n\nuniform sampler2D u_SplatAlphaTexture;\n\nuniform sampler2D u_DiffuseTexture1;\nuniform sampler2D u_DiffuseTexture2;\nuniform sampler2D u_DiffuseTexture3;\nuniform sampler2D u_DiffuseTexture4;\nuniform sampler2D u_DiffuseTexture5;\n\nuniform vec4 u_DiffuseScaleOffset1;\nuniform vec4 u_DiffuseScaleOffset2;\nuniform vec4 u_DiffuseScaleOffset3;\nuniform vec4 u_DiffuseScaleOffset4;\nuniform vec4 u_DiffuseScaleOffset5;\n\nvarying vec2 v_Texcoord0;\n\n#ifdef LIGHTMAP\n\tuniform sampler2D u_LightMap;\n\tvarying vec2 v_LightMapUV;\n#endif\n\nvoid main()\n{\n\tvec4 splatAlpha = vec4(1.0);\n\t#ifdef ExtendTerrain_DETAIL_NUM1\n\t\tsplatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r;\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM2\n\t\tsplatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r + color2.xyz * (1.0 - splatAlpha.r);\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM3\n\t\tsplatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * (1.0 - splatAlpha.r - splatAlpha.g);\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM4\n\t\tsplatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n\t\tvec4 color4 = texture2D(u_DiffuseTexture4, v_Texcoord0 * u_DiffuseScaleOffset4.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * splatAlpha.b + color4.xyz * (1.0 - splatAlpha.r - splatAlpha.g - splatAlpha.b);\n\t#endif\n\t#ifdef ExtendTerrain_DETAIL_NUM5\n\t\tsplatAlpha = texture2D(u_SplatAlphaTexture, v_Texcoord0);\n\t\tvec4 color1 = texture2D(u_DiffuseTexture1, v_Texcoord0 * u_DiffuseScaleOffset1.xy);\n\t\tvec4 color2 = texture2D(u_DiffuseTexture2, v_Texcoord0 * u_DiffuseScaleOffset2.xy);\n\t\tvec4 color3 = texture2D(u_DiffuseTexture3, v_Texcoord0 * u_DiffuseScaleOffset3.xy);\n\t\tvec4 color4 = texture2D(u_DiffuseTexture4, v_Texcoord0 * u_DiffuseScaleOffset4.xy);\n\t\tvec4 color5 = texture2D(u_DiffuseTexture5, v_Texcoord0 * u_DiffuseScaleOffset5.xy);\n\t\tgl_FragColor.xyz = color1.xyz * splatAlpha.r  + color2.xyz * splatAlpha.g + color3.xyz * splatAlpha.b + color4.xyz * splatAlpha.a + color5.xyz * (1.0 - splatAlpha.r - splatAlpha.g - splatAlpha.b - splatAlpha.a);\n\t#endif\n\t\tgl_FragColor.w = splatAlpha.a;\n\t\t\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n    vec3 normal = v_Normal;\n\tvec3 dif, spe;\n#endif\n\nvec3 diffuse = vec3(0.0);\nvec3 specular= vec3(0.0);\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)||defined(FOG)\n\tvec3 toEye;\n\t#ifdef FOG\n\t\ttoEye=u_CameraPos-v_PositionWorld;\n\t\tfloat toEyeLength=length(toEye);\n\t\ttoEye/=toEyeLength;\n\t#else\n\t\ttoEye=normalize(u_CameraPos-v_PositionWorld);\n\t#endif\n#endif\n\n#ifdef DIRECTIONLIGHT\n\tLayaAirBlinnPhongDiectionLight(vec3(0.0), 1.0, normal, vec3(1.0), toEye,u_DirectionLight, dif, spe);\n\tdiffuse+=dif;\n\tspecular+=spe;\n#endif\n \n#ifdef POINTLIGHT\n\tLayaAirBlinnPhongPointLight(v_PositionWorld, vec3(0.0), 1.0, normal, vec3(1.0), toEye, u_PointLight, dif, spe);\n\tdiffuse+=dif;\n\tspecular+=spe;\n#endif\n\n#ifdef SPOTLIGHT\n\tLayaAirBlinnPhongSpotLight(v_PositionWorld, vec3(0.0), 1.0, normal, vec3(1.0), toEye, u_SpotLight, dif, spe);\n\tdiffuse+=dif;\n\tspecular+=spe;\n#endif\n\nvec3 globalDiffuse = u_AmbientColor;\n#ifdef LIGHTMAP\n\tglobalDiffuse += DecodeLightmap(texture2D(u_LightMap, v_LightMapUV));\n#endif\n\n#ifdef RECEIVESHADOW\n\tfloat shadowValue = 1.0;\n\t#ifdef SHADOWMAP_PSSM3\n\t\tshadowValue = getShadowPSSM3( u_shadowMap1,u_shadowMap2,u_shadowMap3,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif\n\t#ifdef SHADOWMAP_PSSM2\n\t\tshadowValue = getShadowPSSM2( u_shadowMap1,u_shadowMap2,u_lightShadowVP,u_shadowPSSMDistance,u_shadowPCFoffset,v_PositionWorld,v_posViewZ,0.001);\n\t#endif \n\t#ifdef SHADOWMAP_PSSM1\n\t\tshadowValue = getShadowPSSM1( u_shadowMap1,v_lightMVPPos,u_shadowPSSMDistance,u_shadowPCFoffset,v_posViewZ,0.001);\n\t#endif\n\tgl_FragColor = vec4(gl_FragColor.rgb * (globalDiffuse + diffuse) * shadowValue, gl_FragColor.a);\n#else\n\tgl_FragColor = vec4(gl_FragColor.rgb * (globalDiffuse + diffuse), gl_FragColor.a);\n#endif\n\n#if defined(DIRECTIONLIGHT)||defined(POINTLIGHT)||defined(SPOTLIGHT)\n\t#ifdef RECEIVESHADOW\n\t\tgl_FragColor.rgb += specular * shadowValue;\n\t#else\n\t\tgl_FragColor.rgb += specular;\n\t#endif\n#endif\n\n#ifdef FOG\n\tfloat lerpFact=clamp((toEyeLength-u_FogStart)/u_FogRange,0.0,1.0);\n\tgl_FragColor.rgb=mix(gl_FragColor.rgb,u_FogColor,lerpFact);\n#endif\n}\n\n\n\n\n\n',s=We.add("ExtendTerrain"),a=new ti(i,n,Is.shaderDefines,Ks.shaderDefines),s.addSubShader(a),a.addShaderPass(t,e,r),i={a_Position:0,a_OffsetVector:1,a_Texcoord0X:4,a_Texcoord0Y:3,a_BirthTime:2},n={u_MvpMatrix:2,u_View:3,u_Projection:3,u_TilingOffset:1,u_MainTexture:1,u_MainColor:1,u_CurTime:2,u_LifeTime:2,u_WidthCurve:2,u_WidthCurveKeyLength:2,u_GradientColorkey:2,u_GradientAlphakey:2,u_WorldMat:2,u_CameraPos:3,u_Curved:3},r={s_Cull:0,s_Blend:1,s_BlendSrc:2,s_BlendDst:3,s_DepthTest:12,s_DepthWrite:13},t='#include "Lighting.glsl";\n\nattribute vec3 a_Position;\nattribute vec3 a_OffsetVector;\nattribute vec4 a_Color;\nattribute float a_Texcoord0X;\nattribute float a_Texcoord0Y;\nattribute float a_BirthTime;\n\nuniform mat4 u_View;\nuniform mat4 u_Projection;\n\nuniform vec4 u_TilingOffset;\n\nuniform float u_CurTime;\nuniform float u_LifeTime;\nuniform vec4 u_WidthCurve[10];\nuniform int u_WidthCurveKeyLength;\n\nuniform vec3 u_CameraPos;\nuniform mat4 u_WorldMat;\nuniform float u_Curved;\n\nuniform vec4 u_GradientColorkey[10];\nuniform vec2 u_GradientAlphakey[10];\n\nvarying vec2 v_Texcoord0;\nvarying vec4 v_Color;\n\nfloat hermiteInterpolate(float t, float outTangent, float inTangent, float duration, float value1, float value2)\n{\n\tfloat t2 = t * t;\n\tfloat t3 = t2 * t;\n\tfloat a = 2.0 * t3 - 3.0 * t2 + 1.0;\n\tfloat b = t3 - 2.0 * t2 + t;\n\tfloat c = t3 - t2;\n\tfloat d = -2.0 * t3 + 3.0 * t2;\n\treturn a * value1 + b * outTangent * duration + c * inTangent * duration + d * value2;\n}\n\nfloat getCurWidth(in float normalizeTime)\n{\n\tfloat width;\n\tif(normalizeTime == 0.0){\n\t\twidth=u_WidthCurve[0].w;\n\t}\n\telse if(normalizeTime >= 1.0){\n\t\twidth=u_WidthCurve[u_WidthCurveKeyLength - 1].w;\n\t}\n\telse{\n\t\tfor(int i = 0; i < 10; i ++ )\n\t\t{\n\t\t\tif(normalizeTime == u_WidthCurve[i].x){\n\t\t\t\twidth=u_WidthCurve[i].w;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\tvec4 lastFrame = u_WidthCurve[i];\n\t\t\tvec4 nextFrame = u_WidthCurve[i + 1];\n\t\t\tif(normalizeTime > lastFrame.x && normalizeTime < nextFrame.x)\n\t\t\t{\n\t\t\t\tfloat duration = nextFrame.x - lastFrame.x;\n\t\t\t\tfloat t = (normalizeTime - lastFrame.x) / duration;\n\t\t\t\tfloat outTangent = lastFrame.z;\n\t\t\t\tfloat inTangent = nextFrame.y;\n\t\t\t\tfloat value1 = lastFrame.w;\n\t\t\t\tfloat value2 = nextFrame.w;\n\t\t\t\twidth=hermiteInterpolate(t, outTangent, inTangent, duration, value1, value2);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\treturn width;\n}\t\n\nvec4 getColorFromGradientByBlend(in vec4 gradientColors[10], in vec2 gradientAlphas[10], in float normalizeTime)\n{\n\tvec4 color;\n\tfor(int i = 1; i < 10; i++)\n\t{\n\t\tvec4 gradientColor = gradientColors[i];\n\t\tfloat colorKey = gradientColor.x;\n\t\tif(colorKey >= normalizeTime)\n\t\t{\n\t\t\tvec4 lastGradientColor = gradientColors[i-1];\n\t\t\tfloat lastColorKey = lastGradientColor.x;\n\t\t\tfloat age = (normalizeTime - lastColorKey) / (colorKey - lastColorKey);\n\t\t\tcolor.rgb = mix(gradientColors[i-1].yzw, gradientColor.yzw, age);\n\t\t\tbreak;\n\t\t}\n\t}\n\tfor(int i = 1; i < 10; i++)\n\t{\n\t\tvec2 gradientAlpha = gradientAlphas[i];\n\t\tfloat alphaKey = gradientAlpha.x;\n\t\tif(alphaKey >= normalizeTime)\n\t\t{\n\t\t\tvec2 lastGradientAlpha = gradientAlphas[i-1];\n\t\t\tfloat lastAlphaKey = lastGradientAlpha.x;\n\t\t\tfloat age = (normalizeTime - lastAlphaKey) / (alphaKey - lastAlphaKey);\n\t\t\tcolor.a = mix(lastGradientAlpha.y, gradientAlpha.y, age);\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn color;\n}\n\nvec4 getColorFromGradientByFixed(in vec4 gradientColors[10], in vec2 gradientAlphas[10], in float normalizeTime)\n{\n\tvec4 color;\n\tfor(int i = 1; i < 10; i++)\n\t{\n\t\tvec4 gradientColor = gradientColors[i];\n\t\tif(gradientColor.w >= normalizeTime)\n\t\t{\n\t\t\tcolor.rgb = gradientColor.xyz;\n\t\t\tbreak;\n\t\t}\n\t}\n\tfor(int i = 1; i < 10; i++)\n\t{\n\t\tvec2 gradientAlpha = gradientAlphas[i];\n\t\tif(gradientAlpha.y >= normalizeTime)\n\t\t{\n\t\t\tcolor.a = gradientAlpha.x;\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn color;\n}\n\nvoid main()\n{\n\tfloat normalizeTime = (u_CurTime - a_BirthTime) / u_LifeTime;\n\t\n\t#ifdef TILINGOFFSET\n\t\tv_Texcoord0 = vec2(a_Texcoord0X, 1.0 - a_Texcoord0Y) * u_TilingOffset.xy + u_TilingOffset.zw;\n\t#else\n\t\tv_Texcoord0 = vec2(a_Texcoord0X, a_Texcoord0Y);\n\t#endif\n\t\n\t#ifdef GRADIENTMODE_BLEND\n\t\tv_Color = getColorFromGradientByBlend(u_GradientColorkey, u_GradientAlphakey, normalizeTime);\n\t#else\n\t\tv_Color = getColorFromGradientByFixed(u_GradientColorkey, u_GradientAlphakey, normalizeTime);\n\t#endif\n\n\tgl_Position = u_Projection * u_View * vec4(a_Position + a_OffsetVector * getCurWidth(normalizeTime),1.0);\n\t\n\tvec3 v_PositionWorld=a_Position;//(u_WorldMat*a_Position).xyz;\n\tvec3 v_ViewDir=u_CameraPos-v_PositionWorld;\n\tfloat viewLen = length(v_ViewDir)*u_Curved;\n\tgl_Position.y -= viewLen*viewLen*0.001;\n\n\tgl_Position=remapGLPositionZ(gl_Position);\n}\n',e="#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nuniform sampler2D u_MainTexture;\nuniform vec4 u_MainColor;\n\nvarying vec2 v_Texcoord0;\nvarying vec4 v_Color;\n\nvoid main()\n{\t\n\tvec4 color = 2.0 * u_MainColor * v_Color;\n\t#ifdef MAINTEXTURE\n\t\tvec4 mainTextureColor = texture2D(u_MainTexture, v_Texcoord0);\n\t\tcolor *= mainTextureColor;\n\t#endif\n\tgl_FragColor = color;\n}\n\n",s=We.add("Trail"),a=new ti(i,n,xa.shaderDefines,Hs.shaderDefines),s.addSubShader(a),a.addShaderPass(t,e,r),i={a_Position:0,a_Normal:3,a_Tangent0:4},n={u_MvpMatrix:2,u_WorldMat:2,u_CameraPos:3,u_Time:4,u_MainTexture:1,u_NormalTexture:1,u_HorizonColor:1,u_WaveScale:1,u_WaveSpeed:1},t='#include "Lighting.glsl";\n\nattribute vec4 a_Position;\nattribute vec3 a_Normal;\nattribute vec4 a_Tangent0;\n\nuniform mat4 u_MvpMatrix;\nuniform mat4 u_WorldMat;\nuniform vec3 u_CameraPos;\nuniform float u_WaveScale;\nuniform vec4 u_WaveSpeed;\nuniform float u_Time;\n\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec2 v_Texcoord0;\nvarying vec2 v_Texcoord1;\n\nvoid main()\n{\n\tvec4 positionWorld = u_WorldMat * a_Position;\n\tvec4 position = u_MvpMatrix * a_Position;\n\t\n\tvec4 temp = vec4(positionWorld.x, positionWorld.z, positionWorld.x, positionWorld.z) * u_WaveScale + u_WaveSpeed * u_WaveScale * u_Time;\n\t\n\tv_Texcoord0 = temp.xy * vec2(0.4, 0.45);\n\tv_Texcoord1 = temp.wz;\n\t\n\tmat3 worldMat = mat3(u_WorldMat);\n\tv_Normal = worldMat * a_Normal;\n\tv_Tangent = worldMat * a_Tangent0.xyz;\n\tv_Binormal = cross(v_Normal, v_Tangent) * a_Tangent0.w;\n\t\n\tv_ViewDir = u_CameraPos - positionWorld.xyz;\n\tgl_Position = position;\n\tgl_Position=remapGLPositionZ(gl_Position);\n}',e='#ifdef FSHIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#ifdef MAINTEXTURE\n\tuniform sampler2D u_MainTexture;\n#endif\n\n#ifdef NORMALTEXTURE\n\tuniform sampler2D u_NormalTexture;\n#endif\n\nuniform vec4 u_HorizonColor;\n\nvarying vec3 v_Normal;\nvarying vec3 v_Tangent;\nvarying vec3 v_Binormal;\nvarying vec3 v_ViewDir;\nvarying vec2 v_Texcoord0;\nvarying vec2 v_Texcoord1;\n\n#include "Lighting.glsl"\n\nvoid main()\n{\n\tvec4 bumpColor1 = texture2D(u_NormalTexture, v_Texcoord0);\n\tvec4 bumpColor2 = texture2D(u_NormalTexture, v_Texcoord1);\n\t\n\tvec3 normal1 = NormalSampleToWorldSpace1(bumpColor1, v_Tangent, v_Binormal, v_Normal);\n\tvec3 normal2 = NormalSampleToWorldSpace1(bumpColor2, v_Tangent, v_Binormal, v_Normal);\n\t\n\tvec3 normal = normalize((normal1 + normal2) * 0.5);\n\tvec3 viewDir = normalize(v_ViewDir);\n\tfloat fresnel = dot(viewDir, normal);\n\t\n\tvec4 waterColor = texture2D(u_MainTexture, vec2(fresnel, fresnel));\n\t\n\tvec4 color;\n\tcolor.rgb = mix(waterColor.rgb, u_HorizonColor.rgb, vec3(waterColor.a));\n\tcolor.a = u_HorizonColor.a;\n\t\n\tgl_FragColor = color;\n}\n\n',s=We.add("WaterPrimary"),a=new ti(i,n,null,ks.shaderDefines),s.addSubShader(a),a.addShaderPass(t,e),i={a_PositionTexcoord:0},n={u_ScreenTexture:1},t='#include "Lighting.glsl";\n\nattribute vec4 a_PositionTexcoord;\nvarying vec2 v_Texcoord0;\n\nvoid main() {\n\tgl_Position = vec4(a_PositionTexcoord.xy, 0.0, 1.0);\n\tv_Texcoord0 = a_PositionTexcoord.zw;\n\tgl_Position = remapGLPositionZ(gl_Position);\n}',e="#ifdef FSHIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\nuniform sampler2D u_ScreenTexture;\nvarying vec2 v_Texcoord0;\n\nvoid main() {\n\tgl_FragColor = texture2D(u_ScreenTexture, v_Texcoord0);\n}\n\n",s=We.add("ScreenQuad"),a=new ti(i,n,null,null),s.addSubShader(a);var o=a.addShaderPass(t,e),h=o.renderState;h.depthTest=519,h.depthWrite=!1,h.cull=0,i={a_PositionTexcoord:h.blend=0},n={u_MainTex:1,u_BloomTex:1,u_AutoExposureTex:1,u_MainTex_TexelSize:1,u_SampleScale:1,u_Threshold:1,u_Params:1},s=We.add("PostProcessBloom",i,n),a=new ti(null,null,null,null),s.addSubShader(a),(h=(o=a.addShaderPass('#include "Lighting.glsl";\n\nattribute vec4 a_PositionTexcoord;\nvarying vec2 v_Texcoord0;\n\nvoid main() {\n\tgl_Position = vec4(a_PositionTexcoord.xy, 0.0, 1.0);\n\tv_Texcoord0 = a_PositionTexcoord.zw;\n\tgl_Position = remapGLPositionZ(gl_Position);\n}','#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Colors.glsl";\n#include "Sampling.glsl";\n\nvarying vec2 v_Texcoord0;\n\nuniform sampler2D u_MainTex;\nuniform sampler2D u_AutoExposureTex;\nuniform vec4 u_MainTex_TexelSize;\nuniform vec4 u_Threshold; // x: threshold value (linear), y: threshold - knee, z: knee * 2, w: 0.25 / knee\nuniform vec4 u_Params; // x: clamp, yzw: unused\n\nmediump vec4 prefilter(mediump vec4 color, vec2 uv) {\n\tmediump float autoExposure = texture2D(u_AutoExposureTex, uv).r;\n\tcolor *= autoExposure;\n\tcolor = min(vec4(u_Params.x), color); // clamp to max\n\tcolor = quadraticThreshold(color, u_Threshold.x, u_Threshold.yzw);\n\treturn color;\n}\n\nvoid fragPrefilter13() {\n\tmediump vec4 color = downsampleBox13Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\n\tgl_FragColor = prefilter(safeHDR(color), v_Texcoord0);\n}\n\nvoid main() {\n\tfragPrefilter13();\n}')).renderState).depthTest=519,h.depthWrite=!1,h.cull=0,h.blend=0,a=new ti(null,null,null,null),s.addSubShader(a),(h=(o=a.addShaderPass('#include "Lighting.glsl";\n\nattribute vec4 a_PositionTexcoord;\nvarying vec2 v_Texcoord0;\n\nvoid main() {\n\tgl_Position = vec4(a_PositionTexcoord.xy, 0.0, 1.0);\n\tv_Texcoord0 = a_PositionTexcoord.zw;\n\tgl_Position = remapGLPositionZ(gl_Position);\n}','#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Colors.glsl";\n#include "Sampling.glsl";\n\nvarying vec2 v_Texcoord0;\n\nuniform sampler2D u_MainTex;\nuniform sampler2D u_AutoExposureTex;\nuniform vec4 u_MainTex_TexelSize;\nuniform vec4 u_Threshold; // x: threshold value (linear), y: threshold - knee, z: knee * 2, w: 0.25 / knee\nuniform vec4 u_Params; // x: clamp, yzw: unused\n\nmediump vec4 prefilter(mediump vec4 color, vec2 uv) {\n\tmediump float autoExposure = texture2D(u_AutoExposureTex, uv).r;\n\tcolor *= autoExposure;\n\tcolor = min(vec4(u_Params.x), color); // clamp to max\n\tcolor = quadraticThreshold(color, u_Threshold.x, u_Threshold.yzw);\n\treturn color;\n}\n\nvoid fragPrefilter4() {\n\tmediump vec4 color = downsampleBox4Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\n\tgl_FragColor = prefilter(safeHDR(color), v_Texcoord0);\n}\n\nvoid main() {\n\tfragPrefilter4();\n}')).renderState).depthTest=519,h.depthWrite=!1,h.cull=0,h.blend=0,a=new ti(null,null,null,null),s.addSubShader(a),(h=(o=a.addShaderPass('#include "Lighting.glsl";\n\nattribute vec4 a_PositionTexcoord;\nvarying vec2 v_Texcoord0;\n\nvoid main() {\n\tgl_Position = vec4(a_PositionTexcoord.xy, 0.0, 1.0);\n\tv_Texcoord0 = a_PositionTexcoord.zw;\n\tgl_Position = remapGLPositionZ(gl_Position);\n}','#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Colors.glsl";\n#include "Sampling.glsl";\n\nvarying vec2 v_Texcoord0;\n\nuniform sampler2D u_MainTex;\nuniform vec4 u_MainTex_TexelSize;\n\nvoid fragDownsample13() {\n\tmediump vec4 color = downsampleBox13Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\n\tgl_FragColor = color;\n}\n\nvoid main() {\n\tfragDownsample13();\n}')).renderState).depthTest=519,h.depthWrite=!1,h.cull=0,h.blend=0,a=new ti(null,null,null,null),s.addSubShader(a),(h=(o=a.addShaderPass('#include "Lighting.glsl";\n\nattribute vec4 a_PositionTexcoord;\nvarying vec2 v_Texcoord0;\n\nvoid main() {\n\tgl_Position = vec4(a_PositionTexcoord.xy, 0.0, 1.0);\n\tv_Texcoord0 = a_PositionTexcoord.zw;\n\tgl_Position = remapGLPositionZ(gl_Position);\n}','#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Colors.glsl";\n#include "Sampling.glsl";\n\nvarying vec2 v_Texcoord0;\n\nuniform sampler2D u_MainTex;\nuniform sampler2D u_BloomTex;\n\nuniform vec4 u_MainTex_TexelSize;\nuniform float u_SampleScale;\n\nmediump vec4 combine(mediump vec4 bloom, vec2 uv) {\n\tmediump vec4 color = texture2D(u_BloomTex, uv);\n\treturn bloom + color;\n}\n\nvoid fragUpsampleTent() {\n\tmediump vec4 bloom = UpsampleTent(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy, u_SampleScale);\n\tgl_FragColor = combine(bloom, v_Texcoord0);\n}\n\nvoid main() {\n\tfragUpsampleTent();\n}')).renderState).depthTest=519,h.depthWrite=!1,h.cull=0,h.blend=0,a=new ti(null,null,null,null),s.addSubShader(a),(h=(o=a.addShaderPass('#include "Lighting.glsl";\n\nattribute vec4 a_PositionTexcoord;\nvarying vec2 v_Texcoord0;\n\nvoid main() {\n\tgl_Position = vec4(a_PositionTexcoord.xy, 0.0, 1.0);\n\tv_Texcoord0 = a_PositionTexcoord.zw;\n\tgl_Position = remapGLPositionZ(gl_Position);\n}','#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Colors.glsl";\n#include "Sampling.glsl";\n\nvarying vec2 v_Texcoord0;\n\nuniform sampler2D u_MainTex;\nuniform sampler2D u_BloomTex;\n\nuniform vec4 u_MainTex_TexelSize;\nuniform float u_SampleScale;\n\nmediump vec4 combine(mediump vec4 bloom, vec2 uv) {\n\tmediump vec4 color = texture2D(u_BloomTex, uv);\n\treturn bloom + color;\n}\n\nvoid fragUpsampleBox() {\n\tmediump vec4 bloom = upsampleBox(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy, vec4(u_SampleScale));\n\tgl_FragColor = combine(bloom, v_Texcoord0);\n}\n\nvoid main() {\n\tfragUpsampleBox();\n}')).renderState).depthTest=519,h.depthWrite=!1,h.cull=0,h.blend=0,a=new ti(null,null,null,null),s.addSubShader(a),(h=(o=a.addShaderPass('#include "Lighting.glsl";\n\nattribute vec4 a_PositionTexcoord;\nvarying vec2 v_Texcoord0;\n\nvoid main() {\n\tgl_Position = vec4(a_PositionTexcoord.xy, 0.0, 1.0);\n\tv_Texcoord0 = a_PositionTexcoord.zw;\n\tgl_Position = remapGLPositionZ(gl_Position);\n}','#ifdef HIGHPRECISION\n\tprecision highp float;\n#else\n\tprecision mediump float;\n#endif\n\n#include "Colors.glsl";\n#include "Sampling.glsl";\n\nvarying vec2 v_Texcoord0;\n\nuniform sampler2D u_MainTex;\nuniform sampler2D u_AutoExposureTex;\nuniform vec4 u_MainTex_TexelSize;\nuniform vec4 u_Threshold; // x: threshold value (linear), y: threshold - knee, z: knee * 2, w: 0.25 / knee\nuniform vec4 u_Params; // x: clamp, yzw: unused\n\nmediump vec4 prefilter(mediump vec4 color, vec2 uv) {\n\tmediump float autoExposure = texture2D(u_AutoExposureTex, uv).r;\n\tcolor *= autoExposure;\n\tcolor = min(vec4(u_Params.x), color); // clamp to max\n\tcolor = quadraticThreshold(color, u_Threshold.x, u_Threshold.yzw);\n\treturn color;\n}\n\nvoid fragPrefilter13() {\n\tmediump vec4 color = downsampleBox13Tap(u_MainTex, v_Texcoord0, u_MainTex_TexelSize.xy);\n\tgl_FragColor = prefilter(safeHDR(color), v_Texcoord0);\n}\n\nvoid main() {\n\tfragPrefilter13();\n}')).renderState).depthTest=519,h.depthWrite=!1,h.cull=0,i={a_PositionTexcoord:h.blend=0},n={u_MainTex:1,u_BloomTex:1,u_AutoExposureTex:1,u_Bloom_DirtTex:1,u_BloomTex_TexelSize:1,u_Bloom_Settings:1,u_Bloom_Color:1},s=We.add("PostProcessComposite",i,n),a=new ti(null,null,null,he.shaderDefines),s.addSubShader(a),(h=(o=a.addShaderPass("attribute vec4 a_Position;\nvarying vec2 v_Texcoord0;\n\nvec2 TransformTriangleVertexToUV(vec2 vertex)\n{\n    vec2 uv = (vertex + 1.0) * 0.5;\n    return uv;\n}\n\nvoid main() {\n\tgl_Position =vec4(a_Position.xy, 0.0, 1.0);\n\tv_Texcoord0=TransformTriangleVertexToUV(a_Position.xy);\n\tgl_Position=remapGLPositionZ(gl_Position);\n}",'#include "Colors.glsl";\n#include "Sampling.glsl";\n\nvarying vec2 v_Texcoord0;\n\nuniform sampler2D u_MainTex;\nuniform sampler2D u_BloomTex;\n\nuniform sampler2D u_AutoExposureTex;\nuniform sampler2D u_Bloom_DirtTex;\nuniform vec4 u_BloomTex_TexelSize;\nuniform vec4 u_Bloom_DirtTileOffset; // xy: tiling, zw: offset\nuniform mediump vec3 u_Bloom_Settings;// x: sampleScale, y: intensity, z: dirt intensity\nuniform mediump vec3 u_Bloom_Color;\n\nvoid main() {\n\tmediump float autoExposure = texture2D(u_AutoExposureTex, v_Texcoord0).r;\n\tmediump vec4 color=vec4(0.0)\n\tcolor = texture2D(u_MainTex, v_Texcoord0);\n\t\n\tcolor = SRGBToLinear(color);\n\tcolor.rgb *= autoExposure;\n\t\n\t#if BLOOM || BLOOM_LOW\n\t{\n\t\t#if BLOOM\n\t\t\tmediump vec4 bloom = UpsampleTent(_BloomTex, uvDistorted, _BloomTex_TexelSize.xy, _Bloom_Settings.x);\n\t\t#else\n\t\t\tmediump vec4 bloom = UpsampleBox(_BloomTex, uvDistorted, _BloomTex_TexelSize.xy, _Bloom_Settings.x);\n\t\t#endif\n\n\t\t// UVs should be Distort(uv * _Bloom_DirtTileOffset.xy + _Bloom_DirtTileOffset.zw)\n\t\t// but considering we use a cover-style scale on the dirt texture the difference\n\t\t// isn\'t massive so we chose to save a few ALUs here instead in case lens distortion\n\t\t// is active\n\t\tmediump vec4 dirt = mediump vec4(SAMPLE_TEXTURE2D(_Bloom_DirtTex, sampler_Bloom_DirtTex, uvDistorted * _Bloom_DirtTileOffset.xy + _Bloom_DirtTileOffset.zw).rgb, 0.0);\n\n\t\t// Additive bloom (artist friendly)\n\t\tbloom *= _Bloom_Settings.y;\n\t\tdirt *= _Bloom_Settings.z;\n\t\tcolor += bloom * half4(_Bloom_Color, 1.0);\n\t\tcolor += dirt * bloom;\n\t}\n\t#endif\n\t\n\thalf4 output = color;\n\toutput = LinearToSRGB(output);\n\t//output.rgb = Dither(output.rgb, v_Texcoord0);//TODO:\n}')).renderState).depthTest=519,h.depthWrite=!1,h.cull=0,h.blend=0},l._rangeAttenTex=null,l}(),yi=function(){function t(){this.flags=0,this.maxSubSteps=1,this.fixedTimeStep=1/60}return I(t,"laya.d3.physics.PhysicsSettings"),t}(),Ei=(function(){function t(){}I(t,"laya.Const"),t.NOT_ACTIVE=1,t.ACTIVE_INHIERARCHY=2,t.AWAKED=4,t.NOT_READY=8,t.DISPLAY=16,t.HAS_ZORDER=32,t.HAS_MOUSE=64,t.DISPLAYED_INSTAGE=128,t.DRAWCALL_OPTIMIZE=256}(),function(){function t(){}return I(t,"laya.d3.core.render.RenderContext3D"),t.clientWidth=0,t.clientHeight=0,E(t,["_instance",function(){return this._instance=new t}]),t}()),xi=function(){function o(){this._textIsWorldText=!1,this._fontColor=4294967295,this._strokeColor=0,this._nTexAlign=0,this._fontObj=o._defFontObj}I(o,"laya.display.cmd.FillTextCmd");var t=o.prototype;return t.recover=function(){p.recover("FillTextCmd",this)},t.run=function(t,e,i){T.stage.isGlobalRepaint()&&this._textIsWorldText&&this._text.cleanCache(),this._textIsWorldText?t._fast_filltext(this._text,this.x+e,this.y+i,this._fontObj,this._color,null,0,this._nTexAlign,0):t.drawText(this._text,this.x+e,this.y+i,this._font,this._color,this._textAlign)},g(0,t,"textAlign",function(){return this._textAlign},function(t){switch(this._textAlign=t){case"center":this._nTexAlign=ji.ENUM_TEXTALIGN_CENTER;break;case"right":this._nTexAlign=ji.ENUM_TEXTALIGN_RIGHT;break;default:this._nTexAlign=ji.ENUM_TEXTALIGN_DEFAULT}this._textIsWorldText&&this._text.cleanCache()}),g(0,t,"font",function(){return this._font},function(t){this._font=t,this._fontObj=Tt.Parse(t),this._textIsWorldText&&this._text.cleanCache()}),g(0,t,"color",function(){return this._color},function(t){this._color=t,this._fontColor=f.create(t).numColor,this._textIsWorldText&&this._text.cleanCache()}),g(0,t,"text",function(){return this._text},function(t){this._text=t,this._textIsWorldText=t instanceof laya.utils.WordText,this._textIsWorldText&&this._text.cleanCache()}),g(0,t,"cmdID",function(){return"FillText"}),o.create=function(t,e,i,n,r,s){var a=p.getItemByClass("FillTextCmd",o);return a.text=t,a._textIsWorldText=t instanceof laya.utils.WordText,a.x=e,a.y=i,a.font=n,a.color=r,a.textAlign=s,a},o.ID="FillText",E(o,["_defFontObj",function(){return this._defFontObj=new Tt(null)}]),o}(),Si=function(){function l(){}return I(l,"laya.d3.graphics.Vertex.VertexMesh"),l.getVertexDeclaration=function(t,e){void 0===e&&(e=!0);var i=l._vertexDeclarationMap[t+(e?"_0":"_1")];if(!i){for(var n=t.split(","),r=0,s=[],a=0,o=n.length;a<o;a++){var h;switch(n[a]){case"POSITION":h=new lt(r,"vector3",0),r+=12;break;case"NORMAL":h=new lt(r,"vector3",3),r+=12;break;case"COLOR":h=new lt(r,"vector4",1),r+=16;break;case"UV":h=new lt(r,"vector2",2),r+=8;break;case"UV1":h=new lt(r,"vector2",7),r+=8;break;case"BLENDWEIGHT":h=new lt(r,"vector4",6),r+=16;break;case"BLENDINDICES":e?(h=new lt(r,"vector4",5),r+=16):(h=new lt(r,"byte4",5),r+=4);break;case"TANGENT":h=new lt(r,"vector4",4),r+=16;break;default:throw"VertexMesh: unknown vertex flag."}s.push(h)}i=new D(r,s),l._vertexDeclarationMap[t+(e?"_0":"_1")]=i}return i},l.MESH_POSITION0=0,l.MESH_COLOR0=1,l.MESH_TEXTURECOORDINATE0=2,l.MESH_NORMAL0=3,l.MESH_TANGENT0=4,l.MESH_BLENDINDICES0=5,l.MESH_BLENDWEIGHT0=6,l.MESH_TEXTURECOORDINATE1=7,l.MESH_WORLDMATRIX_ROW0=8,l.MESH_WORLDMATRIX_ROW1=9,l.MESH_WORLDMATRIX_ROW2=10,l.MESH_WORLDMATRIX_ROW3=11,l.MESH_MVPMATRIX_ROW0=12,l.MESH_MVPMATRIX_ROW1=13,l.MESH_MVPMATRIX_ROW2=14,l.MESH_MVPMATRIX_ROW3=15,l._vertexDeclarationMap={},E(l,["instanceWorldMatrixDeclaration",function(){return this.instanceWorldMatrixDeclaration=new D(64,[new lt(0,"vector4",8),new lt(16,"vector4",9),new lt(32,"vector4",10),new lt(48,"vector4",11)])},"instanceMVPMatrixDeclaration",function(){return this.instanceMVPMatrixDeclaration=new D(64,[new lt(0,"vector4",12),new lt(16,"vector4",13),new lt(32,"vector4",14),new lt(48,"vector4",15)])}]),l}(),Ci=function(){function c(){this._hit=null,this._unHit=null}I(c,"laya.utils.HitArea");var t=c.prototype;return t.contains=function(t,e){return!!c._isHitGraphic(t,e,this.hit)&&!c._isHitGraphic(t,e,this.unHit)},g(0,t,"unHit",function(){return this._unHit||(this._unHit=new $),this._unHit},function(t){this._unHit=t}),g(0,t,"hit",function(){return this._hit||(this._hit=new $),this._hit},function(t){this._hit=t}),c._isHitGraphic=function(t,e,i){if(!i)return!1;var n=i.cmds;if(!n&&i._one&&((n=c._cmds).length=1,n[0]=i._one),!n)return!1;var r,s,a=0;for(r=n.length,a=0;a<r;a++)if(s=n[a]){switch(s.cmdID){case"Translate":t-=s.tx,e-=s.ty}if(c._isHitCmd(t,e,s))return!0}return!1},c._isHitCmd=function(t,e,i){if(!i)return!1;var n=!1;switch(i.cmdID){case"DrawRect":c._rect.setTo(i.x,i.y,i.width,i.height),n=c._rect.contains(t,e);break;case"DrawCircle":n=(t-=i.x)*t+(e-=i.y)*e<i.radius*i.radius;break;case"DrawPoly":t-=i.x,e-=i.y,n=c._ptInPolygon(t,e,i.points)}return n},c._ptInPolygon=function(t,e,i){var n=c._ptPoint;n.setTo(t,e);var r,s=0,a=NaN,o=NaN,h=NaN,l=NaN;r=i.length;for(var u=0;u<r;u+=2){if(a=i[u],o=i[u+1],h=i[(u+2)%r],o!=(l=i[(u+3)%r]))if(!(n.y<Math.min(o,l)))if(!(n.y>=Math.max(o,l)))(n.y-o)*(h-a)/(l-o)+a>n.x&&s++}return s%2==1},c._cmds=[],E(c,["_rect",function(){return this._rect=new ve},"_ptPoint",function(){return this._ptPoint=new R}]),c}(),Ii=function(){function c(){this.gid=0,this.repeat=1,this._count=0}I(c,"laya.utils.Tween");var t=c.prototype;return t.to=function(t,e,i,n,r,s,a){return void 0===s&&(s=0),void 0===a&&(a=!1),this._create(t,e,i,n,r,s,a,!0,!1,!0)},t.from=function(t,e,i,n,r,s,a){return void 0===s&&(s=0),void 0===a&&(a=!1),this._create(t,e,i,n,r,s,a,!1,!1,!0)},t._create=function(t,e,i,n,r,s,a,o,h,l){if(!t)throw new Error("Tween:target is null");this._target=t,this._duration=i,this._ease=n||e.ease||c.easeNone,this._complete=r||e.complete,this._delay=s,this._props=[],this._usedTimer=0,this._startTimer=Vt.now(),this._usedPool=h,this._delayParam=null,this.update=e.update;var u=t.$_GID||(t.$_GID=nt.getGID());return c.tweenMap[u]?(a&&c.clearTween(t),c.tweenMap[u].push(this)):c.tweenMap[u]=[this],l?s<=0?this.firstStart(t,e,o):(this._delayParam=[t,e,o],T.timer.once(s,this,this.firstStart,this._delayParam)):this._initProps(t,e,o),this},t.firstStart=function(t,e,i){this._delayParam=null,t.destroyed?this.clear():(this._initProps(t,e,i),this._beginLoop())},t._initProps=function(t,e,i){for(var n in e)if("number"==typeof t[n]){var r=i?t[n]:e[n],s=i?e[n]:t[n];this._props.push([n,r,s-r]),i||(t[n]=r)}},t._beginLoop=function(){T.timer.frameLoop(1,this,this._doEase)},t._doEase=function(){this._updateEase(Vt.now())},t._updateEase=function(t){var e=this._target;if(e){if(e.destroyed)return c.clearTween(e);var i=this._usedTimer=t-this._startTimer-this._delay;if(!(i<0)){if(i>=this._duration)return this.complete();for(var n=0<i?this._ease(i,0,1,this._duration):0,r=this._props,s=0,a=r.length;s<a;s++){var o=r[s];e[o[0]]=o[1]+n*o[2]}this.update&&this.update.run()}}},t.complete=function(){if(this._target){T.timer.runTimer(this,this.firstStart);for(var t=this._target,e=this._props,i=this._complete,n=0,r=e.length;n<r;n++){var s=e[n];t[s[0]]=s[1]+s[2]}this.update&&this.update.run(),this._count++,0!=this.repeat&&this._count>=this.repeat?(this.clear(),i&&i.run()):this.restart()}},t.pause=function(){T.timer.clear(this,this._beginLoop),T.timer.clear(this,this._doEase),T.timer.clear(this,this.firstStart);var t;(t=Vt.now()-this._startTimer-this._delay)<0&&(this._usedTimer=t)},t.setStartTime=function(t){this._startTimer=t},t.clear=function(){this._target&&(this._remove(),this._clear())},t._clear=function(){this.pause(),T.timer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._delayParam=null,this._usedPool&&(this.update=null,p.recover("tween",this))},t.recover=function(){this._usedPool=!0,this._clear()},t._remove=function(){var t=c.tweenMap[this._target.$_GID];if(t)for(var e=0,i=t.length;e<i;e++)if(t[e]===this){t.splice(e,1);break}},t.restart=function(){if(this.pause(),this._usedTimer=0,this._startTimer=Vt.now(),this._delayParam)T.timer.once(this._delay,this,this.firstStart,this._delayParam);else{for(var t=this._props,e=0,i=t.length;e<i;e++){var n=t[e];this._target[n[0]]=n[1]}T.timer.once(this._delay,this,this._beginLoop)}},t.resume=function(){this._usedTimer>=this._duration||(this._startTimer=Vt.now()-this._usedTimer-this._delay,this._delayParam?this._usedTimer<0?T.timer.once(-this._usedTimer,this,this.firstStart,this._delayParam):this.firstStart.apply(this,this._delayParam):this._beginLoop())},g(0,t,"progress",null,function(t){var e=t*this._duration;this._startTimer=Vt.now()-this._delay-e}),c.to=function(t,e,i,n,r,s,a,o){return void 0===s&&(s=0),void 0===a&&(a=!1),void 0===o&&(o=!0),p.getItemByClass("tween",c)._create(t,e,i,n,r,s,a,!0,o,!0)},c.from=function(t,e,i,n,r,s,a,o){return void 0===s&&(s=0),void 0===a&&(a=!1),void 0===o&&(o=!0),p.getItemByClass("tween",c)._create(t,e,i,n,r,s,a,!1,o,!0)},c.clearAll=function(t){if(t&&t.$_GID){var e=c.tweenMap[t.$_GID];if(e){for(var i=0,n=e.length;i<n;i++)e[i]._clear();e.length=0}}},c.clear=function(t){t.clear()},c.clearTween=function(t){c.clearAll(t)},c.easeNone=function(t,e,i,n){return i*t/n+e},c.tweenMap=[],c}(),Ri=function(){var a;function t(){this._pool=[],this._map=[],this._laters=[]}I(t,"laya.utils.CallLater");var e=t.prototype;return e._update=function(){var t=this._laters,e=t.length;if(0<e){for(var i=0,n=e-1;i<=n;i++){var r=t[i];(this._map[r.key]=null)!==r.method&&(r.run(),r.clear()),this._pool.push(r),i===n&&(n=t.length-1)}t.length=0}},e._getHandler=function(t,e){var i=t?t.$_GID||(t.$_GID=nt.getGID()):0,n=e.$_TID||(e.$_TID=1e5*Ni._mid++);return this._map[i+n]},e.callLater=function(t,e,i){if(null==this._getHandler(t,e)){if(this._pool.length)var n=this._pool.pop();else n=new a;n.caller=t,n.method=e,n.args=i;var r=t?t.$_GID:0,s=e.$_TID;n.key=r+s,this._map[n.key]=n,this._laters.push(n)}},e.runCallLater=function(t,e){var i=this._getHandler(t,e);i&&null!=i.method&&(this._map[i.key]=null,i.run(),i.clear())},t.I=new t,t.__init$=function(){a=function(){function t(){this.key=0,this.caller=null,this.method=null,this.args=null}I(t,"");var e=t.prototype;return e.clear=function(){this.caller=null,this.method=null,this.args=null},e.run=function(){var t=this.caller;if(t&&t.destroyed)return this.clear();var e=this.method,i=this.args;null!=e&&(i?e.apply(t,i):e.call(t))},t}()},t}(),Ai=function(){function t(){this.diffuseTexture=null,this.normalTexture=null,this.scale=null,this.offset=null}return I(t,"laya.d3.terrain.unit.DetailTextureInfo"),t}(),Mi=function(){function t(t){this._owner=null,this._sharedMesh=null,this._owner=t}I(t,"laya.d3.core.MeshFilter");var e=t.prototype;return e._getMeshDefine=function(t){for(var e=0,i=0,n=t._subMeshCount;i<n;i++)for(var r=t._getSubMesh(i)._vertexBuffer._vertexDeclaration.vertexElements,s=0,a=r.length;s<a;s++){switch(r[s].elementUsage){case 1:e|=pa.SHADERDEFINE_COLOR;break;case 2:e|=pa.SHADERDEFINE_UV0;break;case 7:e|=pa.SHADERDEFINE_UV1}}return e},e.destroy=function(){this._owner=null,this._sharedMesh&&(this._sharedMesh._removeReference(),this._sharedMesh=null)},g(0,e,"sharedMesh",function(){return this._sharedMesh},function(t){if(this._sharedMesh!==t){var e=this._owner._render._defineDatas,i=this._sharedMesh;i&&(i._removeReference(),e.remove(this._getMeshDefine(i))),t._addReference(),this._sharedMesh=t,e.add(this._getMeshDefine(t)),this._owner._render._changeRenderObjectsByMesh(t)}this._owner._render._onMeshChange(t)}),t}(),Di=function(){function h(){}I(h,"laya.display.cmd.FillBorderWordsCmd");var t=h.prototype;return t.recover=function(){this.words=null,p.recover("FillBorderWordsCmd",this)},t.run=function(t,e,i){t.fillBorderWords(this.words,this.x+e,this.y+i,this.font,this.fillColor,this.borderColor,this.lineWidth)},g(0,t,"cmdID",function(){return"FillBorderWords"}),h.create=function(t,e,i,n,r,s,a){var o=p.getItemByClass("FillBorderWordsCmd",h);return o.words=t,o.x=e,o.y=i,o.font=n,o.fillColor=r,o.borderColor=s,o.lineWidth=a,o},h.ID="FillBorderWords",h}(),bi=function(){function l(){}return I(l,"laya.maths.GrahamScan"),l.multiply=function(t,e,i){return(t.x-i.x)*(e.y-i.y)-(e.x-i.x)*(t.y-i.y)},l.dis=function(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)},l._getPoints=function(t,e,i){for(void 0===e&&(e=!1),l._mPointList||(l._mPointList=[]);l._mPointList.length<t;)l._mPointList.push(new R);return i||(i=[]),i.length=0,e?l.getFrom(i,l._mPointList,t):l.getFromR(i,l._mPointList,t),i},l.getFrom=function(t,e,i){var n=0;for(n=0;n<i;n++)t.push(e[n]);return t},l.getFromR=function(t,e,i){var n=0;for(n=0;n<i;n++)t.push(e.pop());return t},l.pListToPointList=function(t,e){void 0===e&&(e=!1);var i=0,n=t.length/2,r=l._getPoints(n,e,l._tempPointList);for(i=0;i<n;i++)r[i].setTo(t[i+i],t[i+i+1]);return r},l.pointListToPlist=function(t){var e,i=0,n=t.length,r=l._temPList;for(i=r.length=0;i<n;i++)e=t[i],r.push(e.x,e.y);return r},l.scanPList=function(t){return nt.copyArray(t,l.pointListToPlist(l.scan(l.pListToPointList(t,!0))))},l.scan=function(t){var e,i,n,r=0,s=0,a=0,o=t.length,h={};for((i=l._temArr).length=0,r=(o=t.length)-1;0<=r;r--)n=(e=t[r]).x+"_"+e.y,h.hasOwnProperty(n)||(h[n]=!0,i.push(e));for(o=i.length,nt.copyArray(t,i),r=1;r<o;r++)(t[r].y<t[a].y||t[r].y==t[a].y&&t[r].x<t[a].x)&&(a=r);for(e=t[0],t[0]=t[a],t[a]=e,r=1;r<o-1;r++){for(s=(a=r)+1;s<o;s++)(0<l.multiply(t[s],t[a],t[0])||0==l.multiply(t[s],t[a],t[0])&&l.dis(t[0],t[s])<l.dis(t[0],t[a]))&&(a=s);e=t[r],t[r]=t[a],t[a]=e}if((i=l._temArr).length=0,t.length<3)return nt.copyArray(i,t);for(i.push(t[0],t[1],t[2]),r=3;r<o;r++){for(;2<=i.length&&0<=l.multiply(t[r],i[i.length-1],i[i.length-2]);)i.pop();t[r]&&i.push(t[r])}return i},l._mPointList=null,l._tempPointList=[],l._temPList=[],l._temArr=[],l}(),wi=function(){function o(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseMoveAccuracy=2,this._stage=null,this._captureSp=null,this._captureExlusiveMode=!1,this._hitCaputreSp=!1,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new rt,this._captureChain=[],this._matrix=new It,this._point=new R,this._rect=new ve,this._prePoint=new R,this._curTouchID=NaN}I(o,"laya.events.MouseManager");var t=o.prototype;return t.__init__=function(t,e){var i=this;this._stage=t;var n=this;e.oncontextmenu=function(t){if(o.enabled)return!1},e.addEventListener("mousedown",function(t){o.enabled&&(Vt.onIE||t.preventDefault(),n.mouseDownTime=Vt.now(),i.runEvent(t))}),e.addEventListener("mouseup",function(t){o.enabled&&(t.preventDefault(),n.mouseDownTime=-Vt.now(),i.runEvent(t))},!0),e.addEventListener("mousemove",function(t){if(o.enabled){t.preventDefault();var e=Vt.now();if(e-n._lastMoveTimer<10)return;n._lastMoveTimer=e,i.runEvent(t)}},!0),e.addEventListener("mouseout",function(t){o.enabled&&i.runEvent(t)}),e.addEventListener("mouseover",function(t){o.enabled&&i.runEvent(t)}),e.addEventListener("touchstart",function(t){o.enabled&&(o._isFirstTouch||Ta.isInputting||t.preventDefault(),n.mouseDownTime=Vt.now(),i.runEvent(t))}),e.addEventListener("touchend",function(t){o.enabled?(o._isFirstTouch||Ta.isInputting||t.preventDefault(),o._isFirstTouch=!1,n.mouseDownTime=-Vt.now(),i.runEvent(t)):i._curTouchID=NaN},!0),e.addEventListener("touchmove",function(t){o.enabled&&(t.preventDefault(),i.runEvent(t))},!0),e.addEventListener("touchcancel",function(t){o.enabled?(t.preventDefault(),i.runEvent(t)):i._curTouchID=NaN},!0),e.addEventListener("mousewheel",function(t){o.enabled&&i.runEvent(t)}),e.addEventListener("DOMMouseScroll",function(t){o.enabled&&i.runEvent(t)})},t.initEvent=function(t,e){var i;this._event._stoped=!1,this._event.nativeEvent=e||t,this._target=null,this._point.setTo(t.pageX||t.clientX,t.pageY||t.clientY),this._stage._canvasTransform&&(this._stage._canvasTransform.invertTransformPoint(this._point),this.mouseX=this._point.x,this.mouseY=this._point.y),this._event.touchId=t.identifier||0,this._tTouchID=this._event.touchId,(i=di.I._event)._stoped=!1,i.nativeEvent=this._event.nativeEvent,i.touchId=this._event.touchId},t.checkMouseWheel=function(t){this._event.delta=t.wheelDelta?.025*t.wheelDelta:-t.detail;for(var e=di.I.getLastOvers(),i=0,n=e.length;i<n;i++){var r=e[i];r.event("mousewheel",this._event.setTo("mousewheel",r,this._target))}},t.onMouseMove=function(t){di.I.onMouseMove(t,this._tTouchID)},t.onMouseDown=function(t){if(Ta.isInputting&&T.stage.focus&&T.stage.focus.focus&&!T.stage.focus.contains(this._target)){var e=T.stage.focus._tf||T.stage.focus,i=t._tf||t;i instanceof laya.display.Input&&i.multiline==e.multiline?e._focusOut():e.focus=!1}di.I.onMouseDown(t,this._tTouchID,this._isLeftMouse)},t.onMouseUp=function(t){di.I.onMouseUp(t,this._tTouchID,this._isLeftMouse)},t.check=function(t,e,i,n){this._point.setTo(e,i),t.fromParentPoint(this._point),e=this._point.x,i=this._point.y;var r=t._style.scrollRect;if(r&&(this._rect.setTo(r.x,r.y,r.width,r.height),!this._rect.contains(e,i)))return!1;if(!this.disableMouseEvent){if(t.hitTestPrior&&!t.mouseThrough&&!this.hitTest(t,e,i))return!1;for(var s=t._children.length-1;-1<s;s--){var a=t._children[s];if(!a.destroyed&&1<a._mouseState&&a._visible&&this.check(a,e,i,n))return!0}for(s=t._extUIChild.length-1;0<=s;s--){var o=t._extUIChild[s];if(!o.destroyed&&1<o._mouseState&&o._visible&&this.check(o,e,i,n))return!0}}var h=!(!t.hitTestPrior||t.mouseThrough||this.disableMouseEvent)||this.hitTest(t,e,i);return h?(this._target=t,n.call(this,t),this._target==this._hitCaputreSp&&(this._hitCaputreSp=!0)):n===this.onMouseUp&&t===this._stage&&(this._target=this._stage,n.call(this,this._target)),h},t.hitTest=function(t,e,i){var n=!1;t.scrollRect&&(e-=t._style.scrollRect.x,i-=t._style.scrollRect.y);var r=t._style.hitArea;return r&&r._hit?r.contains(e,i):((0<t.width&&0<t.height||t.mouseThrough||r)&&(n=t.mouseThrough?t.getGraphicBounds().contains(e,i):(r||this._rect.setTo(0,0,t.width,t.height)).contains(e,i)),n)},t._checkAllBaseUI=function(t,e,i){var n=this.handleExclusiveCapture(this.mouseX,this.mouseY,i);return!!n||(n=this.check(this._stage,this.mouseX,this.mouseY,i),this.handleCapture(this.mouseX,this.mouseY,i)||n)},t.check3DUI=function(t,e,i){for(var n=this._stage._3dUI,r=0,s=!1;r<n.length;r++){var a=n[r];!(this._stage._curUIBase=a).destroyed&&1<a._mouseState&&a._visible&&(s=s||this.check(a,this.mouseX,this.mouseY,i))}return this._stage._curUIBase=this._stage,s},t.handleExclusiveCapture=function(t,e,i){if(this._captureExlusiveMode&&this._captureSp&&0<this._captureChain.length){var n;this._point.setTo(t,e);for(var r=0;r<this._captureChain.length;r++)(n=this._captureChain[r]).fromParentPoint(this._point);return this._target=n,i.call(this,n),!0}return!1},t.handleCapture=function(t,e,i){if(!this._hitCaputreSp&&this._captureSp&&0<this._captureChain.length){var n;this._point.setTo(t,e);for(var r=0;r<this._captureChain.length;r++)(n=this._captureChain[r]).fromParentPoint(this._point);return this._target=n,i.call(this,n),!0}return!1},t.runEvent=function(t){var e,i=0,n=0;switch("mousemove"!==t.type&&(this._prePoint.x=this._prePoint.y=-1e6),t.type){case"mousedown":this._touchIDs[0]=this._id++,o._isTouchRespond?o._isTouchRespond=!1:(this._isLeftMouse=0===t.button,this.initEvent(t),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseDown));break;case"mouseup":this._isLeftMouse=0===t.button,this.initEvent(t),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-t.clientX)+Math.abs(this._prePoint.y-t.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=t.clientX,this._prePoint.y=t.clientY,this.initEvent(t),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseMove));break;case"touchstart":o._isTouchRespond=!0,this._isLeftMouse=!0;var r=t.changedTouches;for(i=0,n=r.length;i<n;i++)e=r[i],(o.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=e.identifier,this._id%200==0&&(this._touchIDs={}),this._touchIDs[e.identifier]=this._id++,this.initEvent(e,t),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseDown));break;case"touchend":case"touchcancel":o._isTouchRespond=!0,this._isLeftMouse=!0;var s=t.changedTouches;for(i=0,n=s.length;i<n;i++)if(e=s[i],o.multiTouchEnabled||e.identifier==this._curTouchID){this._curTouchID=NaN,this.initEvent(e,t);this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseUp)||this.onMouseUp(null)}break;case"touchmove":var a=t.changedTouches;for(i=0,n=a.length;i<n;i++)e=a[i],(o.multiTouchEnabled||e.identifier==this._curTouchID)&&(this.initEvent(e,t),this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":this.checkMouseWheel(t);break;case"mouseout":di.I.stageMouseOut();break;case"mouseover":this._stage.event("mouseover",this._event.setTo("mouseover",this._stage,this._stage))}},t.setCapture=function(t,e){void 0===e&&(e=!1),this._captureSp=t,this._captureExlusiveMode=e,this._captureChain.length=0,this._captureChain.push(t);for(var i=t;i!=T.stage&&i!=T.stage._curUIBase&&(i=i.parent);)this._captureChain.splice(0,0,i)},t.releaseCapture=function(){console.log("release capture"),this._captureSp=null},o.enabled=!0,o.multiTouchEnabled=!0,o._isTouchRespond=!1,o._isFirstTouch=!0,E(o,["instance",function(){return this.instance=new o}]),o}(),Li=function(){function h(){}return I(h,"laya.media.SoundManager"),g(1,h,"musicMuted",function(){return h._musicMuted},function(t){t!=h._musicMuted&&(t?(h._bgMusic&&h._musicChannel&&!h._musicChannel.isStopped?qi.isConchApp?h._musicChannel._audio&&(h._musicChannel._audio.muted=!0):h._musicChannel.pause():h._musicChannel=null,h._musicMuted=t):(h._musicMuted=t,h._bgMusic&&h._musicChannel&&(qi.isConchApp?h._musicChannel._audio&&(h._musicChannel._audio.muted=!1):h._musicChannel.resume())))}),g(1,h,"useAudioMusic",function(){return h._useAudioMusic},function(t){h._useAudioMusic=t,h._musicClass=t?Un:null}),g(1,h,"soundMuted",function(){return h._soundMuted},function(t){h._soundMuted=t}),g(1,h,"muted",function(){return h._muted},function(t){t!=h._muted&&(t&&h.stopAllSound(),h.musicMuted=t,h._muted=t)}),g(1,h,"autoStopMusic",function(){return h._autoStopMusic},function(t){T.stage.off("blur",null,h._stageOnBlur),T.stage.off("focus",null,h._stageOnFocus),T.stage.off("visibilitychange",null,h._visibilityChange),(h._autoStopMusic=t)&&(T.stage.on("blur",null,h._stageOnBlur),T.stage.on("focus",null,h._stageOnFocus),T.stage.on("visibilitychange",null,h._visibilityChange))}),h.__init__=function(){var t=Vt.window,e=!!(t.AudioContext||t.webkitAudioContext||t.mozAudioContext);return e&&tr.initWebAudio(),h._soundClass=e?tr:Un,Un._initMusicAudio(),h._musicClass=Un,e},h.addChannel=function(t){0<=h._channels.indexOf(t)||h._channels.push(t)},h.removeChannel=function(t){var e=0;for(e=h._channels.length-1;0<=e;e--)h._channels[e]==t&&h._channels.splice(e,1)},h.disposeSoundLater=function(t){h._lastSoundUsedTimeDic[t]=Vt.now(),h._isCheckingDispose||(h._isCheckingDispose=!0,T.timer.loop(5e3,null,h._checkDisposeSound))},h._checkDisposeSound=function(){var t,e=Vt.now(),i=!1;for(t in h._lastSoundUsedTimeDic)3e4<e-h._lastSoundUsedTimeDic[t]?(delete h._lastSoundUsedTimeDic[t],h.disposeSoundIfNotUsed(t)):i=!0;i||(h._isCheckingDispose=!1,T.timer.clear(null,h._checkDisposeSound))},h.disposeSoundIfNotUsed=function(t){var e=0;for(e=h._channels.length-1;0<=e;e--)if(h._channels[e].url==t)return;h.destroySound(t)},h._visibilityChange=function(){T.stage.isVisibility?h._stageOnFocus():h._stageOnBlur()},h._stageOnBlur=function(){h._isActive=!1,h._musicChannel&&(h._musicChannel.isStopped||(h._blurPaused=!0,h._musicChannel.pause())),h.stopAllSound(),T.stage.once("mousedown",null,h._stageOnFocus)},h._recoverWebAudio=function(){tr.ctx&&"running"!=tr.ctx.state&&tr.ctx.resume&&tr.ctx.resume()},h._stageOnFocus=function(){h._isActive=!0,h._recoverWebAudio(),T.stage.off("mousedown",null,h._stageOnFocus),h._blurPaused&&h._musicChannel&&h._musicChannel.isStopped&&(h._blurPaused=!1,h._musicChannel.resume())},h.playSound=function(t,e,i,n,r){if(void 0===e&&(e=1),void 0===r&&(r=0),!h._isActive||!t)return null;if(h._muted)return null;if(h._recoverWebAudio(),(t=gn.formatURL(t))==h._bgMusic){if(h._musicMuted)return null}else{if(qi.isConchApp){var s=nt.getFileExtension(t);if("wav"!=s&&"ogg"!=s)return alert("The sound only supports wav or ogg format,for optimal performance reason,please refer to the official website document."),null}if(h._soundMuted)return null}var a,o;return Vt.onMiniGame||(a=T.loader.getRes(t)),n||(n=h._soundClass),a||((a=new n).load(t),Vt.onMiniGame||Hn.cacheRes(t,a)),(o=a.play(r,e))?(o.url=t,o.volume=t==h._bgMusic?h.musicVolume:h.soundVolume,o.completeHandler=i,o):null},h.destroySound=function(t){var e=T.loader.getRes(t);e&&(Hn.clearRes(t),e.dispose())},h.playMusic=function(t,e,i,n){return void 0===e&&(e=0),void 0===n&&(n=0),t=gn.formatURL(t),h._bgMusic=t,h._musicChannel&&h._musicChannel.stop(),h._musicChannel=h.playSound(t,e,i,h._musicClass,n)},h.stopSound=function(t){t=gn.formatURL(t);var e,i=0;for(i=h._channels.length-1;0<=i;i--)(e=h._channels[i]).url==t&&e.stop()},h.stopAll=function(){h._bgMusic=null;var t=0;for(t=h._channels.length-1;0<=t;t--)h._channels[t].stop()},h.stopAllSound=function(){var t,e=0;for(e=h._channels.length-1;0<=e;e--)(t=h._channels[e]).url!=h._bgMusic&&t.stop()},h.stopMusic=function(){h._musicChannel&&h._musicChannel.stop(),h._bgMusic=null},h.setSoundVolume=function(t,e){if(e)e=gn.formatURL(e),h._setVolume(e,t);else{h.soundVolume=t;var i,n=0;for(n=h._channels.length-1;0<=n;n--)(i=h._channels[n]).url!=h._bgMusic&&(i.volume=t)}},h.setMusicVolume=function(t){h.musicVolume=t,h._setVolume(h._bgMusic,t)},h._setVolume=function(t,e){t=gn.formatURL(t);var i,n=0;for(n=h._channels.length-1;0<=n;n--)(i=h._channels[n]).url==t&&(i.volume=e)},h.musicVolume=1,h.soundVolume=1,h.playbackRate=1,h._useAudioMusic=!0,h._muted=!1,h._soundMuted=!1,h._musicMuted=!1,h._bgMusic=null,h._musicChannel=null,h._channels=[],h._autoStopMusic=!1,h._blurPaused=!1,h._isActive=!0,h._soundClass=null,h._musicClass=null,h._lastSoundUsedTimeDic={},h._isCheckingDispose=!1,h.autoReleaseSound=!0,h}(),Oi=function(){function t(t,e,i,n){this._idata=[]}I(t,"laya.layagl.CommandEncoder");var e=t.prototype;return e.getArrayData=function(){return this._idata},e.getPtrID=function(){return 0},e.beginEncoding=function(){},e.endEncoding=function(){},e.clearEncoding=function(){this._idata.length=0},e.getCount=function(){return this._idata.length},e.add_ShaderValue=function(t){this._idata.push(t)},e.addShaderUniform=function(t){this.add_ShaderValue(t)},t}(),Ni=function(){var h;function l(t){this.scale=1,this.currFrame=0,this._delta=0,this._map=[],this._handlers=[],this._temp=[],this._count=0,this.currTimer=Vt.now(),this._lastTimer=Vt.now(),void 0===t&&(t=!0),t&&T.systemTimer&&T.systemTimer.frameLoop(1,this,this._update)}I(l,"laya.utils.Timer");var t=l.prototype;return t._update=function(){if(this.scale<=0)this._lastTimer=Vt.now();else{var t=this.currFrame=this.currFrame+this.scale,e=Vt.now();this._delta=(e-this._lastTimer)*this.scale;var i=this.currTimer=this.currTimer+this._delta;this._lastTimer=e;for(var n=this._handlers,r=this._count=0,s=n.length;r<s;r++){var a=n[r];if(null!==a.method){var o=a.userFrame?t:i;if(o>=a.exeTime)if(a.repeat)if(a.jumpFrame)for(;o>=a.exeTime;)a.exeTime+=a.delay,a.run(!1);else a.exeTime+=a.delay,a.run(!1),o>a.exeTime&&(a.exeTime+=Math.ceil((o-a.exeTime)/a.delay)*a.delay);else a.run(!0)}else this._count++}(30<this._count||t%200==0)&&this._clearHandlers()}},t._clearHandlers=function(){for(var t=this._handlers,e=0,i=t.length;e<i;e++){var n=t[e];null!==n.method?this._temp.push(n):this._recoverHandler(n)}this._handlers=this._temp,t.length=0,this._temp=t},t._recoverHandler=function(t){this._map[t.key]==t&&(this._map[t.key]=null),t.clear(),l._pool.push(t)},t._create=function(t,e,i,n,r,s,a){if(!i)return r.apply(n,s),null;if(a){var o=this._getHandler(n,r);if(o)return o.repeat=e,o.userFrame=t,o.delay=i,o.caller=n,o.method=r,o.args=s,o.exeTime=i+(t?this.currFrame:this.currTimer+Vt.now()-this._lastTimer),o}return(o=0<l._pool.length?l._pool.pop():new h).repeat=e,o.userFrame=t,o.delay=i,o.caller=n,o.method=r,o.args=s,o.exeTime=i+(t?this.currFrame:this.currTimer+Vt.now()-this._lastTimer),this._indexHandler(o),this._handlers.push(o),o},t._indexHandler=function(t){var e=t.caller,i=t.method,n=e?e.$_GID||(e.$_GID=nt.getGID()):0,r=i.$_TID||(i.$_TID=1e5*l._mid++);t.key=n+r,this._map[t.key]=t},t.once=function(t,e,i,n,r){void 0===r&&(r=!0),this._create(!1,!1,t,e,i,n,r)},t.loop=function(t,e,i,n,r,s){void 0===r&&(r=!0),void 0===s&&(s=!1);var a=this._create(!1,!0,t,e,i,n,r);a&&(a.jumpFrame=s)},t.frameOnce=function(t,e,i,n,r){void 0===r&&(r=!0),this._create(!0,!1,t,e,i,n,r)},t.frameLoop=function(t,e,i,n,r){void 0===r&&(r=!0),this._create(!0,!0,t,e,i,n,r)},t.toString=function(){return" handlers:"+this._handlers.length+" pool:"+l._pool.length},t.clear=function(t,e){var i=this._getHandler(t,e);i&&(this._map[i.key]=null,i.key=0,i.clear())},t.clearAll=function(t){if(t)for(var e=0,i=this._handlers.length;e<i;e++){var n=this._handlers[e];n.caller===t&&(this._map[n.key]=null,n.key=0,n.clear())}},t._getHandler=function(t,e){var i=t?t.$_GID||(t.$_GID=nt.getGID()):0,n=e.$_TID||(e.$_TID=1e5*l._mid++);return this._map[i+n]},t.callLater=function(t,e,i){Ri.I.callLater(t,e,i)},t.runCallLater=function(t,e){Ri.I.runCallLater(t,e)},t.runTimer=function(t,e){var i=this._getHandler(t,e);i&&null!=i.method&&(this._map[i.key]=null,i.run(!0))},t.pause=function(){this.scale=0},t.resume=function(){this.scale=1},g(0,t,"delta",function(){return this._delta}),l._pool=[],l._mid=1,l.__init$=function(){h=function(){function t(){this.key=0,this.repeat=!1,this.delay=0,this.userFrame=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null,this.jumpFrame=!1}I(t,"");var e=t.prototype;return e.clear=function(){this.caller=null,this.method=null,this.args=null},e.run=function(t){var e=this.caller;if(e&&e.destroyed)return this.clear();var i=this.method,n=this.args;t&&this.clear(),null!=i&&(n?i.apply(e,n):i.call(e))},t}()},l}(),Pi=function(){function a(){this._mesh=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this._ref=1,this.srcRT=null,this._key=new Mt}I(a,"laya.webgl.submit.SubmitTarget");var t=a.prototype;return T.imps(t,{"laya.webgl.submit.ISubmit":!0}),t.renderSubmit=function(){var t=en.mainContext;this._mesh.useMesh(t);var e=this.srcRT;return e&&(this.shaderValue.texture=e._getSource(),this.shaderValue.upload(),this.blend(),$i.renderBatches++,$i.trianglesFaces+=this._numEle/3,en.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},t.blend=function(){if(cn.activeBlendFunction!==cn.fns[this.blendType]){var t=en.mainContext;t.enable(3042),cn.fns[this.blendType](t),cn.activeBlendFunction=cn.fns[this.blendType]}},t.getRenderType=function(){return 0},t.releaseRender=function(){if(--this._ref<1){var t=a.POOL;t[t._length++]=this}},t.reUse=function(t,e){return this._startIdx=e,this._ref++,e},a.create=function(t,e,i,n){var r=a.POOL._length?a.POOL[--a.POOL._length]:new a;if(r._mesh=e,r.srcRT=n,r._startIdx=e.indexNum*$e.BYTES_PIDX,r._ref=1,r._key.clear(),r._numEle=0,r.blendType=t._nBlendType,r._key.blendShader=r.blendType,r.shaderValue=i,r.shaderValue.setValue(t._shader2D),t._colorFiler){var s=t._colorFiler;i.defines.add(s.type),i.colorMat=s._mat,i.colorAlpha=s._alpha}return r},a.POOL=[],a.__init$=function(){a.POOL._length=0},a}(),Fi=function(){function e(t,e){this._mode=0,this._maxColorRGBKeysCount=0,this._maxColorAlphaKeysCount=0,this._colorRGBKeysCount=0,this._colorAlphaKeysCount=0,this._alphaElements=null,this._rgbElements=null,this._maxColorRGBKeysCount=t,this._maxColorAlphaKeysCount=e,this._rgbElements=new Float32Array(4*t),this._alphaElements=new Float32Array(2*e)}I(e,"laya.d3.core.Gradient");var t=e.prototype;return T.imps(t,{"laya.d3.core.IClone":!0}),t.addColorRGB=function(t,e){if(this._colorRGBKeysCount<this._maxColorRGBKeysCount){var i=4*this._colorRGBKeysCount;this._rgbElements[i]=t,this._rgbElements[i+1]=e.r,this._rgbElements[i+2]=e.g,this._rgbElements[i+3]=e.b,this._colorRGBKeysCount++}else console.warn("Gradient:warning:data count must lessEqual than "+this._maxColorRGBKeysCount)},t.addColorAlpha=function(t,e){if(this._colorAlphaKeysCount<this._maxColorAlphaKeysCount){var i=2*this._colorAlphaKeysCount;this._alphaElements[i]=t,this._alphaElements[i+1]=e,this._colorAlphaKeysCount++}else console.warn("Gradient:warning:data count must lessEqual than "+this._maxColorAlphaKeysCount)},t.updateColorRGB=function(t,e,i){if(t<this._colorRGBKeysCount){var n=4*t;this._rgbElements[n]=e,this._rgbElements[n+1]=i.r,this._rgbElements[n+2]=i.g,this._rgbElements[n+3]=i.b}else console.warn("Gradient:warning:index must lessEqual than colorRGBKeysCount:"+this._colorRGBKeysCount)},t.updateColorAlpha=function(t,e,i){if(t<this._colorAlphaKeysCount){var n=2*t;this._alphaElements[n]=e,this._alphaElements[n+1]=i}else console.warn("Gradient:warning:index must lessEqual than colorAlphaKeysCount:"+this._colorAlphaKeysCount)},t.cloneTo=function(t){var e=t,i=0,n=0;e._colorAlphaKeysCount=this._colorAlphaKeysCount;var r=e._alphaElements;for(r.length=this._alphaElements.length,i=0,n=this._alphaElements.length;i<n;i++)r[i]=this._alphaElements[i];e._colorRGBKeysCount=this._colorRGBKeysCount;var s=e._rgbElements;for(s.length=this._rgbElements.length,i=0,n=this._rgbElements.length;i<n;i++)s[i]=this._rgbElements[i]},t.clone=function(){var t=new e(this._maxColorRGBKeysCount,this._maxColorAlphaKeysCount);return this.cloneTo(t),t},g(0,t,"maxColorAlphaKeysCount",function(){return this._maxColorAlphaKeysCount}),g(0,t,"maxColorRGBKeysCount",function(){return this._maxColorRGBKeysCount}),g(0,t,"colorAlphaKeysCount",function(){return this._colorAlphaKeysCount/2}),g(0,t,"colorRGBKeysCount",function(){return this._colorRGBKeysCount/4}),g(0,t,"mode",function(){return this._mode},function(t){this._mode=t}),e}(),Bi=function(){function t(){}I(t,"laya.webgl.text.ICharRender");var e=t.prototype;return e.getWidth=function(t,e){return 0},e.scale=function(t,e){},e.getCharBmp=function(t,e,i,n,r,s,a,o,h,l,u){return null},g(0,e,"canvasWidth",function(){return 0},function(t){}),t}(),Vi=function(){function o(){}return I(o,"laya.net.AtlasInfoManager"),o.enable=function(t,e){T.loader.load(t,y.create(null,o._onInfoLoaded,[e]),null,"json")},o._onInfoLoaded=function(t,e){var i,n,r,s=0,a=0;for(i in e)for(n=(r=e[i])[0],a=(r=r[1]).length,s=0;s<a;s++)o._fileLoadDic[n+r[s]]=i;t&&t.run()},o.getFileLoadPath=function(t){return o._fileLoadDic[t]||t},o._fileLoadDic={},o}(),Ui=function(){function t(){this._pressedSprite=null,this._pressedLoopCount=-1,this.sprite=null,this.mousePositionX=0,this.mousePositionY=0}return I(t,"laya.d3.MouseTouch"),t}(),zi=function(){function n(){}I(n,"laya.display.cmd.TranslateCmd");var t=n.prototype;return t.recover=function(){p.recover("TranslateCmd",this)},t.run=function(t,e,i){t.translate(this.tx,this.ty)},g(0,t,"cmdID",function(){return"Translate"}),n.create=function(t,e){var i=p.getItemByClass("TranslateCmd",n);return i.tx=t,i.ty=e,i},n.ID="Translate",n}(),Gi=function(){function n(){this._type=0,this._constant=0,this._overTime=null,this._constantMin=0,this._constantMax=0,this._overTimeMin=null,this._overTimeMax=null}I(n,"laya.d3.core.particleShuriKen.module.FrameOverTime");var t=n.prototype;return T.imps(t,{"laya.d3.core.IClone":!0}),t.cloneTo=function(t){var e=t;e._type=this._type,e._constant=this._constant,this._overTime.cloneTo(e._overTime),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._overTimeMin.cloneTo(e._overTimeMin),this._overTimeMax.cloneTo(e._overTimeMax)},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},g(0,t,"frameOverTimeDataMax",function(){return this._overTimeMax}),g(0,t,"frameOverTimeDataMin",function(){return this._overTimeMin}),g(0,t,"type",function(){return this._type}),g(0,t,"constantMin",function(){return this._constantMin}),g(0,t,"frameOverTimeData",function(){return this._overTime}),g(0,t,"constant",function(){return this._constant}),g(0,t,"constantMax",function(){return this._constantMax}),n.createByConstant=function(t){var e=new n;return e._type=0,e._constant=t,e},n.createByOverTime=function(t){var e=new n;return e._type=1,e._overTime=t,e},n.createByRandomTwoConstant=function(t,e){var i=new n;return i._type=2,i._constantMin=t,i._constantMax=e,i},n.createByRandomTwoOverTime=function(t,e){var i=new n;return i._type=3,i._overTimeMin=t,i._overTimeMax=e,i},n}(),Hi=function(){function t(){}I(t,"laya.d3.component.AnimatorPlayState");var e=t.prototype;return e._resetPlayState=function(t){this._finish=!1,this._startPlayTime=t,this._elapsedTime=t,this._playEventIndex=0,this._lastIsFront=!0},e._cloneTo=function(t){t._finish=this._finish,t._startPlayTime=this._startPlayTime,t._elapsedTime=this._elapsedTime,t._playEventIndex=this._playEventIndex,t._lastIsFront=this._lastIsFront},g(0,e,"duration",function(){return this._duration}),g(0,e,"normalizedTime",function(){return this._normalizedTime}),t}(),ki=function(){function L(){}return I(L,"laya.webgl.shapes.BasePoly"),L.createLine2=function(t,e,i,n,r,s){if(t.length<4)return null;var a=L.tempData.length>t.length+2?L.tempData:new Array(t.length+2);a[0]=t[0],a[1]=t[1];var o=2,h=0,l=t.length;for(h=2;h<l;h+=2).01<Math.abs(t[h]-t[h-2])+Math.abs(t[h+1]-t[h-1])&&(a[o++]=t[h],a[o++]=t[h+1]);s&&.01<Math.abs(t[0]-a[o-2])+Math.abs(t[1]-a[o-1])&&(a[o++]=t[0],a[o++]=t[1]);var u=r;l=o/2;var c,_,d,f,p,m,g,v,T,y,E,x,S,C,I,R,A,M,D,b,w=i/2;d=a[0],f=a[1],y=d-(p=a[2]);T=(T=-(f-(m=a[3])))/(b=Math.sqrt(T*T+y*y))*w,y=y/b*w;for(u.push(d-T,f-y,d+T,f+y),h=1;h<l-1;h++)d=a[2*(h-1)],f=a[2*(h-1)+1],p=a[2*h],m=a[2*h+1],g=a[2*(h+1)],v=a[2*(h+1)+1],y=d-p,x=p-g,I=(-(T=(T=-(f-m))/(b=Math.sqrt(T*T+y*y))*w)+d)*(-(y=y/b*w)+m)-(-T+p)*(-y+f),M=(-(E=(E=-(m-v))/(b=Math.sqrt(E*E+x*x))*w)+g)*(-(x=x/b*w)+m)-(-E+p)*(-x+v),D=(S=-y+f-(-y+m))*(A=-E+p-(-E+g))-(R=-x+v-(-x+m))*(C=-T+p-(-T+d)),Math.abs(D)<.1?(D+=10.1,u.push(p-T,m-y,p+T,m+y)):(((c=(C*M-A*I)/D)-p)*(c-p)+((_=(R*I-S*M)/D)-m)+(_-m),u.push(c,_,p-(c-p),m-(_-m)));for(d=a[o-4],f=a[o-3],y=d-(p=a[o-2]),T=(T=-(f-(m=a[o-1])))/(b=Math.sqrt(T*T+y*y))*w,y=y/b*w,u.push(p-T,m-y,p+T,m+y),h=1;h<l;h++)e.push(n+2*(h-1),n+2*(h-1)+1,n+2*h+1,n+2*h+1,n+2*h,n+2*(h-1));return u},L.createLineTriangle=function(t,e,i,n,r,s,a){var o=t.slice(),h=o.length,l=o[0],u=o[1],c=o[2],_=(o[2],0),d=0,f=0,p=0,m=h/2;if(!(m<=1)&&2!=m){for(var g=new Array(4*m),v=0,T=0,y=0;y<m-1;y++)l=o[T++],u=o[T++],c=o[T++],p=o[T++]-u,0!=(f=c-l)&&0!=p&&.001<(_=Math.sqrt(f*f+p*p))&&(g[d=4*v]=l,g[d+1]=u,g[d+2]=f/_,g[d+3]=p/_,v++);for(n?(l=o[h-2],u=o[h-1],c=o[0],p=o[1]-u,0!=(f=c-l)&&0!=p&&.001<(_=Math.sqrt(f*f+p*p))&&(g[d=4*v]=l,g[d+1]=u,g[d+2]=f/_,g[d+3]=p/_,v++)):(g[d=4*v]=l,g[d+1]=u,g[d+2]=f/_,g[d+3]=p/_,v++),y=T=0;y<m;y++){l=o[T],u=o[T+1],c=o[T+2],o[T+3];o[T+4],o[T+5]}}},E(L,["tempData",function(){return this.tempData=new Array(256)}]),L}(),Wi=function(){function t(){this.renderType=0}I(t,"laya.d3.core.render.RenderElement");var e=t.prototype;return e.setTransform=function(t){this._transform=t},e.setGeometry=function(t){this._geometry=t},e.addToOpaqueRenderQueue=function(t,e){e.elements.push(this)},e.addToTransparentRenderQueue=function(t,e){e.elements.push(this),e.lastTransparentBatched=!1,e.lastTransparentRenderElement=this},e._render=function(t,e,i,n){var r,s,a,o=Ia._updateMark,h=t.scene,l=t.camera,u=this._transform,c=this._geometry,_=o!==(t.renderElement=this).render._updateMark||this.renderType!==this.render._updateRenderType;if(_&&(this.render._renderUpdate(t,u),this.render._renderUpdateWithCamera(t,u),this.render._updateMark=o,this.render._updateRenderType=this.renderType),c._prepareRender(t)){var d,f=this.material._shader.getSubShaderAt(0);if(i)if(n){var p=f.getFlag(n);if(!p)return;for(var m=i._subShaders,g=0,v=m.length;g<v;g++){var T=m[g];if(p===T.getFlag(n)){d=T._passes;break}}if(!d)return}else d=i.getSubShaderAt(0)._passes;else d=f._passes;for(var y=0,E=d.length;y<E;y++){var x=t.shader=d[y].withCompile(h._defineDatas.value&~this.material._disablePublicDefineDatas.value,this.render._defineDatas.value,this.material._defineDatas.value),S=x.bind(),C=o!==x._uploadMark,I=x._uploadScene!==h||C;(I||S)&&(x.uploadUniforms(x._sceneUniformParamsMap,h._shaderValues,I),x._uploadScene=h);var R=x._uploadRender!==this.render||x._uploadRenderType!==this.renderType||C;(R||S)&&(x.uploadUniforms(x._spriteUniformParamsMap,this.render._shaderValues,R),x._uploadRender=this.render,x._uploadRenderType=this.renderType);var A=x._uploadCamera!==l||C;(A||S)&&(x.uploadUniforms(x._cameraUniformParamsMap,l._shaderValues,A),x._uploadCamera=l);var M=x._uploadMaterial!==this.material||C;(M||S)&&(x.uploadUniforms(x._materialUniformParamsMap,this.material._shaderValues,M),x._uploadMaterial=this.material);var D=this.material._shaderValues;r!==this.material||s!==x?(x.uploadRenderStateBlendDepth(D),x.uploadRenderStateFrontFace(D,e,u),r=this.material,s=x,a=this.render):a!==this.render&&(x.uploadRenderStateFrontFace(D,e,u),a=this.render),c._render(t),x._uploadMark=o}}_&&0!==this.renderType&&this.render._revertBatchRenderUpdate(t),Ia._updateMark++},e.destroy=function(){this._transform=null,this._geometry=null,this.material=null,this.render=null},t.RENDERTYPE_NORMAL=0,t.RENDERTYPE_STATICBATCH=1,t.RENDERTYPE_INSTANCEBATCH=2,t.RENDERTYPE_VERTEXBATCH=3,t}(),Xi=function(){function l(){this._type=0,this._separateAxes=!1,this._constant=NaN,this._constantSeparate=null,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._gradientW=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null,this._gradientWMin=null,this._gradientWMax=null}I(l,"laya.d3.core.particleShuriKen.module.GradientAngularVelocity");var t=l.prototype;return T.imps(t,{"laya.d3.core.IClone":!0}),t.cloneTo=function(t){var e=t;e._type=this._type,e._separateAxes=this._separateAxes,e._constant=this._constant,this._constantSeparate.cloneTo(e._constantSeparate),this._gradient.cloneTo(e._gradient),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(e._constantMinSeparate),this._constantMaxSeparate.cloneTo(e._constantMaxSeparate),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},g(0,t,"gradientWMin",function(){return this._gradientWMin}),g(0,t,"gradientZMax",function(){return this._gradientZMax}),g(0,t,"gradientZMin",function(){return this._gradientZMin}),g(0,t,"gradientYMax",function(){return this._gradientYMax}),g(0,t,"gradientYMin",function(){return this._gradientYMin}),g(0,t,"gradientMax",function(){return this._gradientMax}),g(0,t,"gradientMin",function(){return this._gradientMin}),g(0,t,"constantMaxSeparate",function(){return this._constantMaxSeparate}),g(0,t,"constantMax",function(){return this._constantMax}),g(0,t,"gradientW",function(){return this._gradientW}),g(0,t,"gradientXMax",function(){return this._gradientXMax}),g(0,t,"constantMinSeparate",function(){return this._constantMinSeparate}),g(0,t,"gradientY",function(){return this._gradientY}),g(0,t,"gradientZ",function(){return this._gradientZ}),g(0,t,"gradientX",function(){return this._gradientX}),g(0,t,"constantSeparate",function(){return this._constantSeparate}),g(0,t,"constant",function(){return this._constant}),g(0,t,"gradientWMax",function(){return this._gradientWMax}),g(0,t,"gradient",function(){return this._gradient}),g(0,t,"separateAxes",function(){return this._separateAxes}),g(0,t,"constantMin",function(){return this._constantMin}),g(0,t,"gradientXMin",function(){return this._gradientXMin}),g(0,t,"type",function(){return this._type}),l.createByConstant=function(t){var e=new l;return e._type=0,e._separateAxes=!1,e._constant=t,e},l.createByConstantSeparate=function(t){var e=new l;return e._type=0,e._separateAxes=!0,e._constantSeparate=t,e},l.createByGradient=function(t){var e=new l;return e._type=1,e._separateAxes=!1,e._gradient=t,e},l.createByGradientSeparate=function(t,e,i){var n=new l;return n._type=1,n._separateAxes=!0,n._gradientX=t,n._gradientY=e,n._gradientZ=i,n},l.createByRandomTwoConstant=function(t,e){var i=new l;return i._type=2,i._separateAxes=!1,i._constantMin=t,i._constantMax=e,i},l.createByRandomTwoConstantSeparate=function(t,e){var i=new l;return i._type=2,i._separateAxes=!0,i._constantMinSeparate=t,i._constantMaxSeparate=e,i},l.createByRandomTwoGradient=function(t,e){var i=new l;return i._type=3,i._separateAxes=!1,i._gradientMin=t,i._gradientMax=e,i},l.createByRandomTwoGradientSeparate=function(t,e,i,n,r,s,a,o){var h=new l;return h._type=3,h._separateAxes=!0,h._gradientXMin=t,h._gradientXMax=e,h._gradientYMin=i,h._gradientYMax=n,h._gradientZMin=r,h._gradientZMax=s,h._gradientWMin=a,h._gradientWMax=o,h},l}(),Yi=function(){function t(){}return I(t,"laya.d3.resource.TextureGenerator"),t.lightAttenTexture=function(t,e,i,n,r,s){var a=t/i,o=1/(1+25*a);.64<=a&&(1<a?o=0:o*=1-(a-.64)/.36),s[r]=Math.floor(255*o+.5)},t.haloTexture=function(t,e,i,n,r,s){var a=(t-(i>>=1))/i,o=(e-(n>>=1))/n,h=a*a+o*o;1<h&&(h=1),s[r]=Math.floor(255*(1-h)+.5)},t._generateTexture2D=function(t,e,i,n){var r=0,s=0;switch(t.format){case 0:s=3;break;case 1:s=4;break;case 2:s=1;break;default:throw"GeneratedTexture._generateTexture: unkonw texture format."}for(var a=new Uint8Array(e*i*s),o=0;o<i;o++)for(var h=0;h<e;h++)n(h,o,e,i,r,a),r+=s;t.setPixels(a)},t}(),Zi=function(){function n(){this._type=0,this._constant=null,this._constantMin=null,this._constantMax=null,this._gradient=null,this._gradientMin=null,this._gradientMax=null}I(n,"laya.d3.core.particleShuriKen.module.GradientColor");var t=n.prototype;return T.imps(t,{"laya.d3.core.IClone":!0}),t.cloneTo=function(t){var e=t;e._type=this._type,this._constant.cloneTo(e._constant),this._constantMin.cloneTo(e._constantMin),this._constantMax.cloneTo(e._constantMax),this._gradient.cloneTo(e._gradient),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax)},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},g(0,t,"gradientMax",function(){return this._gradientMax}),g(0,t,"gradientMin",function(){return this._gradientMin}),g(0,t,"constant",function(){return this._constant}),g(0,t,"gradient",function(){return this._gradient}),g(0,t,"type",function(){return this._type}),g(0,t,"constantMin",function(){return this._constantMin}),g(0,t,"constantMax",function(){return this._constantMax}),n.createByConstant=function(t){var e=new n;return e._type=0,e._constant=t,e},n.createByGradient=function(t){var e=new n;return e._type=1,e._gradient=t,e},n.createByRandomTwoConstant=function(t,e){var i=new n;return i._type=2,i._constantMin=t,i._constantMax=e,i},n.createByRandomTwoGradient=function(t,e){var i=new n;return i._type=3,i._gradientMin=t,i._gradientMax=e,i},n}(),ji=(function(){function t(){}I(t,"laya.d3.core.TextureMode"),t.Stretch=0,t.Tile=1}(),function(){var i;function H(){if(this._drawTriUseAbsMatrix=!1,this._id=++H._COUNT,this._other=null,this._renderNextSubmitIndex=0,this._path=null,this._drawCount=1,this._renderCount=0,this._isConvexCmd=!0,this._submits=null,this._curSubmit=null,this._mesh=null,this._pathMesh=null,this._triangleMesh=null,this.meshlist=[],this._clipInCache=!1,this._clipInfoID=0,this._curMat=null,this._lastMatScaleX=1,this._lastMatScaleY=1,this._lastMat_a=1,this._lastMat_b=0,this._lastMat_c=0,this._lastMat_d=1,this._nBlendType=0,this._save=null,this._targets=null,this._charSubmitCache=null,this._saveMark=null,this.sprite=null,this._italicDeg=0,this._lastTex=null,this._fillColor=0,this._flushCnt=0,this.defTexture=null,this._colorFiler=null,this.drawTexAlign=!1,this._incache=!1,this.isMain=!1,this._tmpMatrix=new It,this._drawTexToDrawTri_Vert=new Float32Array(8),this._drawTexToDrawTri_Index=new Uint16Array([0,1,2,0,2,3]),this._tempUV=new Float32Array(8),this._width=99999999,this._height=99999999,this._submitKey=new Mt,this._transedPoints=new Array(8),this._temp4Points=new Array(8),this._clipRect=H.MAXCLIPRECT,this._globalClipMatrix=new It(99999999,0,0,99999999,0,0),this._shader2D=new zt,H._contextcount++,!this.defTexture){var t=new ea(2,2);t.setPixels(new Uint8Array(16)),t.lock=!0,this.defTexture=new xr(t)}this._lastTex=this.defTexture,this.clear()}I(H,"laya.resource.Context");var t=H.prototype;return t.drawImage=function(t){},t.getImageData=function(t){},t.measureText=function(t){return null},t.setTransform=function(t){},t.$transform=function(t,e,i,n,r,s){},t.clearRect=function(t,e,i,n){},t._drawRect=function(t,e,i,n,r){$i.renderBatches++,r&&(this.fillStyle=r),this.fillRect(t,e,i,n)},t.drawTexture2=function(t,e,i,n,r,s){},t.transformByMatrix=function(t,e,i){this.transform(t.a,t.b,t.c,t.d,t.tx+e,t.ty+i)},t.saveTransform=function(t){this.save()},t.restoreTransform=function(t){this.restore()},t.drawRect=function(t,e,i,n,r,s,a){null!=r&&(this.fillStyle=r,this.fillRect(t,e,i,n)),null!=s&&(this.strokeStyle=s,this.lineWidth=a,this.strokeRect(t,e,i,n))},t.alpha=function(t){this.globalAlpha*=t},t._transform=function(t,e,i){this.translate(e,i),this.transform(t.a,t.b,t.c,t.d,t.tx,t.ty),this.translate(-e,-i)},t._rotate=function(t,e,i){this.translate(e,i),this.rotate(t),this.translate(-e,-i)},t._scale=function(t,e,i,n){this.translate(i,n),this.scale(t,e),this.translate(-i,-n)},t._drawLine=function(t,e,i,n,r,s,a,o,h){this.beginPath(),this.strokeStyle=a,this.lineWidth=o,this.moveTo(t+i,e+n),this.lineTo(t+r,e+s),this.stroke()},t._drawLines=function(t,e,i,n,r,s){this.beginPath(),this.strokeStyle=n,this.lineWidth=r;i.length;this.addPath(i.slice(),!1,!1,t,e),this.stroke()},t.drawCurves=function(t,e,i,n,r){this.beginPath(),this.strokeStyle=n,this.lineWidth=r,this.moveTo(t+i[0],e+i[1]);for(var s=2,a=i.length;s<a;)this.quadraticCurveTo(t+i[s++],e+i[s++],t+i[s++],e+i[s++]);this.stroke()},t._fillAndStroke=function(t,e,i,n){void 0===n&&(n=!1),null!=t&&(this.fillStyle=t,this.fill()),null!=e&&0<i&&(this.strokeStyle=e,this.lineWidth=i,this.stroke())},t._drawCircle=function(t,e,i,n,r,s,a){$i.renderBatches++,this.beginPath(!0),this.arc(t,e,i,0,H.PI2),this.closePath(),this._fillAndStroke(n,r,s)},t._drawPie=function(t,e,i,n,r,s,a,o,h){this.beginPath(),this.moveTo(t,e),this.arc(t,e,i,n,r),this.closePath(),this._fillAndStroke(s,a,o)},t._drawPoly=function(t,e,i,n,r,s,a,o){i.length;this.beginPath(),this.addPath(i.slice(),!0,a,t,e),this.closePath(),this._fillAndStroke(n,r,s,a)},t._drawPath=function(t,e,i,n,r){this.beginPath();for(var s=0,a=i.length;s<a;s++){var o=i[s];switch(o[0]){case"moveTo":this.moveTo(t+o[1],e+o[2]);break;case"lineTo":this.lineTo(t+o[1],e+o[2]);break;case"arcTo":this.arcTo(t+o[1],e+o[2],t+o[3],e+o[4],o[5]);break;case"closePath":this.closePath()}}null!=n&&(this.fillStyle=n.fillStyle,this.fill()),null!=r&&(this.strokeStyle=r.strokeStyle,this.lineWidth=r.lineWidth||1,this.lineJoin=r.lineJoin,this.lineCap=r.lineCap,this.miterLimit=r.miterLimit,this.stroke())},t.clearBG=function(t,e,i,n){var r=en.mainContext;r.clearColor(t,e,i,n),r.clear(16384)},t._getSubmits=function(){return this._submits},t._releaseMem=function(t){if(void 0===t&&(t=!1),this._submits){this._curMat.destroy(),this._curMat=null,this._shader2D.destroy(),this._shader2D=null,this._charSubmitCache.clear();for(var e=0,i=this._submits._length;e<i;e++)this._submits[e].releaseRender();this._submits.length=0,this._submits._length=0,this._submits=null,this._curSubmit=null,this._path=null,this._save=null;var n;for(e=0,n=this.meshlist.length;e<n;e++){this.meshlist[e].destroy()}this.meshlist.length=0,this.sprite=null,t||(this._targets&&this._targets.destroy(),this._targets=null)}},t.destroy=function(t){void 0===t&&(t=!1),--H._contextcount,this.sprite=null,this._releaseMem(t),this._charSubmitCache.destroy(),this._mesh.destroy(),t||(this._targets&&this._targets.destroy(),this._targets=null)},t.clear=function(){this._submits||(this._other=i.DEFAULT,this._curMat=It.create(),this._charSubmitCache=new A,this._mesh=or.getAMesh(this.isMain),this.meshlist.push(this._mesh),this._pathMesh=Yr.getAMesh(this.isMain),this.meshlist.push(this._pathMesh),this._triangleMesh=Fr.getAMesh(this.isMain),this.meshlist.push(this._triangleMesh),this._submits=[],this._save=[Ke.Create(this)],this._save.length=10,this._shader2D=new zt),this._submitKey.clear(),this._mesh.clearVB(),this._renderCount++,this._drawCount=1,this._other=i.DEFAULT,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=H.MAXCLIPRECT,this._curSubmit=yt.RENDERBASE,yt.RENDERBASE._ref=16777215,yt.RENDERBASE._numEle=0,this._shader2D.fillStyle=this._shader2D.strokeStyle=Ye.DEFAULT;for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},t.size=function(t,e){this._width==t&&this._height==e||(this._width=t,this._height=e,this._targets&&(this._targets.destroy(),this._targets=new da(t,e,1,-1)),qi._context==this&&(en.mainContext.viewport(0,0,t,e),Q.width=t,Q.height=e)),0===t&&0===e&&this._releaseMem()},t.getMatScaleX=function(){return this._lastMat_a==this._curMat.a&&this._lastMat_b==this._curMat.b||(this._lastMatScaleX=this._curMat.getScaleX(),this._lastMat_a=this._curMat.a,this._lastMat_b=this._curMat.b),this._lastMatScaleX},t.getMatScaleY=function(){return this._lastMat_c==this._curMat.c&&this._lastMat_d==this._curMat.d||(this._lastMatScaleY=this._curMat.getScaleY(),this._lastMat_c=this._curMat.c,this._lastMat_d=this._curMat.d),this._lastMatScaleY},t.setFillColor=function(t){this._fillColor=t},t.getFillColor=function(){return this._fillColor},t.translate=function(t,e){0===t&&0===e||(re.save(this),this._curMat._bTransform?(ri.save(this),this._curMat.tx+=t*this._curMat.a+e*this._curMat.c,this._curMat.ty+=t*this._curMat.b+e*this._curMat.d):(this._curMat.tx=t,this._curMat.ty=e))},t.save=function(){this._save[this._save._length++]=Ke.Create(this)},t.restore=function(){var t=this._save._length,e=this._nBlendType;if(!(t<1)){for(var i=t-1;0<=i;i--){var n=this._save[i];if(n.restore(this),n.isSaveMark())return void(this._save._length=i)}e!=this._nBlendType&&(this._curSubmit=yt.RENDERBASE)}},t.fillText=function(t,e,i,n,r,s){this._fillText(t,null,e,i,n,r,null,0,null)},t._fillText=function(t,e,i,n,r,s,a,o,h,l){void 0===l&&(l=0),t?H._textRender.filltext(this,t,i,n,r,s,a,o,h,l):e&&H._textRender.fillWords(this,e,i,n,r,s,a,o)},t._fast_filltext=function(t,e,i,n,r,s,a,o,h){void 0===h&&(h=0),H._textRender._fast_filltext(this,t,null,e,i,n,r,s,a,o,h)},t.fillWords=function(t,e,i,n,r){this._fillText(null,t,e,i,n,r,null,-1,null,0)},t.fillBorderWords=function(t,e,i,n,r,s,a){this._fillBorderText(null,t,e,i,n,r,s,a,null)},t.drawText=function(t,e,i,n,r,s){this._fillText(t,null,e,i,n,f.create(r).strColor,null,-1,s)},t.strokeWord=function(t,e,i,n,r,s,a){this._fillText(t,null,e,i,n,null,f.create(r).strColor,s||1,a)},t.fillBorderText=function(t,e,i,n,r,s,a,o){this._fillBorderText(t,null,e,i,n,f.create(r).strColor,f.create(s).strColor,a,o)},t._fillBorderText=function(t,e,i,n,r,s,a,o,h){this._fillText(t,e,i,n,r,s,a,o||1,h)},t._fillRect=function(t,e,i,n,r){var s=this._curSubmit,a=s&&2===s._key.submitType&&s._key.blendShader===this._nBlendType;65535<this._mesh.vertNum+4&&(this._mesh=or.getAMesh(this.isMain),this.meshlist.push(this._mesh),a=!1),a&&(a=a&&this.isSameClipInfo(s)),this.transformQuad(t,e,i,n,0,this._curMat,this._transedPoints),this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,xr.NO_UV,r,!1),a||(s=this._curSubmit=rr.create(this,this._mesh,Ot.create(1,0)),this._submits[this._submits._length++]=s,this._copyClipInfo(s,this._globalClipMatrix),s.shaderValue.textureHost=this._lastTex,s._key.other=this._lastTex&&this._lastTex.bitmap?this._lastTex.bitmap.id:-1,s._renderType=10016),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)},t.fillRect=function(t,e,i,n,r){var s=r?Ye.create(r):this._shader2D.fillStyle,a=this.mixRGBandAlpha(s.toInt());this._fillRect(t,e,i,n,a)},t.fillTexture=function(t,e,i,n,r,s,a,o){t._getSource()?this._fillTexture(t,t.width,t.height,t.uvrect,e,i,n,r,s,a.x,a.y):this.sprite&&T.systemTimer.callLater(this,this._repaintSprite)},t._fillTexture=function(t,e,i,n,r,s,a,o,h,l,u){var c=this._curSubmit;65535<this._mesh.vertNum+4&&(this._mesh=or.getAMesh(this.isMain),this.meshlist.push(this._mesh));var _=!0,d=!0;switch(h){case"repeat":break;case"repeat-x":d=!1;break;case"repeat-y":_=!1;break;case"no-repeat":_=d=!1}var f=this._temp4Points,p=0,m=0,g=0,v=0,T=0,y=0;if(l<0?(g=r,p=-l%e/e):g=r+l,u<0?(v=s,m=-u%i/i):v=s+u,T=r+a,y=s+o,!_&&(T=Math.min(T,r+l+e)),!d&&(y=Math.min(y,s+u+i)),!(T<r||y<s||T<g||y<v)){var E=(T-r-l)/e,x=(y-s-u)/i;if(this.transformQuad(g,v,T-g,y-v,0,this._curMat,this._transedPoints),f[0]=p,f[1]=m,f[2]=E,f[3]=m,f[4]=E,f[5]=x,f[6]=p,f[7]=x,!this.clipedOff(this._transedPoints)){var S=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA);this._mesh.addQuad(this._transedPoints,f,S,!0);var C=Ot.create(1,0);C.defines.add(256),C.u_TexRange=n,c=this._curSubmit=rr.create(this,this._mesh,C),this._submits[this._submits._length++]=c,this._copyClipInfo(c,this._globalClipMatrix),c.shaderValue.textureHost=t,c._renderType=10016,this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4}this.breakNextMerge()}},t.setColorFilter=function(t){a.save(this,8388608,this,!0),this._colorFiler=t,this._curSubmit=yt.RENDERBASE},t.drawTexture=function(t,e,i,n,r){this._drawTextureM(t,e,i,n,r,null,1,null)},t.drawTextures=function(t,e,i,n){if(t._getSource())for(var r=e.length/2,s=0,a=t.bitmap.id,o=0;o<r;o++)this._inner_drawTexture(t,a,e[s++]+i,e[s++]+n,0,0,null,null,1,!1);else this.sprite&&T.systemTimer.callLater(this,this._repaintSprite)},t._drawTextureAddSubmit=function(t,e){var i=null;i=rr.create(this,this._mesh,Ot.create(1,0)),(this._submits[this._submits._length++]=i).shaderValue.textureHost=e,i._key.other=t,i._renderType=10016,this._curSubmit=i},t._drawTextureM=function(t,e,i,n,r,s,a,o){var h=this.sprite;return!!t._getSource(function(){h&&h.repaint()})&&this._inner_drawTexture(t,t.bitmap.id,e,i,n,r,s,o,a,!1)},t._drawRenderTexture=function(t,e,i,n,r,s,a,o){return this._inner_drawTexture(t,-1,e,i,n,r,s,o,1,!1)},t.submitDebugger=function(){this._submits[this._submits._length++]=Yt.create([],function(){},this)},t._copyClipInfo=function(t,e){var i=t.shaderValue.clipMatDir;i[0]=e.a,i[1]=e.b,i[2]=e.c,i[3]=e.d;var n=t.shaderValue.clipMatPos;n[0]=e.tx,n[1]=e.ty,t.clipInfoID=this._clipInfoID,this._clipInCache&&(t.shaderValue.clipOff[0]=1)},t.isSameClipInfo=function(t){return t.clipInfoID===this._clipInfoID},t._useNewTex2DSubmit=function(t,e){65535<this._mesh.vertNum+e&&(this._mesh=or.getAMesh(this.isMain),this.meshlist.push(this._mesh));var i=rr.create(this,this._mesh,Ot.create(1,0));this._submits[this._submits._length++]=this._curSubmit=i,i.shaderValue.textureHost=t,this._copyClipInfo(i,this._globalClipMatrix)},t._drawTexRect=function(t,e,i,n,r){this.transformQuad(t,e,i,n,this._italicDeg,this._curMat,this._transedPoints);var s=this._transedPoints;s[0]=s[0]+.5|0,s[1]=s[1]+.5|0,s[2]=s[2]+.5|0,s[3]=s[3]+.5|0,s[4]=s[4]+.5|0,s[5]=s[5]+.5|0,s[6]=s[6]+.5|0,s[7]=s[7]+.5|0,this.clipedOff(this._transedPoints)||(this._mesh.addQuad(this._transedPoints,r,this._fillColor,!0),this._curSubmit._numEle+=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4)},t.drawCallOptimize=function(t){return this._charSubmitCache.enable(t,this),t},t._inner_drawTexture=function(t,e,i,n,r,s,a,o,h,l){var u=this._curSubmit._key;if(o=o||t._uv,4===u.submitType&&u.other===e){var c=this._drawTexToDrawTri_Vert;c[0]=i,c[1]=n,c[2]=i+r,c[3]=n,c[4]=i+r,c[5]=n+s,c[6]=i,c[7]=n+s,this._drawTriUseAbsMatrix=!0;var _=this._tempUV;return _[0]=o[0],_[1]=o[1],_[2]=o[2],_[3]=o[3],_[4]=o[4],_[5]=o[5],_[6]=o[6],_[7]=o[7],this.drawTriangles(t,0,0,c,_,this._drawTexToDrawTri_Index,a,h,null,null),!(this._drawTriUseAbsMatrix=!1)}var d=this._mesh,f=this._curSubmit,p=l?this._charSubmitCache.getPos():this._transedPoints;if(this.transformQuad(i,n,r||t.width,s||t.height,this._italicDeg,a||this._curMat,p),this.drawTexAlign){var m=Math.round;p[0]=m(p[0]),p[1]=m(p[1]),p[2]=m(p[2]),p[3]=m(p[3]),p[4]=m(p[4]),p[5]=m(p[5]),p[6]=m(p[6]),p[7]=m(p[7]),this.drawTexAlign=!1}var g=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*h);if(l)return this._charSubmitCache.add(this,t,e,p,o,g),!0;this._drawCount++;var v=0<=e&&2===u.submitType&&u.other===e;return v&&(v=v&&this.isSameClipInfo(f)),this._lastTex=t,65535<d.vertNum+4&&(d=this._mesh=or.getAMesh(this.isMain),this.meshlist.push(d),v=!1),d.addQuad(p,o,g,!0),v||(this._submits[this._submits._length++]=this._curSubmit=f=rr.create(this,d,Ot.create(1,0)),f.shaderValue.textureHost=t,f._key.other=e,this._copyClipInfo(f,this._globalClipMatrix)),f._numEle+=6,d.indexNum+=6,d.vertNum+=4,!0},t.transform4Points=function(t,e,i){var n=e.tx,r=e.ty,s=e.a,a=e.b,o=e.c,h=e.d,l=t[0],u=t[1],c=t[2],_=t[3],d=t[4],f=t[5],p=t[6],m=t[7];e._bTransform?(i[0]=l*s+u*o+n,i[1]=l*a+u*h+r,i[2]=c*s+_*o+n,i[3]=c*a+_*h+r,i[4]=d*s+f*o+n,i[5]=d*a+f*h+r,i[6]=p*s+m*o+n,i[7]=p*a+m*h+r):(i[0]=l+n,i[1]=u+r,i[2]=c+n,i[3]=_+r,i[4]=d+n,i[5]=f+r,i[6]=p+n,i[7]=m+r)},t.clipedOff=function(t){return this._clipRect.width<=0||this._clipRect.height<=0},t.transformQuad=function(t,e,i,n,r,s,a){var o=0;0!=r&&(o=Math.tan(r*Math.PI/180)*n);var h=t+i,l=e+n,u=s.tx,c=s.ty,_=s.a,d=s.b,f=s.c,p=s.d,m=t+o,g=e,v=h+o,T=e,y=h,E=l,x=t,S=l;s._bTransform?(a[0]=m*_+g*f+u,a[1]=m*d+g*p+c,a[2]=v*_+T*f+u,a[3]=v*d+T*p+c,a[4]=y*_+E*f+u,a[5]=y*d+E*p+c,a[6]=x*_+S*f+u,a[7]=x*d+S*p+c):(a[0]=m+u,a[1]=g+c,a[2]=v+u,a[3]=T+c,a[4]=y+u,a[5]=E+c,a[6]=x+u,a[7]=S+c)},t.pushRT=function(){this.addRenderObject(Yt.create(null,da.pushRT,this))},t.popRT=function(){this.addRenderObject(Yt.create(null,da.popRT,this)),this.breakNextMerge()},t.useRT=function(t){this.addRenderObject(Yt.create([t],function(t){if(!t)throw"error useRT";t.start(),t.clear(0,0,0,0)},this)),this.breakNextMerge()},t.RTRestore=function(t){this.addRenderObject(Yt.create([t],function(t){t.restore()},this)),this.breakNextMerge()},t.breakNextMerge=function(){this._curSubmit=yt.RENDERBASE},t._repaintSprite=function(){this.sprite&&this.sprite.repaint()},t.drawTextureWithTransform=function(t,e,i,n,r,s,a,o,h,l,u){var c=null,_=this._curMat;l&&(c=this.globalCompositeOperation,this.globalCompositeOperation=l);var d=this._colorFiler;if(u&&this.setColorFilter(u),!s)return this._drawTextureM(t,e+a,i+o,n,r,_,h,null),l&&(this.globalCompositeOperation=c),void(u&&this.setColorFilter(d));var f=this._tmpMatrix;f.a=s.a,f.b=s.b,f.c=s.c,f.d=s.d,f.tx=s.tx+a,f.ty=s.ty+o,f._bTransform=s._bTransform,s&&_._bTransform?(It.mul(f,_,f),(s=f)._bTransform=!0):(f.tx+=_.tx,f.ty+=_.ty,s=f),this._drawTextureM(t,e,i,n,r,s,h,null),l&&(this.globalCompositeOperation=c),u&&this.setColorFilter(d)},t._flushToTarget=function(t,e){Q.worldScissorTest=!1,en.mainContext.disable(3089);var i=Q.worldAlpha,n=Q.worldMatrix4,r=Q.worldMatrix;Q.worldShaderDefines;Q.worldMatrix=It.EMPTY,Q.restoreTempArray(),Q.worldMatrix4=Q.TEMPMAT4_ARRAY,Q.worldAlpha=1,rs.activeShader=null,e.start(),0<t._submits._length&&e.clear(0,0,0,0),t._curSubmit=yt.RENDERBASE,t.flush(),t.clear(),e.restore(),t._curSubmit=yt.RENDERBASE,rs.activeShader=null,Q.worldAlpha=i,Q.worldMatrix4=n,Q.worldMatrix=r},t.drawCanvas=function(t,e,i,n,r){if(t){var s,a=t.context;if(a._targets)0<a._submits._length&&(s=Yt.create([a,a._targets],this._flushToTarget,this),this._submits[this._submits._length++]=s),this._drawRenderTexture(a._targets,e,i,n,r,null,1,da.flipyuv),this._curSubmit=yt.RENDERBASE;else{var o=t;o.touches&&o.touches.forEach(function(t){t.touch()}),s=Br.create(t,this._shader2D.ALPHA,this._shader2D.filters),(this._submits[this._submits._length++]=s)._key.clear();var h=s._matrix;this._curMat.copyTo(h);var l=h.tx,u=h.ty;h.tx=h.ty=0,h.transformPoint(R.TEMP.setTo(e,i)),h.translate(R.TEMP.x+l,R.TEMP.y+u),It.mul(o.invMat,h,h),this._curSubmit=yt.RENDERBASE}}},t.drawTarget=function(t,e,i,n,r,s,a,o,h){void 0===h&&(h=-1),this._drawCount++;if(65535<this._mesh.vertNum+4&&(this._mesh=or.getAMesh(this.isMain),this.meshlist.push(this._mesh)),this.transformQuad(e,i,n,r,0,s||this._curMat,this._transedPoints),this.clipedOff(this._transedPoints))return this._curSubmit=yt.RENDERBASE,!1;this._mesh.addQuad(this._transedPoints,o||xr.DEF_UV,4294967295,!0);var l=this._curSubmit=Pi.create(this,this._mesh,a,t);return l.blendType=-1==h?this._nBlendType:h,this._copyClipInfo(l,this._globalClipMatrix),l._numEle=6,this._mesh.indexNum+=6,this._mesh.vertNum+=4,this._submits[this._submits._length++]=l,this._curSubmit=yt.RENDERBASE,!0},t.drawTriangles=function(t,e,i,n,r,s,a,o,h,l){if(t._getSource()){this._drawCount++;var u=this._tmpMatrix,c=this._triangleMesh,_=null,d=!1;h&&(_=this._colorFiler,this._colorFiler=h,this._curSubmit=yt.RENDERBASE,d=_!=h);var f=t.bitmap,p=this._curSubmit._key,m=4===p.submitType&&p.other===f.id&&p.blendShader==this._nBlendType;if(65535<c.vertNum+n.length/2&&(c=this._triangleMesh=Fr.getAMesh(this.isMain),this.meshlist.push(c),m=!1),!m){var g=this._curSubmit=rr.create(this,c,Ot.create(1,0));g.shaderValue.textureHost=t,g._renderType=10016,g._key.submitType=4,g._key.other=f.id,this._copyClipInfo(g,this._globalClipMatrix),this._submits[this._submits._length++]=g}var v=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*o);this._drawTriUseAbsMatrix?c.addData(n,r,s,a,v):(u.ty=a?(u.a=a.a,u.b=a.b,u.c=a.c,u.d=a.d,u.tx=a.tx+e,a.ty+i):(u.a=1,u.b=0,u.c=0,u.d=1,u.tx=e,i),It.mul(u,this._curMat,u),c.addData(n,r,s,u,v)),this._curSubmit._numEle+=s.length,d&&(this._colorFiler=_,this._curSubmit=yt.RENDERBASE)}else this.sprite&&T.systemTimer.callLater(this,this._repaintSprite)},t.transform=function(t,e,i,n,r,s){ri.save(this),It.mul(It.TEMP.setTo(t,e,i,n,r,s),this._curMat,this._curMat),this._curMat._checkTransform()},t._transformByMatrix=function(t,e,i){t.setTranslate(e,i),It.mul(t,this._curMat,this._curMat),t.setTranslate(0,0),this._curMat._bTransform=!0},t.setTransformByMatrix=function(t){t.copyTo(this._curMat)},t.rotate=function(t){ri.save(this),this._curMat.rotateEx(t)},t.scale=function(t,e){ri.save(this),this._curMat.scaleEx(t,e)},t.clipRect=function(t,e,i,n){ai.save(this),this._clipRect==H.MAXCLIPRECT?this._clipRect=new ve(t,e,i,n):(this._clipRect.width=i,this._clipRect.height=n,this._clipRect.x=t,this._clipRect.y=e),H._clipID_Gen++,H._clipID_Gen%=1e4,this._clipInfoID=H._clipID_Gen;var r=this._globalClipMatrix,s=r.tx,a=r.ty,o=s+r.a,h=a+r.d;if(99999999<=this._clipRect.width?(r.a=r.d=99999999,r.b=r.c=r.tx=r.ty=0):(this._curMat._bTransform?(r.tx=this._clipRect.x*this._curMat.a+this._clipRect.y*this._curMat.c+this._curMat.tx,r.ty=this._clipRect.x*this._curMat.b+this._clipRect.y*this._curMat.d+this._curMat.ty,r.a=this._clipRect.width*this._curMat.a,r.b=this._clipRect.width*this._curMat.b,r.c=this._clipRect.height*this._curMat.c,r.d=this._clipRect.height*this._curMat.d):(r.tx=this._clipRect.x+this._curMat.tx,r.ty=this._clipRect.y+this._curMat.ty,r.a=this._clipRect.width,r.b=r.c=0,r.d=this._clipRect.height),this._incache&&(this._clipInCache=!0)),0<r.a&&0<r.d){var l=r.tx+r.a,u=r.ty+r.d;l<=s||u<=a||r.tx>=o||r.ty>=h?(r.a=-.1,r.d=-.1):(r.tx<s&&(r.a-=s-r.tx,r.tx=s),o<l&&(r.a-=l-o),r.ty<a&&(r.d-=a-r.ty,r.ty=a),h<u&&(r.d-=u-h),r.a<=0&&(r.a=-.1),r.d<=0&&(r.d=-.1))}},t.drawMesh=function(t,e,i,n,r,s,a,o,h){void 0===h&&(h=0)},t.addRenderObject=function(t){this._submits[this._submits._length++]=t},t.submitElement=function(t,e){qi._context;var i=this._submits,n=i._length;e<0&&(e=i._length);for(var r=yt.RENDERBASE;t<e;)this._renderNextSubmitIndex=t+1,i[t]!==yt.RENDERBASE?(yt.preRender=r,t+=(r=i[t]).renderSubmit()):t++;return n},t.flush=function(){var t=this.submitElement(0,this._submits._length);this._path&&this._path.reset(),tn.instance&&tn.getInstance().reset(),this._curSubmit=yt.RENDERBASE;for(var e=0,i=this.meshlist.length;e<i;e++){var n=this.meshlist[e];n.canReuse?n.releaseMesh():n.destroy()}return this.meshlist.length=0,this._mesh=or.getAMesh(this.isMain),this._pathMesh=Yr.getAMesh(this.isMain),this._triangleMesh=Fr.getAMesh(this.isMain),this.meshlist.push(this._mesh,this._pathMesh,this._triangleMesh),this._flushCnt++,this._flushCnt%60==0&&qi._context==this&&mt.textRenderInst&&mt.textRenderInst.GC(),t},t.beginPath=function(t){void 0===t&&(t=!1),this._getPath().beginPath(t)},t.closePath=function(){this._path.closePath()},t.addPath=function(t,e,i,n,r){for(var s=0,a=0,o=t.length/2;a<o;a++){var h=t[s]+n,l=t[s+1]+r;t[s]=h,t[s+1]=l,s+=2}this._getPath().push(t,i)},t.fill=function(){var t=this._curMat,e=this._getPath(),i=this._curSubmit,n=3===i._key.submitType&&i._key.blendShader===this._nBlendType;n&&(n=n&&this.isSameClipInfo(i)),n||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var r,s=this.mixRGBandAlpha(this.fillStyle.toInt()),a=0,o=0,h=e.paths.length;o<h;o++){var l=e.paths[o],u=l.path.length/2;if(!(u<3||3==u&&!l.convex)){var c=l.path.concat(),_=0,d=0,f=0,p=NaN,m=NaN;if(t._bTransform)for(_=0;_<u;_++)f=(d=_<<1)+1,p=c[d],m=c[f],c[d]=t.a*p+t.c*m+t.tx,c[f]=t.b*p+t.d*m+t.ty;else for(_=0;_<u;_++)f=(d=_<<1)+1,p=c[d],m=c[f],c[d]=p+t.tx,c[f]=m+t.ty;65535<this._pathMesh.vertNum+u&&(this._curSubmit._numEle+=a,a=0,this._pathMesh=Yr.getAMesh(this.isMain),this._curSubmit=this.addVGSubmit(this._pathMesh));var g=this._pathMesh.vertNum;if(l.convex){var v=u-2;r=new Array(3*v);for(var T=0,y=0;y<v;y++)r[T++]=g,r[T++]=y+1+g,r[T++]=y+2+g}else if(r=At.earcut(c,null,2),0<g)for(var E=0;E<r.length;E++)r[E]+=g;this._pathMesh.addVertAndIBToMesh(this,c,s,r),a+=r.length}}this._curSubmit._numEle+=a},t.addVGSubmit=function(t){var e=yt.createShape(this,t,0,Ot.create(4,0));return e._key.submitType=3,this._submits[this._submits._length++]=e,this._copyClipInfo(e,this._globalClipMatrix),e},t.stroke=function(){if(0<this.lineWidth){var t=this.mixRGBandAlpha(this.strokeStyle._color.numColor),e=this._getPath(),i=this._curSubmit,n=3===i._key.submitType&&i._key.blendShader===this._nBlendType;n&&(n=n&&this.isSameClipInfo(i)),n||(this._curSubmit=this.addVGSubmit(this._pathMesh));for(var r=0,s=0,a=e.paths.length;s<a;s++){var o=e.paths[s];if(!(o.path.length<=0)){var h=[],l=[],u=2*o.path.length;if(!(u<2)){65535<this._pathMesh.vertNum+u&&(this._curSubmit._numEle+=r,r=0,this._pathMesh=Yr.getAMesh(this.isMain),this.meshlist.push(this._pathMesh),this._curSubmit=this.addVGSubmit(this._pathMesh)),ki.createLine2(o.path,h,this.lineWidth,this._pathMesh.vertNum,l,o.loop);var c=l.length/2,_=this._curMat,d=0,f=0,p=0,m=NaN,g=NaN;if(_._bTransform)for(d=0;d<c;d++)p=(f=d<<1)+1,m=l[f],g=l[p],l[f]=_.a*m+_.c*g+_.tx,l[p]=_.b*m+_.d*g+_.ty;else for(d=0;d<c;d++)p=(f=d<<1)+1,m=l[f],g=l[p],l[f]=m+_.tx,l[p]=g+_.ty;this._pathMesh.addVertAndIBToMesh(this,l,t,h),r+=h.length}}}this._curSubmit._numEle+=r}},t.moveTo=function(t,e){var i=this._getPath();i.newPath(),i._lastOriX=t,i._lastOriY=e,i.addPoint(t,e)},t.lineTo=function(t,e){var i=this._getPath();Math.abs(t-i._lastOriX)<.001&&Math.abs(e-i._lastOriY)<.001||(i._lastOriX=t,i._lastOriY=e,i.addPoint(t,e))},t.arcTo=function(t,e,i,n,r){var s=0,a=0,o=0,h=this._path._lastOriX-t,l=this._path._lastOriY-e,u=Math.sqrt(h*h+l*l);if(!(u<=1e-6)){var c=h/u,_=l/u,d=i-t,f=n-e,p=d*d+f*f,m=Math.sqrt(p);if(!(m<=1e-6)){var g=d/m,v=f/m,T=c+g,y=_+v,E=Math.sqrt(T*T+y*y);if(!(E<=1e-6)){var x=T/E,S=y/E,C=Math.acos(x*c+S*_),I=Math.PI/2-C,R=(u=r/Math.tan(I))*c+t,A=u*_+e,M=Math.sqrt(u*u+r*r),D=t+x*M,b=e+S*M,w=0,L=0;if(0<=c*v-_*g){var O=2*I/H.SEGNUM;w=Math.sin(O),L=Math.cos(O)}else O=2*-I/H.SEGNUM,w=Math.sin(O),L=Math.cos(O);var N=this._path._lastOriX,P=this._path._lastOriY,F=R,B=A;(.1<Math.abs(F-this._path._lastOriX)||.1<Math.abs(B-this._path._lastOriY))&&(N=a=F,P=o=B,this._path.addPoint(a,o));var V=R-D,U=A-b;for(s=0;s<H.SEGNUM;s++){var z=V*L+U*w,G=-V*w+U*L;a=z+D,o=G+b,(.1<Math.abs(N-a)||.1<Math.abs(P-o))&&(this._path.addPoint(a,o),N=a,P=o),V=z,U=G}}}}},t.arc=function(t,e,i,n,r,s,a){void 0===s&&(s=!1),void 0===a&&(a=!0);var o,h,l=0,u=0,c=0,_=0,d=0,f=0,p=0;if(u=r-n,s)if(Math.abs(u)>=2*Math.PI)u=2*-Math.PI;else for(;0<u;)u-=2*Math.PI;else if(Math.abs(u)>=2*Math.PI)u=2*Math.PI;else for(;u<0;)u+=2*Math.PI;var m=this.getMatScaleX(),g=this.getMatScaleY(),v=i*(g<m?m:g),T=2*Math.PI*v;o=u/(h=0|Math.max(T/10,10))/2,c=Math.abs(4/3*(1-Math.cos(o))/Math.sin(o)),s&&(c=-c);var y=this._getPath();for(p=0;p<=h;p++)l=n+u*(p/h),_=Math.cos(l),f=e+Math.sin(l)*i,(d=t+_*i)==this._path._lastOriX&&f==this._path._lastOriY||y.addPoint(d,f);_=Math.cos(r),f=e+Math.sin(r)*i,(d=t+_*i)==this._path._lastOriX&&f==this._path._lastOriY||y.addPoint(d,f)},t.quadraticCurveTo=function(t,e,i,n){for(var r=Te.I.getBezierPoints([this._path._lastOriX,this._path._lastOriY,t,e,i,n],30,2),s=0,a=r.length/2;s<a;s++)this.lineTo(r[2*s],r[2*s+1]);this.lineTo(i,n)},t.mixRGBandAlpha=function(t){return this._mixRGBandAlpha(t,this._shader2D.ALPHA)},t._mixRGBandAlpha=function(t,e){if(1<=e)return t;var i=(4278190080&t)>>>24;return 0!=i?i*=e:i=255*e,16777215&t|i<<24},t.strokeRect=function(t,e,i,n,r){if(0<this.lineWidth){var s=this.mixRGBandAlpha(this.strokeStyle._color.numColor),a=this.lineWidth/2;this._fillRect(t-a,e-a,i+this.lineWidth,this.lineWidth,s),this._fillRect(t-a,e-a+n,i+this.lineWidth,this.lineWidth,s),this._fillRect(t-a,e+a,this.lineWidth,n-this.lineWidth,s),this._fillRect(t-a+i,e+a,this.lineWidth,n-this.lineWidth,s)}},t.clip=function(){},t.drawParticle=function(t,e,i){i.x=t,i.y=e,this._submits[this._submits._length++]=i},t._getPath=function(){return this._path||(this._path=new vt)},t._fillTexture_h=function(t,e,i,n,r,s,a,o){for(var h=s,l=Math.floor(o/n),u=o%n,c=0;c<l;c++)this._inner_drawTexture(t,e,h,a,n,r,this._curMat,i,1,!1),h+=n;if(0<u){var _=i[2]-i[0],d=i[0]+_*(u/n),f=H.tmpuv1;f[0]=i[0],f[1]=i[1],f[2]=d,f[3]=i[3],f[4]=d,f[5]=i[5],f[6]=i[6],f[7]=i[7],this._inner_drawTexture(t,e,h,a,u,r,this._curMat,f,1,!1)}},t._fillTexture_v=function(t,e,i,n,r,s,a,o){for(var h=a,l=Math.floor(o/r),u=o%r,c=0;c<l;c++)this._inner_drawTexture(t,e,s,h,n,r,this._curMat,i,1,!1),h+=r;if(0<u){var _=i[7]-i[1],d=i[1]+_*(u/r),f=H.tmpuv1;f[0]=i[0],f[1]=i[1],f[2]=i[2],f[3]=i[3],f[4]=i[4],f[5]=d,f[6]=i[6],f[7]=d,this._inner_drawTexture(t,e,s,h,n,u,this._curMat,f,1,!1)}},t.drawTextureWithSizeGrid=function(t,e,i,n,r,s,a,o){if(t._getSource()){e+=a,i+=o;var h=t.uv,l=t.bitmap.width,u=t.bitmap.height,c=s[0],_=s[3],d=c/u,f=_/l,p=s[1],m=s[2],g=p/l,v=m/u,T=s[4],y=!1;if(n==l&&(_=p=0),r==u&&(c=m=0),n<_+p){var E=n;y=!0,n=_+p,this.save(),this.clipRect(0+e,0+i,E,r)}var x=t.bitmap.id,S=this._curMat,C=this._tempUV,I=h[0],R=h[1],A=h[4],M=h[5],D=I,b=R,w=A,L=M;if(_&&c&&(w=I+f,L=R+d,C[0]=I,C[1]=R,C[2]=w,C[3]=R,C[4]=w,C[5]=L,C[6]=I,C[7]=L,this._inner_drawTexture(t,x,e,i,_,c,S,C,1,!1)),p&&c&&(D=A-g,w=A,L=(b=R)+d,C[0]=D,C[1]=b,C[2]=w,C[3]=b,C[4]=w,C[5]=L,C[6]=D,C[7]=L,this._inner_drawTexture(t,x,n-p+e,0+i,p,c,S,C,1,!1)),_&&m&&(b=M-v,w=(D=I)+f,L=M,C[0]=D,C[1]=b,C[2]=w,C[3]=b,C[4]=w,C[5]=L,C[6]=D,C[7]=L,this._inner_drawTexture(t,x,0+e,r-m+i,_,m,S,C,1,!1)),p&&m&&(D=A-g,b=M-v,w=A,L=M,C[0]=D,C[1]=b,C[2]=w,C[3]=b,C[4]=w,C[5]=L,C[6]=D,C[7]=L,this._inner_drawTexture(t,x,n-p+e,r-m+i,p,m,S,C,1,!1)),c&&(D=I+f,w=A-g,L=(b=R)+d,C[0]=D,C[1]=b,C[2]=w,C[3]=b,C[4]=w,C[5]=L,C[6]=D,C[7]=L,T?this._fillTexture_h(t,x,C,t.width-_-p,c,_+e,i,n-_-p):this._inner_drawTexture(t,x,_+e,i,n-_-p,c,S,C,1,!1)),m&&(D=I+f,b=M-v,w=A-g,L=M,C[0]=D,C[1]=b,C[2]=w,C[3]=b,C[4]=w,C[5]=L,C[6]=D,C[7]=L,T?this._fillTexture_h(t,x,C,t.width-_-p,m,_+e,r-m+i,n-_-p):this._inner_drawTexture(t,x,_+e,r-m+i,n-_-p,m,S,C,1,!1)),_&&(b=R+d,w=(D=I)+f,L=M-v,C[0]=D,C[1]=b,C[2]=w,C[3]=b,C[4]=w,C[5]=L,C[6]=D,C[7]=L,T?this._fillTexture_v(t,x,C,_,t.height-c-m,e,c+i,r-c-m):this._inner_drawTexture(t,x,e,c+i,_,r-c-m,S,C,1,!1)),p&&(D=A-g,b=R+d,w=A,L=M-v,C[0]=D,C[1]=b,C[2]=w,C[3]=b,C[4]=w,C[5]=L,C[6]=D,C[7]=L,T?this._fillTexture_v(t,x,C,p,t.height-c-m,n-p+e,c+i,r-c-m):this._inner_drawTexture(t,x,n-p+e,c+i,p,r-c-m,S,C,1,!1)),D=I+f,b=R+d,w=A-g,L=M-v,C[0]=D,C[1]=b,C[2]=w,C[3]=b,C[4]=w,C[5]=L,C[6]=D,C[7]=L,T){var O=H.tmpUVRect;O[0]=D,O[1]=b,O[2]=w-D,O[3]=L-b,this._fillTexture(t,t.width-_-p,t.height-c-m,O,_+e,c+i,n-_-p,r-c-m,"repeat",0,0)}else this._inner_drawTexture(t,x,_+e,c+i,n-_-p,r-c-m,S,C,1,!1);y&&this.restore()}},g(0,t,"canvas",function(){return this._canvas}),g(0,t,"strokeStyle",function(){return this._shader2D.strokeStyle},function(t){this._shader2D.strokeStyle.equal(t)||(a.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=Ye.create(t),this._submitKey.other=-this._shader2D.strokeStyle.toInt())}),g(0,t,"lineCap",function(){return null},function(t){}),g(0,t,"textBaseline",function(){return this._other.textBaseline},function(t){this._other.textBaseline===t||(this._other=this._other.make(),a.save(this,16384,this._other,!1),this._other.textBaseline=t)}),g(0,t,"globalCompositeOperation",function(){return cn.NAMES[this._nBlendType]},function(t){var e=cn.TOINT[t];null==e||this._nBlendType===e||(a.save(this,65536,this,!0),this._curSubmit=yt.RENDERBASE,this._nBlendType=e)}),g(0,t,"textAlign",function(){return this._other.textAlign},function(t){this._other.textAlign===t||(this._other=this._other.make(),a.save(this,32768,this._other,!1),this._other.textAlign=t)}),g(0,t,"font",null,function(t){this._other=this._other.make(),a.save(this,8,this._other,!1)}),g(0,t,"globalAlpha",function(){return this._shader2D.ALPHA},function(t){(t=Math.floor(1e3*t)/1e3)!=this._shader2D.ALPHA&&(a.save(this,1,this._shader2D,!1),this._shader2D.ALPHA=t)}),g(0,t,"lineJoin",function(){return null},function(t){}),g(0,t,"asBitmap",null,function(t){if(t){if(this._targets||(this._targets=new da(this._width,this._height,1,-1)),!this._width||!this._height)throw Error("asBitmap no size!")}else this._targets&&this._targets.destroy(),this._targets=null}),g(0,t,"lineWidth",function(){return this._other.lineWidth},function(t){this._other.lineWidth===t||(this._other=this._other.make(),a.save(this,256,this._other,!1),this._other.lineWidth=t)}),g(0,t,"fillStyle",function(){return this._shader2D.fillStyle},function(t){this._shader2D.fillStyle.equal(t)||(a.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=Ye.create(t),this._submitKey.other=-this._shader2D.fillStyle.toInt())}),g(0,t,"miterLimit",function(){return null},function(t){}),H.__init__=function(){H.MAXCLIPRECT=new ve(0,0,99999999,99999999),i.DEFAULT=new i},H.set2DRenderConfig=function(){var t=Nt.instance;j.setBlend(t,!0),j.setBlendFunc(t,1,771),j.setDepthTest(t,!1),j.setCullFace(t,!1),j.setDepthMask(t,!0),j.setFrontFace(t,2305),t.viewport(0,0,Q.width,Q.height)},H.ENUM_TEXTALIGN_DEFAULT=0,H.ENUM_TEXTALIGN_CENTER=1,H.ENUM_TEXTALIGN_RIGHT=2,H._SUBMITVBSIZE=32e3,H._MAXSIZE=99999999,H._MAXVERTNUM=65535,H.MAXCLIPRECT=null,H._COUNT=0,H.SEGNUM=32,H._contextcount=0,H.PI2=2*Math.PI,H._clipID_Gen=0,E(H,["_textRender",function(){return this._textRender=new mt},"tmpuv1",function(){return this.tmpuv1=[0,0,0,0,0,0,0,0]},"tmpUV",function(){return this.tmpUV=[0,0,0,0,0,0,0,0]},"tmpUVRect",function(){return this.tmpUVRect=[0,0,0,0]}]),H.__init$=function(){i=function(){function t(){this.lineWidth=1,this.textAlign=null,this.textBaseline=null}I(t,"");var e=t.prototype;return e.clear=function(){this.lineWidth=1,this.textAlign=this.textBaseline=null},e.make=function(){return this===t.DEFAULT?new t:this},t.DEFAULT=null,t}()},H}()),Ki=(function(){function t(){this.startPosition=new ln,this.endPosition=new ln,this.startColor=new pe,this.endColor=new pe}I(t,"laya.d3.core.pixelLine.PixelLineData"),t.prototype.cloneTo=function(t){this.startPosition.cloneTo(t.startPosition),this.endPosition.cloneTo(t.endPosition),this.startColor.cloneTo(t.startColor),this.endColor.cloneTo(t.endColor)}}(),function(){function s(){}return I(s,"laya.utils.RunDriver"),s.createShaderCondition=function(t){var e="(function() {return "+t+";})";return T._runScript(e)},s.fontMap=[],s.measureText=function(t,e){var i=s.hanzi.test(t);if(i&&s.fontMap[e])return s.fontMap[e];var n=Vt.context;n.font=e;var r=n.measureText(t);return i&&(s.fontMap[e]=r),r},s.drawToCanvas=function(t,e,i,n,r,s){r-=t.x,s-=t.y,r|=0,s|=0,i|=0,n|=0;var a=new ji;a.size(i,n),a.asBitmap=!0,a._targets.start(),Sn.renders[e]._fun(t,a,r,s),a.flush(),a._targets.end(),a._targets.restore();var o=a._targets.getData(0,0,i,n);a.destroy();for(var h=new ImageData(i,n),l=4*i,u=(new Uint8Array(l),h.data),c=n-1,_=c*l,d=0;0<=c;c--)u.set(o.subarray(d,d+l),_),_-=l,d+=l;var f=new Ys(!0);return f.size(i,n),f.getContext("2d").putImageData(h,0,0),f},s.drawToTexture=function(t,e,i,n,r,s){r-=t.x,s-=t.y,r|=0,s|=0,i|=0,n|=0;var a=new ji;a.size(i,n),a.asBitmap=!0,a._targets.start(),Sn.renders[e]._fun(t,a,r,s),a.flush(),a._targets.end(),a._targets.restore();var o=new xr(a._targets,xr.INV_UV);return a.destroy(!0),o},s.changeWebGLSize=function(t,e){en.onStageResize(t,e)},s.clear=function(t){ji.set2DRenderConfig(),Q.worldScissorTest&&en.mainContext.disable(3089);var e=qi.context,i=0==e._submits._length||Tn.preserveDrawingBuffer?f.create(t).arrColor:T.stage._wgColor;i?e.clearBG(i[0],i[1],i[2],i[3]):e.clearBG(0,0,0,0),Q.clear()},s.enableNative=null,E(s,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),s}()),qi=function(){function i(t,e){this._timeId=0,i._mainCanvas.source.id="layaCanvas",i._mainCanvas.source.width=t,i._mainCanvas.source.height=e,laya.renders.Render.isConchApp?Vt.document.body.appendChild(i._mainCanvas.source):Vt.onKGMiniGame||Vt.container.appendChild(i._mainCanvas.source),this.initRender(i._mainCanvas,t,e),Vt.window.requestAnimationFrame(function t(e){T.stage._loop();Vt.window.requestAnimationFrame(t)}),T.stage.on("visibilitychange",this,this._onVisibilitychange)}I(i,"laya.renders.Render");var t=i.prototype;return t._onVisibilitychange=function(){T.stage.isVisibility?0!=this._timeId&&Vt.window.clearInterval(this._timeId):this._timeId=Vt.window.setInterval(this._enterFrame,1e3)},t.initRender=function(t,e,i){var n=Nt.instance=en.mainContext=function(t){var e,i=["webgl2","webgl","experimental-webgl","webkit-3d","moz-webgl"];Tn.useWebGL2||i.shift();for(var n=0;n<i.length;n++){try{e=t.getContext(i[n],{stencil:Tn.isStencil,alpha:Tn.isAlpha,antialias:Tn.isAntialias,premultipliedAlpha:Tn.premultipliedAlpha,preserveDrawingBuffer:Tn.preserveDrawingBuffer})}catch(t){}if(e)return"webgl2"===i[n]&&(en._isWebGL2=!0),new Nt,e}return null}(laya.renders.Render._mainCanvas.source);if(!n)return!1;t.size(e,i),j.__init__(n),ji.__init__(),yt.__init__();var r=new ji;r.isMain=!0,laya.renders.Render._context=r,t._setContext(r),en.shaderHighPrecision=!1;try{n.getShaderPrecisionFormat(35632,36338).precision?en.shaderHighPrecision=!0:en.shaderHighPrecision=!1}catch(t){}return Nt.instance=n,Rt.__init__(),er.__init__(),Ot.__init__(),zt.__init__(),Wn.__int__(n),cn._init_(n),!0},t._enterFrame=function(t){T.stage._loop()},g(1,i,"canvas",function(){return i._mainCanvas.source}),g(1,i,"context",function(){return i._context}),i._context=null,i._mainCanvas=null,i.supportWebGLPlusCulling=!1,i.supportWebGLPlusAnimation=!1,i.supportWebGLPlusRendering=!1,i.isConchApp=!1,i.is3DMode=!1,i.__init$=function(){(i.isConchApp=null!=m.conch)&&(i.supportWebGLPlusCulling=!0,i.supportWebGLPlusAnimation=!0,i.supportWebGLPlusRendering=!0)},i}(),Qi=function(){var _,l;function g(){}return I(g,"laya.utils.SceneUtils"),g.getBindFun=function(t){var e=g._funMap.get(t);if(null==e){var i='"'+t+'"',n="(function(data){if(data==null)return;with(data){try{\nreturn "+(i=i.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"'))+"\n}catch(e){}}})";e=T._runScript(n),g._funMap.set(t,e)}return e},g.createByData=function(t,e){var i=l.create();if((t=g.createComp(e,t,t,null,i))._setBit(8,!0),t.hasOwnProperty("_idMap")&&(t._idMap=i._idMap),e.animations){var n,r,s=[],a=e.animations,o=0,h=a.length;for(o=0;o<h;o++){switch(n=new va,r=a[o],n._setUp(i._idMap,r),(t[r.name]=n)._setControlNode(t),r.action){case 1:n.play(0,!1);break;case 2:n.play(0,!0)}s.push(n)}t._aniList=s}return"Scene"===t._$componentType&&0<t._width&&null==e.props.hitTestPrior&&!t.mouseThrough&&(t.hitTestPrior=!0),i.beginLoad(t),t},g.createInitTool=function(){return l.create()},g.createComp=function(t,e,i,n,r){if("Scene3D"==t.type||"Sprite3D"==t.type){var s=[],a=T.Utils3D._createSceneByJsonForMaker(t,s,r);return"Sprite3D"==t.type?T.StaticBatchManager.combine(a,s):T.StaticBatchManager.combine(null,s),a}if(!(e=e||g.getCompInstance(t)))return t.props&&t.props.runtime?console.warn("runtime not found:"+t.props.runtime):console.warn("can not create:"+t.type),null;var o=t.child;if(o)for(var h="List"==e._$componentType,l=0,u=o.length;l<u;l++){var c=o[l];if(!e.hasOwnProperty("itemRender")||"render"!=c.props.name&&"render"!==c.props.renderType)if("Graphic"==c.type)Cn._addGraphicsToSprite(c,e);else if(Cn._isDrawType(c.type))Cn._addGraphicToSprite(c,e,!0);else{if(h){var _=[],d=g.createComp(c,null,i,_,r);_.length&&(d._$bindData=_)}else d=g.createComp(c,null,i,n,r);"Script"==c.type?d instanceof laya.components.Component?e._addComponentInstance(d):"owner"in d?d.owner=e:"target"in d&&(d.target=e):"mask"==c.props.renderType||"mask"==c.props.name?e.mask=d:d instanceof laya.display.Node&&e.addChild(d)}else e.itemRender=c}var f=t.props;for(var p in f){var m=f[p];"string"==typeof m&&(0<=m.indexOf("@node:")||0<=m.indexOf("@Prefab:"))?r&&r.addNodeRef(e,p,m):g.setCompValue(e,p,m,i,n)}return e._afterInited&&e._afterInited(),t.compId&&r&&r._idMap&&(r._idMap[t.compId]=e),e},g.setCompValue=function(t,e,i,n,r){if("string"==typeof i&&-1<i.indexOf("${")){if(g._sheet||(g._sheet=Cn.getClass("laya.data.Table")),!g._sheet)return void console.warn("Can not find class Sheet");if(r)r.push(t,e,i);else if(n){-1==i.indexOf("].")&&(i=i.replace(".","[0]."));var s,a,o=new _(t,e,i);o.exe(n);for(var h=i.replace(/\[.*?\]\./g,".");null!=(s=g._parseWatchData.exec(h));){for(var l=s[1];null!=(a=g._parseKeyWord.exec(l));){var u=a[0],c=n._watchMap[u]||(n._watchMap[u]=[]);c.push(o),g._sheet.I.notifer.on(u,n,n.changeData,[u])}(c=n._watchMap[l]||(n._watchMap[l]=[])).push(o),g._sheet.I.notifer.on(l,n,n.changeData,[l])}}}else"var"===e&&n?n[i]=t:t[e]="true"===i||"false"!==i&&i},g.getCompInstance=function(t){if("UIView"==t.type&&t.props&&t.props.pageData)return g.createByData(null,t.props.pageData);var e=t.props&&t.props.runtime||t.type,i=Cn.getClass(e);if(!i)throw"Can not find class "+e;if("Script"===t.type&&i.prototype._doAwake){var n=p.createByClass(i);return n._destroyed=!1,n}return t.props&&t.props.hasOwnProperty("renderType")&&"instance"==t.props.renderType?(i.instance||(i.instance=new i),i.instance):new i},g._sheet=null,E(g,["_funMap",function(){return this._funMap=new mn},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]),g.__init$=function(){_=function(){function t(t,e,i){this.comp=null,this.prop=null,this.value=null,this.comp=t,this.prop=e,this.value=i}return I(t,""),t.prototype.exe=function(t){var e=g.getBindFun(this.value);this.comp[this.prop]=e.call(this,t)},t}(),l=function(){function e(){this._nodeRefList=null,this._initList=null,this._loadList=null,this._idMap=null,this._scene=null}I(e,"");var t=e.prototype;return t.reset=function(){this._nodeRefList=null,this._initList=null,this._idMap=null,this._loadList=null,this._scene=null},t.recover=function(){this.reset(),p.recover("InitTool",this)},t.addLoadRes=function(t,e){this._loadList||(this._loadList=[]),e?this._loadList.push({url:t,type:e}):this._loadList.push(t)},t.addNodeRef=function(t,e,i){this._nodeRefList||(this._nodeRefList=[]),this._nodeRefList.push([t,e,i]),0<=i.indexOf("@Prefab:")&&this.addLoadRes(i.replace("@Prefab:",""),"prefab")},t.setNodeRef=function(){if(this._nodeRefList)if(this._idMap){var t,e,i=0;for(t=this._nodeRefList.length,i=0;i<t;i++)(e=this._nodeRefList[i])[0][e[1]]=this.getReferData(e[2]);this._nodeRefList=null}else this._nodeRefList=null},t.getReferData=function(t){if(0<=t.indexOf("@Prefab:"))return Hn.getRes(t.replace("@Prefab:",""));if(0<=t.indexOf("@arr:")){var e,i,n,r=0;for(i=(e=(t=t.replace("@arr:","")).split(",")).length,r=0;r<i;r++)n=e[r],e[r]=n?this._idMap[n.replace("@node:","")]:null;return e}return this._idMap[t.replace("@node:","")]},t.addInitItem=function(t){this._initList||(this._initList=[]),this._initList.push(t)},t.doInits=function(){this._initList&&(this._initList=null)},t.finish=function(){this.setNodeRef(),this.doInits(),this._scene._setBit(8,!1),this._scene.parent&&this._scene.parent.activeInHierarchy&&this._scene.active&&this._scene._processActive(),this._scene.event("onViewCreated"),this.recover()},t.beginLoad=function(t){this._scene=t,!this._loadList||this._loadList.length<1?this.finish():T.loader.load(this._loadList,y.create(this,this.finish))},e.create=function(){var t=p.getItemByClass("InitTool",e);return t._idMap=[],t},e}()},g}(),$i=function(){function h(){}return I(h,"laya.utils.Stat"),g(1,h,"onclick",null,function(t){h._sp&&h._sp.on("click",h._sp,t),h._canvas&&(h._canvas.source.onclick=t,h._canvas.source.style.pointerEvents="")}),h.show=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),Vt.onMiniGame||Vt.onLimixiu||qi.isConchApp||Vt.onBDMiniGame||Vt.onKGMiniGame||Vt.onQGMiniGame||(h._useCanvas=!0),h._show=!0,h._fpsData.length=60,h._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},h._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"},h._view[2]={title:"RenderBatches",value:"renderBatches",color:"white",units:"int"},h._view[3]={title:"SavedRenderBatches",value:"savedRenderBatches",color:"white",units:"int"},h._view[4]={title:"CPUMemory",value:"cpuMemory",color:"yellow",units:"M"},h._view[5]={title:"GPUMemory",value:"gpuMemory",color:"yellow",units:"M"},h._view[6]={title:"Shader",value:"shaderCall",color:"white",units:"int"},qi.is3DMode?(h._view[0].title="FPS(3D)",h._view[7]={title:"TriFaces",value:"trianglesFaces",color:"white",units:"int"},h._view[8]={title:"FrustumCulling",value:"frustumCulling",color:"white",units:"int"},h._view[9]={title:"OctreeNodeCulling",value:"octreeNodeCulling",color:"white",units:"int"}):(h._view[0].title="FPS(WebGL)",h._view[7]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"}),h._useCanvas?h.createUIPre(t,e):h.createUI(t,e),h.enable()},h.createUIPre=function(t,e){var i=Vt.pixelRatio;h._width=180*i,h._vx=120*i,h._height=i*(12*h._view.length+3*i)+4,h._fontSize=12*i;for(var n=0;n<h._view.length;n++)h._view[n].x=4,h._view[n].y=n*h._fontSize+2*i;h._canvas||((h._canvas=new Ys(!0)).size(h._width,h._height),(h._ctx=h._canvas.getContext("2d")).textBaseline="top",h._ctx.font=h._fontSize+"px Arial",h._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+t+"px;top:"+e+"px;width:"+h._width/i+"px;height:"+h._height/i+"px;"),Vt.onKGMiniGame||Vt.container.appendChild(h._canvas.source),h._first=!0,h.loop(),h._first=!1},h.createUI=function(t,e){var i=h._sp,n=Vt.pixelRatio;i||(i=new ts,(h._leftText=new Os).pos(5,5),h._leftText.color="#ffffff",i.addChild(h._leftText),(h._txt=new Os).pos(80*n,5),h._txt.color="#ffffff",i.addChild(h._txt),h._sp=i),i.pos(t,e);for(var r="",s=0;s<h._view.length;s++){r+=h._view[s].title+"\n"}h._leftText.text=r;var a=138*n,o=n*(12*h._view.length+3*n)+4;h._txt.fontSize=h._fontSize*n,h._leftText.fontSize=h._fontSize*n,i.size(a,o),i.graphics.clear(),i.graphics.alpha(.5),i.graphics.drawRect(0,0,a,o,"#999999"),i.graphics.alpha(2),h.loop()},h.enable=function(){T.systemTimer.frameLoop(1,h,h.loop)},h.hide=function(){h._show=!1,T.systemTimer.clear(h,h.loop),h._canvas&&Vt.removeElement(h._canvas.source)},h.clear=function(){h.trianglesFaces=h.renderBatches=h.savedRenderBatches=h.shaderCall=h.spriteRenderUseCacheCount=h.frustumCulling=h.octreeNodeCulling=h.canvasNormal=h.canvasBitmap=h.canvasReCache=0},h.loop=function(){h._count++;var t=Vt.now();if(!(t-h._timer<1e3)){var e=h._count;if(h.FPS=Math.round(1e3*e/(t-h._timer)),h._show){h.trianglesFaces=Math.round(h.trianglesFaces/e),h.renderBatches=h._useCanvas?Math.round(h.renderBatches/e):Math.round(h.renderBatches/e)-1,h.savedRenderBatches=Math.round(h.savedRenderBatches/e),h.shaderCall=Math.round(h.shaderCall/e),h.spriteRenderUseCacheCount=Math.round(h.spriteRenderUseCacheCount/e),h.canvasNormal=Math.round(h.canvasNormal/e),h.canvasBitmap=Math.round(h.canvasBitmap/e),h.canvasReCache=Math.ceil(h.canvasReCache/e),h.frustumCulling=Math.round(h.frustumCulling/e),h.octreeNodeCulling=Math.round(h.octreeNodeCulling/e);var i=0<h.FPS?Math.floor(1e3/h.FPS).toString():" ";h._fpsStr=h.FPS+(h.renderSlow?" slow":"")+" "+i,h._spriteStr=h._useCanvas?h.spriteCount-1+(h.spriteRenderUseCacheCount?"/"+h.spriteRenderUseCacheCount:""):h.spriteCount-4+(h.spriteRenderUseCacheCount?"/"+h.spriteRenderUseCacheCount:""),h._canvasStr=h.canvasReCache+"/"+h.canvasNormal+"/"+h.canvasBitmap,h.cpuMemory=Nn.cpuMemory,h.gpuMemory=Nn.gpuMemory,h._useCanvas?h.renderInfoPre():h.renderInfo(),h.clear()}h._count=0,h._timer=t}},h.renderInfoPre=function(){var t,e,i=0;if(h._canvas){var n=h._ctx;for(n.clearRect(h._first?0:h._vx,0,h._width,h._height),i=0;i<h._view.length;i++)t=h._view[i],h._first&&(n.fillStyle="white",n.fillText(t.title,t.x,t.y)),n.fillStyle=t.color,e=h[t.value],"M"==t.units&&(e=Math.floor(e/1048576*100)/100+" M"),n.fillText(e+"",t.x+h._vx,t.y)}},h.renderInfo=function(){for(var t="",e=0;e<h._view.length;e++){var i=h._view[e],n=h[i.value];"M"==i.units&&(n=Math.floor(n/1048576*100)/100+" M"),"K"==i.units&&(n=Math.floor(n/1024*100)/100+" K"),t+=n+"\n"}h._txt.text=t},h.FPS=0,h.loopCount=0,h.shaderCall=0,h.renderBatches=0,h.savedRenderBatches=0,h.trianglesFaces=0,h.spriteCount=0,h.spriteRenderUseCacheCount=0,h.frustumCulling=0,h.octreeNodeCulling=0,h.canvasNormal=0,h.canvasBitmap=0,h.canvasReCache=0,h.renderSlow=!1,h.gpuMemory=0,h.cpuMemory=0,h._fpsStr=null,h._canvasStr=null,h._spriteStr=null,h._fpsData=[],h._timer=0,h._count=0,h._view=[],h._fontSize=12,h._txt=null,h._leftText=null,h._sp=null,h._titleSp=null,h._bgSp=null,h._show=!1,h._useCanvas=!1,h._canvas=null,h._ctx=null,h._first=!1,h._vx=NaN,h._width=0,h._height=100,h}(),Ji=function(){function t(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}I(t,"laya.d3.core.particleShuriKen.module.GradientDataInt");var e=t.prototype;return T.imps(e,{"laya.d3.core.IClone":!0}),e.add=function(t,e){this._currentLength<8?(6===this._currentLength&&1!==t&&(t=1,console.log("Warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=t,this._elements[this._currentLength++]=e):console.log("Warning:data count must lessEqual than 4")},e.cloneTo=function(t){var e=t;e._currentLength=this._currentLength;var i=e._elements;i.length=this._elements.length;for(var n=0,r=this._elements.length;n<r;n++)i[n]=this._elements[n]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},g(0,e,"gradientCount",function(){return this._currentLength/2}),t}(),tn=function(){function t(){this.ib=null,this.vb=null;en.mainContext;this.ib=Ts.create(35048),this.vb=_s.create(8)}I(t,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var e=t.prototype;return e.addSkinMesh=function(t){t.getData2(this.vb,this.ib,this.vb._byteLength/32)},e.reset=function(){this.vb.clear(),this.ib.clear()},t.getInstance=function(){return t.instance=t.instance||new t},t.instance=null,t}(),en=(function(){function t(){}I(t,"laya.display.SpriteConst"),t.ALPHA=1,t.TRANSFORM=2,t.BLEND=4,t.CANVAS=8,t.FILTERS=16,t.MASK=32,t.CLIP=64,t.STYLE=128,t.TEXTURE=256,t.GRAPHICS=512,t.LAYAGL3D=1024,t.CUSTOM=2048,t.ONECHILD=4096,t.CHILDS=8192,t.REPAINT_NONE=0,t.REPAINT_NODE=1,t.REPAINT_CACHE=2,t.REPAINT_ALL=3}(),function(){function i(){}return I(i,"laya.webgl.WebGL"),i._uint8ArraySlice=function(){for(var t=this.length,e=new Uint8Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},i._float32ArraySlice=function(){for(var t=this.length,e=new Float32Array(this.length),i=0;i<t;i++)e[i]=this[i];return e},i._uint16ArraySlice=function(t){var e,i=arguments,n=0,r=0;if(0===i.length)for(n=this.length,e=new Uint16Array(n),r=0;r<n;r++)e[r]=this[r];else if(2===i.length){var s=i[0],a=i[1];if(s<a)for(n=a-s,e=new Uint16Array(n),r=s;r<a;r++)e[r-s]=this[r];else e=new Uint16Array(0)}return e},i._nativeRender_enable=function(){i.isNativeRender_enable||(i.isNativeRender_enable=!0,j.__init_native(),As.prototype.uploadTexture2D=function(t){var e=j;e.bindTexture(laya.webgl.WebGL.mainContext,e.TEXTURE_2D,t)},Q.width=Vt.window.innerWidth,Q.height=Vt.window.innerHeight,Ki.measureText=function(t,e){return m.conchTextCanvas.font=e,m.conchTextCanvas.measureText(t)},Ki.enableNative=function(){qi.supportWebGLPlusRendering&&(z.uploadShaderUniforms=z.uploadShaderUniformsForNative,Oi=m.GLCommandEncoder,Nt=m.LayaGLContext);var t=Ps;t.prototype.render=t.prototype.renderToNative},Ki.clear=function(t){ji.set2DRenderConfig();var e=f.create(t).arrColor,i=Nt.instance;e&&i.clearColor(e[0],e[1],e[2],e[3]),i.clear(17664),Q.clear()},Ki.drawToCanvas=Ki.drawToTexture=function(t,e,i,n,r,s){r-=t.x,s-=t.y,r|=0,s|=0,i|=0,n|=0;var a=new Ys(!1),o=a.getContext("2d");return a.size(i,n),o.asBitmap=!0,o._targets.start(),Sn.renders[e]._fun(t,o,r,s),o.flush(),o._targets.end(),o._targets.restore(),a},da.prototype._uv=da.flipyuv,Object.defineProperty(da.prototype,"uv",{get:function(){return this._uv},set:function(t){this._uv=t}}),Ys.prototype.getTexture=function(){return this._texture||(this._texture=this.context._targets,this._texture.uv=da.flipyuv,this._texture.bitmap=this._texture),this._texture})},i.enable=function(){return!0},i.inner_enable=function(){return Float32Array.prototype.slice||(Float32Array.prototype.slice=i._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=i._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=i._uint8ArraySlice),qi.isConchApp&&i._nativeRender_enable(),!0},i.onStageResize=function(t,e){null!=i.mainContext&&(i.mainContext.viewport(0,0,t,e),Q.width=t,Q.height=e)},i.mainContext=null,i.shaderHighPrecision=!1,i._isWebGL2=!1,i.isNativeRender_enable=!1,i}()),nn=function(){function o(){this._type=0,this._separateAxes=!1,this._gradient=null,this._gradientX=null,this._gradientY=null,this._gradientZ=null,this._constantMin=NaN,this._constantMax=NaN,this._constantMinSeparate=null,this._constantMaxSeparate=null,this._gradientMin=null,this._gradientMax=null,this._gradientXMin=null,this._gradientXMax=null,this._gradientYMin=null,this._gradientYMax=null,this._gradientZMin=null,this._gradientZMax=null}I(o,"laya.d3.core.particleShuriKen.module.GradientSize");var t=o.prototype;return T.imps(t,{"laya.d3.core.IClone":!0}),t.getMaxSizeInGradient=function(){var t=0,e=0,i=-Number.MAX_VALUE;switch(this._type){case 0:if(this._separateAxes){for(t=0,e=this._gradientX.gradientCount;t<e;t++)i=Math.max(i,this._gradientX.getValueByIndex(t));for(t=0,e=this._gradientY.gradientCount;t<e;t++)i=Math.max(i,this._gradientY.getValueByIndex(t))}else for(t=0,e=this._gradient.gradientCount;t<e;t++)i=Math.max(i,this._gradient.getValueByIndex(t));break;case 1:i=this._separateAxes?(i=Math.max(this._constantMinSeparate.x,this._constantMaxSeparate.x),i=Math.max(i,this._constantMinSeparate.y),Math.max(i,this._constantMaxSeparate.y)):Math.max(this._constantMin,this._constantMax);break;case 2:if(this._separateAxes){for(t=0,e=this._gradientXMin.gradientCount;t<e;t++)i=Math.max(i,this._gradientXMin.getValueByIndex(t));for(t=0,e=this._gradientXMax.gradientCount;t<e;t++)i=Math.max(i,this._gradientXMax.getValueByIndex(t));for(t=0,e=this._gradientYMin.gradientCount;t<e;t++)i=Math.max(i,this._gradientYMin.getValueByIndex(t));for(t=0,e=this._gradientZMax.gradientCount;t<e;t++)i=Math.max(i,this._gradientZMax.getValueByIndex(t))}else{for(t=0,e=this._gradientMin.gradientCount;t<e;t++)i=Math.max(i,this._gradientMin.getValueByIndex(t));for(t=0,e=this._gradientMax.gradientCount;t<e;t++)i=Math.max(i,this._gradientMax.getValueByIndex(t))}}return i},t.cloneTo=function(t){var e=t;e._type=this._type,e._separateAxes=this._separateAxes,this._gradient.cloneTo(e._gradient),this._gradientX.cloneTo(e._gradientX),this._gradientY.cloneTo(e._gradientY),this._gradientZ.cloneTo(e._gradientZ),e._constantMin=this._constantMin,e._constantMax=this._constantMax,this._constantMinSeparate.cloneTo(e._constantMinSeparate),this._constantMaxSeparate.cloneTo(e._constantMaxSeparate),this._gradientMin.cloneTo(e._gradientMin),this._gradientMax.cloneTo(e._gradientMax),this._gradientXMin.cloneTo(e._gradientXMin),this._gradientXMax.cloneTo(e._gradientXMax),this._gradientYMin.cloneTo(e._gradientYMin),this._gradientYMax.cloneTo(e._gradientYMax),this._gradientZMin.cloneTo(e._gradientZMin),this._gradientZMax.cloneTo(e._gradientZMax)},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},g(0,t,"gradientZMax",function(){return this._gradientZMax}),g(0,t,"gradientZMin",function(){return this._gradientZMin}),g(0,t,"gradientYMax",function(){return this._gradientYMax}),g(0,t,"gradientYMin",function(){return this._gradientYMin}),g(0,t,"gradientMax",function(){return this._gradientMax}),g(0,t,"gradientXMax",function(){return this._gradientXMax}),g(0,t,"gradientY",function(){return this._gradientY}),g(0,t,"constantMinSeparate",function(){return this._constantMinSeparate}),g(0,t,"constantMax",function(){return this._constantMax}),g(0,t,"constantMaxSeparate",function(){return this._constantMaxSeparate}),g(0,t,"gradientZ",function(){return this._gradientZ}),g(0,t,"gradientX",function(){return this._gradientX}),g(0,t,"gradientMin",function(){return this._gradientMin}),g(0,t,"gradient",function(){return this._gradient}),g(0,t,"separateAxes",function(){return this._separateAxes}),g(0,t,"constantMin",function(){return this._constantMin}),g(0,t,"gradientXMin",function(){return this._gradientXMin}),g(0,t,"type",function(){return this._type}),o.createByGradient=function(t){var e=new o;return e._type=0,e._separateAxes=!1,e._gradient=t,e},o.createByGradientSeparate=function(t,e,i){var n=new o;return n._type=0,n._separateAxes=!0,n._gradientX=t,n._gradientY=e,n._gradientZ=i,n},o.createByRandomTwoConstant=function(t,e){var i=new o;return i._type=1,i._separateAxes=!1,i._constantMin=t,i._constantMax=e,i},o.createByRandomTwoConstantSeparate=function(t,e){var i=new o;return i._type=1,i._separateAxes=!0,i._constantMinSeparate=t,i._constantMaxSeparate=e,i},o.createByRandomTwoGradient=function(t,e){var i=new o;return i._type=2,i._separateAxes=!1,i._gradientMin=t,i._gradientMax=e,i},o.createByRandomTwoGradientSeparate=function(t,e,i,n,r,s){var a=new o;return a._type=2,a._separateAxes=!0,a._gradientXMin=t,a._gradientXMax=e,a._gradientYMin=i,a._gradientYMax=n,a._gradientZMin=r,a._gradientZMax=s,a},o}(),rn=function(){function t(){this._commands=[]}I(t,"laya.d3.core.render.command.CommandBuffer");var e=t.prototype;return e._apply=function(){for(var t=0,e=this._commands.length;t<e;t++)this._commands[t].run()},e.setShaderDataTexture=function(t,e,i){this._commands.push(pr.create(t,e,i))},e.blit=function(t,e,i,n,r){void 0===r&&(r=0),this._commands.push(yr.create(t,e,i,n,r))},e.setRenderTarget=function(t){this._commands.push(Vr.create(t))},e.clear=function(){for(var t=0,e=this._commands.length;t<e;t++)this._commands[t].recover();this._commands.length=0},t.SCREENTEXTURE_NAME="u_ScreenTexture",E(t,["screenShader",function(){return this.screenShader=We.find("ScreenQuad")},"SCREENTEXTURE_ID",function(){return this.SCREENTEXTURE_ID=We.propertyNameToID("u_ScreenTexture")}]),t}(),sn=function(){function o(){}I(o,"laya.display.cmd.DrawLinesCmd");var t=o.prototype;return t.recover=function(){this.points=null,this.lineColor=null,p.recover("DrawLinesCmd",this)},t.run=function(t,e,i){t._drawLines(this.x+e,this.y+i,this.points,this.lineColor,this.lineWidth,this.vid)},g(0,t,"cmdID",function(){return"DrawLines"}),o.create=function(t,e,i,n,r,s){var a=p.getItemByClass("DrawLinesCmd",o);return a.x=t,a.y=e,a.points=i,a.lineColor=n,a.lineWidth=r,a.vid=s,a},o.ID="DrawLines",o}(),an=function(){function t(){this._nodes=[]}I(t,"laya.d3.animation.KeyframeNodeList");var e=t.prototype;return e.getNodeByIndex=function(t){return this._nodes[t]},e.setNodeByIndex=function(t,e){this._nodes[t]=e},g(0,e,"count",function(){return this._nodes.length},function(t){this._nodes.length=t}),t}(),on=function(){function t(t,e,i,n){this.x=NaN,this.y=NaN,this.z=NaN,this.w=NaN,void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x=t,this.y=e,this.z=i,this.w=n}I(t,"laya.d3.math.Vector4");var e=t.prototype;return T.imps(e,{"laya.d3.core.IClone":!0}),e.setValue=function(t,e,i,n){this.x=t,this.y=e,this.z=i,this.w=n},e.fromArray=function(t,e){void 0===e&&(e=0),this.x=t[e+0],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3]},e.cloneTo=function(t){var e=t;e.x=this.x,e.y=this.y,e.z=this.z,e.w=this.w},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},e.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e.forNativeElement=function(t){t?(this.elements=t,this.elements[0]=this.x,this.elements[1]=this.y,this.elements[2]=this.z,this.elements[3]=this.w):this.elements=new Float32Array([this.x,this.y,this.z,this.w]),un.rewriteNumProperty(this,"x",0),un.rewriteNumProperty(this,"y",1),un.rewriteNumProperty(this,"z",2),un.rewriteNumProperty(this,"w",3)},t.lerp=function(t,e,i,n){var r=t.x,s=t.y,a=t.z,o=t.w;n.x=r+i*(e.x-r),n.y=s+i*(e.y-s),n.z=a+i*(e.z-a),n.w=o+i*(e.w-o)},t.transformByM4x4=function(t,e,i){var n=t.x,r=t.y,s=t.z,a=t.w,o=e.elements;i.x=n*o[0]+r*o[4]+s*o[8]+a*o[12],i.y=n*o[1]+r*o[5]+s*o[9]+a*o[13],i.z=n*o[2]+r*o[6]+s*o[10]+a*o[14],i.w=n*o[3]+r*o[7]+s*o[11]+a*o[15]},t.equals=function(t,e){return k.nearEqual(Math.abs(t.x),Math.abs(e.x))&&k.nearEqual(Math.abs(t.y),Math.abs(e.y))&&k.nearEqual(Math.abs(t.z),Math.abs(e.z))&&k.nearEqual(Math.abs(t.w),Math.abs(e.w))},t.normalize=function(t,e){var i=t.length();0<i&&(e.x=t.x*i,e.y=t.y*i,e.z=t.z*i,e.w=t.w*i)},t.add=function(t,e,i){i.x=t.x+e.x,i.y=t.y+e.y,i.z=t.z+e.z,i.w=t.w+e.w},t.subtract=function(t,e,i){i.x=t.x-e.x,i.y=t.y-e.y,i.z=t.z-e.z,i.w=t.w-e.w},t.multiply=function(t,e,i){i.x=t.x*e.x,i.y=t.y*e.y,i.z=t.z*e.z,i.w=t.w*e.w},t.scale=function(t,e,i){i.x=t.x*e,i.y=t.y*e,i.z=t.z*e,i.w=t.w*e},t.Clamp=function(t,e,i,n){var r=t.x,s=t.y,a=t.z,o=t.w,h=e.x,l=e.y,u=e.z,c=e.w,_=i.x,d=i.y,f=i.z,p=i.w;r=(r=_<r?_:r)<h?h:r,s=(s=d<s?d:s)<l?l:s,a=(a=f<a?f:a)<u?u:a,o=(o=p<o?p:o)<c?c:o,n.x=r,n.y=s,n.z=a,n.w=o},t.distanceSquared=function(t,e){var i=t.x-e.x,n=t.y-e.y,r=t.z-e.z,s=t.w-e.w;return i*i+n*n+r*r+s*s},t.distance=function(t,e){var i=t.x-e.x,n=t.y-e.y,r=t.z-e.z,s=t.w-e.w;return Math.sqrt(i*i+n*n+r*r+s*s)},t.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},t.min=function(t,e,i){i.x=Math.min(t.x,e.x),i.y=Math.min(t.y,e.y),i.z=Math.min(t.z,e.z),i.w=Math.min(t.w,e.w)},t.max=function(t,e,i){i.x=Math.max(t.x,e.x),i.y=Math.max(t.y,e.y),i.z=Math.max(t.z,e.z),i.w=Math.max(t.w,e.w)},E(t,["ZERO",function(){return this.ZERO=new t},"ONE",function(){return this.ONE=new t(1,1,1,1)},"UnitX",function(){return this.UnitX=new t(1,0,0,0)},"UnitY",function(){return this.UnitY=new t(0,1,0,0)},"UnitZ",function(){return this.UnitZ=new t(0,0,1,0)},"UnitW",function(){return this.UnitW=new t(0,0,0,1)}]),t}(),hn=function(){var t;function i(){}return I(i,"laya.net.LocalStorage"),i.__init__=function(){return i._baseClass||(i._baseClass=t).init(),i.items=i._baseClass.items,i.support=i._baseClass.support},i.setItem=function(t,e){i._baseClass.setItem(t,e)},i.getItem=function(t){return i._baseClass.getItem(t)},i.setJSON=function(t,e){i._baseClass.setJSON(t,e)},i.getJSON=function(t){return i._baseClass.getJSON(t)},i.removeItem=function(t){i._baseClass.removeItem(t)},i.clear=function(){i._baseClass.clear()},i._baseClass=null,i.items=null,i.support=!1,i.__init$=function(){t=function(){function i(){}return I(i,""),i.init=function(){try{i.support=!0,i.items=m.localStorage,i.setItem("laya","1"),i.removeItem("laya")}catch(t){i.support=!1}i.support||console.log("LocalStorage is not supprot or browser is private mode.")},i.setItem=function(t,e){try{i.support&&i.items.setItem(t,e)}catch(t){console.warn("set localStorage failed",t)}},i.getItem=function(t){return i.support?i.items.getItem(t):null},i.setJSON=function(t,e){try{i.support&&i.items.setItem(t,JSON.stringify(e))}catch(t){console.warn("set localStorage failed",t)}},i.getJSON=function(t){return JSON.parse(i.support?i.items.getItem(t):null)},i.removeItem=function(t){i.support&&i.items.removeItem(t)},i.clear=function(){i.support&&i.items.clear()},i.items=null,i.support=!1,i}()},i}(),ln=function(){function r(t,e,i,n){this.x=NaN,this.y=NaN,this.z=NaN,void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.x=t,this.y=e,this.z=i}I(r,"laya.d3.math.Vector3");var t=r.prototype;return T.imps(t,{"laya.d3.core.IClone":!0}),t.setValue=function(t,e,i){this.x=t,this.y=e,this.z=i},t.fromArray=function(t,e){void 0===e&&(e=0),this.x=t[e+0],this.y=t[e+1],this.z=t[e+2]},t.cloneTo=function(t){var e=t;e.x=this.x,e.y=this.y,e.z=this.z},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t.toDefault=function(){this.x=0,this.y=0,this.z=0},t.forNativeElement=function(t){t?(this.elements=t,this.elements[0]=this.x,this.elements[1]=this.y,this.elements[2]=this.z):this.elements=new Float32Array([this.x,this.y,this.z]),un.rewriteNumProperty(this,"x",0),un.rewriteNumProperty(this,"y",1),un.rewriteNumProperty(this,"z",2)},r.distanceSquared=function(t,e){var i=t.x-e.x,n=t.y-e.y,r=t.z-e.z;return i*i+n*n+r*r},r.distance=function(t,e){var i=t.x-e.x,n=t.y-e.y,r=t.z-e.z;return Math.sqrt(i*i+n*n+r*r)},r.min=function(t,e,i){i.x=Math.min(t.x,e.x),i.y=Math.min(t.y,e.y),i.z=Math.min(t.z,e.z)},r.max=function(t,e,i){i.x=Math.max(t.x,e.x),i.y=Math.max(t.y,e.y),i.z=Math.max(t.z,e.z)},r.transformQuat=function(t,e,i){var n=t.x,r=t.y,s=t.z,a=e.x,o=e.y,h=e.z,l=e.w,u=l*n+o*s-h*r,c=l*r+h*n-a*s,_=l*s+a*r-o*n,d=-a*n-o*r-h*s;i.x=u*l+d*-a+c*-h-_*-o,i.y=c*l+d*-o+_*-a-u*-h,i.z=_*l+d*-h+u*-o-c*-a},r.scalarLength=function(t){var e=t.x,i=t.y,n=t.z;return Math.sqrt(e*e+i*i+n*n)},r.scalarLengthSquared=function(t){var e=t.x,i=t.y,n=t.z;return e*e+i*i+n*n},r.normalize=function(t,e){var i=t.x,n=t.y,r=t.z,s=i*i+n*n+r*r;0<s&&(s=1/Math.sqrt(s),e.x=t.x*s,e.y=t.y*s,e.z=t.z*s)},r.multiply=function(t,e,i){i.x=t.x*e.x,i.y=t.y*e.y,i.z=t.z*e.z},r.scale=function(t,e,i){i.x=t.x*e,i.y=t.y*e,i.z=t.z*e},r.lerp=function(t,e,i,n){var r=t.x,s=t.y,a=t.z;n.x=r+i*(e.x-r),n.y=s+i*(e.y-s),n.z=a+i*(e.z-a)},r.transformV3ToV3=function(t,e,i){var n=r._tempVector4;r.transformV3ToV4(t,e,n),i.x=n.x,i.y=n.y,i.z=n.z},r.transformV3ToV4=function(t,e,i){var n=t.x,r=t.y,s=t.z,a=e.elements;i.x=n*a[0]+r*a[4]+s*a[8]+a[12],i.y=n*a[1]+r*a[5]+s*a[9]+a[13],i.z=n*a[2]+r*a[6]+s*a[10]+a[14],i.w=n*a[3]+r*a[7]+s*a[11]+a[15]},r.TransformNormal=function(t,e,i){var n=t.x,r=t.y,s=t.z,a=e.elements;i.x=n*a[0]+r*a[4]+s*a[8],i.y=n*a[1]+r*a[5]+s*a[9],i.z=n*a[2]+r*a[6]+s*a[10]},r.transformCoordinate=function(t,e,i){var n=t.x,r=t.y,s=t.z,a=e.elements,o=n*a[3]+r*a[7]+s*a[11]+a[15];i.x=n*a[0]+r*a[4]+s*a[8]+a[12]/o,i.y=n*a[1]+r*a[5]+s*a[9]+a[13]/o,i.z=n*a[2]+r*a[6]+s*a[10]+a[14]/o},r.Clamp=function(t,e,i,n){var r=t.x,s=t.y,a=t.z,o=e.x,h=e.y,l=e.z,u=i.x,c=i.y,_=i.z;r=(r=u<r?u:r)<o?o:r,s=(s=c<s?c:s)<h?h:s,a=(a=_<a?_:a)<l?l:a,n.x=r,n.y=s,n.z=a},r.add=function(t,e,i){i.x=t.x+e.x,i.y=t.y+e.y,i.z=t.z+e.z},r.subtract=function(t,e,i){i.x=t.x-e.x,i.y=t.y-e.y,i.z=t.z-e.z},r.cross=function(t,e,i){var n=t.x,r=t.y,s=t.z,a=e.x,o=e.y,h=e.z;i.x=r*h-s*o,i.y=s*a-n*h,i.z=n*o-r*a},r.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},r.equals=function(t,e){return k.nearEqual(t.x,e.x)&&k.nearEqual(t.y,e.y)&&k.nearEqual(t.z,e.z)},r._ZERO=new r(0,0,0),r._ONE=new r(1,1,1),r._NegativeUnitX=new r(-1,0,0),r._UnitX=new r(1,0,0),r._UnitY=new r(0,1,0),r._UnitZ=new r(0,0,1),r._ForwardRH=new r(0,0,-1),r._ForwardLH=new r(0,0,1),r._Up=new r(0,1,0),E(r,["_tempVector4",function(){return this._tempVector4=new on}]),r}(),un=function(){function e(t,e){this.x=NaN,this.y=NaN,void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}I(e,"laya.d3.math.Vector2");var t=e.prototype;return T.imps(t,{"laya.d3.core.IClone":!0}),t.setValue=function(t,e){this.x=t,this.y=e},t.fromArray=function(t,e){void 0===e&&(e=0),this.x=t[e+0],this.y=t[e+1]},t.cloneTo=function(t){var e=t;e.x=this.x,e.y=this.y},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t.forNativeElement=function(t){t?(this.elements=t,this.elements[0]=this.x,this.elements[1]=this.y):this.elements=new Float32Array([this.x,this.y]),e.rewriteNumProperty(this,"x",0),e.rewriteNumProperty(this,"y",1)},e.scale=function(t,e,i){i.x=t.x*e,i.y=t.y*e},e.dot=function(t,e){return t.x*e.x+t.y*e.y},e.normalize=function(t,e){var i=t.x,n=t.y,r=i*i+n*n;0<r&&(r=1/Math.sqrt(r),e.x=i*r,e.y=n*r)},e.scalarLength=function(t){var e=t.x,i=t.y;return Math.sqrt(e*e+i*i)},e.rewriteNumProperty=function(t,e,i){Object.defineProperty(t,e,{get:function(){return this.elements[i]},set:function(t){this.elements[i]=t}})},E(e,["ZERO",function(){return this.ZERO=new e(0,0)},"ONE",function(){return this.ONE=new e(1,1)}]),e}(),cn=function(){function e(){}return I(e,"laya.webgl.canvas.BlendMode"),e._init_=function(t){e.fns=[e.BlendNormal,e.BlendAdd,e.BlendMultiply,e.BlendScreen,e.BlendOverlay,e.BlendLight,e.BlendMask,e.BlendDestinationOut],e.targetFns=[e.BlendNormalTarget,e.BlendAddTarget,e.BlendMultiplyTarget,e.BlendScreenTarget,e.BlendOverlayTarget,e.BlendLightTarget,e.BlendMask,e.BlendDestinationOut]},e.BlendNormal=function(t){j.setBlendFunc(t,1,771)},e.BlendAdd=function(t){j.setBlendFunc(t,1,772)},e.BlendMultiply=function(t){j.setBlendFunc(t,774,771)},e.BlendScreen=function(t){j.setBlendFunc(t,1,1)},e.BlendOverlay=function(t){j.setBlendFunc(t,1,769)},e.BlendLight=function(t){j.setBlendFunc(t,1,1)},e.BlendNormalTarget=function(t){j.setBlendFunc(t,1,771)},e.BlendAddTarget=function(t){j.setBlendFunc(t,1,772)},e.BlendMultiplyTarget=function(t){j.setBlendFunc(t,774,771)},e.BlendScreenTarget=function(t){j.setBlendFunc(t,1,1)},e.BlendOverlayTarget=function(t){j.setBlendFunc(t,1,769)},e.BlendLightTarget=function(t){j.setBlendFunc(t,1,1)},e.BlendMask=function(t){j.setBlendFunc(t,0,770)},e.BlendDestinationOut=function(t){j.setBlendFunc(t,0,0)},e.activeBlendFunction=null,e.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],e.TOINT={normal:0,add:1,multiply:2,screen:3,overlay:4,light:5,mask:6,"destination-out":7,lighter:1},e.NORMAL="normal",e.ADD="add",e.MULTIPLY="multiply",e.SCREEN="screen",e.OVERLAY="overlay",e.LIGHT="light",e.MASK="mask",e.DESTINATIONOUT="destination-out",e.LIGHTER="lighter",e.fns=[],e.targetFns=[],e}(),_n=function(){function t(t){this._size=null,this.enbale=!1,this._size=t}I(t,"laya.d3.core.particleShuriKen.module.SizeOverLifetime");var e=t.prototype;return T.imps(e,{"laya.d3.core.IClone":!0}),e.cloneTo=function(t){var e=t;this._size.cloneTo(e._size),e.enbale=this.enbale},e.clone=function(){var t;switch(this._size.type){case 0:t=this._size.separateAxes?nn.createByGradientSeparate(this._size.gradientX.clone(),this._size.gradientY.clone(),this._size.gradientZ.clone()):nn.createByGradient(this._size.gradient.clone());break;case 1:t=this._size.separateAxes?nn.createByRandomTwoConstantSeparate(this._size.constantMinSeparate.clone(),this._size.constantMaxSeparate.clone()):nn.createByRandomTwoConstant(this._size.constantMin,this._size.constantMax);break;case 2:t=this._size.separateAxes?nn.createByRandomTwoGradientSeparate(this._size.gradientXMin.clone(),this._size.gradientYMin.clone(),this._size.gradientZMin.clone(),this._size.gradientXMax.clone(),this._size.gradientYMax.clone(),this._size.gradientZMax.clone()):nn.createByRandomTwoGradient(this._size.gradientMin.clone(),this._size.gradientMax.clone())}var e=new this.constructor(t);return e.enbale=this.enbale,e},g(0,e,"size",function(){return this._size}),t}(),dn=function(){function t(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}I(t,"laya.utils.Dragging");var e=t.prototype;return e.start=function(t,e,i,n,r,s,a,o){void 0===o&&(o=.92),this.clearTimer(),this.target=t,this.area=e,this.hasInertia=i,this.elasticDistance=e?n:0,this.elasticBackTime=r,this.data=s,this._disableMouseEvent=a,this.ratio=o,this._parent=t.parent,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,T.stage.on("mouseup",this,this.onStageMouseUp),T.stage.on("mouseout",this,this.onStageMouseUp),T.systemTimer.frameLoop(1,this,this.loop)},e.clearTimer=function(){T.systemTimer.clear(this,this.loop),T.systemTimer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},e.stop=function(){this._dragging&&(wi.instance.disableMouseEvent=!1,T.stage.off("mouseup",this,this.onStageMouseUp),T.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},e.loop=function(){var t=this._parent.getMousePoint(),e=t.x,i=t.y,n=e-this._lastX,r=i-this._lastY;if(this._clickOnly){if(!(1<Math.abs(n*T.stage._canvasTransform.getScaleX())||1<Math.abs(r*T.stage._canvasTransform.getScaleY())))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),wi.instance.disableMouseEvent=this._disableMouseEvent}else this._offsets.push(n,r);0===n&&0===r||(this._lastX=e,this._lastY=i,this.target.x+=n*this._elasticRateX,this.target.y+=r*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},e.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target._x<this.area.x)var t=this.area.x-this.target._x;else t=this.target._x>this.area.x+this.area.width?this.target._x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-t/this.elasticDistance),this.target._y<this.area.y)var e=this.area.y-this.target.y;else e=this.target._y>this.area.y+this.area.height?this.target._y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-e/this.elasticDistance)}},e.backToArea=function(){this.target.x=Math.min(Math.max(this.target._x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target._y,this.area.y),this.area.y+this.area.height)},e.onStageMouseUp=function(t){if(wi.instance.disableMouseEvent=!1,T.stage.off("mouseup",this,this.onStageMouseUp),T.stage.off("mouseout",this,this.onStageMouseUp),T.systemTimer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var e=this._offsets.length,i=Math.min(e,6),n=this._offsets.length-i,r=e-1;n<r;r--)this._offsetY+=this._offsets[r--],this._offsetX+=this._offsets[r];this._offsetX=this._offsetX/i*2,this._offsetY=this._offsetY/i*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=0<this._offsetX?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=0<this._offsetY?this.maxOffset:-this.maxOffset),T.systemTimer.frameLoop(1,this,this.tweenMove)}else 0<this.elasticDistance?this.checkElastic():this.clear()},e.checkElastic=function(){var t=NaN,e=NaN;if(this.target.x<this.area.x?t=this.area.x:this.target._x>this.area.x+this.area.width&&(t=this.area.x+this.area.width),this.target.y<this.area.y?e=this.area.y:this.target._y>this.area.y+this.area.height&&(e=this.area.y+this.area.height),isNaN(t)&&isNaN(e))this.clear();else{var i={};isNaN(t)||(i.x=t),isNaN(e)||(i.y=e),this._tween=Ii.to(this.target,i,this.elasticBackTime,Ue.sineOut,y.create(this,this.clear),0,!1,!1)}},e.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&(T.systemTimer.clear(this,this.tweenMove),0<this.elasticDistance?this.checkElastic():this.clear())},e.clear=function(){if(this.target){this.clearTimer();var t=this.target;this.target=null,this._parent=null,t.event("dragend",this.data)}},t}(),fn=function(){function t(){this.fontName=null,this.complete=null,this.err=null,this._fontTxt=null,this._url=null,this._div=null,this._txtWidth=NaN,this._http=null}I(t,"laya.net.TTFLoader");var e=t.prototype;return e.load=function(t){var e=(this._url=t).split(".ttf")[0].split("/");this.fontName=e[e.length-1],qi.isConchApp?this._loadConch():Vt.window.FontFace?this._loadWithFontFace():this._loadWithCSS()},e._loadConch=function(){this._http=new Qn,this._http.on("error",this,this._onErr),this._http.on("complete",this,this._onHttpLoaded),this._http.send(this._url,null,"get","arraybuffer")},e._onHttpLoaded=function(t){Vt.window.conchTextCanvas.setFontFaceFromBuffer(this.fontName,t),this._clearHttp(),this._complete()},e._clearHttp=function(){this._http&&(this._http.off("error",this,this._onErr),this._http.off("complete",this,this._onHttpLoaded),this._http=null)},e._onErr=function(){this._clearHttp(),this.err&&(this.err.runWith("fail:"+this._url),this.err=null)},e._complete=function(){T.systemTimer.clear(this,this._complete),T.systemTimer.clear(this,this._checkComplete),this._div&&this._div.parentNode&&(this._div.parentNode.removeChild(this._div),this._div=null),this.complete&&(this.complete.runWith(this),this.complete=null)},e._checkComplete=function(){Ki.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth&&this._complete()},e._loadWithFontFace=function(){var t=new Vt.window.FontFace(this.fontName,"url('"+this._url+"')");Vt.window.document.fonts.add(t);var e=this;t.loaded.then(function(){e._complete()}),t.load()},e._createDiv=function(){this._div=Vt.createElement("div"),this._div.innerHTML="laya";var t=this._div.style;t.fontFamily=this.fontName,t.position="absolute",t.left="-100px",t.top="-100px",Vt.document.body.appendChild(this._div)},e._loadWithCSS=function(){var t=this,e=Vt.createElement("style");e.type="text/css",Vt.document.body.appendChild(e),e.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}",this._fontTxt="40px "+this.fontName,this._txtWidth=Ki.measureText("LayaTTFFont",this._fontTxt).width;var i=this;e.onload=function(){T.systemTimer.once(1e4,i,t._complete)},T.systemTimer.loop(20,this,this._checkComplete),this._createDiv()},t._testString="LayaTTFFont",t}(),pn=(function(){function t(){this._nativeConstraint=null,this._simulation=null,this.rigidbodyA=null,this.rigidbodyB=null}I(t,"laya.d3.physics.Constraint3D")}(),function(){function t(){}I(t,"laya.webgl.shader.ShaderValue")}(),function(){function t(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}I(t,"laya.display.BitmapFont");var e=t.prototype;return e.loadFont=function(t,e){this._path=t,this._complete=e,t&&-1!==t.indexOf(".fnt")?T.loader.load([{url:t,type:"xml"},{url:t.replace(".fnt",".png"),type:"image"}],y.create(this,this._onLoaded)):console.error('Bitmap font configuration information must be a ".fnt" file')},e._onLoaded=function(){this.parseFont(Hn.getRes(this._path),Hn.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.run()},e.parseFont=function(t,e){if(null!=t&&null!=e){this._texture=e;var i=t.getElementsByTagName("info");if(!i[0].getAttributeNode)return this.parseFont2(t,e);this.fontSize=parseInt(i[0].getAttributeNode("size").nodeValue);var n,r=i[0].getAttributeNode("padding").nodeValue.split(",");this._padding=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])],n=t.getElementsByTagName("char");var s=0;for(s=0;s<n.length;s++){var a=n[s],o=parseInt(a.getAttributeNode("id").nodeValue),h=parseInt(a.getAttributeNode("xoffset").nodeValue)/1,l=parseInt(a.getAttributeNode("yoffset").nodeValue)/1,u=parseInt(a.getAttributeNode("xadvance").nodeValue)/1,c=new ve;c.x=parseInt(a.getAttributeNode("x").nodeValue),c.y=parseInt(a.getAttributeNode("y").nodeValue),c.width=parseInt(a.getAttributeNode("width").nodeValue),c.height=parseInt(a.getAttributeNode("height").nodeValue);var _=xr.create(e,c.x,c.y,c.width,c.height,h,l);this._maxWidth=Math.max(this._maxWidth,u+this.letterSpacing),this._fontCharDic[o]=_,this._fontWidthMap[o]=u}}},e.parseFont2=function(t,e){if(null!=t&&null!=e){this._texture=e;var i=t.getElementsByTagName("info");this.fontSize=parseInt(i[0].attributes.size.nodeValue);var n=i[0].attributes.padding.nodeValue.split(",");this._padding=[parseInt(n[0]),parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];var r=t.getElementsByTagName("char"),s=0;for(s=0;s<r.length;s++){var a=r[s].attributes,o=parseInt(a.id.nodeValue),h=parseInt(a.xoffset.nodeValue)/1,l=parseInt(a.yoffset.nodeValue)/1,u=parseInt(a.xadvance.nodeValue)/1,c=new ve;c.x=parseInt(a.x.nodeValue),c.y=parseInt(a.y.nodeValue),c.width=parseInt(a.width.nodeValue),c.height=parseInt(a.height.nodeValue);var _=xr.create(e,c.x,c.y,c.width,c.height,h,l);this._maxWidth=Math.max(this._maxWidth,u+this.letterSpacing),this._fontCharDic[o]=_,this._fontWidthMap[o]=u}}},e.getCharTexture=function(t){return this._fontCharDic[t.charCodeAt(0)]},e.destroy=function(){if(this._texture){for(var t in this._fontCharDic){var e=this._fontCharDic[t];e&&e.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null,this._complete=null,this._padding=null}},e.setSpaceWidth=function(t){this._spaceWidth=t},e.getCharWidth=function(t){var e=t.charCodeAt(0);return this._fontWidthMap[e]?this._fontWidthMap[e]+this.letterSpacing:" "===t?this._spaceWidth+this.letterSpacing:0},e.getTextWidth=function(t){for(var e=0,i=0,n=t.length;i<n;i++)e+=this.getCharWidth(t.charAt(i));return e},e.getMaxWidth=function(){return this._maxWidth},e.getMaxHeight=function(){return this.fontSize},e._drawText=function(t,e,i,n,r,s){var a,o=this.getTextWidth(t),h=0;"center"===r&&(h=(s-o)/2),"right"===r&&(h=s-o);for(var l=0,u=0,c=t.length;u<c;u++)(a=this.getCharTexture(t.charAt(u)))&&(e.graphics.drawImage(a,i+l+h,n),l+=this.getCharWidth(t.charAt(u)))},t}()),mn=function(){function n(){this._obj=null,this._obj=n.supportWeakMap?new Vt.window.WeakMap:{},n.supportWeakMap||n._maps.push(this)}I(n,"laya.utils.WeakObject");var t=n.prototype;return t.set=function(t,e){if(null!=t)if(n.supportWeakMap){var i=t;"string"!=typeof t&&"number"!=typeof t||(i=n._keys[t])||(i=n._keys[t]={k:t}),this._obj.set(i,e)}else"string"==typeof t||"number"==typeof t?this._obj[t]=e:(t.$_GID||(t.$_GID=nt.getGID()),this._obj[t.$_GID]=e)},t.get=function(t){if(null==t)return null;if(n.supportWeakMap){var e="string"==typeof t||"number"==typeof t?n._keys[t]:t;return e?this._obj.get(e):null}return"string"==typeof t||"number"==typeof t?this._obj[t]:this._obj[t.$_GID]},t.del=function(t){if(null!=t)if(n.supportWeakMap){var e="string"==typeof t||"number"==typeof t?n._keys[t]:t;if(!e)return;this._obj.delete(e)}else"string"==typeof t||"number"==typeof t?delete this._obj[t]:delete this._obj[this._obj.$_GID]},t.has=function(t){if(null==t)return!1;if(n.supportWeakMap){var e="string"==typeof t||"number"==typeof t?n._keys[t]:t;return this._obj.has(e)}return"string"==typeof t||"number"==typeof t?null!=this._obj[t]:null!=this._obj[this._obj.$_GID]},n.__init__=function(){(n.supportWeakMap=null!=Vt.window.WeakMap)||T.systemTimer.loop(n.delInterval,null,n.clearCache)},n.clearCache=function(){for(var t=0,e=n._maps.length;t<e;t++){n._maps[t]._obj={}}},n.supportWeakMap=!1,n.delInterval=6e5,n._keys={},n._maps=[],E(n,["I",function(){return this.I=new n}]),n}(),gn=function(){function r(t){this._url=null,this._path=null,this._url=r.formatURL(t),this._path=r.getPath(t)}I(r,"laya.net.URL");var t=r.prototype;return g(0,t,"path",function(){return this._path}),g(0,t,"url",function(){return this._url}),g(1,r,"basePath",function(){return r._basePath},function(t){r._basePath=T._getUrlPath(),r._basePath=r.formatURL(t)}),r.formatURL=function(t){if(!t)return"null path";if(0<t.indexOf(":"))return t;if(null!=r.customFormat&&(t=r.customFormat(t)),0<t.indexOf(":"))return t;var e=t.charAt(0);if("."===e)return r._formatRelativePath(r._basePath+t);if("~"===e)return r.rootPath+t.substring(1);if("d"===e){if(0===t.indexOf("data:image"))return t}else if("/"===e)return t;return r._basePath+t},r._formatRelativePath=function(t){for(var e=t.split("/"),i=0,n=e.length;i<n;i++)".."==e[i]&&(e.splice(i-1,2),i-=2);return e.join("/")},r.getPath=function(t){var e=t.lastIndexOf("/");return 0<e?t.substr(0,e+1):""},r.getFileName=function(t){var e=t.lastIndexOf("/");return 0<e?t.substr(e+1):t},r.getAdptedFilePath=function(t){if(!r.exportSceneToJson||!t)return t;var e,i,n=0;for(e=r._adpteTypeList.length,n=0;n<e;n++)i=r._adpteTypeList[n],t=t.replace(i[0],i[1]);return t},r.version={},r.exportSceneToJson=!1,r._basePath="",r.rootPath="",r.customFormat=function(t){var e=r.version[t];return!qi.isConchApp&&e&&(t+="?v="+e),t},E(r,["_adpteTypeList",function(){return this._adpteTypeList=[[".scene3d",".json"],[".scene",".json"],[".taa",".json"],[".prefab",".json"]]}]),r}(),vn=function(){function t(){this._lastUpdateFrame=-2147483648,this._updateFrame=-2147483648,this._isTrigger=!1,this.contacts=[]}return I(t,"laya.d3.physics.Collision"),t.prototype._setUpdateFrame=function(t){this._lastUpdateFrame=this._updateFrame,this._updateFrame=t},t}(),Tn=function(){function t(){}return I(t,"Config"),t.animationInterval=50,t.isAntialias=!1,t.isAlpha=!1,t.premultipliedAlpha=!0,t.isStencil=!0,t.preserveDrawingBuffer=!1,t.webGL2D_MeshAllocMaxMem=!0,t.is2DPixelArtGame=!1,t.useWebGL2=!1,t.useRetinalCanvas=!1,t}(),yn=function(){function t(){this._currentLength=0,this._elements=null,this._elements=new Float32Array(8)}I(t,"laya.d3.core.particleShuriKen.module.GradientDataNumber");var e=t.prototype;return T.imps(e,{"laya.d3.core.IClone":!0}),e.add=function(t,e){this._currentLength<8?(6===this._currentLength&&1!==t&&(t=1,console.log("GradientDataNumber warning:the forth key is  be force set to 1.")),this._elements[this._currentLength++]=t,this._elements[this._currentLength++]=e):console.log("GradientDataNumber warning:data count must lessEqual than 4")},e.getKeyByIndex=function(t){return this._elements[2*t]},e.getValueByIndex=function(t){return this._elements[2*t+1]},e.getAverageValue=function(){for(var t=0,e=this._currentLength-2;t<e;t+=2){this._elements[t+1];this._elements[t+3],this._elements[t+2]-this._elements[t]}return 0},e.cloneTo=function(t){var e=t;e._currentLength=this._currentLength;var i=e._elements;i.length=this._elements.length;for(var n=0,r=this._elements.length;n<r;n++)i[n]=this._elements[n]},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},g(0,e,"gradientCount",function(){return this._currentLength/2}),t}(),En=function(){function t(){this.succeeded=!1,this.collider=null,this.hitFraction=0,this.point=new ln,this.normal=new ln}return I(t,"laya.d3.physics.HitResult"),t}(),xn=function(){function t(){this.time=NaN,this.eventName=null,this.params=null}return I(t,"laya.d3.animation.AnimationEvent"),t}(),Sn=function(){function f(t,e){if(n.map[t])return this._fun=n.map[t],void(this._next=f.NORENDER);switch(this._next=e||f.NORENDER,t){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._alpha);case 2:return void(this._fun=this._transform);case 4:return void(this._fun=this._blend);case 8:return void(this._fun=this._canvas);case 32:return void(this._fun=this._mask);case 64:return void(this._fun=this._clip);case 128:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 8192:return void(this._fun=this._children);case 2048:return void(this._fun=this._custom);case 256:return void(this._fun=this._texture);case 16:return void(this._fun=xt._filter);case 69905:return void(this._fun=f._initRenderFun)}this.onCreate(t)}I(f,"laya.renders.RenderSprite");var t=f.prototype;return t.onCreate=function(t){},t._style=function(t,e,i,n){var r=t._style;null!=r.render&&r.render(t,e,i,n);var s=this._next;s._fun.call(s,t,e,i,n)},t._no=function(t,e,i,n){},t._custom=function(t,e,i,n){t.customRender(e,i,n),this._next._fun.call(this._next,t,e,i-t.pivotX,n-t.pivotY)},t._clip=function(t,e,i,n){var r=this._next;if(r!=f.NORENDER){var s=t._style.scrollRect;e.save(),e.clipRect(i,n,s.width,s.height),r._fun.call(r,t,e,i-s.x,n-s.y),e.restore()}},t._texture=function(t,e,i,n){var r=t.texture;r._getSource()&&e.drawTexture(r,i-t.pivotX+r.offsetX,n-t.pivotY+r.offsetY,t._width||r.width,t._height||r.height);var s=this._next;s!=f.NORENDER&&s._fun.call(s,t,e,i,n)},t._graphics=function(t,e,i,n){var r=t._style,s=t._graphics;s&&s._render(t,e,i-r.pivotX,n-r.pivotY);var a=this._next;a!=f.NORENDER&&a._fun.call(a,t,e,i,n)},t._image=function(t,e,i,n){var r=t._style;e.drawTexture2(i,n,r.pivotX,r.pivotY,t.transform,t._graphics._one)},t._image2=function(t,e,i,n){var r=t._style;e.drawTexture2(i,n,r.pivotX,r.pivotY,t.transform,t._graphics._one)},t._alpha=function(t,e,i,n){var r;if(.01<(r=t._style.alpha)||t._needRepaint()){var s=e.globalAlpha;e.globalAlpha*=r;var a=this._next;a._fun.call(a,t,e,i,n),e.globalAlpha=s}},t._transform=function(t,e,i,n){var r=t.transform,s=this._next;t._style;r&&s!=f.NORENDER?(e.save(),e.transform(r.a,r.b,r.c,r.d,r.tx+i,r.ty+n),s._fun.call(s,t,e,0,0),e.restore()):s!=f.NORENDER&&s._fun.call(s,t,e,i,n)},t._children=function(t,e,i,n){var r,s=t._style,a=t._children,o=a.length;i-=t.pivotX,n-=t.pivotY;var h=t._getBit(256)&&e.drawCallOptimize(!0);if(s.viewport){var l=s.viewport,u=l.x,c=l.y,_=l.right,d=l.bottom,f=NaN,p=NaN;for(m=0;m<o;++m)(r=a[m])._visible&&(f=r._x)<_&&f+r.width>u&&(p=r._y)<d&&p+r.height>c&&r.render(e,i,n)}else for(var m=0;m<o;++m)(r=a[m])._visible&&r.render(e,i,n);h&&e.drawCallOptimize(!1)},t._canvas=function(t,e,i,n){var r=t._cacheStyle,s=this._next;if(r.enableCanvasRender){"bitmap"===r.cacheAs?$i.canvasBitmap++:$i.canvasNormal++;var a=!1,o=!1;if(r.canvas){var h=r.canvas,l=(h.context,h.touches);if(l)for(var u=0;u<l.length;u++)if(l[u].deleted){o=!0;break}a=h.isCacheValid&&!h.isCacheValid()}if(t._needRepaint()||!r.canvas||o||a||T.stage.isGlobalRepaint())if("normal"===r.cacheAs){if(e._targets)return void s._fun.call(s,t,e,i,n);this._canvas_webgl_normal_repaint(t,e)}else this._canvas_repaint(t,e,i,n);var c=r.cacheRect;e.drawCanvas(r.canvas,i+c.x,n+c.y,c.width,c.height)}else s._fun.call(s,t,e,i,n)},t._canvas_repaint=function(t,e,i,n){var r,s,a,o,h,l,u,c,_,d=t._cacheStyle,f=this._next,p=d.canvas,m=d.cacheAs;if(u=(_=d._calculateCacheRect(t,m,i,n)).x,c=_.y,h=(o=d.cacheRect).width*u,l=o.height*c,s=o.x,a=o.y,"bitmap"===m&&(2048<h||2048<l))return console.warn("cache bitmap size larger than 2048,cache ignored"),d.releaseContext(),void f._fun.call(f,t,e,i,n);if(p||(d.createContext(),p=d.canvas),(r=p.context).sprite=t,(p.width!=h||p.height!=l)&&p.size(h,l),"bitmap"===m?r.asBitmap=!0:"normal"===m&&(r.asBitmap=!1),r.clear(),1!=u||1!=c){var g=r;g.save(),g.scale(u,c),f._fun.call(f,t,r,-s,-a),g.restore(),t._applyFilters()}else g=r,f._fun.call(f,t,r,-s,-a),t._applyFilters();d.staticCache&&(d.reCache=!1),$i.canvasReCache++},t._canvas_webgl_normal_repaint=function(t,e){var i=t._cacheStyle,n=this._next,r=i.canvas,s=i.cacheAs;i._calculateCacheRect(t,s,0,0);r||(r=i.canvas=new T.WebGLCacheAsNormalCanvas(e,t));var a=r.context;r.startRec(),n._fun.call(n,t,a,t.pivotX,t.pivotY),t._applyFilters(),$i.canvasReCache++,r.endRec()},t._blend=function(t,e,i,n){var r=t._style,s=this._next;r.blendMode?(e.save(),e.globalCompositeOperation=r.blendMode,s._fun.call(s,t,e,i,n),e.restore()):s._fun.call(s,t,e,i,n)},t._mask=function(t,e,i,n){var r=this._next,s=t.mask,a=e;if(s){a.save();var o=a.globalCompositeOperation,h=new ve;if(h.copyFrom(s.getBounds()),h.width=Math.round(h.width),h.height=Math.round(h.height),h.x=Math.round(h.x),h.y=Math.round(h.y),0<h.width&&0<h.height){var l=h.width,u=h.height,c=ce.getRT(l,u);a.breakNextMerge(),a.pushRT(),a.addRenderObject(Yt.create([a,c,l,u],f.tmpTarget,this)),s.render(a,-h.x,-h.y),a.breakNextMerge(),a.popRT(),a.save(),a.clipRect(i+h.x-t.getStyle().pivotX,n+h.y-t.getStyle().pivotY,l,u),r._fun.call(r,t,a,i,n),a.restore(),o=a.globalCompositeOperation,a.addRenderObject(Yt.create(["mask"],f.setBlendMode,this));var _=Ot.create(1,0),d=xr.INV_UV;a.drawTarget(c,i+h.x-t.getStyle().pivotX,n+h.y-t.getStyle().pivotY,l,u,It.TEMP.identity(),_,d,6),a.addRenderObject(Yt.create([c],f.recycleTarget,this)),a.addRenderObject(Yt.create([o],f.setBlendMode,this))}a.restore()}else r._fun.call(r,t,e,i,n)},f.__init__=function(){n.__init__();var t,e,i=0;for(e=new f(69905,null),t=f.renders.length=16384,i=0;i<t;i++)f.renders[i]=e;f.renders[0]=new f(0,null)},f._initRenderFun=function(t,e,i,n){var r=t._renderType;(f.renders[r]=f._getTypeRender(r))._fun(t,e,i,n)},f._getTypeRender=function(t){if(n.map[t])return new f(t,null);for(var e=null,i=8192;0<i;)i&t&&(e=new f(i,e)),i>>=1;return e},f.tmpTarget=function(t,e,i,n){e.start(),e.clear(0,0,0,0)},f.recycleTarget=function(t){ce.releaseRT(t)},f.setBlendMode=function(t){var e=en.mainContext;cn.targetFns[cn.TOINT[t]](e)},f.INIT=69905,f.renders=[],f.NORENDER=new f(0,null),E(f,["tempUV",function(){return this.tempUV=new Array(8)}]),f}(),Cn=function(){function d(){}return I(d,"laya.utils.ClassUtils"),d.regClass=function(t,e){d._classMap[t]=e},d.regShortClassName=function(t){for(var e=0;e<t.length;e++){var i=t[e],n=i.name;d._classMap[n]=i}},d.getRegClass=function(t){return d._classMap[t]},d.getClass=function(t){var e=d._classMap[t]||t;return"string"==typeof e?T.__classmap[e]||T[t]:e},d.getInstance=function(t){var e=d.getClass(t);return e?new e:(console.warn("[error] Undefined class:",t),null)},d.createByJson=function(t,e,i,n,r){"string"==typeof t&&(t=JSON.parse(t));var s=t.props;if(!e&&!(e=r?r.runWith(t):d.getInstance(s.runtime||t.type)))return null;var a=t.child;if(a)for(var o=0,h=a.length;o<h;o++){var l=a[o];if("render"!==l.props.name&&"render"!==l.props.renderType||!e._$set_itemRender)if("Graphic"==l.type)d._addGraphicsToSprite(l,e);else if(d._isDrawType(l.type))d._addGraphicToSprite(l,e,!0);else{var u=d.createByJson(l,null,i,n,r);"Script"===l.type?u.hasOwnProperty("owner")?u.owner=e:u.hasOwnProperty("target")&&(u.target=e):"mask"==l.props.renderType?e.mask=u:e.addChild(u)}else e.itemRender=l}if(s)for(var c in s){var _=s[c];"var"===c&&i?i[_]=e:_ instanceof Array&&"function"==typeof e[c]?e[c].apply(e,_):e[c]=_}return n&&t.customProps&&n.runWith([e,t]),e.created&&e.created(),e},d._addGraphicsToSprite=function(t,e){var i=t.child;if(i&&!(i.length<1)){var n=d._getGraphicsFromSprite(t,e),r=0,s=0;t.props&&(r=d._getObjVar(t.props,"x",0),s=d._getObjVar(t.props,"y",0)),0!=r&&0!=s&&n.translate(r,s);var a,o=0;for(a=i.length,o=0;o<a;o++)d._addGraphicToGraphics(i[o],n);0!=r&&0!=s&&n.translate(-r,-s)}},d._addGraphicToSprite=function(t,e,i){void 0===i&&(i=!1);var n=i?d._getGraphicsFromSprite(t,e):e.graphics;d._addGraphicToGraphics(t,n)},d._getGraphicsFromSprite=function(t,e){if(!t||!t.props)return e.graphics;var i=t.props.renderType;if("hit"===i||"unHit"===i){var n=e._style.hitArea||(e.hitArea=new Ci);n[i]||(n[i]=new $);var r=n[i]}return r||(r=e.graphics),r},d._getTransformData=function(t){var e;(t.hasOwnProperty("pivotX")||t.hasOwnProperty("pivotY"))&&(e=e||new It).translate(-d._getObjVar(t,"pivotX",0),-d._getObjVar(t,"pivotY",0));var i=d._getObjVar(t,"scaleX",1),n=d._getObjVar(t,"scaleY",1),r=d._getObjVar(t,"rotation",0);d._getObjVar(t,"skewX",0),d._getObjVar(t,"skewY",0);return 1==i&&1==n&&0==r||((e=e||new It).scale(i,n),e.rotate(.0174532922222222*r)),e},d._addGraphicToGraphics=function(t,e){var i,n;if((i=t.props)&&(n=d.DrawTypeDic[t.type])){var r=e,s=d._getParams(i,n[1],n[2],n[3]),a=d._tM;(a||1!=d._alpha)&&(r.save(),a&&r.transform(a),1!=d._alpha&&r.alpha(d._alpha)),r[n[0]].apply(r,s),(a||1!=d._alpha)&&r.restore()}},d._adptLineData=function(t){return t[2]=parseFloat(t[0])+parseFloat(t[2]),t[3]=parseFloat(t[1])+parseFloat(t[3]),t},d._adptTextureData=function(t){return t[0]=Hn.getRes(t[0]),t},d._adptLinesData=function(t){return t[2]=d._getPointListByStr(t[2]),t},d._isDrawType=function(t){return"Image"!==t&&d.DrawTypeDic.hasOwnProperty(t)},d._getParams=function(t,e,i,n){void 0===i&&(i=0);var r=d._temParam;r.length=e.length;var s,a,o=0;for(s=e.length,o=0;o<s;o++)r[o]=d._getObjVar(t,e[o][0],e[o][1]);return d._alpha=d._getObjVar(t,"alpha",1),a=d._getTransformData(t),d._tM=a?(i||(i=0),a.translate(r[i],r[i+1]),r[i]=r[i+1]=0,a):null,n&&d[n]&&(r=d[n](r)),r},d._getPointListByStr=function(t){var e,i=t.split(","),n=0;for(e=i.length,n=0;n<e;n++)i[n]=parseFloat(i[n]);return i},d._getObjVar=function(t,e,i){return t.hasOwnProperty(e)?t[e]:i},d._temParam=[],d._classMap={Sprite:ts,Scene:xs,Text:Os,Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivParser",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement",link:"laya.html.dom.HTMLLinkElement"},d._tM=null,d._alpha=NaN,E(d,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),d}(),In=function(){function N(){}return I(N,"Laya3D"),g(1,N,"enbalePhysics",function(){return N._enbalePhysics}),N._cancelLoadByUrl=function(t){T.loader.cancelLoadByUrl(t),N._innerFirstLevelLoaderManager.cancelLoadByUrl(t),N._innerSecondLevelLoaderManager.cancelLoadByUrl(t),N._innerThirdLevelLoaderManager.cancelLoadByUrl(t),N._innerFourthLevelLoaderManager.cancelLoadByUrl(t)},N._changeWebGLSize=function(t,e){en.onStageResize(t,e),Ei.clientWidth=t,Ei.clientHeight=e},N.__init__=function(t,e,i){if(Tn.isAntialias=i.isAntialias,Tn.isAlpha=i.isAlpha,Tn.premultipliedAlpha=i.premultipliedAlpha,Tn.isStencil=i.isStencil,en.enable()){Ki.changeWebGLSize=N._changeWebGLSize,qi.is3DMode=!0,T.init(t,e),qi.supportWebGLPlusRendering||(Nt.instance=en.mainContext,Nt.instance.createCommandEncoder=function(t,e,i){return void 0===t&&(t=128),void 0===e&&(e=64),void 0===i&&(i=!1),new Oi(this,t,e,i)}),N.enableNative3D(),es.__init__(),Is.__init__(),pa.__init__(),aa.__init__(),Ca.__init__(),as.__init__(),Ls.__init__(),Xs.__init__(),Ns.__init__(),Fs.__init__(),Ws.__init__(),xa.__init__(),Hs.__init__(),Zs.__init__(),ks.__init__(),js.__init__(),Gs.__init__(),Ks.__init__(),Ti.__init__(),Us.defaultMaterial.lock=!0,Ls.defaultMaterial.lock=!0,Zs.defaultMaterial.lock=!0,Xs.defaultMaterial.lock=!0,Ns.defaultMaterial.lock=!0,Ws.defaultMaterial.lock=!0,js.defaultMaterial.lock=!0,Hs.defaultMaterial.lock=!0,Fs.defaultMaterial.lock=!0,bs.defaultMaterial.lock=!0,ks.defaultMaterial.lock=!0,ea.__init__(),ya.__init__(),Vn.__init__(),Fn.__init__(),gs.__init__(),he.__init__(),ye.__init__(),Je.__init__();var n=Jn.createMap;n.lh=["HIERARCHY",es._parse],n.ls=["HIERARCHY",Rs._parse],n.lm=["MESH",ms._parse],n.lmat=["MATERIAL",as._parse],n.ltc=["TEXTURECUBE",ya._parse],n.jpg=["TEXTURE2D",ea._parse],n.jpeg=["TEXTURE2D",ea._parse],n.bmp=["TEXTURE2D",ea._parse],n.gif=["TEXTURE2D",ea._parse],n.png=["TEXTURE2D",ea._parse],n.dds=["TEXTURE2D",ea._parse],n.ktx=["TEXTURE2D",ea._parse],n.pvr=["TEXTURE2D",ea._parse],n.lani=["ANIMATIONCLIP",is._parse],n.lav=["AVATAR",fs._parse],n.thdata=["TERRAINHEIGHTDATA",vs._pharse];var r=Hn.parserMap;r.HIERARCHY=N._loadHierarchy,r.MESH=N._loadMesh,r.MATERIAL=N._loadMaterial,r.TEXTURECUBE=N._loadTextureCube,r.TEXTURE2D=N._loadTexture2D,r.ANIMATIONCLIP=N._loadAnimationClip,r.AVATAR=N._loadAvatar,N._innerFirstLevelLoaderManager.on("error",null,N._eventLoadManagerError),N._innerSecondLevelLoaderManager.on("error",null,N._eventLoadManagerError),N._innerThirdLevelLoaderManager.on("error",null,N._eventLoadManagerError),N._innerFourthLevelLoaderManager.on("error",null,N._eventLoadManagerError)}else alert("Laya3D init error,must support webGL!")},N.enableNative3D=function(){if(qi.isConchApp){Nt=m.LayaGLContext;var t=xe,e=ds,i=fs,n=ye,r=cs;if(qi.supportWebGLPlusRendering&&(t.prototype._initData=t.prototype._initDataForNative,t.prototype.setBool=t.prototype.setBoolForNative,t.prototype.getBool=t.prototype.getBoolForNative,t.prototype.setInt=t.prototype.setIntForNative,t.prototype.getInt=t.prototype.getIntForNative,t.prototype.setNumber=t.prototype.setNumberForNative,t.prototype.getNumber=t.prototype.getNumberForNative,t.prototype.setVector=t.prototype.setVectorForNative,t.prototype.getVector=t.prototype.getVectorForNative,t.prototype.setVector2=t.prototype.setVector2ForNative,t.prototype.getVector2=t.prototype.getVector2ForNative,t.prototype.setVector3=t.prototype.setVector3ForNative,t.prototype.getVector3=t.prototype.getVector3ForNative,t.prototype.setQuaternion=t.prototype.setQuaternionForNative,t.prototype.getQuaternion=t.prototype.getQuaternionForNative,t.prototype.setMatrix4x4=t.prototype.setMatrix4x4ForNative,t.prototype.getMatrix4x4=t.prototype.getMatrix4x4ForNative,t.prototype.setBuffer=t.prototype.setBufferForNative,t.prototype.getBuffer=t.prototype.getBufferForNative,t.prototype.setTexture=t.prototype.setTextureForNative,t.prototype.getTexture=t.prototype.getTextureForNative,t.prototype.setAttribute=t.prototype.setAttributeForNative,t.prototype.getAttribute=t.prototype.getAttributeForNative,t.prototype.cloneTo=t.prototype.cloneToForNative,t.prototype.getData=t.prototype.getDataForNative,e.prototype._uniformMatrix2fv=e.prototype._uniformMatrix2fvForNative,e.prototype._uniformMatrix3fv=e.prototype._uniformMatrix3fvForNative,e.prototype._uniformMatrix4fv=e.prototype._uniformMatrix4fvForNative,r.prototype._renderUpdateWithCamera=r.prototype._renderUpdateWithCameraForNative),qi.supportWebGLPlusCulling&&(n.renderObjectCulling=ye.renderObjectCullingNative),qi.supportWebGLPlusAnimation){i.prototype._cloneDatasToAnimator=i.prototype._cloneDatasToAnimatorNative,Gn=m.conchFloatKeyframe,Ln=m.conchFloatArrayKeyframe,Yn=m.conchFloatArrayKeyframe,Fe=m.conchKeyframeNode,an=m.conchKeyframeNodeList;var s=is;s.prototype._evaluateClipDatasRealTime=s.prototype._evaluateClipDatasRealTimeForNative}}en.shaderHighPrecision=!1,Nt.instance.getShaderPrecisionFormat(35632,36338).precision?en.shaderHighPrecision=!0:en.shaderHighPrecision=!1},N.formatRelativePath=function(t,e){var i;if(i=t+e,"."===e.charAt(0)){for(var n=i.split("/"),r=0,s=n.length;r<s;r++)if(".."==n[r]){var a=r-1;0<a&&".."!==n[a]&&(n.splice(a,2),r-=2)}i=n.join("/")}return i},N._endLoad=function(t,e,i){if(i)for(var n=0,r=i.length;n<r;n++){var s=Hn.getRes(i[n]);s&&s._removeReference()}t.endLoad(e)},N._eventLoadManagerError=function(t){T.loader.event("error",t)},N._addHierarchyInnerUrls=function(t,e,i,n,r,s,a,o){var h=N.formatRelativePath(n,r);return i&&(h+=i),t.push({url:h,type:s,constructParams:a,propertyParams:o}),e.push(h),h},N._getSprite3DHierarchyInnerUrls=function(t,e,i,n,r,s,a,o){var h=0,l=0,u=t.props;switch(t.type){case"Scene3D":var c=u.lightmaps;for(h=0,l=c.length;h<l;h++){var _=c[h];_.path=N._addHierarchyInnerUrls(r,s,a,o,_.path,"TEXTURE2D",_.constructParams,_.propertyParams)}var d=u.reflectionTexture;if(d&&(u.reflectionTexture=N._addHierarchyInnerUrls(n,s,a,o,d,"TEXTURECUBE")),u.sky){var f=u.sky.material;f&&(f.path=N._addHierarchyInnerUrls(i,s,a,o,f.path,"MATERIAL"))}break;case"Camera":var p=u.skyboxMaterial;p&&(p.path=N._addHierarchyInnerUrls(i,s,a,o,p.path,"MATERIAL"));break;case"TrailSprite3D":case"MeshSprite3D":case"SkinnedMeshSprite3D":var m=u.meshPath;m&&(u.meshPath=N._addHierarchyInnerUrls(e,s,a,o,m,"MESH"));var g=u.materials;if(g)for(h=0,l=g.length;h<l;h++)g[h].path=N._addHierarchyInnerUrls(i,s,a,o,g[h].path,"MATERIAL");break;case"ShuriKenParticle3D":var v=u.meshPath;v&&(u.meshPath=N._addHierarchyInnerUrls(e,s,a,o,v,"MESH")),u.material.path=N._addHierarchyInnerUrls(i,s,a,o,u.material.path,"MATERIAL");break;case"Terrain":N._addHierarchyInnerUrls(r,s,a,o,u.dataPath,"TERRAIN")}var T=t.components;if(T)for(var y=0,E=T.length;y<E;y++){var x=T[y];switch(x.type){case"Animator":x.avatarPath;var S=x.avatar;S&&(S.path=N._addHierarchyInnerUrls(r,s,a,o,S.path,"AVATAR"));var C=x.clipPaths;if(C)for(h=0,l=C.length;h<l;h++)C[h]=N._addHierarchyInnerUrls(r,s,a,o,C[h],"ANIMATIONCLIP");else{var I=x.layers;for(h=0;h<I.length;h++)for(var R=I[h].states,A=0,M=R.length;A<M;A++){var D=R[A].clipPath;D&&(R[A].clipPath=N._addHierarchyInnerUrls(r,s,a,o,D,"ANIMATIONCLIP"))}}break;case"PhysicsCollider":case"Rigidbody3D":case"CharacterController":var b=x.shapes;for(h=0;h<b.length;h++){var w=b[h];if("MeshColliderShape"===w.type){var L=w.mesh;L&&(w.mesh=N._addHierarchyInnerUrls(e,s,a,o,L,"MESH"))}}}}var O=t.child;for(h=0,l=O.length;h<l;h++)N._getSprite3DHierarchyInnerUrls(O[h],e,i,n,r,s,a,o)},N._loadHierarchy=function(t){t.on("loaded",null,N._onHierarchylhLoaded,[t]),t.load(t.url,"json",!1,null,!0)},N._onHierarchylhLoaded=function(t,e){var i=t.url,n=V.getURLVerion(i),r=gn.getPath(i),s=[],a=[],o=[],h=[],l=[];N._getSprite3DHierarchyInnerUrls(e.data,s,a,o,h,l,n,r);var u=s.length+a.length+h.length,c=u+1,_=1/c;if(N._onProcessChange(t,0,_,1),0<h.length){var d=u/c,f=y.create(null,N._onProcessChange,[t,_,d],!1);N._innerFourthLevelLoaderManager._create(h,!1,y.create(null,N._onHierarchyInnerForthLevResouLoaded,[t,f,e,l,s,a,o,_+d*h.length,d]),f,null,null,null,1,!0)}else N._onHierarchyInnerForthLevResouLoaded(t,null,e,l,s,a,o,_,d)},N._onHierarchyInnerForthLevResouLoaded=function(t,e,i,n,r,s,a,o,h){if(e&&e.recover(),0<a.length){var l=y.create(null,N._onProcessChange,[t,o,h],!1);N._innerThirdLevelLoaderManager._create(a,!1,y.create(null,N._onHierarchyInnerThirdLevResouLoaded,[t,l,i,n,r,s,o+h*s.length,h]),e,null,null,null,1,!0)}else N._onHierarchyInnerThirdLevResouLoaded(t,null,i,n,r,s,o,h)},N._onHierarchyInnerThirdLevResouLoaded=function(t,e,i,n,r,s,a,o){if(e&&e.recover(),0<s.length){var h=y.create(null,N._onProcessChange,[t,a,o],!1);N._innerSecondLevelLoaderManager._create(s,!1,y.create(null,N._onHierarchyInnerSecondLevResouLoaded,[t,h,i,n,r,a+o*s.length,o]),e,null,null,null,1,!0)}else N._onHierarchyInnerSecondLevResouLoaded(t,null,i,n,r,a,o)},N._onHierarchyInnerSecondLevResouLoaded=function(t,e,i,n,r,s,a){if(e&&e.recover(),0<r.length){var o=y.create(null,N._onProcessChange,[t,s,a],!1);N._innerFirstLevelLoaderManager._create(r,!1,y.create(null,N._onHierarchyInnerFirstLevResouLoaded,[t,o,i,n]),e,null,null,null,1,!0)}else N._onHierarchyInnerFirstLevResouLoaded(t,null,i,n)},N._onHierarchyInnerFirstLevResouLoaded=function(t,e,i,n){e&&e.recover(),t._cache=t._createCache;var r="Scene3D"===i.data.type?Rs._parse(i,t._propertyParams,t._constructParams):es._parse(i,t._propertyParams,t._constructParams);N._endLoad(t,r,n)},N._loadMesh=function(t){t.on("loaded",null,N._onMeshLmLoaded,[t]),t.load(t.url,"arraybuffer",!1,null,!0)},N._onMeshLmLoaded=function(t,e){t._cache=t._createCache;var i=ms._parse(e,t._propertyParams,t._constructParams);N._endLoad(t,i)},N._loadMaterial=function(t){t.on("loaded",null,N._onMaterilLmatLoaded,[t]),t.load(t.url,"json",!1,null,!0)},N._onMaterilLmatLoaded=function(t,e){var i,n=t.url,r=V.getURLVerion(n),s=gn.getPath(n),a=[],o=[];e.customProps;switch(e.version){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":var h=0,l=0,u=e.props.textures;if(u)for(h=0,l=u.length;h<l;h++){var c=u[h],_=c.path;_&&(i=N.formatRelativePath(s,_),r&&(i+=r),a.push({url:i,constructParams:c.constructParams,propertyParams:c.propertyParams}),o.push(i),c.path=i)}break;default:throw new Error("Laya3D:unkonwn version.")}var d=a.length,f=d+1,p=1/f;if(N._onProcessChange(t,0,p,1),0<d){var m=y.create(null,N._onProcessChange,[t,p,d/f],!1);N._innerFourthLevelLoaderManager._create(a,!1,y.create(null,N._onMateialTexturesLoaded,[t,m,e,o]),m,null,null,null,1,!0)}else N._onMateialTexturesLoaded(t,null,e,null)},N._onMateialTexturesLoaded=function(t,e,i,n){t._cache=t._createCache;var r=as._parse(i,t._propertyParams,t._constructParams);N._endLoad(t,r,n),e&&e.recover()},N._loadAvatar=function(i){i.on("loaded",null,function(t){i._cache=i._createCache;var e=fs._parse(t,i._propertyParams,i._constructParams);N._endLoad(i,e)}),i.load(i.url,"json",!1,null,!0)},N._loadAnimationClip=function(i){i.on("loaded",null,function(t){i._cache=i._createCache;var e=is._parse(t,i._propertyParams,i._constructParams);N._endLoad(i,e)}),i.load(i.url,"arraybuffer",!1,null,!0)},N._loadTexture2D=function(i){var t,e=i.url,n=e.lastIndexOf(".")+1,r=e.indexOf("?"),s=-1==r?e.length:r;switch(e.substr(n,s-n)){case"jpg":case"jpeg":case"bmp":case"gif":case"png":t="nativeimage";break;case"dds":case"ktx":case"pvr":t="arraybuffer"}i.on("loaded",null,function(t){i._cache=i._createCache;var e=ea._parse(t,i._propertyParams,i._constructParams);N._endLoad(i,e)}),i.load(i.url,t,!1,null,!0)},N._loadTextureCube=function(t){t.on("loaded",null,N._onTextureCubeLtcLoaded,[t]),t.load(t.url,"json",!1,null,!0)},N._onTextureCubeLtcLoaded=function(t,e){var i=gn.getPath(t.url),n=[N.formatRelativePath(i,e.front),N.formatRelativePath(i,e.back),N.formatRelativePath(i,e.left),N.formatRelativePath(i,e.right),N.formatRelativePath(i,e.up),N.formatRelativePath(i,e.down)];N._onProcessChange(t,0,1/7,1);var r=y.create(null,N._onProcessChange,[t,1/7,6/7],!1);N._innerFourthLevelLoaderManager.load(n,y.create(null,N._onTextureCubeImagesLoaded,[t,n,r]),r,"nativeimage")},N._onTextureCubeImagesLoaded=function(t,e,i){for(var n=new Array(6),r=0;r<6;r++)n[r]=Hn.getRes(e[r]);t._cache=t._createCache;var s=ya._parse(n,t._propertyParams,t._constructParams);for(i.recover(),r=0;r<6;r++)Hn.clearRes(e[r]);N._endLoad(t,s)},N._onProcessChange=function(t,e,i,n){(n=e+n*i)<1&&t.event("progress",n)},N.init=function(t,e,i,n){if(!N._isInit){N._isInit=!0,(i=i||ci._default).cloneTo(N._config),N._editerEnvironment=N._config._editerEnvironment;var r=m.Physics3D;null==r?(N._enbalePhysics=!1,N.__init__(t,e,N._config),n&&n.run()):(N._enbalePhysics=!0,r(1024*N._config.defaultPhysicsMemory*1024).then(function(){N.__init__(t,e,N._config),n&&n.run()}))}},N.HIERARCHY="HIERARCHY",N.MESH="MESH",N.MATERIAL="MATERIAL",N.TEXTURE2D="TEXTURE2D",N.TEXTURECUBE="TEXTURECUBE",N.ANIMATIONCLIP="ANIMATIONCLIP",N.AVATAR="AVATAR",N.TERRAINHEIGHTDATA="TERRAINHEIGHTDATA",N.TERRAINRES="TERRAIN",N._isInit=!1,N._enbalePhysics=!1,N._editerEnvironment=!1,E(N,["_innerFirstLevelLoaderManager",function(){return this._innerFirstLevelLoaderManager=new Jn},"_innerSecondLevelLoaderManager",function(){return this._innerSecondLevelLoaderManager=new Jn},"_innerThirdLevelLoaderManager",function(){return this._innerThirdLevelLoaderManager=new Jn},"_innerFourthLevelLoaderManager",function(){return this._innerFourthLevelLoaderManager=new Jn},"_physics3D",function(){return this._physics3D=m.Physics3D},"_config",function(){return this._config=new ci},"physicsSettings",function(){return this.physicsSettings=new yi}]),N}(),Rn=function(){function _(){}I(_,"laya.display.cmd.DrawTrianglesCmd");var t=_.prototype;return t.recover=function(){this.texture=null,this.vertices=null,this.uvs=null,this.indices=null,this.matrix=null,p.recover("DrawTrianglesCmd",this)},t.run=function(t,e,i){t.drawTriangles(this.texture,this.x+e,this.y+i,this.vertices,this.uvs,this.indices,this.matrix,this.alpha,this.color,this.blendMode)},g(0,t,"cmdID",function(){return"DrawTriangles"}),_.create=function(t,e,i,n,r,s,a,o,h,l){var u=p.getItemByClass("DrawTrianglesCmd",_);if(u.texture=t,u.x=e,u.y=i,u.vertices=n,u.uvs=r,u.indices=s,u.matrix=a,u.alpha=o,h){u.color=new Lr;var c=f.create(h).arrColor;u.color.color(255*c[0],255*c[1],255*c[2],255*c[3])}return u.blendMode=l,u},_.ID="DrawTriangles",_}(),An=function(){function n(){}return I(n,"laya.net.ResourceVersion"),n.enable=function(t,e,i){void 0===i&&(i=2),laya.net.ResourceVersion.type=i,T.loader.load(t,y.create(null,n.onManifestLoaded,[e]),null,"json"),gn.customFormat=n.addVersionPrefix},n.onManifestLoaded=function(t,e){n.manifest=e,t.run(),e||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},n.addVersionPrefix=function(t){return t=gn.getAdptedFilePath(t),n.manifest&&n.manifest[t]?2==n.type?n.manifest[t]:n.manifest[t]+"/"+t:t},n.FOLDER_VERSION=1,n.FILENAME_VERSION=2,n.manifest=null,n.type=1,n}(),Mn=function(){function t(t,e){this._updateFlag=0,this._center=new ln,this._extent=new ln,this._boundBox=new Qe(new ln,new ln),t.cloneTo(this._boundBox.min),e.cloneTo(this._boundBox.max),this._setUpdateFlag(12,!0)}I(t,"laya.d3.core.Bounds");var e=t.prototype;return T.imps(e,{"laya.d3.core.IClone":!0}),e.setMin=function(t){var e=this._boundBox.min;t!==e&&t.cloneTo(e),this._setUpdateFlag(12,!0),this._setUpdateFlag(1,!1)},e.getMin=function(){var t=this._boundBox.min;return this._getUpdateFlag(1)&&(this._getMin(this.getCenter(),this.getExtent(),t),this._setUpdateFlag(1,!1)),t},e.setMax=function(t){var e=this._boundBox.max;t!==e&&t.cloneTo(e),this._setUpdateFlag(12,!0),this._setUpdateFlag(2,!1)},e.getMax=function(){var t=this._boundBox.max;return this._getUpdateFlag(2)&&(this._getMax(this.getCenter(),this.getExtent(),t),this._setUpdateFlag(2,!1)),t},e.setCenter=function(t){t!==this._center&&t.cloneTo(this._center),this._setUpdateFlag(3,!0),this._setUpdateFlag(4,!1)},e.getCenter=function(){return this._getUpdateFlag(4)&&(this._getCenter(this.getMin(),this.getMax(),this._center),this._setUpdateFlag(4,!1)),this._center},e.setExtent=function(t){t!==this._extent&&t.cloneTo(this._extent),this._setUpdateFlag(3,!0),this._setUpdateFlag(8,!1)},e.getExtent=function(){return this._getUpdateFlag(8)&&(this._getExtent(this.getMin(),this.getMax(),this._extent),this._setUpdateFlag(8,!1)),this._extent},e._getUpdateFlag=function(t){return 0!=(this._updateFlag&t)},e._setUpdateFlag=function(t,e){e?this._updateFlag|=t:this._updateFlag&=~t},e._getCenter=function(t,e,i){ln.add(t,e,i),ln.scale(i,.5,i)},e._getExtent=function(t,e,i){ln.subtract(e,t,i),ln.scale(i,.5,i)},e._getMin=function(t,e,i){ln.subtract(t,e,i)},e._getMax=function(t,e,i){ln.add(t,e,i)},e._rotateExtents=function(t,e,i){var n=t.x,r=t.y,s=t.z,a=e.elements;i.x=Math.abs(a[0]*n)+Math.abs(a[4]*r)+Math.abs(a[8]*s),i.y=Math.abs(a[1]*n)+Math.abs(a[5]*r)+Math.abs(a[9]*s),i.z=Math.abs(a[2]*n)+Math.abs(a[6]*r)+Math.abs(a[10]*s)},e._tranform=function(t,e){var i=e._center,n=e._extent;ln.transformCoordinate(this.getCenter(),t,i),this._rotateExtents(this.getExtent(),t,n),e._boundBox.setCenterAndExtent(i,n),e._updateFlag=0},e._getBoundBox=function(){var t=this._boundBox.min;this._getUpdateFlag(1)&&(this._getMin(this.getCenter(),this.getExtent(),t),this._setUpdateFlag(1,!1));var e=this._boundBox.max;return this._getUpdateFlag(2)&&(this._getMax(this.getCenter(),this.getExtent(),e),this._setUpdateFlag(2,!1)),this._boundBox},e.cloneTo=function(t){var e=t;this.getMin().cloneTo(e._boundBox.min),this.getMax().cloneTo(e._boundBox.max),this.getCenter().cloneTo(e._center),this.getExtent().cloneTo(e._extent),e._updateFlag=0},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},t._UPDATE_MIN=1,t._UPDATE_MAX=2,t._UPDATE_CENTER=4,t._UPDATE_EXTENT=8,t}(),Dn=function(t){function e(){e.__super.call(this)}I(e,"laya.d3.component.Script3D",r);var i=e.prototype;return i._checkProcessTriggers=function(){var t=laya.d3.component.Script3D.prototype;return this.onTriggerEnter!==t.onTriggerEnter||(this.onTriggerStay!==t.onTriggerStay||this.onTriggerExit!==t.onTriggerExit)},i._checkProcessCollisions=function(){var t=laya.d3.component.Script3D.prototype;return this.onCollisionEnter!==t.onCollisionEnter||(this.onCollisionStay!==t.onCollisionStay||this.onCollisionExit!==t.onCollisionExit)},i._onAwake=function(){this.onAwake(),this.onStart!==laya.d3.component.Script3D.prototype.onStart&&T.startTimer.callLater(this,this.onStart)},i._onEnable=function(){this.owner._scene._scriptPool.add(this);var t=laya.d3.component.Script3D.prototype;this.onKeyDown!==t.onKeyDown&&T.stage.on("keydown",this,this.onKeyDown),this.onKeyPress!==t.onKeyPress&&T.stage.on("keypress",this,this.onKeyUp),this.onKeyUp!==t.onKeyUp&&T.stage.on("keyup",this,this.onKeyUp)},i._onDisable=function(){this.owner._scene._scriptPool.remove(this),this.owner.offAllCaller(this),T.stage.offAllCaller(this)},i._isScript=function(){return!0},i._onAdded=function(){var t=this.owner,e=t._scripts;e||(t._scripts=e=[]),e.push(this),t._needProcessCollisions||(t._needProcessCollisions=this._checkProcessCollisions()),t._needProcessTriggers||(t._needProcessTriggers=this._checkProcessTriggers())},i._onDestroy=function(){var t=this.owner._scripts;t.splice(t.indexOf(this),1);var e=this.owner;e._needProcessTriggers=!1;for(var i=0,n=t.length;i<n;i++)if(t[i]._checkProcessTriggers()){e._needProcessTriggers=!0;break}for(e._needProcessCollisions=!1,i=0,n=t.length;i<n;i++)if(t[i]._checkProcessCollisions()){e._needProcessCollisions=!0;break}this.onDestroy()},i.onAwake=function(){},i.onEnable=function(){},i.onStart=function(){},i.onTriggerEnter=function(t){},i.onTriggerStay=function(t){},i.onTriggerExit=function(t){},i.onCollisionEnter=function(t){},i.onCollisionStay=function(t){},i.onCollisionExit=function(t){},i.onMouseDown=function(){},i.onMouseDrag=function(){},i.onMouseClick=function(){},i.onMouseUp=function(){},i.onMouseEnter=function(){},i.onMouseOver=function(){},i.onMouseOut=function(){},i.onKeyDown=function(t){},i.onKeyPress=function(t){},i.onKeyUp=function(t){},i.onUpdate=function(){},i.onLateUpdate=function(){},i.onPreRender=function(){},i.onPostRender=function(){},i.onDisable=function(){},i.onDestroy=function(){},g(0,i,"isSingleton",function(){return!1}),e}(),bn=function(t){function e(){e.__super.call(this)}I(e,"laya.components.Script",r);var i=e.prototype;return i._onAwake=function(){this.onAwake(),this.onStart!==laya.components.Script.prototype.onStart&&T.startTimer.callLater(this,this.onStart)},i._onEnable=function(){var t=laya.components.Script.prototype;this.onTriggerEnter!==t.onTriggerEnter&&this.owner.on("triggerenter",this,this.onTriggerEnter),this.onTriggerStay!==t.onTriggerStay&&this.owner.on("triggerstay",this,this.onTriggerStay),this.onTriggerExit!==t.onTriggerExit&&this.owner.on("triggerexit",this,this.onTriggerExit),this.onMouseDown!==t.onMouseDown&&this.owner.on("mousedown",this,this.onMouseDown),this.onMouseUp!==t.onMouseUp&&this.owner.on("mouseup",this,this.onMouseUp),this.onClick!==t.onClick&&this.owner.on("click",this,this.onClick),this.onStageMouseDown!==t.onStageMouseDown&&T.stage.on("mousedown",this,this.onStageMouseDown),this.onStageMouseUp!==t.onStageMouseUp&&T.stage.on("mouseup",this,this.onStageMouseUp),this.onStageClick!==t.onStageClick&&T.stage.on("click",this,this.onStageClick),this.onStageMouseMove!==t.onStageMouseMove&&T.stage.on("mousemove",this,this.onStageMouseMove),this.onDoubleClick!==t.onDoubleClick&&this.owner.on("doubleclick",this,this.onDoubleClick),this.onRightClick!==t.onRightClick&&this.owner.on("rightclick",this,this.onRightClick),this.onMouseMove!==t.onMouseMove&&this.owner.on("mousemove",this,this.onMouseMove),this.onMouseOver!==t.onMouseOver&&this.owner.on("mouseover",this,this.onMouseOver),this.onMouseOut!==t.onMouseOut&&this.owner.on("mouseout",this,this.onMouseOut),this.onKeyDown!==t.onKeyDown&&T.stage.on("keydown",this,this.onKeyDown),this.onKeyPress!==t.onKeyPress&&T.stage.on("keypress",this,this.onKeyPress),this.onKeyUp!==t.onKeyUp&&T.stage.on("keyup",this,this.onKeyUp),this.onUpdate!==t.onUpdate&&T.updateTimer.frameLoop(1,this,this.onUpdate),this.onLateUpdate!==t.onLateUpdate&&T.lateTimer.frameLoop(1,this,this.onLateUpdate),this.onPreRender!==t.onPreRender&&T.lateTimer.frameLoop(1,this,this.onPreRender)},i._onDisable=function(){this.owner.offAllCaller(this),T.stage.offAllCaller(this),T.startTimer.clearAll(this),T.updateTimer.clearAll(this),T.lateTimer.clearAll(this)},i._isScript=function(){return!0},i._onDestroy=function(){this.onDestroy()},i.onAwake=function(){},i.onEnable=function(){},i.onStart=function(){},i.onTriggerEnter=function(t,e,i){},i.onTriggerStay=function(t,e,i){},i.onTriggerExit=function(t,e,i){},i.onMouseDown=function(t){},i.onMouseUp=function(t){},i.onClick=function(t){},i.onStageMouseDown=function(t){},i.onStageMouseUp=function(t){},i.onStageClick=function(t){},i.onStageMouseMove=function(t){},i.onDoubleClick=function(t){},i.onRightClick=function(t){},i.onMouseMove=function(t){},i.onMouseOver=function(t){},i.onMouseOut=function(t){},i.onKeyDown=function(t){},i.onKeyPress=function(t){},i.onKeyUp=function(t){},i.onUpdate=function(){},i.onLateUpdate=function(){},i.onPreRender=function(){},i.onPostRender=function(){},i.onDisable=function(){},i.onDestroy=function(){},g(0,i,"isSingleton",function(){return!1}),e}(),wn=function(t){function a(){this._bits=0,this._parent=null,this.name="",this.destroyed=!1,this._conchData=null,this._components=null,this._activeChangeScripts=null,this._scene=null,a.__super.call(this),this._children=a.ARRAY_EMPTY,this._extUIChild=a.ARRAY_EMPTY,this.createGLBuffer()}I(a,"laya.display.Node",o);var e=a.prototype;return e.createGLBuffer=function(){},e._setBit=function(t,e){16===t&&(this._getBit(t)!=e&&this._updateDisplayedInstage());e?this._bits|=t:this._bits&=~t},e._getBit=function(t){return 0!=(this._bits&t)},e._setUpNoticeChain=function(){this._getBit(16)&&this._setBitUp(16)},e._setBitUp=function(t){var e=this;for(e._setBit(t,!0),e=e._parent;e;){if(e._getBit(t))return;e._setBit(t,!0),e=e._parent}},e.on=function(t,e,i,n){return"display"!==t&&"undisplay"!==t||this._getBit(16)||this._setBitUp(16),this._createListener(t,e,i,n,!1)},e.once=function(t,e,i,n){return"display"!==t&&"undisplay"!==t||this._getBit(16)||this._setBitUp(16),this._createListener(t,e,i,n,!0)},e.destroy=function(t){void 0===t&&(t=!0),this.destroyed=!0,this._destroyAllComponent(),this._parent&&this._parent.removeChild(this),this._children&&(t?this.destroyChildren():this.removeChildren()),this.onDestroy(),this._children=null,this.offAll()},e.onDestroy=function(){},e.destroyChildren=function(){if(this._children)for(var t=0,e=this._children.length;t<e;t++)this._children[0].destroy(!0)},e.addChild=function(t){if(!t||this.destroyed||t===this)return t;if(t._zOrder&&this._setBit(32,!0),t._parent===this){var e=this.getChildIndex(t);e!==this._children.length-1&&(this._children.splice(e,1),this._children.push(t),this._childChanged())}else t._parent&&t._parent.removeChild(t),this._children===a.ARRAY_EMPTY&&(this._children=[]),this._children.push(t),t._setParent(this),this._childChanged();return t},e.addInputChild=function(t){if(this._extUIChild==a.ARRAY_EMPTY)this._extUIChild=[t];else{if(0<=this._extUIChild.indexOf(t))return null;this._extUIChild.push(t)}return null},e.removeInputChild=function(t){var e=this._extUIChild.indexOf(t);0<=e&&this._extUIChild.splice(e,1)},e.addChildren=function(t){for(var e=arguments,i=0,n=e.length;i<n;)this.addChild(e[i++])},e.addChildAt=function(t,e){if(!t||this.destroyed||t===this)return t;if(t._zOrder&&this._setBit(32,!0),0<=e&&e<=this._children.length){if(t._parent===this){var i=this.getChildIndex(t);this._children.splice(i,1),this._children.splice(e,0,t),this._childChanged()}else t._parent&&t._parent.removeChild(t),this._children===a.ARRAY_EMPTY&&(this._children=[]),this._children.splice(e,0,t),t._setParent(this);return t}throw new Error("appendChildAt:The index is out of bounds")},e.getChildIndex=function(t){return this._children.indexOf(t)},e.getChildByName=function(t){var e=this._children;if(e)for(var i=0,n=e.length;i<n;i++){var r=e[i];if(r.name===t)return r}return null},e.getChildAt=function(t){return this._children[t]||null},e.setChildIndex=function(t,e){var i=this._children;if(e<0||e>=i.length)throw new Error("setChildIndex:The index is out of bounds.");var n=this.getChildIndex(t);if(n<0)throw new Error("setChildIndex:node is must child of this object.");return i.splice(n,1),i.splice(e,0,t),this._childChanged(),t},e._childChanged=function(t){},e.removeChild=function(t){if(!this._children)return t;var e=this._children.indexOf(t);return this.removeChildAt(e)},e.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},e.removeChildByName=function(t){var e=this.getChildByName(t);return e&&this.removeChild(e),e},e.removeChildAt=function(t){var e=this.getChildAt(t);return e&&(this._children.splice(t,1),e._setParent(null)),e},e.removeChildren=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=2147483647),this._children&&0<this._children.length){var i=this._children;if(0===t&&e>=i.length-1){var n=i;this._children=a.ARRAY_EMPTY}else n=i.splice(t,e-t);for(var r=0,s=n.length;r<s;r++)n[r]._setParent(null)}return this},e.replaceChild=function(t,e){var i=this._children.indexOf(e);return-1<i?(this._children.splice(i,1,t),e._setParent(null),t._setParent(this),t):null},e._setParent=function(t){this._parent!==t&&(t?(this._parent=t,this._onAdded(),this.event("added"),this._getBit(16)&&(this._setUpNoticeChain(),t.displayedInStage&&this._displayChild(this,!0)),t._childChanged(this)):(this._onRemoved(),this.event("removed"),this._parent._childChanged(),this._getBit(16)&&this._displayChild(this,!1),this._parent=t))},e._updateDisplayedInstage=function(){var t;t=this;for(var e=T.stage,i=!1;t;){if(t._getBit(16)){i=t._getBit(128);break}if(t===e||t._getBit(128)){i=!0;break}t=t._parent}this._setBit(128,i)},e._setDisplay=function(t){this._getBit(128)!==t&&(this._setBit(128,t),t?this.event("display"):this.event("undisplay"))},e._displayChild=function(t,e){var i=t._children;if(i)for(var n=0,r=i.length;n<r;n++){var s=i[n];s._getBit(16)&&(0<s._children.length?this._displayChild(s,e):s._setDisplay(e))}t._setDisplay(e)},e.contains=function(t){if(t===this)return!0;for(;t;){if(t._parent===this)return!0;t=t._parent}return!1},e.timerLoop=function(t,e,i,n,r,s){void 0===r&&(r=!0),void 0===s&&(s=!1),(this.scene?this.scene.timer:T.timer).loop(t,e,i,n,r,s)},e.timerOnce=function(t,e,i,n,r){void 0===r&&(r=!0),(this.scene?this.scene.timer:T.timer)._create(!1,!1,t,e,i,n,r)},e.frameLoop=function(t,e,i,n,r){void 0===r&&(r=!0),(this.scene?this.scene.timer:T.timer)._create(!0,!0,t,e,i,n,r)},e.frameOnce=function(t,e,i,n,r){void 0===r&&(r=!0),(this.scene?this.scene.timer:T.timer)._create(!0,!1,t,e,i,n,r)},e.clearTimer=function(t,e){(this.scene?this.scene.timer:T.timer).clear(t,e)},e.callLater=function(t,e){(this.scene?this.scene.timer:T.timer).callLater(this,t,e)},e.runCallLater=function(t){(this.scene?this.scene.timer:T.timer).runCallLater(this,t)},e._onActive=function(){$i.spriteCount++},e._onInActive=function(){$i.spriteCount--},e._onActiveInScene=function(){},e._onInActiveInScene=function(){},e._parse=function(t,e){},e._setBelongScene=function(t){if(!this._scene){if(this._scene=t,this._components)for(var e=0,i=this._components.length;e<i;e++)this._components[e]._setActiveInScene(!0);for(this._onActiveInScene(),e=0,i=this._children.length;e<i;e++)this._children[e]._setBelongScene(t)}},e._setUnBelongScene=function(){if(this._scene!==this){if(this._onInActiveInScene(),this._components)for(var t=0,e=this._components.length;t<e;t++)this._components[t]._setActiveInScene(!1);for(this._scene=null,t=0,e=this._children.length;t<e;t++)this._children[t]._setUnBelongScene()}},e.onAwake=function(){},e.onEnable=function(){},e._processActive=function(){this._activeChangeScripts||(this._activeChangeScripts=[]),this._activeHierarchy(this._activeChangeScripts),this._activeScripts()},e._activeHierarchy=function(t){if(this._setBit(2,!0),this._components)for(var e=0,i=this._components.length;e<i;e++){var n=this._components[e];n._setActive(!0),n._isScript()&&n._enabled&&t.push(n)}for(this._onActive(),e=0,i=this._children.length;e<i;e++){var r=this._children[e];!r._getBit(1)&&r._activeHierarchy(t)}this._getBit(4)||(this._setBit(4,!0),this.onAwake()),this.onEnable()},e._activeScripts=function(){for(var t=0,e=this._activeChangeScripts.length;t<e;t++)this._activeChangeScripts[t].onEnable();this._activeChangeScripts.length=0},e._processInActive=function(){this._activeChangeScripts||(this._activeChangeScripts=[]),this._inActiveHierarchy(this._activeChangeScripts),this._inActiveScripts()},e._inActiveHierarchy=function(t){if(this._onInActive(),this._components)for(var e=0,i=this._components.length;e<i;e++){var n=this._components[e];n._setActive(!1),n._isScript()&&n._enabled&&t.push(n)}for(this._setBit(2,!1),e=0,i=this._children.length;e<i;e++){var r=this._children[e];r&&!r._getBit(1)&&r._inActiveHierarchy(t)}this.onDisable()},e._inActiveScripts=function(){for(var t=0,e=this._activeChangeScripts.length;t<e;t++)this._activeChangeScripts[t].onDisable();this._activeChangeScripts.length=0},e.onDisable=function(){},e._onAdded=function(){if(this._activeChangeScripts&&0!==this._activeChangeScripts.length)throw"Node: can't set the main inActive node active in hierarchy,if the operate is in main inActive node or it's children script's onDisable Event.";var t=this._parent.scene;t&&this._setBelongScene(t),this._parent.activeInHierarchy&&this.active&&this._processActive()},e._onRemoved=function(){if(this._activeChangeScripts&&0!==this._activeChangeScripts.length)throw"Node: can't set the main active node inActive in hierarchy,if the operate is in main active node or it's children script's onEnable Event.";this._parent.activeInHierarchy&&this.active&&this._processInActive(),this._parent.scene&&this._setUnBelongScene()},e._addComponentInstance=function(t){this._components=this._components||[],this._components.push(t),t.owner=this,t._onAdded(),this.activeInHierarchy&&(t._setActive(!0),t._isScript()&&t._enabled&&t.onEnable()),this._scene&&t._setActiveInScene(!0)},e._destroyComponent=function(t){if(this._components)for(var e=0,i=this._components.length;e<i;e++){var n=this._components[e];if(n===t){n._destroy(),this._components.splice(e,1);break}}},e._destroyAllComponent=function(){if(this._components){for(var t=0,e=this._components.length;t<e;t++){this._components[t]._destroy()}this._components.length=0}},e._cloneTo=function(t,e,i){var n=t;if(this._components)for(var r=0,s=this._components.length;r<s;r++){var a=n.addComponent(this._components[r].constructor);this._components[r]._cloneTo(a)}},e.addComponentIntance=function(t){if(t.owner)throw"Node:the component has belong to other node.";if(t.isSingleton&&this.getComponent(t.constructor))throw"Node:the component is singleton,can't add the second one.";return this._addComponentInstance(t),t},e.addComponent=function(t){var e=p.createByClass(t);if(e._destroyed=!1,e.isSingleton&&this.getComponent(t))throw"无法实例"+t+"组件，"+t+"组件已存在！";return this._addComponentInstance(e),e},e.getComponent=function(t){if(this._components)for(var e=0,i=this._components.length;e<i;e++){var n=this._components[e];if(T.__typeof(n,t))return n}return null},e.getComponents=function(t){var e;if(this._components)for(var i=0,n=this._components.length;i<n;i++){var r=this._components[i];T.__typeof(r,t)&&(e=e||[]).push(r)}return e},g(0,e,"active",function(){return!this._getBit(8)&&!this._getBit(1)},function(t){if(t=!!t,!this._getBit(1)!==t){if(this._activeChangeScripts&&0!==this._activeChangeScripts.length)throw t?"Node: can't set the main inActive node active in hierarchy,if the operate is in main inActive node or it's children script's onDisable Event.":"Node: can't set the main active node inActive in hierarchy,if the operate is in main active node or it's children script's onEnable Event.";this._setBit(1,!t),this._parent&&this._parent.activeInHierarchy&&(t?this._processActive():this._processInActive())}}),g(0,e,"displayedInStage",function(){return this._getBit(16)||this._setBitUp(16),this._getBit(128)}),g(0,e,"activeInHierarchy",function(){return this._getBit(2)}),g(0,e,"scene",function(){return this._scene}),g(0,e,"timer",function(){return this.scene?this.scene.timer:T.timer}),g(0,e,"parent",function(){return this._parent}),g(0,e,"numChildren",function(){return this._children.length}),a.ARRAY_EMPTY=[],a}(),Ln=function(i){function t(){t.__super.call(this),this.inTangent=new ln,this.outTangent=new ln,this.value=new ln}return I(t,"laya.d3.core.Vector3Keyframe",i),t.prototype.cloneTo=function(t){i.prototype.cloneTo.call(this,t);var e=t;this.inTangent.cloneTo(e.inTangent),this.outTangent.cloneTo(e.outTangent),this.value.cloneTo(e.value)},t}(h),On=function(t){function e(){e.__super.call(this)}I(e,"laya.d3.core.scene.OctreeMotionList",u);var i=e.prototype;return i.add=function(t){if(-1!==t._getIndexInMotionList())throw"OctreeMotionList:element has  in  PhysicsUpdateList.";this._add(t),t._setIndexInMotionList(this.length++)},i.remove=function(t){var e=t._getIndexInMotionList();if(this.length--,e!==this.length){var i=this.elements[this.length];(this.elements[e]=i)._inPhysicUpdateListIndex=e}t._setIndexInMotionList(-1)},e}(),Nn=function(t){function i(){this._id=0,this._url=null,this._cpuMemory=0,this._gpuMemory=0,this._destroyed=!1,this._referenceCount=0,this.lock=!1,this.name=null,i.__super.call(this),this._id=++i._uniqueIDCounter,this._destroyed=!1,this._referenceCount=0,(i._idResourcesMap[this.id]=this).lock=!1}I(i,"laya.resource.Resource",o);var e=i.prototype;return T.imps(e,{"laya.resource.IDestroy":!0,"laya.resource.ICreateResource":!0}),e._setCPUMemory=function(t){var e=t-this._cpuMemory;this._cpuMemory=t,i._addCPUMemory(e)},e._setGPUMemory=function(t){var e=t-this._gpuMemory;this._gpuMemory=t,i._addGPUMemory(e)},e._setCreateURL=function(t){var e;(t=gn.formatURL(t),this._url!==t)&&(this._url&&((e=i._urlResourcesMap[this._url]).splice(e.indexOf(this),1),0===e.length&&delete i._urlResourcesMap[this._url]),t&&((e=i._urlResourcesMap[t])||(i._urlResourcesMap[t]=e=[]),e.push(this)),this._url=t)},e._addReference=function(t){void 0===t&&(t=1),this._referenceCount+=t},e._removeReference=function(t){void 0===t&&(t=1),this._referenceCount-=t},e._clearReference=function(){this._referenceCount=0},e._recoverResource=function(){},e._disposeResource=function(){},e._activeResource=function(){},e.destroy=function(){var t;this._destroyed||(this._destroyed=!0,this.lock=!1,this._disposeResource(),delete i._idResourcesMap[this.id],this._url&&((t=i._urlResourcesMap[this._url])&&(t.splice(t.indexOf(this),1),0===t.length&&delete i._urlResourcesMap[this._url]),Hn.getRes(this._url)==this&&delete Hn.loadedMap[this._url]))},g(0,e,"referenceCount",function(){return this._referenceCount}),g(0,e,"url",function(){return this._url}),g(0,e,"cpuMemory",function(){return this._cpuMemory}),g(0,e,"destroyed",function(){return this._destroyed}),g(0,e,"gpuMemory",function(){return this._gpuMemory}),g(0,e,"id",function(){return this._id}),g(1,i,"gpuMemory",function(){return this._gpuMemory},laya.events.EventDispatcher._$SET_gpuMemory),g(1,i,"cpuMemory",function(){return this._cpuMemory},laya.events.EventDispatcher._$SET_cpuMemory),i._addCPUMemory=function(t){this._cpuMemory+=t},i._addGPUMemory=function(t){this._gpuMemory+=t},i._addMemory=function(t,e){this._cpuMemory+=t,this._gpuMemory+=e},i.getResourceByID=function(t){return i._idResourcesMap[t]},i.getResourceByURL=function(t,e){return void 0===e&&(e=0),i._urlResourcesMap[t][e]},i.destroyUnusedResources=function(){for(var t in i._idResourcesMap){var e=i._idResourcesMap[t];e.lock||0!==e._referenceCount||e.destroy()}},i._uniqueIDCounter=0,i._idResourcesMap={},i._urlResourcesMap={},i._cpuMemory=0,i._gpuMemory=0,i}(),Pn=function(e){function f(t,e){this._restitution=0,this._friction=.5,this._rollingFriction=0,this._ccdMotionThreshold=0,this._ccdSweptSphereRadius=0,this._colliderShape=null,this._transformFlag=2147483647,this._enableProcessCollisions=!0,this._inPhysicUpdateListIndex=-1,this.canScaleShape=!0,f.__super.call(this),this._collisionGroup=1,this._canCollideWith=$t.COLLISIONFILTERGROUP_ALLFILTER,this._collisionGroup=t,this._canCollideWith=e,f._physicObjectsMap[this.id]=this}I(f,"laya.d3.physics.PhysicsComponent",e);var t=f.prototype;return t._isValid=function(){return this._simulation&&this._colliderShape&&this._enabled},t._parse=function(t){null!=t.collisionGroup&&(this.collisionGroup=t.collisionGroup),null!=t.canCollideWith&&(this.canCollideWith=t.canCollideWith),null!=t.ccdMotionThreshold&&(this.ccdMotionThreshold=t.ccdMotionThreshold),null!=t.ccdSweptSphereRadius&&(this.ccdSweptSphereRadius=t.ccdSweptSphereRadius)},t._parseShape=function(t){var e=t.length;if(1===e){var i=J._creatShape(t[0]);this.colliderShape=i}else{for(var n=new gr,r=0;r<e;r++)i=J._creatShape(t[r]),n.addChildShape(i);this.colliderShape=n}},t._onScaleChange=function(t){this._colliderShape._setScale(t)},t._setTransformFlag=function(t,e){e?this._transformFlag|=t:this._transformFlag&=~t},t._getTransformFlag=function(t){return 0!=(this._transformFlag&t)},t._addToSimulation=function(){},t._removeFromSimulation=function(){},t._derivePhysicsTransformation=function(t){this._innerDerivePhysicsTransformation(this._nativeColliderObject.getWorldTransform(),t)},t._innerDerivePhysicsTransformation=function(t,e){var i=this.owner._transform,n=i.rotation;if(e||this._getTransformFlag(8)){var r=this._colliderShape.localOffset,s=i.position,a=f._nativeVector30;if(0!==r.x||0!==r.y||0!==r.z){var o=f._tempVector30;f.physicVector3TransformQuat(r,n.x,n.y,n.z,n.w,o),ln.add(s,o,o),a.setValue(-o.x,o.y,o.z)}else a.setValue(-s.x,s.y,s.z);t.setOrigin(a),this._setTransformFlag(8,!1)}if(e||this._getTransformFlag(16)){var h=this._colliderShape.localRotation,l=f._nativeQuaternion0;if(0!==h.x||0!==h.y||0!==h.z||1!==h.w){var u=f._tempQuaternion0;f.physicQuaternionMultiply(n.x,n.y,n.z,n.w,h,u),l.setValue(-u.x,u.y,u.z,-u.w)}else l.setValue(-n.x,n.y,n.z,-n.w);t.setRotation(l),this._setTransformFlag(16,!1)}(e||this._getTransformFlag(32))&&(this._onScaleChange(i.scale),this._setTransformFlag(32,!1))},t._updateTransformComponent=function(t){var e=this._colliderShape.localOffset,i=this._colliderShape.localRotation,n=this.owner._transform,r=n.position,s=n.rotation,a=t.getOrigin(),o=t.getRotation(),h=-o.x(),l=o.y(),u=o.z(),c=-o.w();if(0!==e.x||0!==e.y||0!==e.z){var _=f._tempVector30;f.physicVector3TransformQuat(e,h,l,u,c,_),r.x=-a.x()-_.x,r.y=a.y()-_.y,r.z=a.z()-_.z}else r.x=-a.x(),r.y=a.y(),r.z=a.z();if(n.position=r,0!==i.x||0!==i.y||0!==i.z||1!==i.w){var d=f._tempQuaternion0;i.invert(d),f.physicQuaternionMultiply(h,l,u,c,d,s)}else s.x=h,s.y=l,s.z=u,s.w=c;n.rotation=s},t._onEnable=function(){this._simulation=this.owner._scene.physicsSimulation,this._nativeColliderObject.setContactProcessingThreshold(1e30),this._colliderShape&&this._enabled&&(this._derivePhysicsTransformation(!0),this._addToSimulation())},t._onDisable=function(){this._colliderShape&&this._enabled&&(this._removeFromSimulation(),-1!==this._inPhysicUpdateListIndex&&this._simulation._physicsUpdateList.remove(this)),this._simulation=null},t._onShapeChange=function(t){var e=this._nativeColliderObject,i=e.getCollisionFlags();t.needsCustomCollisionCallback?0==(8&i)&&e.setCollisionFlags(8|i):0<(8&i)&&e.setCollisionFlags(8^i)},t._onAdded=function(){this.enabled=this._enabled,this.restitution=this._restitution,this.friction=this._friction,this.rollingFriction=this._rollingFriction,this.ccdMotionThreshold=this._ccdMotionThreshold,this.ccdSweptSphereRadius=this._ccdSweptSphereRadius,this.owner.transform.on("transformchanged",this,this._onTransformChanged)},t._onDestroy=function(){var t=In._physics3D;delete f._physicObjectsMap[this.id],t.destroy(this._nativeColliderObject),this._colliderShape.destroy(),e.prototype._onDestroy.call(this),this._nativeColliderObject=null,this._colliderShape=null,this._simulation=null,this.owner.transform.off("transformchanged",this,this._onTransformChanged)},t._onTransformChanged=function(t){f._addUpdateList&&(t&=56)&&(this._transformFlag|=t,this._isValid()&&-1===this._inPhysicUpdateListIndex&&this._simulation._physicsUpdateList.add(this))},t._cloneTo=function(t){var e=t;e.restitution=this._restitution,e.friction=this._friction,e.rollingFriction=this._rollingFriction,e.ccdMotionThreshold=this._ccdMotionThreshold,e.ccdSweptSphereRadius=this._ccdSweptSphereRadius,e.collisionGroup=this._collisionGroup,e.canCollideWith=this._canCollideWith,e.canScaleShape=this.canScaleShape,this._colliderShape&&(e.colliderShape=this._colliderShape.clone())},g(0,t,"collisionGroup",function(){return this._collisionGroup},function(t){this._collisionGroup!==t&&(this._collisionGroup=t,this._simulation&&this._colliderShape&&this._enabled&&(this._removeFromSimulation(),this._addToSimulation()))}),g(0,t,"simulation",function(){return this._simulation}),g(0,t,"colliderShape",function(){return this._colliderShape},function(t){var e=this._colliderShape;if(e&&(e._attatched=!1,e._attatchedCollisionObject=null),this._colliderShape=t){if(t._attatched)throw"PhysicsComponent: this shape has attatched to other entity.";if(t._attatched=!0,(t._attatchedCollisionObject=this)._nativeColliderObject){this._nativeColliderObject.setCollisionShape(t._nativeShape);var i=this._simulation&&this._enabled;i&&e&&this._removeFromSimulation(),this._onShapeChange(t),i&&(this._derivePhysicsTransformation(!0),this._addToSimulation())}}else this._simulation&&this._enabled&&e&&this._removeFromSimulation()}),g(0,t,"enabled",e.prototype._$get_enabled,function(t){this._simulation&&this._colliderShape&&(t?(this._derivePhysicsTransformation(!0),this._addToSimulation()):this._removeFromSimulation()),T.superSet(r,this,"enabled",t)}),g(0,t,"ccdSweptSphereRadius",function(){return this._ccdSweptSphereRadius},function(t){this._ccdSweptSphereRadius=t,this._nativeColliderObject&&this._nativeColliderObject.setCcdSweptSphereRadius(t)}),g(0,t,"isActive",function(){return!!this._nativeColliderObject&&this._nativeColliderObject.isActive()}),g(0,t,"ccdMotionThreshold",function(){return this._ccdMotionThreshold},function(t){this._ccdMotionThreshold=t,this._nativeColliderObject&&this._nativeColliderObject.setCcdMotionThreshold(t)}),g(0,t,"canCollideWith",function(){return this._canCollideWith},function(t){this._canCollideWith!==t&&(this._canCollideWith=t,this._simulation&&this._colliderShape&&this._enabled&&(this._removeFromSimulation(),this._addToSimulation()))}),g(0,t,"rollingFriction",function(){return this._nativeColliderObject.getRollingFriction()},function(t){this._rollingFriction=t,this._nativeColliderObject&&this._nativeColliderObject.setRollingFriction(t)}),g(0,t,"friction",function(){return this._friction},function(t){this._friction=t,this._nativeColliderObject&&this._nativeColliderObject.setFriction(t)}),g(0,t,"restitution",function(){return this._restitution},function(t){this._restitution=t,this._nativeColliderObject&&this._nativeColliderObject.setRestitution(t)}),f._createAffineTransformationArray=function(t,e,i,n,r,s,a,o,h){var l=n+n,u=r+r,c=s+s,_=n*l,d=n*u,f=n*c,p=r*u,m=r*c,g=s*c,v=a*l,T=a*u,y=a*c,E=o[0],x=o[1],S=o[2];h[0]=(1-(p+g))*E,h[1]=(d+y)*E,h[2]=(f-T)*E,h[3]=0,h[4]=(d-y)*x,h[5]=(1-(_+g))*x,h[6]=(m+v)*x,h[7]=0,h[8]=(f+T)*S,h[9]=(m-v)*S,h[10]=(1-(_+p))*S,h[11]=0,h[12]=t,h[13]=e,h[14]=i,h[15]=1},f.physicVector3TransformQuat=function(t,e,i,n,r,s){var a=t.x,o=t.y,h=t.z,l=r*a+i*h-n*o,u=r*o+n*a-e*h,c=r*h+e*o-i*a,_=-e*a-i*o-n*h;s.x=l*r+_*-e+u*-n-c*-i,s.y=u*r+_*-i+c*-e-l*-n,s.z=c*r+_*-n+l*-i-u*-e},f.physicQuaternionMultiply=function(t,e,i,n,r,s){var a=r.x,o=r.y,h=r.z,l=r.w,u=e*h-i*o,c=i*a-t*h,_=t*o-e*a,d=t*a+e*o+i*h;s.x=t*l+a*n+u,s.y=e*l+o*n+c,s.z=i*l+h*n+_,s.w=n*l-d},f.ACTIVATIONSTATE_ACTIVE_TAG=1,f.ACTIVATIONSTATE_ISLAND_SLEEPING=2,f.ACTIVATIONSTATE_WANTS_DEACTIVATION=3,f.ACTIVATIONSTATE_DISABLE_DEACTIVATION=4,f.ACTIVATIONSTATE_DISABLE_SIMULATION=5,f.COLLISIONFLAGS_STATIC_OBJECT=1,f.COLLISIONFLAGS_KINEMATIC_OBJECT=2,f.COLLISIONFLAGS_NO_CONTACT_RESPONSE=4,f.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK=8,f.COLLISIONFLAGS_CHARACTER_OBJECT=16,f.COLLISIONFLAGS_DISABLE_VISUALIZE_OBJECT=32,f.COLLISIONFLAGS_DISABLE_SPU_COLLISION_PROCESSING=64,f._physicObjectsMap={},f._addUpdateList=!0,E(f,["_tempVector30",function(){return this._tempVector30=new ln},"_tempQuaternion0",function(){return this._tempQuaternion0=new Qt},"_tempQuaternion1",function(){return this._tempQuaternion1=new Qt},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new gt},"_nativeVector30",function(){return this._nativeVector30=new In._physics3D.btVector3(0,0,0)},"_nativeQuaternion0",function(){return this._nativeQuaternion0=new In._physics3D.btQuaternion(0,0,0,1)}]),f}(r),Fn=function(t){function y(t,e){this._stacks=0,this._slices=0,y.__super.call(this),void 0===t&&(t=48),void 0===e&&(e=48),this._stacks=t,this._slices=e;for(var i=li.vertexDeclaration,n=i.vertexStride/4,r=(this._stacks+1)*(this._slices+1),s=3*this._stacks*(this._slices+1)*2,a=new Float32Array(r*n),o=new Uint16Array(s),h=Math.PI/this._stacks,l=2*Math.PI/this._slices,u=0,c=0,_=0,d=0;d<this._stacks+1;d++)for(var f=Math.sin(d*h),p=Math.cos(d*h),m=0;m<this._slices+1;m++){var g=f*Math.sin(m*l),v=f*Math.cos(m*l);a[c+0]=g*y._radius,a[c+1]=p*y._radius,a[c+2]=v*y._radius,a[c+3]=-m/this._slices+.75,a[c+4]=d/this._stacks,c+=n,d!=this._stacks-1&&(o[_++]=u+1,o[_++]=u,o[_++]=u+(this._slices+1),o[_++]=u+(this._slices+1),o[_++]=u,o[_++]=u+this._slices,u++)}this._vertexBuffer=new zn(4*a.length,35044,!1),this._vertexBuffer.vertexDeclaration=i,this._indexBuffer=new dr("ushort",o.length,35044,!1),this._vertexBuffer.setData(a),this._indexBuffer.setData(o);var T=new Mr;T.bind(),T.applyVertexBuffer(this._vertexBuffer),T.applyIndexBuffer(this._indexBuffer),T.unBind(),this._bufferState=T}I(y,"laya.d3.resource.models.SkyDome",c);var e=y.prototype;return e._render=function(t){var e=this._indexBuffer.indexCount;Nt.instance.drawElements(4,e,5123,0),$i.trianglesFaces+=e/3,$i.renderBatches++},g(0,e,"slices",function(){return this._slices}),g(0,e,"stacks",function(){return this._stacks}),y.__init__=function(){y.instance=new y},y._radius=1,y.instance=null,y}(),Bn=function(t){function s(t){if(this._indexInList=-1,this._indexInCastShadowList=-1,this._boundsChange=!0,this._visible=!0,this._indexInOctreeMotionList=-1,this._updateMark=-1,this._updateRenderType=-1,this._isPartOfStaticBatch=!1,this._staticBatch=null,s.__super.call(this),this._sharedMaterials=[],this._id=++s._uniqueIDCounter,this._indexInCastShadowList=-1,this._bounds=new Mn(ln._ZERO,ln._ZERO),qi.supportWebGLPlusCulling){var e=ye._cullingBufferLength;this._cullingBufferIndex=e;var i=ye._cullingBuffer,n=e+7;if(n>=i.length){var r=i;(i=ye._cullingBuffer=new Float32Array(i.length+4096)).set(r,0)}i[e]=2,ye._cullingBufferLength=n}this._renderElements=[],this._owner=t,this._enable=!0,this._materialsInstance=[],this._shaderValues=new xe(null),this._defineDatas=new jt,this.lightmapIndex=-1,this._castShadow=!1,this.receiveShadow=!1,this.sortingFudge=0,t&&this._owner.transform.on("transformchanged",this,this._onWorldMatNeedChange)}I(s,"laya.d3.core.render.BaseRender",o);var e=s.prototype;return T.imps(e,{"laya.d3.core.scene.IOctreeObject":!0,"laya.resource.ISingletonElement":!0}),e._getOctreeNode=function(){return this._octreeNode},e._setOctreeNode=function(t){this._octreeNode=t},e._getIndexInMotionList=function(){return this._indexInOctreeMotionList},e._setIndexInMotionList=function(t){this._indexInOctreeMotionList=t},e._changeMaterialReference=function(t,e){t&&t._removeReference(),e._addReference()},e._getInstanceMaterial=function(t,e){var i=new t.constructor;return t.cloneTo(i),i.name=i.name+"(Instance)",this._materialsInstance[e]=!0,this._changeMaterialReference(this._sharedMaterials[e],i),this._sharedMaterials[e]=i},e._applyLightMapParams=function(){if(this._scene&&0<=this._lightmapIndex){var t=this._scene.getlightmaps();this._lightmapIndex<t.length?(this._defineDatas.add(Is.SAHDERDEFINE_LIGHTMAP),this._shaderValues.setTexture(Is.LIGHTMAP,t[this._lightmapIndex])):this._defineDatas.remove(Is.SAHDERDEFINE_LIGHTMAP)}else this._defineDatas.remove(Is.SAHDERDEFINE_LIGHTMAP)},e._onWorldMatNeedChange=function(t){this._boundsChange=!0,this._octreeNode&&(t&=56)&&-1===this._indexInOctreeMotionList&&this._octreeNode._octree.addMotionObject(this)},e._calculateBoundingBox=function(){throw"BaseRender: must override it."},e._getIndexInList=function(){return this._indexInList},e._setIndexInList=function(t){this._indexInList=t},e._setBelongScene=function(t){this._scene!==t&&(this._scene=t,this._applyLightMapParams())},e._needRender=function(t){return!0},e._renderUpdate=function(t,e){},e._renderUpdateWithCamera=function(t,e){},e._revertBatchRenderUpdate=function(t){},e._destroy=function(){-1!==this._indexInOctreeMotionList&&this._octreeNode._octree.removeMotionObject(this),this.offAll();var t=0,e=0;for(t=0,e=this._renderElements.length;t<e;t++)this._renderElements[t].destroy();for(t=0,e=this._sharedMaterials.length;t<e;t++)this._sharedMaterials[t].destroyed||this._sharedMaterials[t]._removeReference();this._renderElements=null,this._owner=null,this._sharedMaterials=null,this._bounds=null,this._lightmapScaleOffset=null},g(0,e,"material",function(){var t=this._sharedMaterials[0];if(t&&!this._materialsInstance[0]){var e=this._getInstanceMaterial(t,0),i=this._renderElements[0];i&&(i.material=e)}return this._sharedMaterials[0]},function(t){this.sharedMaterial=t}),g(0,e,"bounds",function(){return this._boundsChange&&(this._calculateBoundingBox(),this._boundsChange=!1),this._bounds}),g(0,e,"castShadow",function(){return this._castShadow},function(t){this._castShadow!==t&&(this._owner.activeInHierarchy&&(t?this._scene._addShadowCastRenderObject(this):this._scene._removeShadowCastRenderObject(this)),this._castShadow=t)}),g(0,e,"sharedMaterials",function(){return this._sharedMaterials.slice()},function(t){for(var e=this._sharedMaterials,i=0,n=e.length;i<n;i++)e[i]._removeReference();if(!t)throw new Error("BaseRender: shadredMaterials value can't be null.");var r=t.length;for(this._materialsInstance.length=r,e.length=r,i=0;i<r;i++){var s=e[i],a=t[i];if(s!==a){this._materialsInstance[i]=!1;var o=this._renderElements[i];o&&(o.material=a)}a._addReference(),e[i]=a}}),g(0,e,"id",function(){return this._id}),g(0,e,"lightmapIndex",function(){return this._lightmapIndex},function(t){this._lightmapIndex!==t&&(this._lightmapIndex=t,this._applyLightMapParams())}),g(0,e,"enable",function(){return this._enable},function(t){this._enable=!!t}),g(0,e,"lightmapScaleOffset",function(){return this._lightmapScaleOffset},function(t){this._lightmapScaleOffset=t,this._shaderValues.setVector(Is.LIGHTMAPSCALEOFFSET,t),this._defineDatas.add(Is.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV)}),g(0,e,"sharedMaterial",function(){return this._sharedMaterials[0]},function(t){var e=this._sharedMaterials[0];if(e!==t){this._sharedMaterials[0]=t,this._materialsInstance[0]=!1,this._changeMaterialReference(e,t);var i=this._renderElements[0];i&&(i.material=t)}}),g(0,e,"receiveShadow",function(){return this._receiveShadow},function(t){this._receiveShadow!==t&&((this._receiveShadow=t)?this._defineDatas.add(Is.SHADERDEFINE_RECEIVE_SHADOW):this._defineDatas.remove(Is.SHADERDEFINE_RECEIVE_SHADOW))}),g(0,e,"isPartOfStaticBatch",function(){return this._isPartOfStaticBatch}),g(0,e,"materials",function(){for(var t=0,e=this._sharedMaterials.length;t<e;t++)if(!this._materialsInstance[t]){var i=this._getInstanceMaterial(this._sharedMaterials[t],t),n=this._renderElements[t];n&&(n.material=i)}return this._sharedMaterials.slice()},function(t){this.sharedMaterials=t}),s._uniqueIDCounter=0,E(s,["_tempBoundBoxCorners",function(){return this._tempBoundBoxCorners=[new ln,new ln,new ln,new ln,new ln,new ln,new ln,new ln]}]),s}(),Vn=function(t){function r(){r.__super.call(this);var t=new Float32Array([-.5,.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5]),e=new Uint8Array([0,1,2,2,3,0,4,7,6,6,5,4,0,3,7,7,4,0,1,5,6,6,2,1,3,2,6,6,7,3,0,4,5,5,1,0]),i=Si.getVertexDeclaration("POSITION");this._vertexBuffer=new zn(8*i.vertexStride,35044,!1),this._vertexBuffer.vertexDeclaration=i,this._indexBuffer=new dr("ubyte",36,35044,!1),this._vertexBuffer.setData(t),this._indexBuffer.setData(e);var n=new Mr;n.bind(),n.applyVertexBuffer(this._vertexBuffer),n.applyIndexBuffer(this._indexBuffer),n.unBind(),this._bufferState=n}return I(r,"laya.d3.resource.models.SkyBox",c),r.prototype._render=function(t){Nt.instance.drawElements(4,36,5121,0),$i.trianglesFaces+=12,$i.renderBatches++},r.__init__=function(){r.instance=new r},r.instance=null,r}(),Un=function(t){function a(){this.url=null,this.audio=null,this.loaded=!1,a.__super.call(this)}I(a,"laya.media.h5audio.AudioSound",o);var e=a.prototype;return e.dispose=function(){var t=a._audioCache[this.url];p.clearBySign("audio:"+this.url),t&&(qi.isConchApp||(t.src=""),delete a._audioCache[this.url])},e.load=function(t){var e;if(t=gn.formatURL(t),(this.url=t)==Li._bgMusic?(a._initMusicAudio(),(e=a._musicAudio).src!=t&&(a._audioCache[e.src]=null,e=null)):e=a._audioCache[t],e&&2<=e.readyState)this.event("complete");else{e||(e=t==Li._bgMusic?(a._initMusicAudio(),a._musicAudio):Vt.createElement("audio"),(a._audioCache[t]=e).src=t),e.addEventListener("canplaythrough",n),e.addEventListener("error",r);var i=this;(this.audio=e).load?e.load():r()}function n(){s(),i.loaded=!0,i.event("complete")}function r(){e.load=null,s(),i.event("error")}function s(){e.removeEventListener("canplaythrough",n),e.removeEventListener("error",r)}},e.play=function(t,e){if(void 0===t&&(t=0),void 0===e&&(e=0),!this.url)return null;var i,n;if(!(i=this.url==Li._bgMusic?a._musicAudio:a._audioCache[this.url]))return null;n=p.getItem("audio:"+this.url),qi.isConchApp?n||((n=Vt.createElement("audio")).src=this.url):this.url==Li._bgMusic?(a._initMusicAudio(),(n=a._musicAudio).src=this.url):n=n||i.cloneNode(!0);var r=new Es(n);return r.url=this.url,r.loops=e,r.startTime=t,r.play(),Li.addChannel(r),r},g(0,e,"duration",function(){var t;return(t=a._audioCache[this.url])?t.duration:0}),a._initMusicAudio=function(){a._musicAudio||(a._musicAudio||(a._musicAudio=Vt.createElement("audio")),qi.isConchApp||Vt.document.addEventListener("mousedown",a._makeMusicOK))},a._makeMusicOK=function(){Vt.document.removeEventListener("mousedown",a._makeMusicOK),a._musicAudio.src?a._musicAudio.play():(a._musicAudio.src="",a._musicAudio.load())},a._audioCache={},a._musicAudio=null,a}(),zn=function(t){function r(t,e,i,n){if(this._vertexCount=0,this._canRead=!1,this._dataType=0,this._vertexDeclaration=null,void 0===i&&(i=!1),void 0===n&&(n=0),r.__super.call(this),this._vertexCount=-1,this._bufferUsage=e,this._bufferType=34962,this._canRead=i,this._dataType=n,this._byteLength=t,this.bind(),Nt.instance.bufferData(this._bufferType,this._byteLength,this._bufferUsage),i)switch(n){case 0:this._buffer=new Float32Array(t/4);break;case 1:this._buffer=new Uint8Array(t)}}I(r,"laya.d3.graphics.VertexBuffer3D",t);var e=r.prototype;return e.bind=function(){return L._bindedVertexBuffer!==this._glBuffer&&(Nt.instance.bindBuffer(34962,this._glBuffer),L._bindedVertexBuffer=this._glBuffer,!0)},e.setData=function(t,e,i,n){if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=4294967295),this.bind(),0!==i||4294967295!==n)switch(this._dataType){case 0:t=new Float32Array(t.buffer,4*i,n);break;case 1:t=new Uint8Array(t.buffer,i,n)}switch(this._dataType){case 0:Nt.instance.bufferSubData(this._bufferType,4*e,t);break;case 1:Nt.instance.bufferSubData(this._bufferType,e,t)}this._canRead&&this._buffer.set(t,e)},e.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},e.destroy=function(){t.prototype.destroy.call(this),this._buffer=null,this._vertexDeclaration=null},g(0,e,"canRead",function(){return this._canRead}),g(0,e,"vertexCount",function(){return this._vertexCount}),g(0,e,"vertexDeclaration",function(){return this._vertexDeclaration},function(t){this._vertexDeclaration!==t&&(this._vertexDeclaration=t,this._vertexCount=t?this._byteLength/t.vertexStride:-1)}),r.DATATYPE_FLOAT32ARRAY=0,r.DATATYPE_UINT8ARRAY=1,r}(L),Gn=function(i){function t(){t.__super.call(this)}return I(t,"laya.d3.core.FloatKeyframe",i),t.prototype.cloneTo=function(t){i.prototype.cloneTo.call(this,t);var e=t;e.inTangent=this.inTangent,e.outTangent=this.outTangent,e.value=this.value},t}(h),Hn=function(t){function R(){this._data=null,this._url=null,this._type=null,this._cache=!1,this._http=null,this._useWorkerLoader=!1,this._customParse=!1,this._constructParams=null,this._propertyParams=null,this._createCache=!1,R.__super.call(this)}I(R,"laya.net.Loader",o);var e=R.prototype;return e.load=function(t,e,i,n,r,s){if(void 0===i&&(i=!0),void 0===r&&(r=!1),void 0===s&&(s=!1),t){if(R.setGroup(t,"666"),0===(this._url=t).indexOf("data:image")?e="image":t=gn.formatURL(t),this._type=e||(e=R.getTypeFromUrl(this._url)),this._cache=i,this._useWorkerLoader=s,this._data=null,s&&qn.enableWorkerLoader(),!r&&R.loadedMap[t])return this._data=R.loadedMap[t],this.event("progress",1),void this.event("complete",this._data);if(n&&R.setGroup(t,n),null!=R.parserMap[e])return this._customParse=!0,void(R.parserMap[e]instanceof laya.utils.Handler?R.parserMap[e].runWith(this):R.parserMap[e].call(null,this));if("image"===e||"htmlimage"===e||"nativeimage"===e)return this._loadImage(t);if("sound"===e)return this._loadSound(t);if("ttf"===e)return this._loadTTF(t);var a;switch(e){case"atlas":case"prefab":case"plf":a="json";break;case"font":a="xml";break;case"plfb":a="arraybuffer";break;default:a=e}R.preLoadedMap[t]?this.onLoaded(R.preLoadedMap[t]):(this._http||(this._http=new Qn,this._http.on("progress",this,this.onProgress),this._http.on("error",this,this.onError),this._http.on("complete",this,this.onLoaded)),this._http.send(t,null,"get",a))}else this.onLoaded(null)},e._loadTTF=function(t){t=gn.formatURL(t);var e=new fn;e.complete=y.create(this,this.onLoaded),e.load(t)},e._loadImage=function(i){i=gn.formatURL(i);var n,r=this;function s(){var t=n;t&&(t.onload=null,t.onerror=null,delete R._imgCache[i])}var t=function(){s(),r.event("error","Load image failed")};if("nativeimage"===this._type){var e=function(){s(),r.onLoaded(n)};(n=new Vt.window.Image).crossOrigin="",n.onload=e,n.onerror=t,n.src=i,R._imgCache[i]=n}else{var a=nt.getFileExtension(i);if("ktx"===a||"pvr"===a){var o;e=function(t){var e=0;switch(a){case"ktx":e=5;break;case"pvr":e=12}(n=new ea(0,0,e,!1,!1)).wrapModeU=1,n.wrapModeV=1,n.setCompressData(t),n._setCreateURL(i),s(),r.onLoaded(n)},(o=new Qn).on("error",null,t),o.on("complete",null,e),o.send(i,null,"get","arraybuffer")}else{var h=new Vt.window.Image;e=function(){var t=new ea(h.width,h.height,1,!1,!1);t.wrapModeU=1,t.wrapModeV=1,t.loadImageSource(h,!0),t._setCreateURL(i),s(),r.onLoaded(t)},h.crossOrigin="",h.onload=e,h.onerror=t,h.src=i,R._imgCache[i]=h}}},e._loadSound=function(t){var e=new Li._soundClass,i=this;function n(){e.offAll()}e.on("complete",this,function(){n(),i.onLoaded(e)}),e.on("error",this,function(){n(),e.dispose(),i.event("error","Load sound failed")}),e.load(t)},e.onProgress=function(t){"atlas"===this._type?this.event("progress",.3*t):this.event("progress",t)},e.onError=function(t){this.event("error",t)},e.onLoaded=function(t){var e=this._type;if("plfb"==e)this.parsePLFBData(t),this.complete(t);else if("plf"==e)this.parsePLFData(t),this.complete(t);else if("image"===e){var i=new xr(t);i.url=this._url,this.complete(i)}else if("sound"===e||"htmlimage"===e||"nativeimage"===e)this.complete(t);else if("atlas"===e){if(!t.url&&!t._setContext){if(!this._data){if((this._data=t).meta&&t.meta.image){var n,r=t.meta.image.split(","),s=0<=this._url.indexOf("/")?"/":"\\",a=this._url.lastIndexOf(s),o=0<=a?this._url.substr(0,a+1):"";Vt.onAndroid&&t.meta.compressTextureAndroid&&(n=".ktx"),Vt.onIOS&&t.meta.compressTextureIOS&&(n=".pvr");for(var h=0,l=r.length;h<l;h++)r[h]=n?o+r[h].replace(".png",n):o+r[h]}else r=[this._url.replace(".json",".png")];r.reverse(),t.toLoads=r,t.pics=[]}return this.event("progress",.3+1/r.length*.6),this._loadImage(r.pop())}if(this._data.pics.push(t),0<this._data.toLoads.length)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var u=this._data.frames,c=this._url.split("?")[0],_=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:c.substring(0,c.lastIndexOf("."))+"/",d=this._data.pics,f=gn.formatURL(this._url),p=R.atlasMap[f]||(R.atlasMap[f]=[]);p.dir=_;var m=1;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var g in m=parseFloat(this._data.meta.scale),u){var v,T=u[g],y=d[T.frame.idx?T.frame.idx:0],E=gn.formatURL(_+g);y.scaleRate=m,v=xr._create(y,T.frame.x,T.frame.y,T.frame.w,T.frame.h,T.spriteSourceSize.x,T.spriteSourceSize.y,T.sourceSize.w,T.sourceSize.h,laya.net.Loader.getRes(E)),R.cacheRes(E,v),v.url=E,p.push(E)}else for(g in u)y=d[(T=u[g]).frame.idx?T.frame.idx:0],E=gn.formatURL(_+g),v=xr._create(y,T.frame.x,T.frame.y,T.frame.w,T.frame.h,T.spriteSourceSize.x,T.spriteSourceSize.y,T.sourceSize.w,T.sourceSize.h,laya.net.Loader.getRes(E)),R.cacheRes(E,v),v.url=E,p.push(E);delete this._data.pics,this.complete(this._data)}else if("font"===e){if(!t._source)return this._data=t,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var x=new pn;x.parseFont(this._data,new xr(t));var S=this._url.split(".fnt")[0].split("/"),C=S[S.length-1];Os.registerBitmapFont(C,x),this._data=x,this.complete(this._data)}else if("prefab"===e){var I=new N;I.json=t,this.complete(I)}else this.complete(t)},e.parsePLFData=function(t){var e,i,n;for(e in t)switch(n=t[e],e){case"json":case"text":for(i in n)R.preLoadedMap[gn.formatURL(i)]=n[i];break;default:for(i in n)R.preLoadedMap[gn.formatURL(i)]=n[i]}},e.parsePLFBData=function(t){var e,i,n=0;for(i=(e=new Ce(t)).getInt32(),n=0;n<i;n++)this.parseOnePLFBFile(e)},e.parseOnePLFBFile=function(t){var e,i,n;i=t.getUTFString(),e=t.getInt32(),n=t.readArrayBuffer(e),R.preLoadedMap[gn.formatURL(i)]=n},e.complete=function(t){this._data=t,this._customParse?this.event("loaded",t instanceof Array?[t]:t):(R._loaders.push(this),R._isWorking||R.checkNext())},e.endLoad=function(t){t&&(this._data=t),this._cache&&R.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},g(0,e,"data",function(){return this._data}),g(0,e,"cache",function(){return this._cache}),g(0,e,"type",function(){return this._type}),g(0,e,"url",function(){return this._url}),R.getTypeFromUrl=function(t){var e=nt.getFileExtension(t);return e?R.typeMap[e]:(console.warn("Not recognize the resources suffix",t),"text")},R.checkNext=function(){R._isWorking=!0;for(var t=Vt.now();R._startIndex<R._loaders.length;)if(Vt.now(),R._loaders[R._startIndex].endLoad(),R._startIndex++,Vt.now()-t>R.maxTimeOut)return console.warn("loader callback cost a long time:"+(Vt.now()-t)+" url="+R._loaders[R._startIndex-1].url),void T.systemTimer.frameOnce(1,null,R.checkNext);R._loaders.length=0,R._startIndex=0,R._isWorking=!1},R.clearRes=function(t){t=gn.formatURL(t);var e=R.getAtlas(t);if(e){for(var i=0,n=e.length;i<n;i++){var r=e[i],s=R.getRes(r);delete R.loadedMap[r],s&&s.destroy()}e.length=0,delete R.atlasMap[t],delete R.loadedMap[t]}else{var a=R.loadedMap[t];a&&(delete R.loadedMap[t],a instanceof laya.resource.Texture&&a.bitmap&&a.destroy())}},R.clearTextureRes=function(t){t=gn.formatURL(t);var e=laya.net.Loader.getAtlas(t),i=e&&0<e.length?laya.net.Loader.getRes(e[0]):laya.net.Loader.getRes(t);i instanceof laya.resource.Texture&&i.disposeBitmap()},R.getRes=function(t){return R.loadedMap[gn.formatURL(t)]},R.getAtlas=function(t){return R.atlasMap[gn.formatURL(t)]},R.cacheRes=function(t,e){t=gn.formatURL(t),null!=R.loadedMap[t]?console.warn("Resources already exist,is repeated loading:",t):R.loadedMap[t]=e},R.setGroup=function(t,e){R.groupMap[e]||(R.groupMap[e]=[]),R.groupMap[e].push(t)},R.clearResByGroup=function(t){if(R.groupMap[t]){var e=R.groupMap[t],i=0,n=e.length;for(i=0;i<n;i++)R.clearRes(e[i]);e.length=0}},R.TEXT="text",R.JSON="json",R.PREFAB="prefab",R.XML="xml",R.BUFFER="arraybuffer",R.IMAGE="image",R.SOUND="sound",R.ATLAS="atlas",R.FONT="font",R.TTF="ttf",R.PLF="plf",R.PLFB="plfb",R.HIERARCHY="HIERARCHY",R.MESH="MESH",R.MATERIAL="MATERIAL",R.TEXTURE2D="TEXTURE2D",R.TEXTURECUBE="TEXTURECUBE",R.ANIMATIONCLIP="ANIMATIONCLIP",R.AVATAR="AVATAR",R.TERRAINHEIGHTDATA="TERRAINHEIGHTDATA",R.TERRAINRES="TERRAIN",R.typeMap={ttf:"ttf",png:"image",jpg:"image",jpeg:"image",ktx:"image",pvr:"image",txt:"text",json:"json",prefab:"prefab",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",plf:"plf",plfb:"plfb",scene:"json",ani:"json",sk:"arraybuffer"},R.parserMap={},R.maxTimeOut=100,R.groupMap={},R.loadedMap={},R.atlasMap={},R.preLoadedMap={},R._imgCache={},R._loaders=[],R._isWorking=!1,R._startIndex=0,R}(),kn=function(t){function e(){e.__super.call(this)}return I(e,"laya.webgl.BufferState2D",W),e}(),Wn=function(t){function e(){this._maxsize=0,this._upload=!0,this._uploadSize=0,this._bufferSize=0,this._u8Array=null,e.__super.call(this)}I(e,"laya.webgl.utils.Buffer2D",L);var i=e.prototype;return i.setByteLength=function(t){this._byteLength!==t&&(t<=this._bufferSize||this._resizeBuffer(2*t+256,!0),this._byteLength=t)},i.needSize=function(t){var e=this._byteLength;if(t){var i=this._byteLength+t;i<=this._bufferSize||this._resizeBuffer(i<<1,!0),this._byteLength=i}return e},i._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),$i.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,Nt.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage)),Nt.instance.bufferSubData(this._bufferType,0,new Uint8Array(this._buffer,0,this._byteLength))},i._bufferSubData=function(t,e,i){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._maxsize=Math.max(this._maxsize,this._byteLength),$i.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this._buffer=this._buffer.slice(0,this._maxsize+64),this._bufferSize=this._buffer.byteLength,this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,Nt.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage)),e||i){var n=this._buffer.slice(e,i);Nt.instance.bufferSubData(this._bufferType,t,n)}else Nt.instance.bufferSubData(this._bufferType,t,this._buffer)},i._checkArrayUse=function(){},i._bind_uploadForVAO=function(){return!!this._upload&&(this._upload=!1,this._bindForVAO(),this._bufferData(),!0)},i._bind_upload=function(){return!!this._upload&&(this._upload=!1,this.bind(),this._bufferData(),!0)},i._bind_subUpload=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),!!this._upload&&(this._upload=!1,this.bind(),this._bufferSubData(t,e,i),!0)},i._resizeBuffer=function(t,e){var i=this._buffer;if(t<=i.byteLength)return this;var n=this._u8Array;if(e&&i&&0<i.byteLength){var r=new ArrayBuffer(t),s=n&&n.buffer==i?n:new Uint8Array(i);(n=this._u8Array=new Uint8Array(r)).set(s,0),i=this._buffer=r}else i=this._buffer=new ArrayBuffer(t),this._u8Array=null;return this._checkArrayUse(),this._upload=!0,this._bufferSize=i.byteLength,this},i.append=function(t){this._upload=!0;var e,i;e=t.byteLength,t instanceof Uint8Array?(this._resizeBuffer(this._byteLength+e,!0),i=new Uint8Array(this._buffer,this._byteLength)):t instanceof Uint16Array?(this._resizeBuffer(this._byteLength+e,!0),i=new Uint16Array(this._buffer,this._byteLength)):t instanceof Float32Array&&(this._resizeBuffer(this._byteLength+e,!0),i=new Float32Array(this._buffer,this._byteLength)),i.set(t,0),this._byteLength+=e,this._checkArrayUse()},i.appendU16Array=function(t,e){this._resizeBuffer(this._byteLength+2*e,!0);var i=new Uint16Array(this._buffer,this._byteLength,e);if(6==e)i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5];else if(100<=e)i.set(new Uint16Array(t.buffer,0,e));else for(var n=0;n<e;n++)i[n]=t[n];this._byteLength+=2*e,this._checkArrayUse()},i.appendEx=function(t,e){this._upload=!0;var i;i=t.byteLength,this._resizeBuffer(this._byteLength+i,!0),new e(this._buffer,this._byteLength).set(t,0),this._byteLength+=i,this._checkArrayUse()},i.appendEx2=function(t,e,i,n){void 0===n&&(n=1),this._upload=!0;var r,s;r=i*n,this._resizeBuffer(this._byteLength+r,!0),s=new e(this._buffer,this._byteLength);var a=0;for(a=0;a<i;a++)s[a]=t[a];this._byteLength+=r,this._checkArrayUse()},i.getBuffer=function(){return this._buffer},i.setNeedUpload=function(){this._upload=!0},i.getNeedUpload=function(){return this._upload},i.upload=function(){var t=this._bind_upload();return Nt.instance.bindBuffer(this._bufferType,null),34962==this._bufferType&&(L._bindedVertexBuffer=null),34963==this._bufferType&&(L._bindedIndexBuffer=null),rs.activeShader=null,t},i.subUpload=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var n=this._bind_subUpload();return Nt.instance.bindBuffer(this._bufferType,null),34962==this._bufferType&&(L._bindedVertexBuffer=null),34963==this._bufferType&&(L._bindedIndexBuffer=null),rs.activeShader=null,n},i._disposeResource=function(){this._upload=!0,this._uploadSize=0},i.clear=function(){this._byteLength=0,this._upload=!0},g(0,i,"byteLength",null,function(t){this.setByteLength(t)}),g(0,i,"bufferLength",function(){return this._buffer.byteLength}),e.__int__=function(t){},e.FLOAT32=4,e.SHORT=2,e}(),Xn=function(t){function n(t,e,i){n.__super.call(this),void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),this._sizeX=t,this._sizeY=e,this._sizeZ=i,this._type=0,n._nativeSize.setValue(t/2,e/2,i/2),this._nativeShape=new In._physics3D.btBoxShape(n._nativeSize)}I(n,"laya.d3.physics.shape.BoxColliderShape",J);var e=n.prototype;return e.clone=function(){var t=new n(this._sizeX,this._sizeY,this._sizeZ);return this.cloneTo(t),t},g(0,e,"sizeZ",function(){return this._sizeZ}),g(0,e,"sizeY",function(){return this._sizeY}),g(0,e,"sizeX",function(){return this._sizeX}),E(n,["_nativeSize",function(){return this._nativeSize=new In._physics3D.btVector3(0,0,0)}]),n}(),Yn=function(i){function t(){t.__super.call(this),this.inTangent=new on,this.outTangent=new on,this.value=new Qt}return I(t,"laya.d3.core.QuaternionKeyframe",i),t.prototype.cloneTo=function(t){i.prototype.cloneTo.call(this,t);var e=t;this.inTangent.cloneTo(e.inTangent),this.outTangent.cloneTo(e.outTangent),this.value.cloneTo(e.value)},t}(h),Zn=function(t){function n(t,e){this._floatCountPerVertices=7,this._owner=null,this._vertexBuffer=null,this._vertices=null,this._maxLineCount=0,this._lineCount=0,n.__super.call(this),this._minUpdate=Number.MAX_VALUE,this._maxUpdate=Number.MIN_VALUE,this._bufferState=new Mr;var i=2*e;this._owner=t,this._maxLineCount=e,this._vertices=new Float32Array(i*this._floatCountPerVertices),this._vertexBuffer=new zn(Xt.vertexDeclaration.vertexStride*i,35044,!1),this._vertexBuffer.vertexDeclaration=Xt.vertexDeclaration,this._bufferState.bind(),this._bufferState.applyVertexBuffer(this._vertexBuffer),this._bufferState.unBind()}I(n,"laya.d3.core.pixelLine.PixelLineFilter",t);var e=n.prototype;return e._getType=function(){return n._type},e._resizeLineData=function(t){var e=2*t,i=this._vertices;this._vertexBuffer.destroy(),this._maxLineCount=t;var n=e*this._floatCountPerVertices;this._vertices=new Float32Array(n),this._vertexBuffer=new zn(Xt.vertexDeclaration.vertexStride*e,35044,!1),this._vertexBuffer.vertexDeclaration=Xt.vertexDeclaration,n<i.length?(this._vertices.set(new Float32Array(i.buffer,0,n)),this._vertexBuffer.setData(this._vertices,0,0,n)):(this._vertices.set(i),this._vertexBuffer.setData(this._vertices,0,0,i.length)),this._bufferState.bind(),this._bufferState.applyVertexBuffer(this._vertexBuffer),this._bufferState.unBind()},e._updateLineVertices=function(t,e,i,n,r){e&&(this._vertices[t+0]=e.x,this._vertices[t+1]=e.y,this._vertices[t+2]=e.z),n&&(this._vertices[t+3]=n.r,this._vertices[t+4]=n.g,this._vertices[t+5]=n.b,this._vertices[t+6]=n.a),i&&(this._vertices[t+7]=i.x,this._vertices[t+8]=i.y,this._vertices[t+9]=i.z),r&&(this._vertices[t+10]=r.r,this._vertices[t+11]=r.g,this._vertices[t+12]=r.b,this._vertices[t+13]=r.a),this._minUpdate=Math.min(this._minUpdate,t),this._maxUpdate=Math.max(this._maxUpdate,t+2*this._floatCountPerVertices)},e._removeLineData=function(t){var e=2*this._floatCountPerVertices,i=t+1,n=t*e,r=new Float32Array(this._vertices.buffer,i*e*4,(this._lineCount-i)*e);this._vertices.set(r,n),this._minUpdate=n,this._maxUpdate=n+2*this._floatCountPerVertices,this._lineCount--},e._updateLineData=function(t,e,i,n,r){var s=t*(2*this._floatCountPerVertices);this._updateLineVertices(s,e,i,n,r)},e._updateLineDatas=function(t,e){for(var i=2*this._floatCountPerVertices,n=e.length,r=0;r<n;r++){var s=e[r];this._updateLineVertices((t+r)*i,s.startPosition,s.endPosition,s.startColor,s.endColor)}},e._getLineData=function(t,e){var i=e.startPosition,n=e.startColor,r=e.endPosition,s=e.endColor,a=this._vertices,o=t*this._floatCountPerVertices*2;i.x=a[o+0],i.y=a[o+1],i.z=a[o+2],n.r=a[o+3],n.g=a[o+4],n.b=a[o+5],n.a=a[o+6],r.x=a[o+7],r.y=a[o+8],r.z=a[o+9],s.r=a[o+10],s.g=a[o+11],s.b=a[o+12],s.a=a[o+13]},e._prepareRender=function(t){return!0},e._render=function(t){this._minUpdate!==Number.MAX_VALUE&&this._maxUpdate!==Number.MIN_VALUE&&(this._vertexBuffer.setData(this._vertices,this._minUpdate,this._minUpdate,this._maxUpdate-this._minUpdate),this._minUpdate=Number.MAX_VALUE,this._maxUpdate=Number.MIN_VALUE),0<this._lineCount&&(this._bufferState.bind(),Nt.instance.drawArrays(1,0,2*this._lineCount),$i.renderBatches++)},e.destroy=function(){this._destroyed||(t.prototype.destroy.call(this),this._bufferState.destroy(),this._vertexBuffer.destroy(),this._bufferState=null,this._vertexBuffer=null,this._vertices=null)},E(n,["_type",function(){return this._type=X._typeCounter++}]),n}(X),jn=(function(t){function e(){e.__super.call(this)}I(e,"laya.ui.UIEvent",rt),e.SHOW_TIP="showtip",e.HIDE_TIP="hidetip"}(),function(t){function e(){e.__super.call(this)}I(e,"laya.d3.CastShadowList",u);var i=e.prototype;return i.add=function(t){if(-1!==t._indexInCastShadowList)throw"CastShadowList:element has  in  CastShadowList.";this._add(t),t._indexInCastShadowList=this.length++},i.remove=function(t){var e=t._indexInCastShadowList;if(this.length--,e!==this.length){var i=this.elements[this.length];(this.elements[e]=i)._indexInCastShadowList=e}t._indexInCastShadowList=-1},e}()),Kn=function(t){function e(){e.__super.call(this),this._top=NaN,this._bottom=NaN,this._left=NaN,this._right=NaN,this._centerX=NaN,this._centerY=NaN}I(e,"laya.ui.Widget",r);var i=e.prototype;return i.onReset=function(){this._top=this._bottom=this._left=this._right=this._centerX=this._centerY=NaN},i._onEnable=function(){this.owner.parent?this._onAdded():this.owner.once("added",this,this._onAdded)},i._onDisable=function(){this.owner.off("added",this,this._onAdded),this.owner.parent&&this.owner.parent.off("resize",this,this._onParentResize)},i._onAdded=function(){this.owner.parent&&this.owner.parent.on("resize",this,this._onParentResize),this.resetLayoutX(),this.resetLayoutY()},i._onParentResize=function(){(this.resetLayoutX()||this.resetLayoutY())&&this.owner.event("resize")},i.resetLayoutX=function(){var t=this.owner;if(!t)return!1;var e=t.parent;if(e)if(isNaN(this.centerX)){if(isNaN(this.left))isNaN(this.right)||(t.x=Math.round(e.width-t.displayWidth-this.right+t.pivotX*t.scaleX));else if(t.x=Math.round(this.left+t.pivotX*t.scaleX),!isNaN(this.right)){var i=(e._width-this.left-this.right)/(t.scaleX||.01);if(i!=t.width)return t.width=i,!0}}else t.x=Math.round(.5*(e.width-t.displayWidth)+this.centerX+t.pivotX*t.scaleX);return!1},i.resetLayoutY=function(){var t=this.owner;if(!t)return!1;var e=t.parent;if(e)if(isNaN(this.centerY)){if(isNaN(this.top))isNaN(this.bottom)||(t.y=Math.round(e.height-t.displayHeight-this.bottom+t.pivotY*t.scaleY));else if(t.y=Math.round(this.top+t.pivotY*t.scaleY),!isNaN(this.bottom)){var i=(e._height-this.top-this.bottom)/(t.scaleY||.01);if(i!=t.height)return t.height=i,!0}}else t.y=Math.round(.5*(e.height-t.displayHeight)+this.centerY+t.pivotY*t.scaleY);return!1},i.resetLayout=function(){this.owner&&(this.resetLayoutX(),this.resetLayoutY())},g(0,i,"centerY",function(){return this._centerY},function(t){this._centerY!=t&&(this._centerY=t,this.resetLayoutY())}),g(0,i,"right",function(){return this._right},function(t){this._right!=t&&(this._right=t,this.resetLayoutX())}),g(0,i,"left",function(){return this._left},function(t){this._left!=t&&(this._left=t,this.resetLayoutX())}),g(0,i,"centerX",function(){return this._centerX},function(t){this._centerX!=t&&(this._centerX=t,this.resetLayoutX())}),g(0,i,"bottom",function(){return this._bottom},function(t){this._bottom!=t&&(this._bottom=t,this.resetLayoutY())}),g(0,i,"top",function(){return this._top},function(t){this._top!=t&&(this._top=t,this.resetLayoutY())}),E(e,["EMPTY",function(){return this.EMPTY=new e}]),e}(),qn=function(t){function r(){this.worker=null,this._useWorkerLoader=!1,r.__super.call(this);var e=this;this.worker=new Worker(r.workerPath),this.worker.onmessage=function(t){e.workerMessage(t.data)}}I(r,"laya.net.WorkerLoader",o);var e=r.prototype;return e.workerMessage=function(t){if(t)switch(t.type){case"Image":this.imageLoaded(t);break;case"Disable":r.enable=!1}},e.imageLoaded=function(t){if(t.dataType&&"imageBitmap"==t.dataType){var e=new Ys(!0),i=e.source.getContext("2d");switch(t.dataType){case"imageBitmap":var n=t.imageBitmap;e.size(n.width,n.height),i.drawImage(n,0,0)}console.log("load:",t.url),e._setGPUMemory(0);var r=new ea;r.loadImageSource(e.source),this.event(t.url,r)}else this.event(t.url,null)},e.loadImage=function(t){this.worker.postMessage(t)},e._loadImage=function(e){var i=this;if(this._useWorkerLoader&&r._enable){e=gn.formatURL(e);var n=function(t){laya.net.WorkerLoader.I.off(e,i,n),t?i.onLoaded(t):r._preLoadFun.call(i,e)};laya.net.WorkerLoader.I.on(e,i,n),laya.net.WorkerLoader.I.loadImage(e)}else r._preLoadFun.call(i,e)},g(1,r,"enable",function(){return r._enable},function(t){r._enable!=t&&(r._enable=t)&&null==r._preLoadFun&&(r._enable=r.__init__())}),r.__init__=function(){return null==r._preLoadFun&&(!!Worker&&(r._preLoadFun=Hn.prototype._loadImage,Hn.prototype._loadImage=r.prototype._loadImage,r.I||(r.I=new r),!0))},r.workerSupported=function(){return!!Worker},r.enableWorkerLoader=function(){r._tryEnabled||(r.enable=!0,r._tryEnabled=!0)},r.I=null,r.workerPath="libs/workerloader.js",r._preLoadFun=null,r._enable=!1,r._tryEnabled=!1,r}(),Qn=function(t){function e(){this._responseType=null,this._data=null,this._url=null,e.__super.call(this),this._http=new Vt.window.XMLHttpRequest}I(e,"laya.net.HttpRequest",o);var i=e.prototype;return i.send=function(t,e,i,n,r){void 0===i&&(i="get"),void 0===n&&(n="text"),this._responseType=n,this._data=null,this._url=t;var s=this,a=this._http;if(t=gn.getAdptedFilePath(t),a.open(i,t,!0),r)for(var o=0;o<r.length;o++)a.setRequestHeader(r[o++],r[o]);else qi.isConchApp||(e&&"string"!=typeof e?a.setRequestHeader("Content-Type","application/json"):a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));a.responseType="arraybuffer"!==n?"text":"arraybuffer",a.onerror=function(t){s._onError(t)},a.onabort=function(t){s._onAbort(t)},a.onprogress=function(t){s._onProgress(t)},a.onload=function(t){s._onLoad(t)},a.send(e)},i._onProgress=function(t){t&&t.lengthComputable&&this.event("progress",t.loaded/t.total)},i._onAbort=function(t){this.error("Request was aborted by user")},i._onError=function(t){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},i._onLoad=function(t){var e=this._http,i=void 0!==e.status?e.status:200;200===i||204===i||0===i?this.complete():this.error("["+e.status+"]"+e.statusText+":"+e.responseURL)},i.error=function(t){this.clear(),console.warn(this.url,t),this.event("error",t)},i.complete=function(){this.clear();var e=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=nt.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch(t){e=!1,this.error(t.message)}e&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},i.clear=function(){var t=this._http;t.onerror=t.onabort=t.onprogress=t.onload=null},g(0,i,"data",function(){return this._data}),g(0,i,"http",function(){return this._http}),g(0,i,"url",function(){return this._url}),e}(),$n=function(t){function l(t,e,i,n,r,s,a,o){this._owner=null,this._gridSize=NaN,this.memorySize=0,this._numberVertices=0,this._maxNumberIndices=0,this._currentNumberIndices=0,this._numberTriangle=0,this._vertexBuffer=null,this._indexBuffer=null,this._indexArrayBuffer=null,this._boundingBoxCorners=null,this._leafs=null,this._leafNum=0,this._terrainHeightData=null,this._terrainHeightDataWidth=0,this._terrainHeightDataHeight=0,this._chunkOffsetX=0,this._chunkOffsetZ=0,this._cameraCoordinateInverse=!1,this._cameraPos=null,this._currentLOD=0,this._perspectiveFactor=NaN,this._LODTolerance=0,this._boundingSphere=null,this._boundingBox=null,l.__super.call(this),this._bufferState=new Mr,this._owner=t,this._cameraPos=new ln,this._chunkOffsetX=e,this._chunkOffsetZ=i,this._gridSize=n,this._terrainHeightData=r,this._terrainHeightDataWidth=s,this._terrainHeightDataHeight=a,this._leafNum=fe.CHUNK_GRID_NUM/fe.LEAF_GRID_NUM*(fe.CHUNK_GRID_NUM/fe.LEAF_GRID_NUM),this._leafs=P(this._leafNum),this._cameraCoordinateInverse=o;for(var h=0;h<this._leafNum;h++)this._leafs[h]=new fe;this.recreateResource()}I(l,"laya.d3.terrain.TerrainFilter",X);var e=l.prototype;return e.recreateResource=function(){this._currentNumberIndices=0,this._numberTriangle=0;var t=fe.LEAF_VERTEXT_COUNT,e=fe.LEAF_MAX_INDEX_COUNT;this._numberVertices=t*this._leafNum,this._maxNumberIndices=e*this._leafNum,this._indexArrayBuffer=new Uint16Array(this._maxNumberIndices);var i=Zt.vertexDeclaration,n=i.vertexStride/4,r=new Float32Array(this._numberVertices*n),s=fe.CHUNK_GRID_NUM/fe.LEAF_GRID_NUM,a=0,o=0,h=0;for(a=0;a<this._leafNum;a++)o=a%s,h=Math.floor(a/s),this._leafs[a].calcVertextBuffer(this._chunkOffsetX,this._chunkOffsetZ,o*fe.LEAF_GRID_NUM,h*fe.LEAF_GRID_NUM,this._gridSize,r,a*fe.LEAF_PLANE_VERTEXT_COUNT,n,this._terrainHeightData,this._terrainHeightDataWidth,this._terrainHeightDataHeight,this._cameraCoordinateInverse);for(a=0;a<this._leafNum;a++)o=a%s,h=Math.floor(a/s),this._leafs[a].calcSkirtVertextBuffer(this._chunkOffsetX,this._chunkOffsetZ,o*fe.LEAF_GRID_NUM,h*fe.LEAF_GRID_NUM,this._gridSize,r,this._leafNum*fe.LEAF_PLANE_VERTEXT_COUNT+a*fe.LEAF_SKIRT_VERTEXT_COUNT,n,this._terrainHeightData,this._terrainHeightDataWidth,this._terrainHeightDataHeight);this.assembleIndexInit(),this._vertexBuffer=new zn(i.vertexStride*this._numberVertices,35044,!1),this._vertexBuffer.vertexDeclaration=i,this._indexBuffer=new dr("ushort",this._maxNumberIndices,35044,!1),this._vertexBuffer.setData(r),this._indexBuffer.setData(this._indexArrayBuffer),this.memorySize=2*(this._vertexBuffer._byteLength+this._indexBuffer._byteLength),this.calcOriginalBoudingBoxAndSphere(),this._bufferState.bind(),this._bufferState.applyVertexBuffer(this._vertexBuffer),this._bufferState.applyIndexBuffer(this._indexBuffer),this._bufferState.unBind()},e.setLODLevel=function(t){if(4!=t.length)return!0;var e=(t[0]+1<<24)+(t[1]+1<<16)+(t[2]+1<<8)+(t[3]+1);return this._currentLOD!=e&&(this._currentLOD=e,!0)},e.assembleIndexInit=function(){this._currentNumberIndices=0;for(var t=this._numberTriangle=0,e=0;e<this._leafNum;e++){var i=fe.getPlaneLODIndex(e,0);this._indexArrayBuffer.set(i,t),t+=i.length;var n=fe.getSkirtLODIndex(e,0);this._indexArrayBuffer.set(n,t),t+=n.length,this._currentNumberIndices+=i.length+n.length}this._numberTriangle=this._currentNumberIndices/3},e.isNeedAssemble=function(t,e){var i=Math.min(t.viewport.width,t.viewport.height)/(2*Math.tan(Math.PI*t.fieldOfView/180));return this._perspectiveFactor!=i?(this._perspectiveFactor=i,1):this._LODTolerance!=ws.LOD_TOLERANCE_VALUE?(this._LODTolerance=ws.LOD_TOLERANCE_VALUE,1):0==ln.equals(e,this._cameraPos)?(this._cameraPos.x=e.x,this._cameraPos.y=e.y,this._cameraPos.z=e.z,2):0},e.assembleIndex=function(t,e){var i=this.isNeedAssemble(t,e);if(0<i){for(var n=0;n<this._leafNum;n++)l._TEMP_ARRAY_BUFFER[n]=this._leafs[n].determineLod(e,this._perspectiveFactor,ws.LOD_TOLERANCE_VALUE,1==i);if(this.setLODLevel(l._TEMP_ARRAY_BUFFER)){this._currentNumberIndices=0;var r=this._numberTriangle=0;for(n=0;n<this._leafNum;n++){var s=l._TEMP_ARRAY_BUFFER[n],a=fe.getPlaneLODIndex(n,s);this._indexArrayBuffer.set(a,r),r+=a.length;var o=fe.getSkirtLODIndex(n,s);this._indexArrayBuffer.set(o,r),r+=o.length,this._currentNumberIndices+=a.length+o.length}return this._numberTriangle=this._currentNumberIndices/3,!0}}return!1},e.calcOriginalBoudingBoxAndSphere=function(){for(var t=new un(2147483647,-2147483647),e=0;e<this._leafNum;e++)t.x=this._leafs[e]._sizeOfY.x<t.x?this._leafs[e]._sizeOfY.x:t.x,t.y=this._leafs[e]._sizeOfY.y>t.y?this._leafs[e]._sizeOfY.y:t.y;var i=new ln(this._chunkOffsetX*fe.CHUNK_GRID_NUM*this._gridSize,t.x,this._chunkOffsetZ*fe.CHUNK_GRID_NUM*this._gridSize),n=new ln((this._chunkOffsetX+1)*fe.CHUNK_GRID_NUM*this._gridSize,t.y,(this._chunkOffsetZ+1)*fe.CHUNK_GRID_NUM*this._gridSize);fe.__ADAPT_MATRIX__&&(ln.transformV3ToV3(i,fe.__ADAPT_MATRIX__,i),ln.transformV3ToV3(n,fe.__ADAPT_MATRIX__,n)),this._boundingBox=new Qe(i,n);var r=new ln;ln.subtract(n,i,r),ln.scale(r,.5,r);var s=new ln;ln.add(i,r,s),this._boundingSphere=new Ft(s,ln.scalarLength(r)),this._boundingBoxCorners=P(8,null),this._boundingBox.getCorners(this._boundingBoxCorners)},e.calcLeafBoudingBox=function(t){for(var e=0;e<this._leafNum;e++)this._leafs[e].calcLeafBoudingBox(t)},e.calcLeafBoudingSphere=function(t,e){for(var i=0;i<this._leafNum;i++)this._leafs[i].calcLeafBoudingSphere(t,e)},e._getVertexBuffer=function(t){return void 0===t&&(t=0),0==t?this._vertexBuffer:null},e._getIndexBuffer=function(){return this._indexBuffer},e._getType=function(){return l._type},e._prepareRender=function(t){return!0},e._render=function(t){this._bufferState.bind(),Nt.instance.drawElements(ws.RENDER_LINE_MODEL?1:4,this._currentNumberIndices,5123,0),$i.trianglesFaces+=this._numberTriangle,$i.renderBatches++},e.destroy=function(){this._owner=null,this._bufferState.destroy(),this._vertexBuffer&&this._vertexBuffer.destroy(),this._indexBuffer&&this._indexBuffer.destroy()},E(l,["_TEMP_ARRAY_BUFFER",function(){return this._TEMP_ARRAY_BUFFER=new Uint32Array(fe.CHUNK_GRID_NUM/fe.LEAF_GRID_NUM*fe.CHUNK_GRID_NUM/fe.LEAF_GRID_NUM)},"_type",function(){return this._type=X._typeCounter++}]),l}(),Jn=function(t){var d;function f(){this.retryNum=1,this.retryDelay=0,this.maxLoader=5,this._loaders=[],this._loaderCount=0,this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},this._statInfo={count:1,loaded:1},f.__super.call(this);for(var t=0;t<this._maxPriority;t++)this._resInfos[t]=[]}I(f,"laya.net.LoaderManager",o);var e=f.prototype;return e.getProgress=function(){return this._statInfo.loaded/this._statInfo.count},e.resetProgress=function(){this._statInfo.count=this._statInfo.loaded=1},e.create=function(t,e,i,n,r,s,a,o){void 0===a&&(a=1),void 0===o&&(o=!0),this._create(t,!0,e,i,n,r,s,a,o)},e._create=function(t,e,i,n,r,s,a,o,h){if(void 0===o&&(o=1),void 0===h&&(h=!0),t instanceof Array){var l=!0,u=t,c=u.length,_=0;if(n)var d=y.create(n.caller,n.method,n.args,!1);for(var f=0;f<c;f++){var p=u[f];"string"==typeof p&&(p=u[f]={url:p}),p.progress=0}for(f=0;f<c;f++){p=u[f];var m=n?y.create(null,T,[p],!1):null,g=n||i?y.create(null,v,[p]):null;this._createOne(p.url,e,g,m,p.type||r,p.constructParams||s,p.propertyParams||a,p.priority||o,h)}function v(t,e){_++,t.progress=1,e||(l=!1),_===c&&i&&i.runWith(l)}function T(t,e){t.progress=e;for(var i=0,n=0;n<c;n++){i+=u[n].progress}var r=i/c;d.runWith(r)}}else this._createOne(t,e,i,n,r,s,a,o,h)},e._createOne=function(e,i,n,t,r,s,a,o,h){void 0===o&&(o=1),void 0===h&&(h=!0);var l=this.getRes(e);if(l)!i&&l instanceof laya.resource.Resource&&l._addReference(),t&&t.runWith(1),n&&n.runWith(l);else{var u=nt.getFileExtension(e);if(r||(r=f.createMap[u]?f.createMap[u][0]:null),!r)return void this.load(e,n,t,r,o,h);if(!Hn.parserMap[r])return void this.load(e,n,t,r,o,h);this._createLoad(e,y.create(null,function(t){t&&(!i&&t instanceof laya.resource.Resource&&t._addReference(),t._setCreateURL(e));n&&n.runWith(t),T.loader.event(e)}),t,r,s,a,o,h,!0)}},e.load=function(t,e,i,n,r,s,a,o,h){var l=this;if(void 0===r&&(r=1),void 0===s&&(s=!0),void 0===o&&(o=!1),void 0===h&&(h=!1),t instanceof Array)return this._loadAssets(t,e,i,n,r,s,a);var u=Hn.getRes(t);if(o||null==u){var c;c=t,(t=Vi.getFileLoadPath(t))!=c&&"nativeimage"!==n?n="atlas":c=null;var _=f._resMap[t];_?(e&&(c?e&&_._createListener("complete",this,this._resInfoLoaded,[c,e],!1,!1):e&&_._createListener("complete",e.caller,e.method,e.args,!1,!1)),i&&_._createListener("progress",i.caller,i.method,i.args,!1,!1)):((_=this._infoPool.length?this._infoPool.pop():new d).url=t,_.type=n,_.cache=s,_.group=a,_.ignoreCache=o,_.useWorkerLoader=h,_.originalUrl=c,e&&_.on("complete",e.caller,e.method,e.args),i&&_.on("progress",i.caller,i.method,i.args),f._resMap[t]=_,r=r<this._maxPriority?r:this._maxPriority-1,this._resInfos[r].push(_),this._statInfo.count++,this.event("progress",this.getProgress()),this._next())}else T.systemTimer.frameOnce(1,null,function(){i&&i.runWith(1),e&&e.runWith(u instanceof Array?[u]:u),l._loaderCount||l.event("complete")});return this},e._resInfoLoaded=function(t,e){e.runWith(Hn.getRes(t))},e._createLoad=function(t,e,i,n,r,s,a,o,h){var l=this;if(void 0===a&&(a=1),void 0===o&&(o=!0),void 0===h&&(h=!1),t instanceof Array)return this._loadAssets(t,e,i,n,a,o);var u=Hn.getRes(t);if(null!=u)T.systemTimer.frameOnce(1,null,function(){i&&i.runWith(1),e&&e.runWith(u),l._loaderCount||l.event("complete")});else{var c=f._resMap[t];c?(e&&c._createListener("complete",e.caller,e.method,e.args,!1,!1),i&&c._createListener("progress",i.caller,i.method,i.args,!1,!1)):((c=this._infoPool.length?this._infoPool.pop():new d).url=t,c.type=n,c.cache=!1,c.ignoreCache=h,c.originalUrl=null,c.createCache=o,c.createConstructParams=r,c.createPropertyParams=s,e&&c.on("complete",e.caller,e.method,e.args),i&&c.on("progress",i.caller,i.method,i.args),f._resMap[t]=c,a=a<this._maxPriority?a:this._maxPriority-1,this._resInfos[a].push(c),this._statInfo.count++,this.event("progress",this.getProgress()),this._next())}return this},e._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var t=0;t<this._maxPriority;t++)for(var e=this._resInfos[t];0<e.length;){var i=e.shift();if(i)return this._doLoad(i)}this._loaderCount||this.event("complete")}},e._doLoad=function(e){this._loaderCount++;var i=this._loaders.length?this._loaders.pop():new Hn;i.on("complete",null,r),i.on("progress",null,function(t){e.event("progress",t)}),i.on("error",null,function(t){r(null)});var n=this;function r(t){i.offAll(),i._data=null,i._customParse=!1,n._loaders.push(i),n._endLoad(e,t instanceof Array?[t]:t),n._loaderCount--,n._next()}i._constructParams=e.createConstructParams,i._propertyParams=e.createPropertyParams,i._createCache=e.createCache,i.load(e.url,e.type,e.cache,e.group,e.ignoreCache,e.useWorkerLoader)},e._endLoad=function(t,e){var i=t.url;if(null==e){var n=this._failRes[i]||0;if(n<this.retryNum)return console.warn("[warn]Retry to load:",i),this._failRes[i]=n+1,void T.systemTimer.once(this.retryDelay,this,this._addReTry,[t],!1);Hn.clearRes(i),console.warn("[error]Failed to load:",i),this.event("error",i)}this._failRes[i]&&(this._failRes[i]=0),delete f._resMap[i],t.originalUrl&&(e=Hn.getRes(t.originalUrl)),t.event("complete",e),t.offAll(),this._infoPool.push(t),this._statInfo.loaded++,this.event("progress",this.getProgress())},e._addReTry=function(t){this._resInfos[this._maxPriority-1].push(t),this._next()},e.clearRes=function(t){Hn.clearRes(t)},e.clearTextureRes=function(t){Hn.clearTextureRes(t)},e.getRes=function(t){return Hn.getRes(t)},e.cacheRes=function(t,e){Hn.cacheRes(t,e)},e.setGroup=function(t,e){Hn.setGroup(t,e)},e.clearResByGroup=function(t){Hn.clearResByGroup(t)},e.clearUnLoaded=function(){for(var t=0;t<this._maxPriority;t++){for(var e=this._resInfos[t],i=e.length-1;-1<i;i--){var n=e[i];n&&(n.offAll(),this._infoPool.push(n))}e.length=0}this._loaderCount=0,f._resMap={}},e.cancelLoadByUrls=function(t){if(t)for(var e=0,i=t.length;e<i;e++)this.cancelLoadByUrl(t[e])},e.cancelLoadByUrl=function(t){for(var e=0;e<this._maxPriority;e++)for(var i=this._resInfos[e],n=i.length-1;-1<n;n--){var r=i[n];r&&r.url===t&&(i[n]=null,r.offAll(),this._infoPool.push(r))}f._resMap[t]&&delete f._resMap[t]},e._loadAssets=function(t,i,a,e,n,r,s){void 0===n&&(n=1),void 0===r&&(r=!0);for(var o=t.length,h=0,l=0,u=[],c=!0,_=0;_<o;_++){var d=t[_];"string"==typeof d&&(d={url:d,type:e,size:1,priority:n}),d.size||(d.size=1),d.progress=0,l+=d.size,u.push(d);var f=a?y.create(null,g,[d],!1):null,p=i||a?y.create(null,m,[d]):null;this.load(d.url,p,f,d.type,d.priority||1,r,d.group||s,!1,d.useWorkerLoader)}function m(t,e){h++,t.progress=1,e||(c=!1),h===o&&i&&i.runWith(c)}function g(t,e){if(null!=a){t.progress=e;for(var i=0,n=0;n<u.length;n++){var r=u[n];i+=r.size*r.progress}var s=i/l;a.runWith(s)}}return this},e.decodeBitmaps=function(t){var e,i=0,n=t.length;for(e=qi._context,i=0;i<n;i++){var r,s;if(r=Hn.getAtlas(t[i]))this._decodeTexture(r[0],e);else(s=this.getRes(t[i]))&&s instanceof laya.resource.Texture&&this._decodeTexture(s,e)}},e._decodeTexture=function(t,e){var i=t.bitmap;if(t&&i){var n=i.source||i.image;if(n&&T.__typeof(n,Vt.window.HTMLImageElement)){e.drawImage(n,0,0,1,1);e.getImageData(0,0,1,1)}}},f.cacheRes=function(t,e){Hn.cacheRes(t,e)},f._resMap={},E(f,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),f.__init$=function(){d=function(t){function e(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,this.useWorkerLoader=!1,this.originalUrl=null,this.createCache=!1,this.createConstructParams=null,this.createPropertyParams=null,e.__super.call(this)}return I(e,"",o),e}()},f}(),tr=function(t){function n(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,this._disposed=!1,n.__super.call(this)}I(n,"laya.media.webaudio.WebAudioSound",o);var e=n.prototype;return e.load=function(t){var e=this;if(t=gn.formatURL(t),this.url=t,this.audioBuffer=n._dataCache[t],this.audioBuffer)this._loaded(this.audioBuffer);else if(n.e.on("loaded:"+t,this,this._loaded),n.e.on("err:"+t,this,this._err),!n.__loadingSound[t]){n.__loadingSound[t]=!0;var i=new Vt.window.XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){e._disposed?e._removeLoadEvents():(e.data=i.response,n.buffs.push({buffer:e.data,url:e.url}),n.decode())},i.onerror=function(t){e._err()},i.send()}},e._err=function(){this._removeLoadEvents(),n.__loadingSound[this.url]=!1,this.event("error")},e._loaded=function(t){this._removeLoadEvents(),this._disposed||(this.audioBuffer=t,n._dataCache[this.url]=this.audioBuffer,this.loaded=!0,this.event("complete"))},e._removeLoadEvents=function(){n.e.off("loaded:"+this.url,this,this._loaded),n.e.off("err:"+this.url,this,this._err)},e.__playAfterLoaded=function(){if(this.__toPlays){var t,e,i,n=0;for(t=(e=this.__toPlays).length,n=0;n<t;n++)(i=e[n])[2]&&!i[2].isStopped&&this.play(i[0],i[1],i[2]);this.__toPlays.length=0}},e.play=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),i=i||new ys,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([t,e,i]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),i.url=this.url,i.loops=e,i.audioBuffer=this.audioBuffer,i.startTime=t,i.play(),Li.addChannel(i),i},e.dispose=function(){this._disposed=!0,delete n._dataCache[this.url],delete n.__loadingSound[this.url],this.audioBuffer=null,this.data=null,this.__toPlays=[]},g(0,e,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),n.decode=function(){n.buffs.length<=0||n.isDecoding||(n.isDecoding=!0,n.tInfo=n.buffs.shift(),n.ctx.decodeAudioData(n.tInfo.buffer,n._done,n._fail))},n._done=function(t){n.e.event("loaded:"+n.tInfo.url,t),n.isDecoding=!1,n.decode()},n._fail=function(){n.e.event("err:"+n.tInfo.url,null),n.isDecoding=!1,n.decode()},n._playEmptySound=function(){if(null!=n.ctx){var t=n.ctx.createBufferSource();t.buffer=n._miniBuffer,t.connect(n.ctx.destination),t.start(0,0,0)}},n._unlock=function(){n._unlocked||(n._playEmptySound(),"running"==n.ctx.state&&(Vt.document.removeEventListener("mousedown",n._unlock,!0),Vt.document.removeEventListener("touchend",n._unlock,!0),Vt.document.removeEventListener("touchstart",n._unlock,!0),n._unlocked=!0))},n.initWebAudio=function(){"running"!=n.ctx.state&&(n._unlock(),Vt.document.addEventListener("mousedown",n._unlock,!0),Vt.document.addEventListener("touchend",n._unlock,!0),Vt.document.addEventListener("touchstart",n._unlock,!0))},n._dataCache={},n.buffs=[],n.isDecoding=!1,n._unlocked=!1,n.tInfo=null,n.__loadingSound={},E(n,["window",function(){return this.window=Vt.window},"webAudioEnabled",function(){return this.webAudioEnabled=n.window.AudioContext||n.window.webkitAudioContext||n.window.mozAudioContext},"ctx",function(){return this.ctx=n.webAudioEnabled?new(n.window.AudioContext||n.window.webkitAudioContext||n.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=n.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new o}]),n}(),er=function(t){function i(){i.__super.call(this,i.__name2int,i.__int2name,i.__int2nameMap)}return I(i,"laya.webgl.shader.d2.ShaderDefines2D",dt),i.__init__=function(){i.reg("TEXTURE2D",1),i.reg("PRIMITIVE",4),i.reg("GLOW_FILTER",8),i.reg("BLUR_FILTER",16),i.reg("COLOR_FILTER",32),i.reg("COLOR_ADD",64),i.reg("WORLDMAT",128),i.reg("FILLTEXTURE",256),i.reg("FSHIGHPRECISION",1024),i.reg("MVP3D",2048)},i.reg=function(t,e){dt._reg(t,e,i.__name2int,i.__int2name)},i.toText=function(t,e,i){return dt._toText(t,e,i)},i.toInt=function(t){return dt._toInt(t,i.__name2int)},i.TEXTURE2D=1,i.PRIMITIVE=4,i.FILTERGLOW=8,i.FILTERBLUR=16,i.FILTERCOLOR=32,i.COLORADD=64,i.WORLDMAT=128,i.FILLTEXTURE=256,i.SKINMESH=512,i.SHADERDEFINE_FSHIGHPRECISION=1024,i.MVP3D=2048,i.NOOPTMASK=312,i.__name2int={},i.__int2name=[],i.__int2nameMap=[],i}(),ir=function(t){function a(t){this._owner=null,this._children=null,this._parent=null,this._dummy=null,this._transformFlag=0,a.__super.call(this),this._localPosition=new ln(0,0,0),this._localRotation=new Qt(0,0,0,1),this._localScale=new ln(1,1,1),this._localRotationEuler=new ln(0,0,0),this._localMatrix=new gt,this._position=new ln(0,0,0),this._rotation=new Qt(0,0,0,1),this._scale=new ln(1,1,1),this._rotationEuler=new ln(0,0,0),this._worldMatrix=new gt,this._owner=t,this._children=[],this._setTransformFlag(7,!1),this._setTransformFlag(248,!0)}I(a,"laya.d3.core.Transform3D",o);var e=a.prototype;return e._setTransformFlag=function(t,e){e?this._transformFlag|=t:this._transformFlag&=~t},e._getTransformFlag=function(t){return 0!=(this._transformFlag&t)},e._setParent=function(t){if(this._parent!==t){if(this._parent){var e=this._parent._children,i=e.indexOf(this);e.splice(i,1)}t&&(t._children.push(this),t&&this._onWorldTransform()),this._parent=t}},e._updateLocalMatrix=function(){gt.createAffineTransformation(this._localPosition,this.localRotation,this._localScale,this._localMatrix)},e._onWorldPositionRotationTransform=function(){if(!(this._getTransformFlag(64)&&this._getTransformFlag(8)&&this._getTransformFlag(16)&&this._getTransformFlag(128))){this._setTransformFlag(216,!0),this.event("transformchanged",this._transformFlag);for(var t=0,e=this._children.length;t<e;t++)this._children[t]._onWorldPositionRotationTransform()}},e._onWorldPositionScaleTransform=function(){if(!this._getTransformFlag(64)||!this._getTransformFlag(8)||!this._getTransformFlag(32)){this._setTransformFlag(104,!0),this.event("transformchanged",this._transformFlag);for(var t=0,e=this._children.length;t<e;t++)this._children[t]._onWorldPositionScaleTransform()}},e._onWorldPositionTransform=function(){if(!this._getTransformFlag(64)||!this._getTransformFlag(8)){this._setTransformFlag(72,!0),this.event("transformchanged",this._transformFlag);for(var t=0,e=this._children.length;t<e;t++)this._children[t]._onWorldPositionTransform()}},e._onWorldRotationTransform=function(){if(!this._getTransformFlag(64)||!this._getTransformFlag(16)||!this._getTransformFlag(128)){this._setTransformFlag(208,!0),this.event("transformchanged",this._transformFlag);for(var t=0,e=this._children.length;t<e;t++)this._children[t]._onWorldPositionRotationTransform()}},e._onWorldScaleTransform=function(){if(!this._getTransformFlag(64)||!this._getTransformFlag(32)){this._setTransformFlag(96,!0),this.event("transformchanged",this._transformFlag);for(var t=0,e=this._children.length;t<e;t++)this._children[t]._onWorldPositionScaleTransform()}},e._onWorldTransform=function(){if(!(this._getTransformFlag(64)&&this._getTransformFlag(8)&&this._getTransformFlag(16)&&this._getTransformFlag(128)&&this._getTransformFlag(32))){this._setTransformFlag(248,!0),this.event("transformchanged",this._transformFlag);for(var t=0,e=this._children.length;t<e;t++)this._children[t]._onWorldTransform()}},e.translate=function(t,e){void 0===e&&(e=!0),e?(gt.createFromQuaternion(this.localRotation,a._tempMatrix0),ln.transformCoordinate(t,a._tempMatrix0,a._tempVector30),ln.add(this.localPosition,a._tempVector30,this._localPosition),this.localPosition=this._localPosition):(ln.add(this.position,t,this._position),this.position=this._position)},e.rotate=function(t,e,i){var n;void 0===e&&(e=!0),void 0===i&&(i=!0),n=i?t:(ln.scale(t,Math.PI/180,a._tempVector30),a._tempVector30),Qt.createFromYawPitchRoll(n.y,n.x,n.z,a._tempQuaternion0),e?(Qt.multiply(this._localRotation,a._tempQuaternion0,this._localRotation),this.localRotation=this._localRotation):(Qt.multiply(a._tempQuaternion0,this.rotation,this._rotation),this.rotation=this._rotation)},e.getForward=function(t){var e=this.worldMatrix.elements;t.x=-e[8],t.y=-e[9],t.z=-e[10]},e.getUp=function(t){var e=this.worldMatrix.elements;t.x=e[4],t.y=e[5],t.z=e[6]},e.getRight=function(t){var e=this.worldMatrix.elements;t.x=e[0],t.y=e[1],t.z=e[2]},e.lookAt=function(t,e,i){var n;if(void 0===i&&(i=!1),i){if(n=this._localPosition,Math.abs(n.x-t.x)<k.zeroTolerance&&Math.abs(n.y-t.y)<k.zeroTolerance&&Math.abs(n.z-t.z)<k.zeroTolerance)return;Qt.lookAt(this._localPosition,t,e,this._localRotation),this._localRotation.invert(this._localRotation),this.localRotation=this._localRotation}else{var r=this.position;if(n=r,Math.abs(n.x-t.x)<k.zeroTolerance&&Math.abs(n.y-t.y)<k.zeroTolerance&&Math.abs(n.z-t.z)<k.zeroTolerance)return;Qt.lookAt(r,t,e,this._rotation),this._rotation.invert(this._rotation),this.rotation=this._rotation}},g(0,e,"worldMatrix",function(){return this._getTransformFlag(64)&&(null!=this._parent?gt.multiply(this._parent.worldMatrix,this.localMatrix,this._worldMatrix):this.localMatrix.cloneTo(this._worldMatrix),this._setTransformFlag(64,!1)),this._worldMatrix},function(t){null===this._parent?t.cloneTo(this._localMatrix):(this._parent.worldMatrix.invert(this._localMatrix),gt.multiply(this._localMatrix,t,this._localMatrix)),this.localMatrix=this._localMatrix,this._worldMatrix!==t&&t.cloneTo(this._worldMatrix),this._setTransformFlag(64,!1)}),g(0,e,"rotationEuler",function(){if(this._getTransformFlag(128)){this.rotation.getYawPitchRoll(a._tempVector30);var t=a._tempVector30,e=this._rotationEuler;e.x=t.y*a._angleToRandin,e.y=t.x*a._angleToRandin,e.z=t.z*a._angleToRandin,this._setTransformFlag(128,!1)}return this._rotationEuler},function(t){Qt.createFromYawPitchRoll(t.y/a._angleToRandin,t.x/a._angleToRandin,t.z/a._angleToRandin,this._rotation),this.rotation=this._rotation,this._rotationEuler!==t&&t.cloneTo(this._rotationEuler),this._setTransformFlag(128,!1)}),g(0,e,"owner",function(){return this._owner}),g(0,e,"localMatrix",function(){return this._getTransformFlag(4)&&(this._updateLocalMatrix(),this._setTransformFlag(4,!1)),this._localMatrix},function(t){this._localMatrix!==t&&t.cloneTo(this._localMatrix),this._localMatrix.decomposeTransRotScale(this._localPosition,this._localRotation,this._localScale),this._setTransformFlag(4,!1),this._onWorldTransform()}),g(0,e,"localRotationEuler",function(){if(this._getTransformFlag(2)){this._localRotation.getYawPitchRoll(a._tempVector30);var t=a._tempVector30,e=this._localRotationEuler;e.x=t.y*a._angleToRandin,e.y=t.x*a._angleToRandin,e.z=t.z*a._angleToRandin,this._setTransformFlag(2,!1)}return this._localRotationEuler},function(t){this._localRotationEuler!==t&&t.cloneTo(this._localRotationEuler),this._setTransformFlag(2,!1),this._setTransformFlag(5,!0),this._onWorldRotationTransform()}),g(0,e,"localRotationEulerY",function(){return this.localRotationEuler.y},function(t){this._localRotationEuler.y=t,this.localRotationEuler=this._localRotationEuler}),g(0,e,"localRotationEulerX",function(){return this.localRotationEuler.x},function(t){this._localRotationEuler.x=t,this.localRotationEuler=this._localRotationEuler}),g(0,e,"rotation",function(){return this._getTransformFlag(16)&&(null!=this._parent?Qt.multiply(this._parent.rotation,this.localRotation,this._rotation):this.localRotation.cloneTo(this._rotation),this._setTransformFlag(16,!1)),this._rotation},function(t){null!=this._parent?(this._parent.rotation.invert(a._tempQuaternion0),Qt.multiply(a._tempQuaternion0,t,this._localRotation)):t.cloneTo(this._localRotation),this.localRotation=this._localRotation,t!==this._rotation&&t.cloneTo(this._rotation),this._setTransformFlag(16,!1)}),g(0,e,"localRotationEulerZ",function(){return this.localRotationEuler.z},function(t){this._localRotationEuler.z=t,this.localRotationEuler=this._localRotationEuler}),g(0,e,"localScaleZ",function(){return this._localScale.z},function(t){this._localScale.z=t,this.localScale=this._localScale}),g(0,e,"localScaleY",function(){return this._localScale.y},function(t){this._localScale.y=t,this.localScale=this._localScale}),g(0,e,"position",function(){if(this._getTransformFlag(8)){if(null!=this._parent){var t=this._parent.position;ln.multiply(this._localPosition,this._parent.scale,a._tempVector30),ln.transformQuat(a._tempVector30,this._parent.rotation,a._tempVector30),ln.add(t,a._tempVector30,this._position)}else this._localPosition.cloneTo(this._position);this._setTransformFlag(8,!1)}return this._position},function(t){if(null!=this._parent){ln.subtract(t,this._parent.position,this._localPosition);var e=this._parent.scale,i=e.x,n=e.y,r=e.z;if(1!==i||1!==n||1!==r){var s=a._tempVector30;s.x=1/i,s.y=1/n,s.z=1/r,ln.multiply(this._localPosition,s,this._localPosition)}this._parent.rotation.invert(a._tempQuaternion0),ln.transformQuat(this._localPosition,a._tempQuaternion0,this._localPosition)}else t.cloneTo(this._localPosition);this.localPosition=this._localPosition,this._position!==t&&t.cloneTo(this._position),this._setTransformFlag(8,!1)}),g(0,e,"localRotation",function(){if(this._getTransformFlag(1)){var t=this._localRotationEuler;Qt.createFromYawPitchRoll(t.y/a._angleToRandin,t.x/a._angleToRandin,t.z/a._angleToRandin,this._localRotation),this._setTransformFlag(1,!1)}return this._localRotation},function(t){this._localRotation!==t&&t.cloneTo(this._localRotation),this._localRotation.normalize(this._localRotation),this._setTransformFlag(6,!0),this._setTransformFlag(1,!1),this._onWorldRotationTransform()}),g(0,e,"localPositionX",function(){return this._localPosition.x},function(t){this._localPosition.x=t,this.localPosition=this._localPosition}),g(0,e,"localRotationW",function(){return this.localRotation.w},function(t){this._localRotation.w=t,this.localRotation=this._localRotation}),g(0,e,"localRotationY",function(){return this.localRotation.y},function(t){this._localRotation.y=t,this.localRotation=this._localRotation}),g(0,e,"localScale",function(){return this._localScale},function(t){this._localScale!==t&&t.cloneTo(this._localScale),this._setTransformFlag(4,!0),this._onWorldScaleTransform()}),g(0,e,"localPositionY",function(){return this._localPosition.y},function(t){this._localPosition.y=t,this.localPosition=this._localPosition}),g(0,e,"localPositionZ",function(){return this._localPosition.z},function(t){this._localPosition.z=t,this.localPosition=this._localPosition}),g(0,e,"localPosition",function(){return this._localPosition},function(t){this._localPosition!==t&&t.cloneTo(this._localPosition),this._setTransformFlag(4,!0),this._onWorldPositionTransform()}),g(0,e,"scale",function(){return this._getTransformFlag(32)&&(null!==this._parent?ln.multiply(this._parent.scale,this._localScale,this._scale):this._localScale.cloneTo(this._scale),this._setTransformFlag(32,!1)),this._scale},function(t){if(null!==this._parent){var e=this._parent.scale,i=a._tempVector30;i.x=1/e.x,i.y=1/e.y,i.z=1/e.z,ln.multiply(t,a._tempVector30,this._localScale)}else t.cloneTo(this._localScale);this.localScale=this._localScale,this._scale!==t&&t.cloneTo(this._scale),this._setTransformFlag(32,!1)}),g(0,e,"worldNeedUpdate",function(){return this._getTransformFlag(64)}),g(0,e,"localRotationX",function(){return this.localRotation.x},function(t){this._localRotation.x=t,this.localRotation=this._localRotation}),g(0,e,"localScaleX",function(){return this._localScale.x},function(t){this._localScale.x=t,this.localScale=this._localScale}),g(0,e,"localRotationZ",function(){return this.localRotation.z},function(t){this._localRotation.z=t,this.localRotation=this._localRotation}),g(0,e,"_isFrontFaceInvert",function(){var t=this.scale,e=t.x<0;return t.y<0&&(e=!e),t.z<0&&(e=!e),e}),a.TRANSFORM_LOCALQUATERNION=1,a.TRANSFORM_LOCALEULER=2,a.TRANSFORM_LOCALMATRIX=4,a.TRANSFORM_WORLDPOSITION=8,a.TRANSFORM_WORLDQUATERNION=16,a.TRANSFORM_WORLDSCALE=32,a.TRANSFORM_WORLDMATRIX=64,a.TRANSFORM_WORLDEULER=128,E(a,["_tempVector30",function(){return this._tempVector30=new ln},"_tempVector31",function(){return this._tempVector31=new ln},"_tempVector32",function(){return this._tempVector32=new ln},"_tempVector33",function(){return this._tempVector33=new ln},"_tempQuaternion0",function(){return this._tempQuaternion0=new Qt},"_tempMatrix0",function(){return this._tempMatrix0=new gt},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),a}(),nr=function(t){function S(){this._linkAvatarSpritesData={},this._keyframeNodeOwners=[],this._linkAvatarSprites=[],this._renderableSprites=[],this.cullingMode=2,S.__super.call(this),this._controllerLayers=[],this._linkSprites={},this._speed=1,this._keyframeNodeOwnerMap={},this._updateMark=0}I(S,"laya.d3.component.Animator",r);var e=S.prototype;return e._linkToSprites=function(t){for(var e in t){for(var i=this.owner,n=t[e],r=0,s=n.length;r<s;r++){var a=n[r];if(""===a)break;if(!(i=i.getChildByName(a)))break}i&&this.linkSprite3DToAvatarNode(e,i)}},e._addKeyframeNodeOwner=function(t,e,i){var n=e._indexInList,r=e.fullPath,s=this._keyframeNodeOwnerMap[r];if(s)s.referenceCount++,t[n]=s;else{for(var a=i,o=0,h=e.propertyCount;o<h&&(a=a[e.getPropertyByIndex(o)]);o++);(s=this._keyframeNodeOwnerMap[r]=new Ne).fullPath=r,s.indexInList=this._keyframeNodeOwners.length,s.referenceCount=1,s.propertyOwner=i;var l=e.propertyCount,u=P(l);for(o=0;o<l;o++)u[o]=e.getPropertyByIndex(o);if(s.property=u,s.type=e.type,a)if(0===e.type)s.defaultValue=a;else{var c=new a.constructor;a.cloneTo(c),s.defaultValue=c}this._keyframeNodeOwners.push(s),t[n]=s}},e._removeKeyframeNodeOwner=function(t,e){var i=e.fullPath,n=this._keyframeNodeOwnerMap[i];n&&(n.referenceCount--,0===n.referenceCount&&(delete this._keyframeNodeOwnerMap[i],this._keyframeNodeOwners.splice(this._keyframeNodeOwners.indexOf(n),1)),t[e._indexInList]=null)},e._getOwnersByClip=function(t){var e=t._clip._nodes,i=e.count,n=t._nodeOwners;n.length=i;for(var r=0;r<i;r++){for(var s=e.getNodeByIndex(r),a=this._avatar?this._avatarNodeMap[this._avatar._rootNode.name]:this.owner,o=0,h=s.ownerPathCount;o<h;o++){var l=s.getOwnerPathByIndex(o);if(""===l)break;if(!(a=a.getChildByName(l)))break}if(a){var u=s.propertyOwner;u&&(a=a[u]),a&&this._addKeyframeNodeOwner(n,s,a)}}},e._updatePlayer=function(t,e,i,n){var r=t._clip._duration*(t.clipEnd-t.clipStart),s=e._elapsedTime,a=s+i;e._lastElapsedTime=s;var o=(e._elapsedTime=a)/r,h=(e._normalizedTime=o)%1;e._normalizedPlayTime=h<0?h+1:h,e._duration=r;var l=t._scripts;if(!n&&r<=a){if(e._finish=!0,e._elapsedTime=r,e._normalizedPlayTime=1,l)for(var u=0,c=l.length;u<c;u++)l[u].onStateExit()}else if(l)for(u=0,c=l.length;u<c;u++)l[u].onStateUpdate()},e._eventScript=function(t,e,i,n,r){if(r)for(var s=e.length;i<s;i++){var a=e[i];if(!(a.time<=n))break;for(var o=0,h=t.length;o<h;o++){var l=t[o],u=l[a.eventName];u&&u.apply(l,a.params)}}else for(;0<=i&&(a=e[i]).time>=n;i--)for(o=0,h=t.length;o<h;o++)(u=(l=t[o])[a.eventName])&&u.apply(l,a.params);return i},e._updateEventScript=function(t,e){var i=this.owner._scripts;if(i){var n=t._clip,r=n._events,s=n._duration,a=e._elapsedTime,o=a%s,h=Math.abs(Math.floor(a/s)-Math.floor(e._lastElapsedTime/s)),l=e._elapsedTime>=e._lastElapsedTime;if(e._lastIsFront!==l&&(l?e._playEventIndex++:e._playEventIndex--,e._lastIsFront=l),0==h)e._playEventIndex=this._eventScript(i,r,e._playEventIndex,o,l);else if(l){this._eventScript(i,r,e._playEventIndex,s,!0);for(var u=0,c=h-1;u<c;u++)this._eventScript(i,r,0,s,!0);e._playEventIndex=this._eventScript(i,r,0,o,!0)}else{this._eventScript(i,r,e._playEventIndex,0,!1);var _=r.length-1;for(u=0,c=h-1;u<c;u++)this._eventScript(i,r,_,0,!1);e._playEventIndex=this._eventScript(i,r,_,o,!1)}}},e._updateClipDatas=function(t,e,i,n){var r=t._clip,s=r._duration,a=t.clipStart*s+i._normalizedPlayTime*i._duration,o=t._currentFrameIndices,h=i._elapsedTime>i._lastElapsedTime;r._evaluateClipDatasRealTime(r._nodes,a,o,e,h)},e._applyFloat=function(t,e,i,n,r,s,a){if(i.updateMark===this._updateMark)if(n)t[e]+=r*a;else{var o=t[e];t[e]=o+r*(a-o)}else if(s)t[e]=n?i.defaultValue+a:a;else if(n)t[e]=i.defaultValue+r*a;else{var h=i.defaultValue;t[e]=h+r*(a-h)}},e._applyPositionAndRotationEuler=function(t,e,i,n,r,s){if(t.updateMark===this._updateMark)if(e)s.x+=i*r.x,s.y+=i*r.y,s.z+=i*r.z;else{var a=s.x,o=s.y,h=s.z;s.x=a+i*(r.x-a),s.y=o+i*(r.y-o),s.z=h+i*(r.z-h)}else if(n)if(e){var l=t.defaultValue;s.x=l.x+r.x,s.y=l.y+r.y,s.z=l.z+r.z}else s.x=r.x,s.y=r.y,s.z=r.z;else if(l=t.defaultValue,e)s.x=l.x+i*r.x,s.y=l.y+i*r.y,s.z=l.z+i*r.z;else{var u=l.x,c=l.y,_=l.z;s.x=u+i*(r.x-u),s.y=c+i*(r.y-c),s.z=_+i*(r.z-_)}},e._applyRotation=function(t,e,i,n,r,s){if(t.updateMark===this._updateMark)if(e){var a=S._tempQuaternion1;V.quaternionWeight(r,i,a),a.normalize(a),Qt.multiply(s,a,s)}else Qt.lerp(s,r,i,s);else if(n)if(e){var o=t.defaultValue;Qt.multiply(o,r,s)}else s.x=r.x,s.y=r.y,s.z=r.z,s.w=r.w;else o=t.defaultValue,e?(a=S._tempQuaternion1,V.quaternionWeight(r,i,a),a.normalize(a),Qt.multiply(o,a,s)):Qt.lerp(o,r,i,s)},e._applyScale=function(t,e,i,n,r,s){if(t.updateMark===this._updateMark)if(e){var a=S._tempVector31;V.scaleWeight(r,i,a),s.x=s.x*a.x,s.y=s.y*a.y,s.z=s.z*a.z}else V.scaleBlend(s,r,i,s);else if(n)if(e){var o=t.defaultValue;s.x=o.x*r.x,s.y=o.y*r.y,s.z=o.z*r.z}else s.x=r.x,s.y=r.y,s.z=r.z;else o=t.defaultValue,e?(a=S._tempVector31,V.scaleWeight(r,i,a),s.x=o.x*a.x,s.y=o.y*a.y,s.z=o.z*a.z):V.scaleBlend(o,r,i,s)},e._applyCrossData=function(t,e,i,n,r,s,a){var o=t.propertyOwner;if(o){switch(t.type){case 0:for(var h=t.property,l=h.length-1,u=0;u<l&&(o=o[h[u]]);u++);var c=r+a*(s-r);this._applyFloat(o,h[l],t,e,i,n,c);break;case 1:var _=o.localPosition,d=S._tempVector30,f=r.x,p=r.y,m=r.z;d.x=f+a*(s.x-f),d.y=p+a*(s.y-p),d.z=m+a*(s.z-m),this._applyPositionAndRotationEuler(t,e,i,n,d,_),o.localPosition=_;break;case 2:var g=o.localRotation,v=S._tempQuaternion0;Qt.lerp(r,s,a,v),this._applyRotation(t,e,i,n,v,g),o.localRotation=g;break;case 3:var T=o.localScale,y=S._tempVector30;V.scaleBlend(r,s,a,y),this._applyScale(t,e,i,n,y,T),o.localScale=T;break;case 4:var E=o.localRotationEuler,x=S._tempVector30;f=r.x,p=r.y,m=r.z,x.x=f+a*(s.x-f),x.y=p+a*(s.y-p),x.z=m+a*(s.z-m),this._applyPositionAndRotationEuler(t,e,i,n,x,E),o.localRotationEuler=E}t.updateMark=this._updateMark}},e._setClipDatasToNode=function(t,e,i,n){for(var r=t._clip._nodes,s=t._nodeOwners,a=0,o=r.count;a<o;a++){var h=s[a];if(h){var l=h.propertyOwner;if(l){switch(h.type){case 0:for(var u=h.property,c=u.length-1,_=0;_<c&&(l=l[u[_]]);_++);this._applyFloat(l,u[c],h,e,i,n,r.getNodeByIndex(a).data);break;case 1:var d=l.localPosition;this._applyPositionAndRotationEuler(h,e,i,n,r.getNodeByIndex(a).data,d),l.localPosition=d;break;case 2:var f=l.localRotation;this._applyRotation(h,e,i,n,r.getNodeByIndex(a).data,f),l.localRotation=f;break;case 3:var p=l.localScale;this._applyScale(h,e,i,n,r.getNodeByIndex(a).data,p),l.localScale=p;break;case 4:var m=l.localRotationEuler;this._applyPositionAndRotationEuler(h,e,i,n,r.getNodeByIndex(a).data,m),l.localRotationEuler=m}h.updateMark=this._updateMark}}}},e._setCrossClipDatasToNode=function(t,e,i,n,r){for(var s=t._crossNodesOwners,a=t._crossNodesOwnersCount,o=t.blendingMode!==_t.BLENDINGMODE_OVERRIDE,h=t.defaultWeight,l=t._destCrossClipNodeIndices,u=i._clip._nodes,c=i._nodeOwners,_=t._srcCrossClipNodeIndices,d=e._nodeOwners,f=e._clip._nodes,p=0;p<a;p++){var m=s[p];if(m){var g=_[p],v=l[p],T=-1!==g?f.getNodeByIndex(g).data:c[v].defaultValue,y=-1!==v?u.getNodeByIndex(v).data:d[g].defaultValue;this._applyCrossData(m,o,h,r,T,y,n)}}},e._setFixedCrossClipDatasToNode=function(t,e,i,n){for(var r=t._crossNodesOwners,s=t._crossNodesOwnersCount,a=t.blendingMode!==_t.BLENDINGMODE_OVERRIDE,o=t.defaultWeight,h=t._destCrossClipNodeIndices,l=e._clip._nodes,u=0;u<s;u++){var c=r[u];if(c){var _=h[u],d=c.crossFixedValue,f=-1!==_?l.getNodeByIndex(_).data:c.defaultValue;this._applyCrossData(c,a,o,n,d,f,i)}}},e._revertDefaultKeyframeNodes=function(t){for(var e=t._nodeOwners,i=0,n=e.length;i<n;i++){var r=e[i];if(r){var s=r.propertyOwner;if(s)switch(r.type){case 0:for(var a=r.property,o=a.length-1,h=0;h<o&&(s=s[a[h]]);h++);s[a[o]]=r.defaultValue;break;case 1:var l=s.localPosition,u=r.defaultValue;l.x=u.x,l.y=u.y,l.z=u.z,s.localPosition=l;break;case 2:var c=s.localRotation,_=r.defaultValue;c.x=_.x,c.y=_.y,c.z=_.z,c.w=_.w,s.localRotation=c;break;case 3:var d=s.localScale;u=r.defaultValue,d.x=u.x,d.y=u.y,d.z=u.z,s.localScale=d;break;case 4:var f=s.localRotationEuler;u=r.defaultValue,f.x=u.x,f.y=u.y,f.z=u.z,s.localRotationEuler=f;break;default:throw"Animator:unknown type."}}}},e._removeClip=function(t,e,i,n){var r=n._clip;r._removeReference(),t.splice(i,1),delete e[n.name];for(var s=t[i],a=r._nodes,o=s._nodeOwners,h=0,l=a.count;h<l;h++)this._removeKeyframeNodeOwner(o,a.getNodeByIndex(h))},e._onAdded=function(){var t=this.owner._parent;this.owner._setHierarchyAnimator(this,t?t._hierarchyAnimator:null),this.owner._changeAnimatorToLinkSprite3DNoAvatar(this,!0,[])},e._onDestroy=function(){for(var t=0,e=this._controllerLayers.length;t<e;t++)for(var i=this._controllerLayers[t]._states,n=0,r=i.length;n<r;n++)i[n]._clip._removeReference();var s=this.owner._parent;this.owner._clearHierarchyAnimator(this,s?s._hierarchyAnimator:null)},e._onEnableInScene=function(){this.owner._scene._animatorPool.add(this)},e._onDisableInScene=function(){this.owner._scene._animatorPool.remove(this)},e._onEnable=function(){for(var t=0,e=this._controllerLayers.length;t<e;t++){if(this._controllerLayers[t].playOnWake)this.getDefaultState(t)&&this.play(null,t,0)}},e._handleSpriteOwnersBySprite=function(t,e,i){for(var n=0,r=this._controllerLayers.length;n<r;n++)for(var s=this._controllerLayers[n]._states,a=0,o=s.length;a<o;a++){var h=s[a],l=h._clip,u=e.join("/"),c=l._nodesMap[u];if(c)for(var _=h._nodeOwners,d=0,f=c.length;d<f;d++)t?this._addKeyframeNodeOwner(_,c[d],i):this._removeKeyframeNodeOwner(_,c[d])}},e._parse=function(t){var e=t.avatar;if(e){this.avatar=Hn.getRes(e.path);var i=e.linkSprites;this._linkSprites=i,this._linkToSprites(i)}t.clipPaths;for(var n=t.playOnWake,r=t.layers,s=0;s<r.length;s++){var a=r[s],o=new _t(a.name);o.defaultWeight=0===s?1:a.weight;var h=a.blendingMode;h&&(o.blendingMode=h),this.addControllerLayer(o);for(var l=a.states,u=0,c=l.length;u<c;u++){var _=l[u],d=_.clipPath;if(d){var f,p=_.name;if(f=Hn.getRes(d)){var m=new Le;m.name=p,m.clip=f,this.addState(m,s),0===u&&(this.getControllerLayer(s).defaultState=m)}}}void 0!==n&&(o.playOnWake=n)}var g=t.cullingMode;void 0!==g&&(this.cullingMode=g)},e._update=function(){if(0!==this._speed){var t=!1;if(2===this.cullingMode){t=!1;for(var e=0,i=this._renderableSprites.length;e<i;e++)if(this._renderableSprites[e]._render._visible){t=!0;break}}else t=!0;this._updateMark++;var n=this.owner._scene.timer,r=n._delta/1e3,s=n.scale;for(e=0,i=this._controllerLayers.length;e<i;e++){var a=this._controllerLayers[e],o=a._playStateInfo,h=a._crossPlayStateInfo;switch(d=a.blendingMode!==_t.BLENDINGMODE_OVERRIDE,a._playType){case 0:var l=a._currentPlayState,u=l._clip,c=this._speed*l.speed,_=o._finish;if(_||this._updatePlayer(l,o,r*c,u.islooping),t){var d=a.blendingMode!==_t.BLENDINGMODE_OVERRIDE;this._updateClipDatas(l,d,o,s*c),this._setClipDatasToNode(l,d,a.defaultWeight,0===e),_||this._updateEventScript(l,o)}break;case 1:u=(l=a._currentPlayState)._clip;var f=a._crossPlayState,p=f._clip,m=a._crossDuration,g=h._startPlayTime,v=p._duration-g,T=v<m?v/m:1,y=this._speed*f.speed;this._updatePlayer(f,h,r*T*y,p.islooping);var E=(h._elapsedTime-g)/T/m;1<=E?t&&(this._updateClipDatas(f,d,h,s*y),this._setClipDatasToNode(f,d,a.defaultWeight,0===e),a._playType=0,a._currentPlayState=f,h._cloneTo(o)):(o._finish||(c=this._speed*l.speed,this._updatePlayer(l,o,r*c,u.islooping),t&&this._updateClipDatas(l,d,o,s*c)),t&&(this._updateClipDatas(f,d,h,s*T*y),this._setCrossClipDatasToNode(a,l,f,E,0===e))),t&&(this._updateEventScript(l,o),this._updateEventScript(f,h));break;case 2:p=(f=a._crossPlayState)._clip,m=a._crossDuration,g=h._startPlayTime,T=(v=p._duration-g)<m?v/m:1,y=this._speed*f.speed,this._updatePlayer(f,h,r*T*y,p.islooping),t&&(1<=(E=(h._elapsedTime-g)/T/m)?(this._updateClipDatas(f,d,h,s*y),this._setClipDatasToNode(f,d,1,0===e),a._playType=0,a._currentPlayState=f,h._cloneTo(o)):(this._updateClipDatas(f,d,h,s*T*y),this._setFixedCrossClipDatasToNode(a,f,E,0===e)),this._updateEventScript(f,h))}}t&&this._avatar&&(qi.supportWebGLPlusAnimation&&this._updateAnimationNodeWorldMatix(this._animationNodeLocalPositions,this._animationNodeLocalRotations,this._animationNodeLocalScales,this._animationNodeWorldMatrixs,this._animationNodeParentIndices),this._updateAvatarNodesToSprite())}},e._cloneTo=function(t){var e=t;e.avatar=this.avatar;for(var i=0,n=this._controllerLayers.length;i<n;i++){var r=this._controllerLayers[i];e.addControllerLayer(r.clone());for(var s=r._states,a=0,o=s.length;a<o;a++){var h=s[a].clone();e.addState(h,i),0==a&&(e.getControllerLayer(i).defaultState=h)}}e._linkSprites=this._linkSprites,e._linkToSprites(this._linkSprites)},e.getDefaultState=function(t){return void 0===t&&(t=0),this._controllerLayers[t].defaultState},e.addState=function(t,e){void 0===e&&(e=0);var i=t.name,n=this._controllerLayers[e],r=n._statesMap,s=n._states;if(r[i])throw"Animator:this stat's name has exist.";r[i]=t,s.push(t),t._clip._addReference(),this._getOwnersByClip(t)},e.removeState=function(t,e){void 0===e&&(e=0);for(var i=this._controllerLayers[e],n=i._states,r=i._statesMap,s=-1,a=0,o=n.length;a<o;a++)if(n[a]===t){s=a;break}-1!==s&&this._removeClip(n,r,s,t)},e.addControllerLayer=function(t){this._controllerLayers.push(t)},e.getControllerLayer=function(t){return void 0===t&&(t=0),this._controllerLayers[t]},e.getCurrentAnimatorPlayState=function(t){return void 0===t&&(t=0),this._controllerLayers[t]._playStateInfo},e.play=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=Number.NEGATIVE_INFINITY);var n=this._controllerLayers[e],r=n.defaultState;if(!t&&!r)throw new Error("Animator:must have  default clip value,please set clip property.");var s=n._currentPlayState,a=n._playStateInfo,o=t?n._statesMap[t]:r,h=o._clip._duration;s!==o?(i!==Number.NEGATIVE_INFINITY?a._resetPlayState(h*i):a._resetPlayState(0),null!==s&&s!==o&&this._revertDefaultKeyframeNodes(s),n._playType=0,n._currentPlayState=o):i!==Number.NEGATIVE_INFINITY&&(a._resetPlayState(h*i),n._playType=0);var l=o._scripts;if(l)for(var u=0,c=l.length;u<c;u++)l[u].onStateEnter()},e.crossFade=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=Number.NEGATIVE_INFINITY);var r=this._controllerLayers[i],s=r._statesMap[t];if(s){var a=r._playType;if(-1===a)return void this.play(t,i,n);var o=r._crossPlayStateInfo,h=r._crossNodesOwners,l=r._crossNodesOwnersIndicesMap,u=r._currentPlayState,c=s._nodeOwners,_=r._destCrossClipNodeIndices,d=s._clip,f=d._nodes,p=d._nodesDic;switch(a){case 0:var m=u._nodeOwners,g=r._srcCrossClipNodeIndices,v=u._clip,T=v._nodes,y=v._nodesDic;r._playType=1;for(var E=++r._crossMark,x=r._crossNodesOwnersCount=0,S=0,C=T.count;S<C;S++){var I=T.getNodeByIndex(S),R=I._indexInList,A=m[R];if(A){var M=I.fullPath;g[x]=R;var D=p[M];_[x]=D?D._indexInList:-1,l[M]=E,h[x]=A,x++}}for(S=0,C=f.count;S<C;S++){var b=(D=f.getNodeByIndex(S))._indexInList,w=c[b];if(w){var L=D.fullPath;y[L]||(g[x]=-1,_[x]=b,l[L]=E,h[x]=w,x++)}}break;case 1:case 2:for(r._playType=2,S=0,C=h.length;S<C;S++){var O=h[S];O.saveCrossFixedValue(),D=p[O.fullPath],_[S]=D?D._indexInList:-1}for(x=r._crossNodesOwnersCount,E=r._crossMark,S=0,C=f.count;S<C;S++)(w=c[b=(D=f.getNodeByIndex(S))._indexInList])&&l[L=D.fullPath]!==E&&(_[x]=b,l[L]=E,O=c[b],(h[x]=O).saveCrossFixedValue(),x++)}r._crossNodesOwnersCount=x,r._crossPlayState=s,r._crossDuration=u._clip._duration*e,n!==Number.NEGATIVE_INFINITY?o._resetPlayState(d._duration*n):o._resetPlayState(0)}var N=s._scripts;if(N)for(S=0,C=N.length;S<C;S++)N[S].onStateEnter()},e._getAvatarOwnersAndInitDatasAsync=function(){for(var t=0,e=this._controllerLayers.length;t<e;t++)for(var i=this._controllerLayers[t]._states,n=0,r=i.length;n<r;n++)this._getOwnersByClip(i[n]);for(var s in this._avatar._cloneDatasToAnimator(this),this._linkAvatarSpritesData){var a=this._linkAvatarSpritesData[s];if(a)for(var o=0,h=a.length;o<h;o++)this._isLinkSpriteToAnimationNode(a[o],s,!0)}},e._isLinkSpriteToAnimationNode=function(t,e,i){if(this._avatar){var n=this._avatarNodeMap[e];if(n)if(i){t._transform._dummy=n.transform,this._linkAvatarSprites.push(t);var r=n.transform,s=t.transform;if(!s.owner.isStatic&&r){var a=s.worldMatrix,o=this.owner._transform._parent;if(o)V.matrix4x4MultiplyMFM(o.worldMatrix,r.getWorldMatrix(),a);else for(var h=a.elements,l=r.getWorldMatrix(),u=0;u<16;u++)h[u]=l[u];s.worldMatrix=a}}else t._transform._dummy=null,this._linkAvatarSprites.splice(this._linkAvatarSprites.indexOf(t),1)}},e._isLinkSpriteToAnimationNodeData=function(t,e,i){var n=this._linkAvatarSpritesData[e];i?(n||(this._linkAvatarSpritesData[e]=n=[]),n.push(t)):n.splice(t,1)},e._updateAvatarNodesToSprite=function(){for(var t=0,e=this._linkAvatarSprites.length;t<e;t++){var i=this._linkAvatarSprites[t],n=i.transform._dummy,r=i.transform;if(!r.owner.isStatic&&n){var s=r.worldMatrix,a=this.owner._transform;V.matrix4x4MultiplyMFM(a.worldMatrix,n.getWorldMatrix(),s),r.worldMatrix=s}}},e.linkSprite3DToAvatarNode=function(t,e){return this._isLinkSpriteToAnimationNodeData(e,t,!0),this._isLinkSpriteToAnimationNode(e,t,!0),!0},e.unLinkSprite3DToAvatarNode=function(t){if(t._hierarchyAnimator!==this)throw"Animator:sprite3D must belong to this Animator";var e=t.transform._dummy;if(e){var i=e._owner.name;return this._isLinkSpriteToAnimationNodeData(t,i,!1),this._isLinkSpriteToAnimationNode(t,i,!1),!0}return!1},e._updateAnimationNodeWorldMatix=function(t,e,i,n,r){Nt.instance.updateAnimationNodeWorldMatix(t,e,i,r,n)},g(0,e,"avatar",function(){return this._avatar},function(t){if(this._avatar!==t)if(this._avatar=t)this._getAvatarOwnersAndInitDatasAsync(),this.owner._changeHierarchyAnimatorAvatar(this,t);else{var e=this.owner._parent;this.owner._changeHierarchyAnimatorAvatar(this,e?e._hierarchyAnimator._avatar:null)}}),g(0,e,"speed",function(){return this._speed},function(t){this._speed=t}),S._update=function(t){for(var e=t._animatorPool,i=e.elements,n=0,r=e.length;n<r;n++){var s=i[n];s&&s.enabled&&s._update()}},S._tempVector3Array0=new Float32Array(3),S._tempVector3Array1=new Float32Array(3),S._tempQuaternionArray0=new Float32Array(4),S._tempQuaternionArray1=new Float32Array(4),S.CULLINGMODE_ALWAYSANIMATE=0,S.CULLINGMODE_CULLCOMPLETELY=2,E(S,["_tempVector30",function(){return this._tempVector30=new ln},"_tempVector31",function(){return this._tempVector31=new ln},"_tempQuaternion0",function(){return this._tempQuaternion0=new Qt},"_tempQuaternion1",function(){return this._tempQuaternion1=new Qt}]),S}(),rr=function(t){function a(t){void 0===t&&(t=1e4),a.__super.call(this,t)}I(a,"laya.webgl.submit.SubmitTexture",yt);var e=a.prototype;return e.clone=function(t,e,i){var n=a._poolSize?a.POOL[--a._poolSize]:new a;return this._cloneInit(n,t,e,i),n},e.releaseRender=function(){--this._ref<1&&((a.POOL[a._poolSize++]=this).shaderValue.release(),this._mesh=null,this._parent&&(this._parent.releaseRender(),this._parent=null))},e.renderSubmit=function(){if(0===this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t?t._getSource():null;if(!e)return 1}var i=en.mainContext;this._mesh.useMesh(i);var n=yt.preRender,r=yt.preRender._key;return 0===this._key.blendShader&&this._key.submitType===r.submitType&&this._key.blendShader===r.blendShader&&rs.activeShader&&yt.preRender.clipInfoID==this.clipInfoID&&n.shaderValue.defines._value===this.shaderValue.defines._value&&0==(this.shaderValue.defines._value&er.NOOPTMASK)?rs.activeShader.uploadTexture2D(e):(cn.activeBlendFunction!==this._blendFn&&(j.setBlend(i,!0),this._blendFn(i),cn.activeBlendFunction=this._blendFn),this.shaderValue.texture=e,this.shaderValue.upload()),i.drawElements(4,this._numEle,5123,this._startIdx),$i.renderBatches++,$i.trianglesFaces+=this._numEle/3,1},a.create=function(t,e,i){var n=a._poolSize?a.POOL[--a._poolSize]:new a(10016);n._mesh=e,n._key.clear(),n._key.submitType=2,n._ref=1,n._startIdx=e.indexNum*$e.BYTES_PIDX,n._numEle=0;var r=t._nBlendType;if(n._key.blendShader=r,n._blendFn=t._targets?cn.targetFns[r]:cn.fns[r],n.shaderValue=i,t._colorFiler){var s=t._colorFiler;i.defines.add(s.type),i.colorMat=s._mat,i.colorAlpha=s._alpha}return n},a._poolSize=0,a.POOL=[],a}(),sr=function(t){function e(t){e.__super.call(this),void 0===t&&(t=.5),this._radius=t,this._type=1,this._nativeShape=new In._physics3D.btSphereShape(t)}I(e,"laya.d3.physics.shape.SphereColliderShape",J);var i=e.prototype;return i.clone=function(){var t=new e(this._radius);return this.cloneTo(t),t},g(0,i,"radius",function(){return this._radius}),e}(),ar=(function(t){function e(){e.__super.call(this)}I(e,"laya.media.Sound",o);var i=e.prototype;i.load=function(t){},i.play=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),null},i.dispose=function(){},g(0,i,"duration",function(){return 0})}(),function(i){function e(){this._mesh=null,this._convex=!1,e.__super.call(this)}I(e,"laya.d3.physics.shape.MeshColliderShape",i);var t=e.prototype;return t._setScale=function(t){this._compoundParent?this.updateLocalTransformations():(J._nativeScale.setValue(t.x,t.y,t.z),this._nativeShape.setLocalScaling(J._nativeScale),this._nativeShape.updateBound())},t.cloneTo=function(t){var e=t;e.convex=this._convex,e.mesh=this._mesh,i.prototype.cloneTo.call(this,t)},t.clone=function(){var t=new e;return this.cloneTo(t),t},t.destroy=function(){this._nativeShape&&(In._physics3D.destroy(this._nativeShape),this._nativeShape=null)},g(0,t,"convex",function(){return this._convex},function(t){this._convex=t}),g(0,t,"mesh",function(){return this._mesh},function(t){if(this._mesh!==t){var e=In._physics3D;this._mesh&&e.destroy(this._nativeShape),t&&(this._nativeShape=new e.btGImpactMeshShape(t._getPhysicMesh()),this._nativeShape.updateBound()),this._mesh=t}}),e}(J)),or=function(t){function i(){i.__super.call(this,24,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshQuadTexture._fixattriInfo),laya.webgl.utils.MeshQuadTexture._fixib?(this._ib=laya.webgl.utils.MeshQuadTexture._fixib,this._quadNum=i._maxIB):(this.createQuadIB(i._maxIB),laya.webgl.utils.MeshQuadTexture._fixib=this._ib)}I(i,"laya.webgl.utils.MeshQuadTexture",Dt);var e=i.prototype;return e.releaseMesh=function(){this._vb.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshQuadTexture._POOL.push(this)},e.destroy=function(){this._vb.destroy(),this._vb.deleteBuffer()},e.addQuad=function(t,e,i,n){var r=this._vb,s=r._byteLength>>2;r.setByteLength(s+24<<2);var a=r._floatArray32||r.getFloat32Array(),o=r._uint32Array,h=s,l=n?255:0;a[h++]=t[0],a[h++]=t[1],a[h++]=e[0],a[h++]=e[1],o[h++]=i,o[h++]=l,a[h++]=t[2],a[h++]=t[3],a[h++]=e[2],a[h++]=e[3],o[h++]=i,o[h++]=l,a[h++]=t[4],a[h++]=t[5],a[h++]=e[4],a[h++]=e[5],o[h++]=i,o[h++]=l,a[h++]=t[6],a[h++]=t[7],a[h++]=e[6],a[h++]=e[7],o[h++]=i,o[h++]=l,r._upload=!0},i.getAMesh=function(t){var e=null;return e=laya.webgl.utils.MeshQuadTexture._POOL.length?laya.webgl.utils.MeshQuadTexture._POOL.pop():new i,t&&e._vb._resizeBuffer(1572864,!1),e},i.const_stride=24,i._fixib=null,i._maxIB=16384,i._POOL=[],E(i,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]}]),i}(),hr=function(t){function e(t){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,void 0===t&&(t=0),e.__super.call(this,1,t),this._attribLocation=["posuv",0,"attribColor",1,"attribFlags",2]}return I(e,"laya.webgl.shader.d2.value.TextureSV",Ot),e.prototype.clear=function(){this.texture=null,this.shader=null,this.defines._value=this.subID+(en.shaderHighPrecision?1024:0)},e}(),lr=function(e){function Y(t){Y.__super.call(this),this._tempRotationMatrix=new gt,this._uvLength=new un,this._bufferState=new Mr,this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._owner=t,this._ownerRender=t.particleRenderer,this._boundingBoxCorners=P(8,null),this._boundingSphere=new Ft(new ln,Number.MAX_VALUE),this._boundingBox=new Qe(new ln(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),new ln(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)),this._currentTime=0,this._isEmitting=!1,this._isPlaying=!1,this._isPaused=!1,this._burstsIndex=0,this._frameRateTime=0,this._emissionTime=0,this._totalDelayTime=0,this._simulateUpdate=!1,this._bufferMaxParticles=1,this.duration=5,this.looping=!0,this.prewarm=!1,this.startDelayType=0,this.startDelay=0,this.startDelayMin=0,this.startDelayMax=0,this._startLifetimeType=0,this._startLifetimeConstant=5,this._startLifeTimeGradient=new yn,this._startLifetimeConstantMin=0,this._startLifetimeConstantMax=5,this._startLifeTimeGradientMin=new yn,this._startLifeTimeGradientMax=new yn,this._maxStartLifetime=5,this.startSpeedType=0,this.startSpeedConstant=5,this.startSpeedConstantMin=0,this.startSpeedConstantMax=5,this.threeDStartSize=!1,this.startSizeType=0,this.startSizeConstant=1,this.startSizeConstantSeparate=new ln(1,1,1),this.startSizeConstantMin=0,this.startSizeConstantMax=1,this.startSizeConstantMinSeparate=new ln(0,0,0),this.startSizeConstantMaxSeparate=new ln(1,1,1),this.threeDStartRotation=!1,this.startRotationType=0,this.startRotationConstant=0,this.startRotationConstantSeparate=new ln(0,0,0),this.startRotationConstantMin=0,this.startRotationConstantMax=0,this.startRotationConstantMinSeparate=new ln(0,0,0),this.startRotationConstantMaxSeparate=new ln(0,0,0),this.randomizeRotationDirection=0,this.startColorType=0,this.startColorConstant=new on(1,1,1,1),this.startColorConstantMin=new on(1,1,1,1),this.startColorConstantMax=new on(1,1,1,1),this.gravityModifier=0,this.simulationSpace=1,this.scaleMode=0,this.playOnAwake=!0,this._rand=new kt(0),this.autoRandomSeed=!0,this.randomSeed=new Uint32Array(1),this._randomSeeds=new Uint32Array(Y._RANDOMOFFSET.length),this.isPerformanceMode=!0,this._emission=new G,this._emission.enbale=!0}I(Y,"laya.d3.core.particleShuriKen.ShurikenParticleSystem",e);var t=Y.prototype;return T.imps(t,{"laya.d3.core.IClone":!0}),t._getVertexBuffer=function(t){return void 0===t&&(t=0),0===t?this._vertexBuffer:null},t._getIndexBuffer=function(){return this._indexBuffer},t._generateBoundingSphere=function(){var t=this._boundingSphere.center;t.x=0,t.y=0,t.z=0,this._boundingSphere.radius=Number.MAX_VALUE},t._generateBoundingBox=function(){var t=this._owner.particleRenderer,e=this._boundingBox.min,i=this._boundingBox.max,n=0,r=0,s=NaN;switch(this.startLifetimeType){case 0:s=this.startLifetimeConstant;break;case 1:s=-Number.MAX_VALUE;var a=a;for(n=0,r=a.gradientCount;n<r;n++)s=Math.max(s,a.getValueByIndex(n));break;case 2:s=Math.max(this.startLifetimeConstantMin,this.startLifetimeConstantMax);break;case 3:s=-Number.MAX_VALUE;var o=o;for(n=0,r=o.gradientCount;n<r;n++)s=Math.max(s,o.getValueByIndex(n));var h=h;for(n=0,r=h.gradientCount;n<r;n++)s=Math.max(s,h.getValueByIndex(n))}var l,u,c,_,d=NaN,f=NaN;switch(this.startSpeedType){case 0:d=f=this.startSpeedConstant;break;case 1:break;case 2:d=this.startLifetimeConstantMin,f=this.startLifetimeConstantMax}this._shape&&this._shape.enable||(l=u=ln._ZERO,c=ln._ZERO,_=ln._UnitZ);var p,m,g=new ln(c.x*d,c.y*d,c.z*d),v=new ln(_.x*f,_.y*f,_.z*f);if(this._velocityOverLifetime&&this._velocityOverLifetime.enbale){var T=this._velocityOverLifetime.velocity;switch(T.type){case 0:T.constant;break;case 1:new ln(T.gradientX.getAverageValue(),T.gradientY.getAverageValue(),T.gradientZ.getAverageValue());break;case 2:T.constantMin,T.constantMax;break;case 3:new ln(T.gradientXMin.getAverageValue(),T.gradientYMin.getAverageValue(),T.gradientZMin.getAverageValue()),new ln(T.gradientXMax.getAverageValue(),T.gradientYMax.getAverageValue(),T.gradientZMax.getAverageValue())}}var y,E,x=this._owner.transform,S=x.position,C=Y._tempVector39,I=t.renderMode;switch(this.scaleMode){case 0:var R=x.scale;p=R,C.x=R.x,C.y=R.z,C.z=R.y,1===I&&(m=R);break;case 1:var A=x.localScale;p=A,C.x=A.x,C.y=A.z,C.z=A.y,1===I&&(m=A);break;case 2:p=x.scale,C.x=C.y=C.z=1,1===I&&(m=ln._ONE)}switch(this._velocityOverLifetime&&this._velocityOverLifetime.enbale||(y=new ln(g.x*s,g.y*s,g.z*s),E=new ln(v.x*s,v.y*s,v.z*s),2!=this.scaleMode?(ln.add(l,y,e),ln.multiply(p,e,e),ln.add(u,E,i),ln.multiply(p,i,i)):(ln.multiply(p,l,e),ln.add(e,y,e),ln.multiply(p,u,i),ln.add(i,E,i))),this.simulationSpace){case 0:break;case 1:ln.add(e,S,e),ln.add(i,S,i)}var M=NaN,D=NaN;switch(this.startSizeType){case 0:if(this.threeDStartSize){var b=b;M=Math.max(b.x,b.y),1===I&&(D=b.y)}else M=this.startSizeConstant,1===I&&(D=this.startSizeConstant);break;case 1:break;case 2:if(this.threeDStartSize){var w=w;M=Math.max(w.x,w.y),1===I&&(D=w.y)}else M=this.startSizeConstantMax,1===I&&(D=this.startSizeConstantMax)}if(this._sizeOverLifetime&&this._sizeOverLifetime.enbale){this._sizeOverLifetime.size;M*=this._sizeOverLifetime.size.getMaxSizeInGradient()}var L=Y._tempVector30,O=NaN,N=NaN;switch(I){case 0:O=M*Y.halfKSqrtOf2,ln.scale(C,M,L),ln.subtract(e,L,e),ln.add(i,L,i);break;case 1:var P=Y._tempVector31,F=Y._tempVector32,B=Y._tempVector33,V=Y._tempVector34;this._velocityOverLifetime&&this._velocityOverLifetime.enbale||(ln.multiply(m,v,F),ln.multiply(m,g,B));var U=D*t.stretchedBillboardLengthScale,z=ln.scalarLength(F)*t.stretchedBillboardSpeedScale+U,G=ln.scalarLength(B)*t.stretchedBillboardSpeedScale+U,H=Y._tempVector35,k=Y._tempVector36;ln.normalize(F,H),ln.scale(H,z,V),ln.subtract(E,V,V),ln.normalize(B,k),ln.scale(k,G,P),ln.add(y,P,P),O=M*Y.halfKSqrtOf2,ln.scale(C,O,L);var W=Y._tempVector37,X=Y._tempVector38;ln.scale(H,.5,W),ln.scale(k,.5,X),ln.multiply(W,C,W),ln.multiply(X,C,X),ln.add(e,X,e),ln.min(e,V,e),ln.subtract(e,L,e),ln.subtract(i,W,i),ln.max(i,P,i),ln.add(i,L,i);break;case 2:N=.5*(M*=Math.cos(.7853981633974483)),L.x=C.x*N,L.y=C.z*N,ln.subtract(e,L,e),ln.add(i,L,i);break;case 3:N=.5*(M*=Math.cos(.7853981633974483)),ln.scale(C,N,L),ln.subtract(e,L,e),ln.add(i,L,i)}this._boundingBox.getCorners(this._boundingBoxCorners)},t._updateEmission=function(){if(this.isAlive)if(this._simulateUpdate)this._simulateUpdate=!1;else{var t=this._startUpdateLoopCount===$i.loopCount||this._isPaused?0:this._owner._scene.timer._delta/1e3;t=Math.min(Y._maxElapsedTime,t),this._updateParticles(t)}},t._updateParticles=function(t){(4!==this._ownerRender.renderMode||this._ownerRender.mesh)&&(this._currentTime+=t,this._retireActiveParticles(),this._freeRetiredParticles(),this._totalDelayTime+=t,this._totalDelayTime<this._playStartDelay||this._emission.enbale&&this._isEmitting&&!this._isPaused&&this._advanceTime(t,this._currentTime))},t._updateParticlesSimulationRestart=function(t){this._firstActiveElement=0,this._firstNewElement=0,this._firstFreeElement=0,this._firstRetiredElement=0,this._burstsIndex=0,this._frameRateTime=t,this._emissionTime=0,this._totalDelayTime=0;var e=this._currentTime=t;e<this._playStartDelay?this._totalDelayTime=e:this._emission.enbale&&this._advanceTime(t,t)},t._retireActiveParticles=function(){for(;this._firstActiveElement!=this._firstNewElement;){var t=this._firstActiveElement*this._floatCountPerVertex*this._vertexStride,e=t+this._timeIndex;if(this._currentTime-this._vertices[e]+1e-4<this._vertices[t+this._startLifeTimeIndex])break;this._vertices[e]=this._drawCounter,this._firstActiveElement++,this._firstActiveElement>=this._bufferMaxParticles&&(this._firstActiveElement=0)}},t._freeRetiredParticles=function(){for(;this._firstRetiredElement!=this._firstActiveElement;){var t=this._drawCounter-this._vertices[this._firstRetiredElement*this._floatCountPerVertex*this._vertexStride+this._timeIndex];if(this.isPerformanceMode&&t<3)break;this._firstRetiredElement++,this._firstRetiredElement>=this._bufferMaxParticles&&(this._firstRetiredElement=0)}},t._burst=function(t,e){for(var i=0,n=this._emission._bursts,r=n.length;this._burstsIndex<r;this._burstsIndex++){var s=n[this._burstsIndex],a=s.time;if(!(t<=a&&a<e))break;var o=0;this.autoRandomSeed?o=ge.lerp(s.minCount,s.maxCount,Math.random()):(this._rand.seed=this._randomSeeds[0],o=ge.lerp(s.minCount,s.maxCount,this._rand.getFloat()),this._randomSeeds[0]=this._rand.seed),i+=o}return i},t._advanceTime=function(t,e){var i=0,n=this._emissionTime;this._emissionTime+=t;var r=0;if(this._emissionTime>this.duration){if(!this.looping){for(r=Math.min(this.maxParticles-this.aliveParticleCount,r),i=0;i<r;i++)this.emit(e);return this._isPlaying=!1,void this.stop()}r+=this._burst(n,this._emissionTime),this._emissionTime-=this.duration,this._burstsIndex=0,r+=this._burst(0,this._emissionTime)}else r+=this._burst(n,this._emissionTime);for(r=Math.min(this.maxParticles-this.aliveParticleCount,r),i=0;i<r;i++)this.emit(e);var s=this.emission.emissionRate;if(0<s){var a=1/s;for(this._frameRateTime+=a,this._frameRateTime=this._currentTime-(this._currentTime-this._frameRateTime)%this._maxStartLifetime;this._frameRateTime<=e&&this.emit(this._frameRateTime);)this._frameRateTime+=a;this._frameRateTime=Math.floor(e/a)*a}},t._initBufferDatas=function(){this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy());var t=this._ownerRender,e=t.renderMode;if(-1!==e&&0<this.maxParticles){var i,n,r=0,s=0,a=0,o=0,h=0,l=0,u=0,c=t.mesh;if(4===e){if(c){if(1<c._vertexBuffers.length)throw new Error("ShurikenParticleSystem: submesh Count mesh be One or all subMeshes have the same vertexDeclaration.");n=Hr.vertexDeclaration,this._floatCountPerVertex=n.vertexStride/4,this._startLifeTimeIndex=12,this._timeIndex=16,this._vertexStride=c._vertexBuffers[0].vertexCount;var _=this._bufferMaxParticles*this._vertexStride,d=_%65535;if(1<Math.floor(_/65535)+1)throw new Error("ShurikenParticleSystem:the maxParticleCount multiply mesh vertexCount is large than 65535.");l=n.vertexStride*d,this._vertexBuffer=new zn(l,35048),this._vertexBuffer.vertexDeclaration=n,this._vertices=new Float32Array(this._floatCountPerVertex*d),this._indexStride=c._indexBuffer.indexCount;var f=c._indexBuffer.getData(),p=this._bufferMaxParticles*this._indexStride;for(this._indexBuffer=new dr("ushort",p,35044),i=new Uint16Array(p),u=l+2*p,r=o=0;r<this._bufferMaxParticles;r++){var m=r*this._vertexStride;for(s=0,a=f.length;s<a;s++)i[o++]=m+f[s]}this._indexBuffer.setData(i),this._bufferState.bind(),this._bufferState.applyVertexBuffer(this._vertexBuffer),this._bufferState.applyIndexBuffer(this._indexBuffer),this._bufferState.unBind()}}else{for(n=br.vertexDeclaration,this._floatCountPerVertex=n.vertexStride/4,this._startLifeTimeIndex=7,this._timeIndex=11,this._vertexStride=4,l=n.vertexStride*this._bufferMaxParticles*this._vertexStride,this._vertexBuffer=new zn(l,35048),this._vertexBuffer.vertexDeclaration=n,this._vertices=new Float32Array(this._floatCountPerVertex*this._bufferMaxParticles*this._vertexStride),r=0;r<this._bufferMaxParticles;r++)h=r*this._floatCountPerVertex*this._vertexStride,this._vertices[h]=-.5,this._vertices[h+1]=-.5,this._vertices[h+2]=0,this._vertices[h+3]=1,h+=this._floatCountPerVertex,this._vertices[h]=.5,this._vertices[h+1]=-.5,this._vertices[h+2]=1,this._vertices[h+3]=1,h+=this._floatCountPerVertex,this._vertices[h]=.5,this._vertices[h+1]=.5,this._vertices[h+2]=1,this._vertices[h+3]=0,h+=this._floatCountPerVertex,this._vertices[h]=-.5,this._vertices[h+1]=.5,this._vertices[h+2]=0,this._vertices[h+3]=0;for(this._indexStride=6,this._indexBuffer=new dr("ushort",6*this._bufferMaxParticles,35044),i=new Uint16Array(6*this._bufferMaxParticles),r=0;r<this._bufferMaxParticles;r++){o=6*r;var g=r*this._vertexStride,v=g+2;i[o++]=g,i[o++]=v,i[o++]=g+1,i[o++]=g,i[o++]=g+3,i[o++]=v}this._indexBuffer.setData(i),u=l+6*this._bufferMaxParticles*2,this._bufferState.bind(),this._bufferState.applyVertexBuffer(this._vertexBuffer),this._bufferState.applyIndexBuffer(this._indexBuffer),this._bufferState.unBind()}Nn._addMemory(u,u)}},t.destroy=function(){e.prototype.destroy.call(this);var t=this._vertexBuffer._byteLength+2*this._indexBuffer.indexCount;Nn._addMemory(-t,-t),this._bufferState.destroy(),this._vertexBuffer.destroy(),this._indexBuffer.destroy(),this._emission.destroy(),this._bufferState=null,this._vertexBuffer=null,this._indexBuffer=null,this._owner=null,this._vertices=null,this._indexBuffer=null,this._emission=null,this._shape=null,this.startLifeTimeGradient=null,this.startLifeTimeGradientMin=null,this.startLifeTimeGradientMax=null,this.startSizeConstantSeparate=null,this.startSizeConstantMinSeparate=null,this.startSizeConstantMaxSeparate=null,this.startRotationConstantSeparate=null,this.startRotationConstantMinSeparate=null,this.startRotationConstantMaxSeparate=null,this.startColorConstant=null,this.startColorConstantMin=null,this.startColorConstantMax=null,this._velocityOverLifetime=null,this._colorOverLifetime=null,this._sizeOverLifetime=null,this._rotationOverLifetime=null,this._textureSheetAnimation=null},t.emit=function(t){var e=Y._tempPosition,i=Y._tempDirection;return this._shape&&this._shape.enable?this.autoRandomSeed?this._shape.generatePositionAndDirection(e,i):this._shape.generatePositionAndDirection(e,i,this._rand,this._randomSeeds):(e.x=e.y=e.z=0,i.x=i.y=0,i.z=1),this.addParticle(e,i,t)},t.addParticle=function(t,e,i){ln.normalize(e,e);var n=this._firstFreeElement+1;if(n>=this._bufferMaxParticles&&(n=0),n===this._firstRetiredElement)return!1;if(ct.create(this,this._ownerRender,this._owner.transform),this._currentTime-i>=ct.startLifeTime)return!0;var r=NaN,s=NaN,a=NaN,o=NaN,h=NaN,l=NaN,u=NaN,c=this._velocityOverLifetime&&this._velocityOverLifetime.enbale;if(c){var _=this._velocityOverLifetime.velocity.type;2===_||3===_?this.autoRandomSeed?(r=Math.random(),s=Math.random(),a=Math.random()):(this._rand.seed=this._randomSeeds[9],r=this._rand.getFloat(),s=this._rand.getFloat(),a=this._rand.getFloat(),this._randomSeeds[9]=this._rand.seed):c=!1}else c=!1;var d=this._colorOverLifetime&&this._colorOverLifetime.enbale;d?3===this._colorOverLifetime.color.type?this.autoRandomSeed?o=Math.random():(this._rand.seed=this._randomSeeds[10],o=this._rand.getFloat(),this._randomSeeds[10]=this._rand.seed):d=!1:d=!1;var f=this._sizeOverLifetime&&this._sizeOverLifetime.enbale;f?3===this._sizeOverLifetime.size.type?this.autoRandomSeed?h=Math.random():(this._rand.seed=this._randomSeeds[11],h=this._rand.getFloat(),this._randomSeeds[11]=this._rand.seed):f=!1:f=!1;var p=this._rotationOverLifetime&&this._rotationOverLifetime.enbale;if(p){var m=this._rotationOverLifetime.angularVelocity.type;2===m||3===m?this.autoRandomSeed?l=Math.random():(this._rand.seed=this._randomSeeds[12],l=this._rand.getFloat(),this._randomSeeds[12]=this._rand.seed):p=!1}else p=!1;var g=this._textureSheetAnimation&&this._textureSheetAnimation.enable;g?3===this._textureSheetAnimation.frame.type?this.autoRandomSeed?u=Math.random():(this._rand.seed=this._randomSeeds[15],u=this._rand.getFloat(),this._randomSeeds[15]=this._rand.seed):g=!1:g=!1;var v,T=this._firstFreeElement*this._floatCountPerVertex*this._vertexStride,y=ct.startUVInfo[0],E=ct.startUVInfo[1],x=ct.startUVInfo[2],S=ct.startUVInfo[3],C=0,I=0,R=0,A=0,M=0,D=this._ownerRender;if(4===D.renderMode){var b=D.mesh._vertexBuffers[0];v=b.getData();var w=b.vertexDeclaration;I=w.getVertexElementByUsage(0).offset/4;var L=w.getVertexElementByUsage(1);R=L?L.offset/4:-1;var O=w.getVertexElementByUsage(2);A=O?O.offset/4:-1,C=w.vertexStride/4,M=0}else{this._vertices[T+2]=x,this._vertices[T+3]=S+E;var N=T+this._floatCountPerVertex;this._vertices[N+2]=x+y,this._vertices[N+3]=S+E;var P=N+this._floatCountPerVertex;this._vertices[P+2]=x+y,this._vertices[P+3]=S;var F=P+this._floatCountPerVertex;this._vertices[F+2]=x,this._vertices[F+3]=S}for(var B=T,V=T+this._floatCountPerVertex*this._vertexStride;B<V;B+=this._floatCountPerVertex){var U=0;if(4===D.renderMode){U=B;var z=C*M++,G=z+I;this._vertices[U++]=v[G++],this._vertices[U++]=v[G++],this._vertices[U++]=v[G],this._vertices[U++]=-1===R?(this._vertices[U++]=1,this._vertices[U++]=1,this._vertices[U++]=1):(G=z+R,this._vertices[U++]=v[G++],this._vertices[U++]=v[G++],this._vertices[U++]=v[G++],v[G]),this._vertices[U++]=-1===A?this._vertices[U++]=0:(G=z+A,this._vertices[U++]=x+v[G++]*y,S+v[G]*E)}else U=B+4;switch(this._vertices[U++]=t.x,this._vertices[U++]=t.y,this._vertices[U++]=t.z,this._vertices[U++]=ct.startLifeTime,this._vertices[U++]=e.x,this._vertices[U++]=e.y,this._vertices[U++]=e.z,this._vertices[U++]=i,this._vertices[U++]=ct.startColor.x,this._vertices[U++]=ct.startColor.y,this._vertices[U++]=ct.startColor.z,this._vertices[U++]=ct.startColor.w,this._vertices[U++]=ct.startSize[0],this._vertices[U++]=ct.startSize[1],this._vertices[U++]=ct.startSize[2],this._vertices[U++]=ct.startRotation[0],this._vertices[U++]=ct.startRotation[1],this._vertices[U++]=ct.startRotation[2],this._vertices[U++]=ct.startSpeed,d&&(this._vertices[U+1]=o),f&&(this._vertices[U+2]=h),p&&(this._vertices[U+3]=l),g&&(this._vertices[U+4]=u),c&&(this._vertices[U+5]=r,this._vertices[U+6]=s,this._vertices[U+7]=a),this.simulationSpace){case 0:U+=8,this._vertices[U++]=ct.simulationWorldPostion[0],this._vertices[U++]=ct.simulationWorldPostion[1],this._vertices[U++]=ct.simulationWorldPostion[2],this._vertices[U++]=ct.simulationWorldRotation[0],this._vertices[U++]=ct.simulationWorldRotation[1],this._vertices[U++]=ct.simulationWorldRotation[2],this._vertices[U++]=ct.simulationWorldRotation[3];break;case 1:break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}}return this._firstFreeElement=n,!0},t.addNewParticlesToVertexBuffer=function(){var t=0;this._firstNewElement<this._firstFreeElement?(t=this._firstNewElement*this._vertexStride*this._floatCountPerVertex,this._vertexBuffer.setData(this._vertices,t,t,(this._firstFreeElement-this._firstNewElement)*this._vertexStride*this._floatCountPerVertex)):(t=this._firstNewElement*this._vertexStride*this._floatCountPerVertex,this._vertexBuffer.setData(this._vertices,t,t,(this._bufferMaxParticles-this._firstNewElement)*this._vertexStride*this._floatCountPerVertex),0<this._firstFreeElement&&this._vertexBuffer.setData(this._vertices,0,0,this._firstFreeElement*this._vertexStride*this._floatCountPerVertex)),this._firstNewElement=this._firstFreeElement},t._getType=function(){return Y._type},t._prepareRender=function(t){return this._updateEmission(),this._firstNewElement!=this._firstFreeElement&&this.addNewParticlesToVertexBuffer(),this._drawCounter++,this._firstActiveElement!=this._firstFreeElement},t._render=function(t){this._bufferState.bind();var e=0,i=Nt.instance;this._firstActiveElement<this._firstFreeElement?(e=(this._firstFreeElement-this._firstActiveElement)*this._indexStride,i.drawElements(4,e,5123,2*this._firstActiveElement*this._indexStride),$i.trianglesFaces+=e/3,$i.renderBatches++):(e=(this._bufferMaxParticles-this._firstActiveElement)*this._indexStride,i.drawElements(4,e,5123,2*this._firstActiveElement*this._indexStride),$i.trianglesFaces+=e/3,$i.renderBatches++,0<this._firstFreeElement&&(e=this._firstFreeElement*this._indexStride,i.drawElements(4,e,5123,0),$i.trianglesFaces+=e/3,$i.renderBatches++))},t.play=function(){if(this._burstsIndex=0,this._isEmitting=!0,this._isPlaying=!0,this._isPaused=!1,this._emissionTime=0,this._totalDelayTime=0,!this.autoRandomSeed)for(var t=0,e=this._randomSeeds.length;t<e;t++)this._randomSeeds[t]=this.randomSeed[0]+Y._RANDOMOFFSET[t];switch(this.startDelayType){case 0:this._playStartDelay=this.startDelay;break;case 1:this.autoRandomSeed?this._playStartDelay=ge.lerp(this.startDelayMin,this.startDelayMax,Math.random()):(this._rand.seed=this._randomSeeds[2],this._playStartDelay=ge.lerp(this.startDelayMin,this.startDelayMax,this._rand.getFloat()),this._randomSeeds[2]=this._rand.seed);break;default:throw new Error("Utils3D: startDelayType is invalid.")}this._frameRateTime=this._currentTime+this._playStartDelay,this._startUpdateLoopCount=$i.loopCount},t.pause=function(){this._isPaused=!0},t.simulate=function(t,e){void 0===e&&(e=!0),this._simulateUpdate=!0,e?this._updateParticlesSimulationRestart(t):(this._isPaused=!1,this._updateParticles(t)),this.pause()},t.stop=function(){this._burstsIndex=0,this._isEmitting=!1,this._emissionTime=0},t.cloneTo=function(t){var e=t;e.duration=this.duration,e.looping=this.looping,e.prewarm=this.prewarm,e.startDelayType=this.startDelayType,e.startDelay=this.startDelay,e.startDelayMin=this.startDelayMin,e.startDelayMax=this.startDelayMax,e._maxStartLifetime=this._maxStartLifetime,e.startLifetimeType=this.startLifetimeType,e.startLifetimeConstant=this.startLifetimeConstant,this.startLifeTimeGradient.cloneTo(e.startLifeTimeGradient),e.startLifetimeConstantMin=this.startLifetimeConstantMin,e.startLifetimeConstantMax=this.startLifetimeConstantMax,this.startLifeTimeGradientMin.cloneTo(e.startLifeTimeGradientMin),this.startLifeTimeGradientMax.cloneTo(e.startLifeTimeGradientMax),e.startSpeedType=this.startSpeedType,e.startSpeedConstant=this.startSpeedConstant,e.startSpeedConstantMin=this.startSpeedConstantMin,e.startSpeedConstantMax=this.startSpeedConstantMax,e.threeDStartSize=this.threeDStartSize,e.startSizeType=this.startSizeType,e.startSizeConstant=this.startSizeConstant,this.startSizeConstantSeparate.cloneTo(e.startSizeConstantSeparate),e.startSizeConstantMin=this.startSizeConstantMin,e.startSizeConstantMax=this.startSizeConstantMax,this.startSizeConstantMinSeparate.cloneTo(e.startSizeConstantMinSeparate),this.startSizeConstantMaxSeparate.cloneTo(e.startSizeConstantMaxSeparate),e.threeDStartRotation=this.threeDStartRotation,e.startRotationType=this.startRotationType,e.startRotationConstant=this.startRotationConstant,this.startRotationConstantSeparate.cloneTo(e.startRotationConstantSeparate),e.startRotationConstantMin=this.startRotationConstantMin,e.startRotationConstantMax=this.startRotationConstantMax,this.startRotationConstantMinSeparate.cloneTo(e.startRotationConstantMinSeparate),this.startRotationConstantMaxSeparate.cloneTo(e.startRotationConstantMaxSeparate),e.randomizeRotationDirection=this.randomizeRotationDirection,e.startColorType=this.startColorType,this.startColorConstant.cloneTo(e.startColorConstant),this.startColorConstantMin.cloneTo(e.startColorConstantMin),this.startColorConstantMax.cloneTo(e.startColorConstantMax),e.gravityModifier=this.gravityModifier,e.simulationSpace=this.simulationSpace,e.scaleMode=this.scaleMode,e.playOnAwake=this.playOnAwake,e.maxParticles=this.maxParticles,this._emission&&(e._emission=this._emission.clone()),this.shape&&(e.shape=this.shape.clone()),this.velocityOverLifetime&&(e.velocityOverLifetime=this.velocityOverLifetime.clone()),this.colorOverLifetime&&(e.colorOverLifetime=this.colorOverLifetime.clone()),this.sizeOverLifetime&&(e.sizeOverLifetime=this.sizeOverLifetime.clone()),this.rotationOverLifetime&&(e.rotationOverLifetime=this.rotationOverLifetime.clone()),this.textureSheetAnimation&&(e.textureSheetAnimation=this.textureSheetAnimation.clone()),e.isPerformanceMode=this.isPerformanceMode,e._isEmitting=this._isEmitting,e._isPlaying=this._isPlaying,e._isPaused=this._isPaused,e._playStartDelay=this._playStartDelay,e._frameRateTime=this._frameRateTime,e._emissionTime=this._emissionTime,e._totalDelayTime=this._totalDelayTime,e._burstsIndex=this._burstsIndex},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},g(0,t,"textureSheetAnimation",function(){return this._textureSheetAnimation},function(t){var e=this._owner._render._defineDatas,i=this._owner._render._shaderValues;if(t){var n=t.frame,r=n.type;if(t.enable)switch(r){case 1:e.add(Ca.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE);break;case 3:e.add(Ca.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE)}else e.remove(Ca.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE),e.remove(Ca.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE);if(1===r||3===r){i.setNumber(Ca.TEXTURESHEETANIMATIONCYCLES,t.cycles);var s=t.tiles,a=this._uvLength;a.x=1/s.x,a.y=1/s.y,i.setVector2(Ca.TEXTURESHEETANIMATIONSUBUVLENGTH,this._uvLength)}switch(r){case 1:i.setBuffer(Ca.TEXTURESHEETANIMATIONGRADIENTUVS,n.frameOverTimeData._elements);break;case 3:i.setBuffer(Ca.TEXTURESHEETANIMATIONGRADIENTUVS,n.frameOverTimeDataMin._elements),i.setBuffer(Ca.TEXTURESHEETANIMATIONGRADIENTMAXUVS,n.frameOverTimeDataMax._elements)}}else e.remove(Ca.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE),e.remove(Ca.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE),i.setNumber(Ca.TEXTURESHEETANIMATIONCYCLES,void 0),i.setVector(Ca.TEXTURESHEETANIMATIONSUBUVLENGTH,null),i.setBuffer(Ca.TEXTURESHEETANIMATIONGRADIENTUVS,null),i.setBuffer(Ca.TEXTURESHEETANIMATIONGRADIENTMAXUVS,null);this._textureSheetAnimation=t}),g(0,t,"colorOverLifetime",function(){return this._colorOverLifetime},function(t){var e=this._owner._render._defineDatas,i=this._owner._render._shaderValues;if(t){var n=t.color;if(t.enbale)switch(n.type){case 1:e.add(Ca.SHADERDEFINE_COLOROVERLIFETIME);break;case 3:e.add(Ca.SHADERDEFINE_RANDOMCOLOROVERLIFETIME)}else e.remove(Ca.SHADERDEFINE_COLOROVERLIFETIME),e.remove(Ca.SHADERDEFINE_RANDOMCOLOROVERLIFETIME);switch(n.type){case 1:var r=n.gradient;i.setBuffer(Ca.COLOROVERLIFEGRADIENTALPHAS,r._alphaElements),i.setBuffer(Ca.COLOROVERLIFEGRADIENTCOLORS,r._rgbElements);break;case 3:var s=n.gradientMin,a=n.gradientMax;i.setBuffer(Ca.COLOROVERLIFEGRADIENTALPHAS,s._alphaElements),i.setBuffer(Ca.COLOROVERLIFEGRADIENTCOLORS,s._rgbElements),i.setBuffer(Ca.MAXCOLOROVERLIFEGRADIENTALPHAS,a._alphaElements),i.setBuffer(Ca.MAXCOLOROVERLIFEGRADIENTCOLORS,a._rgbElements)}}else e.remove(Ca.SHADERDEFINE_COLOROVERLIFETIME),e.remove(Ca.SHADERDEFINE_RANDOMCOLOROVERLIFETIME),i.setBuffer(Ca.COLOROVERLIFEGRADIENTALPHAS,r._alphaElements),i.setBuffer(Ca.COLOROVERLIFEGRADIENTCOLORS,r._rgbElements),i.setBuffer(Ca.COLOROVERLIFEGRADIENTALPHAS,s._alphaElements),i.setBuffer(Ca.COLOROVERLIFEGRADIENTCOLORS,s._rgbElements),i.setBuffer(Ca.MAXCOLOROVERLIFEGRADIENTALPHAS,a._alphaElements),i.setBuffer(Ca.MAXCOLOROVERLIFEGRADIENTCOLORS,a._rgbElements);this._colorOverLifetime=t}),g(0,t,"rotationOverLifetime",function(){return this._rotationOverLifetime},function(t){var e=this._owner._render._defineDatas,i=this._owner._render._shaderValues;if(t){var n=t.angularVelocity;if(!n)return;var r=n.separateAxes,s=n.type;if(t.enbale)switch(r?e.add(Ca.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE):e.add(Ca.SHADERDEFINE_ROTATIONOVERLIFETIME),s){case 0:e.add(Ca.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT);break;case 1:e.add(Ca.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE);break;case 2:e.add(Ca.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS);break;case 3:e.add(Ca.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES)}else e.remove(Ca.SHADERDEFINE_ROTATIONOVERLIFETIME),e.remove(Ca.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE),e.remove(Ca.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT),e.remove(Ca.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE),e.remove(Ca.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS),e.remove(Ca.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES);switch(s){case 0:r?i.setVector3(Ca.ROLANGULARVELOCITYCONSTSEPRARATE,n.constantSeparate):i.setNumber(Ca.ROLANGULARVELOCITYCONST,n.constant);break;case 1:r?(i.setBuffer(Ca.ROLANGULARVELOCITYGRADIENTX,n.gradientX._elements),i.setBuffer(Ca.ROLANGULARVELOCITYGRADIENTY,n.gradientY._elements),i.setBuffer(Ca.ROLANGULARVELOCITYGRADIENTZ,n.gradientZ._elements)):i.setBuffer(Ca.ROLANGULARVELOCITYGRADIENT,n.gradient._elements);break;case 2:r?(i.setVector3(Ca.ROLANGULARVELOCITYCONSTSEPRARATE,n.constantMinSeparate),i.setVector3(Ca.ROLANGULARVELOCITYCONSTMAXSEPRARATE,n.constantMaxSeparate)):(i.setNumber(Ca.ROLANGULARVELOCITYCONST,n.constantMin),i.setNumber(Ca.ROLANGULARVELOCITYCONSTMAX,n.constantMax));break;case 3:r?(i.setBuffer(Ca.ROLANGULARVELOCITYGRADIENTX,n.gradientXMin._elements),i.setBuffer(Ca.ROLANGULARVELOCITYGRADIENTXMAX,n.gradientXMax._elements),i.setBuffer(Ca.ROLANGULARVELOCITYGRADIENTY,n.gradientYMin._elements),i.setBuffer(Ca.ROLANGULARVELOCITYGRADIENTYMAX,n.gradientYMax._elements),i.setBuffer(Ca.ROLANGULARVELOCITYGRADIENTZ,n.gradientZMin._elements),i.setBuffer(Ca.ROLANGULARVELOCITYGRADIENTZMAX,n.gradientZMax._elements)):(i.setBuffer(Ca.ROLANGULARVELOCITYGRADIENT,n.gradientMin._elements),i.setBuffer(Ca.ROLANGULARVELOCITYGRADIENTMAX,n.gradientMax._elements))}}else e.remove(Ca.SHADERDEFINE_ROTATIONOVERLIFETIME),e.remove(Ca.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE),e.remove(Ca.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT),e.remove(Ca.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE),e.remove(Ca.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS),e.remove(Ca.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES),i.setVector(Ca.ROLANGULARVELOCITYCONSTSEPRARATE,null),i.setVector(Ca.ROLANGULARVELOCITYCONSTMAXSEPRARATE,null),i.setNumber(Ca.ROLANGULARVELOCITYCONST,void 0),i.setNumber(Ca.ROLANGULARVELOCITYCONSTMAX,void 0),i.setBuffer(Ca.ROLANGULARVELOCITYGRADIENTX,null),i.setBuffer(Ca.ROLANGULARVELOCITYGRADIENTXMAX,null),i.setBuffer(Ca.ROLANGULARVELOCITYGRADIENTY,null),i.setBuffer(Ca.ROLANGULARVELOCITYGRADIENTYMAX,null),i.setBuffer(Ca.ROLANGULARVELOCITYGRADIENTZ,null),i.setBuffer(Ca.ROLANGULARVELOCITYGRADIENTZMAX,null),i.setBuffer(Ca.ROLANGULARVELOCITYGRADIENTWMAX,null),i.setBuffer(Ca.ROLANGULARVELOCITYGRADIENT,null),i.setBuffer(Ca.ROLANGULARVELOCITYGRADIENTMAX,null);this._rotationOverLifetime=t}),g(0,t,"startLifeTimeGradientMax",function(){return this._startLifeTimeGradientMax},function(t){if(3===this._startLifetimeType){var e=0,i=0;for(this._maxStartLifetime=-Number.MAX_VALUE,e=0,i=this._startLifeTimeGradientMin.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,this._startLifeTimeGradientMin.getValueByIndex(e));for(e=0,i=t.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,t.getValueByIndex(e))}this._startLifeTimeGradientMax=t}),g(0,t,"startLifetimeConstantMax",function(){return this._startLifetimeConstantMax},function(t){2===this._startLifetimeType&&(this._maxStartLifetime=Math.max(this._startLifetimeConstantMin,t)),this._startLifetimeConstantMax=t}),g(0,t,"startLifeTimeGradient",function(){return this._startLifeTimeGradient},function(t){if(1===this._startLifetimeType){this._maxStartLifetime=-Number.MAX_VALUE;for(var e=0,i=t.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,t.getValueByIndex(e))}this._startLifeTimeGradient=t}),g(0,t,"startLifetimeType",function(){return this._startLifetimeType},function(t){var e=0,i=0;switch(this.startLifetimeType){case 0:this._maxStartLifetime=this.startLifetimeConstant;break;case 1:this._maxStartLifetime=-Number.MAX_VALUE;var n=n;for(e=0,i=n.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,n.getValueByIndex(e));break;case 2:this._maxStartLifetime=Math.max(this.startLifetimeConstantMin,this.startLifetimeConstantMax);break;case 3:this._maxStartLifetime=-Number.MAX_VALUE;var r=r;for(e=0,i=r.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,r.getValueByIndex(e));var s=s;for(e=0,i=s.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,s.getValueByIndex(e))}this._startLifetimeType=t}),g(0,t,"startLifeTimeGradientMin",function(){return this._startLifeTimeGradientMin},function(t){if(3===this._startLifetimeType){var e=0,i=0;for(this._maxStartLifetime=-Number.MAX_VALUE,e=0,i=t.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,t.getValueByIndex(e));for(e=0,i=this._startLifeTimeGradientMax.gradientCount;e<i;e++)this._maxStartLifetime=Math.max(this._maxStartLifetime,this._startLifeTimeGradientMax.getValueByIndex(e))}this._startLifeTimeGradientMin=t}),g(0,t,"isPaused",function(){return this._isPaused}),g(0,t,"sizeOverLifetime",function(){return this._sizeOverLifetime},function(t){var e=this._owner._render._defineDatas,i=this._owner._render._shaderValues;if(t){var n=t.size,r=n.separateAxes,s=n.type;if(t.enbale)switch(s){case 0:r?e.add(Ca.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE):e.add(Ca.SHADERDEFINE_SIZEOVERLIFETIMECURVE);break;case 2:r?e.add(Ca.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE):e.add(Ca.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES)}else e.remove(Ca.SHADERDEFINE_SIZEOVERLIFETIMECURVE),e.remove(Ca.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE),e.remove(Ca.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES),e.remove(Ca.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE);switch(s){case 0:r?(i.setBuffer(Ca.SOLSIZEGRADIENTX,n.gradientX._elements),i.setBuffer(Ca.SOLSIZEGRADIENTY,n.gradientY._elements),i.setBuffer(Ca.SOLSizeGradientZ,n.gradientZ._elements)):i.setBuffer(Ca.SOLSIZEGRADIENT,n.gradient._elements);break;case 2:r?(i.setBuffer(Ca.SOLSIZEGRADIENTX,n.gradientXMin._elements),i.setBuffer(Ca.SOLSIZEGRADIENTXMAX,n.gradientXMax._elements),i.setBuffer(Ca.SOLSIZEGRADIENTY,n.gradientYMin._elements),i.setBuffer(Ca.SOLSIZEGRADIENTYMAX,n.gradientYMax._elements),i.setBuffer(Ca.SOLSizeGradientZ,n.gradientZMin._elements),i.setBuffer(Ca.SOLSizeGradientZMAX,n.gradientZMax._elements)):(i.setBuffer(Ca.SOLSIZEGRADIENT,n.gradientMin._elements),i.setBuffer(Ca.SOLSizeGradientMax,n.gradientMax._elements))}}else e.remove(Ca.SHADERDEFINE_SIZEOVERLIFETIMECURVE),e.remove(Ca.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE),e.remove(Ca.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES),e.remove(Ca.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE),i.setBuffer(Ca.SOLSIZEGRADIENTX,null),i.setBuffer(Ca.SOLSIZEGRADIENTXMAX,null),i.setBuffer(Ca.SOLSIZEGRADIENTY,null),i.setBuffer(Ca.SOLSIZEGRADIENTYMAX,null),i.setBuffer(Ca.SOLSizeGradientZ,null),i.setBuffer(Ca.SOLSizeGradientZMAX,null),i.setBuffer(Ca.SOLSIZEGRADIENT,null),i.setBuffer(Ca.SOLSizeGradientMax,null);this._sizeOverLifetime=t}),g(0,t,"isPlaying",function(){return this._isPlaying}),g(0,t,"velocityOverLifetime",function(){return this._velocityOverLifetime},function(t){var e=this._owner._render._defineDatas,i=this._owner._render._shaderValues;if(t){var n=t.velocity,r=n.type;if(t.enbale)switch(r){case 0:e.add(Ca.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT);break;case 1:e.add(Ca.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE);break;case 2:e.add(Ca.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT);break;case 3:e.add(Ca.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE)}else e.remove(Ca.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT),e.remove(Ca.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE),e.remove(Ca.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT),e.remove(Ca.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE);switch(r){case 0:i.setVector3(Ca.VOLVELOCITYCONST,n.constant);break;case 1:i.setBuffer(Ca.VOLVELOCITYGRADIENTX,n.gradientX._elements),i.setBuffer(Ca.VOLVELOCITYGRADIENTY,n.gradientY._elements),i.setBuffer(Ca.VOLVELOCITYGRADIENTZ,n.gradientZ._elements);break;case 2:i.setVector3(Ca.VOLVELOCITYCONST,n.constantMin),i.setVector3(Ca.VOLVELOCITYCONSTMAX,n.constantMax);break;case 3:i.setBuffer(Ca.VOLVELOCITYGRADIENTX,n.gradientXMin._elements),i.setBuffer(Ca.VOLVELOCITYGRADIENTXMAX,n.gradientXMax._elements),i.setBuffer(Ca.VOLVELOCITYGRADIENTY,n.gradientYMin._elements),i.setBuffer(Ca.VOLVELOCITYGRADIENTYMAX,n.gradientYMax._elements),i.setBuffer(Ca.VOLVELOCITYGRADIENTZ,n.gradientZMin._elements),i.setBuffer(Ca.VOLVELOCITYGRADIENTZMAX,n.gradientZMax._elements)}i.setInt(Ca.VOLSPACETYPE,t.space)}else e.remove(Ca.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT),e.remove(Ca.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE),e.remove(Ca.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT),e.remove(Ca.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE),i.setVector(Ca.VOLVELOCITYCONST,null),i.setBuffer(Ca.VOLVELOCITYGRADIENTX,null),i.setBuffer(Ca.VOLVELOCITYGRADIENTY,null),i.setBuffer(Ca.VOLVELOCITYGRADIENTZ,null),i.setVector(Ca.VOLVELOCITYCONST,null),i.setVector(Ca.VOLVELOCITYCONSTMAX,null),i.setBuffer(Ca.VOLVELOCITYGRADIENTX,null),i.setBuffer(Ca.VOLVELOCITYGRADIENTXMAX,null),i.setBuffer(Ca.VOLVELOCITYGRADIENTY,null),i.setBuffer(Ca.VOLVELOCITYGRADIENTYMAX,null),i.setBuffer(Ca.VOLVELOCITYGRADIENTZ,null),i.setBuffer(Ca.VOLVELOCITYGRADIENTZMAX,null),i.setInt(Ca.VOLSPACETYPE,void 0);this._velocityOverLifetime=t}),g(0,t,"emissionTime",function(){return this._emissionTime>this.duration?this.duration:this._emissionTime}),g(0,t,"isEmitting",function(){return this._isEmitting}),g(0,t,"isAlive",function(){return!!(this._isPlaying||0<this.aliveParticleCount)}),g(0,t,"shape",function(){return this._shape},function(t){this._shape!==t&&(t&&t.enable?this._owner._render._defineDatas.add(Ca.SHADERDEFINE_SHAPE):this._owner._render._defineDatas.remove(Ca.SHADERDEFINE_SHAPE),this._shape=t)}),g(0,t,"aliveParticleCount",function(){return this._firstNewElement>=this._firstRetiredElement?this._firstNewElement-this._firstRetiredElement:this._bufferMaxParticles-this._firstRetiredElement+this._firstNewElement}),g(0,t,"startLifetimeConstantMin",function(){return this._startLifetimeConstantMin},function(t){2===this._startLifetimeType&&(this._maxStartLifetime=Math.max(t,this._startLifetimeConstantMax)),this._startLifetimeConstantMin=t}),g(0,t,"startLifetimeConstant",function(){return this._startLifetimeConstant},function(t){0===this._startLifetimeType&&(this._maxStartLifetime=t),this._startLifetimeConstant=t}),g(0,t,"emission",function(){return this._emission}),g(0,t,"maxParticles",function(){return this._bufferMaxParticles-1},function(t){var e=t+1;e!==this._bufferMaxParticles&&(this._bufferMaxParticles=e,this._initBufferDatas())}),Y.halfKSqrtOf2=.71,E(Y,["_RANDOMOFFSET",function(){return this._RANDOMOFFSET=new Uint32Array([592910910,3276756734,322376503,306581307,1793934638,3737431713,2527743459,2368504881,4085612399,3774601268,326370691,1494990940,1089181156,3159510623,2941263940,2786374529,271901988,4233252447])},"_maxElapsedTime",function(){return this._maxElapsedTime=1/3},"_tempVector30",function(){return this._tempVector30=new ln},"_tempVector31",function(){return this._tempVector31=new ln},"_tempVector32",function(){return this._tempVector32=new ln},"_tempVector33",function(){return this._tempVector33=new ln},"_tempVector34",function(){return this._tempVector34=new ln},"_tempVector35",function(){return this._tempVector35=new ln},"_tempVector36",function(){return this._tempVector36=new ln},"_tempVector37",function(){return this._tempVector37=new ln},"_tempVector38",function(){return this._tempVector38=new ln},"_tempVector39",function(){return this._tempVector39=new ln},"_tempPosition",function(){return this._tempPosition=new ln},"_tempDirection",function(){return this._tempDirection=new ln},"_type",function(){return this._type=X._typeCounter++}]),Y}(X),ur=function(t){function d(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,d.__super.call(this)}I(d,"laya.ui.AutoBitmap",t);var e=d.prototype;return e.destroy=function(){t.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},e._setChanged=function(){this._isChanged||(this._isChanged=!0,T.timer.callLater(this,this.changeSource))},e.changeSource=function(){this._isChanged=!1;var t=this._source;if(t&&t.bitmap){var e=this.width,i=this.height,n=this._sizeGrid,r=t.sourceWidth,s=t.sourceHeight;if(!n||r===e&&s===i)this.clear(),this.drawTexture(t,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,e,i);else{this.clear();var a=n[0],o=n[1],h=n[2],l=n[3],u=n[4],c=!1;if(e==r&&(l=o=0),i==s&&(a=h=0),e<l+o){var _=e;c=!0,e=l+o,this.save(),this.clipRect(0,0,_,i)}l&&a&&this.drawImage(d.getTexture(t,0,0,l,a),0,0,l,a),o&&a&&this.drawImage(d.getTexture(t,r-o,0,o,a),e-o,0,o,a),l&&h&&this.drawImage(d.getTexture(t,0,s-h,l,h),0,i-h,l,h),o&&h&&this.drawImage(d.getTexture(t,r-o,s-h,o,h),e-o,i-h,o,h),a&&this.drawBitmap(u,d.getTexture(t,l,0,r-l-o,a),l,0,e-l-o,a),h&&this.drawBitmap(u,d.getTexture(t,l,s-h,r-l-o,h),l,i-h,e-l-o,h),l&&this.drawBitmap(u,d.getTexture(t,0,a,l,s-a-h),0,a,l,i-a-h),o&&this.drawBitmap(u,d.getTexture(t,r-o,a,o,s-a-h),e-o,a,o,i-a-h),this.drawBitmap(u,d.getTexture(t,l,a,r-l-o,s-a-h),l,a,e-l-o,i-a-h),c&&this.restore()}this._repaint()}},e.drawBitmap=function(t,e,i,n,r,s){void 0===r&&(r=0),void 0===s&&(s=0),r<.1||s<.1||(!t||e.width==r&&e.height==s?this.drawImage(e,i,n,r,s):this.fillTexture(e,i,n,r,s))},g(0,e,"source",function(){return this._source},function(t){t?(this._source=t,this._setChanged()):(this._source=null,this.clear())}),g(0,e,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function(t){this._height!=t&&(this._height=t,this._setChanged())}),g(0,e,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function(t){this._width!=t&&(this._width=t,this._setChanged())}),g(0,e,"sizeGrid",function(){return this._sizeGrid},function(t){this._sizeGrid=t,this._setChanged()}),d.getTexture=function(t,e,i,n,r){var s;return n<=0&&(n=1),r<=0&&(r=1),t.$_GID||(t.$_GID=nt.getGID()),s&&s._getSource()||(s=xr.createFromTexture(t,e,i,n,r)),s},d}($),cr=function(t){function r(){this._opaqueBatchMarks=[],r.__super.call(this),this._updateCountMark=0}I(r,"laya.d3.graphics.MeshRenderStaticBatchManager",t);var e=r.prototype;return e._compare=function(t,e){var i=t._render,n=e._render,r=t.meshFilter.sharedMesh,s=e.meshFilter.sharedMesh,a=i.lightmapIndex-n.lightmapIndex;if(0!==a)return a;var o=(i.receiveShadow?1:0)-(n.receiveShadow?1:0);if(0!==o)return o;var h=i.sharedMaterial.id-n.sharedMaterial.id;if(0!==h)return h;var l=r._vertexBuffers[0].vertexDeclaration.id-s._vertexBuffers[0].vertexDeclaration.id;return 0===l?s._indexBuffer.indexCount-r._indexBuffer.indexCount:l},e._getBatchRenderElementFromPool=function(){var t=this._batchRenderElementPool[this._batchRenderElementPoolIndex++];return t||(t=new qr,(this._batchRenderElementPool[this._batchRenderElementPoolIndex-1]=t).staticBatchElementList=[]),t},e._getStaticBatch=function(t,e){var i=t?t.id:0,n=this._staticBatches[i];return n||(n=this._staticBatches[i]=[]),n[e]||(n[e]=new Or(t,e,r._verDec))},e._initStaticBatchs=function(t){this._quickSort(this._initBatchSprites,0,this._initBatchSprites.length-1);for(var e,i=!1,n=0,r=0,s=this._initBatchSprites.length;r<s;r++){var a=this._initBatchSprites[r];if(i)e.addTest(a)?e.add(a):(i=!1,n++);else r!==s-1&&((e=this._getStaticBatch(t,n)).add(a),i=!0)}for(var o in this._staticBatches){var h=this._staticBatches[o];for(r=0,s=h.length;r<s;r++)h[r].finishInit()}this._initBatchSprites.length=0},e._destroyRenderSprite=function(t){var e=t._render._staticBatch;if(e.remove(t),0===e._batchElements.length){var i=e.batchOwner,n=i?i.id:0,r=this._staticBatches[n];r[e.number]=null,e.dispose();for(var s=!0,a=0;a<r.length;a++)r[a]&&(s=!1);s&&delete this._staticBatches[n]}},e._clear=function(){t.prototype._clear.call(this),this._updateCountMark++},e._garbageCollection=function(){for(var t in this._staticBatches)for(var e=this._staticBatches[t],i=0,n=e.length;i<n;i++){var r=e[i];0===r._batchElements.length&&(r.dispose(),e.splice(i,1),i--,0===--n&&delete this._staticBatches[t])}},e.getBatchOpaquaMark=function(t,e,i,n){var r=this._opaqueBatchMarks[t]||(this._opaqueBatchMarks[t]=[]),s=r[e]||(r[e]=[]),a=s[i]||(s[i]=[]);return a[n]||(a[n]=new Lt)},E(r,["_verDec",function(){return this._verDec=Si.getVertexDeclaration("POSITION,NORMAL,COLOR,UV,UV1,TANGENT")},"instance",function(){return this.instance=new r}]),r}(Bt),_r=function(t){function e(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.completeHandler=null,e.__super.call(this)}I(e,"laya.media.SoundChannel",o);var i=e.prototype;return i.play=function(){},i.stop=function(){this.completeHandler&&this.completeHandler.run()},i.pause=function(){},i.resume=function(){},i.__runComplete=function(t){t&&t.run()},g(0,i,"duration",function(){return 0}),g(0,i,"position",function(){return 0}),g(0,i,"volume",function(){return 1},function(t){}),e}(),dr=function(t){function a(t,e,i,n){this._indexType=null,this._indexTypeByteCount=0,this._indexCount=0,this._canRead=!1,void 0===i&&(i=35044),void 0===n&&(n=!1),a.__super.call(this),this._indexType=t,this._indexCount=e,this._bufferUsage=i,this._bufferType=34963,this._canRead=n;var r;if("ushort"==t)this._indexTypeByteCount=2;else{if("ubyte"!=t)throw new Error("unidentification index type.");this._indexTypeByteCount=1}r=this._indexTypeByteCount*e,this._byteLength=r;var s=W._curBindedBufferState;s?s._bindedIndexBuffer===this?Nt.instance.bufferData(this._bufferType,r,this._bufferUsage):(s.unBind(),this.bind(),Nt.instance.bufferData(this._bufferType,r,this._bufferUsage),s.bind()):(this.bind(),Nt.instance.bufferData(this._bufferType,r,this._bufferUsage)),n&&("ushort"==t?this._buffer=new Uint16Array(e):"ubyte"==t&&(this._buffer=new Uint8Array(e)))}I(a,"laya.d3.graphics.IndexBuffer3D",t);var e=a.prototype;return e._bindForVAO=function(){if(!W._curBindedBufferState)throw"IndexBuffer3D: must bind current BufferState.";Nt.instance.bindBuffer(34963,this._glBuffer)},e.bind=function(){if(W._curBindedBufferState)throw"IndexBuffer3D: must unbind current BufferState.";return L._bindedIndexBuffer!==this._glBuffer&&(Nt.instance.bindBuffer(34963,this._glBuffer),L._bindedIndexBuffer=this._glBuffer,!0)},e.setData=function(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=4294967295);var r=0;"ushort"==this._indexType?(r=2,0===i&&4294967295===n||(t=new Uint16Array(t.buffer,i*r,n))):"ubyte"==this._indexType&&(r=1,0===i&&4294967295===n||(t=new Uint8Array(t.buffer,i*r,n)));var s=W._curBindedBufferState;if(s?s._bindedIndexBuffer===this?Nt.instance.bufferSubData(this._bufferType,e*r,t):(s.unBind(),this.bind(),Nt.instance.bufferSubData(this._bufferType,e*r,t),s.bind()):(this.bind(),Nt.instance.bufferSubData(this._bufferType,e*r,t)),this._canRead)if(0!==e||0!==i||4294967295!==n){var a=this._buffer.length-e;a<n&&(n=a);for(var o=0;o<n;o++)this._buffer[e+o]=t[o]}else this._buffer=t},e.getData=function(){if(this._canRead)return this._buffer;throw new Error("Can't read data from VertexBuffer with only write flag!")},e.destroy=function(){t.prototype.destroy.call(this),this._buffer=null},g(0,e,"canRead",function(){return this._canRead}),g(0,e,"indexCount",function(){return this._indexCount}),g(0,e,"indexTypeByteCount",function(){return this._indexTypeByteCount}),g(0,e,"indexType",function(){return this._indexType}),a.INDEXTYPE_UBYTE="ubyte",a.INDEXTYPE_USHORT="ushort",a}(L),fr=function(t){function s(t,e,i,n,r){s.__super.call(this),this._owner=t,this._children=[],this._localMatrix=new Float32Array(16),qi.supportWebGLPlusAnimation?(this._localPosition=new B(0,0,0,e),this._localRotation=new F(0,0,0,1,i),this._localScale=new B(0,0,0,n),this._worldMatrix=r):(this._localPosition=new ln,this._localRotation=new Qt,this._localScale=new ln,this._worldMatrix=new Float32Array(16)),this._localQuaternionUpdate=!1,this._locaEulerlUpdate=!1,this._localUpdate=!1,this._worldUpdate=!0}I(s,"laya.d3.animation.AnimationTransform3D",o);var e=s.prototype;return e._getlocalMatrix=function(){return this._localUpdate&&(V._createAffineTransformationArray(this._localPosition,this._localRotation,this._localScale,this._localMatrix),this._localUpdate=!1),this._localMatrix},e._onWorldTransform=function(){if(!this._worldUpdate){this._worldUpdate=!0,this.event("transformchanged");for(var t=0,e=this._children.length;t<e;t++)this._children[t]._onWorldTransform()}},e.getWorldMatrix=function(){if(!qi.supportWebGLPlusAnimation&&this._worldUpdate){if(null!=this._parent)V.matrix4x4MultiplyFFF(this._parent.getWorldMatrix(),this._getlocalMatrix(),this._worldMatrix);else{var t=this._worldMatrix;t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1}this._worldUpdate=!1}return qi.supportWebGLPlusAnimation&&this._worldUpdate&&(this._worldUpdate=!1),this._worldMatrix},e.setParent=function(t){if(this._parent!==t){if(this._parent){var e=this._parent._children,i=e.indexOf(this);e.splice(i,1)}t&&(t._children.push(this),t&&this._onWorldTransform()),this._parent=t}},g(0,e,"localScale",function(){return this._localScale},function(t){this._localScale=t,this._localUpdate=!0,this._onWorldTransform()}),g(0,e,"localRotationEuler",function(){if(this._locaEulerlUpdate){this._localRotation.getYawPitchRoll(s._tempVector3);var t=s._tempVector3,e=this._localRotationEuler;e.x=t.y*s._angleToRandin,e.y=t.x*s._angleToRandin,e.z=t.z*s._angleToRandin,this._locaEulerlUpdate=!1}return this._localRotationEuler},function(t){this._localRotationEuler=t,this._locaEulerlUpdate=!1,this._localQuaternionUpdate=!0,this._localUpdate=!0,this._onWorldTransform()}),g(0,e,"localRotation",function(){if(this._localQuaternionUpdate){var t=this._localRotationEuler;Qt.createFromYawPitchRoll(t.y/s._angleToRandin,t.x/s._angleToRandin,t.z/s._angleToRandin,this._localRotation),this._localQuaternionUpdate=!1}return this._localRotation},function(t){this._localRotation=t,this._locaEulerlUpdate=!0,this._localQuaternionUpdate=!1,this._localUpdate=!0,this._onWorldTransform()}),g(0,e,"localPosition",function(){return this._localPosition},function(t){this._localPosition=t,this._localUpdate=!0,this._onWorldTransform()}),E(s,["_tempVector3",function(){return this._tempVector3=new ln},"_angleToRandin",function(){return this._angleToRandin=180/Math.PI}]),s}(),pr=function(t){function r(){this._shaderData=null,this._nameID=0,this._texture=null,r.__super.call(this)}I(r,"laya.d3.core.render.command.SetShaderDataTextureCMD",M);var e=r.prototype;return e.run=function(){this._shaderData.setTexture(this._nameID,this._texture)},e.recover=function(){r._pool.push(this),this._shaderData=null,this._nameID=0,this._texture=null},r.create=function(t,e,i){var n;return(n=0<r._pool.length?r._pool.pop():new r)._shaderData=t,n._nameID=e,n._texture=i,n},r._pool=[],r}(),mr=function(i){function u(){this.angle=NaN,this.radius=NaN,this.length=NaN,this.emitType=0,u.__super.call(this),this.angle=25/180*Math.PI,this.radius=1,this.length=5,this.emitType=0,this.randomDirection=!1}I(u,"laya.d3.core.particleShuriKen.module.shape.ConeShape",i);var t=u.prototype;return t._getShapeBoundBox=function(t){var e=this.radius+this.length*Math.sin(this.angle),i=this.length*Math.cos(this.angle),n=t.min;n.x=n.y=-e,n.z=0;var r=t.max;r.x=r.y=e,r.z=i},t._getSpeedBoundBox=function(t){var e=Math.sin(this.angle),i=t.min;i.x=i.y=-e,i.z=0;var n=t.max;n.x=n.y=e,n.z=1},t.generatePositionAndDirection=function(t,e,i,n){var r,s=u._tempPositionPoint,a=NaN,o=NaN,h=Math.cos(this.angle),l=Math.sin(this.angle);switch(this.emitType){case 0:i?(i.seed=n[16],oi._randomPointInsideUnitCircle(u._tempPositionPoint,i),n[16]=i.seed):oi._randomPointInsideUnitCircle(u._tempPositionPoint),a=s.x,o=s.y,t.x=a*this.radius,t.y=o*this.radius,t.z=0,this.randomDirection?(i?(i.seed=n[17],oi._randomPointInsideUnitCircle(u._tempDirectionPoint,i),n[17]=i.seed):oi._randomPointInsideUnitCircle(u._tempDirectionPoint),r=u._tempDirectionPoint,e.x=r.x*l,e.y=r.y*l):(e.x=a*l,e.y=o*l),e.z=h;break;case 1:i?(i.seed=n[16],oi._randomPointUnitCircle(u._tempPositionPoint,i),n[16]=i.seed):oi._randomPointUnitCircle(u._tempPositionPoint),a=s.x,o=s.y,t.x=a*this.radius,t.y=o*this.radius,t.z=0,this.randomDirection?(i?(i.seed=n[17],oi._randomPointInsideUnitCircle(u._tempDirectionPoint,i),n[17]=i.seed):oi._randomPointInsideUnitCircle(u._tempDirectionPoint),r=u._tempDirectionPoint,e.x=r.x*l,e.y=r.y*l):(e.x=a*l,e.y=o*l),e.z=h;break;case 2:i?(i.seed=n[16],oi._randomPointInsideUnitCircle(u._tempPositionPoint,i)):oi._randomPointInsideUnitCircle(u._tempPositionPoint),a=s.x,o=s.y,t.x=a*this.radius,t.y=o*this.radius,t.z=0,e.x=a*l,e.y=o*l,e.z=h,ln.normalize(e,e),i?(ln.scale(e,this.length*i.getFloat(),e),n[16]=i.seed):ln.scale(e,this.length*Math.random(),e),ln.add(t,e,t),this.randomDirection&&(i?(i.seed=n[17],oi._randomPointUnitSphere(e,i),n[17]=i.seed):oi._randomPointUnitSphere(e));break;case 3:i?(i.seed=n[16],oi._randomPointUnitCircle(u._tempPositionPoint,i)):oi._randomPointUnitCircle(u._tempPositionPoint),a=s.x,o=s.y,t.x=a*this.radius,t.y=o*this.radius,t.z=0,e.x=a*l,e.y=o*l,e.z=h,ln.normalize(e,e),i?(ln.scale(e,this.length*i.getFloat(),e),n[16]=i.seed):ln.scale(e,this.length*Math.random(),e),ln.add(t,e,t),this.randomDirection&&(i?(i.seed=n[17],oi._randomPointUnitSphere(e,i),n[17]=i.seed):oi._randomPointUnitSphere(e));break;default:throw new Error("ConeShape:emitType is invalid.")}},t.cloneTo=function(t){i.prototype.cloneTo.call(this,t);var e=t;e.angle=this.angle,e.radius=this.radius,e.length=this.length,e.emitType=this.emitType,e.randomDirection=this.randomDirection},E(u,["_tempPositionPoint",function(){return this._tempPositionPoint=new un},"_tempDirectionPoint",function(){return this._tempDirectionPoint=new un}]),u}(Kt),gr=function(n){function r(){r.__super.call(this),this._childColliderShapes=[],this._type=5,this._nativeShape=new In._physics3D.btCompoundShape}I(r,"laya.d3.physics.shape.CompoundColliderShape",n);var t=r.prototype;return t._clearChildShape=function(t){t._attatched=!1,t._compoundParent=null,t._indexInCompound=-1},t._addReference=function(){},t._removeReference=function(){},t._updateChildTransform=function(t){var e=t.localOffset,i=t.localRotation,n=J._nativeVector30,r=J._nativQuaternion0,s=J._nativeTransform0;n.setValue(-e.x,e.y,e.z),r.setValue(-i.x,i.y,i.z,-i.w),s.setOrigin(n),s.setRotation(r),this._nativeShape.updateChildTransform(t._indexInCompound,s,!0)},t.addChildShape=function(t){if(t._attatched)throw"CompoundColliderShape: this shape has attatched to other entity.";t._attatched=!0,t._compoundParent=this,t._indexInCompound=this._childColliderShapes.length,this._childColliderShapes.push(t);var e=t.localOffset,i=t.localRotation;r._nativeOffset.setValue(-e.x,e.y,e.z),r._nativRotation.setValue(-i.x,i.y,i.z,-i.w),r._nativeTransform.setOrigin(r._nativeOffset),r._nativeTransform.setRotation(r._nativRotation);var n=this._nativeShape.getLocalScaling();this._nativeShape.setLocalScaling(r._nativeVector3One),this._nativeShape.addChildShape(r._nativeTransform,t._nativeShape),this._nativeShape.setLocalScaling(n),this._attatchedCollisionObject&&(this._attatchedCollisionObject.colliderShape=this)},t.removeChildShape=function(t){if(t._compoundParent===this){var e=t._indexInCompound;this._clearChildShape(t);var i=this._childColliderShapes[this._childColliderShapes.length-1];i._indexInCompound=e,this._childColliderShapes[e]=i,this._childColliderShapes.pop(),this._nativeShape.removeChildShapeByIndex(e)}},t.clearChildShape=function(){for(var t=0,e=this._childColliderShapes.length;t<e;t++)this._clearChildShape(this._childColliderShapes[t]),this._nativeShape.removeChildShapeByIndex(0);this._childColliderShapes.length=0},t.getChildShapeCount=function(){return this._childColliderShapes.length},t.cloneTo=function(t){var e=t;e.clearChildShape();for(var i=0,n=this._childColliderShapes.length;i<n;i++)e.addChildShape(this._childColliderShapes[i].clone())},t.clone=function(){var t=new r;return this.cloneTo(t),t},t.destroy=function(){n.prototype.destroy.call(this);for(var t=0,e=this._childColliderShapes.length;t<e;t++){var i=this._childColliderShapes[t];0===i._referenceCount&&i.destroy()}},E(r,["_nativeVector3One",function(){return this._nativeVector3One=new In._physics3D.btVector3(1,1,1)},"_nativeTransform",function(){return this._nativeTransform=new In._physics3D.btTransform},"_nativeOffset",function(){return this._nativeOffset=new In._physics3D.btVector3(0,0,0)},"_nativRotation",function(){return this._nativRotation=new In._physics3D.btQuaternion(0,0,0,1)}]),r}(J),vr=function(i){function t(){this.radius=NaN,this.emitFromShell=!1,t.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}I(t,"laya.d3.core.particleShuriKen.module.shape.SphereShape",i);var e=t.prototype;return e._getShapeBoundBox=function(t){var e=t.min;e.x=e.y=e.z=-this.radius;var i=t.max;i.x=i.y=i.z=this.radius},e._getSpeedBoundBox=function(t){var e=t.min;e.x=e.y=e.z=-1;var i=t.max;i.x=i.y=i.z=1},e.generatePositionAndDirection=function(t,e,i,n){i?(i.seed=n[16],this.emitFromShell?oi._randomPointUnitSphere(t,i):oi._randomPointInsideUnitSphere(t,i),n[16]=i.seed):this.emitFromShell?oi._randomPointUnitSphere(t):oi._randomPointInsideUnitSphere(t),ln.scale(t,this.radius,t),this.randomDirection?i?(i.seed=n[17],oi._randomPointUnitSphere(e,i),n[17]=i.seed):oi._randomPointUnitSphere(e):t.cloneTo(e)},e.cloneTo=function(t){i.prototype.cloneTo.call(this,t);var e=t;e.radius=this.radius,e.emitFromShell=this.emitFromShell,e.randomDirection=this.randomDirection},t}(Kt),Tr=function(t){function e(){e.__super.call(this)}I(e,"laya.d3.physics.PhysicsUpdateList",u);var i=e.prototype;return i.add=function(t){if(-1!==t._inPhysicUpdateListIndex)throw"PhysicsUpdateList:element has  in  PhysicsUpdateList.";this._add(t),t._inPhysicUpdateListIndex=this.length++},i.remove=function(t){var e=t._inPhysicUpdateListIndex;if(this.length--,e!==this.length){var i=this.elements[this.length];(this.elements[e]=i)._inPhysicUpdateListIndex=e}t._inPhysicUpdateListIndex=-1},e}(),yr=function(t){function a(){this._source=null,this._dest=null,this._shader=null,this._shaderData=null,this._subShader=0,a.__super.call(this)}I(a,"laya.d3.core.render.command.BlitCMD",M);var e=a.prototype;return e.run=function(){this._shaderData.setTexture(rn.SCREENTEXTURE_ID,this._source);var t=this._dest;t&&t._start();for(var e=this._shader.getSubShaderAt(this._subShader)._passes,i=0,n=e.length;i<n;i++){var r=e[i].withCompile(0,0,0);r.bind(),this._shaderData&&r.uploadUniforms(r._materialUniformParamsMap,this._shaderData,!0),r.uploadRenderStateBlendDepth(this._shaderData),r.uploadRenderStateFrontFace(this._shaderData,!0,null),gs.instance.render()}t&&t._end()},e.recover=function(){a._pool.push(this),this._dest=null,this._shader=null,this._shaderData=null},a.create=function(t,e,i,n,r){var s;return void 0===r&&(r=0),(s=0<a._pool.length?a._pool.pop():new a)._source=t,s._dest=e,s._shader=i,s._shaderData=n,s._subShader=r,s},a._pool=[],a}(),Er=function(t){function n(t,e,i){switch(this._radius=1,this._height=.5,n.__super.call(this),void 0===t&&(t=.5),void 0===e&&(e=1),void 0===i&&(i=1),this._radius=t,this._height=e,this._orientation=i,this._type=2,i){case 0:this._nativeShape=new In._physics3D.btConeShapeX(t,e);break;case 1:this._nativeShape=new In._physics3D.btConeShape(t,e);break;case 2:this._nativeShape=new In._physics3D.btConeShapeZ(t,e);break;default:throw"ConeColliderShape:unknown orientation."}}I(n,"laya.d3.physics.shape.ConeColliderShape",J);var e=n.prototype;return e.clone=function(){var t=new n(this._radius,this._height,this._orientation);return this.cloneTo(t),t},g(0,e,"orientation",function(){return this._orientation}),g(0,e,"height",function(){return this._height}),g(0,e,"radius",function(){return this._radius}),n}(),xr=function(t){function C(t,e,i,n){this.uvrect=[0,0,1,1],this._destroyed=!1,this._referenceCount=0,this.$_GID=0,this.offsetX=0,this.offsetY=0,this._w=0,this._h=0,this.sourceWidth=0,this.sourceHeight=0,this.url=null,this.scaleRate=1,C.__super.call(this),void 0===i&&(i=0),void 0===n&&(n=0),this.setTo(t,e,i,n)}I(C,"laya.resource.Texture",o);var e=C.prototype;return e._addReference=function(){this._bitmap&&this._bitmap._addReference(),this._referenceCount++},e._removeReference=function(){this._bitmap&&this._bitmap._removeReference(),this._referenceCount--},e._getSource=function(t){return this._destroyed||!this._bitmap?null:(this.recoverBitmap(t),this._bitmap.destroyed?null:this.bitmap._getSource())},e._onLoaded=function(t,e){if(e)if(e==this);else if(e instanceof laya.resource.Texture){var i=e;C._create(e,0,0,i.width,i.height,0,0,i.sourceWidth,i.sourceHeight,this)}else this.bitmap=e,this.sourceWidth=this._w=e.width,this.sourceHeight=this._h=e.height;else;t&&t.run(),this.event("ready",this)},e.getIsReady=function(){return!this._destroyed&&!!this._bitmap},e.setTo=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0),this.bitmap=t,this.sourceWidth=i,this.sourceHeight=n,t&&(this._w=t.width,this._h=t.height,this.sourceWidth=this.sourceWidth||t.width,this.sourceHeight=this.sourceHeight||t.height),this.uv=e||C.DEF_UV},e.load=function(t,e){this._destroyed||T.loader.load(t,y.create(this,this._onLoaded,[e]),null,"htmlimage",1,!1,null,!0)},e.getTexturePixels=function(t,e,i,n){var r=0,s=0,a=0,o=this.bitmap,h=o.width,l=o.height;if(h<t+i&&(i-=t+i-h),l<e+n&&(n-=e+n-l),i<=0||n<=0)return null;var u=4*i,c=null;try{c=o.getPixels()}catch(t){}if(c){if(0==t&&0==e&&i==h&&n==l)return c;var _=new Uint8Array(i*n*4);for(s=(e+n-1)*(u=4*h)+(r=4*t),a=n-1;0<=a;a--)_.set(T.slice(s,s+4*i),r),r+=u,s-=u;return _}var d=new ji;d.size(i,n),d.asBitmap=!0;var f=null;if(0!=t||0!=e||i!=h||n!=l){var p=(f=f.concat())[0],m=f[1],g=(f[2]-p)/h,v=(f[7]-m)/l;f=[p+t*g,m+e*v,p+(t+i)*g,m+e*v,p+(t+i)*g,m+(e+n)*v,p+t*g,m+(e+n)*v]}d._drawTextureM(this,0,0,i,n,null,1,f),d._targets.start(),d.flush(),d._targets.end(),d._targets.restore();var T=d._targets.getData(0,0,i,n);for(d.destroy(),_=new Uint8Array(i*n*4),r=0,s=(n-1)*u,a=n-1;0<=a;a--)_.set(T.slice(s,s+u),r),r+=u,s-=u;return _},e.getPixels=function(t,e,i,n){return qi.isConchApp?this._nativeObj.getImageData(t,e,i,n):this.getTexturePixels(t,e,i,n)},e.recoverBitmap=function(e){var i=this,t=this._bitmap.url;this._destroyed||this._bitmap&&!this._bitmap.destroyed||!t||T.loader.load(t,y.create(this,function(t){i.bitmap=t,e&&e()}),null,"htmlimage",1,!1,null,!0)},e.disposeBitmap=function(){!this._destroyed&&this._bitmap&&this._bitmap.destroy()},e.destroy=function(t){if(void 0===t&&(t=!1),!this._destroyed){this._destroyed=!0;var e=this._bitmap;e&&(e._removeReference(this._referenceCount),(0===e.referenceCount||t)&&e.destroy(),e=null),this.url&&this===T.loader.getRes(this.url)&&T.loader.clearRes(this.url)}},g(0,e,"bitmap",function(){return this._bitmap},function(t){this._bitmap&&this._bitmap._removeReference(this._referenceCount),(this._bitmap=t)&&t._addReference(this._referenceCount)}),g(0,e,"height",function(){return this._h?this._h:this.bitmap?this.uv&&this.uv!==C.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height:0},function(t){this._h=t,this.sourceHeight||(this.sourceHeight=t)}),g(0,e,"width",function(){return this._w?this._w:this.bitmap?this.uv&&this.uv!==C.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width:0},function(t){this._w=t,this.sourceWidth||(this.sourceWidth=t)}),g(0,e,"destroyed",function(){return this._destroyed}),g(0,e,"uv",function(){return this._uv},function(t){this.uvrect[0]=Math.min(t[0],t[2],t[4],t[6]),this.uvrect[1]=Math.min(t[1],t[3],t[5],t[7]),this.uvrect[2]=Math.max(t[0],t[2],t[4],t[6])-this.uvrect[0],this.uvrect[3]=Math.max(t[1],t[3],t[5],t[7])-this.uvrect[1],this._uv=t}),C.moveUV=function(t,e,i){for(var n=0;n<8;n+=2)i[n]+=t,i[n+1]+=e;return i},C.create=function(t,e,i,n,r,s,a,o,h){return void 0===s&&(s=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===h&&(h=0),C._create(t,e,i,n,r,s,a,o,h)},C._create=function(t,e,i,n,r,s,a,o,h,l){void 0===s&&(s=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===h&&(h=0);var u,c=t instanceof laya.resource.Texture,_=c?t.uv:C.DEF_UV,d=c?t.bitmap:t;d.width&&e+n>d.width&&(n=d.width-e),d.height&&i+r>d.height&&(r=d.height-i),l?(u=l).setTo(d,null,o||n,h||r):u=new C(d,null,o||n,h||r),u.width=n,u.height=r,u.offsetX=s,u.offsetY=a;var f=1/d.width,p=1/d.height;e*=f,i*=p,n*=f,r*=p;var m=u.uv[0],g=u.uv[1],v=u.uv[4],T=u.uv[5],y=v-m,E=T-g,x=C.moveUV(_[0],_[1],[e,i,e+n,i,e+n,i+r,e,i+r]);u.uv=new Float32Array([m+x[0]*y,g+x[1]*E,v-(1-x[2])*y,g+x[3]*E,v-(1-x[4])*y,T-(1-x[5])*E,m+x[6]*y,T-(1-x[7])*E]);var S=d.scaleRate;return u.scaleRate=S&&1!=S?(u.sourceWidth/=S,u.sourceHeight/=S,u.width/=S,u.height/=S,S):1,u},C.createFromTexture=function(t,e,i,n,r){var s=t.scaleRate;1!=s&&(e*=s,i*=s,n*=s,r*=s);var a=ve.TEMP.setTo(e-t.offsetX,i-t.offsetY,n,r),o=a.intersection(C._rect1.setTo(0,0,t.width,t.height),C._rect2);return o?C.create(t,o.x,o.y,o.width,o.height,o.x-a.x,o.y-a.y,n,r):null},C.DEF_UV=new Float32Array([0,0,1,0,1,1,0,1]),C.NO_UV=new Float32Array([0,0,0,0,0,0,0,0]),C.INV_UV=new Float32Array([0,1,1,1,1,0,0,0]),C._rect1=new ve,C._rect2=new ve,C}(),Sr=function(t){function n(t,e,i){switch(this._radius=1,this._height=.5,n.__super.call(this),void 0===t&&(t=.5),void 0===e&&(e=1),void 0===i&&(i=1),this._radius=t,this._height=e,this._orientation=i,this._type=2,i){case 0:n._nativeSize.setValue(e/2,t,t),this._nativeShape=new In._physics3D.btCylinderShapeX(n._nativeSize);break;case 1:n._nativeSize.setValue(t,e/2,t),this._nativeShape=new In._physics3D.btCylinderShape(n._nativeSize);break;case 2:n._nativeSize.setValue(t,t,e/2),this._nativeShape=new In._physics3D.btCylinderShapeZ(n._nativeSize);break;default:throw"CapsuleColliderShape:unknown orientation."}}I(n,"laya.d3.physics.shape.CylinderColliderShape",J);var e=n.prototype;return e.clone=function(){var t=new n(this._radius,this._height,this._orientation);return this.cloneTo(t),t},g(0,e,"orientation",function(){return this._orientation}),g(0,e,"height",function(){return this._height}),g(0,e,"radius",function(){return this._radius}),E(n,["_nativeSize",function(){return this._nativeSize=new In._physics3D.btVector3(0,0,0)}]),n}(),Cr=function(t){function e(t){this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null,this._indexInMesh=0,this._vertexStart=0,this._indexStart=0,this._indexCount=0,this._indices=null,this._vertexBuffer=null,this._indexBuffer=null,this._id=0,e.__super.call(this),this._id=++e._uniqueIDCounter,this._mesh=t,this._boneIndicesList=[],this._subIndexBufferStart=[],this._subIndexBufferCount=[]}I(e,"laya.d3.resource.models.SubMesh",t);var i=e.prototype;return i._getType=function(){return e._type},i._render=function(t){this._mesh._bufferState.bind();var e=t.renderElement.render._skinnedData;if(e)for(var i=e[this._indexInMesh],n=this._boneIndicesList.length,r=0;r<n;r++)t.shader.uploadCustomUniform(aa.BONES,i[r]),Nt.instance.drawElements(4,this._subIndexBufferCount[r],5123,2*this._subIndexBufferStart[r]);else Nt.instance.drawElements(4,this._indexCount,5123,2*this._indexStart);$i.trianglesFaces+=this._indexCount/3,$i.renderBatches++},i.getIndices=function(){return this._indices},i.destroy=function(){this._destroyed||(t.prototype.destroy.call(this),this._indexBuffer.destroy(),this._indexBuffer=null,this._mesh=null,this._boneIndicesList=null,this._subIndexBufferStart=null,this._subIndexBufferCount=null,this._skinAnimationDatas=null)},e._uniqueIDCounter=0,E(e,["_type",function(){return this._type=X._typeCounter++}]),e}(X),Ir=function(e){function h(t){this._floatCountPerVertices1=8,this._floatCountPerVertices2=1,this._increaseSegementCount=128,this._activeIndex=0,this._endIndex=0,this._needAddFirstVertex=!1,this._isTempEndVertex=!1,this._subBirthTime=null,this._subDistance=null,this._segementCount=0,this._vertices1=null,this._vertices2=null,this._vertexBuffer1=null,this._vertexBuffer2=null,this._owner=null,h.__super.call(this),this._lastFixedVertexPosition=new ln,this._bufferState=new Mr,this._owner=t,this._resizeData(this._increaseSegementCount,this._bufferState)}I(h,"laya.d3.core.trail.TrailGeometry",e);var t=h.prototype;return t._resizeData=function(t,e){this._segementCount=this._increaseSegementCount,this._subBirthTime=new Float32Array(t),this._subDistance=new Float32Array(t);var i=2*t,n=te.vertexDeclaration1,r=te.vertexDeclaration2,s=[],a=i*n.vertexStride,o=i*r.vertexStride,h=a+o;this._vertices1=new Float32Array(i*this._floatCountPerVertices1),this._vertexBuffer1=new zn(a,35044,!1),this._vertexBuffer1.vertexDeclaration=n,this._vertices2=new Float32Array(i*this._floatCountPerVertices2),this._vertexBuffer2=new zn(o,35048,!1),this._vertexBuffer2.vertexDeclaration=r,s.push(this._vertexBuffer1),s.push(this._vertexBuffer2),e.bind(),e.applyVertexBuffers(s),e.unBind(),Nn._addMemory(h,h)},t._resetData=function(){var t=this._endIndex-this._activeIndex;t==this._segementCount&&(this._vertexBuffer1.destroy(),this._vertexBuffer2.destroy(),this._segementCount+=this._increaseSegementCount,this._resizeData(this._segementCount,this._bufferState)),this._vertexBuffer1.setData(this._vertices1,0,2*this._floatCountPerVertices1*this._activeIndex,2*this._floatCountPerVertices1*t),this._vertexBuffer2.setData(this._vertices2,0,2*this._floatCountPerVertices2*this._activeIndex,2*this._floatCountPerVertices2*t);var e=4*this._activeIndex,i=new Float32Array(this._subDistance.buffer,e,t),n=new Float32Array(this._subBirthTime.buffer,e,t);this._subDistance.set(i,0),this._subBirthTime.set(n,0),this._endIndex=t,this._activeIndex=0},t._updateTrail=function(t,e,i){ln.equals(e,i)||(this._endIndex-this._activeIndex==0?this._addTrailByFirstPosition(t,i):this._addTrailByNextPosition(t,i))},t._addTrailByFirstPosition=function(t,e){this._endIndex===this._segementCount&&this._resetData(),this._subDistance[this._endIndex]=0,this._subBirthTime[this._endIndex]=this._owner._curtime,this._endIndex++,e.cloneTo(this._lastFixedVertexPosition),this._needAddFirstVertex=!0},t._addTrailByNextPosition=function(t,e){var i=h._tempVector30,n=h._tempVector31;ln.subtract(e,this._lastFixedVertexPosition,i);var r=h._tempVector32;switch(this._owner.alignment){case 0:t.transform.getForward(r),ln.cross(i,r,n);break;case 1:this._owner._owner.transform.getForward(r),ln.cross(i,r,n)}ln.normalize(n,n),ln.scale(n,this._owner.widthMultiplier/2,n);var s=ln.scalarLength(i),a=0,o=NaN;this._needAddFirstVertex&&(this._updateVerticesByPositionData(e,n,this._endIndex-1),this._needAddFirstVertex=!1),s-this._owner.minVertexDistance>=k.zeroTolerance?(this._isTempEndVertex?(a=this._endIndex-1,o=s-this._subDistance[a],this._updateVerticesByPosition(e,n,s,a),this._owner._totalLength+=o):(this._endIndex===this._segementCount&&this._resetData(),this._updateVerticesByPosition(e,n,s,this._endIndex),this._owner._totalLength+=s,this._endIndex++),e.cloneTo(this._lastFixedVertexPosition),this._isTempEndVertex=!1):(this._isTempEndVertex?(a=this._endIndex-1,o=s-this._subDistance[a],this._updateVerticesByPosition(e,n,s,a),this._owner._totalLength+=o):(this._endIndex===this._segementCount&&this._resetData(),this._updateVerticesByPosition(e,n,s,this._endIndex),this._owner._totalLength+=s,this._endIndex++),this._isTempEndVertex=!0)},t._updateVerticesByPositionData=function(t,e,i){var n=2*this._floatCountPerVertices1*i,r=this._owner._curtime;this._vertices1[n]=t.x,this._vertices1[n+1]=t.y,this._vertices1[n+2]=t.z,this._vertices1[n+3]=-e.x,this._vertices1[n+4]=-e.y,this._vertices1[n+5]=-e.z,this._vertices1[n+6]=r,this._vertices1[n+7]=1,this._vertices1[n+8]=t.x,this._vertices1[n+9]=t.y,this._vertices1[n+10]=t.z,this._vertices1[n+11]=e.x,this._vertices1[n+12]=e.y,this._vertices1[n+13]=e.z,this._vertices1[n+14]=r,this._vertices1[n+15]=0;var s=2*this._floatCountPerVertices1;this._vertexBuffer1.setData(this._vertices1,n,n,s)},t._updateVerticesByPosition=function(t,e,i,n){this._updateVerticesByPositionData(t,e,n),this._subDistance[n]=i,this._subBirthTime[n]=this._owner._curtime},t._updateVertexBufferUV=function(){for(var t=this._endIndex,e=0,i=this._activeIndex,n=t;i<n;i++){i!==this._activeIndex&&(e+=this._subDistance[i]);var r=NaN;r=0==this._owner.textureMode?1-e/this._owner._totalLength:1-(this._owner._totalLength-e),this._vertices2[2*i]=r,this._vertices2[2*i+1]=r}var s=2*this._activeIndex;this._vertexBuffer2.setData(this._vertices2,s,s,2*t-s)},t._updateDisappear=function(){for(var t=this._endIndex,e=this._activeIndex;e<t&&this._owner._curtime-this._subBirthTime[e]>=this._owner.time+k.zeroTolerance;e++){var i=e+1;if(i!==t&&(this._owner._totalLength-=this._subDistance[i]),this._isTempEndVertex&&i===t-1){this._floatCountPerVertices1;var n=this._lastFixedVertexPosition;n.x=this._vertices1[0],n.y=this._vertices1[1],n.z=this._vertices1[2],this._isTempEndVertex=!1}this._activeIndex++}},t._getType=function(){return h._type},t._prepareRender=function(t){return 1<this._endIndex-this._activeIndex},t._render=function(t){this._bufferState.bind();var e=2*this._activeIndex,i=2*this._endIndex-e;Nt.instance.drawArrays(5,e,i),$i.renderBatches++,$i.trianglesFaces+=i-2},t.destroy=function(){e.prototype.destroy.call(this);var t=this._vertexBuffer1._byteLength+this._vertexBuffer2._byteLength;Nn._addMemory(-t,-t),this._bufferState.destroy(),this._vertexBuffer1.destroy(),this._vertexBuffer2.destroy(),this._bufferState=null,this._vertices1=null,this._vertexBuffer1=null,this._vertices2=null,this._vertexBuffer2=null,this._subBirthTime=null,this._subDistance=null,this._lastFixedVertexPosition=null},E(h,["_tempVector30",function(){return this._tempVector30=new ln},"_tempVector31",function(){return this._tempVector31=new ln},"_tempVector32",function(){return this._tempVector32=new ln},"_type",function(){return this._type=X._typeCounter++}]),h}(X),Rr=function(t){function e(){e.__super.call(this)}I(e,"laya.d3.component.SimpleSingletonList",u);var i=e.prototype;return i.add=function(t){if(-1!==t._getIndexInList())throw"SimpleSingletonList:"+t+" has  in  SingletonList.";this._add(t),t._setIndexInList(this.length++)},i.remove=function(t){var e=t._getIndexInList();if(this.length--,e!==this.length){var i=this.elements[this.length];(this.elements[e]=i)._setIndexInList(e)}t._setIndexInList(-1)},e}(),Ar=function(t){function i(){this._vertices=null,this._indices=null,this._positionOffset=0,this._normalOffset=0,this._colorOffset=0,this._uv0Offset=0,this._uv1Offset=0,this._sTangentOffset=0,this._vertexBuffer=null,this._indexBuffer=null,i.__super.call(this),this._bufferState=new Mr;var t=32e3*Si.getVertexDeclaration("POSITION,NORMAL,COLOR,UV,UV1,TANGENT").vertexStride;this._vertices=new Float32Array(t/4),this._vertexBuffer=new zn(t,35048),this._indices=new Int16Array(32e3),this._indexBuffer=new dr("ushort",this._indices.length,35048);var e=this._vertexBuffer._byteLength+this._indexBuffer._byteLength;Nn._addMemory(e,e)}I(i,"laya.d3.graphics.SubMeshDynamicBatch",X);var e=i.prototype;return e._getBatchVertices=function(t,e,i,n,r,s){var a=t.vertexStride/4,o=s._vertexBuffer.getData(),h=(r.render.lightmapScaleOffset,r._dynamicMultiSubMesh),l=r._dynamicVertexCount;r._computeWorldPositionsAndNormals(this._positionOffset,this._normalOffset,h,l);for(var u=r._dynamicWorldPositions,c=r._dynamicWorldNormals,_=s._indices,d=0;d<l;d++){var f=(h?_[d]:d)*a,p=(d+i)*a,m=3*d,g=p+this._positionOffset;e[g]=u[m],e[g+1]=u[m+1],e[g+2]=u[m+2],-1!==this._normalOffset&&(e[g=p+this._normalOffset]=c[m],e[g+1]=c[m+1],e[g+2]=c[m+2]),-1!==this._colorOffset&&(g=p+this._colorOffset,m=f+this._colorOffset,e[g]=o[m],e[g+1]=o[m+1],e[g+2]=o[m+2],e[g+3]=o[m+3]),-1!==this._uv0Offset&&(g=p+this._uv0Offset,m=f+this._uv0Offset,e[g]=o[m],e[g+1]=o[m+1]),-1!==this._sTangentOffset&&(g=p+this._sTangentOffset,m=f+this._sTangentOffset,e[g]=o[m],e[g+1]=o[m+1],e[g+2]=o[m+2],e[g+3]=o[m+3],g=p+this._sTangentOffset,m=f+this._sTangentOffset,e[g]=o[m],e[g+1]=o[m+1],e[g+2]=o[m+2],e[g+3]=o[m+3])}},e._getBatchIndices=function(t,e,i,n,r,s){var a=r._indices,o=0,h=0,l=0,u=n._isFrontFaceInvert;if(s)if(u)for(o=0,h=a.length;o<h;o+=3){var c=i+o;t[l=e+o]=c,t[l+1]=c+2,t[l+2]=c+1}else for(o=h,h=a.length;o<h;o+=3)c=i+o,t[l=e+o]=c,t[l+1]=c+1,t[l+2]=c+2;else if(u)for(o=0,h=a.length;o<h;o+=3)t[l=e+o]=i+a[o],t[l+1]=i+a[o+2],t[l+2]=i+a[o+1];else for(o=h,h=a.length;o<h;o+=3)t[l=e+o]=i+a[o],t[l+1]=i+a[o+1],t[l+2]=i+a[o+2]},e._flush=function(t,e){this._vertexBuffer.setData(this._vertices,0,0,t*(this._vertexBuffer.vertexDeclaration.vertexStride/4)),this._indexBuffer.setData(this._indices,0,0,e),Nt.instance.drawElements(4,e,5123,0)},e._prepareRender=function(t){var e=t.renderElement.vertexBatchVertexDeclaration;this._bufferState=Ur.instance._getBufferState(e),this._positionOffset=e.getVertexElementByUsage(0).offset/4;var i=e.getVertexElementByUsage(3);this._normalOffset=i?i.offset/4:-1;var n=e.getVertexElementByUsage(1);this._colorOffset=n?n.offset/4:-1;var r=e.getVertexElementByUsage(2);this._uv0Offset=r?r.offset/4:-1;var s=e.getVertexElementByUsage(7);this._uv1Offset=s?s.offset/4:-1;var a=e.getVertexElementByUsage(4);return this._sTangentOffset=a?a.offset/4:-1,!0},e._render=function(t){this._bufferState.bind();for(var e=t.renderElement,i=e.vertexBatchVertexDeclaration,n=e.vertexBatchElementList,r=0,s=0,a=(i.vertexStride,0),o=n.length,h=0;h<o;h++){var l=n[h],u=l._geometry,c=u._indexCount;32e3<s+c&&(this._flush(r,s),a++,$i.trianglesFaces+=s/3,r=s=0);var _=l._transform;this._getBatchVertices(i,this._vertices,r,_,l,u),this._getBatchIndices(this._indices,s,r,_,u,l._dynamicMultiSubMesh),r+=l._dynamicVertexCount,s+=c}this._flush(r,s),a++,$i.renderBatches+=a,$i.savedRenderBatches+=o-a,$i.trianglesFaces+=s/3},i.maxAllowVertexCount=10,i.maxAllowAttribueCount=900,i.maxIndicesCount=32e3,i.instance=null,i}(),Mr=function(t){function e(){e.__super.call(this)}I(e,"laya.d3.core.BufferState",W);var i=e.prototype;return i.applyVertexBuffer=function(t){if(W._curBindedBufferState!==this)throw"BufferState: must call bind() function first.";var e=Nt.instance,i=t.vertexDeclaration,n=null;for(var r in n=qi.supportWebGLPlusRendering?i._shaderValues._nativeArray:i._shaderValues.getData(),t.bind(),n){var s=parseInt(r),a=n[r];e.enableVertexAttribArray(s),e.vertexAttribPointer(s,a[0],a[1],!!a[2],a[3],a[4])}},i.applyVertexBuffers=function(t){if(W._curBindedBufferState!==this)throw"BufferState: must call bind() function first.";for(var e=Nt.instance,i=0,n=t.length;i<n;i++){var r=t[i],s=r.vertexDeclaration,a=null;for(var o in a=qi.supportWebGLPlusRendering?s._shaderValues._nativeArray:s._shaderValues.getData(),r.bind(),a){var h=parseInt(o),l=a[o];e.enableVertexAttribArray(h),e.vertexAttribPointer(h,l[0],l[1],!!l[2],l[3],l[4])}}},i.applyInstanceVertexBuffer=function(t){if(j._angleInstancedArrays){if(W._curBindedBufferState!==this)throw"BufferState: must call bind() function first.";var e=Nt.instance,i=t.vertexDeclaration,n=null;for(var r in n=qi.supportWebGLPlusRendering?i._shaderValues._nativeArray:i._shaderValues.getData(),t.bind(),n){var s=parseInt(r),a=n[r];e.enableVertexAttribArray(s),e.vertexAttribPointer(s,a[0],a[1],!!a[2],a[3],a[4]),j._angleInstancedArrays.vertexAttribDivisorANGLE(s,1)}}},i.applyIndexBuffer=function(t){if(W._curBindedBufferState!==this)throw"BufferState: must call bind() function first.";this._bindedIndexBuffer!==t&&(t._bindForVAO(),this._bindedIndexBuffer=t)},e}(),Dr=function(t){function n(){this.totalCount=0,this._completeHandler=null,this._toLoadList=null,this._isLoading=!1,this._curUrl=null,n.__super.call(this),this._completeHandler=new y(this,this.onOneLoadComplete),this.reset()}I(n,"laya.net.SceneLoader",o);var e=n.prototype;return e.reset=function(){this._toLoadList=[],this._isLoading=!1,this.totalCount=0},e.load=function(t,e,i){if(void 0===e&&(e=!1),void 0===i&&(i=!0),t instanceof Array){var n,r=0;for(n=t.length,r=0;r<n;r++)this._addToLoadList(t[r],e)}else this._addToLoadList(t,e);i&&this._checkNext()},e._addToLoadList=function(t,e){void 0===e&&(e=!1),0<=this._toLoadList.indexOf(t)||Hn.getRes(t)||(e?this._toLoadList.push({url:t}):this._toLoadList.push(t),this.totalCount++)},e._checkNext=function(){if(!this._isLoading){if(0==this._toLoadList.length)return void this.event("complete");var t;"string"==typeof(t=this._toLoadList.pop())?this.loadOne(t):this.loadOne(t.url,!0)}},e.loadOne=function(t,e){void 0===e&&(e=!1),this._curUrl=t;var i=nt.getFileExtension(this._curUrl);e?T.loader.create(t,this._completeHandler):n.LoadableExtensions[i]?T.loader.load(t,this._completeHandler,null,n.LoadableExtensions[i]):t!=Vi.getFileLoadPath(t)||n.No3dLoadTypes[i]||!Jn.createMap[i]?T.loader.load(t,this._completeHandler):T.loader.create(t,this._completeHandler)},e.onOneLoadComplete=function(){this._isLoading=!1,Hn.getRes(this._curUrl)||console.log("Fail to load:",this._curUrl);var t,e=nt.getFileExtension(this._curUrl);n.LoadableExtensions[e]&&((t=Hn.getRes(this._curUrl))&&t instanceof laya.components.Prefab&&(t=t.json),t&&(t.loadList&&this.load(t.loadList,!1,!1),t.loadList3D&&this.load(t.loadList3D,!0,!1)));"sk"==e&&this.load(this._curUrl.replace(".sk",".png"),!1,!1),this.event("progress",this.getProgress()),this._checkNext()},e.getProgress=function(){return this.loadedCount/this.totalCount},g(0,e,"loadedCount",function(){return this.totalCount-this.leftCount}),g(0,e,"leftCount",function(){return this._isLoading?this._toLoadList.length+1:this._toLoadList.length}),E(n,["LoadableExtensions",function(){return this.LoadableExtensions={scene:"json",scene3d:"json",ani:"json",ui:"json",prefab:"prefab"}},"No3dLoadTypes",function(){return this.No3dLoadTypes={png:!0,jpg:!0,txt:!0}}]),n}(),br=function(t){function f(t,e,i,n,r,s,a,o,h,l,u,c,_,d){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,f.__super.call(this),this._cornerTextureCoordinate=t,this._positionStartLifeTime=e,this._velocity=i,this._startColor=n,this._startSize=r,this._startRotation0=s,this._startRotation1=a,this._startRotation2=o,this._startLifeTime=h,this._time=l,this._startSpeed=u,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=d}I(f,"laya.d3.graphics.Vertex.VertexShurikenParticleBillboard",le);var e=f.prototype;return g(0,e,"simulationWorldPostion",function(){return this._simulationWorldPostion}),g(0,e,"time",function(){return this._time}),g(0,e,"startLifeTime",function(){return this._startLifeTime}),g(0,e,"startRotation2",function(){return this._startRotation2}),g(0,e,"startRotation1",function(){return this._startRotation1}),g(0,e,"random0",function(){return this._randoms0}),g(0,e,"startRotation0",function(){return this._startRotation0}),g(0,e,"startSize",function(){return this._startSize}),g(0,e,"random1",function(){return this._randoms1}),g(0,e,"startColor",function(){return this._startColor}),g(0,e,"startSpeed",function(){return this._startSpeed}),g(0,e,"velocity",function(){return this._velocity}),g(0,e,"positionStartLifeTime",function(){return this._positionStartLifeTime}),g(0,e,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),g(1,f,"vertexDeclaration",function(){return f._vertexDeclaration},laya.d3.graphics.Vertex.VertexShuriKenParticle._$SET_vertexDeclaration),E(f,["_vertexDeclaration",function(){return this._vertexDeclaration=new D(152,[new lt(0,"vector4",0),new lt(16,"vector4",4),new lt(32,"vector4",5),new lt(48,"vector4",6),new lt(64,"vector3",8),new lt(76,"vector3",9),new lt(88,"single",10),new lt(92,"vector4",11),new lt(108,"vector4",12),new lt(124,"vector3",13),new lt(136,"vector4",14)])}]),f}(),wr=function(t){function e(){this.italic=!1,e.__super.call(this)}I(e,"laya.display.css.TextStyle",t);var i=e.prototype;return i.reset=function(){return t.prototype.reset.call(this),this.italic=!1,this.align="left",this.wordWrap=!1,this.leading=0,this.padding=[0,0,0,0],this.bgColor=null,this.borderColor=null,this.asPassword=!1,this.stroke=0,this.strokeColor="#000000",this.bold=!1,this.underline=!1,this.underlineColor=null,this.currBitmapFont=null,this},i.recover=function(){this!==e.EMPTY&&p.recover("TextStyle",this.reset())},i.render=function(t,e,i,n){(this.bgColor||this.borderColor)&&e.drawRect(i,n,t.width,t.height,this.bgColor,this.borderColor,1)},e.create=function(){return p.getItemByClass("TextStyle",e)},e.EMPTY=new e,e}(ot),Lr=function(t){function r(t){r.__super.call(this),t||(t=this._copyMatrix(r.IDENTITY_MATRIX)),this._mat=new Float32Array(16),this._alpha=new Float32Array(4),this.setByMatrix(t)}I(r,"laya.filters.ColorFilter",xt);var e=r.prototype;return T.imps(e,{"laya.filters.IFilter":!0}),e.gray=function(){return this.setByMatrix(r.GRAY_MATRIX)},e.color=function(t,e,i,n){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),this.setByMatrix([1,0,0,0,t,0,1,0,0,e,0,0,1,0,i,0,0,0,1,n])},e.setColor=function(t){var e=f.create(t).arrColor,i=[0,0,0,0,256*e[0],0,0,0,0,256*e[1],0,0,0,0,256*e[2],0,0,0,1,0];return this.setByMatrix(i)},e.setByMatrix=function(t){this._matrix!=t&&this._copyMatrix(t);for(var e=0,i=0,n=0;n<20;n++)n%5!=4?this._mat[e++]=t[n]:this._alpha[i++]=t[n];return this},e.adjustColor=function(t,e,i,n){return this.adjustHue(n),this.adjustContrast(e),this.adjustBrightness(t),this.adjustSaturation(i),this},e.adjustBrightness=function(t){return 0==(t=this._clampValue(t,100))||isNaN(t)?this:this._multiplyMatrix([1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0,0,0,0,0,1])},e.adjustContrast=function(t){if(0==(t=this._clampValue(t,100))||isNaN(t))return this;var e=NaN,i=(e=t<0?127+t/100*127:127*(e=0==(e=t%1)?r.DELTA_INDEX[t]:r.DELTA_INDEX[t<<0]*(1-e)+r.DELTA_INDEX[1+(t<<0)]*e)+127)/127,n=.5*(127-e);return this._multiplyMatrix([i,0,0,0,n,0,i,0,0,n,0,0,i,0,n,0,0,0,1,0,0,0,0,0,1])},e.adjustSaturation=function(t){if(0==(t=this._clampValue(t,100))||isNaN(t))return this;var e=1+(0<t?3*t/100:t/100),i=1-e,n=.3086*i,r=.6094*i,s=.082*i;return this._multiplyMatrix([n+e,r,s,0,0,n,r+e,s,0,0,n,r,s+e,0,0,0,0,0,1,0,0,0,0,0,1])},e.adjustHue=function(t){if(0==(t=this._clampValue(t,180)/180*Math.PI)||isNaN(t))return this;var e=Math.cos(t),i=Math.sin(t);return this._multiplyMatrix([.213+.787*e+-.213*i,.715+-.715*e+-.715*i,.072+-.072*e+.928*i,0,0,.213+-.213*e+.143*i,.715+e*(1-.715)+.14*i,.072+-.072*e+-.283*i,0,0,.213+-.213*e+-.787*i,.715+-.715*e+.715*i,.072+.928*e+.072*i,0,0,0,0,0,1,0,0,0,0,0,1])},e.reset=function(){return this.setByMatrix(this._copyMatrix(r.IDENTITY_MATRIX))},e._multiplyMatrix=function(t){var e=[];this._matrix=this._fixMatrix(this._matrix);for(var i=0;i<5;i++){for(var n=0;n<5;n++)e[n]=this._matrix[n+5*i];for(n=0;n<5;n++){for(var r=0,s=0;s<5;s++)r+=t[n+5*s]*e[s];this._matrix[n+5*i]=r}}return this.setByMatrix(this._matrix)},e._clampValue=function(t,e){return Math.min(e,Math.max(-e,t))},e._fixMatrix=function(t){return null==t?r.IDENTITY_MATRIX:(t.length<25?t=t.slice(0,t.length).concat(r.IDENTITY_MATRIX.slice(t.length,25)):25<t.length&&(t=t.slice(0,25)),t)},e._copyMatrix=function(t){this._matrix||(this._matrix=[]);for(var e=0;e<25;e++)this._matrix[e]=t[e];return this._matrix},g(0,e,"type",function(){return 32}),r.LENGTH=25,E(r,["DELTA_INDEX",function(){return this.DELTA_INDEX=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10]},"GRAY_MATRIX",function(){return this.GRAY_MATRIX=[.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0]},"IDENTITY_MATRIX",function(){return this.IDENTITY_MATRIX=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]}]),r}(),Or=function(t){function N(t,e,i){N.__super.call(this),this._bufferState=new Mr,this._batchID=N._batchIDCounter++,this._batchElements=[],this._currentBatchVertexCount=0,this._currentBatchIndexCount=0,this._vertexDeclaration=i,this.batchOwner=t,this.number=e}I(N,"laya.d3.graphics.SubMeshStaticBatch",X);var e=N.prototype;return T.imps(e,{"laya.resource.IDispose":!0}),e._getStaticBatchBakedVertexs=function(t,e,i,n,r,s){var a,o=s._vertexBuffers[0],h=o.vertexDeclaration,l=h.getVertexElementByUsage(0).offset/4,u=h.getVertexElementByUsage(3),c=u?u.offset/4:-1,_=h.getVertexElementByUsage(1),d=_?_.offset/4:-1,f=h.getVertexElementByUsage(2),p=f?f.offset/4:-1,m=h.getVertexElementByUsage(7),g=m?m.offset/4:-1,v=h.getVertexElementByUsage(4),T=v?v.offset/4:-1,y=h.vertexStride/4,E=o.getData();i?(i.worldMatrix.invert(N._tempMatrix4x40),a=N._tempMatrix4x41,gt.multiply(N._tempMatrix4x40,n.worldMatrix,a)):a=n.worldMatrix;var x=N._tempQuaternion0;a.decomposeTransRotScale(N._tempVector30,x,N._tempVector31);for(var S=r.lightmapScaleOffset,C=s.vertexCount,I=0;I<C;I++){var R=I*y,A=18*(I+e);V.transformVector3ArrayToVector3ArrayCoordinate(E,R+l,a,t,A+0),-1!==c&&V.transformVector3ArrayByQuat(E,R+c,x,t,A+3);var M=0,D=0,b=A+6;if(-1!==d){var w=R+d;for(M=0,D=4;M<D;M++)t[b+M]=E[w+M]}else for(M=0,D=4;M<D;M++)t[b+M]=1;if(-1!==p){var L=R+p;t[A+10]=E[L],t[A+11]=E[L+1]}if(S&&(-1!==g?V.transformLightingMapTexcoordArray(E,R+g,S,t,A+12):V.transformLightingMapTexcoordArray(E,R+p,S,t,A+12)),-1!==T){var O=R+T;t[A+14]=E[O],t[A+15]=E[O+1],t[A+16]=E[O+2],t[A+17]=E[O+3]}}return C},e.addTest=function(t){var e=t.meshFilter.sharedMesh.vertexCount;return!(65535<this._currentBatchVertexCount+e)},e.add=function(t){var e=t._render._staticBatch;e&&e.remove(t);var i=t.meshFilter.sharedMesh,n=i.vertexCount;this._batchElements.push(t);var r=t._render;r._isPartOfStaticBatch=!0,r._staticBatch=this;for(var s=r._renderElements,a=0,o=s.length;a<o;a++)s[a].staticBatch=this;this._currentBatchIndexCount+=i._indexBuffer.indexCount,this._currentBatchVertexCount+=n},e.remove=function(t){var e=t.meshFilter.sharedMesh,i=this._batchElements.indexOf(t);if(-1!==i){this._batchElements.splice(i,1);t._render;for(var n=t._render._renderElements,r=0,s=n.length;r<s;r++)n[r].staticBatch=null;var a=e.vertexCount;this._currentBatchIndexCount=this._currentBatchIndexCount-e._indexBuffer.indexCount,this._currentBatchVertexCount=this._currentBatchVertexCount-a,t._render._isPartOfStaticBatch=!1}},e.finishInit=function(){this._vertexBuffer&&(this._vertexBuffer.destroy(),this._indexBuffer.destroy(),Nn._addGPUMemory(-(this._vertexBuffer._byteLength+this._indexBuffer._byteLength)));var t=0,e=0,i=this.batchOwner,n=this._vertexDeclaration.vertexStride/4,r=new Float32Array(n*this._currentBatchVertexCount),s=new Uint16Array(this._currentBatchIndexCount);this._vertexBuffer=new zn(this._vertexDeclaration.vertexStride*this._currentBatchVertexCount,35044),this._vertexBuffer.vertexDeclaration=this._vertexDeclaration,this._indexBuffer=new dr("ushort",this._currentBatchIndexCount,35044);for(var a=0,o=this._batchElements.length;a<o;a++){for(var h=this._batchElements[a],l=h.meshFilter.sharedMesh,u=this._getStaticBatchBakedVertexs(r,t,i?i._transform:null,h._transform,h._render,l),c=l._indexBuffer.getData(),_=t,d=e+c.length,f=h._render._renderElements,p=0,m=l.subMeshCount;p<m;p++){var g=l._subMeshes[p],v=e+g._indexStart,T=f[p];T.staticBatchIndexStart=v,T.staticBatchIndexEnd=v+g._indexCount}s.set(c,e);var y=0;if(i?h._transform._isFrontFaceInvert!==i.transform._isFrontFaceInvert:h._transform._isFrontFaceInvert)for(y=e;y<d;y+=3){s[y]=_+s[y];var E=s[y+1],x=s[y+2];s[y+1]=_+x,s[y+2]=_+E}else for(y=e;y<d;y+=3)s[y]=_+s[y],s[y+1]=_+s[y+1],s[y+2]=_+s[y+2];e+=c.length,t+=u}this._vertexBuffer.setData(r),this._indexBuffer.setData(s);var S=this._vertexBuffer._byteLength+this._indexBuffer._byteLength;Nn._addGPUMemory(S),this._bufferState.bind(),this._bufferState.applyVertexBuffer(this._vertexBuffer),this._bufferState.applyIndexBuffer(this._indexBuffer),this._bufferState.unBind()},e._render=function(t){this._bufferState.bind();for(var e=t.renderElement.staticBatchElementList,i=0,n=0,r=e.length,s=1;s<r;s++){if(e[s-1].staticBatchIndexEnd!==e[s].staticBatchIndexStart){var a=e[i].staticBatchIndexStart,o=e[n].staticBatchIndexEnd-a;Nt.instance.drawElements(4,o,5123,2*a),i=++n,$i.trianglesFaces+=o/3}else n++}a=e[i].staticBatchIndexStart,o=e[n].staticBatchIndexEnd-a,Nt.instance.drawElements(4,o,5123,2*a),$i.renderBatches++,$i.savedRenderBatches+=r-1,$i.trianglesFaces+=o/3},e.dispose=function(){var t=this._vertexBuffer._byteLength+this._indexBuffer._byteLength;Nn._addGPUMemory(-t),this._batchElements=null,this.batchOwner=null,this._vertexDeclaration=null,this._bufferState.destroy(),this._vertexBuffer.destroy(),this._indexBuffer.destroy(),this._vertexBuffer=null,this._indexBuffer=null,this._bufferState=null},N.maxBatchVertexCount=65535,N._batchIDCounter=0,E(N,["_tempVector30",function(){return this._tempVector30=new ln},"_tempVector31",function(){return this._tempVector31=new ln},"_tempQuaternion0",function(){return this._tempQuaternion0=new Qt},"_tempMatrix4x40",function(){return this._tempMatrix4x40=new gt},"_tempMatrix4x41",function(){return this._tempMatrix4x41=new gt}]),N}(),Nr=function(i){function s(){this.radius=NaN,this.arc=NaN,this.emitFromEdge=!1,s.__super.call(this),this.radius=1,this.arc=2*Math.PI,this.emitFromEdge=!1,this.randomDirection=!1}I(s,"laya.d3.core.particleShuriKen.module.shape.CircleShape",i);var t=s.prototype;return t._getShapeBoundBox=function(t){var e=t.min;e.x=e.z=-this.radius,e.y=0;var i=t.max;i.x=i.z=this.radius,i.y=0},t._getSpeedBoundBox=function(t){var e=t.min;e.x=e.y=-1,e.z=0;var i=t.max;i.x=i.y=1,i.z=0},t.generatePositionAndDirection=function(t,e,i,n){var r=s._tempPositionPoint;i?(i.seed=n[16],this.emitFromEdge?oi._randomPointUnitArcCircle(this.arc,s._tempPositionPoint,i):oi._randomPointInsideUnitArcCircle(this.arc,s._tempPositionPoint,i),n[16]=i.seed):this.emitFromEdge?oi._randomPointUnitArcCircle(this.arc,s._tempPositionPoint):oi._randomPointInsideUnitArcCircle(this.arc,s._tempPositionPoint),t.x=-r.x,t.y=r.y,t.z=0,ln.scale(t,this.radius,t),this.randomDirection?i?(i.seed=n[17],oi._randomPointUnitSphere(e,i),n[17]=i.seed):oi._randomPointUnitSphere(e):t.cloneTo(e)},t.cloneTo=function(t){i.prototype.cloneTo.call(this,t);var e=t;e.radius=this.radius,e.arc=this.arc,e.emitFromEdge=this.emitFromEdge,e.randomDirection=this.randomDirection},E(s,["_tempPositionPoint",function(){return this._tempPositionPoint=new un}]),s}(Kt),Pr=function(i){function t(){this.radius=NaN,this.emitFromShell=!1,t.__super.call(this),this.radius=1,this.emitFromShell=!1,this.randomDirection=!1}I(t,"laya.d3.core.particleShuriKen.module.shape.HemisphereShape",i);var e=t.prototype;return e._getShapeBoundBox=function(t){var e=t.min;e.x=e.y=e.z=-this.radius;var i=t.max;i.x=i.y=this.radius,i.z=0},e._getSpeedBoundBox=function(t){var e=t.min;e.x=e.y=-1,e.z=0;var i=t.max;i.x=i.y=i.z=1},e.generatePositionAndDirection=function(t,e,i,n){i?(i.seed=n[16],this.emitFromShell?oi._randomPointUnitSphere(t,i):oi._randomPointInsideUnitSphere(t,i),n[16]=i.seed):this.emitFromShell?oi._randomPointUnitSphere(t):oi._randomPointInsideUnitSphere(t),ln.scale(t,this.radius,t);var r=t.z;r<0&&(t.z=-1*r),this.randomDirection?i?(i.seed=n[17],oi._randomPointUnitSphere(e,i),n[17]=i.seed):oi._randomPointUnitSphere(e):t.cloneTo(e)},e.cloneTo=function(t){i.prototype.cloneTo.call(this,t);var e=t;e.radius=this.radius,e.emitFromShell=this.emitFromShell,e.randomDirection=this.randomDirection},t}(Kt),Fr=function(t){function i(){i.__super.call(this,24,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}I(i,"laya.webgl.utils.MeshTexture",Dt);var e=i.prototype;return e.addData=function(t,e,i,n,r){var s=this._vb,a=this._ib,o=t.length>>1,h=s.needSize(24*o)>>2,l=s._floatArray32||s.getFloat32Array(),u=s._uint32Array,c=0,_=n.a,d=n.b,f=n.c,p=n.d,m=n.tx,g=n.ty,v=0;for(v=0;v<o;v++){var T=t[c],y=t[c+1];l[h]=T*_+y*f+m,l[h+1]=T*d+y*p+g,l[h+2]=e[c],l[h+3]=e[c+1],u[h+4]=r,u[h+5]=255,h+=6,c+=2}s.setNeedUpload();var E=this.vertNum,x=i.length,S=a.needSize(i.byteLength),C=a.getUint16Array(),I=S>>1;if(0<E){var R=I+x,A=0;for(v=I;v<R;v++,A++)C[v]=i[A]+E}else C.set(i,I);a.setNeedUpload(),this.vertNum+=o,this.indexNum+=i.length},e.releaseMesh=function(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshTexture._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._ib.disposeResource(),this._vb.deleteBuffer()},i.getAMesh=function(t){var e;return e=laya.webgl.utils.MeshTexture._POOL.length?laya.webgl.utils.MeshTexture._POOL.pop():new i,t&&e._vb._resizeBuffer(1572864,!1),e},i.const_stride=24,i._POOL=[],E(i,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]}]),i}(),Br=function(t){function s(){this._matrix=new It,this._matrix4=$e.defaultMatrix4.concat(),s.__super.call(this,1e4),this.shaderValue=new Ot(0,0)}I(s,"laya.webgl.submit.SubmitCanvas",yt);var e=s.prototype;return e.renderSubmit=function(){var t=Q.worldAlpha,e=Q.worldMatrix4,i=Q.worldMatrix,n=Q.worldFilters,r=Q.worldShaderDefines,s=this.shaderValue,a=this._matrix,o=this._matrix4,h=It.TEMP;return It.mul(a,i,h),o[0]=h.a,o[1]=h.b,o[4]=h.c,o[5]=h.d,o[12]=h.tx,o[13]=h.ty,Q.worldMatrix=h.clone(),Q.worldMatrix4=o,Q.worldAlpha=Q.worldAlpha*s.alpha,s.filters&&s.filters.length&&(Q.worldFilters=s.filters,Q.worldShaderDefines=s.defines),this.canv.flushsubmit(),Q.worldAlpha=t,Q.worldMatrix4=e,Q.worldMatrix.destroy(),Q.worldMatrix=i,Q.worldFilters=n,Q.worldShaderDefines=r,1},e.releaseRender=function(){if(--this._ref<1){var t=s.POOL;this._mesh=null,t[t._length++]=this}},e.clone=function(t,e,i){return null},e.getRenderType=function(){return 10003},s.create=function(t,e,i){var n=s.POOL._length?s.POOL[--s.POOL._length]:new s;n.canv=t,n._ref=1,n._numEle=0;var r=n.shaderValue;return r.alpha=e,r.defines.setValue(0),i&&i.length&&r.setFilters(i),n},s.POOL=[],s.__init$=function(){s.POOL._length=0},s}(),Vr=function(t){function i(){this._renderTexture=null,i.__super.call(this)}I(i,"laya.d3.core.render.command.SetRenderTargetCMD",M);var e=i.prototype;return e.run=function(){this._renderTexture._start()},e.recover=function(){i._pool.push(this),this._renderTexture=null},i.create=function(t){var e;return(e=0<i._pool.length?i._pool.pop():new i)._renderTexture=t,e},i._pool=[],i}(),Ur=function(t){function e(){this._instanceBatchOpaqueMarks=[],this._vertexBatchOpaqueMarks=[],this._cacheBufferStates=[],e.__super.call(this),Ar.instance=new Ar,this._updateCountMark=0}I(e,"laya.d3.graphics.MeshRenderDynamicBatchManager",t);var i=e.prototype;return i.getInstanceBatchOpaquaMark=function(t,e,i,n){var r=this._instanceBatchOpaqueMarks[t]||(this._instanceBatchOpaqueMarks[t]=[]),s=r[e?0:1]||(r[e?0:1]=[]),a=s[i]||(s[i]=[]);return a[n]||(a[n]=new Lt)},i.getVertexBatchOpaquaMark=function(t,e,i,n){var r=this._vertexBatchOpaqueMarks[t]||(this._vertexBatchOpaqueMarks[t]=[]),s=r[e?0:1]||(r[e?0:1]=[]),a=s[i]||(s[i]=[]);return a[n]||(a[n]=new Lt)},i._getBufferState=function(t){var e=this._cacheBufferStates[t.id];if(!e){var i=Ar.instance;(e=new Mr).bind();var n=i._vertexBuffer;n.vertexDeclaration=t,e.applyVertexBuffer(n),e.applyIndexBuffer(i._indexBuffer),e.unBind(),this._cacheBufferStates[t.id]=e}return e},i._getBatchRenderElementFromPool=function(){var t=this._batchRenderElementPool[this._batchRenderElementPoolIndex++];return t||(t=new qr,(this._batchRenderElementPool[this._batchRenderElementPoolIndex-1]=t).vertexBatchElementList=[],t.instanceBatchElementList=[]),t},i._clear=function(){t.prototype._clear.call(this),this._updateCountMark++},E(e,["instance",function(){return this.instance=new e}]),e}(wt),zr=function(t){function e(){this.maxInstanceCount=1024,e.__super.call(this),this.instanceWorldMatrixData=new Float32Array(16*this.maxInstanceCount),this.instanceMVPMatrixData=new Float32Array(16*this.maxInstanceCount),this.instanceWorldMatrixBuffer=new zn(4*this.instanceWorldMatrixData.length,35048),this.instanceMVPMatrixBuffer=new zn(4*this.instanceMVPMatrixData.length,35048),this.instanceWorldMatrixBuffer.vertexDeclaration=Si.instanceWorldMatrixDeclaration,this.instanceMVPMatrixBuffer.vertexDeclaration=Si.instanceMVPMatrixDeclaration}return I(e,"laya.d3.graphics.SubMeshInstanceBatch",X),e.prototype._render=function(t){var e=t.renderElement,i=e.instanceSubMesh,n=e.instanceBatchElementList.length,r=i._indexCount;i._mesh._instanceBufferState.bind(),j._angleInstancedArrays.drawElementsInstancedANGLE(4,r,5123,2*i._indexStart,n),$i.renderBatches++,$i.savedRenderBatches+=n-1,$i.trianglesFaces+=r*n/3},E(e,["instance",function(){return this.instance=new e}]),e}(),Gr=function(i){function n(t,e,i){switch(n.__super.call(this),void 0===t&&(t=.5),void 0===e&&(e=1.25),void 0===i&&(i=1),this._radius=t,this._length=e,this._orientation=i,this._type=3,i){case 0:this._nativeShape=new In._physics3D.btCapsuleShapeX(t,e-2*t);break;case 1:this._nativeShape=new In._physics3D.btCapsuleShape(t,e-2*t);break;case 2:this._nativeShape=new In._physics3D.btCapsuleShapeZ(t,e-2*t);break;default:throw"CapsuleColliderShape:unknown orientation."}}I(n,"laya.d3.physics.shape.CapsuleColliderShape",i);var t=n.prototype;return t._setScale=function(t){var e=n._tempVector30;switch(this.orientation){case 0:e.x=t.x,e.y=e.z=Math.max(t.y,t.z);break;case 1:e.y=t.y,e.x=e.z=Math.max(t.x,t.z);break;case 2:e.z=t.z,e.x=e.y=Math.max(t.x,t.y);break;default:throw"CapsuleColliderShape:unknown orientation."}i.prototype._setScale.call(this,e)},t.clone=function(){var t=new n(this._radius,this._length,this._orientation);return this.cloneTo(t),t},g(0,t,"orientation",function(){return this._orientation}),g(0,t,"length",function(){return this._length}),g(0,t,"radius",function(){return this._radius}),E(n,["_tempVector30",function(){return this._tempVector30=new ln}]),n}(J),Hr=function(t){function f(t,e,i,n,r,s,a,o,h,l,u,c,_,d){this._cornerTextureCoordinate=null,this._positionStartLifeTime=null,this._velocity=null,this._startColor=null,this._startSize=null,this._startRotation0=null,this._startRotation1=null,this._startRotation2=null,this._startLifeTime=NaN,this._time=NaN,this._startSpeed=NaN,this._randoms0=null,this._randoms1=null,this._simulationWorldPostion=null,f.__super.call(this),this._cornerTextureCoordinate=t,this._positionStartLifeTime=e,this._velocity=i,this._startColor=n,this._startSize=r,this._startRotation0=s,this._startRotation1=a,this._startRotation2=o,this._startLifeTime=h,this._time=l,this._startSpeed=u,this._randoms0=this.random0,this._randoms1=this.random1,this._simulationWorldPostion=d}I(f,"laya.d3.graphics.Vertex.VertexShurikenParticleMesh",le);var e=f.prototype;return g(0,e,"simulationWorldPostion",function(){return this._simulationWorldPostion}),g(0,e,"time",function(){return this._time}),g(0,e,"startLifeTime",function(){return this._startLifeTime}),g(0,e,"startRotation2",function(){return this._startRotation2}),g(0,e,"startRotation1",function(){return this._startRotation1}),g(0,e,"random0",function(){return this._randoms0}),g(0,e,"startRotation0",function(){return this._startRotation0}),g(0,e,"startSize",function(){return this._startSize}),g(0,e,"velocity",function(){return this._velocity}),g(0,e,"startSpeed",function(){return this._startSpeed}),g(0,e,"position",function(){return this._positionStartLifeTime}),g(0,e,"random1",function(){return this._randoms1}),g(0,e,"startColor",function(){return this._startColor}),g(0,e,"cornerTextureCoordinate",function(){return this._cornerTextureCoordinate}),g(1,f,"vertexDeclaration",function(){return f._vertexDeclaration},laya.d3.graphics.Vertex.VertexShuriKenParticle._$SET_vertexDeclaration),E(f,["_vertexDeclaration",function(){return this._vertexDeclaration=new D(172,[new lt(0,"vector3",1),new lt(12,"vector4",2),new lt(28,"vector2",3),new lt(36,"vector4",4),new lt(52,"vector4",5),new lt(68,"vector4",6),new lt(84,"vector3",8),new lt(96,"vector3",9),new lt(108,"single",10),new lt(112,"vector4",11),new lt(128,"vector4",12),new lt(144,"vector3",13),new lt(156,"vector4",14)])}]),f}(),kr=function(i){function t(){this.x=NaN,this.y=NaN,this.z=NaN,t.__super.call(this),this.x=1,this.y=1,this.z=1,this.randomDirection=!1}I(t,"laya.d3.core.particleShuriKen.module.shape.BoxShape",i);var e=t.prototype;return e._getShapeBoundBox=function(t){var e=t.min;e.x=.5*-this.x,e.y=.5*-this.y,e.z=.5*-this.z;var i=t.max;i.x=.5*this.x,i.y=.5*this.y,i.z=.5*this.z},e._getSpeedBoundBox=function(t){var e=t.min;e.x=0,e.y=0,e.z=0;var i=t.max;i.x=0,i.y=1,i.z=0},e.generatePositionAndDirection=function(t,e,i,n){i?(i.seed=n[16],oi._randomPointInsideHalfUnitBox(t,i),n[16]=i.seed):oi._randomPointInsideHalfUnitBox(t),t.x=this.x*t.x,t.y=this.y*t.y,t.z=this.z*t.z,this.randomDirection?i?(i.seed=n[17],oi._randomPointUnitSphere(e,i),n[17]=i.seed):oi._randomPointUnitSphere(e):(e.x=0,e.y=0,e.z=1)},e.cloneTo=function(t){i.prototype.cloneTo.call(this,t);var e=t;e.x=this.x,e.y=this.y,e.z=this.z,e.randomDirection=this.randomDirection},t}(Kt),Wr=function(t){function e(t){e.__super.call(this,4,0),this._attribLocation=["position",0,"attribColor",1]}return I(e,"laya.webgl.shader.d2.value.PrimitiveSV",Ot),e}(),Xr=function(t){function i(t){this.texcoord=null,this.position=null,this.offsetX=300,this.offsetY=0,i.__super.call(this,512,0);var e=8*$e.BYTES_PE;this.position=[2,5126,!1,e,0],this.texcoord=[2,5126,!1,e,2*$e.BYTES_PE],this.color=[4,5126,!1,e,4*$e.BYTES_PE]}return I(i,"laya.webgl.shader.d2.skinAnishader.SkinSV",Ot),i}(),Yr=function(t){function i(){i.__super.call(this,12,4,4),this.canReuse=!0,this.setAttributes(laya.webgl.utils.MeshVG._fixattriInfo)}I(i,"laya.webgl.utils.MeshVG",Dt);var e=i.prototype;return e.addVertAndIBToMesh=function(t,e,i,n){for(var r=this._vb.needSize(e.length/2*12)>>2,s=this._vb._floatArray32||this._vb.getFloat32Array(),a=this._vb._uint32Array,o=0,h=e.length/2,l=0;l<h;l++)s[r++]=e[o],s[r++]=e[o+1],o+=2,a[r++]=i;this._vb.setNeedUpload(),this._ib.append(new Uint16Array(n)),this._ib.setNeedUpload(),this.vertNum+=h,this.indexNum+=n.length},e.releaseMesh=function(){this._vb.setByteLength(0),this._ib.setByteLength(0),this.vertNum=0,this.indexNum=0,laya.webgl.utils.MeshVG._POOL.push(this)},e.destroy=function(){this._ib.destroy(),this._vb.destroy(),this._ib.disposeResource(),this._vb.deleteBuffer()},i.getAMesh=function(t){var e;return e=laya.webgl.utils.MeshVG._POOL.length?laya.webgl.utils.MeshVG._POOL.pop():new i,t&&e._vb._resizeBuffer(786432,!1),e},i.const_stride=12,i._POOL=[],E(i,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5121,4,8]}]),i}(),Zr=function(t){function h(t,e,i,n){this._renderState=new je,this._owner=t,this._cacheSharders=[],this._publicValidDefine=0,this._spriteValidDefine=0,this._materialValidDefine=0,this._validDefineMap={},h.__super.call(this,e,i,null,this._validDefineMap);var r=this._owner._publicDefinesMap,s=this._owner._spriteDefinesMap,a=this._owner._materialDefinesMap;for(var o in this._validDefineMap)null!=r[o]?this._publicValidDefine|=r[o]:null!=s[o]?this._spriteValidDefine|=s[o]:null!=a[o]&&(this._materialValidDefine|=a[o]);this._stateMap=n}I(h,"laya.d3.shader.ShaderPass",ui);var e=h.prototype;return e._definesToNameDic=function(t,e){for(var i={},n=1,r=0;r<32&&!(t<(n=1<<r));r++){t&n&&(i[e[n]]="")}return i},e._compileToTree=function(t,e,i,n,r){var s,a,o,h,l,u,c,_=0,d=0,f=0,p=0;for(d=i;d<e.length;d++)if(!((o=e[d]).length<1)&&0!==(_=o.indexOf("//"))){if(0<=_&&(o=o.substr(0,_)),s=c||new vi(n),c=null,0<=(_=(s.text=o).indexOf("#"))){for(h="#",p=_+1,f=o.length;p<f;p++){var m=o.charAt(p);if(" "===m||"\t"===m||"?"===m)break;h+=m}switch(s.name=h){case"#ifdef":case"#ifndef":if(s.setParent(t),t=s,r)for(u=o.substr(p).split(ui._splitToWordExps3),p=0;p<u.length;p++)(o=u[p]).length&&(r[o]=!0);continue;case"#if":case"#elif":if(s.setParent(t),t=s,r)for(u=o.substr(p).split(ui._splitToWordExps3),p=0;p<u.length;p++)(o=u[p]).length&&"defined"!=o&&(r[o]=!0);continue;case"#else":a=(t=t.parent).childs[t.childs.length-1],s.setParent(t),t=s;continue;case"#endif":a=(t=t.parent).childs[t.childs.length-1],s.setParent(t);continue;case"#include":u=ui.splitToWords(o,null);var g=ui.includes[u[1]];if(!g)throw"ShaderCompile error no this include file:"+u[1];if((_=u[0].indexOf("?"))<0){s.setParent(t),o=g.getWith("with"==u[2]?u[3]:null),this._compileToTree(s,o.split("\n"),0,n,r),s.text="";continue}s.setCondition(u[0].substr(_+1),1),s.text=g.getWith("with"==u[2]?u[3]:null);break;case"#import":l=(u=ui.splitToWords(o,null))[1],n.push({node:s,file:ui.includes[l],ofs:s.text.length});continue}}else{if((a=t.childs[t.childs.length-1])&&!a.name){0<n.length&&ui.splitToWords(o,a),c=s,a.text+="\n"+o;continue}0<n.length&&ui.splitToWords(o,s)}s.setParent(t)}},e.withCompile=function(t,e,i){var n,r,s;if(t&=this._publicValidDefine,e&=this._spriteValidDefine,i&=this._materialValidDefine,r=this._cacheSharders[t])if(s=r[e]){if(n=s[i])return n}else s=r[e]=[];else s=(r=this._cacheSharders[t]=[])[e]=[];var a,o=this._definesToNameDic(t,this._owner._publicDefines),h=this._definesToNameDic(e,this._owner._spriteDefines),l=this._definesToNameDic(i,this._owner._materialDefines);if(We.debugMode){var u="";for(a in o)u+=a+" ";var c="";for(a in h)c+=a+" ";var _="";for(a in l)_+=a+" ";en.shaderHighPrecision||(t+=We.SHADERDEFINE_HIGHPRECISION),console.log("%cShader3DDebugMode---(Name:"+this._owner._owner._name+" PassIndex:"+this._owner._passes.indexOf(this)+" PublicDefine:"+t+" SpriteDefine:"+e+" MaterialDefine:"+i+" PublicDefineGroup:"+u+" SpriteDefineGroup:"+c+"MaterialDefineGroup: "+_+")---ShaderCompile3DDebugMode","color:green")}var d={},f="";if(o)for(a in o)f+="#define "+a+"\n",d[a]=!0;if(h)for(a in h)f+="#define "+a+"\n",d[a]=!0;if(l)for(a in l)f+="#define "+a+"\n",d[a]=!0;var p=this._VS.toscript(d,[]),m="";0==p[0].indexOf("#version")&&(m=p[0]+"\n",p.shift());var g=this._PS.toscript(d,[]),v="";return 0==g[0].indexOf("#version")&&(v=g[0]+"\n",g.shift()),n=new ds(m+f+p.join("\n"),v+f+g.join("\n"),this._owner._attributeMap||this._owner._owner._attributeMap,this._owner._uniformMap||this._owner._owner._uniformMap,this),s[i]=n},g(0,e,"renderState",function(){return this._renderState}),h}(),jr=function(t){function d(t,e,i,n,r){this.ctx=null,this.lastScaleX=1,this.lastScaleY=1,this.needResetScale=!1,this.maxTexW=0,this.maxTexH=0,this.scaleFontSize=!0,this.showDbgInfo=!1,this.supportImageData=!0,d.__super.call(this),void 0===i&&(i=!0),void 0===n&&(n=!0),void 0===r&&(r=!1),this.maxTexW=t,this.maxTexH=e,this.scaleFontSize=i,this.supportImageData=n,this.showDbgInfo=r,d.canvas||((d.canvas=m.document.createElement("canvas")).width=1024,d.canvas.height=512,d.canvas.style.left="-10000px",d.canvas.style.position="absolute",s.body.appendChild(d.canvas),this.ctx=d.canvas.getContext("2d"))}I(d,"laya.webgl.text.CharRender_Canvas",Bi);var e=d.prototype;return e.getWidth=function(t,e){return this.ctx?(this.ctx._lastFont!=t&&(this.ctx.font=t,this.ctx._lastFont=t),this.ctx.measureText(e).width):0},e.scale=function(t,e){if(!this.supportImageData)return this.lastScaleX=t,void(this.lastScaleY=e);this.lastScaleX==t&&this.lastScaleY==e||(this.ctx.setTransform(t,0,0,e,0,0),this.lastScaleX=t,this.lastScaleY=e)},e.getCharBmp=function(t,e,i,n,r,s,a,o,h,l,u){if(!this.supportImageData)return this.getCharCanvas(t,e,i,n,r,s,a,o,h,l);var c=this.ctx;c.font!=e&&(c.font=e,c._lastFont=e),s.width=c.measureText(t).width;var _=s.width*this.lastScaleX,d=s.height*this.lastScaleY;_+=(a+h)*this.lastScaleX,d+=(o+l)*this.lastScaleY,_=Math.ceil(_),d=Math.ceil(d);var f=(_=Math.min(_,laya.webgl.text.CharRender_Canvas.canvas.width))+2*i+1,p=(d=Math.min(d,laya.webgl.text.CharRender_Canvas.canvas.height))+2*i+1;u&&(f=Math.max(f,u[0]+u[2]+1),p=Math.max(p,u[1]+u[3]+1)),c.clearRect(0,0,f,p),c.save(),c.textBaseline="top",0<i&&(c.strokeStyle=r,c.lineWidth=i,c.strokeText(t,a,o)),c.fillStyle=n,c.fillText(t,a,o),this.showDbgInfo&&(c.strokeStyle="#ff0000",c.strokeRect(0,0,_,d),c.strokeStyle="#00ff00",c.strokeRect(a,o,s.width,s.height)),u&&-1==u[2]&&(u[2]=Math.ceil((s.width+2*i)*this.lastScaleX));var m=u?c.getImageData(u[0],u[1],u[2],u[3]):c.getImageData(0,0,_,d);return c.restore(),s.bmpWidth=m.width,s.bmpHeight=m.height,m},e.getCharCanvas=function(t,e,i,n,r,s,a,o,h,l){var u=this.ctx;u.font!=e&&(u.font=e,u._lastFont=e),s.width=u.measureText(t).width;var c=s.width*this.lastScaleX,_=s.height*this.lastScaleY;return c+=(a+h)*this.lastScaleX,_+=(o+l)*this.lastScaleY+1,c=Math.min(c,this.maxTexW),_=Math.min(_,this.maxTexH),d.canvas.width=Math.min(c+1,this.maxTexW),d.canvas.height=Math.min(_+1,this.maxTexH),u.font=e,u.clearRect(0,0,c+1+i,_+1+i),u.setTransform(1,0,0,1,0,0),u.save(),this.scaleFontSize&&u.scale(this.lastScaleX,this.lastScaleY),u.translate(a,o),u.textAlign="left",u.textBaseline="top",0<i?(u.strokeStyle=r,u.fillStyle=n,u.lineWidth=i,u.fillAndStrokeText?u.fillAndStrokeText(t,0,0):(u.strokeText(t,0,0),u.fillText(t,0,0))):(u.fillStyle=n,u.fillText(t,0,0)),this.showDbgInfo&&(u.strokeStyle="#ff0000",u.strokeRect(0,0,c,_),u.strokeStyle="#00ff00",u.strokeRect(0,0,s.width,s.height)),u.restore(),s.bmpWidth=d.canvas.width,s.bmpHeight=d.canvas.height,d.canvas},g(0,e,"canvasWidth",function(){return d.canvas.width},function(t){d.canvas.width!=t&&(2048<(d.canvas.width=t)&&console.warn("画文字设置的宽度太大，超过2048了"),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(this.lastScaleX,this.lastScaleY))}),d.canvas=null,d}(),Kr=function(t){function e(){this.lastFont="",e.__super.call(this)}I(e,"laya.webgl.text.CharRender_Native",Bi);var i=e.prototype;return i.getWidth=function(t,e){return m.conchTextCanvas?(m.conchTextCanvas.font=t,this.lastFont=t,m.conchTextCanvas.measureText(e).width):0},i.scale=function(t,e){},i.getCharBmp=function(t,e,i,n,r,s,a,o,h,l,u){if(!m.conchTextCanvas)return null;m.conchTextCanvas.font=e,this.lastFont=e;s.width=m.conchTextCanvas.measureText(t).width,s.height;var c=f.create(r).numColor,_=f.create(n).numColor,d=m.conchTextCanvas.getTextBitmapData(t,_,2<i?2:i,c);return s.bmpWidth=d.width,s.bmpHeight=d.height,d},e}(),qr=function(t){function e(){e.__super.call(this),this._dynamicWorldPositionNormalNeedUpdate=!0}I(e,"laya.d3.core.render.SubMeshRenderElement",t);var i=e.prototype;return i._onWorldMatrixChanged=function(){this._dynamicWorldPositionNormalNeedUpdate=!0},i._computeWorldPositionsAndNormals=function(t,e,i,n){if(this._dynamicWorldPositionNormalNeedUpdate){for(var r=this._geometry,s=r._vertexBuffer,a=s.vertexDeclaration.vertexStride/4,o=s.getData(),h=this._transform.worldMatrix,l=this._transform.rotation,u=r._indices,c=0;c<n;c++){var _=(i?u[c]:c)*a,d=3*c;V.transformVector3ArrayToVector3ArrayCoordinate(o,_+t,h,this._dynamicWorldPositions,d),-1!==e&&V.transformVector3ArrayByQuat(o,_+e,l,this._dynamicWorldNormals,d)}this._dynamicWorldPositionNormalNeedUpdate=!1}},i.setTransform=function(t){this._transform!==t&&(this._transform&&this._transform.off("transformchanged",this,this._onWorldMatrixChanged),t&&t.on("transformchanged",this,this._onWorldMatrixChanged),this._dynamicWorldPositionNormalNeedUpdate=!0,this._transform=t)},i.setGeometry=function(t){if(this._geometry!==t){var e=t,i=e._mesh;if(i){var n=1<i._subMeshCount,r=n?e._indexCount:i._vertexCount;if(r<=10){var s=3*r;this._dynamicVertexBatch=!0,this._dynamicWorldPositions=new Float32Array(s),this._dynamicWorldNormals=new Float32Array(s),this._dynamicVertexCount=r,this._dynamicMultiSubMesh=n}else this._dynamicVertexBatch=!1}this._geometry=t}},i.addToOpaqueRenderQueue=function(t,e){var i=this.staticBatch,n=e.elements;if(i){var r=cr.instance,s=r.getBatchOpaquaMark(this.render.lightmapIndex+1,this.render.receiveShadow,this.material.id,i._batchID);if(r._updateCountMark===s.updateMark){var a=s.indexInList;if(s.batched)n[a].staticBatchElementList.push(this);else{var o=n[a],h=o.render,l=r._getBatchRenderElementFromPool();l.renderType=1,l.setGeometry(i),l.material=o.material;var u=i.batchOwner,c=u?u._transform:null;l.setTransform(c),l.render=h;var _=l.staticBatchElementList;_.length=0,_.push(o),_.push(this),n[a]=l,s.batched=!0}}else s.updateMark=r._updateCountMark,s.indexInList=n.length,s.batched=!1,n.push(this)}else if(this.material._shader._enableInstancing&&j._angleInstancedArrays){var d=this._geometry,f=Ur.instance,p=f.getInstanceBatchOpaquaMark(this.render.lightmapIndex+1,this.render.receiveShadow,this.material.id,d._id);if(f._updateCountMark===p.updateMark){var m=p.indexInList;if(p.batched){var g=n[m].instanceBatchElementList;g.length===zr.instance.maxInstanceCount?(p.updateMark=f._updateCountMark,p.indexInList=n.length,p.batched=!1,n.push(this)):g.push(this)}else{var v=n[m],T=v.render,y=f._getBatchRenderElementFromPool();y.renderType=2,y.setGeometry(zr.instance),y.material=v.material,y.setTransform(null),y.render=T,y.instanceSubMesh=d;var E=y.instanceBatchElementList;E.length=0,E.push(v),E.push(this),n[m]=y,p.batched=!0}}else p.updateMark=f._updateCountMark,p.indexInList=n.length,p.batched=!1,n.push(this)}else if(this._dynamicVertexBatch){var x=this._geometry._vertexBuffer.vertexDeclaration,S=Ur.instance,C=S.getVertexBatchOpaquaMark(this.render.lightmapIndex+1,this.render.receiveShadow,this.material.id,x.id);if(S._updateCountMark===C.updateMark){var I=C.indexInList;if(C.batched)n[I].vertexBatchElementList.push(this);else{var R=n[I],A=R.render,M=S._getBatchRenderElementFromPool();M.renderType=3,M.setGeometry(Ar.instance),M.material=R.material,M.setTransform(null),M.render=A,M.vertexBatchVertexDeclaration=x;var D=M.vertexBatchElementList;D.length=0,D.push(R),D.push(this),n[I]=M,C.batched=!0}}else C.updateMark=S._updateCountMark,C.indexInList=n.length,C.batched=!1,n.push(this)}else n.push(this)},i.addToTransparentRenderQueue=function(t,e){var i=this.staticBatch,n=e.elements;if(i){var r=cr.instance,s=e.lastTransparentRenderElement;if(s){var a=s.render;if(s._geometry._getType()!==this._geometry._getType()||s.staticBatch!==i||s.material!==this.material||a.receiveShadow!==this.render.receiveShadow||a.lightmapIndex!==this.render.lightmapIndex)n.push(this),e.lastTransparentBatched=!1;else{if(e.lastTransparentBatched)n[n.length-1].staticBatchElementList.push(this);else{var o=r._getBatchRenderElementFromPool();o.renderType=1,o.setGeometry(i),o.material=s.material;var h=i.batchOwner,l=h?h._transform:null;o.setTransform(l),o.render=this.render;var u=o.staticBatchElementList;u.length=0,u.push(s),u.push(this),n[n.length-1]=o}e.lastTransparentBatched=!0}}else n.push(this),e.lastTransparentBatched=!1}else if(this.material._shader._enableInstancing&&j._angleInstancedArrays){var c=this._geometry,_=Ur.instance,d=e.lastTransparentRenderElement;if(d){var f=d.render;if(d._geometry._getType()!==this._geometry._getType()||d._geometry!==c||d.material!==this.material||f.receiveShadow!==this.render.receiveShadow||f.lightmapIndex!==this.render.lightmapIndex)n.push(this),e.lastTransparentBatched=!1;else{if(e.lastTransparentBatched)n[n.length-1].instanceBatchElementList.push(this);else{var p=_._getBatchRenderElementFromPool();p.renderType=2,p.setGeometry(zr.instance),p.material=d.material,p.setTransform(null),p.render=this.render,p.instanceSubMesh=c;var m=p.instanceBatchElementList;m.length=0,m.push(d),m.push(this),n[n.length-1]=p}e.lastTransparentBatched=!0}}else n.push(this),e.lastTransparentBatched=!1}else if(this._dynamicVertexBatch){var g=this._geometry._vertexBuffer.vertexDeclaration,v=Ur.instance,T=e.lastTransparentRenderElement;if(T){var y=T.render;if(T._geometry._getType()!==this._geometry._getType()||T._geometry._vertexBuffer._vertexDeclaration!==g||T.material!==this.material||y.receiveShadow!==this.render.receiveShadow||y.lightmapIndex!==this.render.lightmapIndex)n.push(this),e.lastTransparentBatched=!1;else{if(e.lastTransparentBatched)n[n.length-1].vertexBatchElementList.push(this);else{var E=v._getBatchRenderElementFromPool();E.renderType=3,E.setGeometry(Ar.instance),E.material=T.material,E.setTransform(null),E.render=this.render,E.vertexBatchVertexDeclaration=g;var x=E.vertexBatchElementList;x.length=0,x.push(T),x.push(this),n[n.length-1]=E}e.lastTransparentBatched=!0}}else n.push(this),e.lastTransparentBatched=!1}else n.push(this);e.lastTransparentRenderElement=this},i.destroy=function(){t.prototype.destroy.call(this),this._dynamicWorldPositions=null,this._dynamicWorldNormals=null,this.staticBatch=null,this.staticBatchElementList=null,this.vertexBatchElementList=null,this.vertexBatchVertexDeclaration=null},e._maxInstanceCount=1024,E(e,["_instanceMatrixData",function(){return this._instanceMatrixData=new Float32Array(16*e._maxInstanceCount)},"_instanceMatrixBuffer",function(){return this._instanceMatrixBuffer=new zn(4*e._instanceMatrixData.length,35048)}]),e}(Wi),Qr=function(t){function e(){this._car=null,this.moveSpeed=1.2,this.moveH=.15,this._speedDamp=0,this._wheelL=null,this._wheelR=null,this._wheelBL=null,this._wheelBR=null,this._isChangedDir=!1,this._isMouseDown=!1,this._fireL=null,this._fireR=null,this._shieldGasL=null,this._shieldGasR=null,this._fireLTrail=null,this._fireRTrail=null,this._fireBLTrail=null,this._fireBRTrail=null,this.flyHeight=5,this.flySpeedAdd=1.1,this._flySpeedAdd=0,this.flyTime=1200,this._isFly=!1,this.protectedTime=2e3,this._protectedTime=0,this._isProtected=!1,this._shieldBuff=null,this._shieldBuffMat=null,this._obsMinDis=1e3,e.__super.call(this),this._speed=new ln}I(e,"game.core.CarController",Dn);var i=e.prototype;return i.onAwake=function(){this._car=this.owner},i.onStart=function(){this._speed=new ln(.3*this.moveH,0,this.moveSpeed),this._wheelL=this._car.getChildByName("WL"),this._wheelR=this._car.getChildByName("WR"),this._wheelBL=this._car.getChildByName("WBL"),this._wheelBR=this._car.getChildByName("WBR"),this._fireLTrail=this._wheelL.getChildAt(0),this._fireRTrail=this._wheelR.getChildAt(0),this._fireBLTrail=this._wheelBL.getChildAt(0),this._fireBRTrail=this._wheelBR.getChildAt(0),this._fireL=this._car.getChildByName("FX_fireL"),this._fireR=this._car.getChildByName("FX_fireR"),this._fireL&&(this._fireL.transform.localScale=new ln(3,3,3)),this._fireR&&(this._fireR.transform.localScale=new ln(3,3,3)),this._shieldGasL=this._car.getChildByName("FX_shieldgas_L"),this._shieldGasR=this._car.getChildByName("FX_shieldgas_R"),this._shieldGasL&&(this._shieldGasL.transform.localScale=new ln(2,2,2)),this._shieldGasR&&(this._shieldGasR.transform.localScale=new ln(2,2,2));var t=this.moveH<0?-3:3;this._car.transform.localRotationEulerY=t;var e=this.moveSpeed;this.moveSpeed=0,Ii.to(this,{moveSpeed:e},2e3,Ue.quartIn),this._shieldBuff=es.instantiate(Hn.getRes("res/unity/Conventional/fx_shield_buff.lh")),this._shieldBuff.transform.localRotationEulerX=90,this._shieldBuff.transform.localScale=new ln(5,5,5),this._shieldBuff.transform.localPosition=new ln(0,0,0),this._shieldBuffMat=this._shieldBuff.getChildAt(0).meshRenderer.sharedMaterial,T.stage.on("mousedown",this,this.onStageTouchDown),T.stage.on("mouseup",this,this.onStageTouchUp)},i.showOrHideShieldBuff=function(t){var e=this;Ii.clearTween(this._shieldBuffMat),t?(this._shieldBuff.parent||this.owner.addChild(this._shieldBuff),this._shieldBuffMat.colorA=.2):this._shieldBuff.parent&&Ii.to(this._shieldBuffMat,{colorA:.02},800,null,y.create(this,function(){e.owner.removeChild(e._shieldBuff)}))},i.onStageTouchDown=function(t){this._isFly||1<this._flySpeedAdd||$r.instance.isGameOvered||(this.moveH=-this.moveH,this._isMouseDown=!0,this._isChangedDir=!0,this._speedDamp=.2,Ii.clearTween(this._car.transform),this._fireL&&this._fireL.particleSystem.play(),this._fireR&&this._fireR.particleSystem.play())},i.onStageTouchUp=function(t){if(this._isMouseDown=!1,this._fireL&&this._fireL.particleSystem.stop(),this._fireR&&this._fireR.particleSystem.stop(),!(this._isFly||1<this._flySpeedAdd||$r.instance.isGameOvered)){Ii.clearTween(this._car.transform);var e=this.moveH<0?-6:6;Ii.to(this._car.transform,{localRotationEulerY:e},600,Ue.quartOut)}},i.onUpdate=function(){if($r.instance.isGameStarted){var t=.001*T.timer.delta;this._isFly?this.fly(t):this.normalControl(t),this._isProtected&&(this._protectedTime-=T.timer.delta,this._protectedTime<0&&(this._isProtected=!1,this.showOrHideShieldBuff(!1)))}},i.startFly=function(){var t=this;this._isFly||(this._isFly=!0,this._flySpeedAdd=this.flySpeedAdd,this._fireBLTrail&&(this._fireBLTrail.active=!1,this._fireBRTrail.active=!1,this._fireLTrail.active=!1,this._fireRTrail.active=!1),this._fireL&&this._fireL.particleSystem.stop(),this._fireR&&this._fireR.particleSystem.stop(),this._shieldGasL&&this._shieldGasL.particleSystem.play(),this._shieldGasR&&this._shieldGasR.particleSystem.play(),Ii.clearTween(this._car.transform),Ii.to(this._car.transform,{localRotationEulerX:-8},.4*this.flyTime,Ue.cubicOut),Ii.to(this._car.transform,{localPositionY:this.flyHeight},.4*this.flyTime,Ue.cubicOut),Ii.to(this._car.transform,{localRotationEulerX:0},.6*this.flyTime,Ue.cubicOut,null,.4*this.flyTime),Ii.to(this._car.transform,{localPositionY:0},.6*this.flyTime,Ue.cubicIn,y.create(this,function(){t._isFly=!1,t._fireBLTrail&&(t._fireBLTrail.active=!0,t._fireBRTrail.active=!0,t._fireLTrail.active=!0,t._fireRTrail.active=!0),t._car.transform.localRotationEulerX=0,t._car.transform.localPositionY=0,t._flySpeedAdd*=1.6,t._shieldGasL&&t._shieldGasL.particleSystem.stop(),t._shieldGasR&&t._shieldGasR.particleSystem.stop(),t._isProtected||t.showOrHideShieldBuff(!1)}),.4*this.flyTime),8<Math.abs(this._car.transform.localRotationEulerY)&&Ii.to(this._car.transform,{localRotationEulerY:.3*this._car.transform.localRotationEulerY},this.flyTime),this.showOrHideShieldBuff(!0))},i.fly=function(t){this._speed.x=0,this._speed.z=this.moveSpeed*this._flySpeedAdd,this._car.transform.translate(this._speed,!1)},i.normalControl=function(t){if(this._isMouseDown){this._speedDamp*=.92;var e=this._car.transform.localRotationEulerY;this.moveH<0?-25<e&&(e-=3):e<25&&(e+=3),this._wheelL.transform.localRotationEulerY=e,this._wheelR.transform.localRotationEulerY=e,this._car.transform.localRotationEulerY=l.lerp(this._car.transform.localRotationEulerY,e,50*t)}else e=l.lerp(this._car.transform.localRotationEulerY,0,3*t),this._wheelL.transform.localRotationEulerY=e,this._wheelR.transform.localRotationEulerY=e;this._flySpeedAdd*=.95,this._flySpeedAdd<1&&(this._flySpeedAdd=1),this._speedDamp=1.2*this._speedDamp,1<this._speedDamp&&(this._speedDamp=1),$r.instance.isGameOvered?(this._speed.x=0,this._speed.z=this.moveSpeed,this._car.transform.translate(this._speed,!1),this._wheelL.transform.localRotationEulerY=0,this._wheelR.transform.localRotationEulerY=0,this._car.transform.localRotationEulerY=l.lerp(this._car.transform.localRotationEulerY,0,50*t)):(this._speed.x=0,this._speed.z=.5*this.moveSpeed+this.moveSpeed*this._speedDamp*.5*t,this._speed.z*=this._flySpeedAdd,this._car.transform.translate(this._speed)),1<this.moveSpeed&&this._isChangedDir&&!$r.instance.isGameOvered&&(this._speed.x=this.moveH*(1.5-this._speedDamp),this._speed.z=0,this._car.transform.translate(this._speed,!1))},i.startProtected=function(t){this._isProtected=!0,this._protectedTime=this.protectedTime,this.playBombEffect(!1,t,"fx_shield.lh",1.5,.5),this.showOrHideShieldBuff(!0)},i.onTriggerEnter=function(t){if($r.instance.isGameStarted&&!$r.instance.isGameOvered){var e=t.owner.name.toLowerCase(),i=t.owner;if(0==e.indexOf("yaya")||0<e.indexOf("plat_"))$r.instance.gameOver();else if(0==e.indexOf("obs_"))this.onColObstacle(i);else if(0==e.indexOf("dis_trigger")){var n=i.transform._parent.localScale.x;Ii.to(i.parent.transform,{localScaleX:1.2*n,localScaleY:1.2*n,localScaleZ:1.2*n},100),Ii.to(i.parent.transform,{localScaleX:n,localScaleY:n,localScaleZ:n},100,null,null,100),this._obsMinDis=1e3}else 0==e.indexOf("flybox")?this._car.transform.position.z<i.transform.position.z&&this.startFly():0==e.indexOf("shield")?this.startProtected(i):0==e.indexOf("diamond")?this.playBombEffect(!1,i,"fx_diamond.lh",1.5,.5):0==e.indexOf("finish")&&$r.instance.gameSuccess()}},i.onColObstacle=function(t){this._shieldBuff.parent?this.playBombEffect(!0,t,"fx_treebomb.lh"):t.transform.position.z>this._car.transform.position.z&&(Ii.to(t.transform,{localRotationEulerZ:l.randomNumber(-10,10)},100),Ii.to(t.transform,{localRotationEulerZ:0},500,Ue.elasticOut),$r.instance.gameOver())},i.onTriggerStay=function(t){if($r.instance.isGameStarted&&!$r.instance.isGameOvered){if(this._isFly||1<this._flySpeedAdd)return;var e=t.owner.name.toLowerCase(),i=t.owner;if(0==e.indexOf("dis_trigger")){var n=ln.distance(this._car.transform.position,i.transform.position);n<1.5?this.onColObstacle(i):n<this._obsMinDis&&(this._obsMinDis=n)}}},i.onTriggerExit=function(t){$r.instance.isGameStarted||console.log("min obs dis:"+this._obsMinDis)},i.playBombEffect=function(t,e,i,n,r,s){void 0===n&&(n=1.5),void 0===r&&(r=2),void 0===s&&(s=1e3);var a=$r.instance.scene3D.addChild(es.instantiate(Hn.getRes("res/unity/Conventional/"+i)));if(a.transform.localScale=new ln(r,r,r),ln.add(e.transform.position,new ln(0,n,0),a.transform.position),a.timerOnce(s,a,function(){a&&a.destroy()}),t&&!this._isFly){var o=e.getComponents(qs);if(o)for(var h=0;h<o.length;++h)o[h].enabled=!1;e.transform.localRotationEuler=new ln(0,0,0),Ii.to(e.transform,{localRotationEulerZ:l.randomNumber(-60,60),localRotationEulerX:l.randomNumber(-60,-30)},400),Ii.to(e.transform,{localPositionY:15+10*Math.random()},500,Ue.sineOut,y.create(this,function(){Ii.to(e.transform,{localPositionY:0},500,Ue.sineIn,y.create(this,function(){e.active=!1}))}))}else e.active=!1},i.onDestroy=function(){T.stage.off("mousedown",this,this.onStageTouchDown),T.stage.off("mouseup",this,this.onStageTouchUp),this._shieldBuff=null},g(0,i,"isFly",function(){return this._isFly}),g(0,i,"car",function(){return this._car}),e}(),$r=function(t){function e(){this._scene3d=null,this._camera=null,this._cameraFollow=null,this._mapContainer=null,this._carCtr=null,this._isGameStarted=!1,this._isGameOvered=!1,this._ranMap=null,this._mapPlatPrefix=null,this._mapSceneUrl=null,e.__super.call(this),this._mapType=2}I(e,"game.core.GameSceneManager",bn);var i=e.prototype;return i.onAwake=function(){(e.instance=this)._mapType=l.randomInt(1,3)},i.onStart=function(){var i=this;this._isGameOvered=!1,++this._mapType,3<this._mapType&&(this._mapType=1);var n=["res/unity/Conventional/fx_carBomb.lh","res/unity/Conventional/fx_shield.lh","res/unity/Conventional/fx_treebomb.lh","res/unity/Conventional/fx_diamond.lh","res/unity/Conventional/fx_shield_buff.lh","res/unity/Conventional/finish.lh","res/unity/Conventional/car_1.lh","res/unity/Conventional/car_2.lh","res/unity/Conventional/car_3.lh"],r="";1==this._mapType?(r="res/config/snowgame.json",this._mapSceneUrl="res/unity/Conventional/SnowGameScene.ls",this._mapPlatPrefix="res/unity/Conventional/SnowPlat_"):2==this._mapType?(r="res/config/desertgame.json",this._mapSceneUrl="res/unity/Conventional/DesertGameScene.ls",this._mapPlatPrefix="res/unity/Conventional/DesertPlat_"):3==this._mapType&&(r="res/config/grassgame.json",this._mapSceneUrl="res/unity/Conventional/GrassGameScene.ls",this._mapPlatPrefix="res/unity/Conventional/GrassPlat_"),n.push(this._mapSceneUrl),n.push(this._mapPlatPrefix+"0.lh"),n.push(this._mapPlatPrefix+"1000.lh"),T.loader.load(r,y.create(this,function(){var t=Hn.getRes(r).maps.lv1;i._ranMap=t[Math.floor(Math.random()*t.length)];for(var e=0;e<i._ranMap.length;++e)n.push(i._mapPlatPrefix+i._ranMap[e]+".lh");T.loader.create(n,y.create(this,i.on3dAssetsLoaded),y.create(this,function(t){}))}))},i.on3dAssetsLoaded=function(){this._scene3d=this.owner.addChild(Hn.getRes(this._mapSceneUrl)),this._mapContainer=new wn,this._scene3d.addChild(this._mapContainer);var t=this._scene3d.addChild(es.instantiate(Hn.getRes("res/unity/Conventional/car_1.lh")));t.transform.localScale=new ln(5,5,5),this._carCtr=t.addComponent(Qr),this._camera=this._scene3d.getChildByName("Main Camera"),this._camera.curved=.5,this._cameraFollow=this._camera.addComponent(Jr),this._cameraFollow.target=t.transform,this._cameraFollow.enableFollow=!0,this.showMap(this._ranMap),this._isGameStarted=!0},i.showMap=function(t){var e=this._mapPlatPrefix+"0.lh",i=es.instantiate(Hn.getRes(e));i.transform.localPosition=new ln(0,0,-100),this._mapContainer.addChild(i);for(var n=0;n<t.length;++n){var r=t[n];e=this._mapPlatPrefix+r+".lh",i=es.instantiate(Hn.getRes(e)),this._mapContainer.addChild(i),i.transform.localPosition=new ln(0,0,70+100*n)}e="res/unity/Conventional/finish.lh";var s=es.instantiate(Hn.getRes(e));s.transform.localPosition=new ln(0,.02,70+100*(t.length+.5)),this._mapContainer.addChild(s),e=this._mapPlatPrefix+"1000.lh";var a=Hn.getRes(e);for(n=0;n<7;++n)i=es.instantiate(a),this._mapContainer.addChild(i),i.transform.localPositionX=0,i.transform.localPosition=new ln(0,0,70+100*(t.length+n));i.transform.localPositionZ=0},i.gameOver=function(){if(this._isGameStarted){this._isGameStarted=!1;var t=this._scene3d.addChild(es.instantiate(Hn.getRes("res/unity/Conventional/fx_carBomb.lh")));ln.add(this._carCtr.car.transform.position,new ln(0,2,0),t.transform.position),t.transform.localScale=new ln(3,3,3),this._carCtr.owner.active=!1,T.timer.once(3e3,this,this.reStart)}},i.gameSuccess=function(){this._isGameOvered=!0,this._cameraFollow.enableFollow=!1,T.timer.once(3e3,this,this.reStart)},i.reStart=function(){this._scene3d.destroy(),this._mapContainer=null,this._scene3d=null,this._camera=null,this._cameraFollow=null,this._carCtr=null,this.onStart()},g(0,i,"isGameOvered",function(){return this._isGameOvered}),g(0,i,"isGameStarted",function(){return this._isGameStarted}),g(0,i,"scene3D",function(){return this._scene3d}),e.instance=null,e}(),Jr=function(t){function e(){this.target=null,this._self=null,this.enableFollow=!1,this._z=0,this._y=0,e.__super.call(this),this._pos=new ln}I(e,"game.core.CameraFollow",Dn);var i=e.prototype;return i.onAwake=function(){this._self=this.owner,this._pos=this._self.transform.position},i.onStart=function(){this._z=this._self.transform.position.z-this.target.position.z,this._y=this._self.transform.position.y},i.onLateUpdate=function(){this.enableFollow&&this.target&&(this._self.transform.position.z-this.target.position.z<=this._z&&(this._pos.z=this.target.position.z+this._z),this._pos.y=this._y,this._pos.x=.5*this.target.position.x,this._self.transform.position=this._pos)},e}(),ts=function(r){function e(){this._x=0,this._y=0,this._width=0,this._height=0,this._visible=!0,this._mouseState=0,this._zOrder=0,this._renderType=0,this._transform=null,this._tfChanged=!1,this._texture=null,this._boundStyle=null,this._graphics=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,e.__super.call(this),this._repaint=0,this._style=ot.EMPTY,this._cacheStyle=ie.EMPTY}I(e,"laya.display.Sprite",r);var t=e.prototype;return t.destroy=function(t){void 0===t&&(t=!0),r.prototype.destroy.call(this,t),this._style&&this._style.recover(),this._cacheStyle&&this._cacheStyle.recover(),this._boundStyle&&this._boundStyle.recover(),this._style=null,this._cacheStyle=null,this._boundStyle=null,this._transform=null,this._graphics&&this._graphics.autoDestroy&&this._graphics.destroy(),this._graphics=null,this.texture=null},t.updateZOrder=function(){nt.updateOrder(this._children)&&this.repaint()},t._getBoundsStyle=function(){return this._boundStyle||(this._boundStyle=ne.create()),this._boundStyle},t._setCustomRender=function(){},t._setCacheAs=function(t){},t._checkCanvasEnable=function(){var t=this._cacheStyle.needEnableCanvasRender();(this._getCacheStyle().enableCanvasRender=t)?(this._cacheStyle.needBitmapCache()?this._cacheStyle.cacheAs="bitmap":this._cacheStyle.cacheAs=this._cacheStyle.userSetCache,this._cacheStyle.reCache=!0,this._renderType|=8):(this._cacheStyle.cacheAs="none",this._cacheStyle.releaseContext(),this._renderType&=-9),this._setCacheAs(this._cacheStyle.cacheAs),this._setRenderType(this._renderType)},t.reCache=function(){this._cacheStyle.reCache=!0,this._repaint|=2},t.getRepaint=function(){return this._repaint},t._setX=function(t){this._x=t},t._setY=function(t){this._y=t},t._setWidth=function(t,e){},t._setHeight=function(t,e){},t.setSelfBounds=function(t){this._getBoundsStyle().userBounds=t},t.getBounds=function(){return this._getBoundsStyle().bounds=ve._getWrapRec(this._boundPointsToParent())},t.getSelfBounds=function(){return this._boundStyle&&this._boundStyle.userBounds?this._boundStyle.userBounds:this._graphics||0!==this._children.length||this._texture?this._getBoundsStyle().bounds=ve._getWrapRec(this._getBoundPointsM(!1)):ve.TEMP.setTo(0,0,0,0)},t._boundPointsToParent=function(t){void 0===t&&(t=!1);var e=0,i=0;this._style&&(e=this.pivotX,i=this.pivotY,t=t||0!==this._style.rotation,this._style.scrollRect&&(e+=this._style.scrollRect.x,i+=this._style.scrollRect.y));var n=this._getBoundPointsM(t);if(!n||n.length<1)return n;if(8!=n.length&&(n=t?bi.scanPList(n):ve._getWrapRec(n,ve.TEMP)._getBoundPoints()),!this.transform)return nt.transPointList(n,this._x-e,this._y-i),n;var r=R.TEMP,s=0,a=n.length;for(s=0;s<a;s+=2)r.x=n[s],r.y=n[s+1],this.toParentPoint(r),n[s]=r.x,n[s+1]=r.y;return n},t.getGraphicBounds=function(t){return void 0===t&&(t=!1),this._graphics?this._graphics.getBounds(t):ve.TEMP.setTo(0,0,0,0)},t._getBoundPointsM=function(t){if(void 0===t&&(t=!1),this._boundStyle&&this._boundStyle.userBounds)return this._boundStyle.userBounds._getBoundPoints();if(this._boundStyle||this._getBoundsStyle(),this._boundStyle.temBM||(this._boundStyle.temBM=[]),this._style.scrollRect){var e=nt.clearArray(this._boundStyle.temBM),i=ve.TEMP;return i.copyFrom(this._style.scrollRect),nt.concatArray(e,i._getBoundPoints()),e}var n,r,s,a;this._graphics?n=this._graphics.getBoundPoints():(n=nt.clearArray(this._boundStyle.temBM),this._texture&&((i=ve.TEMP).setTo(0,0,this.width||this._texture.width,this.height||this._texture.height),nt.concatArray(n,i._getBoundPoints())));for(var o=0,h=(a=this._children).length;o<h;o++)(r=a[o])instanceof laya.display.Sprite&&!0===r._visible&&(s=r._boundPointsToParent(t))&&(n=n?nt.concatArray(n,s):s);return n},t._getCacheStyle=function(){return this._cacheStyle===ie.EMPTY&&(this._cacheStyle=ie.create()),this._cacheStyle},t.getStyle=function(){return this._style===ot.EMPTY&&(this._style=ot.create()),this._style},t.setStyle=function(t){this._style=t},t._setScaleX=function(t){this._style.scaleX=t},t._setScaleY=function(t){this._style.scaleY=t},t._setRotation=function(t){this._style.rotation=t},t._setSkewX=function(t){this._style.skewX=t},t._setSkewY=function(t){this._style.skewY=t},t._createTransform=function(){return It.create()},t._adjustTransform=function(){this._tfChanged=!1;var t=this._style,e=t.scaleX,i=t.scaleY,n=t.skewX,r=t.skewY,s=t.rotation,a=this._transform||(this._transform=this._createTransform());if(s||1!==e||1!==i||0!==n||0!==r){a._bTransform=!0;var o=.0174532922222222*(s-n),h=.0174532922222222*(s+r),l=Math.cos(h),u=Math.sin(h),c=Math.sin(o),_=Math.cos(o);a.a=e*l,a.b=e*u,a.c=-i*c,a.d=i*_,a.tx=a.ty=0}else a.identity(),this._renderType&=-3,this._setRenderType(this._renderType);return a},t._setTransform=function(t){},t._setPivotX=function(t){this.getStyle().pivotX=t},t._getPivotX=function(){return this._style.pivotX},t._setPivotY=function(t){this.getStyle().pivotY=t},t._getPivotY=function(){return this._style.pivotY},t._setAlpha=function(t){this._style.alpha!==t&&(1!==(this.getStyle().alpha=t)?this._renderType|=1:this._renderType&=-2,this._setRenderType(this._renderType),this.parentRepaint())},t._getAlpha=function(){return this._style.alpha},t._setBlendMode=function(t){},t._setGraphics=function(t){},t._setGraphicsCallBack=function(){},t._setScrollRect=function(t){},t.pos=function(t,e,i){if(void 0===i&&(i=!1),this._x!==t||this._y!==e){if(this.destroyed)return this;if(i){this._setX(t),this._setY(e),this.parentRepaint(2);var n=this._cacheStyle.maskParent;n&&n.repaint(2)}else this.x=t,this.y=e}return this},t.pivot=function(t,e){return this.pivotX=t,this.pivotY=e,this},t.size=function(t,e){return this.width=t,this.height=e,this},t.scale=function(t,e,i){void 0===i&&(i=!1);var n=this.getStyle();if(n.scaleX!=t||n.scaleY!=e){if(this.destroyed)return this;i?(this._setScaleX(t),this._setScaleY(e),this._setTranformChange()):(this.scaleX=t,this.scaleY=e)}return this},t.skew=function(t,e){return this.skewX=t,this.skewY=e,this},t.render=function(t,e,i){Sn.renders[this._renderType]._fun(this,t,e+this._x,i+this._y),this._repaint=0},t.drawToCanvas=function(t,e,i,n){return Ki.drawToCanvas(this,this._renderType,t,e,i,n)},t.drawToTexture=function(t,e,i,n){return Ki.drawToTexture(this,this._renderType,t,e,i,n)},t.customRender=function(t,e,i){this._repaint=3},t._applyFilters=function(){},t._setColorFilter=function(t){},t._isHaveGlowFilter=function(){var t,e=0;if(this.filters)for(e=0;e<this.filters.length;e++)if(8==this.filters[e].type)return!0;for(e=0,t=this._children.length;e<t;e++)if(this._children[e]._isHaveGlowFilter())return!0;return!1},t.localToGlobal=function(t,e,i){void 0===e&&(e=!1),!0===e&&(t=new R(t.x,t.y));var n=this;for(i=i||T.stage;n&&!n.destroyed&&n!=i;)t=n.toParentPoint(t),n=n.parent;return t},t.globalToLocal=function(t,e,i){void 0===e&&(e=!1),e&&(t=new R(t.x,t.y));var n=this,r=[];for(i=i||T.stage;n&&!n.destroyed&&n!=i;)r.push(n),n=n.parent;for(var s=r.length-1;0<=s;)t=(n=r[s]).fromParentPoint(t),s--;return t},t.toParentPoint=function(t){if(!t)return t;t.x-=this.pivotX,t.y-=this.pivotY,this.transform&&this._transform.transformPoint(t),t.x+=this._x,t.y+=this._y;var e=this._style.scrollRect;return e&&(t.x-=e.x,t.y-=e.y),t},t.fromParentPoint=function(t){if(!t)return t;t.x-=this._x,t.y-=this._y;var e=this._style.scrollRect;return e&&(t.x+=e.x,t.y+=e.y),this.transform&&this._transform.invertTransformPoint(t),t.x+=this.pivotX,t.y+=this.pivotY,t},t.fromStagePoint=function(t){return t},t.on=function(t,e,i,n){return 1!==this._mouseState&&this.isMouseEvent(t)?(this.mouseEnabled=!0,this._setBit(64,!0),this._parent&&this._$2__onDisplay(),this._createListener(t,e,i,n,!1)):r.prototype.on.call(this,t,e,i,n)},t.once=function(t,e,i,n){return 1!==this._mouseState&&this.isMouseEvent(t)?(this.mouseEnabled=!0,this._setBit(64,!0),this._parent&&this._$2__onDisplay(),this._createListener(t,e,i,n,!0)):r.prototype.once.call(this,t,e,i,n)},t._$2__onDisplay=function(){if(1!==this._mouseState){var t=this;for(t=t.parent;t&&1!==t._mouseState&&!t._getBit(64);)t.mouseEnabled=!0,t._setBit(64,!0),t=t.parent}},t._setParent=function(t){r.prototype._setParent.call(this,t),t&&this._getBit(64)&&this._$2__onDisplay()},t.loadImage=function(t,e){var i=this;if(null==t)this.texture=null,r();else{var n=Hn.getRes(t);n||((n=new xr).load(t),Hn.cacheRes(t,n)),(this.texture=n).getIsReady()?r():n.once("ready",null,r)}function r(){i.repaint(3),e&&e.run()}return this},t.repaint=function(t){void 0===t&&(t=2),this._repaint&t||(this._repaint|=t,this.parentRepaint(t)),this._cacheStyle&&this._cacheStyle.maskParent&&this._cacheStyle.maskParent.repaint(t)},t._needRepaint=function(){return 2&this._repaint&&this._cacheStyle.enableCanvasRender&&this._cacheStyle.reCache},t._childChanged=function(t){this._children.length?this._renderType|=8192:this._renderType&=-8193,this._setRenderType(this._renderType),t&&this._getBit(32)&&T.systemTimer.callLater(this,this.updateZOrder),this.repaint(3)},t.parentRepaint=function(t){void 0===t&&(t=2);var e=this._parent;!e||e._repaint&t||(e._repaint|=t,e.parentRepaint(t))},t._setMask=function(t){},t.startDrag=function(t,e,i,n,r,s,a){void 0===e&&(e=!1),void 0===i&&(i=0),void 0===n&&(n=300),void 0===s&&(s=!1),void 0===a&&(a=.92),this._style.dragging||(this.getStyle().dragging=new dn),this._style.dragging.start(this,t,e,i,n,r,s,a)},t.stopDrag=function(){this._style.dragging&&this._style.dragging.stop()},t._setDisplay=function(t){t||this._cacheStyle&&(this._cacheStyle.releaseContext(),this._cacheStyle.releaseFilterCache(),this._cacheStyle.hasGlowFilter&&(this._cacheStyle.hasGlowFilter=!1)),r.prototype._setDisplay.call(this,t)},t.hitTestPoint=function(t,e){var i=this.globalToLocal(R.TEMP.setTo(t,e));return t=i.x,e=i.y,(this._style.hitArea?this._style.hitArea:0<this._width&&0<this._height?ve.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds()).contains(t,e)},t.getMousePoint=function(){return this.globalToLocal(R.TEMP.setTo(T.stage.mouseX,T.stage.mouseY))},t._setTexture=function(t){},t._setRenderType=function(t){},t._setTranformChange=function(){this._tfChanged=!0,this._renderType|=2,this.parentRepaint(2)},t._setBgStyleColor=function(t,e,i,n,r){},t._setBorderStyleColor=function(t,e,i,n,r,s){},t.captureMouseEvent=function(t){wi.instance.setCapture(this,t)},t.releaseMouseEvent=function(){wi.instance.releaseCapture()},g(0,t,"texture",function(){return this._texture},function(t){"string"==typeof t?this.loadImage(t):this._texture!=t&&(this._texture&&this._texture._removeReference(),(this._texture=t)&&t._addReference(),this._setTexture(t),this._setWidth(this._texture,this.width),this._setHeight(this._texture,this.height),t?this._renderType|=256:this._renderType&=-257,this._setRenderType(this._renderType),this.repaint())}),g(0,t,"mouseY",function(){return this.getMousePoint().y}),g(0,t,"globalRotation",function(){for(var t=0,e=this;e&&e!==T.stage;)t+=e.rotation,e=e.parent;return t}),g(0,t,"globalScaleX",function(){for(var t=1,e=this;e&&e!==T.stage;)t*=e.scaleX,e=e.parent;return t}),g(0,t,"mouseEnabled",function(){return 1<this._mouseState},function(t){this._mouseState=t?2:1}),g(0,t,"mask",function(){return this._cacheStyle.mask},function(t){t&&this.mask&&this.mask._cacheStyle.maskParent||(this._getCacheStyle().mask=t,this._setMask(t),this._checkCanvasEnable(),t?t._getCacheStyle().maskParent=this:this.mask&&(this.mask._getCacheStyle().maskParent=null),this._renderType|=32,this._setRenderType(this._renderType),this.parentRepaint(3))}),g(0,t,"hitArea",function(){return this._style.hitArea},function(t){this.getStyle().hitArea=t}),g(0,t,"drawCallOptimize",function(){return this._getBit(256)},function(t){this._setBit(256,t)}),g(0,t,"graphics",function(){return this._graphics||(this.graphics=new $,this._graphics.autoDestroy=!0),this._graphics},function(t){this._graphics&&(this._graphics._sp=null),(this._graphics=t)?(this._setGraphics(t),this._renderType|=512,t._sp=this):this._renderType&=-513,this._setRenderType(this._renderType),this.repaint()}),g(0,t,"blendMode",function(){return this._style.blendMode},function(t){this._setBlendMode(t),(this.getStyle().blendMode=t)&&"source-over"!=t?this._renderType|=4:this._renderType&=-5,this._setRenderType(this._renderType),this.parentRepaint()}),g(0,t,"filters",function(){return this._cacheStyle.filters},function(t){t&&0===t.length&&(t=null),this._cacheStyle.filters!=t&&(this._getCacheStyle().filters=t?t.slice():null,t&&t.length?(this._setColorFilter(t[0]),this._renderType|=16):(this._setColorFilter(null),this._renderType&=-17),this._setRenderType(this._renderType),t&&0<t.length?(this._getBit(16)||this._setBitUp(16),1==t.length&&t[0]instanceof laya.filters.ColorFilter||(this._getCacheStyle().cacheForFilters=!0,this._checkCanvasEnable())):this._cacheStyle.cacheForFilters&&(this._cacheStyle.cacheForFilters=!1,this._checkCanvasEnable()),this._getCacheStyle().hasGlowFilter=this._isHaveGlowFilter(),this.repaint())}),g(0,t,"globalScaleY",function(){for(var t=1,e=this;e&&e!==T.stage;)t*=e.scaleY,e=e.parent;return t}),g(0,t,"alpha",function(){return this._getAlpha()},function(t){t=t<0?0:1<t?1:t,this._setAlpha(t)}),g(0,t,"scaleX",function(){return this._style.scaleX},function(t){this.getStyle().scaleX!==t&&(this._setScaleX(t),this._setTranformChange())}),g(0,t,"skewY",function(){return this._style.skewY},function(t){this.getStyle().skewY!==t&&(this._setSkewY(t),this._setTranformChange())}),g(0,t,"visible",function(){return this._visible},function(t){this._visible!==t&&(this._visible=t,this.parentRepaint(3))}),g(0,t,"pivotY",function(){return this._getPivotY()},function(t){this._setPivotY(t),this.repaint()}),g(0,t,"y",function(){return this._y},function(t){if(!this.destroyed&&this._y!==t){this._setY(t),this.parentRepaint(2);var e=this._cacheStyle.maskParent;e&&e.repaint(2)}}),g(0,t,"pivotX",function(){return this._getPivotX()},function(t){this._setPivotX(t),this.repaint()}),g(0,t,"viewport",function(){return this._style.viewport},function(t){var e;"string"==typeof t&&(3<(e=t.split(",")).length&&(t=new ve(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]))));this.getStyle().viewport=t}),g(0,t,"scrollRect",function(){return this._style.scrollRect},function(t){this.getStyle().scrollRect=t,this._setScrollRect(t),this.repaint(),t?this._renderType|=64:this._renderType&=-65,this._setRenderType(this._renderType)}),g(0,t,"rotation",function(){return this._style.rotation},function(t){this.getStyle().rotation!==t&&(this._setRotation(t),this._setTranformChange())}),g(0,t,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function(t){this._tfChanged=!1;var e=this._transform||(this._transform=this._createTransform());t.copyTo(e),this._setTransform(e),t&&(this._x=e.tx,this._y=e.ty,e.tx=e.ty=0),t?this._renderType|=2:this._renderType&=-3,this._setRenderType(this._renderType),this.parentRepaint()}),g(0,t,"scaleY",function(){return this._style.scaleY},function(t){this.getStyle().scaleY!==t&&(this._setScaleY(t),this._setTranformChange())}),g(0,t,"skewX",function(){return this._style.skewX},function(t){this.getStyle().skewX!==t&&(this._setSkewX(t),this._setTranformChange())}),g(0,t,"cacheAs",function(){return this._cacheStyle.cacheAs},function(t){t!==this._cacheStyle.userSetCache&&(this.mask&&"normal"===t||(this._setCacheAs(t),this._getCacheStyle().userSetCache=t,this._checkCanvasEnable(),this.repaint()))}),g(0,t,"staticCache",function(){return this._cacheStyle.staticCache},function(t){(this._getCacheStyle().staticCache=t)||this.reCache()}),g(0,t,"displayWidth",function(){return this.width*this.scaleX}),g(0,t,"mouseX",function(){return this.getMousePoint().x}),g(0,t,"width",function(){return this.autoSize?this.texture?this.texture.width:this._graphics||0!==this._children.length?this.getSelfBounds().width:0:this._width||(this.texture?this.texture.width:0)},function(t){this._width!==t&&(this._width=t,this._setWidth(this.texture,t),this._setTranformChange())}),g(0,t,"displayHeight",function(){return this.height*this.scaleY}),g(0,t,"x",function(){return this._x},function(t){if(!this.destroyed&&this._x!==t){this._setX(t),this.parentRepaint(2);var e=this._cacheStyle.maskParent;e&&e.repaint(2)}}),g(0,t,"height",function(){return this.autoSize?this.texture?this.texture.height:this._graphics||0!==this._children.length?this.getSelfBounds().height:0:this._height||(this.texture?this.texture.height:0)},function(t){this._height!==t&&(this._height=t,this._setHeight(this.texture,t),this._setTranformChange())}),g(0,t,"zOrder",function(){return this._zOrder},function(t){this._zOrder!=t&&(this._zOrder=t,this._parent&&(t&&this._parent._setBit(32,!0),T.systemTimer.callLater(this._parent,this.updateZOrder)))}),g(0,t,"stage",function(){return T.stage}),g(0,t,"customRenderEnable",null,function(t){t&&(this._renderType|=2048,this._setRenderType(this._renderType),this._setCustomRender())}),e.fromImage=function(t){return(new e).loadImage(t)},e}(wn),es=function(o){function h(t,e){this._needProcessCollisions=!1,this._needProcessTriggers=!1,h.__super.call(this),void 0===e&&(e=!1),this._id=++h._uniqueIDCounter,this._transform=new ir(this),this._isStatic=e,this.layer=0,this.name=t||"New Sprite3D"}I(h,"laya.d3.core.Sprite3D",o);var t=h.prototype;return T.imps(t,{"laya.resource.ICreateResource":!0}),t._setCreateURL=function(t){this._url=gn.formatURL(t)},t._changeAnimatorsToLinkSprite3D=function(t,e,i){var n=this.getComponent(nr);if(n&&(n.avatar||t._changeAnimatorToLinkSprite3DNoAvatar(n,e,i)),this._parent&&this._parent instanceof laya.d3.core.Sprite3D){i.unshift(this._parent.name);var r=this._parent;r._hierarchyAnimator&&r._changeAnimatorsToLinkSprite3D(t,e,i)}},t._setHierarchyAnimator=function(t,e){this._changeHierarchyAnimator(t),this._changeAnimatorAvatar(t.avatar);for(var i=0,n=this._children.length;i<n;i++){var r=this._children[i];r._hierarchyAnimator==e&&r._setHierarchyAnimator(t,e)}},t._clearHierarchyAnimator=function(t,e){this._changeHierarchyAnimator(e),this._changeAnimatorAvatar(e?e.avatar:null);for(var i=0,n=this._children.length;i<n;i++){var r=this._children[i];r._hierarchyAnimator==t&&r._clearHierarchyAnimator(t,e)}},t._changeHierarchyAnimatorAvatar=function(t,e){this._changeAnimatorAvatar(e);for(var i=0,n=this._children.length;i<n;i++){var r=this._children[i];r._hierarchyAnimator==t&&r._changeHierarchyAnimatorAvatar(t,e)}},t._changeAnimatorToLinkSprite3DNoAvatar=function(t,e,i){t._handleSpriteOwnersBySprite(e,i,this);for(var n=0,r=this._children.length;n<r;n++){var s=this._children[n],a=i.length;i.push(s.name),s._changeAnimatorToLinkSprite3DNoAvatar(t,e,i),i.splice(a,1)}},t._changeHierarchyAnimator=function(t){this._hierarchyAnimator=t},t._changeAnimatorAvatar=function(t){},t._onAdded=function(){if(this._parent instanceof laya.d3.core.Sprite3D){var t=this._parent;this.transform._setParent(t.transform),t._hierarchyAnimator&&(!this._hierarchyAnimator&&this._setHierarchyAnimator(t._hierarchyAnimator,null),t._changeAnimatorsToLinkSprite3D(this,!0,[this.name]))}o.prototype._onAdded.call(this)},t._onRemoved=function(){if(o.prototype._onRemoved.call(this),this._parent instanceof laya.d3.core.Sprite3D){var t=this._parent;this.transform._setParent(null),t._hierarchyAnimator&&(this._hierarchyAnimator==t._hierarchyAnimator&&this._clearHierarchyAnimator(t._hierarchyAnimator,null),t._changeAnimatorsToLinkSprite3D(this,!1,[this.name]))}},t._parse=function(t,e){if(void 0!==t.isStatic&&(this._isStatic=t.isStatic),void 0!==t.active&&(this.active=t.active),null!=t.name&&(this.name=t.name),void 0!==t.position){var i=this.transform.localPosition;i.fromArray(t.position),this.transform.localPosition=i}if(void 0!==t.rotationEuler){var n=this.transform.localRotationEuler;n.fromArray(t.rotationEuler),this.transform.localRotationEuler=n}if(void 0!==t.rotation){var r=this.transform.localRotation;r.fromArray(t.rotation),this.transform.localRotation=r}if(void 0!==t.scale){var s=this.transform.localScale;s.fromArray(t.scale),this.transform.localScale=s}null!=t.layer&&(this.layer=t.layer)},t._cloneTo=function(t,e,i){if(this.destroyed)throw new Error("Sprite3D: Can't be cloned if the Sprite3D has destroyed.");var n=t;n.name=this.name,n.destroyed=this.destroyed,n.active=this.active;var r=n.transform.localPosition;this.transform.localPosition.cloneTo(r),n.transform.localPosition=r;var s=n.transform.localRotation;this.transform.localRotation.cloneTo(s),n.transform.localRotation=s;var a=n.transform.localScale;this.transform.localScale.cloneTo(a),n.transform.localScale=a,n._isStatic=this._isStatic,n.layer=this.layer,o.prototype._cloneTo.call(this,n,e,i)},t.clone=function(){var t=h._createSprite3DInstance(this);return h._parseSprite3DInstance(this,t,this,t),t},t.destroy=function(t){void 0===t&&(t=!0),this.destroyed||(o.prototype.destroy.call(this,t),this._transform=null,this._scripts=null,this._url&&Hn.clearRes(this._url))},g(0,t,"transform",function(){return this._transform}),g(0,t,"layer",function(){return this._layer},function(t){if(this._layer!==t){if(!(0<=t&&t<=30))throw new Error("Layer value must be 0-30.");this._layer=t}}),g(0,t,"isStatic",function(){return this._isStatic}),g(0,t,"url",function(){return this._url}),g(0,t,"id",function(){return this._id}),h._parse=function(t,e,i){var n,r=t.data,s=[];switch(t.version){case"LAYAHIERARCHY:02":n=V._createNodeByJson02(r,s);break;default:n=V._createNodeByJson(r,s)}return Bt.combine(n,s),n},h.__init__=function(){},h.instantiate=function(t,e,i,n,r){void 0===i&&(i=!0);var s=t.clone();e&&e.addChild(s);var a=s.transform;if(i){var o=a.worldMatrix;t.transform.worldMatrix.cloneTo(o),a.worldMatrix=o}else n&&(a.position=n),r&&(a.rotation=r);return s},h.load=function(t,e){T.loader.create(t,e,null,"HIERARCHY")},h._createSprite3DInstance=function(t){for(var e=new t.constructor,i=t._children,n=0,r=i.length;n<r;n++){var s=h._createSprite3DInstance(i[n]);e.addChild(s)}return e},h._parseSprite3DInstance=function(t,e,i,n){for(var r=i._children,s=n._children,a=0,o=r.length;a<o;a++)h._parseSprite3DInstance(t,e,r[a],s[a]);i._cloneTo(n,t,e)},h._uniqueIDCounter=0,E(h,["WORLDMATRIX",function(){return this.WORLDMATRIX=We.propertyNameToID("u_WorldMat")},"MVPMATRIX",function(){return this.MVPMATRIX=We.propertyNameToID("u_MvpMatrix")}]),h}(wn),is=function(t){function S(){S.__super.call(this),this._nodes=new an,this._events=[]}I(S,"laya.d3.animation.AnimationClip",Nn);var e=S.prototype;return e.duration=function(){return this._duration},e._hermiteInterpolate=function(t,e,i,n){var r=t.outTangent,s=e.inTangent;if(Number.isFinite(r)&&Number.isFinite(s)){var a=i*i,o=a*i,h=o-2*a+i,l=o-a,u=-2*o+3*a;return(2*o-3*a+1)*t.value+h*r*n+l*s*n+u*e.value}return t.value},e._hermiteInterpolateVector3=function(t,e,i,n,r){var s=t.value,a=t.outTangent,o=e.value,h=e.inTangent,l=i*i,u=l*i,c=2*u-3*l+1,_=u-2*l+i,d=u-l,f=-2*u+3*l,p=a.x,m=h.x;Number.isFinite(p)&&Number.isFinite(m)?r.x=c*s.x+_*p*n+d*m*n+f*o.x:r.x=s.x,p=a.y,m=h.y,Number.isFinite(p)&&Number.isFinite(m)?r.y=c*s.y+_*p*n+d*m*n+f*o.y:r.y=s.y,p=a.z,m=h.z,Number.isFinite(p)&&Number.isFinite(m)?r.z=c*s.z+_*p*n+d*m*n+f*o.z:r.z=s.z},e._hermiteInterpolateQuaternion=function(t,e,i,n,r){var s=t.value,a=t.outTangent,o=e.value,h=e.inTangent,l=i*i,u=l*i,c=2*u-3*l+1,_=u-2*l+i,d=u-l,f=-2*u+3*l,p=a.x,m=h.x;Number.isFinite(p)&&Number.isFinite(m)?r.x=c*s.x+_*p*n+d*m*n+f*o.x:r.x=s.x,p=a.y,m=h.y,Number.isFinite(p)&&Number.isFinite(m)?r.y=c*s.y+_*p*n+d*m*n+f*o.y:r.y=s.y,p=a.z,m=h.z,Number.isFinite(p)&&Number.isFinite(m)?r.z=c*s.z+_*p*n+d*m*n+f*o.z:r.z=s.z,p=a.w,m=h.w,Number.isFinite(p)&&Number.isFinite(m)?r.w=c*s.w+_*p*n+d*m*n+f*o.w:r.w=s.w},e._evaluateClipDatasRealTime=function(t,e,i,n,r){for(var s=0,a=t.count;s<a;s++){var o=t.getNodeByIndex(s),h=o.type,l=0,u=o._keyFrames,c=u.length,_=i[s];if(r)for(-1!==_&&e<u[_].time&&(_=-1,i[s]=_),l=_+1;l<c&&!(u[l].time>e);)_++,l++,i[s]=_;else for((l=_+1)!==c&&e>u[l].time&&(_=c-1,i[s]=_),l=_+1;-1<_&&!(u[_].time<e);)_--,l--,i[s]=_;var d=l===c;switch(h){case 0:if(-1!==_){var f=u[_];if(d)o.data=f.value;else{var p=u[l],m=p.time-f.time,g=NaN;g=0!==m?(e-f.time)/m:0,o.data=this._hermiteInterpolate(f,p,g,m)}}else o.data=u[0].value;n&&(o.data-=u[0].value);break;case 1:case 4:var v=o.data;if(this._evaluateFrameNodeVector3DatasRealTime(u,_,d,e,v),n){var T=u[0].value;v.x-=T.x,v.y-=T.y,v.z-=T.z}break;case 2:var y=o.data;if(this._evaluateFrameNodeQuaternionDatasRealTime(u,_,d,e,y),n){var E=S._tempQuaternion0,x=u[0].value;V.quaternionConjugate(x,E),Qt.multiply(E,y,y)}break;case 3:v=o.data,this._evaluateFrameNodeVector3DatasRealTime(u,_,d,e,v),n&&(T=u[0].value,v.x/=T.x,v.y/=T.y,v.z/=T.z);break;default:throw"AnimationClip:unknown node type."}}},e._evaluateClipDatasRealTimeForNative=function(t,e,i,n){Nt.instance.evaluateClipDatasRealTime(t._nativeObj,e,i,n)},e._evaluateFrameNodeVector3DatasRealTime=function(t,e,i,n,r){if(-1!==e){var s=t[e];if(i){var a=s.value;r.x=a.x,r.y=a.y,r.z=a.z}else{var o=t[e+1],h=NaN,l=s.time,u=o.time-l;h=0!==u?(n-l)/u:0,this._hermiteInterpolateVector3(s,o,h,u,r)}}else{var c=t[0].value;r.x=c.x,r.y=c.y,r.z=c.z}},e._evaluateFrameNodeQuaternionDatasRealTime=function(t,e,i,n,r){if(-1!==e){var s=t[e];if(i){var a=s.value;r.x=a.x,r.y=a.y,r.z=a.z,r.w=a.w}else{var o=t[e+1],h=NaN,l=s.time,u=o.time-l;h=0!==u?(n-l)/u:0,this._hermiteInterpolateQuaternion(s,o,h,u,r)}}else{var c=t[0].value;r.x=c.x,r.y=c.y,r.z=c.z,r.w=c.w}},e._binarySearchEventIndex=function(t){for(var e=0,i=this._events.length-1,n=0;e<=i;){n=Math.floor((e+i)/2);var r=this._events[n].time;if(r==t)return n;t<r?i=n-1:e=n+1}return e},e.addEvent=function(t){var e=this._binarySearchEventIndex(t.time);this._events.splice(e,0,t)},e._disposeResource=function(){this._nodes=null,this._nodesMap=null},S._parse=function(t,e,i){var n=new S,r=new Ce(t),s=r.readUTFString();switch(s){case"LAYAANIMATION:03":d.parse(n,r);break;case"LAYAANIMATION:04":case"LAYAANIMATION:COMPRESSION_04":_.parse(n,r,s);break;default:throw"unknown animationClip version."}return n},S.load=function(t,e){T.loader.create(t,e,null,"ANIMATIONCLIP")},E(S,["_tempQuaternion0",function(){return this._tempQuaternion0=new Qt}]),S}(),ns=function(t){function e(){e.__super.call(this),this._width=-1,this._height=-1}I(e,"laya.resource.Bitmap",Nn);var i=e.prototype;return i._getSource=function(){throw"Bitmap: must override it."},g(0,i,"height",function(){return this._height}),g(0,i,"width",function(){return this._width}),e}(),rs=(function(i){function r(t,e,i,n){this._maxSlope=45,this._jumpSpeed=10,this._fallSpeed=55,this._upAxis=new ln(0,1,0),this._gravity=new ln(0,3*-9.8,0),void 0===t&&(t=.1),void 0===i&&(i=1),void 0===n&&(n=$t.COLLISIONFILTERGROUP_ALLFILTER),this._stepHeight=t,e&&(this._upAxis=e),r.__super.call(this,i,n)}I(r,"laya.d3.physics.CharacterController",i);var t=r.prototype;t._constructCharacter=function(){var t=In._physics3D;this._nativeKinematicCharacter&&t.destroy(this._nativeKinematicCharacter);var e=r._nativeTempVector30;e.setValue(this._upAxis.x,this._upAxis.y,this._upAxis.z),this._nativeKinematicCharacter=new t.btKinematicCharacterController(this._nativeColliderObject,this._colliderShape._nativeShape,this._stepHeight,e),this.fallSpeed=this._fallSpeed,this.maxSlope=this._maxSlope,this.jumpSpeed=this._jumpSpeed,this.gravity=this._gravity},t._onShapeChange=function(t){i.prototype._onShapeChange.call(this,t),this._constructCharacter()},t._onAdded=function(){var t=new In._physics3D.btPairCachingGhostObject;t.setUserIndex(this.id),t.setCollisionFlags(16),this._nativeColliderObject=t,this._colliderShape&&this._constructCharacter(),i.prototype._onAdded.call(this)},t._addToSimulation=function(){this._simulation._characters.push(this),this._simulation._addCharacter(this,this._collisionGroup,this._canCollideWith)},t._removeFromSimulation=function(){this._simulation._removeCharacter(this);var t=this._simulation._characters;t.splice(t.indexOf(this),1)},t._cloneTo=function(t){i.prototype._cloneTo.call(this,t);var e=t;e.stepHeight=this._stepHeight,e.upAxis=this._upAxis,e.maxSlope=this._maxSlope,e.jumpSpeed=this._jumpSpeed,e.fallSpeed=this._fallSpeed,e.gravity=this._gravity},t._onDestroy=function(){In._physics3D.destroy(this._nativeKinematicCharacter),i.prototype._onDestroy.call(this),this._nativeKinematicCharacter=null},t.move=function(t){var e=Pn._nativeVector30;e.setValue(-t.x,t.y,t.z),this._nativeKinematicCharacter.setWalkDirection(e)},t.jump=function(t){if(t){var e=Pn._nativeVector30;V._convertToBulletVec3(t,e,!0),this._nativeKinematicCharacter.jump(e)}else this._nativeKinematicCharacter.jump()},g(0,t,"stepHeight",function(){return this._stepHeight},function(t){this._stepHeight=t,this._constructCharacter()}),g(0,t,"isGrounded",function(){return this._nativeKinematicCharacter.onGround()}),g(0,t,"upAxis",function(){return this._upAxis},function(t){this._upAxis=t,this._constructCharacter()}),g(0,t,"maxSlope",function(){return this._maxSlope},function(t){this._maxSlope=t,this._nativeKinematicCharacter.setMaxSlope(t/180*Math.PI)}),g(0,t,"gravity",function(){return this._gravity},function(t){this._gravity=t;var e=r._nativeTempVector30;e.setValue(-t.x,t.y,t.z),this._nativeKinematicCharacter.setGravity(e)}),g(0,t,"jumpSpeed",function(){return this._jumpSpeed},function(t){this._jumpSpeed=t,this._nativeKinematicCharacter.setJumpSpeed(t)}),g(0,t,"fallSpeed",function(){return this._fallSpeed},function(t){this._fallSpeed=t,this._nativeKinematicCharacter.setFallSpeed(t)}),r.UPAXIS_X=0,r.UPAXIS_Y=1,r.UPAXIS_Z=2,E(r,["_nativeTempVector30",function(){return this._nativeTempVector30=new In._physics3D.btVector3(0,0,0)}])}(Pn),function(t){function e(){e.__super.call(this)}return I(e,"laya.webgl.shader.BaseShader",Nn),e.activeShader=null,e.bindShader=null,e}()),ss=function(t){function e(t){this._projectionViewWorldMatrix=null,e.__super.call(this,t),this._projectionViewWorldMatrix=new gt}I(e,"laya.d3.core.pixelLine.PixelLineRenderer",Bn);var i=e.prototype;return i._calculateBoundingBox=function(){var t=this._bounds.getMin();t.x=-Number.MAX_VALUE,t.y=-Number.MAX_VALUE,t.z=-Number.MAX_VALUE,this._bounds.setMin(t);var e=this._bounds.getMax();if(e.x=Number.MAX_VALUE,e.y=Number.MAX_VALUE,e.z=Number.MAX_VALUE,this._bounds.setMax(e),qi.supportWebGLPlusCulling){t=this._bounds.getMin(),e=this._bounds.getMax();var i=ye._cullingBuffer;i[this._cullingBufferIndex+1]=t.x,i[this._cullingBufferIndex+2]=t.y,i[this._cullingBufferIndex+3]=t.z,i[this._cullingBufferIndex+4]=e.x,i[this._cullingBufferIndex+5]=e.y,i[this._cullingBufferIndex+6]=e.z}},i._renderUpdateWithCamera=function(t,e){var i=t.projectionViewMatrix,n=this._shaderValues;if(e){var r=e.worldMatrix;n.setMatrix4x4(es.WORLDMATRIX,r),gt.multiply(i,r,this._projectionViewWorldMatrix),n.setMatrix4x4(es.MVPMATRIX,this._projectionViewWorldMatrix)}else n.setMatrix4x4(es.WORLDMATRIX,gt.DEFAULT),n.setMatrix4x4(es.MVPMATRIX,i)},e}(),as=function(r){function e(){this._shaderValues=null,e.__super.call(this),this._defineDatas=new jt,this._disablePublicDefineDatas=new jt,this._shaderValues=new xe(this),this.renderQueue=2e3,this._alphaTest=!1}I(e,"laya.d3.core.material.BaseMaterial",r);var t=e.prototype;return T.imps(t,{"laya.d3.core.IClone":!0}),t._removeTetxureReference=function(){var t=this._shaderValues.getData();for(var e in t){var i=t[e];i&&i instanceof laya.resource.BaseTexture&&i._removeReference()}},t._addReference=function(t){void 0===t&&(t=1),r.prototype._addReference.call(this,t);var e=this._shaderValues.getData();for(var i in e){var n=e[i];n&&n instanceof laya.resource.BaseTexture&&n._addReference()}},t._removeReference=function(t){void 0===t&&(t=1),r.prototype._removeReference.call(this,t),this._removeTetxureReference()},t._disposeResource=function(){0<this._referenceCount&&this._removeTetxureReference(),this._shaderValues=null},t.setShaderName=function(t){if(this._shader=We.find(t),!this._shader)throw new Error("BaseMaterial: unknown shader name.")},t.cloneTo=function(t){var e=t;e.name=this.name,e.renderQueue=this.renderQueue,this._disablePublicDefineDatas.cloneTo(e._disablePublicDefineDatas),this._defineDatas.cloneTo(e._defineDatas),this._shaderValues.cloneTo(e._shaderValues)},t.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},g(0,t,"alphaTest",function(){return this._alphaTest},function(t){(this._alphaTest=t)?this._defineDatas.add(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST):this._defineDatas.remove(laya.d3.core.material.BaseMaterial.SHADERDEFINE_ALPHATEST)}),g(0,t,"alphaTestValue",function(){return this._shaderValues.getNumber(e.ALPHATESTVALUE)},function(t){this._shaderValues.setNumber(e.ALPHATESTVALUE,t)}),e.load=function(t,e){T.loader.create(t,e,null,"MATERIAL")},e.__init__=function(){e.SHADERDEFINE_ALPHATEST=e.shaderDefines.registerDefine("ALPHATEST")},e._parse=function(t,e,i){var n,r=t,s=r.props,a=s.type.split("."),o=Vt.window;if(a.forEach(function(t){o=o[t]}),"function"!=typeof o)throw"_getSprite3DHierarchyInnerUrls 错误: "+t.type+" 不是类";switch(n=new o,r.version){case"LAYAMATERIAL:01":case"LAYAMATERIAL:02":var h=0,l=0;for(var u in s)switch(u){case"vectors":var c=s[u];for(h=0,l=c.length;h<l;h++){var _=c[h],d=_.value;switch(d.length){case 2:n[_.name]=new un(d[0],d[1]);break;case 3:n[_.name]=new ln(d[0],d[1],d[2]);break;case 4:n[_.name]=new on(d[0],d[1],d[2],d[3]);break;default:throw new Error("BaseMaterial:unkonwn color length.")}}break;case"textures":var f=s[u];for(h=0,l=f.length;h<l;h++){var p=f[h],m=p.path;m&&(n[p.name]=Hn.getRes(m))}break;case"defines":var g=s[u];for(h=0,l=g.length;h<l;h++){var v=n._shader.getSubShaderAt(0).getMaterialDefineByName(g[h]);n._defineDatas.add(v)}break;case"renderStates":var T=s[u][0],y=n;y.blend=T.blend,y.cull=T.cull,y.depthTest=T.depthTest,y.depthWrite=T.depthWrite,y.blendSrc=T.srcBlend,y.blendDst=T.dstBlend;break;case"cull":n.cull=s[u];break;case"blend":n.blend=s[u];break;case"depthWrite":n.depthWrite=s[u];break;case"srcBlend":n.blendSrc=s[u];break;case"dstBlend":n.blendDst=s[u];break;default:n[u]=s[u]}break;default:throw new Error("BaseMaterial:unkonwn version.")}return n},e.RENDERQUEUE_OPAQUE=2e3,e.RENDERQUEUE_ALPHATEST=2450,e.RENDERQUEUE_TRANSPARENT=3e3,e.SHADERDEFINE_ALPHATEST=0,E(e,["ALPHATESTVALUE",function(){return this.ALPHATESTVALUE=We.propertyNameToID("u_AlphaTestValue")},"shaderDefines",function(){return this.shaderDefines=new ii}]),e}(Nn),os=function(i){function e(t){this._projectionViewWorldMatrix=new gt,e.__super.call(this,t)}I(e,"laya.d3.core.trail.TrailRenderer",i);var t=e.prototype;return t._calculateBoundingBox=function(){var t=this._bounds.getMin();t.x=-Number.MAX_VALUE,t.y=-Number.MAX_VALUE,t.z=-Number.MAX_VALUE,this._bounds.setMin(t);var e=this._bounds.getMax();if(e.x=Number.MAX_VALUE,e.y=Number.MAX_VALUE,e.z=Number.MAX_VALUE,this._bounds.setMax(e),qi.supportWebGLPlusCulling){t=this._bounds.getMin(),e=this._bounds.getMax();var i=ye._cullingBuffer;i[this._cullingBufferIndex+1]=t.x,i[this._cullingBufferIndex+2]=t.y,i[this._cullingBufferIndex+3]=t.z,i[this._cullingBufferIndex+4]=e.x,i[this._cullingBufferIndex+5]=e.y,i[this._cullingBufferIndex+6]=e.z}},t._needRender=function(t){return!0},t._renderUpdate=function(t,e){i.prototype._renderUpdate.call(this,t,e),this._owner.trailFilter._update(t)},t._renderUpdateWithCamera=function(t,e){var i=t.projectionViewMatrix;e?(gt.multiply(i,e.worldMatrix,this._projectionViewWorldMatrix),this._shaderValues.setMatrix4x4(es.MVPMATRIX,this._projectionViewWorldMatrix)):this._shaderValues.setMatrix4x4(es.MVPMATRIX,i)},e}(Bn),hs=function(t){function n(t,e){this._source=null,this._texW=0,this._texH=0,this.__destroyed=!1,this._discardTm=0,this.genID=0,this.bitmap={id:0,_glTexture:null},this.curUsedCovRate=0,this.curUsedCovRateAtlas=0,this.lastTouchTm=0,this.ri=null,n.__super.call(this),this._texW=t||mt.atlasWidth,this._texH=e||mt.atlasWidth,this.bitmap.id=this.id,this.lock=!0}I(n,"laya.webgl.text.TextTexture",Nn);var e=n.prototype;return e.recreateResource=function(){if(!this._source){var t=qi.isConchApp?Nt.instance.getDefaultCommandEncoder():en.mainContext,e=this._source=t.createTexture();this.bitmap._glTexture=e,j.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,this._texW,this._texH,0,6408,5121,null),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),mt.debugUV&&this.fillWhite()}},e.addChar=function(t,e,i,n){if(mt.isWan1Wan)return this.addCharCanvas(t,e,i,n);!this._source&&this.recreateResource();var r=qi.isConchApp?Nt.instance.getDefaultCommandEncoder():en.mainContext;j.bindTexture(r,3553,this._source),!qi.isConchApp&&r.pixelStorei(37441,!0);var s=t.data;t.data instanceof Uint8ClampedArray&&(s=new Uint8Array(s.buffer)),r.texSubImage2D(3553,0,e,i,t.width,t.height,6408,5121,s),!qi.isConchApp&&r.pixelStorei(37441,!1);var a=NaN,o=NaN,h=NaN,l=NaN;return l=qi.isConchApp?(a=e/this._texW,o=i/this._texH,h=(e+t.width)/this._texW,(i+t.height)/this._texH):(a=(e+1)/this._texW,o=i/this._texH,h=(e+t.width-1)/this._texW,(i+t.height-1)/this._texH),(n=n||new Array(8))[0]=a,n[1]=o,n[2]=h,n[3]=o,n[4]=h,n[5]=l,n[6]=a,n[7]=l,n},e.addCharCanvas=function(t,e,i,n){!this._source&&this.recreateResource();var r=qi.isConchApp?Nt.instance.getDefaultCommandEncoder():en.mainContext;j.bindTexture(r,3553,this._source),!qi.isConchApp&&r.pixelStorei(37441,!0),r.texSubImage2D(3553,0,e,i,6408,5121,t),!qi.isConchApp&&r.pixelStorei(37441,!1);var s=NaN,a=NaN,o=NaN,h=NaN;return h=qi.isConchApp?(s=e/this._texW,a=i/this._texH,o=(e+t.width)/this._texW,(i+t.height)/this._texH):(s=(e+1)/this._texW,a=(i+1)/this._texH,o=(e+t.width-1)/this._texW,(i+t.height-1)/this._texH),(n=n||new Array(8))[0]=s,n[1]=a,n[2]=o,n[3]=a,n[4]=o,n[5]=h,n[6]=s,n[7]=h,n},e.fillWhite=function(){!this._source&&this.recreateResource();var t=qi.isConchApp?Nt.instance.getDefaultCommandEncoder():en.mainContext,e=new Uint8Array(this._texW*this._texH*4);e.fill(255),t.texSubImage2D(3553,0,0,0,this._texW,this._texH,6408,5121,e)},e.discard=function(){this._texW==mt.atlasWidth&&this._texH==mt.atlasWidth?(this.genID++,n.poolLen>=n.pool.length&&(n.pool=n.pool.concat(new Array(10))),this._discardTm=T.stage.getFrameTm(),n.pool[n.poolLen++]=this):this.destroy()},e.destroy=function(){this.__destroyed=!0;var t=qi.isConchApp?Nt.instance.getDefaultCommandEncoder():en.mainContext;this._source&&t.deleteTexture(this._source),this._source=null},e.touchRect=function(t,e){this.lastTouchTm!=e&&(this.curUsedCovRate=0,this.curUsedCovRateAtlas=0,this.lastTouchTm=e);var i=mt.atlasWidth*mt.atlasWidth,n=Ie.atlasGridW*Ie.atlasGridW;this.curUsedCovRate+=t.bmpWidth*t.bmpHeight/i,this.curUsedCovRateAtlas+=Math.ceil(t.bmpWidth/Ie.atlasGridW)*Math.ceil(t.bmpHeight/Ie.atlasGridW)/(i/n)},e._getSource=function(){return this._source},e.drawOnScreen=function(t,e){},g(0,e,"texture",function(){return this}),n.getTextTexture=function(t,e){if(t!=mt.atlasWidth||t!=mt.atlasWidth)return new n(t,e);if(0<n.poolLen){var i=n.pool[--n.poolLen];return 0<n.poolLen&&n.clean(),i}return new n(t,e)},n.clean=function(){var t=T.stage.getFrameTm();if(0===n.cleanTm&&(n.cleanTm=t),t-n.cleanTm>=mt.checkCleanTextureDt){for(var e=0;e<n.poolLen;e++){var i=n.pool[e];t-i._discardTm>=mt.destroyUnusedTextureDt&&(i.destroy(),n.pool[e]=n.pool[n.poolLen-1],n.poolLen--,e--)}n.cleanTm=t}},n.poolLen=0,n.cleanTm=0,E(n,["pool",function(){return this.pool=new Array(10)}]),n}(),ls=function(e){function i(t,e){this._isTrigger=!1,i.__super.call(this,t,e)}I(i,"laya.d3.physics.PhysicsTriggerComponent",e);var t=i.prototype;return t._onAdded=function(){e.prototype._onAdded.call(this),this.isTrigger=this._isTrigger},t._cloneTo=function(t){e.prototype._cloneTo.call(this,t),t.isTrigger=this._isTrigger},g(0,t,"isTrigger",function(){return this._isTrigger},function(t){if(this._isTrigger=t,this._nativeColliderObject){var e=this._nativeColliderObject.getCollisionFlags();t?0==(4&e)&&this._nativeColliderObject.setCollisionFlags(4|e):0!=(4&e)&&this._nativeColliderObject.setCollisionFlags(4^e)}}),i}(Pn),us=function(t){function e(t){this._terrainSprite3DOwner=null,this._projectionViewWorldMatrix=null,e.__super.call(this,t),this._terrainSprite3DOwner=t,this._projectionViewWorldMatrix=new gt}I(e,"laya.d3.terrain.TerrainRender",t);var i=e.prototype;return i._needRender=function(t){return!t||0!==t.containsBoundBox(this._bounds._getBoundBox())},i._calculateBoundingBox=function(){},i._renderUpdate=function(t,e){this._shaderValues.setMatrix4x4(es.WORLDMATRIX,e.worldMatrix)},i._renderUpdateWithCamera=function(t,e){var i=t.projectionViewMatrix;gt.multiply(i,e.worldMatrix,this._projectionViewWorldMatrix),this._shaderValues.setMatrix4x4(es.MVPMATRIX,this._projectionViewWorldMatrix)},i._destroy=function(){t.prototype._destroy.call(this),this._terrainSprite3DOwner=null},e}(Bn),cs=function(t){function e(t){e.__super.call(this,t),this._projectionViewWorldMatrix=new gt}I(e,"laya.d3.core.MeshRenderer",t);var i=e.prototype;return i._onMeshChange=function(t){this._boundsChange=!0},i._calculateBoundingBox=function(){var t=this._owner.meshFilter.sharedMesh;if(t){var e=this._owner.transform.worldMatrix;t.bounds._tranform(e,this._bounds)}if(qi.supportWebGLPlusCulling){var i=this._bounds.getMin(),n=this._bounds.getMax(),r=ye._cullingBuffer;r[this._cullingBufferIndex+1]=i.x,r[this._cullingBufferIndex+2]=i.y,r[this._cullingBufferIndex+3]=i.z,r[this._cullingBufferIndex+4]=n.x,r[this._cullingBufferIndex+5]=n.y,r[this._cullingBufferIndex+6]=n.z}},i._changeRenderObjectsByMesh=function(t){var e=t.subMeshCount;this._renderElements.length=e;for(var i=0;i<e;i++){var n=this._renderElements[i];if(!n){var r=this.sharedMaterials[i];(n=this._renderElements[i]=new qr).setTransform(this._owner._transform),n.render=this,n.material=r||Ls.defaultMaterial}n.setGeometry(t._getSubMesh(i))}},i._needRender=function(t){return!t||0!==t.containsBoundBox(this.bounds._getBoundBox())},i._renderUpdate=function(t,e){var i=t.renderElement;switch(i.renderType){case 0:this._shaderValues.setMatrix4x4(es.WORLDMATRIX,e.worldMatrix);break;case 1:this._oriDefineValue=this._defineDatas.value,e?this._shaderValues.setMatrix4x4(es.WORLDMATRIX,e.worldMatrix):this._shaderValues.setMatrix4x4(es.WORLDMATRIX,gt.DEFAULT),this._defineDatas.add(pa.SHADERDEFINE_UV1),this._defineDatas.remove(Is.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV);break;case 3:this._shaderValues.setMatrix4x4(es.WORLDMATRIX,gt.DEFAULT);break;case 2:for(var n=zr.instance.instanceWorldMatrixData,r=i.instanceBatchElementList,s=r.length,a=0;a<s;a++)n.set(r[a]._transform.worldMatrix.elements,16*a);zr.instance.instanceWorldMatrixBuffer.setData(n,0,0,16*s),this._defineDatas.add(pa.SHADERDEFINE_GPU_INSTANCE)}},i._renderUpdateWithCamera=function(t,e){var i=t.projectionViewMatrix,n=t.renderElement;switch(n.renderType){case 0:case 1:case 3:e?(gt.multiply(i,e.worldMatrix,this._projectionViewWorldMatrix),this._shaderValues.setMatrix4x4(es.MVPMATRIX,this._projectionViewWorldMatrix)):this._shaderValues.setMatrix4x4(es.MVPMATRIX,i);break;case 2:for(var r=zr.instance.instanceMVPMatrixData,s=n.instanceBatchElementList,a=s.length,o=0;o<a;o++){var h=s[o]._transform.worldMatrix;V.mulMatrixByArray(i.elements,0,h.elements,0,r,16*o)}zr.instance.instanceMVPMatrixBuffer.setData(r,0,0,16*a)}},i._renderUpdateWithCameraForNative=function(t,e){var i=t.projectionViewMatrix,n=t.renderElement;switch(n.renderType){case 0:e?(gt.multiply(i,e.worldMatrix,this._projectionViewWorldMatrix),this._shaderValues.setMatrix4x4(es.MVPMATRIX,this._projectionViewWorldMatrix)):this._shaderValues.setMatrix4x4(es.MVPMATRIX,i);break;case 1:case 3:var r=xe._SET_RUNTIME_VALUE_MODE_REFERENCE_;xe.setRuntimeValueMode(!1),e?(gt.multiply(i,e.worldMatrix,this._projectionViewWorldMatrix),this._shaderValues.setMatrix4x4(es.MVPMATRIX,this._projectionViewWorldMatrix)):this._shaderValues.setMatrix4x4(es.MVPMATRIX,i),xe.setRuntimeValueMode(r);break;case 2:for(var s=zr.instance.instanceMVPMatrixData,a=n.instanceBatchElementList,o=a.length,h=0;h<o;h++){var l=a[h]._transform.worldMatrix;V.mulMatrixByArray(i.elements,0,l.elements,0,s,16*h)}zr.instance.instanceMVPMatrixBuffer.setData(s,0,0,16*o)}},i._revertBatchRenderUpdate=function(t){switch(t.renderElement.renderType){case 1:this._defineDatas.value=this._oriDefineValue;break;case 2:this._defineDatas.remove(pa.SHADERDEFINE_GPU_INSTANCE)}},i._destroy=function(){this._isPartOfStaticBatch&&cr.instance._destroyRenderSprite(this._owner),t.prototype._destroy.call(this)},E(e,["_tempVector30",function(){return this._tempVector30=new ln},"_tempVector31",function(){return this._tempVector31=new ln}]),e}(Bn),_s=function(t){function i(t,e){this._floatArray32=null,this._uint32Array=null,this._vertexStride=0,i.__super.call(this),this._vertexStride=t,this._bufferUsage=e,this._bufferType=34962,this._buffer=new ArrayBuffer(8),this._floatArray32=new Float32Array(this._buffer),this._uint32Array=new Uint32Array(this._buffer)}I(i,"laya.webgl.utils.VertexBuffer2D",Wn);var e=i.prototype;return e.getFloat32Array=function(){return this._floatArray32},e.appendArray=function(t){var e=this._byteLength>>2;this.setByteLength(this._byteLength+4*t.length),this.getFloat32Array().set(t,e),this._upload=!0},e._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer)),this._uint32Array&&(this._uint32Array=new Uint32Array(this._buffer))},e.deleteBuffer=function(){this._disposeResource()},e._bindForVAO=function(){Nt.instance.bindBuffer(34962,this._glBuffer)},e.bind=function(){return L._bindedVertexBuffer!==this._glBuffer&&(Nt.instance.bindBuffer(34962,this._glBuffer),L._bindedVertexBuffer=this._glBuffer,!0)},e.destroy=function(){laya.webgl.utils.Buffer.prototype.destroy.call(this),this._byteLength=0,this._upload=!0,this._buffer=null,this._floatArray32=null},g(0,e,"vertexStride",function(){return this._vertexStride}),i.create=function(t,e){return void 0===e&&(e=35048),new i(t,e)},i}(),ds=function(t){function s(t,e,i,n,r){this._stateParamsMap=[],this._uploadMark=-1,this._uploadRenderType=-1,s.__super.call(this),this._vs=t,this._ps=e,this._attributeMap=i,this._uniformMap=n,this._shaderPass=r,this._create(),this.lock=!0}I(s,"laya.d3.shader.ShaderInstance",Nn);var e=s.prototype;return e._create=function(){var t=Nt.instance;for(var e in this._program=t.createProgram(),this._vshader=this._createShader(t,this._vs,35633),this._pshader=this._createShader(t,this._ps,35632),t.attachShader(this._program,this._vshader),t.attachShader(this._program,this._pshader),this._attributeMap)t.bindAttribLocation(this._program,this._attributeMap[e],e);if(t.linkProgram(this._program),!qi.isConchApp&&We.debugMode&&!t.getProgramParameter(this._program,35714))throw t.getProgramInfoLog(this._program);var i=[],n=[],r=[],s=[],a=[];this._customUniformParamsMap=[];var o=t.getProgramParameter(this._program,35718);j.useProgram(t,this._program);var h,l=this._curActTexIndex=0,u=0;for(l=0;l<o;l++){var c=t.getActiveUniform(this._program,l),_=c.name;(h=new Gt).location=t.getUniformLocation(this._program,_),0<_.indexOf("[0]")?(h.name=_=_.substr(0,_.length-3),h.isArray=!0):(h.name=_,h.isArray=!1),h.type=c.type,this._addShaderUnifiormFun(h);var d=this._uniformMap[_];if(null!=d)switch(h.dataOffset=We.propertyNameToID(_),d){case 0:a.push(h);break;case 1:s.push(h);break;case 2:r.push(h);break;case 3:n.push(h);break;case 4:i.push(h);break;default:throw new Error("Shader3D: period is unkonw.")}}for(this._sceneUniformParamsMap=Nt.instance.createCommandEncoder(4*i.length*5+4,64,!0),l=0,u=i.length;l<u;l++)this._sceneUniformParamsMap.addShaderUniform(i[l]);for(this._cameraUniformParamsMap=Nt.instance.createCommandEncoder(4*n.length*5+4,64,!0),l=0,u=n.length;l<u;l++)this._cameraUniformParamsMap.addShaderUniform(n[l]);for(this._spriteUniformParamsMap=Nt.instance.createCommandEncoder(4*r.length*5+4,64,!0),l=0,u=r.length;l<u;l++)this._spriteUniformParamsMap.addShaderUniform(r[l]);for(this._materialUniformParamsMap=Nt.instance.createCommandEncoder(4*s.length*5+4,64,!0),l=0,u=s.length;l<u;l++)this._materialUniformParamsMap.addShaderUniform(s[l]);for(this._customUniformParamsMap.length=a.length,l=0,u=a.length;l<u;l++){var f=a[l];this._customUniformParamsMap[f.dataOffset]=f}var p=this._shaderPass._stateMap;for(var m in p)this._stateParamsMap[p[m]]=We.propertyNameToID(m)},e._getRenderState=function(t,e){var i=this._stateParamsMap[e];return null==i?null:t[i]},e._disposeResource=function(){Nt.instance.deleteShader(this._vshader),Nt.instance.deleteShader(this._pshader),Nt.instance.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._setGPUMemory(0),this._curActTexIndex=0},e._addShaderUnifiormFun=function(t){var e=Nt.instance;t.caller=this;var i=t.isArray;switch(t.type){case 35670:t.fun=this._uniform1i,t.uploadedValue=new Array(1);break;case 5124:t.fun=i?this._uniform1iv:this._uniform1i,t.uploadedValue=new Array(1);break;case 5126:t.fun=i?this._uniform1fv:this._uniform1f,t.uploadedValue=new Array(1);break;case 35664:t.fun=i?this._uniform_vec2v:this._uniform_vec2,t.uploadedValue=new Array(2);break;case 35665:t.fun=i?this._uniform_vec3v:this._uniform_vec3,t.uploadedValue=new Array(3);break;case 35666:t.fun=i?this._uniform_vec4v:this._uniform_vec4,t.uploadedValue=new Array(4);break;case 35674:t.fun=this._uniformMatrix2fv;break;case 35675:t.fun=this._uniformMatrix3fv;break;case 35676:t.fun=i?this._uniformMatrix4fv:this._uniformMatrix4f;break;case 35678:e.uniform1i(t.location,this._curActTexIndex),t.textureID=j._glTextureIDs[this._curActTexIndex++],t.fun=this._uniform_sampler2D;break;case 35679:e.uniform1i(t.location,this._curActTexIndex),t.textureID=j._glTextureIDs[this._curActTexIndex++],t.fun=this._uniform_sampler3D;break;case 35680:e.uniform1i(t.location,this._curActTexIndex),t.textureID=j._glTextureIDs[this._curActTexIndex++],t.fun=this._uniform_samplerCube;break;default:throw new Error("compile shader err!")}},e._createShader=function(t,e,i){var n=t.createShader(i);if(t.shaderSource(n,e),t.compileShader(n),We.debugMode&&!t.getShaderParameter(n,35713))throw t.getShaderInfoLog(n);return n},e._uniform1f=function(t,e){var i=t.uploadedValue;return i[0]!==e?(Nt.instance.uniform1f(t.location,i[0]=e),1):0},e._uniform1fv=function(t,e){if(e.length<4){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(Nt.instance.uniform1fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return Nt.instance.uniform1fv(t.location,e),1},e._uniform_vec2=function(t,e){var i=t.uploadedValue;return i[0]!==e.x||i[1]!==e.y?(Nt.instance.uniform2f(t.location,i[0]=e.x,i[1]=e.y),1):0},e._uniform_vec2v=function(t,e){if(e.length<2){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(Nt.instance.uniform2fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return Nt.instance.uniform2fv(t.location,e),1},e._uniform_vec3=function(t,e){var i=t.uploadedValue;return i[0]!==e.x||i[1]!==e.y||i[2]!==e.z?(Nt.instance.uniform3f(t.location,i[0]=e.x,i[1]=e.y,i[2]=e.z),1):0},e._uniform_vec3v=function(t,e){return Nt.instance.uniform3fv(t.location,e),1},e._uniform_vec4=function(t,e){var i=t.uploadedValue;return i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w?(Nt.instance.uniform4f(t.location,i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w),1):0},e._uniform_vec4v=function(t,e){return Nt.instance.uniform4fv(t.location,e),1},e._uniformMatrix2fv=function(t,e){return Nt.instance.uniformMatrix2fv(t.location,!1,e),1},e._uniformMatrix3fv=function(t,e){return Nt.instance.uniformMatrix3fv(t.location,!1,e),1},e._uniformMatrix4f=function(t,e){var i=e.elements;return Nt.instance.uniformMatrix4fv(t.location,!1,i),1},e._uniformMatrix4fv=function(t,e){return Nt.instance.uniformMatrix4fv(t.location,!1,e),1},e._uniform1i=function(t,e){var i=t.uploadedValue;return i[0]!==e?(Nt.instance.uniform1i(t.location,i[0]=e),1):0},e._uniform1iv=function(t,e){return Nt.instance.uniform1iv(t.location,e),1},e._uniform_ivec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(Nt.instance.uniform2i(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_ivec2v=function(t,e){return Nt.instance.uniform2iv(t.location,e),1},e._uniform_vec3i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(Nt.instance.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3vi=function(t,e){return Nt.instance.uniform3iv(t.location,e),1},e._uniform_vec4i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(Nt.instance.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4vi=function(t,e){return Nt.instance.uniform4iv(t.location,e),1},e._uniform_sampler2D=function(t,e){var i=e._getSource()||e.defaulteTexture._getSource(),n=Nt.instance;return j.activeTexture(n,t.textureID),j.bindTexture(n,3553,i),0},e._uniform_sampler3D=function(t,e){var i=e._getSource()||e.defaulteTexture._getSource(),n=Nt.instance;return j.activeTexture(n,t.textureID),j.bindTexture(n,32879,i),0},e._uniform_samplerCube=function(t,e){var i=e._getSource()||e.defaulteTexture._getSource(),n=Nt.instance;return j.activeTexture(n,t.textureID),j.bindTexture(n,34067,i),0},e.bind=function(){return j.useProgram(Nt.instance,this._program)},e.uploadUniforms=function(t,e,i){$i.shaderCall+=z.uploadShaderUniforms(Nt.instance,t,e,i)},e.uploadRenderStateBlendDepth=function(t){var e=Nt.instance,i=this._shaderPass.renderState,n=t.getData(),r=this._getRenderState(n,13),s=this._getRenderState(n,12),a=this._getRenderState(n,1);switch(null==r&&(r=i.depthWrite),null==s&&(s=i.depthTest),null==a&&(a=i.blend),j.setDepthMask(e,r),0===s?j.setDepthTest(e,!1):(j.setDepthTest(e,!0),j.setDepthFunc(e,s)),a){case 0:j.setBlend(e,!1);break;case 1:j.setBlend(e,!0);var o=this._getRenderState(n,2);null==o&&(o=i.srcBlend);var h=this._getRenderState(n,3);null==h&&(h=i.dstBlend),j.setBlendFunc(e,o,h);break;case 2:j.setBlend(e,!0);var l=this._getRenderState(n,4);null==l&&(l=i.srcBlendRGB);var u=this._getRenderState(n,5);null==u&&(u=i.dstBlendRGB);var c=this._getRenderState(n,6);null==c&&(c=i.srcBlendAlpha);var _=this._getRenderState(n,7);null==_&&(_=i.dstBlendAlpha),j.setBlendFuncSeperate(e,l,u,c,_)}},e.uploadRenderStateFrontFace=function(t,e,i){var n=Nt.instance,r=this._shaderPass.renderState,s=t.getData(),a=this._getRenderState(s,0);null==a&&(a=r.cull);var o=0;switch(a){case 0:j.setCullFace(n,!1);break;case 1:j.setCullFace(n,!0),o=e?i&&i._isFrontFaceInvert?2305:2304:i&&i._isFrontFaceInvert?2304:2305,j.setFrontFace(n,o);break;case 2:j.setCullFace(n,!0),o=e?i&&i._isFrontFaceInvert?2304:2305:i&&i._isFrontFaceInvert?2305:2304,j.setFrontFace(n,o)}},e.uploadCustomUniform=function(t,e){$i.shaderCall+=z.uploadCustomUniform(Nt.instance,this._customUniformParamsMap,t,e)},e._uniformMatrix2fvForNative=function(t,e){return Nt.instance.uniformMatrix2fvEx(t.location,!1,e),1},e._uniformMatrix3fvForNative=function(t,e){return Nt.instance.uniformMatrix3fvEx(t.location,!1,e),1},e._uniformMatrix4fvForNative=function(t,e){return Nt.instance.uniformMatrix4fvEx(t.location,!1,e),1},s}(),fs=function(t){function s(){this._rootNode=null,this._nativeNodeCount=0,this._nativeCurCloneCount=0,s.__super.call(this)}I(s,"laya.d3.core.Avatar",Nn);var e=s.prototype;return T.imps(e,{"laya.d3.core.IClone":!0}),e._initCloneToAnimator=function(t,e){for(var i=0,n=(e._avatarNodeMap[t.name]=t).getChildCount();i<n;i++)this._initCloneToAnimator(t.getChildByIndex(i),e)},e._parseNode=function(t,e){var i=t.props.name;e.name=i;var n=t.props,r=e.transform,s=r.localPosition,a=r.localRotation,o=r.localScale;s.fromArray(n.translate),a.fromArray(n.rotation),o.fromArray(n.scale),r.localPosition=s,r.localRotation=a,r.localScale=o;for(var h=t.child,l=0,u=h.length;l<u;l++){var c=h[l],_=new Ut(new Float32Array(3),new Float32Array(4),new Float32Array(3),new Float32Array(16));e.addChild(_),qi.supportWebGLPlusAnimation&&this._nativeNodeCount++,this._parseNode(c,_)}},e._cloneDatasToAnimator=function(t){var e;e=this._rootNode.clone();var i=this._rootNode.transform,n=e.transform,r=n.localPosition,s=n.localRotation,a=n.localScale;i.localPosition.cloneTo(r),i.localRotation.cloneTo(s),i.localScale.cloneTo(a),n.localPosition=r,n.localRotation=s,n.localScale=a,t._avatarNodeMap={},this._initCloneToAnimator(e,t)},e.cloneTo=function(t){var e=t,i=this._rootNode.clone();e._rootNode=i},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},e._cloneDatasToAnimatorNative=function(t){var e=new Float32Array(3*this._nativeNodeCount),i=new Float32Array(4*this._nativeNodeCount),n=new Float32Array(3*this._nativeNodeCount),r=new Float32Array(16*this._nativeNodeCount),s=new Int16Array(this._nativeNodeCount);t._animationNodeLocalPositions=e,t._animationNodeLocalRotations=i,t._animationNodeLocalScales=n,t._animationNodeWorldMatrixs=r,t._animationNodeParentIndices=s,this._nativeCurCloneCount=0;var a=this._rootNode._cloneNative(e,i,n,r,s,-1,this),o=this._rootNode.transform,h=a.transform,l=h.localPosition,u=h.localRotation,c=h.localScale;o.localPosition.cloneTo(l),o.localRotation.cloneTo(u),o.localScale.cloneTo(c),h.localPosition=l,h.localRotation=u,h.localScale=c,t._avatarNodeMap={},this._initCloneToAnimator(a,t)},s._parse=function(t,e,i){var n=new s;if(n._rootNode=new Ut(new Float32Array(3),new Float32Array(4),new Float32Array(3),new Float32Array(16)),qi.supportWebGLPlusAnimation&&n._nativeNodeCount++,t.version){var r=t.rootNode;r&&n._parseNode(r,n._rootNode)}return n},s.load=function(t,e){T.loader.create(t,e,null,"AVATAR")},s}(),ps=function(t){function e(t){this._finalGravity=new ln,this._tempRotationMatrix=new gt,e.__super.call(this,t),this._defaultBoundBox=new Qe(new ln,new ln),this._renderMode=-1,this.stretchedBillboardCameraSpeedScale=0,this.stretchedBillboardSpeedScale=0,this.stretchedBillboardLengthScale=1}I(e,"laya.d3.core.particleShuriKen.ShurikenParticleRenderer",t);var i=e.prototype;return i._calculateBoundingBox=function(){var t=this._bounds.getMin();t.x=-Number.MAX_VALUE,t.y=-Number.MAX_VALUE,t.z=-Number.MAX_VALUE,this._bounds.setMin(t);var e=this._bounds.getMax();if(e.x=Number.MAX_VALUE,e.y=Number.MAX_VALUE,e.z=Number.MAX_VALUE,this._bounds.setMax(e),qi.supportWebGLPlusCulling){t=this._bounds.getMin(),e=this._bounds.getMax();var i=ye._cullingBuffer;i[this._cullingBufferIndex+1]=t.x,i[this._cullingBufferIndex+2]=t.y,i[this._cullingBufferIndex+3]=t.z,i[this._cullingBufferIndex+4]=e.x,i[this._cullingBufferIndex+5]=e.y,i[this._cullingBufferIndex+6]=e.z}},i._needRender=function(t){return!t||0!==t.containsBoundBox(this.bounds._getBoundBox())&&!!this._owner.particleSystem.isAlive},i._renderUpdate=function(t,e){var i=this._owner.particleSystem,n=this._shaderValues,r=this._owner.transform;switch(i.simulationSpace){case 0:break;case 1:n.setVector3(Ca.WORLDPOSITION,r.position),n.setQuaternion(Ca.WORLDROTATION,r.rotation);break;default:throw new Error("ShurikenParticleMaterial: SimulationSpace value is invalid.")}switch(i.scaleMode){case 0:var s=r.scale;n.setVector3(Ca.POSITIONSCALE,s),n.setVector3(Ca.SIZESCALE,s);break;case 1:var a=r.localScale;n.setVector3(Ca.POSITIONSCALE,a),n.setVector3(Ca.SIZESCALE,a);break;case 2:n.setVector3(Ca.POSITIONSCALE,r.scale),n.setVector3(Ca.SIZESCALE,ln._ONE)}ln.scale($t.gravity,i.gravityModifier,this._finalGravity),n.setVector3(Ca.GRAVITY,this._finalGravity),n.setInt(Ca.SIMULATIONSPACE,i.simulationSpace),n.setBool(Ca.THREEDSTARTROTATION,i.threeDStartRotation),n.setInt(Ca.SCALINGMODE,i.scaleMode),n.setNumber(Ca.STRETCHEDBILLBOARDLENGTHSCALE,this.stretchedBillboardLengthScale),n.setNumber(Ca.STRETCHEDBILLBOARDSPEEDSCALE,this.stretchedBillboardSpeedScale),n.setNumber(Ca.CURRENTTIME,i._currentTime)},i._destroy=function(){t.prototype._destroy.call(this),this._mesh&&(this._mesh._removeReference(),this._mesh=null)},g(0,i,"mesh",function(){return this._mesh},function(t){this._mesh!==t&&(this._mesh&&this._mesh._removeReference(),(this._mesh=t)&&t._addReference(),this._owner.particleSystem._initBufferDatas())}),g(0,i,"bounds",function(){return this._boundsChange&&(this._calculateBoundingBox(),this._boundsChange=!1),this._bounds}),g(0,i,"renderMode",function(){return this._renderMode},function(t){if(this._renderMode!==t){var e=this._defineDatas;switch(this._renderMode){case 0:e.remove(Ca.SHADERDEFINE_RENDERMODE_BILLBOARD);break;case 1:e.remove(Ca.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD);break;case 2:e.remove(Ca.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD);break;case 3:e.remove(Ca.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD);break;case 4:e.remove(Ca.SHADERDEFINE_RENDERMODE_MESH)}switch(this._renderMode=t){case 0:e.add(Ca.SHADERDEFINE_RENDERMODE_BILLBOARD);break;case 1:e.add(Ca.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD);break;case 2:e.add(Ca.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD);break;case 3:e.add(Ca.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD);break;case 4:e.add(Ca.SHADERDEFINE_RENDERMODE_MESH);break;default:throw new Error("ShurikenParticleRender: unknown renderMode Value.")}this._owner.particleSystem._initBufferDatas()}}),e}(Bn),ms=function(t){function v(){this._nativeTriangleMesh=null,this._bounds=null,this._subMeshCount=0,this._subMeshes=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null,this._inverseBindPosesBuffer=null,this._bindPoseIndices=null,this._skinDataPathMarks=null,this._vertexCount=0,this._tempVector30=new ln,this._tempVector31=new ln,this._tempVector32=new ln,this._bufferState=new Mr,this._instanceBufferState=new Mr,v.__super.call(this),this._subMeshes=[],this._vertexBuffers=[],this._skinDataPathMarks=[]}I(v,"laya.d3.resource.models.Mesh",Nn);var e=v.prototype;return T.imps(e,{"laya.d3.core.IClone":!0}),e._getPositionElement=function(t){for(var e=t.vertexDeclaration.vertexElements,i=0,n=e.length;i<n;i++){var r=e[i];if("vector3"===r.elementFormat&&0===r.elementUsage)return r}return null},e._generateBoundingObject=function(){var t=this._tempVector30,e=this._tempVector31;t.x=t.y=t.z=Number.MAX_VALUE,e.x=e.y=e.z=-Number.MAX_VALUE;for(var i=this._vertexBuffers.length,n=0;n<i;n++)for(var r=this._vertexBuffers[n],s=this._getPositionElement(r),a=r.getData(),o=r.vertexDeclaration.vertexStride/4,h=s.offset/4,l=0,u=a.length;l<u;l+=o){var c=l+h,_=a[c],d=a[c+1],f=a[c+2];t.x=Math.min(t.x,_),t.y=Math.min(t.y,d),t.z=Math.min(t.z,f),e.x=Math.max(e.x,_),e.y=Math.max(e.y,d),e.z=Math.max(e.z,f)}this._bounds=new Mn(t,e)},e._setSubMeshes=function(t){this._subMeshes=t,this._subMeshCount=t.length;for(var e=0;e<this._subMeshCount;e++)t[e]._indexInMesh=e;this._generateBoundingObject()},e._getSubMesh=function(t){return this._subMeshes[t]},e._setBuffer=function(t,e){var i=this._bufferState;i.bind(),i.applyVertexBuffers(t),i.applyIndexBuffer(e),i.unBind();var n=this._instanceBufferState;n.bind(),n.applyVertexBuffers(t),n.applyInstanceVertexBuffer(zr.instance.instanceWorldMatrixBuffer),n.applyInstanceVertexBuffer(zr.instance.instanceMVPMatrixBuffer),n.applyIndexBuffer(e),n.unBind()},e._disposeResource=function(){for(var t=0,e=this._subMeshes.length;t<e;t++)this._subMeshes[t].destroy();for(this._nativeTriangleMesh&&In._physics3D.destroy(this._nativeTriangleMesh),t=0,e=this._vertexBuffers.length;t<e;t++)this._vertexBuffers[t].destroy();this._indexBuffer.destroy(),this._setCPUMemory(0),this._setGPUMemory(0),this._bufferState.destroy(),this._instanceBufferState.destroy(),this._bufferState=null,this._instanceBufferState=null,this._vertexBuffers=null,this._indexBuffer=null,this._subMeshes=null,this._nativeTriangleMesh=null,this._vertexBuffers=null,this._indexBuffer=null,this._boneNames=null,this._inverseBindPoses=null},e._getPhysicMesh=function(){if(!this._nativeTriangleMesh){for(var t=new In._physics3D.btTriangleMesh,e=v._nativeTempVector30,i=v._nativeTempVector31,n=v._nativeTempVector32,r=this._tempVector30,s=this._tempVector31,a=this._tempVector32,o=this._vertexBuffers[0],h=this._getPositionElement(o),l=o.getData(),u=o.vertexDeclaration.vertexStride/4,c=h.offset/4,_=this._indexBuffer.getData(),d=0,f=_.length;d<f;d+=3){var p=_[d]*u+c,m=_[d+1]*u+c,g=_[d+2]*u+c;r.setValue(l[p],l[p+1],l[p+2]),s.setValue(l[m],l[m+1],l[m+2]),a.setValue(l[g],l[g+1],l[g+2]),V._convertToBulletVec3(r,e,!0),V._convertToBulletVec3(s,i,!0),V._convertToBulletVec3(a,n,!0),t.addTriangle(e,i,n,!0)}this._nativeTriangleMesh=t}return this._nativeTriangleMesh},e.cloneTo=function(t){for(var e=t,i=0;i<this._vertexBuffers.length;i++){var n=this._vertexBuffers[i],r=new zn(n._byteLength,n.bufferUsage,n.canRead);r.vertexDeclaration=n.vertexDeclaration,r.setData(n.getData().slice()),e._vertexBuffers.push(r),e._vertexCount+=r.vertexCount}var s=this._indexBuffer,a=new dr("ushort",s.indexCount,s.bufferUsage,s.canRead);a.setData(s.getData().slice()),e._indexBuffer=a,e._setBuffer(e._vertexBuffers,a),e._setCPUMemory(this.cpuMemory),e._setGPUMemory(this.gpuMemory);var o=this._boneNames,h=e._boneNames=P(o.length);for(i=0;i<o.length;i++)h[i]=o[i];var l=this._inverseBindPoses,u=e._inverseBindPoses=P(l.length);for(i=0;i<l.length;i++)u[i]=l[i];for(e._bindPoseIndices=new Uint16Array(this._bindPoseIndices),i=0;i<this._skinDataPathMarks.length;i++)e._skinDataPathMarks[i]=this._skinDataPathMarks[i].slice();for(i=0;i<this.subMeshCount;i++){var c=this._subMeshes[i],_=c._subIndexBufferStart,d=c._subIndexBufferCount,f=c._boneIndicesList,p=new Cr(e);p._subIndexBufferStart.length=_.length,p._subIndexBufferCount.length=d.length,p._boneIndicesList.length=f.length;for(var m=0;m<_.length;m++)p._subIndexBufferStart[m]=_[m];for(m=0;m<d.length;m++)p._subIndexBufferCount[m]=d[m];for(m=0;m<f.length;m++)p._boneIndicesList[m]=new Uint16Array(f[m]);p._indexBuffer=a,p._indexStart=c._indexStart,p._indexCount=c._indexCount,p._indices=new Uint16Array(a.getData().buffer,2*c._indexStart,c._indexCount);var g=e._vertexBuffers[0];p._vertexBuffer=g,e._subMeshes.push(p)}e._setSubMeshes(e._subMeshes)},e.clone=function(){var t=new this.constructor;return this.cloneTo(t),t},g(0,e,"subMeshCount",function(){return this._subMeshCount}),g(0,e,"bounds",function(){return this._bounds}),g(0,e,"vertexCount",function(){return this._vertexCount}),g(0,e,"inverseAbsoluteBindPoses",function(){return this._inverseBindPoses}),v._parse=function(t,e,i){var n=new v;return K.read(t,n,n._subMeshes),n},v.load=function(t,e){T.loader.create(t,e,null,"MESH")},E(v,["_nativeTempVector30",function(){return this._nativeTempVector30=new In._physics3D.btVector3(0,0,0)},"_nativeTempVector31",function(){return this._nativeTempVector31=new In._physics3D.btVector3(0,0,0)},"_nativeTempVector32",function(){return this._nativeTempVector32=new In._physics3D.btVector3(0,0,0)}]),v}(),gs=(function(t){function r(){this._version=NaN,this._cameraCoordinateInverse=!1,this._gridSize=NaN,this._chunkNumX=0,this._chunkNumZ=0,this._heightDataX=0,this._heightDataZ=0,this._heightDataBitType=0,this._heightDataValue=NaN,this._heightDataUrl=null,this._detailTextureInfos=null,this._chunkInfos=null,this._heightData=null,this._materialInfo=null,this._alphaMaps=null,this._normalMaps=null,r.__super.call(this)}I(r,"laya.d3.terrain.TerrainRes",Nn);var e=r.prototype;e.parseData=function(t){var e=t[0],i=t[1];if(this._version=e.version,1==this._version){this._cameraCoordinateInverse=e.cameraCoordinateInverse,this._gridSize=e.gridSize,this._chunkNumX=e.chunkNumX,this._chunkNumZ=e.chunkNumZ;var n=e.heightData;if(this._heightDataX=n.numX,this._heightDataZ=n.numZ,this._heightDataBitType=n.bitType,this._heightDataValue=n.value,this._heightDataUrl=i[n.url],this._materialInfo=new hi,e.material){var r=e.material.ambient,s=e.material.diffuse,a=e.material.specular;this._materialInfo.ambientColor=new ln(r[0],r[1],r[2]),this._materialInfo.diffuseColor=new ln(s[0],s[1],s[2]),this._materialInfo.specularColor=new on(a[0],a[1],a[2],a[3])}var o=e.detailTexture;this._detailTextureInfos=P(o.length);for(var h=0;h<o.length;h++){var l=o[h],u=new Ai;u.diffuseTexture=i[l.diffuse],u.normalTexture=l.normal?i[l.normal]:null,l.scale?u.scale=new un(l.scale[0],l.scale[1]):u.scale=new un(1,1),l.offset?u.offset=new un(l.offset[0],l.offset[1]):u.offset=new un(0,0),this._detailTextureInfos[h]=u}var c=e.alphaMap;for(this._alphaMaps=P(c.length),h=0;h<this._alphaMaps.length;h++)this._alphaMaps[h]=e.alphaMap[h];var _=e.normalMap;for(this._normalMaps=P(_.length),h=0;h<this._normalMaps.length;h++)this._normalMaps[h]=e.normalMap[h];var d=e.chunkInfo;if(this._chunkNumX*this._chunkNumZ!=d.length)return alert("terrain data error"),!1;for(this._chunkInfos=P(d.length),h=0;h<d.length;h++){var f=d[h],p=new we,m=f.alphaMap.length,g=f.detailID.length;if(m!=g)return alert("terrain chunk data error"),!1;p.alphaMap=P(m),p.detailID=P(g),p.normalMap=i[this._normalMaps[f.normalMap]];for(var v=0;v<m;v++){p.alphaMap[v]=i[this._alphaMaps[f.alphaMap[v]]];var T=f.detailID[v],y=T.length;p.detailID[v]=new Uint8Array(y);for(var E=0;E<y;E++)p.detailID[v][E]=T[E]}this._chunkInfos[h]=p}this._heightData=Hn.getRes(this._heightDataUrl),this.onLoadTerrainComplete(this._heightData)}return!0},e.onLoadTerrainComplete=function(t){},r._parse=function(t,e,i){var n=new r;return n.parseData(t),n},r.load=function(t,e){T.loader.create(t,e,null,"TERRAIN",null,null,1,!1)}}(),function(t){function e(){this._vertexBuffer=null,e.__super.call(this),this._bufferState=new Mr,this._vertexBuffer=new zn(64,35044,!1),this._vertexBuffer.vertexDeclaration=laya.d3.core.render.ScreenQuad._vertexDeclaration,this._vertexBuffer.setData(e._vertices),this._bufferState.bind(),this._bufferState.applyVertexBuffer(this._vertexBuffer),this._bufferState.unBind(),this._setGPUMemory(this._vertexBuffer._byteLength)}I(e,"laya.d3.core.render.ScreenQuad",t);var i=e.prototype;return i.render=function(){this._bufferState.bind(),Nt.instance.drawArrays(5,0,4),$i.renderBatches++},i.destroy=function(){t.prototype.destroy.call(this),this._bufferState.destroy(),this._vertexBuffer.destroy(),this._setGPUMemory(0)},e.__init__=function(){(e.instance=new e).lock=!0},e.SCREENQUAD_POSITION_UV=0,e.instance=null,E(e,["_vertexDeclaration",function(){return this._vertexDeclaration=new D(16,[new lt(0,"vector4",0)])},"_vertices",function(){return this._vertices=new Float32Array([1,1,1,0,1,-1,1,1,-1,1,0,0,-1,-1,0,1])}]),e}(Nn)),vs=function(t){function h(t,e,i,n){this._terrainHeightData=null,this._width=0,this._height=0,this._bitType=0,this._value=NaN,h.__super.call(this),this._width=t,this._height=e,this._bitType=i,this._value=n}return I(h,"laya.d3.terrain.TerrainHeightData",Nn),h._pharse=function(t,e,i){var n,r=new h(i[0],i[1],i[2],i[3]),s=NaN;8==r._bitType?(n=new Uint8Array(t),s=1/255):16==r._bitType&&(n=new Int16Array(t),s=1/32766),r._terrainHeightData=new Float32Array(r._height*r._width);for(var a=0,o=r._height*r._width;a<o;a++)r._terrainHeightData[a]=n[a]*s*r._value/2},h.load=function(t,e,i,n,r,s){T.loader.create(t,e,null,"TERRAINHEIGHTDATA",[i,n,r,s],null,1,!1)},h}(),Ts=function(t){function e(t){this._uint16Array=null,void 0===t&&(t=35044),e.__super.call(this),this._bufferUsage=t,this._bufferType=34963,this._buffer=new ArrayBuffer(8)}I(e,"laya.webgl.utils.IndexBuffer2D",Wn);var i=e.prototype;return i._checkArrayUse=function(){this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},i.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},i._bindForVAO=function(){Nt.instance.bindBuffer(34963,this._glBuffer)},i.bind=function(){return L._bindedIndexBuffer!==this._glBuffer&&(Nt.instance.bindBuffer(34963,this._glBuffer),L._bindedIndexBuffer=this._glBuffer,!0)},i.destory=function(){this._uint16Array=null,this._buffer=null},i.disposeResource=function(){this._disposeResource()},e.create=function(t){return void 0===t&&(t=35044),new e(t)},e}(),ys=function(t){function e(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=tr.ctx,e.__super.call(this),this._onPlayEnd=nt.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}I(e,"laya.media.webaudio.WebAudioSoundChannel",t);var i=e.prototype;return i.play=function(){if(Li.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var t=this.context,e=this.gain,i=t.createBufferSource();(this.bufferSource=i).buffer=this.audioBuffer,i.connect(e),e&&e.disconnect(),e.connect(t.destination),i.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=Vt.now(),this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.001):this.gain.gain.value=this._volume,0==this.loops&&(i.loop=!0),i.playbackRate.setTargetAtTime?i.playbackRate.setTargetAtTime(Li.playbackRate,this.context.currentTime,.001):i.playbackRate.value=Li.playbackRate,i.start(0,this.startTime),this._currentTime=0}},i.__onPlayEnd=function(){if(1==this.loops)return this.completeHandler&&(T.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},i._clearBufferSource=function(){if(this.bufferSource){var t=this.bufferSource;t.stop?t.stop(0):t.noteOff(0),t.disconnect(0),t.onended=null,e._tryCleanFailed||this._tryClearBuffer(t),this.bufferSource=null}},i._tryClearBuffer=function(t){if(Vt.onMac)try{t.buffer=tr._miniBuffer}catch(t){e._tryCleanFailed=!0}else try{t.buffer=null}catch(t){e._tryCleanFailed=!0}},i.stop=function(){t.prototype.stop.call(this),this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,Li.removeChannel(this),this.completeHandler=null,Li.autoReleaseSound&&Li.disposeSoundLater(this.url)},i.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,Li.removeChannel(this),Li.autoReleaseSound&&Li.disposeSoundLater(this.url)},i.resume=function(){this.startTime=this._pauseTime,this.play()},g(0,i,"volume",function(){return this._volume},function(t){this._volume=t,this.isStopped||(this.gain.gain.setTargetAtTime?this.gain.gain.setTargetAtTime(t,this.context.currentTime,.001):this.gain.gain.value=t)}),g(0,i,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),g(0,i,"position",function(){return this.bufferSource?(Vt.now()-this._startTime)/1e3+this.startTime:0}),e._tryCleanFailed=!1,e.SetTargetDelay=.001,e}(_r),Es=function(t){function e(t){this._audio=null,this._onEnd=null,this._resumePlay=null,e.__super.call(this),this._onEnd=nt.bind(this.__onEnd,this),this._resumePlay=nt.bind(this.__resumePlay,this),t.addEventListener("ended",this._onEnd),this._audio=t}I(e,"laya.media.h5audio.AudioSoundChannel",t);var i=e.prototype;return i.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(T.systemTimer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");0<this.loops&&this.loops--,this.startTime=0,this.play()},i.__resumePlay=function(){if(this._audio&&this._audio.removeEventListener("canplay",this._resumePlay),!this.isStopped)try{this._audio.currentTime=this.startTime,Vt.container.appendChild(this._audio),this._audio.play()}catch(t){this.event("error")}},i.play=function(){this.isStopped=!1;try{this._audio.playbackRate=Li.playbackRate,this._audio.currentTime=this.startTime}catch(t){return void this._audio.addEventListener("canplay",this._resumePlay)}Li.addChannel(this),Vt.container.appendChild(this._audio),"play"in this._audio&&this._audio.play()},i.stop=function(){t.prototype.stop.call(this),this.isStopped=!0,Li.removeChannel(this),this.completeHandler=null,this._audio&&("pause"in this._audio&&qi.isConchApp&&this._audio.stop(),this._audio.pause(),this._audio.removeEventListener("ended",this._onEnd),this._audio.removeEventListener("canplay",this._resumePlay),Vt.onIE||this._audio!=Un._musicAudio&&p.recover("audio:"+this.url,this._audio),Vt.removeElement(this._audio),this._audio=null)},i.pause=function(){this.isStopped=!0,Li.removeChannel(this),"pause"in this._audio&&this._audio.pause()},i.resume=function(){this._audio&&(this.isStopped=!1,Li.addChannel(this),"play"in this._audio&&this._audio.play())},g(0,i,"volume",function(){return this._audio?this._audio.volume:1},function(t){this._audio&&(this._audio.volume=t)}),g(0,i,"duration",function(){return this._audio?this._audio.duration:0}),g(0,i,"position",function(){return this._audio?this._audio.currentTime:0}),e}(_r),xs=function(n){function h(){this.autoDestroyAtClosed=!1,this.url=null,this._timer=null,this._viewCreated=!1,this._idMap=null,this._$componentType="Scene",h.__super.call(this),this._setBit(8,!0),h.unDestroyedScenes.push(this),(this._scene=this).createChildren()}I(h,"laya.display.Scene",n);var t=h.prototype;return t.createChildren=function(){},t.loadScene=function(t){var e=-1<t.indexOf(".")?t:t+".scene",i=T.loader.getRes(e);if(i)this.createView(i);else{T.loader.resetProgress();var n=new Dr;n.on("complete",this,this._onSceneLoaded,[e]),n.load(e)}},t._onSceneLoaded=function(t){this.createView(Hn.getRes(t))},t.createView=function(t){t&&!this._viewCreated&&(this._viewCreated=!0,Qi.createByData(this,t))},t.getNodeByID=function(t){return this._idMap?this._idMap[t]:null},t.open=function(t,e){void 0===t&&(t=!0),t&&h.closeAll(),h.root.addChild(this),this.onOpened(e)},t.onOpened=function(t){},t.close=function(t){this.onClosed(t),this.autoDestroyAtClosed?this.destroy():this.removeSelf()},t.onClosed=function(t){},t.destroy=function(t){void 0===t&&(t=!0),this._idMap=null,n.prototype.destroy.call(this,t);for(var e=laya.display.Scene.unDestroyedScenes,i=e.length-1;-1<i;i--)if(e[i]===this)return void e.splice(i,1)},t._sizeChanged=function(){this.event("resize")},g(0,t,"height",function(){if(this._height)return this._height;for(var t=0,e=this.numChildren-1;-1<e;e--){var i=this.getChildAt(e);i._visible&&(t=Math.max(i._y+i.height*i.scaleY,t))}return t},function(t){T.superGet(ts,this,"height")!=t&&(T.superSet(ts,this,"height",t),this.callLater(this._sizeChanged))}),g(0,t,"width",function(){if(this._width)return this._width;for(var t=0,e=this.numChildren-1;-1<e;e--){var i=this.getChildAt(e);i._visible&&(t=Math.max(i._x+i.width*i.scaleX,t))}return t},function(t){T.superGet(ts,this,"width")!=t&&(T.superSet(ts,this,"width",t),this.callLater(this._sizeChanged))}),g(0,t,"scaleY",n.prototype._$get_scaleY,function(t){T.superGet(ts,this,"scaleY")!=t&&(T.superSet(ts,this,"scaleY",t),this.event("resize"))}),g(0,t,"timer",function(){return this._timer||T.timer},function(t){this._timer=t}),g(0,t,"scaleX",n.prototype._$get_scaleX,function(t){T.superGet(ts,this,"scaleX")!=t&&(T.superSet(ts,this,"scaleX",t),this.event("resize"))}),g(1,h,"root",function(){if(!h._root){function t(){h._root.size(T.stage.width,T.stage.height),h._root.event("resize")}(h._root=T.stage.addChild(new ts)).name="root",T.stage.on("resize",null,t),t()}return h._root},laya.display.Sprite._$SET_root),h.load=function(r,s,e){T.loader.resetProgress();var a=new Dr;function o(t){h._loadPage&&h._loadPage.event("progress",t),e&&e.runWith(t)}a.on("progress",null,o),a.once("complete",null,function(){a.off("progress",null,o);var t=Hn.getRes(r);if(!t)throw"Can not find scene:"+r;if(!t.props)throw"Scene data is error:"+r;var e=t.props.runtime?t.props.runtime:t.type,i=Cn.getClass(e);if("instance"==t.props.renderType)var n=i.instance||(i.instance=new i);else n=new i;{if(!(n&&n instanceof laya.display.Node))throw"Can not find scene:"+e;n.url=r,n._getBit(8)?(n.on("onViewCreated",null,function(){s&&s.runWith(n)}),n.createView(t)):s&&s.runWith(n),h.hideLoadingPage()}}),a.load(r)},h.open=function(t,e,i,n,r){if(void 0===e&&(e=!0),i instanceof laya.utils.Handler){var s=n;n=i,i=s}h.showLoadingPage(),h.load(t,y.create(null,this._onSceneLoaded,[e,n,i]),r)},h._onSceneLoaded=function(t,e,i,n){n.open(t,i),e&&e.runWith(n)},h.close=function(t,e){void 0===e&&(e="");for(var i=!1,n=laya.display.Scene.unDestroyedScenes,r=0,s=n.length;r<s;r++){var a=n[r];a&&a.parent&&a.url===t&&a.name==e&&(a.close(),i=!0)}return i},h.closeAll=function(){for(var t=laya.display.Scene.root,e=0,i=t.numChildren;e<i;e++){var n=t.getChildAt(0);n instanceof laya.display.Scene?n.close():n.removeSelf()}},h.destroy=function(t,e){void 0===e&&(e="");for(var i=!1,n=laya.display.Scene.unDestroyedScenes,r=0,s=n.length;r<s;r++){var a=n[r];a.url===t&&a.name==e&&(a.destroy(),i=!0)}return i},h.gc=function(){Nn.destroyUnusedResources()},h.setLoadingPage=function(t){h._loadPage!=t&&(h._loadPage=t)},h.showLoadingPage=function(t,e){void 0===e&&(e=500),h._loadPage&&(T.systemTimer.clear(null,h._showLoading),T.systemTimer.clear(null,h._hideLoading),T.systemTimer.once(e,null,h._showLoading,[t],!1))},h._showLoading=function(t){T.stage.addChild(h._loadPage),h._loadPage.onOpened(t)},h._hideLoading=function(){h._loadPage.close()},h.hideLoadingPage=function(t){void 0===t&&(t=500),h._loadPage&&(T.systemTimer.clear(null,h._showLoading),T.systemTimer.clear(null,h._hideLoading),T.systemTimer.once(t,null,h._hideLoading))},h.unDestroyedScenes=[],h._root=null,h._loadPage=null,h}(ts),Ss=function(e){function t(){this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,t.__super.call(this),this._anchorX=NaN,this._anchorY=NaN,this._widget=Kn.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}I(t,"laya.ui.UIComponent",e);var i=t.prototype;return i.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._dataSource=null,this._tag=null,this._toolTip=null},i.preinitialize=function(){},i.createChildren=function(){},i.initialize=function(){},i.measureWidth=function(){var t=0;this.commitMeasure();for(var e=this.numChildren-1;-1<e;e--){var i=this.getChildAt(e);i._visible&&(t=Math.max(i._x+i.width*i.scaleX,t))}return t},i.commitMeasure=function(){},i.measureHeight=function(){var t=0;this.commitMeasure();for(var e=this.numChildren-1;-1<e;e--){var i=this.getChildAt(e);i._visible&&(t=Math.max(i._y+i.height*i.scaleY,t))}return t},i._sizeChanged=function(){isNaN(this._anchorX)||(this.pivotX=this.anchorX*this.width),isNaN(this._anchorY)||(this.pivotY=this.anchorY*this.height),this.event("resize"),this._widget!==Kn.EMPTY&&this._widget.resetLayout()},i.onMouseOver=function(t){T.stage.event("showtip",this._toolTip)},i.onMouseOut=function(t){T.stage.event("hidetip",this._toolTip)},i._getWidget=function(){return this._widget===Kn.EMPTY&&(this._widget=this.addComponent(Kn)),this._widget},i.onCompResize=function(){this._sizeChanged()},i._childChanged=function(t){this.callLater(this._sizeChanged),e.prototype._childChanged.call(this,t)},g(0,i,"anchorY",function(){return this._anchorY},function(t){this._anchorY!=t&&(this._anchorY=t,this.callLater(this._sizeChanged))}),g(0,i,"scaleX",e.prototype._$get_scaleX,function(t){T.superGet(ts,this,"scaleX")!=t&&(T.superSet(ts,this,"scaleX",t),this.event("resize"))}),g(0,i,"disabled",function(){return this._disabled},function(t){t!==this._disabled&&(this.gray=this._disabled=t,this.mouseEnabled=!t)}),g(0,i,"gray",function(){return this._gray},function(t){t!==this._gray&&(this._gray=t,be.gray(this,t))}),g(0,i,"tag",function(){return this._tag},function(t){this._tag=t}),g(0,i,"centerY",function(){return this._widget.centerY},function(t){t!=this._widget.centerY&&(this._getWidget().centerY=t)}),g(0,i,"centerX",function(){return this._widget.centerX},function(t){t!=this._widget.centerX&&(this._getWidget().centerX=t)}),g(0,i,"right",function(){return this._widget.right},function(t){t!=this._widget.right&&(this._getWidget().right=t)}),g(0,i,"top",function(){return this._widget.top},function(t){t!=this._widget.top&&(this._getWidget().top=t)}),g(0,i,"bottom",function(){return this._widget.bottom},function(t){t!=this._widget.bottom&&(this._getWidget().bottom=t)}),g(0,i,"left",function(){return this._widget.left},function(t){t!=this._widget.left&&(this._getWidget().left=t)}),g(0,i,"scaleY",e.prototype._$get_scaleY,function(t){T.superGet(ts,this,"scaleY")!=t&&(T.superSet(ts,this,"scaleY",t),this.event("resize"))}),g(0,i,"dataSource",function(){return this._dataSource},function(t){for(var e in this._dataSource=t,this._dataSource)this.hasOwnProperty(e)&&"function"!=typeof this[e]&&(this[e]=this._dataSource[e])}),g(0,i,"height",function(){return this._height?this._height:this.measureHeight()},function(t){T.superGet(ts,this,"height")!=t&&(T.superSet(ts,this,"height",t),this.callLater(this._sizeChanged))}),g(0,i,"anchorX",function(){return this._anchorX},function(t){this._anchorX!=t&&(this._anchorX=t,this.callLater(this._sizeChanged))}),g(0,i,"toolTip",function(){return this._toolTip},function(t){this._toolTip!=t&&(null!=(this._toolTip=t)?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),g(0,i,"width",function(){return this._width?this._width:this.measureWidth()},function(t){T.superGet(ts,this,"width")!=t&&(T.superSet(ts,this,"width",t),this.callLater(this._sizeChanged))}),t}(ts),Cs=function(t){function i(t,e){i.__super.call(this),this._wrapModeU=0,this._wrapModeV=0,this._filterMode=1,this._readyed=!1,this._width=-1,this._height=-1,this._format=t,this._mipmap=e,this._anisoLevel=1,this._glTexture=Nt.instance.createTexture()}I(i,"laya.resource.BaseTexture",ns);var e=i.prototype;return e._isPot=function(t){return 0==(t&t-1)},e._getGLFormat=function(){var t=0;switch(this._format){case 0:t=6407;break;case 1:t=6408;break;case 2:t=6406;break;case 3:if(!j._compressedTextureS3tc)throw"BaseTexture: not support DXT1 format.";t=j._compressedTextureS3tc.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case 4:if(!j._compressedTextureS3tc)throw"BaseTexture: not support DXT5 format.";t=j._compressedTextureS3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;case 5:if(!j._compressedTextureEtc1)throw"BaseTexture: not support ETC1RGB format.";t=j._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL;break;case 9:if(!j._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGB_2BPPV format.";t=j._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;break;case 10:if(!j._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGBA_2BPPV format.";t=j._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;break;case 11:if(!j._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGB_4BPPV format.";t=j._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;break;case 12:if(!j._compressedTexturePvrtc)throw"BaseTexture: not support PVRTCRGBA_4BPPV format.";t=j._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;break;default:throw"BaseTexture: unknown texture format."}return t},e._setFilterMode=function(t){var e=Nt.instance;switch(j.bindTexture(e,this._glTextureType,this._glTexture),t){case 0:this._mipmap?e.texParameteri(this._glTextureType,10241,9984):e.texParameteri(this._glTextureType,10241,9728),e.texParameteri(this._glTextureType,10240,9728);break;case 1:this._mipmap?e.texParameteri(this._glTextureType,10241,9985):e.texParameteri(this._glTextureType,10241,9729),e.texParameteri(this._glTextureType,10240,9729);break;case 2:this._mipmap?e.texParameteri(this._glTextureType,10241,9987):e.texParameteri(this._glTextureType,10241,9729),e.texParameteri(this._glTextureType,10240,9729);break;default:throw new Error("BaseTexture:unknown filterMode value.")}},e._setWarpMode=function(t,e){var i=Nt.instance;if(j.bindTexture(i,this._glTextureType,this._glTexture),this._isPot(this._width)&&this._isPot(this._height))switch(e){case 0:i.texParameteri(this._glTextureType,t,10497);break;case 1:i.texParameteri(this._glTextureType,t,33071)}else i.texParameteri(this._glTextureType,t,33071)},e._setAnisotropy=function(t){var e=j._extTextureFilterAnisotropic;if(e&&!Vt.onLimixiu){t=Math.max(t,1);var i=Nt.instance;j.bindTexture(i,this._glTextureType,this._glTexture),t=Math.min(i.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT),t),i.texParameterf(this._glTextureType,e.TEXTURE_MAX_ANISOTROPY_EXT,t)}},e._disposeResource=function(){this._glTexture&&(Nt.instance.deleteTexture(this._glTexture),this._glTexture=null,this._setGPUMemory(0))},e._getSource=function(){return this._readyed?this._glTexture:null},e.generateMipmap=function(){this._isPot(this.width)&&this._isPot(this.height)&&Nt.instance.generateMipmap(this._glTextureType)},g(0,e,"defaulteTexture",function(){throw"BaseTexture:must override it."}),g(0,e,"anisoLevel",function(){return this._anisoLevel},function(t){t!==this._anisoLevel&&(this._anisoLevel=Math.max(1,Math.min(16,t)),-1!==this._width&&-1!==this._height&&this._setAnisotropy(t))}),g(0,e,"mipmap",function(){return this._mipmap}),g(0,e,"filterMode",function(){return this._filterMode},function(t){t!==this._filterMode&&(this._filterMode=t,-1!==this._width&&-1!==this._height&&this._setFilterMode(t))}),g(0,e,"wrapModeU",function(){return this._wrapModeU},function(t){this._wrapModeU!==t&&(this._wrapModeU=t,-1!==this._width&&this._setWarpMode(10242,t))}),g(0,e,"wrapModeV",function(){return this._wrapModeV},function(t){this._wrapModeV!==t&&(this._wrapModeV=t,-1!==this._height&&this._setWarpMode(10243,t))}),g(0,e,"format",function(){return this._format}),i.WARPMODE_REPEAT=0,i.WARPMODE_CLAMP=1,i.FILTERMODE_POINT=0,i.FILTERMODE_BILINEAR=1,i.FILTERMODE_TRILINEAR=2,i.FORMAT_R8G8B8=0,i.FORMAT_R8G8B8A8=1,i.FORMAT_ALPHA8=2,i.FORMAT_DXT1=3,i.FORMAT_DXT5=4,i.FORMAT_ETC1RGB=5,i.FORMAT_PVRTCRGB_2BPPV=9,i.FORMAT_PVRTCRGBA_2BPPV=10,i.FORMAT_PVRTCRGB_4BPPV=11,i.FORMAT_PVRTCRGBA_4BPPV=12,i.FORMAT_DEPTH_16=0,i.FORMAT_STENCIL_8=1,i.FORMAT_DEPTHSTENCIL_16_8=2,i.FORMAT_DEPTHSTENCIL_NONE=3,i}(),Is=function(i){function e(t){this.pickColor=null,this._render=null,e.__super.call(this,t)}I(e,"laya.d3.core.RenderableSprite3D",i);var t=e.prototype;return t._onInActive=function(){laya.display.Node.prototype._onInActive.call(this);var t=this._scene;t._removeRenderObject(this._render),this._render.castShadow&&t._removeShadowCastRenderObject(this._render)},t._onActive=function(){laya.display.Node.prototype._onActive.call(this);var t=this._scene;t._addRenderObject(this._render),this._render.castShadow&&t._addShadowCastRenderObject(this._render)},t._onActiveInScene=function(){if(laya.display.Node.prototype._onActiveInScene.call(this),In._editerEnvironment){var t=this._scene,e=new on;t._allotPickColorByID(this.id,e),(t._pickIdToSprite[this.id]=this)._render._shaderValues.setVector(laya.d3.core.RenderableSprite3D.PICKCOLOR,e)}},t._addToInitStaticBatchManager=function(){},t._setBelongScene=function(t){laya.display.Node.prototype._setBelongScene.call(this,t),this._render._setBelongScene(t)},t._setUnBelongScene=function(){this._render._defineDatas.remove(laya.d3.core.RenderableSprite3D.SAHDERDEFINE_LIGHTMAP),laya.display.Node.prototype._setUnBelongScene.call(this)},t._changeHierarchyAnimator=function(t){if(this._hierarchyAnimator){var e=this._hierarchyAnimator._renderableSprites;e.splice(e.indexOf(this),1)}t&&t._renderableSprites.push(this),i.prototype._changeHierarchyAnimator.call(this,t)},t.destroy=function(t){void 0===t&&(t=!0),i.prototype.destroy.call(this,t),this._render._destroy(),this._render=null},e.__init__=function(){e.SHADERDEFINE_RECEIVE_SHADOW=e.shaderDefines.registerDefine("RECEIVESHADOW"),e.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=e.shaderDefines.registerDefine("SCALEOFFSETLIGHTINGMAPUV"),e.SAHDERDEFINE_LIGHTMAP=e.shaderDefines.registerDefine("LIGHTMAP")},e.SHADERDEFINE_RECEIVE_SHADOW=0,e.SHADERDEFINE_SCALEOFFSETLIGHTINGMAPUV=0,e.SAHDERDEFINE_LIGHTMAP=0,E(e,["LIGHTMAPSCALEOFFSET",function(){return this.LIGHTMAPSCALEOFFSET=We.propertyNameToID("u_LightmapScaleOffset")},"LIGHTMAP",function(){return this.LIGHTMAP=We.propertyNameToID("u_LightMap")},"PICKCOLOR",function(){return this.PICKCOLOR=We.propertyNameToID("u_PickColor")},"shaderDefines",function(){return this.shaderDefines=new ii}]),e}(es),Rs=function(e){function i(){this._reflectionMode=1,this._enableLightCount=3,this.enableLight=!0,this._time=0,i.__super.call(this),this._lights=[],this._lightmaps=[],this._skyRenderer=new bt,this._input=new Wt,this._timer=T.timer,this._collsionTestList=[],this._renders=new Rr,this._opaqueQueue=new ae(!1),this._transparentQueue=new ae(!0),this._cameraPool=[],this._animatorPool=new Rr,this._scriptPool=new Rr,this._castShadowRenders=new jn,this.currentCreationLayer=Math.pow(2,0),this._key=new Mt,this._pickIdToSprite=new Object,In._enbalePhysics&&(this._physicsSimulation=new Ae(In.physicsSettings)),this._defineDatas=new jt,this._shaderValues=new xe(null),this.parallelSplitShadowMaps=[],this.enableFog=!1,this.fogStart=300,this.fogRange=1e3,this.fogColor=new ln(.7,.7,.7),this.ambientColor=new ln(.212,.227,.259),this.reflectionIntensity=1,en.shaderHighPrecision&&this._defineDatas.add(We.SHADERDEFINE_HIGHPRECISION),qi.supportWebGLPlusCulling&&(this._cullingBufferIndices=new Int32Array(1024),this._cullingBufferResult=new Int32Array(1024)),this._shaderValues.setTexture(laya.d3.core.scene.Scene3D.RANGEATTENUATIONTEXTURE,Ti._rangeAttenTex),this._scene=this,In._enbalePhysics&&!Ae.disableSimulation&&this._input.__init__(qi.canvas,this);var t=In._config;if(t.octreeCulling&&(this._octree=new x(t.octreeInitialSize,t.octreeInitialCenter,t.octreeMinNodeSize,t.octreeLooseness)),In._config.debugFrustumCulling){this._debugTool=new Ea;var e=new Us;e.renderQueue=3e3,e.alphaTest=!1,e.depthWrite=!1,e.cull=2,e.blend=1,e.blendSrc=770,e.blendDst=771,e.depthTest=513,this._debugTool.pixelLineRenderer.sharedMaterial=e}}I(i,"laya.d3.core.scene.Scene3D",e);var t=i.prototype;return T.imps(t,{"laya.resource.ICreateResource":!0,"laya.webgl.submit.ISubmit":!0}),t._allotPickColorByID=function(t,e){var i=Math.floor(t/65025);t-=255*i*255;var n=Math.floor(t/255),r=t-=255*n;e.x=i/255,e.y=n/255,e.z=r/255,e.w=1},t._searchIDByPickColor=function(t){return 255*t.x*255+255*t.y+t.z},t._setLightmapToChildNode=function(t){t instanceof laya.d3.core.RenderableSprite3D&&t._render._applyLightMapParams();for(var e=t._children,i=0,n=e.length;i<n;i++)this._setLightmapToChildNode(e[i])},t._update=function(){var t=this.timer._delta/1e3;this._time+=t,this._shaderValues.setNumber(laya.d3.core.scene.Scene3D.TIME,this._time);var e=this._physicsSimulation;In._enbalePhysics&&!Ae.disableSimulation&&(e._updatePhysicsTransformFromRender(),Pn._addUpdateList=!1,e._simulate(t),e._updateCharacters(),Pn._addUpdateList=!0,e._updateCollisions(),e._eventScripts(),this._input._update()),this._updateScript(),nr._update(this),this._lateUpdateScript()},t._binarySearchIndexInCameraPool=function(t){for(var e=0,i=this._cameraPool.length-1,n=0;e<=i;){n=Math.floor((e+i)/2);var r=this._cameraPool[n]._renderingOrder;if(r==t._renderingOrder)return n;r>t._renderingOrder?i=n-1:e=n+1}return e},t._setCreateURL=function(t){this._url=gn.formatURL(t)},t._getGroup=function(){return this._group},t._setGroup=function(t){this._group=t},t._updateScript=function(){for(var t=this._scriptPool,e=t.elements,i=0,n=t.length;i<n;i++){var r=e[i];r&&r.enabled&&r.onUpdate()}},t._lateUpdateScript=function(){for(var t=this._scriptPool,e=t.elements,i=0,n=t.length;i<n;i++){var r=e[i];r&&r.enabled&&r.onLateUpdate()}},t._preRenderScript=function(){for(var t=this._scriptPool,e=t.elements,i=0,n=t.length;i<n;i++){var r=e[i];r&&r.enabled&&r.onPreRender()}},t._postRenderScript=function(){for(var t=this._scriptPool,e=t.elements,i=0,n=t.length;i<n;i++){var r=e[i];r&&r.enabled&&r.onPostRender()}},t._prepareSceneToRender=function(){var t=this._lights.length;if(0<t)for(var e=0,i=0;i<t&&!(this._lights[i]._prepareToScene()&&++e>=this._enableLightCount);i++);},t._addCamera=function(t){for(var e=this._binarySearchIndexInCameraPool(t),i=t._renderingOrder,n=this._cameraPool.length;e<n&&this._cameraPool[e]._renderingOrder<=i;)e++;this._cameraPool.splice(e,0,t)},t._removeCamera=function(t){this._cameraPool.splice(this._cameraPool.indexOf(t),1)},t._preCulling=function(t,e){ye.renderObjectCulling(e,this,t,this._renders)},t._clear=function(t,e){var i=e.viewport,n=e.camera,r=n.getRenderTexture(),s=i.width,a=i.height,o=i.x,h=n._getCanvasHeight()-i.y-a;t.viewport(o,h,s,a);var l=0,u=n.clearFlag;switch(1!==u||n.skyRenderer._isAvailable()||this._skyRenderer._isAvailable()||(u=0),u){case 0:var c=n.clearColor;if(t.enable(3089),t.scissor(o,h,s,a),c?t.clearColor(c.x,c.y,c.z,c.w):t.clearColor(0,0,0,0),r)switch(l=16384,r.depthStencilFormat){case 0:l|=256;break;case 1:l|=1024;break;case 2:l|=256,l|=1024}else l=16640;j.setDepthMask(t,!0),t.clear(l),t.disable(3089);break;case 1:case 2:if(t.enable(3089),t.scissor(o,h,s,a),r)switch(r.depthStencilFormat){case 0:l=256;break;case 1:l=1024;break;case 2:l=1280}else l=256;j.setDepthMask(t,!0),t.clear(l),t.disable(3089);break;case 3:break;default:throw new Error("BaseScene:camera clearFlag invalid.")}},t._renderScene=function(t,e,i,n){var r=e.camera;r.transform.position;if(r.getRenderTexture()?this._opaqueQueue._render(e,!0,i,n):this._opaqueQueue._render(e,!1,i,n),1===r.clearFlag&&(r.skyRenderer._isAvailable()?r.skyRenderer._render(e):this._skyRenderer._isAvailable()&&this._skyRenderer._render(e)),r.getRenderTexture()?this._transparentQueue._render(e,!0,i,n):this._transparentQueue._render(e,!1,i,n),r._applyPostProcessCommandBuffers(),In._config.debugFrustumCulling)for(var s=this._debugTool._render._renderElements,a=0,o=s.length;a<o;a++)s[a]._render(e,!1,i,n)},t._parse=function(t,e){var i=t.lightmaps;if(i){for(var n=i.length,r=P(n),s=0;s<n;s++)r[s]=Hn.getRes(i[s].path);this.setlightmaps(r)}var a=t.ambientColor;if(a){var o=this.ambientColor;o.fromArray(a),this.ambientColor=o}var h=t.sky;if(h)switch(this._skyRenderer.material=Hn.getRes(h.material.path),h.mesh){case"SkyBox":this._skyRenderer.mesh=Vn.instance;break;case"SkyDome":this._skyRenderer.mesh=Fn.instance;break;default:this.skyRenderer.mesh=Vn.instance}var l=t.reflectionTexture;l&&(this.customReflection=Hn.getRes(l)),this.enableFog=t.enableFog,this.fogStart=t.fogStart,this.fogRange=t.fogRange;var u=t.fogColor;if(u){var c=this.fogColor;c.fromArray(u),this.fogColor=c}},t._onActive=function(){laya.display.Node.prototype._onActive.call(this),T.stage._scene3Ds.push(this)},t._onInActive=function(){laya.display.Node.prototype._onInActive.call(this);var t=T.stage._scene3Ds;t.splice(t.indexOf(this),1)},t._addLight=function(t){this._lights.indexOf(t)<0&&this._lights.push(t)},t._removeLight=function(t){var e=this._lights.indexOf(t);0<=e&&this._lights.splice(e,1)},t._addRenderObject=function(t){if(this._octree)this._octree.add(t);else if(this._renders.add(t),qi.supportWebGLPlusCulling){var e=t._getIndexInList(),i=this._cullingBufferIndices.length;if(i<=e){var n=this._cullingBufferIndices,r=this._cullingBufferResult;this._cullingBufferIndices=new Int32Array(i+1024),this._cullingBufferResult=new Int32Array(i+1024),this._cullingBufferIndices.set(n,0),this._cullingBufferResult.set(r,0)}this._cullingBufferIndices[e]=t._cullingBufferIndex}},t._removeRenderObject=function(t){var e;this._octree?this._octree.remove(t):(qi.supportWebGLPlusCulling&&(e=this._renders.elements[this._renders.length-1]),this._renders.remove(t),qi.supportWebGLPlusCulling&&(this._cullingBufferIndices[e._getIndexInList()]=e._cullingBufferIndex))},t._addShadowCastRenderObject=function(t){this._octree||this._castShadowRenders.add(t)},t._removeShadowCastRenderObject=function(t){this._octree||this._castShadowRenders.remove(t)},t._getRenderQueue=function(t){return t<=2500?this._opaqueQueue:this._transparentQueue},t.setlightmaps=function(t){for(var e=this._lightmaps,i=0,n=e.length;i<n;i++)e[i]._removeReference();if(!t)throw new Error("Scene3D: value value can't be null.");var r=t.length;for(e.length=r,i=0;i<r;i++){var s=t[i];s._addReference(),e[i]=s}for(i=0,n=this._children.length;i<n;i++)this._setLightmapToChildNode(this._children[i])},t.getlightmaps=function(){return this._lightmaps.slice()},t.destroy=function(t){void 0===t&&(t=!0),this.destroyed||(e.prototype.destroy.call(this,t),this._skyRenderer.destroy(),this._skyRenderer=null,this._lights=null,this._lightmaps=null,this._renderTargetTexture=null,this._shaderValues=null,this._renders=null,this._castShadowRenders=null,this._cameraPool=null,this._octree=null,this.parallelSplitShadowMaps=null,this._physicsSimulation&&this._physicsSimulation._destroy(),Hn.clearRes(this.url))},t.render=function(t,e,i){t._curSubmit=yt.RENDERBASE,0<this._children.length&&t.addRenderObject(this)},t.renderSubmit=function(){Nt.instance;this._prepareSceneToRender();var t,e,i=0;for(i=0,e=(t=this._cameraPool.length)-1;i<t;i++){qi.supportWebGLPlusRendering&&xe.setRuntimeValueMode(i==e);var n=this._cameraPool[i];n.enableRender&&n.render()}return ji.set2DRenderConfig(),1},t.getRenderType=function(){return 0},t.releaseRender=function(){},t.reUse=function(t,e){return 0},g(0,t,"input",function(){return this._input}),g(0,t,"reflectionMode",function(){return this._reflectionMode},function(t){this._reflectionMode=t}),g(0,t,"enableFog",function(){return this._enableFog},function(t){this._enableFog!==t&&((this._enableFog=t)?this._defineDatas.add(laya.d3.core.scene.Scene3D.SHADERDEFINE_FOG):this._defineDatas.remove(laya.d3.core.scene.Scene3D.SHADERDEFINE_FOG))}),g(0,t,"physicsSimulation",function(){return this._physicsSimulation}),g(0,t,"fogColor",function(){return this._shaderValues.getVector(laya.d3.core.scene.Scene3D.FOGCOLOR)},function(t){this._shaderValues.setVector3(laya.d3.core.scene.Scene3D.FOGCOLOR,t)}),g(0,t,"reflectionIntensity",function(){return this._shaderValues.getNumber(laya.d3.core.scene.Scene3D.REFLETIONINTENSITY)},function(t){t=Math.max(Math.min(t,1),0),this._shaderValues.setNumber(laya.d3.core.scene.Scene3D.REFLETIONINTENSITY,t)}),g(0,t,"skyRenderer",function(){return this._skyRenderer}),g(0,t,"timer",function(){return this._timer},function(t){this._timer=t}),g(0,t,"ambientColor",function(){return this._shaderValues.getVector(laya.d3.core.scene.Scene3D.AMBIENTCOLOR)},function(t){this._shaderValues.setVector3(laya.d3.core.scene.Scene3D.AMBIENTCOLOR,t)}),g(0,t,"fogRange",function(){return this._shaderValues.getNumber(laya.d3.core.scene.Scene3D.FOGRANGE)},function(t){this._shaderValues.setNumber(laya.d3.core.scene.Scene3D.FOGRANGE,t)}),g(0,t,"fogStart",function(){return this._shaderValues.getNumber(laya.d3.core.scene.Scene3D.FOGSTART)},function(t){this._shaderValues.setNumber(laya.d3.core.scene.Scene3D.FOGSTART,t)}),g(0,t,"customReflection",function(){return this._shaderValues.getTexture(laya.d3.core.scene.Scene3D.REFLECTIONTEXTURE)},function(t){this._shaderValues.setTexture(laya.d3.core.scene.Scene3D.REFLECTIONTEXTURE,t),t?this._defineDatas.add(laya.d3.core.scene.Scene3D.SHADERDEFINE_REFLECTMAP):this._defineDatas.remove(laya.d3.core.scene.Scene3D.SHADERDEFINE_REFLECTMAP)}),g(0,t,"url",function(){return this._url}),i._parse=function(t,e,i){var n,r=t.data,s=[];switch(t.version){case"LAYAHIERARCHY:02":n=V._createNodeByJson02(r,s);break;default:n=V._createNodeByJson(r,s)}return Bt.combine(null,s),n},i.load=function(t,e){T.loader.create(t,e,null,"HIERARCHY")},i.REFLECTIONMODE_SKYBOX=0,i.REFLECTIONMODE_CUSTOM=1,i.SHADERDEFINE_FOG=0,i.SHADERDEFINE_DIRECTIONLIGHT=0,i.SHADERDEFINE_POINTLIGHT=0,i.SHADERDEFINE_SPOTLIGHT=0,i.SHADERDEFINE_CAST_SHADOW=0,i.SHADERDEFINE_SHADOW_PSSM1=0,i.SHADERDEFINE_SHADOW_PSSM2=0,i.SHADERDEFINE_SHADOW_PSSM3=0,i.SHADERDEFINE_SHADOW_PCF_NO=0,i.SHADERDEFINE_SHADOW_PCF1=0,i.SHADERDEFINE_SHADOW_PCF2=0,i.SHADERDEFINE_SHADOW_PCF3=0,i.SHADERDEFINE_REFLECTMAP=0,E(i,["FOGCOLOR",function(){return this.FOGCOLOR=We.propertyNameToID("u_FogColor")},"FOGSTART",function(){return this.FOGSTART=We.propertyNameToID("u_FogStart")},"FOGRANGE",function(){return this.FOGRANGE=We.propertyNameToID("u_FogRange")},"LIGHTDIRECTION",function(){return this.LIGHTDIRECTION=We.propertyNameToID("u_DirectionLight.Direction")},"LIGHTDIRCOLOR",function(){return this.LIGHTDIRCOLOR=We.propertyNameToID("u_DirectionLight.Color")},"POINTLIGHTPOS",function(){return this.POINTLIGHTPOS=We.propertyNameToID("u_PointLight.Position")},"POINTLIGHTRANGE",function(){return this.POINTLIGHTRANGE=We.propertyNameToID("u_PointLight.Range")},"POINTLIGHTATTENUATION",function(){return this.POINTLIGHTATTENUATION=We.propertyNameToID("u_PointLight.Attenuation")},"POINTLIGHTCOLOR",function(){return this.POINTLIGHTCOLOR=We.propertyNameToID("u_PointLight.Color")},"SPOTLIGHTPOS",function(){return this.SPOTLIGHTPOS=We.propertyNameToID("u_SpotLight.Position")},"SPOTLIGHTDIRECTION",function(){return this.SPOTLIGHTDIRECTION=We.propertyNameToID("u_SpotLight.Direction")},"SPOTLIGHTSPOTANGLE",function(){return this.SPOTLIGHTSPOTANGLE=We.propertyNameToID("u_SpotLight.Spot")},"SPOTLIGHTRANGE",function(){return this.SPOTLIGHTRANGE=We.propertyNameToID("u_SpotLight.Range")},"SPOTLIGHTCOLOR",function(){return this.SPOTLIGHTCOLOR=We.propertyNameToID("u_SpotLight.Color")},"SHADOWDISTANCE",function(){return this.SHADOWDISTANCE=We.propertyNameToID("u_shadowPSSMDistance")},"SHADOWLIGHTVIEWPROJECT",function(){return this.SHADOWLIGHTVIEWPROJECT=We.propertyNameToID("u_lightShadowVP")},"SHADOWMAPPCFOFFSET",function(){return this.SHADOWMAPPCFOFFSET=We.propertyNameToID("u_shadowPCFoffset")},"SHADOWMAPTEXTURE1",function(){return this.SHADOWMAPTEXTURE1=We.propertyNameToID("u_shadowMap1")},"SHADOWMAPTEXTURE2",function(){return this.SHADOWMAPTEXTURE2=We.propertyNameToID("u_shadowMap2")},"SHADOWMAPTEXTURE3",function(){return this.SHADOWMAPTEXTURE3=We.propertyNameToID("u_shadowMap3")},"AMBIENTCOLOR",function(){return this.AMBIENTCOLOR=We.propertyNameToID("u_AmbientColor")},"REFLECTIONTEXTURE",function(){return this.REFLECTIONTEXTURE=We.propertyNameToID("u_ReflectTexture")},"REFLETIONINTENSITY",function(){return this.REFLETIONINTENSITY=We.propertyNameToID("u_ReflectIntensity")},"TIME",function(){return this.TIME=We.propertyNameToID("u_Time")},"ANGLEATTENUATIONTEXTURE",function(){return this.ANGLEATTENUATIONTEXTURE=We.propertyNameToID("u_AngleTexture")},"RANGEATTENUATIONTEXTURE",function(){return this.RANGEATTENUATIONTEXTURE=We.propertyNameToID("u_RangeTexture")},"POINTLIGHTMATRIX",function(){return this.POINTLIGHTMATRIX=We.propertyNameToID("u_PointLightMatrix")},"SPOTLIGHTMATRIX",function(){return this.SPOTLIGHTMATRIX=We.propertyNameToID("u_SpotLightMatrix")}]),i}(ts),As=function(t){function h(t,e,i,n,r){if(this._attribInfo=null,this.customCompile=!1,this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},h.__super.call(this),!t||!e)throw"Shader Error";this._attribInfo=r,this._id=++h._count,this._vs=t,this._ps=e,this._nameMap=n||{},null!=i&&(h.sharders[i]=this),this.recreateResource(),this.lock=!0}I(h,"laya.webgl.shader.Shader",rs);var e=h.prototype;return e.recreateResource=function(){this._compile(),this._setGPUMemory(0)},e._disposeResource=function(){en.mainContext.deleteShader(this._vshader),en.mainContext.deleteShader(this._pshader),en.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this._setGPUMemory(0),this._curActTexIndex=0},e._compile=function(){if(this._vs&&this._ps&&!this._params){var t;this._reCompile=!0,this._params=[],this.customCompile&&(t=ui.preGetParams(this._vs,this._ps));var e=en.mainContext;this._program=e.createProgram(),this._vshader=h._createShader(e,this._vs,35633),this._pshader=h._createShader(e,this._ps,35632),e.attachShader(this._program,this._vshader),e.attachShader(this._program,this._pshader);var i,n,r=0,s=this._attribInfo?this._attribInfo.length:0;for(r=0;r<s;r+=2)e.bindAttribLocation(this._program,this._attribInfo[r+1],this._attribInfo[r]);if(e.linkProgram(this._program),!this.customCompile&&!e.getProgramParameter(this._program,35714))throw e.getProgramInfoLog(this._program);var a=this.customCompile?t.uniforms.length:e.getProgramParameter(this._program,35718);for(r=0;r<a;r++){var o=this.customCompile?t.uniforms[r]:e.getActiveUniform(this._program,r);0<(i={vartype:"uniform",glfun:null,ivartype:1,location:e.getUniformLocation(this._program,o.name),name:o.name,type:o.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0}).name.indexOf("[0]")&&(i.name=i.name.substr(0,i.name.length-3),i.isArray=!0,i.location=e.getUniformLocation(this._program,i.name)),this._params.push(i)}for(r=0,n=this._params.length;r<n;r++)switch((i=this._params[r]).indexOfParams=r,i.index=1,i.value=[i.location,null],i.codename=i.name,i.name=this._nameMap[i.codename]?this._nameMap[i.codename]:i.codename,(this._paramsMap[i.name]=i)._this=this,i.uploadedValue=[],i.type){case 5124:i.fun=i.isArray?this._uniform1iv:this._uniform1i;break;case 5126:i.fun=i.isArray?this._uniform1fv:this._uniform1f;break;case 35664:i.fun=i.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:i.fun=i.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:i.fun=i.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:i.fun=this._uniform_sampler2D;break;case 35680:i.fun=this._uniform_samplerCube;break;case 35676:i.glfun=e.uniformMatrix4fv,i.fun=this._uniformMatrix4fv;break;case 35670:i.fun=this._uniform1i;break;case 35674:case 35675:default:throw new Error("compile shader err!")}}},e.getUniform=function(t){return this._paramsMap[t]},e._uniform1f=function(t,e){var i=t.uploadedValue;return i[0]!==e?(en.mainContext.uniform1f(t.location,i[0]=e),1):0},e._uniform1fv=function(t,e){if(e.length<4){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(en.mainContext.uniform1fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return en.mainContext.uniform1fv(t.location,e),1},e._uniform_vec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(en.mainContext.uniform2f(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_vec2v=function(t,e){if(e.length<2){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(en.mainContext.uniform2fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return en.mainContext.uniform2fv(t.location,e),1},e._uniform_vec3=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(en.mainContext.uniform3f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3v=function(t,e){return en.mainContext.uniform3fv(t.location,e),1},e._uniform_vec4=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(en.mainContext.uniform4f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4v=function(t,e){return en.mainContext.uniform4fv(t.location,e),1},e._uniformMatrix2fv=function(t,e){return en.mainContext.uniformMatrix2fv(t.location,!1,e),1},e._uniformMatrix3fv=function(t,e){return en.mainContext.uniformMatrix3fv(t.location,!1,e),1},e._uniformMatrix4fv=function(t,e){return en.mainContext.uniformMatrix4fv(t.location,!1,e),1},e._uniform1i=function(t,e){var i=t.uploadedValue;return i[0]!==e?(en.mainContext.uniform1i(t.location,i[0]=e),1):0},e._uniform1iv=function(t,e){return en.mainContext.uniform1iv(t.location,e),1},e._uniform_ivec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(en.mainContext.uniform2i(t.location,i[0]=e[0],i[1]=e[1]),1):0},e._uniform_ivec2v=function(t,e){return en.mainContext.uniform2iv(t.location,e),1},e._uniform_vec3i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(en.mainContext.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},e._uniform_vec3vi=function(t,e){return en.mainContext.uniform3iv(t.location,e),1},e._uniform_vec4i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(en.mainContext.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},e._uniform_vec4vi=function(t,e){return en.mainContext.uniform4iv(t.location,e),1},e._uniform_sampler2D=function(t,e){var i=en.mainContext,n=t.uploadedValue;return null==n[0]?(n[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),j.activeTexture(i,33984+this._curActTexIndex),j.bindTexture(i,3553,e),this._curActTexIndex++,1):(j.activeTexture(i,33984+n[0]),j.bindTexture(i,3553,e),0)},e._uniform_samplerCube=function(t,e){var i=en.mainContext,n=t.uploadedValue;return null==n[0]?(n[0]=this._curActTexIndex,i.uniform1i(t.location,this._curActTexIndex),j.activeTexture(i,33984+this._curActTexIndex),j.bindTexture(i,34067,e),this._curActTexIndex++,1):(j.activeTexture(i,33984+n[0]),j.bindTexture(i,34067,e),0)},e._noSetValue=function(t){console.log("no....:"+t.name)},e.uploadOne=function(t,e){j.useProgram(en.mainContext,this._program);var i=this._paramsMap[t];i.fun.call(this,i,e)},e.uploadTexture2D=function(t){var e=j;e._activeTextures[0]!==t&&(e.bindTexture(en.mainContext,e.TEXTURE_2D,t),e._activeTextures[0]=t)},e.upload=function(t,e){rs.activeShader=rs.bindShader=this;var i=en.mainContext;j.useProgram(i,this._program),this._reCompile?(e=this._params,this._reCompile=!1):e=e||this._params;for(var n,r,s=e.length,a=0,o=0;o<s;o++)null!==(r=t[(n=e[o]).name])&&(a+=n.fun.call(this,n,r));$i.shaderCall+=a},e.uploadArray=function(t,e,i){rs.activeShader=this,rs.bindShader=this,j.useProgram(en.mainContext,this._program);this._params;for(var n,r,s=0,a=e-2;0<=a;a-=2)(r=this._paramsMap[t[a]])&&null!=(n=t[a+1])&&(i&&i[r.name]&&i[r.name].bind(),s+=r.fun.call(this,r,n));$i.shaderCall+=s},e.getParams=function(){return this._params},e.setAttributesLocation=function(t){this._attribInfo=t},h.getShader=function(t){return h.sharders[t]},h.create=function(t,e,i,n,r){return new h(t,e,i,n,r)},h.withCompile=function(t,e,i,n){if(i&&h.sharders[i])return h.sharders[i];var r=h._preCompileShader[2e-4*t];if(!r)throw new Error("withCompile shader err!"+t);return r.createShader(e,i,n,null)},h.withCompile2D=function(t,e,i,n,r,s){if(n&&h.sharders[n])return h.sharders[n];var a=h._preCompileShader[2e-4*t+e];if(!a)throw new Error("withCompile shader err!"+t+" "+e);return a.createShader(i,n,r,s)},h.addInclude=function(t,e){ui.addInclude(t,e)},h.preCompile=function(t,e,i,n){h._preCompileShader[2e-4*t]=new ui(e,i,n)},h.preCompile2D=function(t,e,i,n,r){h._preCompileShader[2e-4*t+e]=new ui(i,n,r)},h._createShader=function(t,e,i){var n=t.createShader(i);return t.shaderSource(n,e),t.compileShader(n),t.getShaderParameter(n,35713)?n:(console.log(t.getShaderInfoLog(n)),null)},h._count=0,h._preCompileShader={},h.SHADERNAME2ID=2e-4,h.sharders=new Array(32),E(h,["nameKey",function(){return this.nameKey=new si}]),h}(),Ms=function(n){function e(){this._intensityColor=null,this._intensity=NaN,this._shadow=!1,this._shadowFarPlane=0,this._shadowMapSize=0,this._shadowMapCount=0,this._shadowMapPCFType=0,this._parallelSplitShadowMap=null,this._lightmapBakedType=0,this.color=null,e.__super.call(this),this._intensity=1,this._intensityColor=new ln,this.color=new ln(1,1,1),this._shadow=!1,this._shadowFarPlane=8,this._shadowMapSize=512,this._shadowMapCount=1,this._shadowMapPCFType=0,this._lightmapBakedType=e.LIGHTMAPBAKEDTYPE_REALTIME}I(e,"laya.d3.core.light.LightSprite",n);var t=e.prototype;return t._parse=function(t,e){n.prototype._parse.call(this,t,e);var i=t.color;this.color.fromArray(i),this.intensity=t.intensity,this.lightmapBakedType=t.lightmapBakedType},t._onActive=function(){laya.display.Node.prototype._onActive.call(this),this.lightmapBakedType!==e.LIGHTMAPBAKEDTYPE_BAKED&&this._scene._addLight(this)},t._onInActive=function(){laya.display.Node.prototype._onInActive.call(this),this.lightmapBakedType!==e.LIGHTMAPBAKEDTYPE_BAKED&&this._scene._removeLight(this)},t._prepareToScene=function(){return!1},g(0,t,"diffuseColor",function(){return console.log("LightSprite: discard property,please use color property instead."),this.color},function(t){console.log("LightSprite: discard property,please use color property instead."),this.color=t}),g(0,t,"lightmapBakedType",function(){return this._lightmapBakedType},function(t){this._lightmapBakedType!==t&&(this._lightmapBakedType=t,this.activeInHierarchy&&(t!==e.LIGHTMAPBAKEDTYPE_BAKED?this._scene._addLight(this):this._scene._removeLight(this)))}),g(0,t,"shadowPCFType",function(){return this._shadowMapPCFType},function(t){this._shadowMapPCFType=t,this._parallelSplitShadowMap&&this._parallelSplitShadowMap.setPCFType(t)}),g(0,t,"shadowPSSMCount",function(){return this._shadowMapCount},function(t){this._shadowMapCount=t,this._parallelSplitShadowMap&&(this._parallelSplitShadowMap.shadowMapCount=t)}),g(0,t,"intensity",function(){return this._intensity},function(t){this._intensity=t}),g(0,t,"shadow",function(){return this._shadow},function(t){throw new Error("LightSprite: must override it.")}),g(0,t,"shadowResolution",function(){return this._shadowMapSize},function(t){this._shadowMapSize=t,this._parallelSplitShadowMap&&this._parallelSplitShadowMap.setShadowMapTextureSize(t)}),g(0,t,"shadowDistance",function(){return this._shadowFarPlane},function(t){this._shadowFarPlane=t,this._parallelSplitShadowMap&&this._parallelSplitShadowMap.setFarDistance(t)}),e.LIGHTMAPBAKEDTYPE_REALTIME=0,e.LIGHTMAPBAKEDTYPE_MIXED=1,e.LIGHTMAPBAKEDTYPE_BAKED=2,e}(es),Ds=(function(t){function e(){e.__super.call(this)}I(e,"laya.resource.HTMLImage",ns),e.create=function(t,e,i){var n=new ea(t,e,i,!1,!1);return n.wrapModeU=1,n.wrapModeV=1,n}}(),function(e){function t(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._actionName=null,this._controlNode=null,t.__super.call(this),this._interval=Tn.animationInterval,this._setBitUp(16)}I(t,"laya.display.AnimationBase",e);var i=t.prototype;return i.play=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=""),this._isPlaying=!0,this._actionName=i,this.index="string"==typeof t?this._getFrameByLabel(t):t,this.loop=e,this._isReverse=1===this.wrapMode,0==this.index&&this._isReverse&&(this.index=this.count-1),0<this.interval&&this.timerLoop(this.interval,this,this._frameLoop,null,!0,!0)},i._getFrameByLabel=function(t){for(var e=0;e<this._count;e++){var i=this._labels[e];if(i&&-1<i.indexOf(t))return e}return 0},i._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<this._count?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=0<=this._count-2?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},i._setControlNode=function(t){this._controlNode&&(this._controlNode.off("display",this,this._resumePlay),this._controlNode.off("undisplay",this,this._resumePlay)),(this._controlNode=t)&&t!=this&&(t.on("display",this,this._resumePlay),t.on("undisplay",this,this._resumePlay))},i._setDisplay=function(t){e.prototype._setDisplay.call(this,t),this._resumePlay()},i._resumePlay=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},i.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},i.addLabel=function(t,e){this._labels||(this._labels={}),this._labels[e]||(this._labels[e]=[]),this._labels[e].push(t)},i.removeLabel=function(t){if(t){if(this._labels)for(var e in this._labels)this._removeLabelFromList(this._labels[e],t)}else this._labels=null},i._removeLabelFromList=function(t,e){if(t)for(var i=t.length-1;0<=i;i--)t[i]==e&&t.splice(i,1)},i.gotoAndStop=function(t){this.index="string"==typeof t?this._getFrameByLabel(t):t,this.stop()},i._displayToIndex=function(t){},i.clear=function(){return this.stop(),this._labels=null,this},g(0,i,"count",function(){return this._count}),g(0,i,"index",function(){return this._index},function(t){if(this._index=t,this._displayToIndex(t),this._labels&&this._labels[t])for(var e=this._labels[t],i=0,n=e.length;i<n;i++)this.event("label",e[i])}),g(0,i,"isPlaying",function(){return this._isPlaying}),g(0,i,"interval",function(){return this._interval},function(t){this._interval!=t&&(this._frameRateChanged=!0,this._interval=t,this._isPlaying&&0<t&&this.timerLoop(t,this,this._frameLoop,null,!0,!0))}),t.WRAP_POSITIVE=0,t.WRAP_REVERSE=1,t.WRAP_PINGPONG=2,t}(ts)),bs=function(t){function e(){e.__super.call(this),this.setShaderName("SkyBox")}I(e,"laya.d3.core.material.SkyBoxMaterial",as);var i=e.prototype;return g(0,i,"textureCube",function(){return this._shaderValues.getTexture(e.TEXTURECUBE)},function(t){this._shaderValues.setTexture(e.TEXTURECUBE,t)}),g(0,i,"rotation",function(){return this._shaderValues.getNumber(e.ROTATION)},function(t){this._shaderValues.setNumber(e.ROTATION,t)}),g(0,i,"exposure",function(){return this._shaderValues.getNumber(e.EXPOSURE)},function(t){this._shaderValues.setNumber(e.EXPOSURE,t)}),g(0,i,"tintColor",function(){return this._shaderValues.getVector(e.TINTCOLOR)},function(t){this._shaderValues.setVector(e.TINTCOLOR,t)}),E(e,["TINTCOLOR",function(){return this.TINTCOLOR=We.propertyNameToID("u_TintColor")},"EXPOSURE",function(){return this.EXPOSURE=We.propertyNameToID("u_Exposure")},"ROTATION",function(){return this.ROTATION=We.propertyNameToID("u_Rotation")},"TEXTURECUBE",function(){return this.TEXTURECUBE=We.propertyNameToID("u_CubeTexture")},"defaultMaterial",function(){return this.defaultMaterial=new e}]),e}(),ws=function(r){function l(t){this._terrainRes=null,this._lightmapScaleOffset=null,l.__super.call(this),this._lightmapScaleOffset=new on(1,1,0,0),t&&(this._terrainRes=t,this.buildTerrain(t))}I(l,"laya.d3.terrain.Terrain",r);var t=l.prototype;return t._parse=function(t,e){r.prototype._parse.call(this,t,e),this.terrainRes=Hn.getRes(t.dataPath);var i=t.lightmapIndex;null!=i&&this.setLightmapIndex(i);var n=t.lightmapScaleOffset;n&&this.setLightmapScaleOffset(new on(n[0],n[1],n[2],n[3]))},t.setLightmapIndex=function(t){for(var e=0;e<this._children.length;e++){this._children[e].terrainRender.lightmapIndex=t}},t.setLightmapScaleOffset=function(t){if(t){t.cloneTo(this._lightmapScaleOffset);for(var e=0;e<this._children.length;e++){this._children[e].terrainRender.lightmapScaleOffset=this._lightmapScaleOffset}}},t.disableLight=function(){for(var t=0,e=this._children.length;t<e;t++)for(var i=this._children[t],n=0,r=i._render.sharedMaterials.length;n<r;n++){i._render.sharedMaterials[n].disableLight()}},t.buildTerrain=function(t){for(var e=t._chunkNumX,i=t._chunkNumZ,n=t._heightData,r=0,s=0;s<i;s++)for(var a=0;a<e;a++){for(var o=new ca(a,s,t._gridSize,n._terrainHeightData,n._width,n._height,t._cameraCoordinateInverse),h=t._chunkInfos[r++],l=0;l<h.alphaMap.length;l++){var u=h.detailID[l].length,c=0<u?t._detailTextureInfos[h.detailID[l][0]].diffuseTexture:null,_=1<u?t._detailTextureInfos[h.detailID[l][1]].diffuseTexture:null,d=2<u?t._detailTextureInfos[h.detailID[l][2]].diffuseTexture:null,f=3<u?t._detailTextureInfos[h.detailID[l][3]].diffuseTexture:null,p=0<u?t._detailTextureInfos[h.detailID[l][0]].scale:null,m=1<u?t._detailTextureInfos[h.detailID[l][1]].scale:null,g=2<u?t._detailTextureInfos[h.detailID[l][2]].scale:null,v=3<u?t._detailTextureInfos[h.detailID[l][3]].scale:null;o.buildRenderElementAndMaterial(u,h.normalMap,h.alphaMap[l],c,_,d,f,t._materialInfo.ambientColor,t._materialInfo.diffuseColor,t._materialInfo.specularColor,p?p.x:1,p?p.y:1,m?m.x:1,m?m.y:1,g?g.x:1,g?g.y:1,v?v.x:1,v?v.y:1)}o.terrainRender.receiveShadow=!0,o.terrainRender.lightmapScaleOffset=this._lightmapScaleOffset,this.addChild(o)}},t.width=function(){return this._terrainRes._chunkNumX*fe.CHUNK_GRID_NUM*this._terrainRes._gridSize},t.depth=function(){return this._terrainRes._chunkNumZ*fe.CHUNK_GRID_NUM*this._terrainRes._gridSize},t.getHeightXZ=function(t,e){if(!this._terrainRes)return NaN;if(t-=this.transform.position.x,e-=this.transform.position.z,l.__VECTOR3__||(l.__VECTOR3__=new ln),l.__VECTOR3__.x=t,l.__VECTOR3__.y=0,l.__VECTOR3__.z=e,ln.transformV3ToV3(l.__VECTOR3__,fe.__ADAPT_MATRIX_INV__,l.__VECTOR3__),t=l.__VECTOR3__.x,e=l.__VECTOR3__.z,t<0||t>this.width()||e<0||e>this.depth())return NaN;var i=this._terrainRes._gridSize,n=parseInt(""+t/i),r=parseInt(""+e/i),s=t-n*i,a=e-r*i,o=NaN,h=this._terrainRes._heightData;return i<s+a?(o=h._terrainHeightData[(r+1-1)*h._width+n+1])+(h._terrainHeightData[(r+1-1)*h._width+n]-o)*((i-s)/i)+(h._terrainHeightData[(r-1)*h._width+n+1]-o)*((i-a)/i):(o=h._terrainHeightData[Math.max(0,r-1)*h._width+n])+(h._terrainHeightData[Math.min(h._width*h._height-1,(r+1-1)*h._width+n)]-o)*(a/i)+(h._terrainHeightData[Math.min(h._width*h._height-1,Math.max(0,r-1)*h._width+n+1)]-o)*(s/i)},g(0,t,"terrainRes",null,function(t){t&&(this._terrainRes=t,this.buildTerrain(t))}),l.load=function(t){T.loader.create(t,null,null,"TERRAIN",null,null,1,!1)},l.RENDER_LINE_MODEL=!1,l.LOD_TOLERANCE_VALUE=4,l.LOD_DISTANCE_FACTOR=2,l.__VECTOR3__=null,l}(es),Ls=function(i){function n(){this._enableVertexColor=!1,n.__super.call(this),this.setShaderName("BLINNPHONG"),this._albedoIntensity=1,this._albedoColor=new on(1,1,1,1);var t=this._shaderValues;t.setVector(n.ALBEDOCOLOR,new on(1,1,1,1)),t.setVector(n.MATERIALSPECULAR,new on(1,1,1,1)),t.setNumber(n.SHININESS,.078125),t.setNumber(as.ALPHATESTVALUE,.5),t.setVector(n.TILINGOFFSET,new on(1,1,0,0)),this._enableLighting=!0,this.renderMode=0}I(n,"laya.d3.core.material.BlinnPhongMaterial",i);var t=n.prototype;return t.disableFog=function(){this._disablePublicDefineDatas.add(Rs.SHADERDEFINE_FOG)},t.cloneTo=function(t){i.prototype.cloneTo.call(this,t);var e=t;e._enableLighting=this._enableLighting,e._albedoIntensity=this._albedoIntensity,e._enableVertexColor=this._enableVertexColor,this._albedoColor.cloneTo(e._albedoColor)},g(0,t,"blend",function(){return this._shaderValues.getInt(n.BLEND)},function(t){this._shaderValues.setInt(n.BLEND,t)}),g(0,t,"enableLighting",function(){return this._enableLighting},function(t){this._enableLighting!==t&&(t?this._disablePublicDefineDatas.remove(Rs.SHADERDEFINE_POINTLIGHT|Rs.SHADERDEFINE_SPOTLIGHT|Rs.SHADERDEFINE_DIRECTIONLIGHT):this._disablePublicDefineDatas.add(Rs.SHADERDEFINE_POINTLIGHT|Rs.SHADERDEFINE_SPOTLIGHT|Rs.SHADERDEFINE_DIRECTIONLIGHT),this._enableLighting=t)}),g(0,t,"specularTexture",function(){return this._shaderValues.getTexture(n.SPECULARTEXTURE)},function(t){t?this._defineDatas.add(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_SPECULARMAP):this._defineDatas.remove(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_SPECULARMAP),this._shaderValues.setTexture(n.SPECULARTEXTURE,t)}),g(0,t,"normalTexture",function(){return this._shaderValues.getTexture(n.NORMALTEXTURE)},function(t){t?this._defineDatas.add(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_NORMALMAP):this._defineDatas.remove(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_NORMALMAP),this._shaderValues.setTexture(n.NORMALTEXTURE,t)}),g(0,t,"specularColorB",function(){return this._SpecColorB},function(t){this._SpecColorB=t}),g(0,t,"specularColorA",function(){return this._SpecColorA},function(t){this._SpecColorA=t}),g(0,t,"specularColorG",function(){return this._SpecColorG},function(t){this._SpecColorG=t}),g(0,t,"albedoColorB",function(){return this._ColorB},function(t){this._ColorB=t}),g(0,t,"albedoColorG",function(){return this._ColorG},function(t){this._ColorG=t}),g(0,t,"tilingOffsetW",function(){return this._MainTex_STW},function(t){this._MainTex_STW=t}),g(0,t,"tilingOffsetY",function(){return this._MainTex_STY},function(t){this._MainTex_STY=t}),g(0,t,"shininess",function(){return this._Shininess},function(t){this._Shininess=t}),g(0,t,"_Shininess",function(){return this._shaderValues.getNumber(n.SHININESS)},function(t){t=Math.max(0,Math.min(1,t)),this._shaderValues.setNumber(n.SHININESS,t)}),g(0,t,"_SpecColorG",function(){return this._shaderValues.getVector(n.MATERIALSPECULAR).y},function(t){this._shaderValues.getVector(n.MATERIALSPECULAR).y=t}),g(0,t,"_AlbedoIntensity",function(){return this._albedoIntensity},function(t){if(this._albedoIntensity!==t){var e=this._shaderValues.getVector(n.ALBEDOCOLOR);on.scale(this._albedoColor,t,e),this._albedoIntensity=t,this._shaderValues.setVector(n.ALBEDOCOLOR,e)}}),g(0,t,"enableVertexColor",function(){return this._enableVertexColor},function(t){(this._enableVertexColor=t)?this._defineDatas.add(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR):this._defineDatas.remove(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR)}),g(0,t,"blendSrc",function(){return this._shaderValues.getInt(n.BLEND_SRC)},function(t){this._shaderValues.setInt(n.BLEND_SRC,t)}),g(0,t,"specularColorR",function(){return this._SpecColorR},function(t){this._SpecColorR=t}),g(0,t,"tilingOffsetX",function(){return this._MainTex_STX},function(t){this._MainTex_STX=t}),g(0,t,"_Cutoff",function(){return this.alphaTestValue},function(t){this.alphaTestValue=t}),g(0,t,"cull",function(){return this._shaderValues.getInt(n.CULL)},function(t){this._shaderValues.setInt(n.CULL,t)}),g(0,t,"tilingOffsetZ",function(){return this._MainTex_STZ},function(t){this._MainTex_STZ=t}),g(0,t,"_MainTex_STZ",function(){return this._shaderValues.getVector(n.TILINGOFFSET).z},function(t){var e=this._shaderValues.getVector(n.TILINGOFFSET);e.z=t,this.tilingOffset=e}),g(0,t,"albedoTexture",function(){return this._shaderValues.getTexture(n.ALBEDOTEXTURE)},function(t){t?this._defineDatas.add(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_DIFFUSEMAP):this._defineDatas.remove(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_DIFFUSEMAP),this._shaderValues.setTexture(n.ALBEDOTEXTURE,t)}),g(0,t,"tilingOffset",function(){return this._shaderValues.getVector(n.TILINGOFFSET)},function(t){t&&(1!=t.x||1!=t.y||0!=t.z||0!=t.w)?this._defineDatas.add(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_TILINGOFFSET):this._defineDatas.remove(laya.d3.core.material.BlinnPhongMaterial.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(n.TILINGOFFSET,t)}),g(0,t,"_MainTex_STY",function(){return this._shaderValues.getVector(n.TILINGOFFSET).y},function(t){var e=this._shaderValues.getVector(n.TILINGOFFSET);e.y=t,this.tilingOffset=e}),g(0,t,"depthWrite",function(){return this._shaderValues.getBool(n.DEPTH_WRITE)},function(t){this._shaderValues.setBool(n.DEPTH_WRITE,t)}),g(0,t,"_SpecColorA",function(){return this._shaderValues.getVector(n.MATERIALSPECULAR).w},function(t){this._shaderValues.getVector(n.MATERIALSPECULAR).w=t}),g(0,t,"albedoColor",function(){return this._albedoColor},function(t){var e=this._shaderValues.getVector(n.ALBEDOCOLOR);on.scale(t,this._albedoIntensity,e),this._albedoColor=t,this._shaderValues.setVector(n.ALBEDOCOLOR,e)}),g(0,t,"albedoColorR",function(){return this._ColorR},function(t){this._ColorR=t}),g(0,t,"_ColorA",function(){return this._albedoColor.w},function(t){this._albedoColor.w=t,this.albedoColor=this._albedoColor}),g(0,t,"_SpecColorB",function(){return this._shaderValues.getVector(n.MATERIALSPECULAR).z},function(t){this._shaderValues.getVector(n.MATERIALSPECULAR).z=t}),g(0,t,"renderMode",null,function(t){switch(t){case 0:this.alphaTest=!1,this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.depthTest=513;break;case 1:this.renderQueue=2450,this.alphaTest=!0,this.depthWrite=!0,this.cull=2,this.blend=0,this.depthTest=513;break;case 2:this.renderQueue=3e3,this.alphaTest=!1,this.depthWrite=!1,this.cull=2,this.blend=1,this.blendSrc=770,this.blendDst=771,this.depthTest=513;break;default:throw new Error("Material:renderMode value error.")}}),g(0,t,"depthTest",function(){return this._shaderValues.getInt(n.DEPTH_TEST)},function(t){this._shaderValues.setInt(n.DEPTH_TEST,t)}),g(0,t,"_ColorR",function(){return this._albedoColor.x},function(t){this._albedoColor.x=t,this.albedoColor=this._albedoColor}),g(0,t,"albedoColorA",function(){return this._ColorA},function(t){this._ColorA=t}),g(0,t,"_ColorG",function(){return this._albedoColor.y},function(t){this._albedoColor.y=t,this.albedoColor=this._albedoColor}),g(0,t,"_SpecColorR",function(){return this._shaderValues.getVector(n.MATERIALSPECULAR).x},function(t){this._shaderValues.getVector(n.MATERIALSPECULAR).x=t}),g(0,t,"albedoIntensity",function(){return this._albedoIntensity},function(t){this._AlbedoIntensity=t}),g(0,t,"_ColorB",function(){return this._albedoColor.z},function(t){this._albedoColor.z=t,this.albedoColor=this._albedoColor}),g(0,t,"_MainTex_STX",function(){return this._shaderValues.getVector(n.TILINGOFFSET).x},function(t){var e=this._shaderValues.getVector(n.TILINGOFFSET);e.x=t,this.tilingOffset=e}),g(0,t,"blendDst",function(){return this._shaderValues.getInt(n.BLEND_DST)},function(t){this._shaderValues.setInt(n.BLEND_DST,t)}),g(0,t,"specularColor",function(){return this._shaderValues.getVector(n.MATERIALSPECULAR)},function(t){this._shaderValues.setVector(n.MATERIALSPECULAR,t)}),g(0,t,"_MainTex_STW",function(){return this._shaderValues.getVector(n.TILINGOFFSET).w},function(t){var e=this._shaderValues.getVector(n.TILINGOFFSET);e.w=t,this.tilingOffset=e}),n.__init__=function(){n.SHADERDEFINE_DIFFUSEMAP=n.shaderDefines.registerDefine("DIFFUSEMAP"),n.SHADERDEFINE_NORMALMAP=n.shaderDefines.registerDefine("NORMALMAP"),n.SHADERDEFINE_SPECULARMAP=n.shaderDefines.registerDefine("SPECULARMAP"),n.SHADERDEFINE_TILINGOFFSET=n.shaderDefines.registerDefine("TILINGOFFSET"),n.SHADERDEFINE_ENABLEVERTEXCOLOR=n.shaderDefines.registerDefine("ENABLEVERTEXCOLOR")},n.SPECULARSOURCE_DIFFUSEMAPALPHA=0,n.SPECULARSOURCE_SPECULARMAP=0,n.RENDERMODE_OPAQUE=0,n.RENDERMODE_CUTOUT=1,n.RENDERMODE_TRANSPARENT=2,n.SHADERDEFINE_DIFFUSEMAP=0,n.SHADERDEFINE_NORMALMAP=0,n.SHADERDEFINE_SPECULARMAP=0,n.SHADERDEFINE_TILINGOFFSET=0,n.SHADERDEFINE_ENABLEVERTEXCOLOR=0,E(n,["ALBEDOTEXTURE",function(){return this.ALBEDOTEXTURE=We.propertyNameToID("u_DiffuseTexture")},"NORMALTEXTURE",function(){return this.NORMALTEXTURE=We.propertyNameToID("u_NormalTexture")},"SPECULARTEXTURE",function(){return this.SPECULARTEXTURE=We.propertyNameToID("u_SpecularTexture")},"ALBEDOCOLOR",function(){return this.ALBEDOCOLOR=We.propertyNameToID("u_DiffuseColor")},"MATERIALSPECULAR",function(){return this.MATERIALSPECULAR=We.propertyNameToID("u_MaterialSpecular")},"SHININESS",function(){return this.SHININESS=We.propertyNameToID("u_Shininess")},"TILINGOFFSET",function(){return this.TILINGOFFSET=We.propertyNameToID("u_TilingOffset")},"CULL",function(){return this.CULL=We.propertyNameToID("s_Cull")},"BLEND",function(){return this.BLEND=We.propertyNameToID("s_Blend")},"BLEND_SRC",function(){return this.BLEND_SRC=We.propertyNameToID("s_BlendSrc")},"BLEND_DST",function(){return this.BLEND_DST=We.propertyNameToID("s_BlendDst")},"DEPTH_TEST",function(){return this.DEPTH_TEST=We.propertyNameToID("s_DepthTest")},"DEPTH_WRITE",function(){return this.DEPTH_WRITE=We.propertyNameToID("s_DepthWrite")},"defaultMaterial",function(){return this.defaultMaterial=new n},"shaderDefines",function(){return this.shaderDefines=new ii(as.shaderDefines)}]),n}(as),Os=function(e){function d(){this._clipPoint=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=0,this._startY=0,this._words=null,this._charSize={},this._valign="top",this._color="#000000",this._singleCharRender=!1,d.__super.call(this),this._fontSize=d.defaultFontSize,this._font=d.defaultFont,this.overflow="visible",this._style=wr.EMPTY}I(d,"laya.display.Text",e);var t=d.prototype;return t.getStyle=function(){return this._style===wr.EMPTY&&(this._style=wr.create()),this._style},t._getTextStyle=function(){return this._style===wr.EMPTY&&(this._style=wr.create()),this._style},t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._clipPoint=null,this._lines=null,this._lineWidths=null,this._words&&this._words.forEach(function(t){t.cleanCache()}),this._words=null,this._charSize=null},t._getBoundPointsM=function(t){void 0===t&&(t=!1);var e=ve.TEMP;return e.setTo(0,0,this.width,this.height),e._getBoundPoints()},t.getGraphicBounds=function(t){void 0===t&&(t=!1);var e=ve.TEMP;return e.setTo(0,0,this.width,this.height),e},t._getCSSStyle=function(){return this._style},t.lang=function(t,e,i,n,r,s,a,o,h,l,u){if(t=d.langPacks&&d.langPacks[t]?d.langPacks[t]:t,arguments.length<2)this._text=t;else{for(var c=0,_=arguments.length;c<_;c++)t=t.replace("{"+c+"}",arguments[c+1]);this._text=t}},t._getContextFont=function(){return(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(Vt.onIPhone&&laya.display.Text.fontFamilyMap[this.font]||this.font)},t._isPassWordMode=function(){var t=this._style.asPassword;return"prompt"in this&&this.prompt==this._text&&(t=!1),t},t._getPassWordTxt=function(t){var e;e="";for(var i=t.length;0<i;i--)e+="●";return e},t._renderText=function(){var t=this.padding,e=this._lines.length;"visible"!=this.overflow&&(e=Math.min(e,Math.floor((this.height-t[0]-t[2])/(this.leading+this._charSize.height))+1));var i=this.scrollY/(this._charSize.height+this.leading)|0,n=this.graphics;n.clear(!0);var r=this._getContextFont();Vt.context.font=r;var s=t[3],a="left",o=this._lines,h=this.leading+this._charSize.height,l=this._style.currBitmapFont;l&&(h=this.leading+l.getMaxHeight());var u=t[0];if(!l&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?(a="right",s=this._width-t[1]):"center"==this.align&&(a="center",s=.5*this._width+t[3]-t[1])),0<this._height){var c=this._textHeight>this._height?"top":this.valign;"middle"===c?u=.5*(this._height-e*h)+t[0]-t[2]:"bottom"===c&&(u=this._height-e*h-t[2])}var _=this._style;if(l&&l.autoScaleSize)var d=l.fontSize/this.fontSize;if(this._clipPoint){if(n.save(),l&&l.autoScaleSize){var f=0,p=0;f=this._width?this._width-t[3]-t[1]:this._textWidth,p=this._height?this._height-t[0]-t[2]:this._textHeight,f*=d,p*=d,n.clipRect(t[3],t[0],f,p)}else n.clipRect(t[3],t[0],this._width?this._width-t[3]-t[1]:this._textWidth,this._height?this._height-t[0]-t[2]:this._textHeight);this.repaint()}var m=_.asPassword;"prompt"in this&&this.prompt==this._text&&(m=!1);for(var g=0,v=0,T=Math.min(this._lines.length,e+i)||1,y=i;y<T;y++){var E,x=o[y];if(m){var S=x.length;x="";for(var C=S;0<C;C--)x+="●"}if(null==x&&(x=""),g=s-(this._clipPoint?this._clipPoint.x:0),v=u+h*y-(this._clipPoint?this._clipPoint.y:0),this.underline&&this._drawUnderline(a,g,v,y),l){var I=this.width;l.autoScaleSize&&(I=this.width*d),l._drawText(x,this,g,v,this.align,I)}else this._words||(this._words=[]),this._words.length>y-i?E=this._words[y-i]:(E=new _e,this._words.push(E)),E.setText(x),E.splitRender=this._singleCharRender,_.stroke?n.fillBorderText(E,g,v,r,this.color,_.strokeColor,_.stroke,a):n.fillText(E,g,v,r,this.color,a)}if(l&&l.autoScaleSize){var R=1/d;this.scale(R,R)}this._clipPoint&&n.restore(),this._startX=s,this._startY=u},t._drawUnderline=function(t,e,i,n){var r=this._lineWidths[n];switch(t){case"center":e-=r/2;break;case"right":e-=r}i+=this._charSize.height,this._graphics.drawLine(e,i,e+r,i,this.underlineColor||this.color,1)},t.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear(!0);qi.isConchApp?m.conchTextCanvas.font=this._getContextFont():Vt.context.font=this._getContextFont(),this._lines.length=0,this._lineWidths.length=0,this._isPassWordMode()?this._parseLines(this._getPassWordTxt(this._text)):this._parseLines(this._text),this._evalTextSize(),this._checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new R(0,0)):this._clipPoint=null,this._renderText()},t._evalTextSize=function(){var t,e=NaN;t=Math.max.apply(this,this._lineWidths),e=this._style.currBitmapFont?this._lines.length*(this._style.currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],t==this._textWidth&&e==this._textHeight||(this._textWidth=t,this._textHeight=e)},t._checkEnabledViewportOrNot=function(){return"scroll"==this.overflow&&(0<this._width&&this._textWidth>this._width||0<this._height&&this._textHeight>this._height)},t.changeText=function(t){this._text!==t&&(this.lang(t+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},t._parseLines=function(t){var e=this.wordWrap||"hidden"==this.overflow;if(e)var i=this._getWordWrapWidth();var n=this._style.currBitmapFont;if(n)this._charSize.width=n.getMaxWidth(),this._charSize.height=n.getMaxHeight();else{var r=null;(r=qi.isConchApp?m.conchTextCanvas.measureText(this._testWord):Vt.context.measureText(d._testWord))||(r={width:100}),this._charSize.width=r.width,this._charSize.height=r.height||this.fontSize}for(var s=t.replace(/\r\n/g,"\n").split("\n"),a=0,o=s.length;a<o;a++){var h=s[a];e?this._parseLine(h,i):(this._lineWidths.push(this._getTextWidth(h)),this._lines.push(h))}},t._parseLine=function(t,e){Vt.context;var i,n=this._lines,r=0,s=NaN,a=NaN,o=0;if((s=this._getTextWidth(t))<=e)return n.push(t),void this._lineWidths.push(s);s=this._charSize.width,0==(r=Math.floor(e/s))&&(r=1),a=s=this._getTextWidth(t.substring(0,r));for(var h=r,l=t.length;h<l;h++)if(e<(a+=s=this._getTextWidth(t.charAt(h))))if(this.wordWrap){var u=t.substring(o,h);if(u.charCodeAt(u.length-1)<255&&(i=/(?:\w|-)+$/.exec(u))&&(h=i.index+o,0==i.index?h+=u.length:u=t.substring(o,h)),n.push(u),this._lineWidths.push(a-s),!((o=h)+r<l)){n.push(t.substring(o,l)),this._lineWidths.push(this._getTextWidth(n[n.length-1])),o=-1;break}h+=r,a=s=this._getTextWidth(t.substring(o,h)),h--}else if("hidden"==this.overflow)return n.push(t.substring(0,h)),void this._lineWidths.push(this._getTextWidth(n[n.length-1]));this.wordWrap&&-1!=o&&(n.push(t.substring(o,l)),this._lineWidths.push(this._getTextWidth(n[n.length-1])))},t._getTextWidth=function(t){var e=this._style.currBitmapFont;return e?e.getTextWidth(t):qi.isConchApp?m.conchTextCanvas.measureText(t).width:Vt.context.measureText(t).width},t._getWordWrapWidth=function(){var t=this.padding,e=NaN,i=this._style.currBitmapFont;return(e=i&&i.autoScaleSize?this._width*(i.fontSize/this.fontSize):this._width)<=0&&(e=this.wordWrap?100:Vt.width),e<=0&&(e=100),e-t[3]-t[1]},t.getCharPoint=function(t,e){this._isChanged&&T.systemTimer.runCallLater(this,this.typeset);for(var i=0,n=this._lines,r=0,s=0,a=n.length;s<a;s++){if(t<(i+=n[s].length)){var o=s;break}r=i}var h=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;Vt.context.font=h;var l=this._getTextWidth(this._text.substring(r,t));return(e||new R).setTo(this._startX+l-(this._clipPoint?this._clipPoint.x:0),this._startY+o*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},g(0,t,"singleCharRender",function(){return this._singleCharRender},function(t){this._singleCharRender=t}),g(0,t,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),g(0,t,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function(t){if(!("scroll"!=this.overflow||this.textHeight<this._height)&&this._clipPoint){t=t<this.padding[0]?this.padding[0]:t;var e=this._textHeight-this._height;t=e<t?e:t,this._clipPoint.y=t,this._renderText()}}),g(0,t,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function(t){if(!("scroll"!=this.overflow||this.textWidth<this._width)&&this._clipPoint){t=t<this.padding[3]?this.padding[3]:t;var e=this._textWidth-this._width;t=e<t?e:t,this._clipPoint.x=t,this._renderText()}}),g(0,t,"stroke",function(){return this._style.stroke},function(t){this._getTextStyle().stroke=t,this.isChanged=!0}),g(0,t,"strokeColor",function(){return this._style.strokeColor},function(t){this._getTextStyle().strokeColor=t,this.isChanged=!0}),g(0,t,"bold",function(){return this._style.bold},function(t){this._getTextStyle().bold=t,this.isChanged=!0}),g(0,t,"padding",function(){return this._style.padding},function(t){if("string"==typeof t){var e,i,n=0;for(i=(e=t.split(",")).length;e.length<4;)e.push(0);for(n=0;n<i;n++)e[n]=parseFloat(e[n])||0;t=e}this._getTextStyle().padding=t,this.isChanged=!0}),g(0,t,"height",function(){return this._height?this._height:this.textHeight},function(t){t!=this._height&&(T.superSet(ts,this,"height",t),this.isChanged=!0,this.borderColor&&this._setBorderStyleColor(0,0,this.width,this.height,this.borderColor,1))}),g(0,t,"wordWrap",function(){return this._style.wordWrap},function(t){this._getTextStyle().wordWrap=t,this.isChanged=!0}),g(0,t,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),g(0,t,"isChanged",null,function(t){this._isChanged!==t&&(this._isChanged=t)&&T.systemTimer.callLater(this,this.typeset)}),g(0,t,"borderColor",function(){return this._style.borderColor},function(t){this._getTextStyle().borderColor=t,this._renderType|=128,this._setBorderStyleColor(0,0,this.width,this.height,t,1),this._setRenderType(this._renderType),this.isChanged=!0}),g(0,t,"text",function(){return this._text||""},function(t){this._text!==t&&(this.lang(t+""),this.isChanged=!0,this.event("change"),this.borderColor&&this._setBorderStyleColor(0,0,this.width,this.height,this.borderColor,1))}),g(0,t,"valign",function(){return this._valign},function(t){this._valign=t,this.isChanged=!0}),g(0,t,"underlineColor",function(){return this._style.underlineColor},function(t){this._getTextStyle().underlineColor=t,this._isChanged||this._renderText()}),g(0,t,"italic",function(){return this._style.italic},function(t){this._getTextStyle().italic=t,this.isChanged=!0}),g(0,t,"underline",function(){return this._style.underline},function(t){this._getTextStyle().underline=t}),g(0,t,"bgColor",function(){return this._style.bgColor},function(t){this._getTextStyle().bgColor=t,this._renderType|=128,this._setBgStyleColor(0,0,this.width,this.height,t),this._setRenderType(this._renderType),this.isChanged=!0}),g(0,t,"color",function(){return this._color},function(t){this._color!=t&&(this._color=t,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),g(0,t,"align",function(){return this._style.align},function(t){this._getTextStyle().align=t,this.isChanged=!0}),g(0,t,"fontSize",function(){return this._fontSize},function(t){this._fontSize!=t&&(this._fontSize=t,this.isChanged=!0)}),g(0,t,"textHeight",function(){return this._isChanged&&T.systemTimer.runCallLater(this,this.typeset),this._textHeight}),g(0,t,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),g(0,t,"leading",function(){return this._style.leading},function(t){this._getTextStyle().leading=t,this.isChanged=!0}),g(0,t,"font",function(){return this._font},function(t){this._style.currBitmapFont&&(this._getTextStyle().currBitmapFont=null,this.scale(1,1)),d._bitmapFonts&&d._bitmapFonts[t]&&(this._getTextStyle().currBitmapFont=d._bitmapFonts[t]),this._font=t,this.isChanged=!0}),g(0,t,"textWidth",function(){return this._isChanged&&T.systemTimer.runCallLater(this,this.typeset),this._textWidth}),g(0,t,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function(t){t!=this._width&&(T.superSet(ts,this,"width",t),this.isChanged=!0,this.borderColor&&this._setBorderStyleColor(0,0,this.width,this.height,this.borderColor,1))}),d.defaultFontStr=function(){return d.defaultFontSize+"px "+d.defaultFont},d.registerBitmapFont=function(t,e){d._bitmapFonts||(d._bitmapFonts={}),d._bitmapFonts[t]=e},d.unregisterBitmapFont=function(t,e){if(void 0===e&&(e=!0),d._bitmapFonts&&d._bitmapFonts[t]){var i=d._bitmapFonts[t];e&&i.destroy(),delete d._bitmapFonts[t]}},d.VISIBLE="visible",d.SCROLL="scroll",d.HIDDEN="hidden",d.defaultFontSize=12,d.defaultFont="Arial",d.langPacks=null,d.isComplexText=!1,d._testWord="游",d._bitmapFonts=null,d.CharacterCache=!0,d.RightToLeft=!1,E(d,["fontFamilyMap",function(){return this.fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]),d}(ts),Ns=function(i){function n(){this._albedoColor=null,this._specularColor=null,this._emissionColor=null,n.__super.call(this),this.setShaderName("PBRSpecular"),this._albedoColor=new on(1,1,1,1),this._shaderValues.setVector(n.ALBEDOCOLOR,new on(1,1,1,1)),this._emissionColor=new on(0,0,0,0),this._shaderValues.setVector(n.EMISSIONCOLOR,new on(0,0,0,0)),this._specularColor=new on(.2,.2,.2,.2),this._shaderValues.setVector(n.SPECULARCOLOR,new on(.2,.2,.2,.2)),this._shaderValues.setNumber(n.SMOOTHNESS,.5),this._shaderValues.setNumber(n.SMOOTHNESSSCALE,1),this._shaderValues.setNumber(n.SMOOTHNESSSOURCE,0),this._shaderValues.setNumber(n.OCCLUSIONSTRENGTH,1),this._shaderValues.setNumber(n.NORMALSCALE,1),this._shaderValues.setNumber(n.PARALLAXSCALE,.001),this._shaderValues.setBool(n.ENABLEEMISSION,!1),this._shaderValues.setNumber(as.ALPHATESTVALUE,.5),this.renderMode=0}I(n,"laya.d3.core.material.PBRSpecularMaterial",i);var t=n.prototype;return t.cloneTo=function(t){i.prototype.cloneTo.call(this,t);var e=t;this._albedoColor.cloneTo(e._albedoColor),this._specularColor.cloneTo(e._specularColor),this._emissionColor.cloneTo(e._emissionColor)},g(0,t,"depthTest",function(){return this._shaderValues.getInt(n.DEPTH_TEST)},function(t){this._shaderValues.setInt(n.DEPTH_TEST,t)}),g(0,t,"blendDst",function(){return this._shaderValues.getInt(n.BLEND_DST)},function(t){this._shaderValues.setInt(n.BLEND_DST,t)}),g(0,t,"blendSrc",function(){return this._shaderValues.getInt(n.BLEND_SRC)},function(t){this._shaderValues.setInt(n.BLEND_SRC,t)}),g(0,t,"cull",function(){return this._shaderValues.getInt(n.CULL)},function(t){this._shaderValues.setInt(n.CULL,t)}),g(0,t,"depthWrite",function(){return this._shaderValues.getBool(n.DEPTH_WRITE)},function(t){this._shaderValues.setBool(n.DEPTH_WRITE,t)}),g(0,t,"tilingOffsetZ",function(){return this._MainTex_STZ},function(t){this._MainTex_STZ=t}),g(0,t,"tilingOffsetY",function(){return this._MainTex_STY},function(t){this._MainTex_STY=t}),g(0,t,"emissionTexture",function(){return this._shaderValues.getTexture(n.EMISSIONTEXTURE)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSIONTEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSIONTEXTURE),this._shaderValues.setTexture(n.EMISSIONTEXTURE,t)}),g(0,t,"smoothnessSource",function(){return this._shaderValues.getInt(n.SMOOTHNESSSOURCE)},function(t){t?(this._defineDatas.add(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA),this._shaderValues.setInt(n.SMOOTHNESSSOURCE,1)):(this._defineDatas.remove(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA),this._shaderValues.setInt(n.SMOOTHNESSSOURCE,0))}),g(0,t,"_Glossiness",function(){return this._shaderValues.getNumber(n.SMOOTHNESS)},function(t){this._shaderValues.setNumber(n.SMOOTHNESS,t)}),g(0,t,"emissionColor",function(){return this._shaderValues.getVector(n.EMISSIONCOLOR)},function(t){this._shaderValues.setVector(n.EMISSIONCOLOR,t)}),g(0,t,"smoothnessTextureScale",function(){return this._GlossMapScale},function(t){this._GlossMapScale=Math.max(0,Math.min(1,t))}),g(0,t,"_MainTex_STW",function(){return this._shaderValues.getVector(n.TILINGOFFSET).w},function(t){var e=this._shaderValues.getVector(n.TILINGOFFSET);e.w=t,this.tilingOffset=e}),g(0,t,"smoothness",function(){return this._Glossiness},function(t){this._Glossiness=Math.max(0,Math.min(1,t))}),g(0,t,"blend",function(){return this._shaderValues.getInt(n.BLEND)},function(t){this._shaderValues.setInt(n.BLEND,t)}),g(0,t,"enableEmission",function(){return this._shaderValues.getBool(n.ENABLEEMISSION)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSION):this._defineDatas.remove(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_EMISSION),this._shaderValues.setBool(n.ENABLEEMISSION,t)}),g(0,t,"albedoColorG",function(){return this._ColorG},function(t){this._ColorG=t}),g(0,t,"specularColorB",function(){return this._SpecColorB},function(t){this._SpecColorB=t}),g(0,t,"specularTexture",function(){return this._shaderValues.getTexture(n.SPECULARTEXTURE)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SPECULARTEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_SPECULARTEXTURE),this._shaderValues.setTexture(n.SPECULARTEXTURE,t)}),g(0,t,"_Cutoff",function(){return this.alphaTestValue},function(t){this.alphaTestValue=t}),g(0,t,"occlusionTextureStrength",function(){return this._OcclusionStrength},function(t){this._OcclusionStrength=Math.max(0,Math.min(1,t))}),g(0,t,"occlusionTexture",function(){return this._shaderValues.getTexture(n.OCCLUSIONTEXTURE)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_OCCLUSIONTEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_OCCLUSIONTEXTURE),this._shaderValues.setTexture(n.OCCLUSIONTEXTURE,t)}),g(0,t,"_ColorG",function(){return this._albedoColor.y},function(t){this._albedoColor.y=t,this.albedoColor=this._albedoColor}),g(0,t,"parallaxTexture",function(){return this._shaderValues.getTexture(n.PARALLAXTEXTURE)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_PARALLAXTEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_PARALLAXTEXTURE),this._shaderValues.setTexture(n.PARALLAXTEXTURE,t)}),g(0,t,"normalTextureScale",function(){return this._BumpScale},function(t){this._BumpScale=t}),g(0,t,"_SpecColorB",function(){return this._specularColor.z},function(t){this._specularColor.z=t,this.specularColor=this._specularColor}),g(0,t,"_OcclusionStrength",function(){return this._shaderValues.getNumber(n.OCCLUSIONSTRENGTH)},function(t){this._shaderValues.setNumber(n.OCCLUSIONSTRENGTH,t)}),g(0,t,"normalTexture",function(){return this._shaderValues.getTexture(n.NORMALTEXTURE)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_NORMALTEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_NORMALTEXTURE),this._shaderValues.setTexture(n.NORMALTEXTURE,t)}),g(0,t,"renderMode",null,function(t){switch(t){case 0:this.alphaTest=!1,this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.depthTest=513,this._defineDatas.remove(n.SHADERDEFINE_ALPHAPREMULTIPLY);break;case 1:this.renderQueue=2450,this.alphaTest=!0,this.depthWrite=!0,this.cull=2,this.blend=0,this.depthTest=513,this._defineDatas.remove(n.SHADERDEFINE_ALPHAPREMULTIPLY);break;case 2:this.renderQueue=3e3,this.alphaTest=!1,this.depthWrite=!1,this.cull=2,this.blend=1,this.blendSrc=770,this.blendDst=771,this.depthTest=513,this._defineDatas.remove(n.SHADERDEFINE_ALPHAPREMULTIPLY);break;case 3:this.renderQueue=3e3,this.alphaTest=!1,this.depthWrite=!1,this.cull=2,this.blend=1,this.blendSrc=1,this.blendDst=771,this.depthTest=513,this._defineDatas.add(n.SHADERDEFINE_ALPHAPREMULTIPLY);break;default:throw new Error("PBRSpecularMaterial : renderMode value error.")}}),g(0,t,"albedoTexture",function(){return this._shaderValues.getTexture(n.ALBEDOTEXTURE)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_ALBEDOTEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_ALBEDOTEXTURE),this._shaderValues.setTexture(n.ALBEDOTEXTURE,t)}),g(0,t,"_SpecColorA",function(){return this._specularColor.w},function(t){this._specularColor.w=t,this.specularColor=this._specularColor}),g(0,t,"specularColorR",function(){return this._SpecColorR},function(t){this._SpecColorR=t}),g(0,t,"parallaxTextureScale",function(){return this._Parallax},function(t){this._Parallax=Math.max(.005,Math.min(.08,t))}),g(0,t,"_MainTex_STY",function(){return this._shaderValues.getVector(n.TILINGOFFSET).y},function(t){var e=this._shaderValues.getVector(n.TILINGOFFSET);e.y=t,this.tilingOffset=e}),g(0,t,"tilingOffsetW",function(){return this._MainTex_STW},function(t){this._MainTex_STW=t}),g(0,t,"_SpecColorG",function(){return this._specularColor.y},function(t){this._specularColor.y=t,this.specularColor=this._specularColor}),g(0,t,"_Parallax",function(){return this._shaderValues.getNumber(n.PARALLAXSCALE)},function(t){this._shaderValues.setNumber(n.PARALLAXSCALE,t)}),g(0,t,"_ColorA",function(){return this._albedoColor.w},function(t){this._albedoColor.w=t,this.albedoColor=this._albedoColor}),g(0,t,"specularColor",function(){return this._shaderValues.getVector(n.SPECULARCOLOR)},function(t){this._shaderValues.setVector(n.SPECULARCOLOR,t)}),g(0,t,"tilingOffset",function(){return this._shaderValues.getVector(n.TILINGOFFSET)},function(t){t&&(1!=t.x||1!=t.y||0!=t.z||0!=t.w)?this._defineDatas.add(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_TILINGOFFSET):this._defineDatas.remove(laya.d3.core.material.PBRSpecularMaterial.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(n.TILINGOFFSET,t)}),g(0,t,"_EmissionColorA",function(){return this._emissionColor.w},function(t){this._emissionColor.w=t,this.emissionColor=this._emissionColor}),g(0,t,"tilingOffsetX",function(){return this._MainTex_STX},function(t){this._MainTex_STX=t}),g(0,t,"specularColorA",function(){return this._SpecColorA},function(t){this._SpecColorA=t}),g(0,t,"_EmissionColorB",function(){return this._emissionColor.z},function(t){this._emissionColor.z=t,this.emissionColor=this._emissionColor}),g(0,t,"enableReflection",function(){return this._shaderValues.getBool(n.ENABLEREFLECT)},function(t){this._shaderValues.setBool(n.ENABLEREFLECT,!0),t?this._disablePublicDefineDatas.remove(Rs.SHADERDEFINE_REFLECTMAP):this._disablePublicDefineDatas.add(Rs.SHADERDEFINE_REFLECTMAP)}),g(0,t,"_BumpScale",function(){return this._shaderValues.getNumber(n.NORMALSCALE)},function(t){this._shaderValues.setNumber(n.NORMALSCALE,t)}),g(0,t,"albedoColor",function(){return this._albedoColor},function(t){this._albedoColor=t,this._shaderValues.setVector(n.ALBEDOCOLOR,t)}),g(0,t,"albedoColorR",function(){return this._ColorR},function(t){this._ColorR=t}),g(0,t,"_MainTex_STZ",function(){return this._shaderValues.getVector(n.TILINGOFFSET).z},function(t){var e=this._shaderValues.getVector(n.TILINGOFFSET);e.z=t,this.tilingOffset=e}),g(0,t,"specularColorG",function(){return this._SpecColorG},function(t){this._SpecColorG=t}),g(0,t,"_GlossMapScale",function(){return this._shaderValues.getNumber(n.SMOOTHNESSSCALE)},function(t){this._shaderValues.setNumber(n.SMOOTHNESSSCALE,t)}),g(0,t,"_ColorB",function(){return this._albedoColor.z},function(t){this._albedoColor.z=t,this.albedoColor=this._albedoColor}),g(0,t,"_EmissionColorR",function(){return this._emissionColor.x},function(t){this._emissionColor.x=t,this.emissionColor=this._emissionColor}),g(0,t,"_ColorR",function(){return this._albedoColor.x},function(t){this._albedoColor.x=t,this.albedoColor=this._albedoColor}),g(0,t,"_MainTex_STX",function(){return this._shaderValues.getVector(n.TILINGOFFSET).x},function(t){var e=this._shaderValues.getVector(n.TILINGOFFSET);e.x=t,this.tilingOffset=e}),g(0,t,"albedoColorA",function(){return this._ColorA},function(t){this._ColorA=t}),g(0,t,"_SpecColorR",function(){return this._specularColor.x},function(t){this._specularColor.x=t,this.specularColor=this._specularColor}),g(0,t,"albedoColorB",function(){return this._ColorB},function(t){this._ColorB=t}),g(0,t,"_EmissionColorG",function(){return this._emissionColor.y},function(t){this._emissionColor.y=t,this.emissionColor=this._emissionColor}),n.__init__=function(){n.SHADERDEFINE_ALBEDOTEXTURE=n.shaderDefines.registerDefine("ALBEDOTEXTURE"),n.SHADERDEFINE_SPECULARTEXTURE=n.shaderDefines.registerDefine("SPECULARTEXTURE"),n.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA=n.shaderDefines.registerDefine("SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA"),n.SHADERDEFINE_NORMALTEXTURE=n.shaderDefines.registerDefine("NORMALTEXTURE"),n.SHADERDEFINE_PARALLAXTEXTURE=n.shaderDefines.registerDefine("PARALLAXTEXTURE"),n.SHADERDEFINE_OCCLUSIONTEXTURE=n.shaderDefines.registerDefine("OCCLUSIONTEXTURE"),n.SHADERDEFINE_EMISSION=n.shaderDefines.registerDefine("EMISSION"),n.SHADERDEFINE_EMISSIONTEXTURE=n.shaderDefines.registerDefine("EMISSIONTEXTURE"),n.SHADERDEFINE_TILINGOFFSET=n.shaderDefines.registerDefine("TILINGOFFSET"),n.SHADERDEFINE_ALPHAPREMULTIPLY=n.shaderDefines.registerDefine("ALPHAPREMULTIPLY")},n.SmoothnessSource_SpecularTexture_Alpha=0,n.SmoothnessSource_AlbedoTexture_Alpha=1,n.RENDERMODE_OPAQUE=0,n.RENDERMODE_CUTOUT=1,n.RENDERMODE_FADE=2,n.RENDERMODE_TRANSPARENT=3,n.SHADERDEFINE_ALBEDOTEXTURE=0,n.SHADERDEFINE_NORMALTEXTURE=0,n.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA=0,n.SHADERDEFINE_SPECULARTEXTURE=0,n.SHADERDEFINE_OCCLUSIONTEXTURE=0,n.SHADERDEFINE_PARALLAXTEXTURE=0,n.SHADERDEFINE_EMISSION=0,n.SHADERDEFINE_EMISSIONTEXTURE=0,n.SHADERDEFINE_TILINGOFFSET=0,n.SHADERDEFINE_ALPHAPREMULTIPLY=0,n.SMOOTHNESSSOURCE=-1,n.ENABLEEMISSION=-1,n.ENABLEREFLECT=-1,E(n,["ALBEDOTEXTURE",function(){return this.ALBEDOTEXTURE=We.propertyNameToID("u_AlbedoTexture")},"SPECULARTEXTURE",function(){return this.SPECULARTEXTURE=We.propertyNameToID("u_SpecularTexture")},"NORMALTEXTURE",function(){return this.NORMALTEXTURE=We.propertyNameToID("u_NormalTexture")},"PARALLAXTEXTURE",function(){return this.PARALLAXTEXTURE=We.propertyNameToID("u_ParallaxTexture")},"OCCLUSIONTEXTURE",function(){return this.OCCLUSIONTEXTURE=We.propertyNameToID("u_OcclusionTexture")},"EMISSIONTEXTURE",function(){return this.EMISSIONTEXTURE=We.propertyNameToID("u_EmissionTexture")},"ALBEDOCOLOR",function(){return this.ALBEDOCOLOR=We.propertyNameToID("u_AlbedoColor")},"SPECULARCOLOR",function(){return this.SPECULARCOLOR=We.propertyNameToID("u_SpecularColor")},"EMISSIONCOLOR",function(){return this.EMISSIONCOLOR=We.propertyNameToID("u_EmissionColor")},"SMOOTHNESS",function(){return this.SMOOTHNESS=We.propertyNameToID("u_smoothness")},"SMOOTHNESSSCALE",function(){return this.SMOOTHNESSSCALE=We.propertyNameToID("u_smoothnessScale")},"OCCLUSIONSTRENGTH",function(){return this.OCCLUSIONSTRENGTH=We.propertyNameToID("u_occlusionStrength")},"NORMALSCALE",function(){return this.NORMALSCALE=We.propertyNameToID("u_normalScale")},"PARALLAXSCALE",function(){return this.PARALLAXSCALE=We.propertyNameToID("u_parallaxScale")},"TILINGOFFSET",function(){return this.TILINGOFFSET=We.propertyNameToID("u_TilingOffset")},"CULL",function(){return this.CULL=We.propertyNameToID("s_Cull")},"BLEND",function(){return this.BLEND=We.propertyNameToID("s_Blend")},"BLEND_SRC",function(){return this.BLEND_SRC=We.propertyNameToID("s_BlendSrc")},"BLEND_DST",function(){return this.BLEND_DST=We.propertyNameToID("s_BlendDst")},"DEPTH_TEST",function(){return this.DEPTH_TEST=We.propertyNameToID("s_DepthTest")},"DEPTH_WRITE",function(){return this.DEPTH_WRITE=We.propertyNameToID("s_DepthWrite")},"defaultMaterial",function(){return this.defaultMaterial=new n},"shaderDefines",function(){return this.shaderDefines=new ii(as.shaderDefines)}]),n}(as),Ps=function(h){function l(){this.focus=null,this._frameRate="fast",this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._safariOffsetY=0,this._frameStartTime=0,this._isFocused=!1,this._isVisibility=!1,this._wgColor=[0,0,0,1],this._scene3Ds=[],this._globalRepaintSet=!1,this._globalRepaintGet=!1,this._curUIBase=null,this.useRetinalCanvas=!1,l.__super.call(this),this.offset=new R,this._canvasTransform=new It,this._previousOrientation=Vt.window.orientation,this._3dUI=[];var e=this;this.transform=this._createTransform(),this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._setBit(128,!0),this._setBit(2,!0),this._isFocused=!0,this._isVisibility=!0,this.useRetinalCanvas=Tn.useRetinalCanvas;var t=Vt.window,i=this;t.addEventListener("focus",function(){e._isFocused=!0,i.event("focus"),i.event("focuschange")}),t.addEventListener("blur",function(){e._isFocused=!1,i.event("blur"),i.event("focuschange"),i._isInputting()&&(Ta.inputElement.target.focus=!1)});var n="visibilityState",r="visibilitychange",s=t.document;void 0!==s.hidden?(r="visibilitychange",n="visibilityState"):void 0!==s.mozHidden?(r="mozvisibilitychange",n="mozVisibilityState"):void 0!==s.msHidden?(r="msvisibilitychange",n="msVisibilityState"):void 0!==s.webkitHidden&&(r="webkitvisibilitychange",n="webkitVisibilityState"),t.document.addEventListener(r,function(){"hidden"==Vt.document[n]?(e._isVisibility=!1,i._isInputting()&&(Ta.inputElement.target.focus=!1)):e._isVisibility=!0;e.renderingEnabled=e._isVisibility,i.event("visibilitychange")}),t.addEventListener("resize",function(){var t=Vt.window.orientation;null!=t&&t!=e._previousOrientation&&i._isInputting()&&(Ta.inputElement.target.focus=!1),e._previousOrientation=t,i._isInputting()||(Vt.onSafari&&(i._safariOffsetY=(Vt.window.__innerHeight||Vt.document.body.clientHeight||Vt.document.documentElement.clientHeight)-Vt.window.innerHeight),i._resetCanvas())}),t.addEventListener("orientationchange",function(t){i._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),Vt.onMobile&&this.on("mousedown",this,this._onmouseMove)}I(l,"laya.display.Stage",h);var t=l.prototype;return t._isInputting=function(){return Vt.onMobile&&Ta.isInputting},t._changeCanvasSize=function(){this.setScreenSize(Vt.clientWidth*Vt.pixelRatio,Vt.clientHeight*Vt.pixelRatio)},t._resetCanvas=function(){this.screenAdaptationEnabled&&this._changeCanvasSize()},t.setScreenSize=function(t,e){var i=!1;if("none"!==this._screenMode&&(i=(t/e<1?"vertical":"horizontal")!==this._screenMode)){var n=e;e=t,t=n}this.canvasRotation=i;var r=qi._mainCanvas,s=r.source.style,a=this._canvasTransform.identity(),o=this._scaleMode,h=t/this.designWidth,l=e/this.designHeight,u=this.useRetinalCanvas?t:this.designWidth,c=this.useRetinalCanvas?e:this.designHeight,_=t,d=e,f=Vt.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,o){case"noscale":h=l=1,_=this.designWidth,d=this.designHeight;break;case"showall":h=l=Math.min(h,l),u=_=Math.round(this.designWidth*h),c=d=Math.round(this.designHeight*l);break;case"noborder":h=l=Math.max(h,l),_=Math.round(this.designWidth*h),d=Math.round(this.designHeight*l);break;case"full":h=l=1,this._width=u=t,this._height=c=e;break;case"fixedwidth":l=h,this._height=c=Math.round(e/h);break;case"fixedheight":h=l,this._width=u=Math.round(t/l);break;case"fixedauto":t/e<this.designWidth/this.designHeight?(l=h,this._height=c=Math.round(e/h)):(h=l,this._width=u=Math.round(t/l))}this.useRetinalCanvas&&(u=t,c=e),h*=this.scaleX,l*=this.scaleY,1===h&&1===l?this.transform.identity():(this.transform.a=this._formatData(h/(_/u)),this.transform.d=this._formatData(l/(d/c))),r.size(u,c),Ki.changeWebGLSize(u,c),a.scale(_/u/f,d/c/f),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=t-_:this.offset.x=.5*(t-_)/f,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=e-d:this.offset.y=.5*(e-d)/f,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),a.translate(this.offset.x,this.offset.y),this._safariOffsetY&&a.translate(0,this._safariOffsetY),this.canvasDegree=0,i&&("horizontal"===this._screenMode?(a.rotate(Math.PI/2),a.translate(e/f,0),this.canvasDegree=90):(a.rotate(-Math.PI/2),a.translate(0,t/f),this.canvasDegree=-90)),a.a=this._formatData(a.a),a.d=this._formatData(a.d),a.tx=this._formatData(a.tx),a.ty=this._formatData(a.ty),this.transform=this.transform,s.transformOrigin=s.webkitTransformOrigin=s.msTransformOrigin=s.mozTransformOrigin=s.oTransformOrigin="0px 0px 0px",s.transform=s.webkitTransform=s.msTransform=s.mozTransform=s.oTransform="matrix("+a.toString()+")",this._safariOffsetY&&a.translate(0,-this._safariOffsetY),a.translate(parseInt(s.left)||0,parseInt(s.top)||0),this.visible=!0,this._repaint|=2,this.event("resize")},t._formatData=function(t){return Math.abs(t)<1e-6?0:Math.abs(1-t)<.001?0<t?1:-1:t},t.getMousePoint=function(){return R.TEMP.setTo(this.mouseX,this.mouseY)},t.repaint=function(t){void 0===t&&(t=2),this._repaint|=t},t.parentRepaint=function(t){void 0===t&&(t=2)},t._loop=function(){return this._globalRepaintGet=this._globalRepaintSet,this._globalRepaintSet=!1,this.render(qi._context,0,0),!0},t.getFrameTm=function(){return this._frameStartTime},t._onmouseMove=function(t){this._mouseMoveTime=Vt.now()},t.getTimeFromFrameStart=function(){return Vt.now()-this._frameStartTime},t.render=function(t,e,i){if(l._dbgSprite.graphics.clear(),"sleep"===this._frameRate){var n=Vt.now();if(!(1e3<=n-this._frameStartTime))return;this._frameStartTime=n}else{if(!this._visible)return this._renderCount++,void(this._renderCount%5==0&&(Ri.I._update(),$i.loopCount++,this._updateTimers()));this._frameStartTime=Vt.now()}this._renderCount++;var r="slow"!==("mouse"===this._frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate),s=this._renderCount%2==0;if($i.renderSlow=!r,(r||s)&&(Ri.I._update(),$i.loopCount++,this.renderingEnabled)){for(var a=0,o=this._scene3Ds.length;a<o;a++)this._scene3Ds[a]._update();t.clear(),h.prototype.render.call(this,t,e,i),$i._show&&$i._sp&&$i._sp.render(t,e,i)}l._dbgSprite.render(t,0,0),!r&&s||(this.renderingEnabled&&(Ki.clear(this._bgColor),t.flush(),pt.instance&&pt.getInstance().endDispose()),this._updateTimers())},t.renderToNative=function(t,e,i){if(this._renderCount++,this._visible){if(Ri.I._update(),$i.loopCount++,this.renderingEnabled){for(var n=0,r=this._scene3Ds.length;n<r;n++)this._scene3Ds[n]._update();t.clear(),h.prototype.render.call(this,t,e,i),$i._show&&$i._sp&&$i._sp.render(t,e,i)}this.renderingEnabled&&(Ki.clear(this._bgColor),t.flush(),pt.instance&&pt.getInstance().endDispose()),this._updateTimers()}else this._renderCount%5==0&&(Ri.I._update(),$i.loopCount++,this._updateTimers())},t._updateTimers=function(){T.systemTimer._update(),T.startTimer._update(),T.physicsTimer._update(),T.updateTimer._update(),T.lateTimer._update(),T.timer._update()},t._requestFullscreen=function(){var t=Vt.document.documentElement;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()},t._fullScreenChanged=function(){T.stage.event("fullscreenchange")},t.exitFullscreen=function(){var t=Vt.document;t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitExitFullscreen&&t.webkitExitFullscreen()},t.isGlobalRepaint=function(){return this._globalRepaintGet},t.setGlobalRepaint=function(){this._globalRepaintSet=!0},t.add3DUI=function(t){var e=t.rootView;0<=this._3dUI.indexOf(e)||this._3dUI.push(e)},t.remove3DUI=function(t){var e=t.rootView,i=this._3dUI.indexOf(e);return 0<=i&&(this._3dUI.splice(i,1),!0)},g(0,t,"frameRate",function(){return qi.isConchApp?this._frameRateNative:this._frameRate},function(t){if(qi.isConchApp){switch(t){case"fast":m.conch.config.setLimitFPS(60);break;case"mouse":m.conch.config.setMouseFrame(2e3);break;case"slow":m.conch.config.setSlowFrame(!0);break;case"sleep":m.conch.config.setLimitFPS(1)}this._frameRateNative=t}else this._frameRate=t}),g(0,t,"fullScreenEnabled",null,function(t){var e=Vt.document,i=qi.canvas;t?(i.addEventListener("mousedown",this._requestFullscreen),i.addEventListener("touchstart",this._requestFullscreen),e.addEventListener("fullscreenchange",this._fullScreenChanged),e.addEventListener("mozfullscreenchange",this._fullScreenChanged),e.addEventListener("webkitfullscreenchange",this._fullScreenChanged),e.addEventListener("msfullscreenchange",this._fullScreenChanged)):(i.removeEventListener("mousedown",this._requestFullscreen),i.removeEventListener("touchstart",this._requestFullscreen),e.removeEventListener("fullscreenchange",this._fullScreenChanged),e.removeEventListener("mozfullscreenchange",this._fullScreenChanged),e.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),e.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),g(0,t,"screenMode",function(){return this._screenMode},function(t){this._screenMode=t}),g(0,t,"mouseX",function(){return Math.round(wi.instance.mouseX/this.clientScaleX)}),g(0,t,"bgColor",function(){return this._bgColor},function(t){this._bgColor=t,this._wgColor=t?f.create(t).arrColor:null,Vt.onLimixiu?this._wgColor=f.create(t).arrColor:qi.canvas.style.background=t||"none"}),g(0,t,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),g(0,t,"width",h.prototype._$get_width,function(t){this.designWidth=t,T.superSet(ts,this,"width",t),T.systemTimer.callLater(this,this._changeCanvasSize)}),g(0,t,"mouseY",function(){return Math.round(wi.instance.mouseY/this.clientScaleY)}),g(0,t,"visible",h.prototype._$get_visible,function(t){this.visible!==t&&(T.superSet(ts,this,"visible",t),qi._mainCanvas.source.style.visibility=t?"visible":"hidden")}),g(0,t,"alignH",function(){return this._alignH},function(t){this._alignH=t,T.systemTimer.callLater(this,this._changeCanvasSize)}),g(0,t,"alignV",function(){return this._alignV},function(t){this._alignV=t,T.systemTimer.callLater(this,this._changeCanvasSize)}),g(0,t,"scaleMode",function(){return this._scaleMode},function(t){this._scaleMode=t,T.systemTimer.callLater(this,this._changeCanvasSize)}),g(0,t,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),g(0,t,"isVisibility",function(){return this._isVisibility}),g(0,t,"isFocused",function(){return this._isFocused}),g(0,t,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||this._createTransform()},h.prototype._$set_transform),g(0,t,"height",h.prototype._$get_height,function(t){this.designHeight=t,T.superSet(ts,this,"height",t),T.systemTimer.callLater(this,this._changeCanvasSize)}),l.SCALE_NOSCALE="noscale",l.SCALE_EXACTFIT="exactfit",l.SCALE_SHOWALL="showall",l.SCALE_NOBORDER="noborder",l.SCALE_FULL="full",l.SCALE_FIXED_WIDTH="fixedwidth",l.SCALE_FIXED_HEIGHT="fixedheight",l.SCALE_FIXED_AUTO="fixedauto",l.ALIGN_LEFT="left",l.ALIGN_RIGHT="right",l.ALIGN_CENTER="center",l.ALIGN_TOP="top",l.ALIGN_MIDDLE="middle",l.ALIGN_BOTTOM="bottom",l.SCREEN_NONE="none",l.SCREEN_HORIZONTAL="horizontal",l.SCREEN_VERTICAL="vertical",l.FRAME_FAST="fast",l.FRAME_SLOW="slow",l.FRAME_MOUSE="mouse",l.FRAME_SLEEP="sleep",E(l,["_dbgSprite",function(){return this._dbgSprite=new ts}]),l}(ts),Fs=function(t){function e(){this._sunDisk=0,e.__super.call(this),this.setShaderName("SkyBoxProcedural"),this.sunDisk=1,this.sunSize=.04,this.sunSizeConvergence=5,this.atmosphereThickness=1,this.skyTint=new on(.5,.5,.5,1),this.groundTint=new on(.369,.349,.341,1),this.exposure=1.3}I(e,"laya.d3.core.material.SkyProceduralMaterial",as);var i=e.prototype;return g(0,i,"exposure",function(){return this._shaderValues.getNumber(e.EXPOSURE)},function(t){t=Math.min(Math.max(0,t),8),this._shaderValues.setNumber(e.EXPOSURE,t)}),g(0,i,"atmosphereThickness",function(){return this._shaderValues.getNumber(e.ATMOSPHERETHICKNESS)},function(t){t=Math.min(Math.max(0,t),5),this._shaderValues.setNumber(e.ATMOSPHERETHICKNESS,t)}),g(0,i,"skyTint",function(){return this._shaderValues.getVector(e.SKYTINT)},function(t){this._shaderValues.setVector(e.SKYTINT,t)}),g(0,i,"sunSizeConvergence",function(){return this._shaderValues.getNumber(e.SUNSIZECONVERGENCE)},function(t){t=Math.min(Math.max(0,t),20),this._shaderValues.setNumber(e.SUNSIZECONVERGENCE,t)}),g(0,i,"sunSize",function(){return this._shaderValues.getNumber(e.SUNSIZE)},function(t){t=Math.min(Math.max(0,t),1),this._shaderValues.setNumber(e.SUNSIZE,t)}),g(0,i,"groundTint",function(){return this._shaderValues.getVector(e.GROUNDTINT)},function(t){this._shaderValues.setVector(e.GROUNDTINT,t)}),g(0,i,"sunDisk",function(){return this._sunDisk},function(t){switch(t){case 1:this._defineDatas.remove(e.SHADERDEFINE_SUN_SIMPLE),this._defineDatas.add(e.SHADERDEFINE_SUN_HIGH_QUALITY);break;case 2:this._defineDatas.remove(e.SHADERDEFINE_SUN_HIGH_QUALITY),this._defineDatas.add(e.SHADERDEFINE_SUN_SIMPLE);break;case 0:this._defineDatas.remove(e.SHADERDEFINE_SUN_HIGH_QUALITY),this._defineDatas.remove(e.SHADERDEFINE_SUN_SIMPLE);break;default:throw"SkyBoxProceduralMaterial: unknown sun value."}this._sunDisk=t}),e.__init__=function(){e.SHADERDEFINE_SUN_HIGH_QUALITY=e.shaderDefines.registerDefine("SUN_HIGH_QUALITY"),e.SHADERDEFINE_SUN_SIMPLE=e.shaderDefines.registerDefine("SUN_SIMPLE")},e.SUN_NODE=0,e.SUN_HIGH_QUALITY=1,e.SUN_SIMPLE=2,e.SHADERDEFINE_SUN_HIGH_QUALITY=0,e.SHADERDEFINE_SUN_SIMPLE=0,E(e,["SUNSIZE",function(){return this.SUNSIZE=We.propertyNameToID("u_SunSize")},"SUNSIZECONVERGENCE",function(){return this.SUNSIZECONVERGENCE=We.propertyNameToID("u_SunSizeConvergence")},"ATMOSPHERETHICKNESS",function(){return this.ATMOSPHERETHICKNESS=We.propertyNameToID("u_AtmosphereThickness")},"SKYTINT",function(){return this.SKYTINT=We.propertyNameToID("u_SkyTint")},"GROUNDTINT",function(){return this.GROUNDTINT=We.propertyNameToID("u_GroundTint")},"EXPOSURE",function(){return this.EXPOSURE=We.propertyNameToID("u_Exposure")},"defaultMaterial",function(){return this.defaultMaterial=new e},"shaderDefines",function(){return this.shaderDefines=new ii(as.shaderDefines)}]),e}(),Bs=function(s){function a(t,e){this.curved=0,a.__super.call(this),this._skyRenderer=new bt,this._forward=new ln,this._up=new ln,this.clearColor=new on(100/255,149/255,237/255,1),void 0===t&&(t=.3),void 0===e&&(e=1e3),this._shaderValues=new xe(null),this._fieldOfView=60,this._useUserProjectionMatrix=!1,this._orthographic=!1,this._orthographicVerticalSize=10,this.renderingOrder=0,this._nearPlane=t,this._farPlane=e,this.cullingMask=2147483647,this.clearFlag=0,this.useOcclusionCulling=!0,this._calculateProjectionMatrix(),T.stage.on("resize",this,this._onScreenSizeChanged)}I(a,"laya.d3.core.BaseCamera",s);var t=a.prototype;return t._sortCamerasByRenderingOrder=function(){if(this.displayedInStage)for(var t=this.scene._cameraPool,e=t.length-1,i=0;i<e;i++)if(t[i].renderingOrder>t[e].renderingOrder){var n=t[i];t[i]=t[e],t[e]=n}},t._calculateProjectionMatrix=function(){},t._onScreenSizeChanged=function(){this._calculateProjectionMatrix()},t._prepareCameraToRender=function(){this.transform.getForward(this._forward),this.transform.getUp(this._up);var t=this._shaderValues;t.setVector3(laya.d3.core.BaseCamera.CAMERAPOS,this.transform.position),t.setVector3(laya.d3.core.BaseCamera.CAMERADIRECTION,this._forward),t.setVector3(laya.d3.core.BaseCamera.CAMERAUP,this._up),t.setNumber(a.CURVE,this.curved)},t._prepareCameraViewProject=function(t,e,i,n){var r=this._shaderValues;r.setMatrix4x4(laya.d3.core.BaseCamera.VIEWMATRIX,t),r.setMatrix4x4(laya.d3.core.BaseCamera.PROJECTMATRIX,e),r.setMatrix4x4(laya.d3.core.BaseCamera.VIEWPROJECTMATRIX,i),this.transform.worldMatrix.cloneTo(a._tempMatrix4x40),a._tempMatrix4x40.transpose(),gt.multiply(e,a._tempMatrix4x40,n),r.setMatrix4x4(laya.d3.core.BaseCamera.VPMATRIX_NO_TRANSLATE,n)},t.render=function(t,e){},t.addLayer=function(t){this.cullingMask|=Math.pow(2,t)},t.removeLayer=function(t){this.cullingMask&=~Math.pow(2,t)},t.addAllLayers=function(){this.cullingMask=2147483647},t.removeAllLayers=function(){this.cullingMask=0},t.resetProjectionMatrix=function(){this._useUserProjectionMatrix=!1,this._calculateProjectionMatrix()},t._onActive=function(){this._scene._addCamera(this),laya.display.Node.prototype._onActive.call(this)},t._onInActive=function(){this._scene._removeCamera(this),laya.display.Node.prototype._onInActive.call(this)},t._parse=function(t,e){s.prototype._parse.call(this,t,e);var i=t.clearFlag;void 0!==i&&(this.clearFlag=i),this.orthographic=t.orthographic,this.fieldOfView=t.fieldOfView,this.nearPlane=t.nearPlane,this.farPlane=t.farPlane;var n=t.clearColor;this.clearColor=new on(n[0],n[1],n[2],n[3]);var r=t.skyboxMaterial;r&&(this._skyRenderer.material=Hn.getRes(r.path))},t.destroy=function(t){void 0===t&&(t=!0),this._skyRenderer.destroy(),this._skyRenderer=null,T.stage.off("resize",this,this._onScreenSizeChanged),s.prototype.destroy.call(this,t)},g(0,t,"renderingOrder",function(){return this._renderingOrder},function(t){this._renderingOrder=t,this._sortCamerasByRenderingOrder()}),g(0,t,"orthographic",function(){return this._orthographic},function(t){this._orthographic=t,this._calculateProjectionMatrix()}),g(0,t,"farPlane",function(){return this._farPlane},function(t){this._farPlane=t,this._calculateProjectionMatrix()}),g(0,t,"nearPlane",function(){return this._nearPlane},function(t){this._nearPlane=t,this._calculateProjectionMatrix()}),g(0,t,"orthographicVerticalSize",function(){return this._orthographicVerticalSize},function(t){this._orthographicVerticalSize=t,this._calculateProjectionMatrix()}),g(0,t,"fieldOfView",function(){return this._fieldOfView},function(t){this._fieldOfView=t,this._calculateProjectionMatrix()}),g(0,t,"skyRenderer",function(){return this._skyRenderer}),a.RENDERINGTYPE_DEFERREDLIGHTING="DEFERREDLIGHTING",a.RENDERINGTYPE_FORWARDRENDERING="FORWARDRENDERING",a.CLEARFLAG_SOLIDCOLOR=0,a.CLEARFLAG_SKY=1,a.CLEARFLAG_DEPTHONLY=2,a.CLEARFLAG_NONE=3,E(a,["_tempMatrix4x40",function(){return this._tempMatrix4x40=new gt},"CAMERAPOS",function(){return this.CAMERAPOS=We.propertyNameToID("u_CameraPos")},"VIEWMATRIX",function(){return this.VIEWMATRIX=We.propertyNameToID("u_View")},"PROJECTMATRIX",function(){return this.PROJECTMATRIX=We.propertyNameToID("u_Projection")},"VIEWPROJECTMATRIX",function(){return this.VIEWPROJECTMATRIX=We.propertyNameToID("u_ViewProjection")},"VPMATRIX_NO_TRANSLATE",function(){return this.VPMATRIX_NO_TRANSLATE=We.propertyNameToID("u_MvpMatrix")},"CAMERADIRECTION",function(){return this.CAMERADIRECTION=We.propertyNameToID("u_CameraDirection")},"CAMERAUP",function(){return this.CAMERAUP=We.propertyNameToID("u_CameraUp")},"CURVE",function(){return this.CURVE=We.propertyNameToID("u_Curved")},"_invertYScaleMatrix",function(){return this._invertYScaleMatrix=new gt(1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1)},"_invertYProjectionMatrix",function(){return this._invertYProjectionMatrix=new gt},"_invertYProjectionViewMatrix",function(){return this._invertYProjectionViewMatrix=new gt}]),a}(es),Vs=function(t){function e(){this.lockLayer=null,this.popupEffect=function(t){t.scale(1,1),t._effectTween=Ii.from(t,{x:T.stage.width/2,y:T.stage.height/2,scaleX:0,scaleY:0},300,Ue.backOut,y.create(this,this.doOpen,[t]),0,!1,!1)},this.closeEffect=function(t){t._effectTween=Ii.to(t,{x:T.stage.width/2,y:T.stage.height/2,scaleX:0,scaleY:0},300,Ue.strongOut,y.create(this,this.doClose,[t]),0,!1,!1)},e.__super.call(this),this.maskLayer=new ts,this.popupEffectHandler=new y(this,this.popupEffect),this.closeEffectHandler=new y(this,this.closeEffect),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,T.stage.addChild(this),T.stage.on("resize",this,this._onResize),qe.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}I(e,"laya.ui.DialogManager",ts);var i=e.prototype;return i._closeOnSide=function(){var t=this.getChildAt(this.numChildren-1);t instanceof laya.ui.Dialog&&t.close()},i.setLockView=function(t){this.lockLayer||(this.lockLayer=new Qs,this.lockLayer.mouseEnabled=!0,this.lockLayer.size(T.stage.width,T.stage.height)),this.lockLayer.removeChildren(),t&&(t.centerX=t.centerY=0,this.lockLayer.addChild(t))},i._onResize=function(t){var e=this.maskLayer.width=T.stage.width,i=this.maskLayer.height=T.stage.height;this.lockLayer&&this.lockLayer.size(e,i),this.maskLayer.graphics.clear(!0),this.maskLayer.graphics.drawRect(0,0,e,i,qe.popupBgColor),this.maskLayer.alpha=qe.popupBgAlpha;for(var n=this.numChildren-1;-1<n;n--){var r=this.getChildAt(n);r.isPopupCenter&&this._centerDialog(r)}},i._centerDialog=function(t){t.x=Math.round((T.stage.width-t.width>>1)+t.pivotX),t.y=Math.round((T.stage.height-t.height>>1)+t.pivotY)},i.open=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1),e&&this._closeAll(),this._clearDialogEffect(t),t.isPopupCenter&&this._centerDialog(t),this.addChild(t),(t.isModal||this._getBit(32))&&T.timer.callLater(this,this._checkMask),i&&null!=t.popupEffect?t.popupEffect.runWith(t):this.doOpen(t),this.event("open")},i._clearDialogEffect=function(t){t._effectTween&&(Ii.clear(t._effectTween),t._effectTween=null)},i.doOpen=function(t){t.onOpened(t._param)},i.lock=function(t){this.lockLayer&&(t?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},i.close=function(t){this._clearDialogEffect(t),t.isShowEffect&&null!=t.closeEffect?t.closeEffect.runWith([t]):this.doClose(t),this.event("close")},i.doClose=function(t){t.removeSelf(),t.isModal&&this._checkMask(),t.closeHandler&&t.closeHandler.runWith(t.closeType),t.onClosed(t.closeType),t.autoDestroyAtClosed&&t.destroy()},i.closeAll=function(){this._closeAll(),this.event("close")},i._closeAll=function(){for(var t=this.numChildren-1;-1<t;t--){var e=this.getChildAt(t);e&&null!=e.close&&this.doClose(e)}},i.getDialogsByGroup=function(t){for(var e=[],i=this.numChildren-1;-1<i;i--){var n=this.getChildAt(i);n&&n.group===t&&e.push(n)}return e},i.closeByGroup=function(t){for(var e=[],i=this.numChildren-1;-1<i;i--){var n=this.getChildAt(i);n&&n.group===t&&(n.close(),e.push(n))}return e},i._checkMask=function(){this.maskLayer.removeSelf();for(var t=this.numChildren-1;-1<t;t--){var e=this.getChildAt(t);if(e&&e.isModal)return void this.addChildAt(this.maskLayer,t)}},e}(),Us=(function(r){function s(t,e){this._isKinematic=!1,this._mass=1,this._angularDamping=0,this._linearDamping=0,this._overrideGravity=!1,this._detectCollisions=!0,this._gravity=new ln(0,-10,0),this._totalTorque=new ln(0,0,0),this._linearVelocity=new ln,this._angularVelocity=new ln,this._linearFactor=new ln(1,1,1),this._angularFactor=new ln(1,1,1),void 0===t&&(t=1),void 0===e&&(e=$t.COLLISIONFILTERGROUP_ALLFILTER),s.__super.call(this,t,e)}I(s,"laya.d3.physics.Rigidbody3D",r);var t=s.prototype;t._updateMass=function(t){this._nativeColliderObject&&this._colliderShape&&(this._colliderShape._nativeShape.calculateLocalInertia(t,s._nativeInertia),this._nativeColliderObject.setMassProps(t,s._nativeInertia),this._nativeColliderObject.updateInertiaTensor())},t._delegateMotionStateGetWorldTransform=function(t){},t._delegateMotionStateSetWorldTransform=function(t){var e=this._rigidbody;e._simulation._updatedRigidbodies++;var i=In._physics3D,n=i.wrapPointer(t,i.btTransform);e._updateTransformComponent(n)},t._delegateMotionStateGetWorldTransformNative=function(t,e){},t._delegateMotionStateSetWorldTransformNative=function(t,e){var i=t;i._simulation._updatedRigidbodies++;var n=In._physics3D,r=n.wrapPointer(e,n.btTransform);i._updateTransformComponent(r)},t._onScaleChange=function(t){laya.d3.physics.PhysicsComponent.prototype._onScaleChange.call(this,t),this._updateMass(this._isKinematic?0:this._mass)},t._delegateMotionStateClear=function(){this._rigidbody=null},t._onAdded=function(){var t=In._physics3D,e=new t.LayaMotionState;null!=m.conch&&t.LayaMotionState.prototype.setRigidbody?(e.setRigidbody(this),e.setNativeGetWorldTransform(this._delegateMotionStateGetWorldTransformNative),e.setNativeSetWorldTransform(this._delegateMotionStateSetWorldTransformNative)):(e.getWorldTransform=this._delegateMotionStateGetWorldTransform,e.setWorldTransform=this._delegateMotionStateSetWorldTransform),e.clear=this._delegateMotionStateClear,(e._rigidbody=this)._nativeMotionState=e;var i=new t.btRigidBodyConstructionInfo(0,e,null,s._nativeVector3Zero),n=new t.btRigidBody(i);n.setUserIndex(this.id),this._nativeColliderObject=n,r.prototype._onAdded.call(this),this.mass=this._mass,this.linearFactor=this._linearFactor,this.angularFactor=this._angularFactor,this.linearDamping=this._linearDamping,this.angularDamping=this._angularDamping,this.overrideGravity=this._overrideGravity,this.gravity=this._gravity,this.isKinematic=this._isKinematic,t.destroy(i)},t._onShapeChange=function(t){laya.d3.physics.PhysicsComponent.prototype._onShapeChange.call(this,t),this._isKinematic?this._updateMass(0):(this._nativeColliderObject.setCenterOfMassTransform(this._nativeColliderObject.getWorldTransform()),this._updateMass(this._mass))},t._parse=function(t){null!=t.friction&&(this.friction=t.friction),null!=t.rollingFriction&&(this.rollingFriction=t.rollingFriction),null!=t.restitution&&(this.restitution=t.restitution),null!=t.isTrigger&&(this.isTrigger=t.isTrigger),null!=t.mass&&(this.mass=t.mass),null!=t.isKinematic&&(this.isKinematic=t.isKinematic),null!=t.linearDamping&&(this.linearDamping=t.linearDamping),null!=t.angularDamping&&(this.angularDamping=t.angularDamping),null!=t.overrideGravity&&(this.overrideGravity=t.overrideGravity),t.gravity&&(this.gravity.fromArray(t.gravity),this.gravity=this.gravity),laya.d3.physics.PhysicsComponent.prototype._parse.call(this,t),this._parseShape(t.shapes)},t._onDestroy=function(){var t=In._physics3D;this._nativeMotionState.clear(),t.destroy(this._nativeMotionState),laya.d3.physics.PhysicsComponent.prototype._onDestroy.call(this),this._nativeMotionState=null,this._gravity=null,this._totalTorque=null,this._linearVelocity=null,this._angularVelocity=null,this._linearFactor=null,this._angularFactor=null},t._addToSimulation=function(){this._simulation._addRigidBody(this,this._collisionGroup,this._detectCollisions?this._canCollideWith:0)},t._removeFromSimulation=function(){this._simulation._removeRigidBody(this)},t._cloneTo=function(t){r.prototype._cloneTo.call(this,t);var e=t;e.isKinematic=this._isKinematic,e.mass=this._mass,e.gravity=this._gravity,e.angularDamping=this._angularDamping,e.linearDamping=this._linearDamping,e.overrideGravity=this._overrideGravity,e.linearVelocity=this._linearVelocity,e.angularVelocity=this._angularVelocity,e.linearFactor=this._linearFactor,e.angularFactor=this._angularFactor,e.detectCollisions=this._detectCollisions},t.applyForce=function(t,e){if(null==this._nativeColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var i=s._nativeTempVector30;if(i.setValue(-t.x,t.y,t.z),e){var n=s._nativeTempVector31;n.setValue(-e.x,e.y,e.z),this._nativeColliderObject.applyForce(i,n)}else this._nativeColliderObject.applyCentralForce(i)},t.applyTorque=function(t){if(null==this._nativeColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var e=s._nativeTempVector30;e.setValue(-t.x,t.y,t.z),this._nativeColliderObject.applyTorque(e)},t.applyImpulse=function(t,e){if(null==this._nativeColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";s._nativeImpulse.setValue(-t.x,t.y,t.z),e?(s._nativeImpulseOffset.setValue(-e.x,e.y,e.z),this._nativeColliderObject.applyImpulse(s._nativeImpulse,s._nativeImpulseOffset)):this._nativeColliderObject.applyCentralImpulse(s._nativeImpulse)},t.applyTorqueImpulse=function(t){if(null==this._nativeColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var e=s._nativeTempVector30;e.setValue(-t.x,t.y,t.z),this._nativeColliderObject.applyTorqueImpulse(e)},t.wakeUp=function(){this._nativeColliderObject&&this._nativeColliderObject.activate(!1)},t.clearForces=function(){var t=this._nativeColliderObject;if(null==t)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";t.clearForces();var e=s._nativeVector3Zero;t.setInterpolationAngularVelocity(e),t.setLinearVelocity(e),t.setInterpolationAngularVelocity(e),t.setAngularVelocity(e)},g(0,t,"isSleeping",function(){return!!this._nativeColliderObject&&2===this._nativeColliderObject.getActivationState()}),g(0,t,"detectCollisions",function(){return this._detectCollisions},function(t){this._detectCollisions!==t&&(this._detectCollisions=t,this._colliderShape&&this._enabled&&this._simulation&&(this._simulation._removeRigidBody(this),this._simulation._addRigidBody(this,this._collisionGroup,t?this._canCollideWith:0)))}),g(0,t,"totalTorque",function(){if(this._nativeColliderObject){var t=this._nativeColliderObject.getTotalTorque(),e=this._totalTorque;e.x=-t.x,e.y=t.y,e.z=t.z}return null}),g(0,t,"mass",function(){return this._mass},function(t){t=Math.max(t,1e-7),this._mass=t,this._isKinematic||this._updateMass(t)}),g(0,t,"angularFactor",function(){return this._nativeColliderObject?this._angularFactor:null},function(t){if(this._angularFactor=t,this._nativeColliderObject){var e=s._nativeTempVector30;V._convertToBulletVec3(t,e,!1),this._nativeColliderObject.setAngularFactor(e)}}),g(0,t,"angularVelocity",function(){return this._nativeColliderObject&&V._convertToLayaVec3(this._nativeColliderObject.getAngularVelocity(),this._angularVelocity,!0),this._angularVelocity},function(t){if(this._angularVelocity=t,this._nativeColliderObject){var e=s._nativeTempVector30;V._convertToBulletVec3(t,e,!0),this.isSleeping&&this.wakeUp(),this._nativeColliderObject.setAngularVelocity(e)}}),g(0,t,"linearVelocity",function(){return this._nativeColliderObject&&V._convertToLayaVec3(this._nativeColliderObject.getLinearVelocity(),this._linearVelocity,!0),this._linearVelocity},function(t){if(this._linearVelocity=t,this._nativeColliderObject){var e=s._nativeTempVector30;V._convertToBulletVec3(t,e,!0),this.isSleeping&&this.wakeUp(),this._nativeColliderObject.setLinearVelocity(e)}}),g(0,t,"totalForce",function(){return this._nativeColliderObject?this._nativeColliderObject.getTotalForce():null}),g(0,t,"angularDamping",function(){return this._angularDamping},function(t){this._angularDamping=t,this._nativeColliderObject&&this._nativeColliderObject.setDamping(this._linearDamping,t)}),g(0,t,"linearDamping",function(){return this._linearDamping},function(t){this._linearDamping=t,this._nativeColliderObject&&this._nativeColliderObject.setDamping(t,this._angularDamping)}),g(0,t,"linearFactor",function(){return this._nativeColliderObject?this._linearFactor:null},function(t){if(this._linearFactor=t,this._nativeColliderObject){var e=s._nativeTempVector30;V._convertToBulletVec3(t,e,!1),this._nativeColliderObject.setLinearFactor(e)}}),g(0,t,"sleepLinearVelocity",function(){return this._nativeColliderObject.getLinearSleepingThreshold()},function(t){this._nativeColliderObject.setSleepingThresholds(t,this._nativeColliderObject.getAngularSleepingThreshold())}),g(0,t,"isKinematic",function(){return this._isKinematic},function(t){this._isKinematic=t;var e=!!(this._simulation&&this._enabled&&this._colliderShape);e&&this._removeFromSimulation();var i=this._nativeColliderObject,n=i.getCollisionFlags();t?(n|=2,i.setCollisionFlags(n),this._nativeColliderObject.forceActivationState(4),this._enableProcessCollisions=!1,this._updateMass(0)):(0<(2&n)&&(n^=2),i.setCollisionFlags(n),this._nativeColliderObject.setActivationState(1),this._enableProcessCollisions=!0,this._updateMass(this._mass));var r=s._nativeVector3Zero;i.setInterpolationLinearVelocity(r),i.setLinearVelocity(r),i.setInterpolationAngularVelocity(r),i.setAngularVelocity(r),e&&this._addToSimulation()}),g(0,t,"gravity",function(){return this._gravity},function(t){this._gravity=t,s._nativeGravity.setValue(-t.x,t.y,t.z),this._nativeColliderObject.setGravity(s._nativeGravity)}),g(0,t,"sleepAngularVelocity",function(){return this._nativeColliderObject.getAngularSleepingThreshold()},function(t){this._nativeColliderObject.setSleepingThresholds(this._nativeColliderObject.getLinearSleepingThreshold(),t)}),g(0,t,"overrideGravity",function(){return this._overrideGravity},function(t){if(this._overrideGravity=t,this._nativeColliderObject){var e=this._nativeColliderObject.getFlags();t?0==(1&e)&&this._nativeColliderObject.setFlags(1|e):0<(1&e)&&this._nativeColliderObject.setFlags(1^e)}}),s.TYPE_STATIC=0,s.TYPE_DYNAMIC=1,s.TYPE_KINEMATIC=2,s._BT_DISABLE_WORLD_GRAVITY=1,s._BT_ENABLE_GYROPSCOPIC_FORCE=2,E(s,["_nativeTempVector30",function(){return this._nativeTempVector30=new In._physics3D.btVector3(0,0,0)},"_nativeTempVector31",function(){return this._nativeTempVector31=new In._physics3D.btVector3(0,0,0)},"_nativeVector3Zero",function(){return this._nativeVector3Zero=new In._physics3D.btVector3(0,0,0)},"_nativeInertia",function(){return this._nativeInertia=new In._physics3D.btVector3(0,0,0)},"_nativeImpulse",function(){return this._nativeImpulse=new In._physics3D.btVector3(0,0,0)},"_nativeImpulseOffset",function(){return this._nativeImpulseOffset=new In._physics3D.btVector3(0,0,0)},"_nativeGravity",function(){return this._nativeGravity=new In._physics3D.btVector3(0,0,0)}])}(ls),function(t){function e(){e.__super.call(this),this.setShaderName("LineShader"),this._shaderValues.setVector(e.COLOR,new on(1,1,1,1))}I(e,"laya.d3.core.pixelLine.PixelLineMaterial",as);var i=e.prototype;return g(0,i,"blend",function(){return this._shaderValues.getInt(e.BLEND)},function(t){this._shaderValues.setInt(e.BLEND,t)}),g(0,i,"cull",function(){return this._shaderValues.getInt(e.CULL)},function(t){this._shaderValues.setInt(e.CULL,t)}),g(0,i,"depthWrite",function(){return this._shaderValues.getBool(e.DEPTH_WRITE)},function(t){this._shaderValues.setBool(e.DEPTH_WRITE,t)}),g(0,i,"blendDst",function(){return this._shaderValues.getInt(e.BLEND_DST)},function(t){this._shaderValues.setInt(e.BLEND_DST,t)}),g(0,i,"blendSrc",function(){return this._shaderValues.getInt(e.BLEND_SRC)},function(t){this._shaderValues.setInt(e.BLEND_SRC,t)}),g(0,i,"depthTest",function(){return this._shaderValues.getInt(e.DEPTH_TEST)},function(t){this._shaderValues.setInt(e.DEPTH_TEST,t)}),g(0,i,"color",function(){return this._shaderValues.getVector(e.COLOR)},function(t){this._shaderValues.setVector(e.COLOR,t)}),E(e,["COLOR",function(){return this.COLOR=We.propertyNameToID("u_Color")},"defaultMaterial",function(){return this.defaultMaterial=new e},"shaderDefines",function(){return this.shaderDefines=new ii(as.shaderDefines)},"CULL",function(){return this.CULL=We.propertyNameToID("s_Cull")},"BLEND",function(){return this.BLEND=We.propertyNameToID("s_Blend")},"BLEND_SRC",function(){return this.BLEND_SRC=We.propertyNameToID("s_BlendSrc")},"BLEND_DST",function(){return this.BLEND_DST=We.propertyNameToID("s_BlendDst")},"DEPTH_TEST",function(){return this.DEPTH_TEST=We.propertyNameToID("s_DepthTest")},"DEPTH_WRITE",function(){return this.DEPTH_WRITE=We.propertyNameToID("s_DepthWrite")}]),e}()),zs=function(o){function r(t){this._bones=[],this._skinnedDataLoopMarks=[],this._localBounds=new Mn(ln._ZERO,ln._ZERO),this._cacheAnimationNode=[],r.__super.call(this,t)}I(r,"laya.d3.core.SkinnedMeshRenderer",o);var t=r.prototype;return t._computeSkinnedData=function(){if(this._cacheMesh&&this._cacheAvatar||this._cacheMesh&&this._cacheRootBone)for(var t=this._cacheMesh._inverseBindPoses,e=this._cacheMesh._bindPoseIndices,i=this._cacheMesh._skinDataPathMarks,n=0,r=this._cacheMesh.subMeshCount;n<r;n++)for(var s=this._cacheMesh._getSubMesh(n)._boneIndicesList,a=this._skinnedData[n],o=0,h=s.length;o<h;o++){var l=s[o];qi.supportWebGLPlusAnimation?this._computeSubSkinnedDataNative(this._cacheAnimator._animationNodeWorldMatrixs,this._cacheAnimationNodeIndices,this._cacheMesh._inverseBindPosesBuffer,l,e,a[o]):this._computeSubSkinnedData(t,l,e,a[o],i)}},t._computeSubSkinnedData=function(t,e,i,n,r){for(var s=0,a=e.length;s<a;s++){var o=e[s];if(this._skinnedDataLoopMarks[o]===$i.loopCount)for(var h=r[o],l=this._skinnedData[h[0]][h[1]],u=16*h[2],c=16*s,_=0;_<16;_++)n[c+_]=l[u+_];else{if(this._cacheRootBone){var d=i[o];V._mulMatrixArray(this._bones[d].transform.worldMatrix.elements,t[d],n,16*s)}else V._mulMatrixArray(this._cacheAnimationNode[o].transform.getWorldMatrix(),t[i[o]],n,16*s);this._skinnedDataLoopMarks[o]=$i.loopCount}}},t._boundChange=function(){this._boundsChange=!0},t._onMeshChange=function(t){o.prototype._onMeshChange.call(this,t);var e=(this._cacheMesh=t).subMeshCount;this._skinnedData=P(e),this._skinnedDataLoopMarks.length=t._bindPoseIndices.length;for(var i=0;i<e;i++)for(var n=t._getSubMesh(i)._boneIndicesList,r=n.length,s=this._skinnedData[i]=P(r),a=0;a<r;a++)s[a]=new Float32Array(16*n[a].length);this._bones||this._cacheAvatar&&t&&this._getCacheAnimationNodes()},t._setCacheAnimator=function(t){this._cacheAnimator=t,this._defineDatas.add(aa.SHADERDEFINE_BONE),this._setRootNode()},t._calculateBoundingBox=function(){if(this._cacheRootBone)this._localBounds._tranform(this._cacheRootBone.transform.worldMatrix,this._bounds);else if(this._cacheAnimator&&this._rootBone){var t=r._tempMatrix4x4;V.matrix4x4MultiplyMFM(this._cacheAnimator.owner.transform.worldMatrix,this._cacheRootAnimationNode.transform.getWorldMatrix(),t),this._localBounds._tranform(t,this._bounds)}else o.prototype._calculateBoundingBox.call(this);if(qi.supportWebGLPlusCulling){var e=this._bounds.getMin(),i=this._bounds.getMax(),n=ye._cullingBuffer;n[this._cullingBufferIndex+1]=e.x,n[this._cullingBufferIndex+2]=e.y,n[this._cullingBufferIndex+3]=e.z,n[this._cullingBufferIndex+4]=i.x,n[this._cullingBufferIndex+5]=i.y,n[this._cullingBufferIndex+6]=i.z}},t._changeRenderObjectsByMesh=function(t){var e=t.subMeshCount;this._renderElements.length=e;for(var i=0;i<e;i++){var n=this._renderElements[i];if(!n){var r=this.sharedMaterials[i];(n=this._renderElements[i]=new Wi).setTransform(this._owner._transform),n.render=this,n.material=r||Ls.defaultMaterial}n.setGeometry(t._getSubMesh(i))}},t._renderUpdate=function(t,e){if(this._cacheAnimator)if(this._computeSkinnedData(),this._cacheRootBone)this._shaderValues.setMatrix4x4(es.WORLDMATRIX,gt.DEFAULT);else{var i=this._cacheAnimator.owner._transform;this._shaderValues.setMatrix4x4(es.WORLDMATRIX,i.worldMatrix)}else this._shaderValues.setMatrix4x4(es.WORLDMATRIX,e.worldMatrix)},t._renderUpdateWithCamera=function(t,e){var i=t.projectionViewMatrix;if(this._cacheRootBone)this._shaderValues.setMatrix4x4(es.MVPMATRIX,i);else{if(this._cacheAnimator){var n=this._cacheAnimator.owner._transform;gt.multiply(i,n.worldMatrix,this._projectionViewWorldMatrix)}else gt.multiply(i,e.worldMatrix,this._projectionViewWorldMatrix);this._shaderValues.setMatrix4x4(es.MVPMATRIX,this._projectionViewWorldMatrix)}},t._destroy=function(){o.prototype._destroy.call(this),this._cacheRootBone?this._cacheRootBone.transform.off("transformchanged",this,this._boundChange):this._cacheRootAnimationNode&&this._cacheRootAnimationNode.transform.off("transformchanged",this,this._boundChange)},t._setRootBone=function(t){this._rootBone=t,this._setRootNode()},t._setRootNode=function(){var t;t=this._cacheAnimator&&this._rootBone&&this._cacheAvatar?this._cacheAnimator._avatarNodeMap[this._rootBone]:null,this._cacheRootAnimationNode!=t&&(this._boundChange(),this._cacheRootAnimationNode&&this._cacheRootAnimationNode.transform.off("transformchanged",this,this._boundChange),t&&t.transform.on("transformchanged",this,this._boundChange),this._cacheRootAnimationNode=t)},t._getCacheAnimationNodes=function(){var t=this._cacheMesh._boneNames,e=this._cacheMesh._bindPoseIndices,i=e.length;if(qi.supportWebGLPlusAnimation){this._cacheAnimationNodeIndices=new Uint16Array(i);var n=this._cacheAnimator._avatarNodeMap;for(a=0;a<i;a++){var r=n[t[e[a]]];this._cacheAnimationNodeIndices[a]=r._worldMatrixIndex}}else{this._cacheAnimationNode.length=i;for(var s=this._cacheAnimator._avatarNodeMap,a=0;a<i;a++){var o=s[t[e[a]]];this._cacheAnimationNode[a]=o}}},t._setCacheAvatar=function(t){this._cacheAvatar!==t&&(this._cacheMesh?(this._cacheAvatar=t)&&(this._defineDatas.add(aa.SHADERDEFINE_BONE),this._getCacheAnimationNodes()):this._cacheAvatar=t,this._setRootNode())},t._computeSubSkinnedDataNative=function(t,e,i,n,r,s){Nt.instance.computeSubSkinnedData(t,e,i,n,r,s)},g(0,t,"bones",function(){return this._bones}),g(0,t,"rootBone",function(){return this._cacheRootBone},function(t){this._cacheRootBone!=t&&(this._cacheRootBone&&this._cacheRootBone.transform.off("transformchanged",this,this._boundChange),t.transform.on("transformchanged",this,this._boundChange),this._cacheRootBone=t,this._boundChange())}),g(0,t,"localBounds",function(){return this._localBounds},function(t){this._localBounds=t}),E(r,["_tempMatrix4x4",function(){return this._tempMatrix4x4=new gt}]),r}(cs),Gs=function(e){function i(){this._diffuseScale1=null,this._diffuseScale2=null,this._diffuseScale3=null,this._diffuseScale4=null,i.__super.call(this),this.setShaderName("Terrain"),this.renderMode=1,this._diffuseScale1=new un,this._diffuseScale2=new un,this._diffuseScale3=new un,this._diffuseScale4=new un,this.ambientColor=new ln(.6,.6,.6),this.diffuseColor=new ln(1,1,1),this.specularColor=new on(.2,.2,.2,32)}I(i,"laya.d3.core.material.TerrainMaterial",e);var t=i.prototype;return t.setDiffuseScale1=function(t,e){this._diffuseScale1.x=t,this._diffuseScale1.y=e,this._shaderValues.setVector2(6,this._diffuseScale1)},t.setDiffuseScale2=function(t,e){this._diffuseScale2.x=t,this._diffuseScale2.y=e,this._shaderValues.setVector2(7,this._diffuseScale2)},t.setDiffuseScale3=function(t,e){this._diffuseScale3.x=t,this._diffuseScale3.y=e,this._shaderValues.setVector2(8,this._diffuseScale3)},t.setDiffuseScale4=function(t,e){this._diffuseScale4.x=t,this._diffuseScale4.y=e,this._shaderValues.setVector2(9,this._diffuseScale4)},t.setDetailNum=function(t){switch(t){case 1:this._defineDatas.add(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4);break;case 2:this._defineDatas.add(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4);break;case 3:this._defineDatas.add(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4);break;case 4:this._defineDatas.add(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._defineDatas.remove(laya.d3.core.material.TerrainMaterial.SHADERDEFINE_DETAIL_NUM3)}},t.disableLight=function(){this._disablePublicDefineDatas.add(Rs.SHADERDEFINE_POINTLIGHT|Rs.SHADERDEFINE_SPOTLIGHT|Rs.SHADERDEFINE_DIRECTIONLIGHT)},t.setShaderName=function(t){e.prototype.setShaderName.call(this,t)},g(0,t,"depthTest",function(){return this._shaderValues.getInt(i.DEPTH_TEST)},function(t){this._shaderValues.setInt(i.DEPTH_TEST,t)}),g(0,t,"blendDst",function(){return this._shaderValues.getInt(i.BLEND_DST)},function(t){this._shaderValues.setInt(i.BLEND_DST,t)}),g(0,t,"blendSrc",function(){return this._shaderValues.getInt(i.BLEND_SRC)},function(t){this._shaderValues.setInt(i.BLEND_SRC,t)}),g(0,t,"depthWrite",function(){return this._shaderValues.getBool(i.DEPTH_WRITE)},function(t){this._shaderValues.setBool(i.DEPTH_WRITE,t)}),g(0,t,"diffuseTexture4",function(){return this._shaderValues.getTexture(5)},function(t){this._shaderValues.setTexture(5,t)}),g(0,t,"normalTexture",function(){return this._shaderValues.getTexture(1)},function(t){this._shaderValues.setTexture(1,t)}),g(0,t,"diffuseTexture3",function(){return this._shaderValues.getTexture(4)},function(t){this._shaderValues.setTexture(4,t)}),g(0,t,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.depthTest=513;break;case 2:this.renderQueue=2e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.blendSrc=770,this.blendDst=771,this.depthTest=515;break;default:throw new Error("TerrainMaterial:renderMode value error.")}}),g(0,t,"diffuseTexture2",function(){return this._shaderValues.getTexture(3)},function(t){this._shaderValues.setTexture(3,t)}),g(0,t,"diffuseTexture1",function(){return this._shaderValues.getTexture(2)},function(t){this._shaderValues.setTexture(2,t)}),g(0,t,"specularColor",function(){return this._shaderValues.getVector(12)},function(t){this._shaderValues.setVector(12,t)}),g(0,t,"cull",function(){return this._shaderValues.getInt(i.CULL)},function(t){this._shaderValues.setInt(i.CULL,t)}),g(0,t,"diffuseColor",function(){return this._shaderValues.getVector(11)},function(t){this._shaderValues.setVector3(11,t)}),g(0,t,"splatAlphaTexture",function(){return this._shaderValues.getTexture(0)},function(t){this._shaderValues.setTexture(0,t)}),g(0,t,"blend",function(){return this._shaderValues.getInt(i.BLEND)},function(t){this._shaderValues.setInt(i.BLEND,t)}),g(0,t,"ambientColor",function(){return this._shaderValues.getVector(10)},function(t){this._shaderValues.setVector3(10,t)}),i.__init__=function(){i.SHADERDEFINE_DETAIL_NUM1=i.shaderDefines.registerDefine("DETAIL_NUM1"),i.SHADERDEFINE_DETAIL_NUM2=i.shaderDefines.registerDefine("DETAIL_NUM2"),i.SHADERDEFINE_DETAIL_NUM4=i.shaderDefines.registerDefine("DETAIL_NUM4"),i.SHADERDEFINE_DETAIL_NUM3=i.shaderDefines.registerDefine("DETAIL_NUM3")},i.RENDERMODE_OPAQUE=1,i.RENDERMODE_TRANSPARENT=2,i.SPLATALPHATEXTURE=0,i.NORMALTEXTURE=1,i.DIFFUSETEXTURE1=2,i.DIFFUSETEXTURE2=3,i.DIFFUSETEXTURE3=4,i.DIFFUSETEXTURE4=5,i.DIFFUSESCALE1=6,i.DIFFUSESCALE2=7,i.DIFFUSESCALE3=8,i.DIFFUSESCALE4=9,i.MATERIALAMBIENT=10,i.MATERIALDIFFUSE=11,i.MATERIALSPECULAR=12,i.SHADERDEFINE_DETAIL_NUM1=0,i.SHADERDEFINE_DETAIL_NUM2=0,i.SHADERDEFINE_DETAIL_NUM3=0,i.SHADERDEFINE_DETAIL_NUM4=0,E(i,["CULL",function(){return this.CULL=We.propertyNameToID("s_Cull")},"BLEND",function(){return this.BLEND=We.propertyNameToID("s_Blend")},"BLEND_SRC",function(){return this.BLEND_SRC=We.propertyNameToID("s_BlendSrc")},"BLEND_DST",function(){return this.BLEND_DST=We.propertyNameToID("s_BlendDst")},"DEPTH_TEST",function(){return this.DEPTH_TEST=We.propertyNameToID("s_DepthTest")},"DEPTH_WRITE",function(){return this.DEPTH_WRITE=We.propertyNameToID("s_DepthWrite")},"defaultMaterial",function(){return this.defaultMaterial=new i},"shaderDefines",function(){return this.shaderDefines=new ii(as.shaderDefines)}]),i}(as),Hs=function(t){function i(){this._color=null,i.__super.call(this),this.setShaderName("Trail"),this._color=new on(1,1,1,1),this._shaderValues.setVector(i.TINTCOLOR,new on(1,1,1,1)),this.renderMode=0}I(i,"laya.d3.core.trail.TrailMaterial",as);var e=i.prototype;return g(0,e,"depthTest",function(){return this._shaderValues.getInt(i.DEPTH_TEST)},function(t){this._shaderValues.setInt(i.DEPTH_TEST,t)}),g(0,e,"blend",function(){return this._shaderValues.getInt(i.BLEND)},function(t){this._shaderValues.setInt(i.BLEND,t)}),g(0,e,"tilingOffsetY",function(){return this._MainTex_STY},function(t){this._MainTex_STY=t}),g(0,e,"texture",function(){return this._shaderValues.getTexture(i.MAINTEXTURE)},function(t){t?this._defineDatas.add(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_MAINTEXTURE):this._defineDatas.remove(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_MAINTEXTURE),this._shaderValues.setTexture(i.MAINTEXTURE,t)}),g(0,e,"depthWrite",function(){return this._shaderValues.getBool(i.DEPTH_WRITE)},function(t){this._shaderValues.setBool(i.DEPTH_WRITE,t)}),g(0,e,"colorA",function(){return this._TintColorA},function(t){this._TintColorA=t}),g(0,e,"colorB",function(){return this._TintColorB},function(t){this._TintColorB=t}),g(0,e,"_MainTex_STZ",function(){return this._shaderValues.getVector(i.TILINGOFFSET).z},function(t){var e=this._shaderValues.getVector(i.TILINGOFFSET);e.z=t,this.tilingOffset=e}),g(0,e,"colorG",function(){return this._TintColorG},function(t){this._TintColorG=t}),g(0,e,"blendSrc",function(){return this._shaderValues.getInt(i.BLEND_SRC)},function(t){this._shaderValues.setInt(i.BLEND_SRC,t)}),g(0,e,"tilingOffsetX",function(){return this._MainTex_STX},function(t){this._MainTex_STX=t}),g(0,e,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=3e3,this.alphaTest=!1,this.depthWrite=!1,this.cull=0,this.blend=1,this.blendSrc=770,this.blendDst=1,this.depthTest=513,this._defineDatas.add(i.SHADERDEFINE_ADDTIVEFOG);break;case 0:this.renderQueue=3e3,this.alphaTest=!1,this.depthWrite=!1,this.cull=0,this.blend=1,this.blendSrc=770,this.blendDst=771,this.depthTest=513,this._defineDatas.remove(i.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("TrailMaterial : renderMode value error.")}}),g(0,e,"colorR",function(){return this._TintColorR},function(t){this._TintColorR=t}),g(0,e,"color",function(){return this._shaderValues.getVector(i.TINTCOLOR)},function(t){this._shaderValues.setVector(i.TINTCOLOR,t)}),g(0,e,"_TintColorB",function(){return this._color.z},function(t){this._color.z=t,this.color=this._color}),g(0,e,"blendDst",function(){return this._shaderValues.getInt(i.BLEND_DST)},function(t){this._shaderValues.setInt(i.BLEND_DST,t)}),g(0,e,"_MainTex_STW",function(){return this._shaderValues.getVector(i.TILINGOFFSET).w},function(t){var e=this._shaderValues.getVector(i.TILINGOFFSET);e.w=t,this.tilingOffset=e}),g(0,e,"cull",function(){return this._shaderValues.getInt(i.CULL)},function(t){this._shaderValues.setInt(i.CULL,t)}),g(0,e,"tilingOffsetZ",function(){return this._MainTex_STZ},function(t){this._MainTex_STZ=t}),g(0,e,"tilingOffset",function(){return this._shaderValues.getVector(i.TILINGOFFSET)},function(t){t&&(1!=t.x||1!=t.y||0!=t.z||0!=t.w)?this._defineDatas.add(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_TILINGOFFSET):this._defineDatas.remove(laya.d3.core.trail.TrailMaterial.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(i.TILINGOFFSET,t)}),g(0,e,"_MainTex_STY",function(){return this._shaderValues.getVector(i.TILINGOFFSET).y},function(t){var e=this._shaderValues.getVector(i.TILINGOFFSET);e.y=t,this.tilingOffset=e}),g(0,e,"tilingOffsetW",function(){return this._MainTex_STW},function(t){this._MainTex_STW=t}),g(0,e,"_TintColorR",function(){return this._color.x},function(t){this._color.x=t,this.color=this._color}),g(0,e,"_TintColorG",function(){return this._color.y},function(t){this._color.y=t,this.color=this._color}),g(0,e,"_MainTex_STX",function(){return this._shaderValues.getVector(i.TILINGOFFSET).x},function(t){var e=this._shaderValues.getVector(i.TILINGOFFSET);e.x=t,this.tilingOffset=e}),g(0,e,"_TintColorA",function(){return this._color.w},function(t){this._color.w=t,this.color=this._color}),i.__init__=function(){i.SHADERDEFINE_MAINTEXTURE=i.shaderDefines.registerDefine("MAINTEXTURE"),i.SHADERDEFINE_TILINGOFFSET=i.shaderDefines.registerDefine("TILINGOFFSET"),i.SHADERDEFINE_ADDTIVEFOG=i.shaderDefines.registerDefine("ADDTIVEFOG")},i.RENDERMODE_ALPHABLENDED=0,i.RENDERMODE_ADDTIVE=1,i.SHADERDEFINE_MAINTEXTURE=0,i.SHADERDEFINE_TILINGOFFSET=0,i.SHADERDEFINE_ADDTIVEFOG=0,E(i,["defaultMaterial",function(){return this.defaultMaterial=new i},"MAINTEXTURE",function(){return this.MAINTEXTURE=We.propertyNameToID("u_MainTexture")},"TINTCOLOR",function(){return this.TINTCOLOR=We.propertyNameToID("u_MainColor")},"TILINGOFFSET",function(){return this.TILINGOFFSET=We.propertyNameToID("u_TilingOffset")},"CULL",function(){return this.CULL=We.propertyNameToID("s_Cull")},"BLEND",function(){return this.BLEND=We.propertyNameToID("s_Blend")},"BLEND_SRC",function(){return this.BLEND_SRC=We.propertyNameToID("s_BlendSrc")},"BLEND_DST",function(){return this.BLEND_DST=We.propertyNameToID("s_BlendDst")},"DEPTH_TEST",function(){return this.DEPTH_TEST=We.propertyNameToID("s_DepthTest")},"DEPTH_WRITE",function(){return this.DEPTH_WRITE=We.propertyNameToID("s_DepthWrite")},"shaderDefines",function(){return this.shaderDefines=new ii(as.shaderDefines)}]),i}(),ks=function(t){function e(){e.__super.call(this),this.setShaderName("WaterPrimary"),this._shaderValues.setVector(e.HORIZONCOLOR,new on(.172,.463,.435,0)),this._shaderValues.setNumber(e.WAVESCALE,.15),this._shaderValues.setVector(e.WAVESPEED,new on(19,9,-16,-7))}I(e,"laya.d3.core.material.WaterPrimaryMaterial",as);var i=e.prototype;return g(0,i,"waveScale",function(){return this._shaderValues.getNumber(e.WAVESCALE)},function(t){this._shaderValues.setNumber(e.WAVESCALE,t)}),g(0,i,"normalTexture",function(){return this._shaderValues.getTexture(e.NORMALTEXTURE)},function(t){t?this._defineDatas.add(laya.d3.core.material.WaterPrimaryMaterial.SHADERDEFINE_NORMALTEXTURE):this._defineDatas.remove(laya.d3.core.material.WaterPrimaryMaterial.SHADERDEFINE_NORMALTEXTURE),this._shaderValues.setTexture(e.NORMALTEXTURE,t)}),g(0,i,"waveSpeed",function(){return this._shaderValues.getVector(e.WAVESPEED)},function(t){this._shaderValues.setVector(e.WAVESPEED,t)}),g(0,i,"mainTexture",function(){return this._shaderValues.getTexture(e.MAINTEXTURE)},function(t){t?this._defineDatas.add(laya.d3.core.material.WaterPrimaryMaterial.SHADERDEFINE_MAINTEXTURE):this._defineDatas.remove(laya.d3.core.material.WaterPrimaryMaterial.SHADERDEFINE_MAINTEXTURE),this._shaderValues.setTexture(e.MAINTEXTURE,t)}),g(0,i,"horizonColor",function(){return this._shaderValues.getVector(e.HORIZONCOLOR)},function(t){this._shaderValues.setVector(e.HORIZONCOLOR,t)}),e.__init__=function(){e.SHADERDEFINE_MAINTEXTURE=e.shaderDefines.registerDefine("MAINTEXTURE"),e.SHADERDEFINE_NORMALTEXTURE=e.shaderDefines.registerDefine("NORMALTEXTURE")},e.SHADERDEFINE_MAINTEXTURE=0,e.SHADERDEFINE_NORMALTEXTURE=0,E(e,["HORIZONCOLOR",function(){return this.HORIZONCOLOR=We.propertyNameToID("u_HorizonColor")},"MAINTEXTURE",function(){return this.MAINTEXTURE=We.propertyNameToID("u_MainTexture")},"NORMALTEXTURE",function(){return this.NORMALTEXTURE=We.propertyNameToID("u_NormalTexture")},"WAVESCALE",function(){return this.WAVESCALE=We.propertyNameToID("u_WaveScale")},"WAVESPEED",function(){return this.WAVESPEED=We.propertyNameToID("u_WaveSpeed")},"defaultMaterial",function(){return this.defaultMaterial=new e},"shaderDefines",function(){return this.shaderDefines=new ii(as.shaderDefines)}]),e}(),Ws=function(t){function i(){this._albedoIntensity=1,this._enableVertexColor=!1,this._albedoColor=new on(1,1,1,1),i.__super.call(this),this.setShaderName("Unlit"),this._shaderValues.setVector(i.ALBEDOCOLOR,new on(1,1,1,1)),this.renderMode=0}I(i,"laya.d3.core.material.UnlitMaterial",as);var e=i.prototype;return g(0,e,"blend",function(){return this._shaderValues.getInt(i.BLEND)},function(t){this._shaderValues.setInt(i.BLEND,t)}),g(0,e,"depthWrite",function(){return this._shaderValues.getBool(i.DEPTH_WRITE)},function(t){this._shaderValues.setBool(i.DEPTH_WRITE,t)}),g(0,e,"renderMode",null,function(t){switch(t){case 0:this.alphaTest=!1,this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.depthTest=513;break;case 1:this.renderQueue=2450,this.alphaTest=!0,this.depthWrite=!0,this.cull=2,this.blend=0,this.depthTest=513;break;case 2:this.renderQueue=3e3,this.alphaTest=!1,this.depthWrite=!1,this.cull=2,this.blend=1,this.blendSrc=770,this.blendDst=771,this.depthTest=513;break;default:throw new Error("UnlitMaterial : renderMode value error.")}}),g(0,e,"_AlbedoIntensity",function(){return this._albedoIntensity},function(t){if(this._albedoIntensity!==t){var e=this._shaderValues.getVector(i.ALBEDOCOLOR);on.scale(this._albedoColor,t,e),this._albedoIntensity=t,this._shaderValues.setVector(i.ALBEDOCOLOR,e)}}),g(0,e,"enableVertexColor",function(){return this._enableVertexColor},function(t){(this._enableVertexColor=t)?this._defineDatas.add(laya.d3.core.material.UnlitMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR):this._defineDatas.remove(laya.d3.core.material.UnlitMaterial.SHADERDEFINE_ENABLEVERTEXCOLOR)}),g(0,e,"blendSrc",function(){return this._shaderValues.getInt(i.BLEND_SRC)},function(t){this._shaderValues.setInt(i.BLEND_SRC,t)}),g(0,e,"_Cutoff",function(){return this.alphaTestValue},function(t){this.alphaTestValue=t}),g(0,e,"tilingOffsetX",function(){return this._MainTex_STX},function(t){this._MainTex_STX=t}),g(0,e,"tilingOffsetW",function(){return this._MainTex_STW},function(t){this._MainTex_STW=t}),g(0,e,"tilingOffset",function(){return this._shaderValues.getVector(i.TILINGOFFSET)},function(t){t&&(1!=t.x||1!=t.y||0!=t.z||0!=t.w)?this._defineDatas.add(laya.d3.core.material.UnlitMaterial.SHADERDEFINE_TILINGOFFSET):this._defineDatas.remove(laya.d3.core.material.UnlitMaterial.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(i.TILINGOFFSET,t)}),g(0,e,"albedoTexture",function(){return this._shaderValues.getTexture(i.ALBEDOTEXTURE)},function(t){t?this._defineDatas.add(laya.d3.core.material.UnlitMaterial.SHADERDEFINE_ALBEDOTEXTURE):this._defineDatas.remove(laya.d3.core.material.UnlitMaterial.SHADERDEFINE_ALBEDOTEXTURE),this._shaderValues.setTexture(i.ALBEDOTEXTURE,t)}),g(0,e,"albedoColorR",function(){return this._ColorR},function(t){this._ColorR=t}),g(0,e,"albedoColor",function(){return this._albedoColor},function(t){var e=this._shaderValues.getVector(i.ALBEDOCOLOR);on.scale(t,this._albedoIntensity,e),this._albedoColor=t,this._shaderValues.setVector(i.ALBEDOCOLOR,e)}),g(0,e,"tilingOffsetY",function(){return this._MainTex_STY},function(t){this._MainTex_STY=t}),g(0,e,"_MainTex_STX",function(){return this._shaderValues.getVector(i.TILINGOFFSET).x},function(t){var e=this._shaderValues.getVector(i.TILINGOFFSET);e.x=t,this.tilingOffset=e}),g(0,e,"_ColorB",function(){return this._albedoColor.z},function(t){this._albedoColor.z=t,this.albedoColor=this._albedoColor}),g(0,e,"albedoIntensity",function(){return this._albedoIntensity},function(t){this._AlbedoIntensity=t}),g(0,e,"_ColorG",function(){return this._albedoColor.y},function(t){this._albedoColor.y=t,this.albedoColor=this._albedoColor}),g(0,e,"albedoColorA",function(){return this._ColorA},function(t){this._ColorA=t}),g(0,e,"blendDst",function(){return this._shaderValues.getInt(i.BLEND_DST)},function(t){this._shaderValues.setInt(i.BLEND_DST,t)}),g(0,e,"_MainTex_STW",function(){return this._shaderValues.getVector(i.TILINGOFFSET).w},function(t){var e=this._shaderValues.getVector(i.TILINGOFFSET);e.w=t,this.tilingOffset=e}),g(0,e,"cull",function(){return this._shaderValues.getInt(i.CULL)},function(t){this._shaderValues.setInt(i.CULL,t)}),g(0,e,"tilingOffsetZ",function(){return this._MainTex_STZ},function(t){this._MainTex_STZ=t}),g(0,e,"_MainTex_STZ",function(){return this._shaderValues.getVector(i.TILINGOFFSET).z},function(t){var e=this._shaderValues.getVector(i.TILINGOFFSET);e.z=t,this.tilingOffset=e}),g(0,e,"albedoColorB",function(){return this._ColorB},function(t){this._ColorB=t}),g(0,e,"albedoColorG",function(){return this._ColorG},function(t){this._ColorG=t}),g(0,e,"_MainTex_STY",function(){return this._shaderValues.getVector(i.TILINGOFFSET).y},function(t){var e=this._shaderValues.getVector(i.TILINGOFFSET);e.y=t,this.tilingOffset=e}),g(0,e,"depthTest",function(){return this._shaderValues.getInt(i.DEPTH_TEST)},function(t){this._shaderValues.setInt(i.DEPTH_TEST,t)}),g(0,e,"_ColorR",function(){return this._albedoColor.x},function(t){this._albedoColor.x=t,this.albedoColor=this._albedoColor}),g(0,e,"_ColorA",function(){return this._albedoColor.w},function(t){this._albedoColor.w=t,this.albedoColor=this._albedoColor}),i.__init__=function(){i.SHADERDEFINE_ALBEDOTEXTURE=i.shaderDefines.registerDefine("ALBEDOTEXTURE"),i.SHADERDEFINE_TILINGOFFSET=i.shaderDefines.registerDefine("TILINGOFFSET"),i.SHADERDEFINE_ENABLEVERTEXCOLOR=i.shaderDefines.registerDefine("ENABLEVERTEXCOLOR")},i.RENDERMODE_OPAQUE=0,i.RENDERMODE_CUTOUT=1,i.RENDERMODE_TRANSPARENT=2,i.RENDERMODE_ADDTIVE=3,i.SHADERDEFINE_ALBEDOTEXTURE=0,i.SHADERDEFINE_TILINGOFFSET=0,i.SHADERDEFINE_ENABLEVERTEXCOLOR=0,E(i,["ALBEDOTEXTURE",function(){return this.ALBEDOTEXTURE=We.propertyNameToID("u_AlbedoTexture")},"ALBEDOCOLOR",function(){return this.ALBEDOCOLOR=We.propertyNameToID("u_AlbedoColor")},"TILINGOFFSET",function(){return this.TILINGOFFSET=We.propertyNameToID("u_TilingOffset")},"CULL",function(){return this.CULL=We.propertyNameToID("s_Cull")},"BLEND",function(){return this.BLEND=We.propertyNameToID("s_Blend")},"BLEND_SRC",function(){return this.BLEND_SRC=We.propertyNameToID("s_BlendSrc")},"BLEND_DST",function(){return this.BLEND_DST=We.propertyNameToID("s_BlendDst")},"DEPTH_TEST",function(){return this.DEPTH_TEST=We.propertyNameToID("s_DepthTest")},"DEPTH_WRITE",function(){return this.DEPTH_WRITE=We.propertyNameToID("s_DepthWrite")},"defaultMaterial",function(){return this.defaultMaterial=new i},"shaderDefines",function(){return this.shaderDefines=new ii(as.shaderDefines)}]),i}(),Xs=function(i){function n(){this._albedoColor=null,this._emissionColor=null,n.__super.call(this),this.setShaderName("PBRStandard"),this._albedoColor=new on(1,1,1,1),this._shaderValues.setVector(n.ALBEDOCOLOR,new on(1,1,1,1)),this._emissionColor=new on(0,0,0,0),this._shaderValues.setVector(n.EMISSIONCOLOR,new on(0,0,0,0)),this._shaderValues.setNumber(n.METALLIC,0),this._shaderValues.setNumber(n.SMOOTHNESS,.5),this._shaderValues.setNumber(n.SMOOTHNESSSCALE,1),this._shaderValues.setNumber(n.SMOOTHNESSSOURCE,0),this._shaderValues.setNumber(n.OCCLUSIONSTRENGTH,1),this._shaderValues.setNumber(n.NORMALSCALE,1),this._shaderValues.setNumber(n.PARALLAXSCALE,.001),this._shaderValues.setBool(n.ENABLEEMISSION,!1),this._shaderValues.setBool(n.ENABLEREFLECT,!0),this._shaderValues.setNumber(as.ALPHATESTVALUE,.5),this._disablePublicDefineDatas.remove(Rs.SHADERDEFINE_REFLECTMAP),this.renderMode=0}I(n,"laya.d3.core.material.PBRStandardMaterial",i);var t=n.prototype;return t.cloneTo=function(t){i.prototype.cloneTo.call(this,t);var e=t;this._albedoColor.cloneTo(e._albedoColor),this._emissionColor.cloneTo(e._emissionColor)},g(0,t,"depthTest",function(){return this._shaderValues.getInt(n.DEPTH_TEST)},function(t){this._shaderValues.setInt(n.DEPTH_TEST,t)}),g(0,t,"blendDst",function(){return this._shaderValues.getInt(n.BLEND_DST)},function(t){this._shaderValues.setInt(n.BLEND_DST,t)}),g(0,t,"blendSrc",function(){return this._shaderValues.getInt(n.BLEND_SRC)},function(t){this._shaderValues.setInt(n.BLEND_SRC,t)}),g(0,t,"cull",function(){return this._shaderValues.getInt(n.CULL)},function(t){this._shaderValues.setInt(n.CULL,t)}),g(0,t,"depthWrite",function(){return this._shaderValues.getBool(n.DEPTH_WRITE)},function(t){this._shaderValues.setBool(n.DEPTH_WRITE,t)}),g(0,t,"tilingOffsetW",function(){return this._MainTex_STW},function(t){this._MainTex_STW=t}),g(0,t,"tilingOffsetZ",function(){return this._MainTex_STZ},function(t){this._MainTex_STZ=t}),g(0,t,"tilingOffsetY",function(){return this._MainTex_STY},function(t){this._MainTex_STY=t}),g(0,t,"enableReflection",function(){return this._shaderValues.getBool(n.ENABLEREFLECT)},function(t){this._shaderValues.setBool(n.ENABLEREFLECT,!0),t?this._disablePublicDefineDatas.remove(Rs.SHADERDEFINE_REFLECTMAP):this._disablePublicDefineDatas.add(Rs.SHADERDEFINE_REFLECTMAP)}),g(0,t,"emissionTexture",function(){return this._shaderValues.getTexture(n.EMISSIONTEXTURE)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSIONTEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSIONTEXTURE),this._shaderValues.setTexture(n.EMISSIONTEXTURE,t)}),g(0,t,"emissionColorA",function(){return this._EmissionColorA},function(t){this._EmissionColorA=t}),g(0,t,"emissionColorG",function(){return this._EmissionColorG},function(t){this._EmissionColorG=t}),g(0,t,"emissionColorR",function(){return this._EmissionColorR},function(t){this._EmissionColorR=t}),g(0,t,"blend",function(){return this._shaderValues.getInt(n.BLEND)},function(t){this._shaderValues.setInt(n.BLEND,t)}),g(0,t,"enableEmission",function(){return this._shaderValues.getBool(n.ENABLEEMISSION)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSION):this._defineDatas.remove(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_EMISSION),this._shaderValues.setBool(n.ENABLEEMISSION,t)}),g(0,t,"_Glossiness",function(){return this._shaderValues.getNumber(n.SMOOTHNESS)},function(t){this._shaderValues.setNumber(n.SMOOTHNESS,t)}),g(0,t,"smoothnessSource",function(){return this._shaderValues.getInt(n.SMOOTHNESSSOURCE)},function(t){t?(this._defineDatas.add(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA),this._shaderValues.setInt(n.SMOOTHNESSSOURCE,1)):(this._defineDatas.remove(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA),this._shaderValues.setInt(n.SMOOTHNESSSOURCE,0))}),g(0,t,"emissionColor",function(){return this._shaderValues.getVector(n.EMISSIONCOLOR)},function(t){this._shaderValues.setVector(n.EMISSIONCOLOR,t)}),g(0,t,"smoothnessTextureScale",function(){return this._GlossMapScale},function(t){this._GlossMapScale=Math.max(0,Math.min(1,t))}),g(0,t,"_MainTex_STW",function(){return this._shaderValues.getVector(n.TILINGOFFSET).w},function(t){var e=this._shaderValues.getVector(n.TILINGOFFSET);e.w=t,this.tilingOffset=e}),g(0,t,"smoothness",function(){return this._Glossiness},function(t){this._Glossiness=Math.max(0,Math.min(1,t))}),g(0,t,"_Cutoff",function(){return this.alphaTestValue},function(t){this.alphaTestValue=t}),g(0,t,"occlusionTextureStrength",function(){return this._OcclusionStrength},function(t){this._OcclusionStrength=Math.max(0,Math.min(1,t))}),g(0,t,"occlusionTexture",function(){return this._shaderValues.getTexture(n.OCCLUSIONTEXTURE)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_OCCLUSIONTEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_OCCLUSIONTEXTURE),this._shaderValues.setTexture(n.OCCLUSIONTEXTURE,t)}),g(0,t,"metallicGlossTexture",function(){return this._shaderValues.getTexture(n.METALLICGLOSSTEXTURE)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_METALLICGLOSSTEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_METALLICGLOSSTEXTURE),this._shaderValues.setTexture(n.METALLICGLOSSTEXTURE,t)}),g(0,t,"_ColorG",function(){return this._albedoColor.y},function(t){this._albedoColor.y=t,this.albedoColor=this._albedoColor}),g(0,t,"parallaxTexture",function(){return this._shaderValues.getTexture(n.PARALLAXTEXTURE)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_PARALLAXTEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_PARALLAXTEXTURE),this._shaderValues.setTexture(n.PARALLAXTEXTURE,t)}),g(0,t,"emissionColorB",function(){return this._EmissionColorB},function(t){this._EmissionColorB=t}),g(0,t,"normalTextureScale",function(){return this._BumpScale},function(t){this._BumpScale=t}),g(0,t,"_OcclusionStrength",function(){return this._shaderValues.getNumber(n.OCCLUSIONSTRENGTH)},function(t){this._shaderValues.setNumber(n.OCCLUSIONSTRENGTH,t)}),g(0,t,"normalTexture",function(){return this._shaderValues.getTexture(n.NORMALTEXTURE)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_NORMALTEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_NORMALTEXTURE),this._shaderValues.setTexture(n.NORMALTEXTURE,t)}),g(0,t,"renderMode",null,function(t){switch(t){case 0:this.alphaTest=!1,this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.depthTest=513,this._defineDatas.remove(n.SHADERDEFINE_ALPHAPREMULTIPLY);break;case 1:this.renderQueue=2450,this.alphaTest=!0,this.depthWrite=!0,this.cull=2,this.blend=0,this.depthTest=513,this._defineDatas.remove(n.SHADERDEFINE_ALPHAPREMULTIPLY);break;case 2:this.renderQueue=3e3,this.alphaTest=!1,this.depthWrite=!1,this.cull=2,this.blend=1,this.blendSrc=770,this.blendDst=771,this.depthTest=513,this._defineDatas.remove(n.SHADERDEFINE_ALPHAPREMULTIPLY);break;case 3:this.renderQueue=3e3,this.alphaTest=!1,this.depthWrite=!1,this.cull=2,this.blend=1,this.blendSrc=1,this.blendDst=771,this.depthTest=513,this._defineDatas.add(n.SHADERDEFINE_ALPHAPREMULTIPLY);break;default:throw new Error("PBRSpecularMaterial : renderMode value error.")}}),g(0,t,"albedoTexture",function(){return this._shaderValues.getTexture(n.ALBEDOTEXTURE)},function(t){t?this._defineDatas.add(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_ALBEDOTEXTURE):this._defineDatas.remove(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_ALBEDOTEXTURE),this._shaderValues.setTexture(n.ALBEDOTEXTURE,t)}),g(0,t,"albedoColorA",function(){return this._ColorA},function(t){this._ColorA=t}),g(0,t,"_EmissionColorG",function(){return this._emissionColor.y},function(t){this._emissionColor.y=t,this.emissionColor=this._emissionColor}),g(0,t,"albedoColorB",function(){return this._ColorB},function(t){this._ColorB=t}),g(0,t,"albedoColorG",function(){return this._ColorG},function(t){this._ColorG=t}),g(0,t,"albedoColor",function(){return this._albedoColor},function(t){this._albedoColor=t,this._shaderValues.setVector(n.ALBEDOCOLOR,t)}),g(0,t,"albedoColorR",function(){return this._ColorR},function(t){this._ColorR=t}),g(0,t,"_EmissionColorB",function(){return this._emissionColor.z},function(t){this._emissionColor.z=t,this.emissionColor=this._emissionColor}),g(0,t,"tilingOffsetX",function(){return this._MainTex_STX},function(t){this._MainTex_STX=t}),g(0,t,"parallaxTextureScale",function(){return this._Parallax},function(t){this._Parallax=Math.max(.005,Math.min(.08,t))}),g(0,t,"_MainTex_STY",function(){return this._shaderValues.getVector(n.TILINGOFFSET).y},function(t){var e=this._shaderValues.getVector(n.TILINGOFFSET);e.y=t,this.tilingOffset=e}),g(0,t,"_EmissionColorR",function(){return this._emissionColor.x},function(t){this._emissionColor.x=t,this.emissionColor=this._emissionColor}),g(0,t,"_ColorB",function(){return this._albedoColor.z},function(t){this._albedoColor.z=t,this.albedoColor=this._albedoColor}),g(0,t,"_MainTex_STX",function(){return this._shaderValues.getVector(n.TILINGOFFSET).x},function(t){var e=this._shaderValues.getVector(n.TILINGOFFSET);e.x=t,this.tilingOffset=e}),g(0,t,"_Metallic",function(){return this._shaderValues.getNumber(n.METALLIC)},function(t){this._shaderValues.setNumber(n.METALLIC,t)}),g(0,t,"tilingOffset",function(){return this._shaderValues.getVector(n.TILINGOFFSET)},function(t){t&&(1!=t.x||1!=t.y||0!=t.z||0!=t.w)?this._defineDatas.add(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_TILINGOFFSET):this._defineDatas.remove(laya.d3.core.material.PBRStandardMaterial.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(n.TILINGOFFSET,t)}),g(0,t,"_EmissionColorA",function(){return this._emissionColor.w},function(t){this._emissionColor.w=t,this.emissionColor=this._emissionColor}),g(0,t,"_ColorR",function(){return this._albedoColor.x},function(t){this._albedoColor.x=t,this.albedoColor=this._albedoColor}),g(0,t,"metallic",function(){return this._Metallic},function(t){this._Metallic=Math.max(0,Math.min(1,t))}),g(0,t,"_ColorA",function(){return this._albedoColor.w},function(t){this._albedoColor.w=t,this.albedoColor=this._albedoColor}),g(0,t,"_BumpScale",function(){return this._shaderValues.getNumber(n.NORMALSCALE)},function(t){this._shaderValues.setNumber(n.NORMALSCALE,t)}),g(0,t,"_Parallax",function(){return this._shaderValues.getNumber(n.PARALLAXSCALE)},function(t){this._shaderValues.setNumber(n.PARALLAXSCALE,t)}),g(0,t,"_MainTex_STZ",function(){return this._shaderValues.getVector(n.TILINGOFFSET).z},function(t){var e=this._shaderValues.getVector(n.TILINGOFFSET);e.z=t,this.tilingOffset=e}),g(0,t,"_GlossMapScale",function(){return this._shaderValues.getNumber(n.SMOOTHNESSSCALE)},function(t){this._shaderValues.setNumber(n.SMOOTHNESSSCALE,t)}),n.__init__=function(){n.SHADERDEFINE_ALBEDOTEXTURE=n.shaderDefines.registerDefine("ALBEDOTEXTURE"),n.SHADERDEFINE_METALLICGLOSSTEXTURE=n.shaderDefines.registerDefine("METALLICGLOSSTEXTURE"),n.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA=n.shaderDefines.registerDefine("SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA"),n.SHADERDEFINE_NORMALTEXTURE=n.shaderDefines.registerDefine("NORMALTEXTURE"),n.SHADERDEFINE_PARALLAXTEXTURE=n.shaderDefines.registerDefine("PARALLAXTEXTURE"),n.SHADERDEFINE_OCCLUSIONTEXTURE=n.shaderDefines.registerDefine("OCCLUSIONTEXTURE"),n.SHADERDEFINE_EMISSION=n.shaderDefines.registerDefine("EMISSION"),n.SHADERDEFINE_EMISSIONTEXTURE=n.shaderDefines.registerDefine("EMISSIONTEXTURE"),n.SHADERDEFINE_REFLECTMAP=n.shaderDefines.registerDefine("REFLECTMAP"),n.SHADERDEFINE_TILINGOFFSET=n.shaderDefines.registerDefine("TILINGOFFSET"),n.SHADERDEFINE_ALPHAPREMULTIPLY=n.shaderDefines.registerDefine("ALPHAPREMULTIPLY")},n.SmoothnessSource_MetallicGlossTexture_Alpha=0,n.SmoothnessSource_AlbedoTexture_Alpha=1,n.RENDERMODE_OPAQUE=0,n.RENDERMODE_CUTOUT=1,n.RENDERMODE_FADE=2,n.RENDERMODE_TRANSPARENT=3,n.SHADERDEFINE_ALBEDOTEXTURE=0,n.SHADERDEFINE_NORMALTEXTURE=0,n.SHADERDEFINE_SMOOTHNESSSOURCE_ALBEDOTEXTURE_ALPHA=0,n.SHADERDEFINE_METALLICGLOSSTEXTURE=0,n.SHADERDEFINE_OCCLUSIONTEXTURE=0,n.SHADERDEFINE_PARALLAXTEXTURE=0,n.SHADERDEFINE_EMISSION=0,n.SHADERDEFINE_EMISSIONTEXTURE=0,n.SHADERDEFINE_REFLECTMAP=0,n.SHADERDEFINE_TILINGOFFSET=0,n.SHADERDEFINE_ALPHAPREMULTIPLY=0,n.SMOOTHNESSSOURCE=-1,n.ENABLEEMISSION=-1,n.ENABLEREFLECT=-1,E(n,["ALBEDOTEXTURE",function(){return this.ALBEDOTEXTURE=We.propertyNameToID("u_AlbedoTexture")},"METALLICGLOSSTEXTURE",function(){return this.METALLICGLOSSTEXTURE=We.propertyNameToID("u_MetallicGlossTexture")},"NORMALTEXTURE",function(){return this.NORMALTEXTURE=We.propertyNameToID("u_NormalTexture")},"PARALLAXTEXTURE",function(){return this.PARALLAXTEXTURE=We.propertyNameToID("u_ParallaxTexture")},"OCCLUSIONTEXTURE",function(){return this.OCCLUSIONTEXTURE=We.propertyNameToID("u_OcclusionTexture")},"EMISSIONTEXTURE",function(){return this.EMISSIONTEXTURE=We.propertyNameToID("u_EmissionTexture")},"ALBEDOCOLOR",function(){return this.ALBEDOCOLOR=We.propertyNameToID("u_AlbedoColor")},"EMISSIONCOLOR",function(){return this.EMISSIONCOLOR=We.propertyNameToID("u_EmissionColor")},"METALLIC",function(){return this.METALLIC=We.propertyNameToID("u_metallic")},"SMOOTHNESS",function(){return this.SMOOTHNESS=We.propertyNameToID("u_smoothness")},"SMOOTHNESSSCALE",function(){return this.SMOOTHNESSSCALE=We.propertyNameToID("u_smoothnessScale")},"OCCLUSIONSTRENGTH",function(){return this.OCCLUSIONSTRENGTH=We.propertyNameToID("u_occlusionStrength")},"NORMALSCALE",function(){return this.NORMALSCALE=We.propertyNameToID("u_normalScale")},"PARALLAXSCALE",function(){return this.PARALLAXSCALE=We.propertyNameToID("u_parallaxScale")},"TILINGOFFSET",function(){return this.TILINGOFFSET=We.propertyNameToID("u_TilingOffset")},"CULL",function(){return this.CULL=We.propertyNameToID("s_Cull")},"BLEND",function(){return this.BLEND=We.propertyNameToID("s_Blend")},"BLEND_SRC",function(){return this.BLEND_SRC=We.propertyNameToID("s_BlendSrc")},"BLEND_DST",function(){return this.BLEND_DST=We.propertyNameToID("s_BlendDst")},"DEPTH_TEST",function(){return this.DEPTH_TEST=We.propertyNameToID("s_DepthTest")},"DEPTH_WRITE",function(){return this.DEPTH_WRITE=We.propertyNameToID("s_DepthWrite")},"defaultMaterial",function(){return this.defaultMaterial=new n},"shaderDefines",function(){return this.shaderDefines=new ii(as.shaderDefines)}]),n}(as),Ys=function(t){function e(t){e.__super.call(this),void 0===t&&(t=!1),this._source=t?Vt.createElement("canvas"):this,this.lock=!0}I(e,"laya.resource.HTMLCanvas",ns);var i=e.prototype;return i._getSource=function(){return this._source},i.clear=function(){this._ctx&&this._ctx.clear&&this._ctx.clear(),this._texture&&(this._texture.destroy(),this._texture=null)},i.destroy=function(){laya.resource.Resource.prototype.destroy.call(this),this._setCPUMemory(0),this._ctx&&this._ctx.destroy(),this._ctx=null},i.release=function(){},i._setContext=function(t){this._ctx=t},i.getContext=function(t,e){return this.context},i.getMemSize=function(){return 0},i.size=function(t,e){(this._width!=t||this._height!=e||this._source&&(this._source.width!=t||this._source.height!=e))&&(this._width=t,this._height=e,this._setCPUMemory(t*e*4),this._ctx&&this._ctx.size&&this._ctx.size(t,e),this._source&&(this._source.height=e,this._source.width=t),this._texture&&(this._texture.destroy(),this._texture=null))},i.getTexture=function(){if(!this._texture){var t=new ea;t.loadImageSource(this.source),this._texture=new xr(t)}return this._texture},i.toBase64=function(t,e){if(this._source){if(qi.isConchApp){if(2==conchConfig.threadMode)throw"native 2 thread mode use toBase64Async";var i=this._ctx._targets.sourceWidth,n=this._ctx._targets.sourceHeight,r=this._ctx._targets.getData(0,0,i,n);return conchToBase64FlipY?conchToBase64FlipY(t,e,r.buffer,i,n):conchToBase64(t,e,r.buffer,i,n)}return this._source.toDataURL(t,e)}return null},i.toBase64Async=function(i,n,r){var s=this._ctx._targets.sourceWidth,a=this._ctx._targets.sourceHeight;this._ctx._targets.getDataAsync(0,0,s,a,function(t){var e=conchToBase64FlipY?conchToBase64FlipY(i,n,t.buffer,s,a):conchToBase64(i,n,t.buffer,s,a);r(e)})},g(0,i,"context",function(){return this._ctx?this._ctx:(this._source==this?this._ctx=new ji:this._ctx=this._source.getContext(qi.isConchApp?"layagl":"2d"),(this._ctx._canvas=this)._ctx)}),g(0,i,"source",function(){return this._source}),e}(),Zs=function(t){function i(){this._color=null,i.__super.call(this),this.setShaderName("Effect"),this._color=new on(1,1,1,1),this._shaderValues.setVector(i.TINTCOLOR,new on(1,1,1,1)),this.renderMode=0}I(i,"laya.d3.core.material.EffectMaterial",as);var e=i.prototype;return g(0,e,"depthTest",function(){return this._shaderValues.getInt(i.DEPTH_TEST)},function(t){this._shaderValues.setInt(i.DEPTH_TEST,t)}),g(0,e,"blend",function(){return this._shaderValues.getInt(i.BLEND)},function(t){this._shaderValues.setInt(i.BLEND,t)}),g(0,e,"tilingOffsetY",function(){return this._MainTex_STY},function(t){this._MainTex_STY=t}),g(0,e,"texture",function(){return this._shaderValues.getTexture(i.MAINTEXTURE)},function(t){t?this._defineDatas.add(laya.d3.core.material.EffectMaterial.SHADERDEFINE_MAINTEXTURE):this._defineDatas.remove(laya.d3.core.material.EffectMaterial.SHADERDEFINE_MAINTEXTURE),this._shaderValues.setTexture(i.MAINTEXTURE,t)}),g(0,e,"depthWrite",function(){return this._shaderValues.getBool(i.DEPTH_WRITE)},function(t){this._shaderValues.setBool(i.DEPTH_WRITE,t)}),g(0,e,"colorA",function(){return this._TintColorA},function(t){this._TintColorA=t}),g(0,e,"colorB",function(){return this._TintColorB},function(t){this._TintColorB=t}),g(0,e,"_MainTex_STZ",function(){return this._shaderValues.getVector(i.TILINGOFFSET).z},function(t){var e=this._shaderValues.getVector(i.TILINGOFFSET);e.z=t,this.tilingOffset=e}),g(0,e,"colorG",function(){return this._TintColorG},function(t){this._TintColorG=t}),g(0,e,"blendSrc",function(){return this._shaderValues.getInt(i.BLEND_SRC)},function(t){this._shaderValues.setInt(i.BLEND_SRC,t)}),g(0,e,"tilingOffsetX",function(){return this._MainTex_STX},function(t){this._MainTex_STX=t}),g(0,e,"renderMode",null,function(t){switch(t){case 0:this.renderQueue=3e3,this.alphaTest=!1,this.depthWrite=!1,this.cull=0,this.blend=1,this.blendSrc=770,this.blendDst=1,this.depthTest=513,this._defineDatas.add(i.SHADERDEFINE_ADDTIVEFOG);break;case 1:this.renderQueue=3e3,this.alphaTest=!1,this.depthWrite=!1,this.cull=0,this.blend=1,this.blendSrc=770,this.blendDst=771,this.depthTest=513,this._defineDatas.remove(i.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("MeshEffectMaterial : renderMode value error.")}}),g(0,e,"colorR",function(){return this._TintColorR},function(t){this._TintColorR=t}),g(0,e,"color",function(){return this._shaderValues.getVector(i.TINTCOLOR)},function(t){this._shaderValues.setVector(i.TINTCOLOR,t)}),g(0,e,"_TintColorB",function(){return this._color.z},function(t){this._color.z=t,this.color=this._color}),g(0,e,"blendDst",function(){return this._shaderValues.getInt(i.BLEND_DST)},function(t){this._shaderValues.setInt(i.BLEND_DST,t)}),g(0,e,"_MainTex_STW",function(){return this._shaderValues.getVector(i.TILINGOFFSET).w},function(t){var e=this._shaderValues.getVector(i.TILINGOFFSET);e.w=t,this.tilingOffset=e}),g(0,e,"cull",function(){return this._shaderValues.getInt(i.CULL)},function(t){this._shaderValues.setInt(i.CULL,t)}),g(0,e,"tilingOffsetZ",function(){return this._MainTex_STZ},function(t){this._MainTex_STZ=t}),g(0,e,"tilingOffset",function(){return this._shaderValues.getVector(i.TILINGOFFSET)},function(t){t&&(1!=t.x||1!=t.y||0!=t.z||0!=t.w)?this._defineDatas.add(laya.d3.core.material.EffectMaterial.SHADERDEFINE_TILINGOFFSET):this._defineDatas.remove(laya.d3.core.material.EffectMaterial.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(i.TILINGOFFSET,t)}),g(0,e,"_MainTex_STY",function(){return this._shaderValues.getVector(i.TILINGOFFSET).y},function(t){var e=this._shaderValues.getVector(i.TILINGOFFSET);e.y=t,this.tilingOffset=e}),g(0,e,"tilingOffsetW",function(){return this._MainTex_STW},function(t){this._MainTex_STW=t}),g(0,e,"_TintColorR",function(){return this._color.x},function(t){this._color.x=t,this.color=this._color}),g(0,e,"_TintColorG",function(){return this._color.y},function(t){this._color.y=t,this.color=this._color}),g(0,e,"_MainTex_STX",function(){return this._shaderValues.getVector(i.TILINGOFFSET).x},function(t){var e=this._shaderValues.getVector(i.TILINGOFFSET);e.x=t,this.tilingOffset=e}),g(0,e,"_TintColorA",function(){return this._color.w},function(t){this._color.w=t,this.color=this._color}),i.__init__=function(){i.SHADERDEFINE_MAINTEXTURE=i.shaderDefines.registerDefine("MAINTEXTURE"),i.SHADERDEFINE_TILINGOFFSET=i.shaderDefines.registerDefine("TILINGOFFSET"),i.SHADERDEFINE_ADDTIVEFOG=i.shaderDefines.registerDefine("ADDTIVEFOG")},i.RENDERMODE_ADDTIVE=0,i.RENDERMODE_ALPHABLENDED=1,i.SHADERDEFINE_MAINTEXTURE=0,i.SHADERDEFINE_TILINGOFFSET=0,i.SHADERDEFINE_ADDTIVEFOG=0,E(i,["defaultMaterial",function(){return this.defaultMaterial=new i},"MAINTEXTURE",function(){return this.MAINTEXTURE=We.propertyNameToID("u_AlbedoTexture")},"TINTCOLOR",function(){return this.TINTCOLOR=We.propertyNameToID("u_AlbedoColor")},"TILINGOFFSET",function(){return this.TILINGOFFSET=We.propertyNameToID("u_TilingOffset")},"CULL",function(){return this.CULL=We.propertyNameToID("s_Cull")},"BLEND",function(){return this.BLEND=We.propertyNameToID("s_Blend")},"BLEND_SRC",function(){return this.BLEND_SRC=We.propertyNameToID("s_BlendSrc")},"BLEND_DST",function(){return this.BLEND_DST=We.propertyNameToID("s_BlendDst")},"DEPTH_TEST",function(){return this.DEPTH_TEST=We.propertyNameToID("s_DepthTest")},"DEPTH_WRITE",function(){return this.DEPTH_WRITE=We.propertyNameToID("s_DepthWrite")},"shaderDefines",function(){return this.shaderDefines=new ii(as.shaderDefines)}]),i}(),js=function(t){function i(){i.__super.call(this),this.setShaderName("PARTICLESHURIKEN"),this._color=new on(1,1,1,1),this.renderMode=0}I(i,"laya.d3.core.particleShuriKen.ShurikenParticleMaterial",as);var e=i.prototype;return g(0,e,"depthTest",function(){return this._shaderValues.getInt(i.DEPTH_TEST)},function(t){this._shaderValues.setInt(i.DEPTH_TEST,t)}),g(0,e,"blend",function(){return this._shaderValues.getInt(i.BLEND)},function(t){this._shaderValues.setInt(i.BLEND,t)}),g(0,e,"texture",function(){return this._shaderValues.getTexture(i.DIFFUSETEXTURE)},function(t){t?this._defineDatas.add(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_DIFFUSEMAP):this._defineDatas.remove(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_DIFFUSEMAP),this._shaderValues.setTexture(i.DIFFUSETEXTURE,t)}),g(0,e,"tilingOffsetY",function(){return this._MainTex_STY},function(t){this._MainTex_STY=t}),g(0,e,"depthWrite",function(){return this._shaderValues.getBool(i.DEPTH_WRITE)},function(t){this._shaderValues.setBool(i.DEPTH_WRITE,t)}),g(0,e,"colorA",function(){return this._TintColorA},function(t){this._TintColorA=t}),g(0,e,"colorB",function(){return this._TintColorB},function(t){this._TintColorB=t}),g(0,e,"_MainTex_STZ",function(){return this._shaderValues.getVector(i.TILINGOFFSET).z},function(t){var e=this._shaderValues.getVector(i.TILINGOFFSET);e.z=t,this.tilingOffset=e}),g(0,e,"colorG",function(){return this._TintColorG},function(t){this._TintColorG=t}),g(0,e,"blendSrc",function(){return this._shaderValues.getInt(i.BLEND_SRC)},function(t){this._shaderValues.setInt(i.BLEND_SRC,t)}),g(0,e,"tilingOffsetX",function(){return this._MainTex_STX},function(t){this._MainTex_STX=t}),g(0,e,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.blendSrc=770,this.blendDst=1,this.alphaTest=!1,this._defineDatas.add(i.SHADERDEFINE_ADDTIVEFOG);break;case 0:this.renderQueue=3e3,this.depthWrite=!1,this.cull=0,this.blend=1,this.blendSrc=770,this.blendDst=771,this.alphaTest=!1,this._defineDatas.remove(i.SHADERDEFINE_ADDTIVEFOG);break;default:throw new Error("ShurikenParticleMaterial : renderMode value error.")}}),g(0,e,"colorR",function(){return this._TintColorR},function(t){this._TintColorR=t}),g(0,e,"color",function(){return this._shaderValues.getVector(i.TINTCOLOR)},function(t){t?this._defineDatas.add(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TINTCOLOR):this._defineDatas.remove(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TINTCOLOR),this._shaderValues.setVector(i.TINTCOLOR,t)}),g(0,e,"_TintColorB",function(){return this._color.z},function(t){this._color.z=t,this.color=this._color}),g(0,e,"blendDst",function(){return this._shaderValues.getInt(i.BLEND_DST)},function(t){this._shaderValues.setInt(i.BLEND_DST,t)}),g(0,e,"_MainTex_STW",function(){return this._shaderValues.getVector(i.TILINGOFFSET).w},function(t){var e=this._shaderValues.getVector(i.TILINGOFFSET);e.w=t,this.tilingOffset=e}),g(0,e,"cull",function(){return this._shaderValues.getInt(i.CULL)},function(t){this._shaderValues.setInt(i.CULL,t)}),g(0,e,"tilingOffsetZ",function(){return this._MainTex_STZ},function(t){this._MainTex_STZ=t}),g(0,e,"tilingOffset",function(){return this._shaderValues.getVector(i.TILINGOFFSET)},function(t){t&&(1!=t.x||1!=t.y||0!=t.z||0!=t.w)?this._defineDatas.add(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TILINGOFFSET):this._defineDatas.remove(laya.d3.core.particleShuriKen.ShurikenParticleMaterial.SHADERDEFINE_TILINGOFFSET),this._shaderValues.setVector(i.TILINGOFFSET,t)}),g(0,e,"_MainTex_STY",function(){return this._shaderValues.getVector(i.TILINGOFFSET).y},function(t){var e=this._shaderValues.getVector(i.TILINGOFFSET);e.y=t,this.tilingOffset=e}),g(0,e,"tilingOffsetW",function(){return this._MainTex_STW},function(t){this._MainTex_STW=t}),g(0,e,"_TintColorR",function(){return this._color.x},function(t){this._color.x=t,this.color=this._color}),g(0,e,"_TintColorG",function(){return this._color.y},function(t){this._color.y=t,this.color=this._color}),g(0,e,"_MainTex_STX",function(){return this._shaderValues.getVector(i.TILINGOFFSET).x},function(t){var e=this._shaderValues.getVector(i.TILINGOFFSET);e.x=t,this.tilingOffset=e}),g(0,e,"_TintColorA",function(){return this._color.w},function(t){this._color.w=t,this.color=this._color}),i.__init__=function(){i.SHADERDEFINE_DIFFUSEMAP=i.shaderDefines.registerDefine("DIFFUSEMAP"),i.SHADERDEFINE_TINTCOLOR=i.shaderDefines.registerDefine("TINTCOLOR"),i.SHADERDEFINE_ADDTIVEFOG=i.shaderDefines.registerDefine("ADDTIVEFOG"),i.SHADERDEFINE_TILINGOFFSET=i.shaderDefines.registerDefine("TILINGOFFSET")},i.RENDERMODE_ALPHABLENDED=0,i.RENDERMODE_ADDTIVE=1,i.SHADERDEFINE_DIFFUSEMAP=0,i.SHADERDEFINE_TINTCOLOR=0,i.SHADERDEFINE_TILINGOFFSET=0,i.SHADERDEFINE_ADDTIVEFOG=0,E(i,["DIFFUSETEXTURE",function(){return this.DIFFUSETEXTURE=We.propertyNameToID("u_texture")},"TINTCOLOR",function(){return this.TINTCOLOR=We.propertyNameToID("u_Tintcolor")},"TILINGOFFSET",function(){return this.TILINGOFFSET=We.propertyNameToID("u_TilingOffset")},"CULL",function(){return this.CULL=We.propertyNameToID("s_Cull")},"BLEND",function(){return this.BLEND=We.propertyNameToID("s_Blend")},"BLEND_SRC",function(){return this.BLEND_SRC=We.propertyNameToID("s_BlendSrc")},"BLEND_DST",function(){return this.BLEND_DST=We.propertyNameToID("s_BlendDst")},"DEPTH_TEST",function(){return this.DEPTH_TEST=We.propertyNameToID("s_DepthTest")},"DEPTH_WRITE",function(){return this.DEPTH_WRITE=We.propertyNameToID("s_DepthWrite")},"defaultMaterial",function(){return this.defaultMaterial=new i},"shaderDefines",function(){return this.shaderDefines=new ii(as.shaderDefines)}]),i}(),Ks=function(t){function e(){this._enableLighting=!0,e.__super.call(this),this.setShaderName("ExtendTerrain"),this.renderMode=1}I(e,"laya.d3.core.material.ExtendTerrainMaterial",as);var i=e.prototype;return i._setDetailNum=function(t){switch(t){case 1:this._defineDatas.add(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 2:this._defineDatas.add(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 3:this._defineDatas.add(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 4:this._defineDatas.add(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5);break;case 5:this._defineDatas.add(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM5),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM1),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM2),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM3),this._defineDatas.remove(laya.d3.core.material.ExtendTerrainMaterial.SHADERDEFINE_DETAIL_NUM4)}},g(0,i,"depthTest",function(){return this._shaderValues.getInt(e.DEPTH_TEST)},function(t){this._shaderValues.setInt(e.DEPTH_TEST,t)}),g(0,i,"blendDst",function(){return this._shaderValues.getInt(e.BLEND_DST)},function(t){this._shaderValues.setInt(e.BLEND_DST,t)}),g(0,i,"blendSrc",function(){return this._shaderValues.getInt(e.BLEND_SRC)},function(t){this._shaderValues.setInt(e.BLEND_SRC,t)}),g(0,i,"blend",function(){return this._shaderValues.getInt(e.BLEND)},function(t){this._shaderValues.setInt(e.BLEND,t)}),g(0,i,"depthWrite",function(){return this._shaderValues.getBool(e.DEPTH_WRITE)},function(t){this._shaderValues.setBool(e.DEPTH_WRITE,t)}),g(0,i,"renderMode",null,function(t){switch(t){case 1:this.renderQueue=2e3,this.depthWrite=!0,this.cull=2,this.blend=0,this.depthTest=513;break;case 2:this.renderQueue=2e3,this.depthWrite=!1,this.cull=2,this.blend=1,this.blendSrc=770,this.blendDst=771,this.depthTest=515;break;default:throw new Error("ExtendTerrainMaterial:renderMode value error.")}}),g(0,i,"enableLighting",function(){return this._enableLighting},function(t){this._enableLighting!==t&&(t?this._disablePublicDefineDatas.remove(Rs.SHADERDEFINE_POINTLIGHT|Rs.SHADERDEFINE_SPOTLIGHT|Rs.SHADERDEFINE_DIRECTIONLIGHT):this._disablePublicDefineDatas.add(Rs.SHADERDEFINE_POINTLIGHT|Rs.SHADERDEFINE_SPOTLIGHT|Rs.SHADERDEFINE_DIRECTIONLIGHT),this._enableLighting=t)}),g(0,i,"cull",function(){return this._shaderValues.getInt(e.CULL)},function(t){this._shaderValues.setInt(e.CULL,t)}),g(0,i,"diffuseScaleOffset2",null,function(t){this._shaderValues.setVector(e.DIFFUSESCALEOFFSET2,t)}),g(0,i,"diffuseScaleOffset4",null,function(t){this._shaderValues.setVector(e.DIFFUSESCALEOFFSET4,t)}),g(0,i,"diffuseScaleOffset5",null,function(t){this._shaderValues.setVector(e.DIFFUSESCALEOFFSET5,t)}),g(0,i,"diffuseScaleOffset3",null,function(t){this._shaderValues.setVector(e.DIFFUSESCALEOFFSET3,t)}),g(0,i,"diffuseTexture5",function(){return this._shaderValues.getTexture(e.DIFFUSETEXTURE5)},function(t){this._shaderValues.setTexture(e.DIFFUSETEXTURE5,t),this._setDetailNum(5)}),g(0,i,"diffuseScaleOffset1",null,function(t){this._shaderValues.setVector(e.DIFFUSESCALEOFFSET1,t)}),g(0,i,"diffuseTexture4",function(){return this._shaderValues.getTexture(e.DIFFUSETEXTURE4)},function(t){this._shaderValues.setTexture(e.DIFFUSETEXTURE4,t),this._setDetailNum(4)}),g(0,i,"diffuseTexture3",function(){return this._shaderValues.getTexture(e.DIFFUSETEXTURE3)},function(t){this._shaderValues.setTexture(e.DIFFUSETEXTURE3,t),this._setDetailNum(3)}),g(0,i,"diffuseTexture2",function(){return this._shaderValues.getTexture(e.DIFFUSETEXTURE2)},function(t){this._shaderValues.setTexture(e.DIFFUSETEXTURE2,t),this._setDetailNum(2)}),g(0,i,"diffuseTexture1",null,function(t){this._shaderValues.setTexture(e.DIFFUSETEXTURE1,t),this._setDetailNum(1)}),g(0,i,"splatAlphaTexture",function(){return this._shaderValues.getTexture(e.SPLATALPHATEXTURE)},function(t){this._shaderValues.setTexture(e.SPLATALPHATEXTURE,t)}),e.__init__=function(){e.SHADERDEFINE_DETAIL_NUM1=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM1"),e.SHADERDEFINE_DETAIL_NUM2=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM2"),e.SHADERDEFINE_DETAIL_NUM3=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM3"),e.SHADERDEFINE_DETAIL_NUM4=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM4"),e.SHADERDEFINE_DETAIL_NUM5=e.shaderDefines.registerDefine("ExtendTerrain_DETAIL_NUM5")},e.RENDERMODE_OPAQUE=1,e.RENDERMODE_TRANSPARENT=2,e.SHADERDEFINE_DETAIL_NUM1=0,e.SHADERDEFINE_DETAIL_NUM2=0,e.SHADERDEFINE_DETAIL_NUM3=0,e.SHADERDEFINE_DETAIL_NUM4=0,e.SHADERDEFINE_DETAIL_NUM5=0,E(e,["SPLATALPHATEXTURE",function(){return this.SPLATALPHATEXTURE=We.propertyNameToID("u_SplatAlphaTexture")},"DIFFUSETEXTURE1",function(){return this.DIFFUSETEXTURE1=We.propertyNameToID("u_DiffuseTexture1")},"DIFFUSETEXTURE2",function(){return this.DIFFUSETEXTURE2=We.propertyNameToID("u_DiffuseTexture2")},"DIFFUSETEXTURE3",function(){return this.DIFFUSETEXTURE3=We.propertyNameToID("u_DiffuseTexture3")},"DIFFUSETEXTURE4",function(){return this.DIFFUSETEXTURE4=We.propertyNameToID("u_DiffuseTexture4")},"DIFFUSETEXTURE5",function(){return this.DIFFUSETEXTURE5=We.propertyNameToID("u_DiffuseTexture5")},"DIFFUSESCALEOFFSET1",function(){return this.DIFFUSESCALEOFFSET1=We.propertyNameToID("u_DiffuseScaleOffset1")},"DIFFUSESCALEOFFSET2",function(){return this.DIFFUSESCALEOFFSET2=We.propertyNameToID("u_DiffuseScaleOffset2")},"DIFFUSESCALEOFFSET3",function(){return this.DIFFUSESCALEOFFSET3=We.propertyNameToID("u_DiffuseScaleOffset3")},"DIFFUSESCALEOFFSET4",function(){return this.DIFFUSESCALEOFFSET4=We.propertyNameToID("u_DiffuseScaleOffset4")},"DIFFUSESCALEOFFSET5",function(){return this.DIFFUSESCALEOFFSET5=We.propertyNameToID("u_DiffuseScaleOffset5")},"CULL",function(){return this.CULL=We.propertyNameToID("s_Cull")},"BLEND",function(){return this.BLEND=We.propertyNameToID("s_Blend")},"BLEND_SRC",function(){return this.BLEND_SRC=We.propertyNameToID("s_BlendSrc")},"BLEND_DST",function(){return this.BLEND_DST=We.propertyNameToID("s_BlendDst")},"DEPTH_TEST",function(){return this.DEPTH_TEST=We.propertyNameToID("s_DepthTest")},"DEPTH_WRITE",function(){return this.DEPTH_WRITE=We.propertyNameToID("s_DepthWrite")},"shaderDefines",function(){return this.shaderDefines=new ii(as.shaderDefines)}]),e}(),qs=function(i){function n(t,e){void 0===t&&(t=1),void 0===e&&(e=$t.COLLISIONFILTERGROUP_ALLFILTER),n.__super.call(this,t,e)}I(n,"laya.d3.physics.PhysicsCollider",i);var t=n.prototype;return t._addToSimulation=function(){this._simulation._addPhysicsCollider(this,this._collisionGroup,this._canCollideWith)},t._removeFromSimulation=function(){this._simulation._removePhysicsCollider(this)},t._onTransformChanged=function(t){(t&=56)&&(this._transformFlag|=t,this._isValid()&&-1===this._inPhysicUpdateListIndex&&this._simulation._physicsUpdateList.add(this))},t._parse=function(t){null!=t.friction&&(this.friction=t.friction),null!=t.rollingFriction&&(this.rollingFriction=t.rollingFriction),null!=t.restitution&&(this.restitution=t.restitution),null!=t.isTrigger&&(this.isTrigger=t.isTrigger),laya.d3.physics.PhysicsComponent.prototype._parse.call(this,t),this._parseShape(t.shapes)},t._onAdded=function(){var t=new In._physics3D.btCollisionObject;t.setUserIndex(this.id),t.forceActivationState(5);var e=t.getCollisionFlags();this.owner.isStatic?(0<(2&e)&&(e^=2),e|=1):(0<(1&e)&&(e^=1),e|=2),t.setCollisionFlags(e),this._nativeColliderObject=t,i.prototype._onAdded.call(this)},n}(ls),Qs=function(t){function e(){this._bgColor=null,e.__super.call(this)}I(e,"laya.ui.Box",t);var i=e.prototype;return T.imps(i,{"laya.ui.IBox":!0}),i._onResize=function(t){this.graphics.clear(),this.graphics.drawRect(0,0,this.width,this.height,this._bgColor)},g(0,i,"bgColor",function(){return this._bgColor},function(t){(this._bgColor=t)?(this._onResize(null),this.on("resize",this,this._onResize)):(this.graphics.clear(),this.off("resize",this,this._onResize))}),g(0,i,"dataSource",t.prototype._$get_dataSource,function(t){for(var e in this._dataSource=t){var i=this.getChildByName(e);i?i.dataSource=t[e]:this.hasOwnProperty(e)&&"function"!=typeof this[e]&&(this[e]=t[e])}}),e}(Ss),$s=function(e){function i(){this._watchMap={},this._widget=null,this._dataSource=null,this._anchorX=NaN,this._anchorY=NaN,this._widget=Kn.EMPTY,i.__super.call(this)}I(i,"laya.ui.View",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),this._watchMap=null,e.prototype.destroy.call(this,t)},t.changeData=function(t){var e=this._watchMap[t];if(e)for(var i=0,n=e.length;i<n;i++){e[i].exe(this)}},t._sizeChanged=function(){isNaN(this._anchorX)||(this.pivotX=this.anchorX*this.width),isNaN(this._anchorY)||(this.pivotY=this.anchorY*this.height),this.event("resize")},t._getWidget=function(){return this._widget===Kn.EMPTY&&(this._widget=this.addComponent(Kn)),this._widget},t.loadUI=function(t){var e=i.uiMap[t];i.uiMap&&this.createView(e)},g(0,t,"anchorX",function(){return this._anchorX},function(t){this._anchorX!=t&&(this._anchorX=t,this.callLater(this._sizeChanged))}),g(0,t,"centerY",function(){return this._widget.centerY},function(t){t!=this._widget.centerY&&(this._getWidget().centerY=t)}),g(0,t,"right",function(){return this._widget.right},function(t){t!=this._widget.right&&(this._getWidget().right=t)}),g(0,t,"anchorY",function(){return this._anchorY},function(t){this._anchorY!=t&&(this._anchorY=t,this.callLater(this._sizeChanged))}),g(0,t,"left",function(){return this._widget.left},function(t){t!=this._widget.left&&(this._getWidget().left=t)}),g(0,t,"centerX",function(){return this._widget.centerX},function(t){t!=this._widget.centerX&&(this._getWidget().centerX=t)}),g(0,t,"dataSource",function(){return this._dataSource},function(t){for(var e in this._dataSource=t){var i=this.getChildByName(e);i instanceof laya.ui.UIComponent?i.dataSource=t[e]:this.hasOwnProperty(e)&&"function"!=typeof this[e]&&(this[e]=t[e])}}),g(0,t,"bottom",function(){return this._widget.bottom},function(t){t!=this._widget.bottom&&(this._getWidget().bottom=t)}),g(0,t,"top",function(){return this._widget.top},function(t){t!=this._widget.top&&(this._getWidget().top=t)}),i.regComponent=function(t,e){Cn.regClass(t,e)},i.regViewRuntime=function(t,e){Cn.regClass(t,e)},i.regUI=function(t,e){T.loader.cacheRes(t,e)},i.uiMap={},i.__init$=function(){Cn.regShortClassName([Ba,ta,Xa,_a,Qs,Na,ta,ba,oa,sa,Ss,Ha,Ua,ra,na,Da,Oa,ga,Fa,Ya,ua,ia,ka,La,i,Ma,Ga,Va,Aa,Za,Wa,ts,fa,Os,Pa])},i}(xs),Js=function(t){function o(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0),o.__super.call(this,i,!1),this._glTextureType=3553,this._width=t,this._height=e,this._depthStencilFormat=n,this._create(t,e)}I(o,"laya.d3.resource.RenderTexture",Cs);var e=o.prototype;return e._create=function(t,e){var i=Nt.instance;this._frameBuffer=i.createFramebuffer(),j.bindTexture(i,this._glTextureType,this._glTexture);var n=this._getGLFormat();if(i.texImage2D(this._glTextureType,0,n,t,e,0,n,5121,null),this._setGPUMemory(t*e*4),i.bindFramebuffer(36160,this._frameBuffer),i.framebufferTexture2D(36160,36064,3553,this._glTexture,0),3!==this._depthStencilFormat)switch(this._depthStencilBuffer=i.createRenderbuffer(),i.bindRenderbuffer(36161,this._depthStencilBuffer),this._depthStencilFormat){case 0:i.renderbufferStorage(36161,33189,t,e),i.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 1:i.renderbufferStorage(36161,36168,t,e),i.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 2:i.renderbufferStorage(36161,34041,t,e),i.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer);break;default:throw"RenderTexture: unkonw depth format."}i.bindFramebuffer(36160,null),i.bindRenderbuffer(36161,null),this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel),this._readyed=!0,this._activeResource()},e._start=function(){Nt.instance.bindFramebuffer(36160,this._frameBuffer),(o._currentActive=this)._readyed=!1},e._end=function(){Nt.instance.bindFramebuffer(36160,null),o._currentActive=null,this._readyed=!0},e.getData=function(t,e,i,n,r){if(qi.isConchApp&&2==conchConfig.threadMode)throw"native 2 thread mode use getDataAsync";var s=Nt.instance;return s.bindFramebuffer(36160,this._frameBuffer),36053===s.checkFramebufferStatus(36160)?(s.readPixels(t,e,i,n,6408,5121,r),s.bindFramebuffer(36160,null),r):(s.bindFramebuffer(36160,null),null)},e.getDataAsync=function(t,e,i,n,r){var s=Nt.instance;s.bindFramebuffer(36160,this._frameBuffer),s.readPixelsAsync(t,e,i,n,6408,5121,function(t){r(new Uint8Array(t))}),s.bindFramebuffer(36160,null)},e._disposeResource=function(){if(this._frameBuffer){var t=Nt.instance;t.deleteTexture(this._glTexture),t.deleteFramebuffer(this._frameBuffer),t.deleteRenderbuffer(this._depthStencilBuffer),this._glTexture=null,this._frameBuffer=null,this._depthStencilBuffer=null,this._setGPUMemory(0)}},g(0,e,"defaulteTexture",function(){return ea.grayTexture}),g(0,e,"depthStencilFormat",function(){return this._depthStencilFormat}),g(1,o,"currentActive",function(){return o._currentActive},laya.resource.BaseTexture._$SET_currentActive),o.getTemporary=function(t,e,i,n,r){void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=1);var s=o._temporaryMap[1e7*r+1e6*n+1e5*i+1e4*e+t];if(!s||s&&0===s.length){var a=new o(t,e,i,n);return a.filterMode=r,a}return s.pop()},o.setReleaseTemporary=function(t){var e=1e7*t.filterMode+1e6*t.depthStencilFormat+1e5*t.format+1e4*t.height+t.width,i=o._temporaryMap[e];i||(o._temporaryMap[e]=i=[]),i.push(t)},o._temporaryMap={},o._currentActive=null,o}(),ta=function(e){function i(t,e){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,i.__super.call(this),this._labelColors=de.buttonLabelColors,this._stateNum=de.buttonStateNum,void 0===e&&(e=""),this.skin=t,this.label=e}I(i,"laya.ui.Button",e);var t=i.prototype;return T.imps(t,{"laya.ui.ISelect":!0}),t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy(t),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},t.createChildren=function(){this.graphics=this._bitmap=new ur},t.createText=function(){this._text||(this._text=new Os,this._text.overflow="hidden",this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},t.initialize=function(){1!==this._mouseState&&(this.mouseEnabled=!0,this._setBit(64,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},t.onMouse=function(t){if(!1!==this.toggle||!this._selected)return"click"===t.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=i.stateMap[t.type]))},t._skinLoaded=function(){this.callLater(this.changeClips),this._setStateChanged(),this._sizeChanged(),this.event("loaded")},t.changeClips=function(){var t=Hn.getRes(this._skin);if(t){var e=t.sourceWidth,i=t.sourceHeight/this._stateNum;t.$_GID||(t.$_GID=nt.getGID());var n=t.$_GID+"-"+this._stateNum,r=mn.I.get(n);if(nt.isOkTextureList(r)||(r=null),r)this._sources=r;else{if(this._sources=[],1===this._stateNum)this._sources.push(t);else for(var s=0;s<this._stateNum;s++)this._sources.push(xr.createFromTexture(t,0,i*s,e,i));mn.I.set(n,this._sources)}this._autoSize?(this._bitmap.width=this._width||e,this._bitmap.height=this._height||i,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=e)}else console.log("lose skin",this._skin)},t.measureWidth=function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))},t.measureHeight=function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height},t.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var t=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[t]),this.label&&(this._text.color=this._labelColors[t],this._strokeColors&&(this._text.strokeColor=this._strokeColors[t]))},t._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},g(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.label=t+"":T.superSet(Ss,this,"dataSource",t)}),g(0,t,"width",e.prototype._$get_width,function(t){T.superSet(Ss,this,"width",t),this._autoSize&&(this._bitmap.width=t,this._text&&(this._text.width=t))}),g(0,t,"labelAlign",function(){return this.createText(),this._text.align},function(t){this.createText(),this._text.align=t}),g(0,t,"labelBold",function(){return this.createText(),this._text.bold},function(t){this.createText(),this._text.bold=t}),g(0,t,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function(t){this.createText(),this._text.strokeColor=t}),g(0,t,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function(t){this.createText(),this._text.padding=be.fillArray(de.labelPadding,t,Number)}),g(0,t,"clickHandler",function(){return this._clickHandler},function(t){this._clickHandler=t}),g(0,t,"labelStroke",function(){return this.createText(),this._text.stroke},function(t){this.createText(),this._text.stroke=t}),g(0,t,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(t){this._bitmap.sizeGrid=be.fillArray(de.defaultSizeGrid,t,Number)}),g(0,t,"state",function(){return this._state},function(t){this._state!=t&&(this._state=t,this._setStateChanged())}),g(0,t,"selected",function(){return this._selected},function(t){this._selected!=t&&(this._selected=t,this.state=this._selected?2:0,this.event("change"))}),g(0,t,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function(t){this._bitmap._offset=t?be.fillArray([1,1],t,Number):[]}),g(0,t,"height",e.prototype._$get_height,function(t){T.superSet(Ss,this,"height",t),this._autoSize&&(this._bitmap.height=t,this._text&&(this._text.height=t))}),g(0,t,"text",function(){return this.createText(),this._text}),g(0,t,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function(t){this._strokeColors=be.fillArray(de.buttonLabelColors,t,String),this._setStateChanged()}),g(0,t,"labelColors",function(){return this._labelColors.join(",")},function(t){this._labelColors=be.fillArray(de.buttonLabelColors,t,String),this._setStateChanged()}),g(0,t,"label",function(){return this._text?this._text.text:null},function(t){(this._text||t)&&(this.createText(),this._text.text!=t&&(t&&!this._text.parent&&this.addChild(this._text),this._text.text=(t+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),g(0,t,"labelSize",function(){return this.createText(),this._text.fontSize},function(t){this.createText(),this._text.fontSize=t}),g(0,t,"labelFont",function(){return this.createText(),this._text.font},function(t){this.createText(),this._text.font=t}),g(0,t,"stateNum",function(){return this._stateNum},function(t){"string"==typeof t&&(t=parseInt(t)),this._stateNum!=t&&(this._stateNum=t<1?1:3<t?3:t,this.callLater(this.changeClips))}),g(0,t,"skin",function(){return this._skin},function(t){this._skin!=t&&((this._skin=t)?Hn.getRes(t)?this._skinLoaded():T.loader.load(this._skin,y.create(this,this._skinLoaded),null,"image",1):this._skinLoaded())}),E(i,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),i}(Ss),ea=function(t){function a(t,e,i,n,r){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=1),void 0===n&&(n=!0),void 0===r&&(r=!1),a.__super.call(this,i,n),this._glTextureType=3553,this._width=t,this._height=e,this._canRead=r,this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel),this._mipmap){this._mipmapCount=Math.max(Math.ceil(Math.log2(t))+1,Math.ceil(Math.log2(2))+1);for(var s=0;s<this._mipmapCount;s++)this._setPixels(null,s,Math.max(t>>s,1),Math.max(e>>s,1));this._setGPUMemory(t*e*4*(1+1/3))}else this._mipmapCount=1,this._setGPUMemory(t*e*4)}I(a,"laya.resource.Texture2D",Cs);var e=a.prototype;return e._getFormatByteCount=function(){switch(this._format){case 0:return 3;case 1:return 4;case 2:return 1;default:throw"Texture2D: unknown format."}},e._setPixels=function(t,e,i,n){var r=Nt.instance,s=this._glTextureType,a=this._getGLFormat();j.bindTexture(r,s,this._glTexture),0===this.format?(r.pixelStorei(3317,1),r.texImage2D(s,e,a,i,n,0,a,5121,t),r.pixelStorei(3317,4)):r.texImage2D(s,e,a,i,n,0,a,5121,t)},e._calcualatesCompressedDataSize=function(t,e,i){switch(t){case 3:case 5:return(e+3>>2)*(i+3>>2)*8;case 4:return(e+3>>2)*(i+3>>2)*16;case 11:case 12:return Math.floor((Math.max(e,8)*Math.max(i,8)*4+7)/8);case 9:case 10:return Math.floor((Math.max(e,16)*Math.max(i,8)*2+7)/8);default:return 0}},e._pharseDDS=function(t){var e=new Int32Array(t,0,31);if(542327876!=e[0])throw"Invalid magic number in DDS header";if(!(4&e[20]))throw"Unsupported format, must contain a FourCC code";var i=e[21];switch(this._format){case 3:if(827611204!==i)throw"the FourCC code is not same with texture format.";break;case 4:if(894720068!==i)throw"the FourCC code is not same with texture format.";break;default:throw"unknown texture format."}var n=1;if(131072&e[2]){if(n=Math.max(1,e[7]),!this._mipmap)throw"the mipmap is not same with Texture2D."}else if(this._mipmap)throw"the mipmap is not same with Texture2D.";var r=e[4],s=e[3];this._width=r,this._height=s;var a=e[1]+4;this._upLoadCompressedTexImage2D(t,r,s,n,a,0)},e._pharseKTX=function(t){var e=new Uint8Array(t,0,12);if(171!=e[0]||75!=e[1]||84!=e[2]||88!=e[3]||32!=e[4]||49!=e[5]||49!=e[6]||187!=e[7]||13!=e[8]||10!=e[9]||26!=e[10]||10!=e[11])throw"Invalid fileIdentifier in KTX header";var i=new Int32Array(e.buffer,e.length,13);switch(i[4]){case j._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL:this._format=5;break;default:throw"unknown texture format."}var n=i[11],r=i[6],s=i[7];this._width=r,this._height=s;var a=64+i[12];this._upLoadCompressedTexImage2D(t,r,s,n,a,4)},e._pharsePVR=function(t){var e=new Int32Array(t,0,13);if(55727696!=e[0])throw"Invalid magic number in PVR header";switch(e[2]){case 0:this._format=9;break;case 2:this._format=11;break;case 1:this._format=10;break;case 3:this._format=12;break;default:throw"Texture2D:unknown PVR format."}var i=e[11],n=e[7],r=e[6];this._width=n,this._height=r;var s=e[12]+52;this._upLoadCompressedTexImage2D(t,n,r,i,s,0)},e._upLoadCompressedTexImage2D=function(t,e,i,n,r,s){var a=Nt.instance,o=this._glTextureType;j.bindTexture(a,o,this._glTexture);for(var h=this._getGLFormat(),l=r,u=0;u<n;u++){l+=s;var c=this._calcualatesCompressedDataSize(this._format,e,i),_=new Uint8Array(t,l,c);a.compressedTexImage2D(o,u,h,e,i,0,_),e=Math.max(e>>1,1),i=Math.max(i>>1,1),l+=c}var d=l;this._setGPUMemory(d),this._readyed=!0,this._activeResource()},e.loadImageSource=function(t,e){void 0===e&&(e=!1);var i=t.width,n=t.height;this._width=i,this._height=n,this._isPot(i)&&this._isPot(n)||(this._mipmap=!1),this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode);var r=Nt.instance;j.bindTexture(r,this._glTextureType,this._glTexture);var s=this._getGLFormat();qi.isConchApp?(t instanceof laya.resource.HTMLCanvas||t.setPremultiplyAlpha(e),r.texImage2D(this._glTextureType,0,6408,6408,5121,t)):(e&&r.pixelStorei(37441,!0),r.texImage2D(this._glTextureType,0,s,s,5121,t),e&&r.pixelStorei(37441,!1)),this._mipmap?(r.generateMipmap(this._glTextureType),this._setGPUMemory(i*n*4*(1+1/3))):this._setGPUMemory(i*n*4),this._canRead&&(qi.isConchApp?this._pixels=new Uint8Array(t._nativeObj.getImageData(0,0,i,n)):(Vt.canvas.size(i,n),Vt.canvas.clear(),Vt.context.drawImage(t,0,0,i,n),this._pixels=new Uint8Array(Vt.context.getImageData(0,0,i,n).data.buffer))),this._readyed=!0,this._activeResource()},e.setPixels=function(t,e){if(void 0===e&&(e=0),!t)throw"Texture2D:pixels can't be null.";var i=Math.max(this._width>>e,1),n=Math.max(this._height>>e,1),r=i*n*this._getFormatByteCount();if(t.length<r)throw"Texture2D:pixels length should at least "+r+".";this._setPixels(t,e,i,n),this._canRead&&(this._pixels=t),this._readyed=!0,this._activeResource()},e.setSubPixels=function(t,e,i,n,r,s){if(void 0===s&&(s=0),!r)throw"Texture2D:pixels can't be null.";var a=Nt.instance,o=this._glTextureType;j.bindTexture(a,o,this._glTexture);var h=this._getGLFormat();0===this._format?(a.pixelStorei(3317,1),a.texSubImage2D(o,s,t,e,i,n,h,5121,r),a.pixelStorei(3317,4)):a.texSubImage2D(o,s,t,e,i,n,h,5121,r),this._readyed=!0,this._activeResource()},e.setCompressData=function(t){switch(this._format){case 3:case 4:this._pharseDDS(t);break;case 5:this._pharseKTX(t);break;case 9:case 10:case 11:case 12:this._pharsePVR(t);break;default:throw"Texture2D:unkonwn format."}},e._recoverResource=function(){},e.getPixels=function(){if(this._canRead)return this._pixels;throw new Error("Texture2D: must set texture canRead is true.")},g(0,e,"defaulteTexture",function(){return laya.resource.Texture2D.grayTexture}),g(0,e,"mipmapCount",function(){return this._mipmapCount}),a.__init__=function(){var t=new Uint8Array(3);t[0]=128,t[1]=128,t[2]=128,(a.grayTexture=new a(1,1,0,!1,!1)).setPixels(t),a.grayTexture.lock=!0,t[0]=255,t[1]=255,t[2]=255,(a.whiteTexture=new a(1,1,0,!1,!1)).setPixels(t),a.whiteTexture.lock=!0,t[0]=0,t[1]=0,t[2]=0,(a.blackTexture=new a(1,1,0,!1,!1)).setPixels(t),a.blackTexture.lock=!0},a._parse=function(t,e,i){var n=i?new a(i[0],i[1],i[2],i[3],i[4]):new a(0,0);switch(e&&(n.wrapModeU=e.wrapModeU,n.wrapModeV=e.wrapModeV,n.filterMode=e.filterMode,n.anisoLevel=e.anisoLevel),n._format){case 0:case 1:n.loadImageSource(t);break;case 3:case 4:case 5:case 9:case 10:case 11:case 12:n.setCompressData(t);break;default:throw"Texture2D:unkonwn format."}return n},a.load=function(t,e){T.loader.create(t,e,null,"TEXTURE2D")},a.grayTexture=null,a.whiteTexture=null,a.blackTexture=null,a}(),ia=function(e){function i(t){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,i.__super.call(this),this.skin=t}I(i,"laya.ui.Slider",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._bg&&this._bg.destroy(t),this._bar&&this._bar.destroy(t),this._progress&&this._progress.destroy(t),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},t.createChildren=function(){this.addChild(this._bg=new ra),this.addChild(this._bar=new ta)},t.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},t.onBarMouseDown=function(t){this._globalSacle||(this._globalSacle=new R),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=T.stage.mouseX,this._ty=T.stage.mouseY,T.stage.on("mousemove",this,this.mouseMove),T.stage.once("mouseup",this,this.mouseUp),T.stage.once("mouseout",this,this.mouseUp),this.showValueText()},t.showValueText=function(){if(this.showLabel){var t=laya.ui.Slider.label;this.addChild(t),t.textField.changeText(this._value+""),this.isVertical?(t.x=this._bar._x+20,t.y=.5*(this._bar.height-t.height)+this._bar._y):(t.y=this._bar._y-20,t.x=.5*(this._bar.width-t.width)+this._bar._x)}},t.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},t.mouseUp=function(t){T.stage.off("mousemove",this,this.mouseMove),T.stage.off("mouseup",this,this.mouseUp),T.stage.off("mouseout",this,this.mouseUp),this.sendChangeEvent("changed"),this.hideValueText()},t.mouseMove=function(t){var e=this._value;if(this.isVertical?(this._bar.y+=(T.stage.mouseY-this._ty)/this._globalSacle.y,this._bar._y>this._maxMove?this._bar.y=this._maxMove:this._bar._y<0&&(this._bar.y=0),this._value=this._bar._y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar._y+.5*this._bar.height)):(this._bar.x+=(T.stage.mouseX-this._tx)/this._globalSacle.x,this._bar._x>this._maxMove?this._bar.x=this._maxMove:this._bar._x<0&&(this._bar.x=0),this._value=this._bar._x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar._x+.5*this._bar.width)),this._tx=T.stage.mouseX,this._ty=T.stage.mouseY,0!=this._tick){var i=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*i)/i}this._value!=e&&this.sendChangeEvent(),this.showValueText()},t.sendChangeEvent=function(t){void 0===t&&(t="change"),this.event(t),this.changeHandler&&this.changeHandler.runWith(this._value)},t._skinLoaded=function(){this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var t=this._skin.replace(".png","$progress.png");Hn.getRes(t)&&(this._progress||(this.addChild(this._progress=new ra),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=t),this.setBarPoint(),this.callLater(this.changeValue),this._sizeChanged(),this.event("loaded")},t.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},t.measureWidth=function(){return Math.max(this._bg.width,this._bar.width)},t.measureHeight=function(){return Math.max(this._bg.height,this._bar.height)},t._sizeChanged=function(){e.prototype._sizeChanged.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},t.setSlider=function(t,e,i){this._value=-1,this._min=t,this._max=t<e?e:t,this.value=i<t?t:e<i?e:i},t.changeValue=function(){if(0!=this.tick){var t=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*t)/t}this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var e=this._max-this._min;0===e&&(e=1),this.isVertical?(this._bar.y=(this._value-this._min)/e*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar._y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/e*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar._x+.5*this._bar.width))},t.onBgMouseDown=function(t){var e=this._bg.getMousePoint();this.isVertical?this.value=e.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=e.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},g(0,t,"bar",function(){return this._bar}),g(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.value=Number(t):T.superSet(Ss,this,"dataSource",t)}),g(0,t,"value",function(){return this._value},function(t){if(this._value!=t){var e=this._value;this._value=t,this.changeValue(),this._value!=e&&this.sendChangeEvent()}}),g(0,t,"allowClickBack",function(){return this._allowClickBack},function(t){this._allowClickBack!=t&&((this._allowClickBack=t)?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),g(0,t,"min",function(){return this._min},function(t){this._min!=t&&(this._min=t,this.callLater(this.changeValue))}),g(0,t,"max",function(){return this._max},function(t){this._max!=t&&(this._max=t,this.callLater(this.changeValue))}),g(0,t,"tick",function(){return this._tick},function(t){this._tick!=t&&(this._tick=t,this.callLater(this.changeValue))}),g(0,t,"sizeGrid",function(){return this._bg.sizeGrid},function(t){this._bg.sizeGrid=t,this._bar.sizeGrid=t,this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid)}),g(0,t,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this._skin&&!Hn.getRes(this._skin)?T.loader.load([this._skin,this._skin.replace(".png","$bar.png")],y.create(this,this._skinLoaded)):this._skinLoaded())}),E(i,["label",function(){return this.label=new na}]),i}(Ss),na=function(e){function i(t){this._tf=null,i.__super.call(this),void 0===t&&(t=""),this.text=t}I(i,"laya.ui.Label",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._tf=null},t.createChildren=function(){this.addChild(this._tf=new Os)},t.changeText=function(t){this._tf.changeText(t)},t.measureWidth=function(){return this._tf.width},t.measureHeight=function(){return this._tf.height},g(0,t,"underlineColor",function(){return this._tf.underlineColor},function(t){this._tf.underlineColor=t}),g(0,t,"underline",function(){return this._tf.underline},function(t){this._tf.underline=t}),g(0,t,"overflow",function(){return this._tf.overflow},function(t){this._tf.overflow=t}),g(0,t,"stroke",function(){return this._tf.stroke},function(t){this._tf.stroke=t}),g(0,t,"width",function(){return this._width||this._tf.text?T.superGet(Ss,this,"width"):0},function(t){T.superSet(Ss,this,"width",t),this._tf.width=t}),g(0,t,"textField",function(){return this._tf}),g(0,t,"borderColor",function(){return this._tf.borderColor},function(t){this._tf.borderColor=t}),g(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.text=t+"":T.superSet(Ss,this,"dataSource",t)}),g(0,t,"strokeColor",function(){return this._tf.strokeColor},function(t){this._tf.strokeColor=t}),g(0,t,"padding",function(){return this._tf.padding.join(",")},function(t){this._tf.padding=be.fillArray(de.labelPadding,t,Number)}),g(0,t,"bgColor",function(){return this._tf.bgColor},function(t){this._tf.bgColor=t}),g(0,t,"align",function(){return this._tf.align},function(t){this._tf.align=t}),g(0,t,"color",function(){return this._tf.color},function(t){this._tf.color=t}),g(0,t,"fontSize",function(){return this._tf.fontSize},function(t){this._tf.fontSize=t}),g(0,t,"valign",function(){return this._tf.valign},function(t){this._tf.valign=t}),g(0,t,"font",function(){return this._tf.font},function(t){this._tf.font=t}),g(0,t,"leading",function(){return this._tf.leading},function(t){this._tf.leading=t}),g(0,t,"bold",function(){return this._tf.bold},function(t){this._tf.bold=t}),g(0,t,"italic",function(){return this._tf.italic},function(t){this._tf.italic=t}),g(0,t,"wordWrap",function(){return this._tf.wordWrap},function(t){this._tf.wordWrap=t}),g(0,t,"height",function(){return this._height||this._tf.text?T.superGet(Ss,this,"height"):0},function(t){T.superSet(Ss,this,"height",t),this._tf.height=t}),g(0,t,"text",function(){return this._tf.text},function(t){this._tf.text!=t&&(t&&(t=be.adptString(t+"")),this._tf.text=t,this.event("change"),this._width&&this._height||this.onCompResize())}),i}(Ss),ra=function(e){function i(t){this._bitmap=null,this._skin=null,this._group=null,i.__super.call(this),this.skin=t}I(i,"laya.ui.Image",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null},t.dispose=function(){this.destroy(!0),T.loader.clearRes(this._skin)},t.createChildren=function(){this.graphics=this._bitmap=new ur,this._bitmap.autoCacheCmd=!1},t.setSource=function(t,e){t===this._skin&&e&&(this.source=e,this.onCompResize())},t.measureWidth=function(){return this._bitmap.width},t.measureHeight=function(){return this._bitmap.height},g(0,t,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(t){this._bitmap.sizeGrid=be.fillArray(de.defaultSizeGrid,t,Number)}),g(0,t,"group",function(){return this._group},function(t){t&&this._skin&&Hn.setGroup(this._skin,t),this._group=t}),g(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"string"==typeof(this._dataSource=t)?this.skin=t:T.superSet(Ss,this,"dataSource",t)}),g(0,t,"source",function(){return this._bitmap.source},function(t){this._bitmap&&(this._bitmap.source=t,this.event("loaded"),this.repaint())}),g(0,t,"height",e.prototype._$get_height,function(t){T.superSet(Ss,this,"height",t),this._bitmap.height=0==t?1e-7:t}),g(0,t,"width",e.prototype._$get_width,function(t){T.superSet(Ss,this,"width",t),this._bitmap.width=0==t?1e-7:t}),g(0,t,"skin",function(){return this._skin},function(t){if(this._skin!=t)if(this._skin=t){var e=Hn.getRes(t);e?(this.source=e,this.onCompResize()):T.loader.load(this._skin,y.create(this,this.setSource,[this._skin]),null,"image",1,!0,this._group)}else this.source=null}),i}(Ss),sa=function(e){function i(t,e){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,i.__super.call(this),this._itemColors=de.comboBoxItemColors,this.skin=t,this.labels=e}I(i,"laya.ui.ComboBox",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._button&&this._button.destroy(t),this._list&&this._list.destroy(t),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},t.createChildren=function(){this.addChild(this._button=new ta),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},t._createList=function(){this._list=new Da,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},t._setListEvent=function(t){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=y.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},t.onListDown=function(t){t.stopPropagation()},t.onScrollBarDown=function(t){t.stopPropagation()},t.onButtonMouseDown=function(t){this.callLater(this.switchTo,[!this._isOpen])},t.measureWidth=function(){return this._button.width},t.measureHeight=function(){return this._button.height},t.changeList=function(){this._listChanged=!1;var t=this.width-2,e=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:t,height:this._itemHeight,fontSize:this._itemSize,color:e}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},t.onlistItemMouse=function(t,e){var i=t.type;if("mouseover"===i||"mouseout"===i){if(this._isCustomList)return;var n=this._list.getCell(e);if(!n)return;var r=n.getChildByName("label");r&&(r.color="mouseover"===i?(r.bgColor=this._itemColors[0],this._itemColors[1]):(r.bgColor=null,this._itemColors[2]))}else"click"===i&&(this.selectedIndex=e,this.isOpen=!1)},t.switchTo=function(t){this.isOpen=t},t.changeOpen=function(){this.isOpen=!this._isOpen},t.changeItem=function(){if(this._itemChanged=!1,this._listHeight=0<this._labels.length?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var t=this._list.graphics;t.clear(!0),t.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}for(var e=this._list.array||[],i=e.length=0,n=this._labels.length;i<n;i++)e.push({label:this._labels[i]});this._list.height=this._listHeight,this._list.array=e},t.changeSelected=function(){this._button.label=this.selectedLabel},t._onStageMouseWheel=function(t){this._list&&!this._list.contains(t.target)&&this.removeList(null)},t.removeList=function(t){T.stage.off("mousedown",this,this.removeList),T.stage.off("mousewheel",this,this._onStageMouseWheel),this.isOpen=!1},g(0,t,"labelBold",function(){return this._button.text.bold},function(t){this._button.text.bold=t}),g(0,t,"labelSize",function(){return this._button.text.fontSize},function(t){this._button.text.fontSize=t}),g(0,t,"list",function(){return this._list||this._createList(),this._list},function(t){t&&(t.removeSelf(),this._isCustomList=!0,this._list=t,this._setListEvent(t),this._itemHeight=t.getCell(0).height+t.spaceY)}),g(0,t,"button",function(){return this._button}),g(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t?this.selectedIndex=parseInt(t):t instanceof Array?this.labels=t.join(","):T.superSet(Ss,this,"dataSource",t)}),g(0,t,"scrollBar",function(){return this.list.scrollBar}),g(0,t,"labelPadding",function(){return this._button.text.padding.join(",")},function(t){this._button.text.padding=be.fillArray(de.labelPadding,t,Number)}),g(0,t,"scrollBarSkin",function(){return this._scrollBarSkin},function(t){this._scrollBarSkin=t}),g(0,t,"isOpen",function(){return this._isOpen},function(t){if(this._isOpen!=t)if(this._isOpen=t,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var e=this.localToGlobal(R.TEMP.setTo(0,0)),i=e.y+this._button.height;i=i+this._listHeight<=T.stage.height?i:e.y-this._listHeight,this._list.pos(e.x,i),this._list.zOrder=1001,T._currentStage.addChild(this._list),T.stage.once("mousedown",this,this.removeList),T.stage.on("mousewheel",this,this._onStageMouseWheel),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),g(0,t,"labelColors",function(){return this._button.labelColors},function(t){this._button.labelColors!=t&&(this._button.labelColors=t)}),g(0,t,"visibleNum",function(){return this._visibleNum},function(t){this._visibleNum=t,this._listChanged=!0}),g(0,t,"selectedLabel",function(){return-1<this._selectedIndex&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function(t){this.selectedIndex=this._labels.indexOf(t)}),g(0,t,"sizeGrid",function(){return this._button.sizeGrid},function(t){this._button.sizeGrid=t}),g(0,t,"selectedIndex",function(){return this._selectedIndex},function(t){this._selectedIndex!=t&&(this._selectedIndex=t,0<this._labels.length?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[rt.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),g(0,t,"itemSize",function(){return this._itemSize},function(t){this._itemSize=t,this._listChanged=!0}),g(0,t,"stateNum",function(){return this._button.stateNum},function(t){this._button.stateNum=t}),g(0,t,"labelFont",function(){return this._button.text.font},function(t){this._button.text.font=t}),g(0,t,"labels",function(){return this._labels.join(",")},function(t){0<this._labels.length&&(this.selectedIndex=-1),t?this._labels=t.split(","):this._labels.length=0,this._itemChanged=!0}),g(0,t,"itemColors",function(){return String(this._itemColors)},function(t){this._itemColors=be.fillArray(this._itemColors,t,String),this._listChanged=!0}),g(0,t,"selectHandler",function(){return this._selectHandler},function(t){this._selectHandler=t}),g(0,t,"height",e.prototype._$get_height,function(t){T.superSet(Ss,this,"height",t),this._button.height=this._height}),g(0,t,"width",e.prototype._$get_width,function(t){T.superSet(Ss,this,"width",t),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),g(0,t,"skin",function(){return this._button.skin},function(t){this._button.skin!=t&&(this._button.skin=t,this._listChanged=!0)}),i}(Ss),aa=function(e){function f(t,e){f.__super.call(this,e),this._meshFilter=new Mi(this),this._render=new zs(this),t&&(this._meshFilter.sharedMesh=t)}I(f,"laya.d3.core.SkinnedMeshSprite3D",e);var t=f.prototype;return t._parse=function(t,e){laya.d3.core.Sprite3D.prototype._parse.call(this,t,e);var i=this.skinnedMeshRenderer,n=t.lightmapIndex;null!=n&&(i.lightmapIndex=n);var r,s=t.lightmapScaleOffset;if(s&&(i.lightmapScaleOffset=new on(s[0],s[1],s[2],s[3])),r=t.meshPath){var a=Hn.getRes(r);a&&(this.meshFilter.sharedMesh=a)}var o=t.materials;if(o){var h=i.sharedMaterials,l=o.length;h.length=l;for(var u=0;u<l;u++)h[u]=Hn.getRes(o[u].path);i.sharedMaterials=h}var c=t.boundBox,_=c.min,d=c.max;if(i.localBounds.setMin(new ln(_[0],_[1],_[2])),i.localBounds.setMax(new ln(d[0],d[1],d[2])),e){var f=t.rootBone;i.rootBone=e[f];var p,m=t.bones;for(u=0,p=m.length;u<p;u++)i.bones.push(e[m[u]])}else t.rootBone&&i._setRootBone(t.rootBone)},t._changeHierarchyAnimator=function(t){e.prototype._changeHierarchyAnimator.call(this,t),this.skinnedMeshRenderer._setCacheAnimator(t)},t._changeAnimatorAvatar=function(t){this.skinnedMeshRenderer._setCacheAvatar(t)},t._cloneTo=function(t,e,i){var n=t;n.meshFilter.sharedMesh=this.meshFilter.sharedMesh;var r=this._render,s=n._render;s.enable=r.enable,s.sharedMaterials=r.sharedMaterials,s.castShadow=r.castShadow;var a=r.lightmapScaleOffset;a&&(s.lightmapScaleOffset=a.clone()),s.receiveShadow=r.receiveShadow,s.sortingFudge=r.sortingFudge,s._rootBone=r._rootBone;var o=r.bones,h=s.bones,l=o.length;h.length=l;var u=r.rootBone;if(u){var c=V._getHierarchyPath(e,u,f._tempArray0);s.rootBone=c?V._getNodeByHierarchyPath(i,c):u}for(var _=0;_<o.length;_++)c=V._getHierarchyPath(e,o[_],f._tempArray0),h[_]=c?V._getNodeByHierarchyPath(i,c):o[_];var d=r.localBounds;d&&d.cloneTo(s.localBounds),laya.d3.core.Sprite3D.prototype._cloneTo.call(this,t,e,i)},t.destroy=function(t){void 0===t&&(t=!0),this.destroyed||(e.prototype.destroy.call(this,t),this._meshFilter.destroy())},g(0,t,"skinnedMeshRenderer",function(){return this._render}),g(0,t,"meshFilter",function(){return this._meshFilter}),f.__init__=function(){f.SHADERDEFINE_BONE=f.shaderDefines.registerDefine("BONE")},f._tempArray0=[],f.SHADERDEFINE_BONE=0,E(f,["BONES",function(){return this.BONES=We.propertyNameToID("u_Bones")},"shaderDefines",function(){return this.shaderDefines=new ii(pa.shaderDefines)}]),f}(Is),oa=function(e){function n(t,e,i){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._complete=null,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,this._toIndex=-1,n.__super.call(this),void 0===e&&(e=1),void 0===i&&(i=1),this._clipX=e,this._clipY=i,this.skin=t}I(n,"laya.ui.Clip",e);var t=n.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},t.dispose=function(){this.destroy(!0),T.loader.clearRes(this._skin)},t.createChildren=function(){this.graphics=this._bitmap=new ur},t._onDisplay=function(t){this._isPlaying?this._getBit(128)?this.play():this.stop():this._autoPlay&&this.play()},t._skinLoaded=function(){this._setClipChanged(),this._sizeChanged(),this.event("loaded")},t.changeClip=function(){if(this._clipChanged=!1,this._skin){var t=Hn.getRes(this._skin);t?this.loadComplete(this._skin,t):T.loader.load(this._skin,y.create(this,this.loadComplete,[this._skin]))}},t.loadComplete=function(t,e){if(t===this._skin&&e){var i=this._clipWidth||Math.ceil(e.sourceWidth/this._clipX),n=this._clipHeight||Math.ceil(e.sourceHeight/this._clipY),r=this._skin+i+n,s=mn.I.get(r);if(nt.isOkTextureList(s)||(s=null),s)this._sources=s;else{this._sources=[];for(var a=0;a<this._clipY;a++)for(var o=0;o<this._clipX;o++)this._sources.push(xr.createFromTexture(e,i*o,n*a,i,n));mn.I.set(r,this._sources)}this.index=this._index,this.event("loaded"),this.onCompResize()}},t.measureWidth=function(){return this.runCallLater(this.changeClip),this._bitmap.width},t.measureHeight=function(){return this.runCallLater(this.changeClip),this._bitmap.height},t.play=function(t,e){void 0===t&&(t=0),void 0===e&&(e=-1),this._isPlaying=!0,this.index=t,this._toIndex=e,this._index++,T.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},t._loop=function(){this._visible&&this._sources&&(this._index++,-1<this._toIndex&&this._index>=this._toIndex?this.stop():this._index>=this._sources.length&&(this._index=0),this.index=this._index)},t.stop=function(){this._isPlaying=!1,T.timer.clear(this,this._loop),this.event("complete")},t._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},g(0,t,"bitmap",function(){return this._bitmap}),g(0,t,"interval",function(){return this._interval},function(t){this._interval!=t&&(this._interval=t,this._isPlaying&&this.play())}),g(0,t,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),g(0,t,"height",e.prototype._$get_height,function(t){T.superSet(Ss,this,"height",t),this._bitmap.height=t}),g(0,t,"clipWidth",function(){return this._clipWidth},function(t){this._clipWidth=t,this._setClipChanged()}),g(0,t,"group",function(){return this._group},function(t){t&&this._skin&&Hn.setGroup(this._skin,t),this._group=t}),g(0,t,"clipHeight",function(){return this._clipHeight},function(t){this._clipHeight=t,this._setClipChanged()}),g(0,t,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(t){this._bitmap.sizeGrid=be.fillArray(de.defaultSizeGrid,t,Number)}),g(0,t,"index",function(){return this._index},function(t){this._index=t,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[t]),this.event("change")}),g(0,t,"sources",function(){return this._sources},function(t){this._sources=t,this.index=this._index,this.event("loaded")}),g(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t?this.index=parseInt(t):T.superSet(Ss,this,"dataSource",t)}),g(0,t,"clipY",function(){return this._clipY},function(t){this._clipY=t||1,this._setClipChanged()}),g(0,t,"clipX",function(){return this._clipX},function(t){this._clipX=t||1,this._setClipChanged()}),g(0,t,"autoPlay",function(){return this._autoPlay},function(t){this._autoPlay!=t&&((this._autoPlay=t)?this.play():this.stop())}),g(0,t,"width",e.prototype._$get_width,function(t){T.superSet(Ss,this,"width",t),this._bitmap.width=t}),g(0,t,"isPlaying",function(){return this._isPlaying},function(t){this._isPlaying=t}),g(0,t,"skin",function(){return this._skin},function(t){this._skin!=t&&((this._skin=t)?Hn.getRes(t)?this._skinLoaded():T.loader.load(this._skin,y.create(this,this._skinLoaded),null,"image",1):this._bitmap.source=null)}),n}(Ss),ha=function(t){function s(t,e,i,n,r){this._params2dQuick2=null,this._shaderValueWidth=0,this._shaderValueHeight=0,s.__super.call(this,t,e,i,n,r)}I(s,"laya.webgl.shader.d2.Shader2X",t);var e=s.prototype;return e._disposeResource=function(){t.prototype._disposeResource.call(this),this._params2dQuick2=null},e.upload2dQuick2=function(t){this.upload(t,this._params2dQuick2||this._make2dQuick2())},e._make2dQuick2=function(){if(!this._params2dQuick2){this._params2dQuick2=[];for(var t,e=this._params,i=0,n=e.length;i<n;i++)"size"!==(t=e[i]).name&&this._params2dQuick2.push(t)}return this._params2dQuick2},s.create=function(t,e,i,n,r){return new s(t,e,i,n,r)},s}(As),la=function(i){function s(){this._range=NaN,this._lightMatrix=new gt,s.__super.call(this),this._range=6}I(s,"laya.d3.core.light.PointLight",i);var t=s.prototype;return t._onActive=function(){i.prototype._onActive.call(this),this._lightmapBakedType!==Ms.LIGHTMAPBAKEDTYPE_BAKED&&this._scene._defineDatas.add(Rs.SHADERDEFINE_POINTLIGHT)},t._onInActive=function(){i.prototype._onInActive.call(this),this._lightmapBakedType!==Ms.LIGHTMAPBAKEDTYPE_BAKED&&this._scene._defineDatas.remove(Rs.SHADERDEFINE_POINTLIGHT)},t._prepareToScene=function(){var t=this._scene;if(t.enableLight&&this.activeInHierarchy){t._defineDatas;var e=t._shaderValues;ln.scale(this.color,this._intensity,this._intensityColor),e.setVector3(Rs.POINTLIGHTCOLOR,this._intensityColor),e.setVector3(Rs.POINTLIGHTPOS,this.transform.position),e.setNumber(Rs.POINTLIGHTRANGE,this.range);var i=this._lightMatrix,n=i.elements;i.identity(),n[0]=n[5]=n[10]=1/this._range;var r=s._tempMatrix0;return this.transform.worldMatrix.invert(r),gt.multiply(i,r,i),e.setMatrix4x4(Rs.POINTLIGHTMATRIX,i),!0}return!1},t._parse=function(t,e){i.prototype._parse.call(this,t,e),this.range=t.range},g(0,t,"range",function(){return this._range},function(t){this._range=t}),E(s,["_tempMatrix0",function(){return this._tempMatrix0=new gt}]),s}(Ms),ua=function(e){function i(t){this.rollRatio=.97,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,this.isLockedFun=null,this.triggerDownDragLimit=null,this.triggerUpDragLimit=null,i.__super.call(this),this._showButtons=qe.showButtons,this._touchScrollEnable=qe.touchScrollEnable,this._mouseWheelEnable=qe.mouseWheelEnable,this.skin=t,this.max=1}I(i,"laya.ui.ScrollBar",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),this.stopScroll(),this.target=null,e.prototype.destroy.call(this,t),this.upButton&&this.upButton.destroy(t),this.downButton&&this.downButton.destroy(t),this.slider&&this.slider.destroy(t),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},t.createChildren=function(){this.addChild(this.slider=new ia),this.addChild(this.upButton=new ta),this.addChild(this.downButton=new ta)},t.initialize=function(){this.slider.showLabel=!1,this.slider.tick=0,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},t.onSliderChange=function(){this._value!=this.slider.value&&(this.value=this.slider.value)},t.onButtonMouseDown=function(t){var e=t.currentTarget===this.upButton;this.slide(e),T.timer.once(de.scrollBarDelayTime,this,this.startLoop,[e]),T.stage.once("mouseup",this,this.onStageMouseUp)},t.startLoop=function(t){T.timer.frameLoop(1,this,this.slide,[t])},t.slide=function(t){t?this.value-=this._scrollSize:this.value+=this._scrollSize},t.onStageMouseUp=function(t){T.timer.clear(this,this.startLoop),T.timer.clear(this,this.slide)},t._skinLoaded=function(){this.slider.skin=this._skin,this.callLater(this.changeScrollBar),this._sizeChanged(),this.event("loaded")},t.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions(),this.repaint()},t._sizeChanged=function(){e.prototype._sizeChanged.call(this),this.repaint(),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},t.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},t.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider._y+this.slider.height:this.downButton.x=this.slider._x+this.slider.width},t.measureWidth=function(){return this.slider.isVertical?this.slider.width:100},t.measureHeight=function(){return this.slider.isVertical?100:this.slider.height},t.setScroll=function(t,e,i){this.runCallLater(this._sizeChanged),this.slider.setSlider(t,e,i),this.slider.bar.visible=0<e,!this._hide&&this.autoHide&&(this.visible=!1)},t.onTargetMouseWheel=function(t){this.value-=t.delta*this._scrollSize,this.target=this._target},t.onTargetMouseDown=function(t){this.isLockedFun&&!this.isLockedFun(t)||(this.event("end"),this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new R),this._lastPoint.setTo(T.stage.mouseX,T.stage.mouseY),T.timer.clear(this,this.tweenMove),Ii.clearTween(this),T.stage.once("mouseup",this,this.onStageMouseUp2),T.stage.once("mouseout",this,this.onStageMouseUp2),T.timer.frameLoop(1,this,this.loop))},t.startDragForce=function(){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new R),this._lastPoint.setTo(T.stage.mouseX,T.stage.mouseY),T.timer.clear(this,this.tweenMove),Ii.clearTween(this),T.stage.once("mouseup",this,this.onStageMouseUp2),T.stage.once("mouseout",this,this.onStageMouseUp2),T.timer.frameLoop(1,this,this.loop)},t.cancelDragOp=function(){T.stage.off("mouseup",this,this.onStageMouseUp2),T.stage.off("mouseout",this,this.onStageMouseUp2),T.timer.clear(this,this.tweenMove),T.timer.clear(this,this.loop),this._target.mouseEnabled=!0},t.checkTriggers=function(t){return void 0===t&&(t=!1),0<=this.value&&this.value-this._lastOffset<=0&&this.triggerDownDragLimit&&this.triggerDownDragLimit(t)?(this.cancelDragOp(),!(this.value=0)):!!(this.value<=this.max&&this.value-this._lastOffset>=this.max&&this.triggerUpDragLimit&&this.triggerUpDragLimit(t))&&(this.cancelDragOp(),this.value=this.max,!0)},t.startTweenMoveForce=function(t){this._lastOffset=t,T.timer.frameLoop(1,this,this.tweenMove,[200])},t.loop=function(){var t=T.stage.mouseY,e=T.stage.mouseX;if(this._lastOffset=this.isVertical?t-this._lastPoint.y:e-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?T.stage._canvasTransform.getScaleY():T.stage._canvasTransform.getScaleX()))))return;if(this._clickOnly=!1,this.checkTriggers())return;this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}else if(this.checkTriggers())return;this._offsets.push(this._lastOffset),this._lastPoint.x=e,this._lastPoint.y=t,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?0<this._lastOffset?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):(this.value-=.5*this._lastOffset,this._value>=this.min&&(this._checkElastic=!1)):this._value>=this.max&&(this._lastOffset<0?this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance):(this.value-=.5*this._lastOffset,this._value<=this.max&&(this._checkElastic=!1))):this.value-=this._lastOffset)},t.onStageMouseUp2=function(t){if(T.stage.off("mouseup",this,this.onStageMouseUp2),T.stage.off("mouseout",this,this.onStageMouseUp2),T.timer.clear(this,this.loop),!(this._clickOnly&&this._value>=this.min&&this._value<=this.max))if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?Ii.to(this,{value:this.min},this.elasticBackTime,Ue.sineOut,y.create(this,this.elasticOver)):this._value>this.max&&Ii.to(this,{value:this.max},this.elasticBackTime,Ue.sineOut,y.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?T.stage.mouseY-this._lastPoint.y:T.stage.mouseX-this._lastPoint.x);for(var e=0,i=Math.min(this._offsets.length,3),n=0;n<i;n++)e+=this._offsets[this._offsets.length-1-n];if(this._lastOffset=e/i,(e=Math.abs(this._lastOffset))<2)return void this.event("end");250<e&&(this._lastOffset=0<this._lastOffset?250:-250);var r=Math.round(Math.abs(this.elasticDistance*(this._lastOffset/150)));T.timer.frameLoop(1,this,this.tweenMove,[r])}},t.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&Ii.to(this,{alpha:0},500),this.event("end")},t.tweenMove=function(t){if(this._lastOffset*=this.rollRatio,!this.checkTriggers(!0)){var e=NaN;if(0<t&&(0<this._lastOffset&&this.value<=this.min?(this._isElastic=!0,e=.5*-(this.min-t-this.value),this._lastOffset>e&&(this._lastOffset=e)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,e=.5*-(this.max+t-this.value),this._lastOffset<e&&(this._lastOffset=e))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<.1){if(T.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?Ii.to(this,{value:this.min},this.elasticBackTime,Ue.sineOut,y.create(this,this.elasticOver)):this._value>this.max?Ii.to(this,{value:this.max},this.elasticBackTime,Ue.sineOut,y.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&Ii.to(this,{alpha:0},500)}}},t.stopScroll=function(){this.onStageMouseUp2(null),T.timer.clear(this,this.tweenMove),Ii.clearTween(this)},g(0,t,"lastOffset",function(){return this._lastOffset}),g(0,t,"mouseWheelEnable",function(){return this._mouseWheelEnable},function(t){this._mouseWheelEnable=t,this.target=this._target}),g(0,t,"touchScrollEnable",function(){return this._touchScrollEnable},function(t){this._touchScrollEnable=t,this.target=this._target}),g(0,t,"hide",function(){return this._hide},function(t){this._hide=t,this.visible=!t}),g(0,t,"showButtons",function(){return this._showButtons},function(t){this._showButtons=t,this.callLater(this.changeScrollBar)}),g(0,t,"max",function(){return this.slider.max},function(t){this.slider.max=t}),g(0,t,"thumbPercent",function(){return this._thumbPercent},function(t){this.runCallLater(this.changeScrollBar),this.runCallLater(this._sizeChanged),t=1<=t?.99:t,this._thumbPercent=t,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*t,de.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*t,de.scrollBarMinNum))}),g(0,t,"scrollSize",function(){return this._scrollSize},function(t){this._scrollSize=t}),g(0,t,"sizeGrid",function(){return this.slider.sizeGrid},function(t){this.slider.sizeGrid=t}),g(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.value=Number(t):T.superSet(Ss,this,"dataSource",t)}),g(0,t,"value",function(){return this._value},function(t){t!==this._value&&(this._value=t,this._isElastic||(this.slider._value!=t&&(this.slider._value=t,this.slider.changeValue()),this._value=this.slider._value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this._value))}),g(0,t,"min",function(){return this.slider.min},function(t){this.slider.min=t}),g(0,t,"tick",function(){return this.slider.tick},function(t){this.slider.tick=t}),g(0,t,"target",function(){return this._target},function(t){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),(this._target=t)&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),g(0,t,"isVertical",function(){return this.slider.isVertical},function(t){this.slider.isVertical=t}),g(0,t,"skin",function(){return this._skin},function(t){" "!=t&&this._skin!=t&&(this._skin=t,this._skin&&!Hn.getRes(this._skin)?T.loader.load([this._skin,this._skin.replace(".png","$up.png"),this._skin.replace(".png","$down.png"),this._skin.replace(".png","$bar.png")],y.create(this,this._skinLoaded)):this._skinLoaded())}),i}(Ss),ca=function(e){function h(t,e,i,n,r,s,a,o){this._terrainFilter=null,h.__super.call(this,o),this._terrainFilter=new $n(this,t,e,i,n,r,s,a),this._render=new us(this)}I(h,"laya.d3.terrain.TerrainChunk",e);var t=h.prototype;return t.buildRenderElementAndMaterial=function(t,e,i,n,r,s,a,o,h,l,u,c,_,d,f,p,m,g){void 0===u&&(u=1),void 0===c&&(c=1),void 0===_&&(_=1),void 0===d&&(d=1),void 0===f&&(f=1),void 0===p&&(p=1),void 0===m&&(m=1),void 0===g&&(g=1);var v=new Gs;h&&(v.diffuseColor=h),o&&(v.ambientColor=o),l&&(v.specularColor=l),v.splatAlphaTexture=Hn.getRes(i),v.normalTexture=e?Hn.getRes(e):null,v.diffuseTexture1=n?Hn.getRes(n):null,v.diffuseTexture2=r?Hn.getRes(r):null,v.diffuseTexture3=s?Hn.getRes(s):null,v.diffuseTexture4=a?Hn.getRes(a):null,v.setDiffuseScale1(u,c),v.setDiffuseScale2(_,d),v.setDiffuseScale3(f,p),v.setDiffuseScale4(m,g),v.setDetailNum(t),0!=this._render._renderElements.length&&(v.renderMode=2);var T=new Wi;T.setTransform(this._transform),T.render=this._render,T.setGeometry(this._terrainFilter),this._render._renderElements.push(T),this._render.sharedMaterial=v},t._cloneTo=function(t,e,i){console.log("Terrain Chunk can't clone")},t.destroy=function(t){void 0===t&&(t=!0),this.destroyed||(e.prototype.destroy.call(this,t),this._terrainFilter.destroy(),this._terrainFilter=null)},g(0,t,"terrainRender",function(){return this._render}),g(0,t,"terrainFilter",function(){return this._terrainFilter}),h}(Is),_a=function(e){function t(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,t.__super.call(this)}I(t,"laya.ui.ColorPicker",e);var i=t.prototype;return i.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._colorPanel&&this._colorPanel.destroy(t),this._colorButton&&this._colorButton.destroy(t),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},i.createChildren=function(){this.addChild(this._colorButton=new ta),this._colorPanel=new Qs,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new ts),this._colorPanel.addChild(this._colorBlock=new ts),this._colorPanel.addChild(this._colorInput=new Ta)},i.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},i.onPanelMouseDown=function(t){t.stopPropagation()},i.changePanel=function(){this._panelChanged=!1;var t=this._colorPanel.graphics;t.clear(!0),t.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,(t=this._colorTiles.graphics).clear(!0);for(var e=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],i=0;i<12;i++)for(var n=0;n<20;n++){var r=0;r=0===n?e[i]:1===n?0:51*(((3*i+n/6)%3<<0)+3*(i/6<<0))<<16|n%6*51<<8|(i<<0)%6*51;var s=be.toColor(r);this._colors.push(s);var a=n*this._gridSize,o=i*this._gridSize;t.drawRect(a,o,this._gridSize,this._gridSize,s,"#000000")}},i.onColorButtonClick=function(t){this._colorPanel.parent?this.close():this.open()},i.open=function(){var t=this.localToGlobal(new R),e=t.x+this._colorPanel.width<=T.stage.width?t.x:T.stage.width-this._colorPanel.width,i=t.y+this._colorButton.height;i=i+this._colorPanel.height<=T.stage.height?i:t.y-this._colorPanel.height,this._colorPanel.pos(e,i),this._colorPanel.zOrder=1001,T._currentStage.addChild(this._colorPanel),T.stage.on("mousedown",this,this.removeColorBox)},i.close=function(){T.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},i.removeColorBox=function(t){this.close()},i.onColorFieldKeyDown=function(t){13==t.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),t.stopPropagation())},i.onColorInputChange=function(t){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},i.onColorTilesClick=function(t){this.selectedColor=this.getColorByMouse(),this.close()},i.onColorTilesMouseMove=function(t){this._colorInput.focus=!1;var e=this.getColorByMouse();this._colorInput.text=e,this.drawBlock(e)},i.getColorByMouse=function(){var t=this._colorTiles.getMousePoint(),e=Math.floor(t.x/this._gridSize),i=Math.floor(t.y/this._gridSize);return this._colors[20*i+e]},i.drawBlock=function(t){var e=this._colorBlock.graphics;e.clear(!0);var i=t||"#ffffff";e.drawRect(0,0,50,20,i,this._borderColor),t||e.drawLine(0,0,50,20,"#ff0000")},i.changeColor=function(){var t=this.graphics;t.clear(!0);var e=this._selectedColor||"#000000";t.drawRect(0,0,this._colorButton.width,this._colorButton.height,e)},i._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},g(0,i,"inputBgColor",function(){return this._inputBgColor},function(t){this._inputBgColor=t,this._setPanelChanged()}),g(0,i,"inputColor",function(){return this._inputColor},function(t){this._inputColor=t,this._setPanelChanged()}),g(0,i,"bgColor",function(){return this._bgColor},function(t){this._bgColor=t,this._setPanelChanged()}),g(0,i,"skin",function(){return this._colorButton.skin},function(t){this._colorButton.once("loaded",this,this.changeColor),this._colorButton.skin=t}),g(0,i,"borderColor",function(){return this._borderColor},function(t){this._borderColor=t,this._setPanelChanged()}),g(0,i,"selectedColor",function(){return this._selectedColor},function(t){this._selectedColor!=t&&(this._selectedColor=this._colorInput.text=t,this.drawBlock(t),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",rt.EMPTY.setTo("change",this,this)))}),t}(Ss),da=function(t){function r(t,e,i,n){void(this._mgrKey=0)===i&&(i=0),void 0===n&&(n=0),r.__super.call(this,i,!1),this._glTextureType=3553,this._width=t,this._height=e,this._depthStencilFormat=n,this._create(t,e),this.lock=!0}I(r,"laya.resource.RenderTexture2D",Cs);var e=r.prototype;return e.getIsReady=function(){return!0},e._create=function(t,e){var i=Nt.instance;this._frameBuffer=i.createFramebuffer(),j.bindTexture(i,this._glTextureType,this._glTexture);var n=this._getGLFormat();if(i.texImage2D(this._glTextureType,0,n,t,e,0,n,5121,null),this._setGPUMemory(t*e*4),i.bindFramebuffer(36160,this._frameBuffer),i.framebufferTexture2D(36160,36064,3553,this._glTexture,0),3!==this._depthStencilFormat)switch(this._depthStencilBuffer=i.createRenderbuffer(),i.bindRenderbuffer(36161,this._depthStencilBuffer),this._depthStencilFormat){case 0:i.renderbufferStorage(36161,33189,t,e),i.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 1:i.renderbufferStorage(36161,36168,t,e),i.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 2:i.renderbufferStorage(36161,34041,t,e),i.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}i.bindFramebuffer(36160,null),i.bindRenderbuffer(36161,null),this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode),this._setAnisotropy(this._anisoLevel),this._readyed=!0,this._activeResource()},e.generateMipmap=function(){this._isPot(this.width)&&this._isPot(this.height)?(this._mipmap=!0,Nt.instance.generateMipmap(this._glTextureType),this._setFilterMode(this._filterMode),this._setGPUMemory(this.width*this.height*4*(1+1/3))):(this._mipmap=!1,this._setGPUMemory(this.width*this.height*4))},e.start=function(){var t=Nt.instance;Nt.instance.bindFramebuffer(36160,this._frameBuffer),this._lastRT=r._currentActive,(r._currentActive=this)._readyed=!0,t.viewport(0,0,this._width,this._height),this._lastWidth=Q.width,this._lastHeight=Q.height,Q.width=this._width,Q.height=this._height,rs.activeShader=null},e.end=function(){Nt.instance.bindFramebuffer(36160,null),r._currentActive=null,this._readyed=!0},e.restore=function(){var t=Nt.instance;this._lastRT!=r._currentActive&&(Nt.instance.bindFramebuffer(36160,this._lastRT?this._lastRT._frameBuffer:null),r._currentActive=this._lastRT),this._readyed=!0,t.viewport(0,0,this._lastWidth,this._lastHeight),Q.width=this._lastWidth,Q.height=this._lastHeight,rs.activeShader=null},e.clear=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1);var r=Nt.instance;r.clearColor(t,e,i,n);var s=16384;switch(this._depthStencilFormat){case 33189:s|=256;break;case 36168:s|=1024;break;case 34041:s|=256,s|=1024}r.clear(s)},e.getData=function(t,e,i,n){if(qi.isConchApp&&2==conchConfig.threadMode)throw"native 2 thread mode use getDataAsync";var r=Nt.instance;if(r.bindFramebuffer(36160,this._frameBuffer),!(36053===r.checkFramebufferStatus(36160)))return r.bindFramebuffer(36160,null),null;var s=new Uint8Array(this._width*this._height*4),a=this._getGLFormat();return r.readPixels(t,e,i,n,a,5121,s),r.bindFramebuffer(36160,null),s},e.getDataAsync=function(t,e,i,n,r){var s=Nt.instance;s.bindFramebuffer(36160,this._frameBuffer),s.readPixelsAsync(t,e,i,n,6408,5121,function(t){r(new Uint8Array(t))}),s.bindFramebuffer(36160,null)},e.recycle=function(){},e._disposeResource=function(){if(this._frameBuffer){var t=Nt.instance;t.deleteTexture(this._glTexture),t.deleteFramebuffer(this._frameBuffer),t.deleteRenderbuffer(this._depthStencilBuffer),this._glTexture=null,this._frameBuffer=null,this._depthStencilBuffer=null,this._setGPUMemory(0)}},g(0,e,"offsetX",function(){return 0}),g(0,e,"sourceHeight",function(){return this._height}),g(0,e,"defaulteTexture",function(){return ea.grayTexture}),g(0,e,"offsetY",function(){return 0}),g(0,e,"sourceWidth",function(){return this._width}),g(0,e,"depthStencilFormat",function(){return this._depthStencilFormat}),g(1,r,"currentActive",function(){return r._currentActive},laya.resource.BaseTexture._$SET_currentActive),r.pushRT=function(){r.rtStack.push({rt:r._currentActive,w:Q.width,h:Q.height})},r.popRT=function(){var t=Nt.instance,e=r.rtStack.pop();e&&(r._currentActive!=e.rt&&(Nt.instance.bindFramebuffer(36160,e.rt?e.rt._frameBuffer:null),r._currentActive=e.rt),t.viewport(0,0,e.w,e.h),Q.width=e.w,Q.height=e.h)},r._currentActive=null,r.rtStack=[],E(r,["defuv",function(){return this.defuv=[0,0,1,0,1,1,0,1]},"flipyuv",function(){return this.flipyuv=[0,1,1,1,1,0,0,0]}]),r}(),fa=function(n){function c(){this._frames=null,this._url=null,c.__super.call(this),this._setControlNode(this)}I(c,"laya.display.Animation",n);var t=c.prototype;return t.destroy=function(t){void 0===t&&(t=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,t),this._frames=null,this._labels=null},t.play=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=""),i&&this._setFramesFromCache(i,!0),n.prototype.play.call(this,t,e,i)},t._setFramesFromCache=function(t,e){if(void 0===e&&(e=!1),this._url&&(t=this._url+"#"+t),t&&c.framesMap[t]){var i=c.framesMap[t];return i instanceof Array?(this._frames=c.framesMap[t],this._count=this._frames.length):(i.nodeRoot&&(c.framesMap[t]=za.parseAnimationByData(i),i=c.framesMap[t]),this._frames=i.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=i.interval),this._labels=this._copyLabels(i.labels)),!0}return e&&console.log("ani not found:",t),!1},t._copyLabels=function(t){if(!t)return null;var e,i;for(i in e={},t)e[i]=nt.copyArray([],t[i]);return e},t._frameLoop=function(){this._visible&&.01<this._style.alpha&&this._frames&&n.prototype._frameLoop.call(this)},t._displayToIndex=function(t){this._frames&&(this.graphics=this._frames[t])},t.clear=function(){return n.prototype.clear.call(this),this.stop(),this.graphics=null,this._frames=null,this._labels=null,this},t.loadImages=function(t,e){return void 0===e&&(e=""),this._url="",this._setFramesFromCache(e)||(this.frames=c.framesMap[e]?c.framesMap[e]:c.createFrames(t,e)),this},t.loadAtlas=function(e,i,n){void 0===n&&(n=""),this._url="";var r=this;if(!r._setFramesFromCache(n)){function t(t){e===t&&(r.frames=c.framesMap[n]?c.framesMap[n]:c.createFrames(e,n),i&&i.run())}Hn.getAtlas(e)?t(e):T.loader.load(e,y.create(null,t,[e]),null,"atlas")}return this},t.loadAnimation=function(t,e,i){this._url=t;return this._actionName||(this._actionName=""),this._setFramesFromCache(this._actionName)?(this._setFramesFromCache(this._actionName,!0),this.index=0,e&&e.run()):!i||Hn.getAtlas(i)?this._loadAnimationData(t,e,i):T.loader.load(i,y.create(this,this._loadAnimationData,[t,e,i]),null,"atlas"),this},t._loadAnimationData=function(o,h,t){var l=this;if(!t||Hn.getAtlas(t)){var u=this;Hn.getRes(o)?e(o):T.loader.load(o,y.create(null,e,[o]),null,"json")}else console.warn("atlas load fail:"+t);function e(t){if(Hn.getRes(t)){if(o===t){var e;if(c.framesMap[o+"#"])u._setFramesFromCache(l._actionName,!0),l.index=0,l._resumePlay();else{var i=za.parseAnimationData(Hn.getRes(o));if(!i)return;var n,r=i.animationList,s=0,a=r.length;for(s=0;s<a;s++)e=r[s],c.framesMap[o+"#"+e.name]=e,n||(n=e);n&&(c.framesMap[o+"#"]=n,u._setFramesFromCache(l._actionName,!0),l.index=0),l._resumePlay()}h&&h.run()}Hn.clearRes(o)}else c.framesMap[o+"#"]&&(u._setFramesFromCache(l._actionName,!0),l.index=0,l._resumePlay(),h&&h.run())}},g(0,t,"autoAnimation",null,function(t){this.play(0,!0,t)}),g(0,t,"autoPlay",null,function(t){t?this.play():this.stop()}),g(0,t,"source",null,function(t){-1<t.indexOf(".ani")?this.loadAnimation(t):-1<t.indexOf(".json")||-1<t.indexOf("als")||-1<t.indexOf("atlas")?this.loadAtlas(t):this.loadImages(t.split(","))}),g(0,t,"frames",function(){return this._frames},function(t){(this._frames=t)&&(this._count=t.length,this._actionName&&this._setFramesFromCache(this._actionName,!0),this.index=this._index)}),c.createFrames=function(t,e){var i;if("string"==typeof t){var n=Hn.getAtlas(t);if(n&&n.length){i=[];for(var r=0,s=n.length;r<s;r++){var a=new $;a.drawImage(Hn.getRes(n[r]),0,0),i.push(a)}}}else if(t instanceof Array)for(i=[],r=0,s=t.length;r<s;r++)(a=new $).loadImage(t[r],0,0),i.push(a);return e&&(c.framesMap[e]=i),i},c.clearCache=function(t){var e,i=c.framesMap,n=t+"#";for(e in i)e!==t&&0!==e.indexOf(n)||delete c.framesMap[e]},c.framesMap={},c}(Ds),pa=function(e){function i(t,e){i.__super.call(this,e),this._meshFilter=new Mi(this),this._render=new cs(this),t&&(this._meshFilter.sharedMesh=t)}I(i,"laya.d3.core.MeshSprite3D",e);var t=i.prototype;return t._parse=function(t,e){laya.d3.core.Sprite3D.prototype._parse.call(this,t,e);var i=this.meshRenderer,n=t.lightmapIndex;null!=n&&(i.lightmapIndex=n);var r=t.lightmapScaleOffset;r&&(i.lightmapScaleOffset=new on(r[0],r[1],r[2],r[3])),null!=t.meshPath&&(this.meshFilter.sharedMesh=Hn.getRes(t.meshPath)),null!=t.enableRender&&(this.meshRenderer.enable=t.enableRender);var s=t.materials;if(s){var a=i.sharedMaterials,o=s.length;a.length=o;for(var h=0;h<o;h++)a[h]=Hn.getRes(s[h].path);i.sharedMaterials=a}},t._addToInitStaticBatchManager=function(){cr.instance._addBatchSprite(this)},t._cloneTo=function(t,e,i){var n=t;n._meshFilter.sharedMesh=this._meshFilter.sharedMesh;var r=this._render,s=n._render;s.enable=r.enable,s.sharedMaterials=r.sharedMaterials,s.castShadow=r.castShadow;var a=r.lightmapScaleOffset;a&&(s.lightmapScaleOffset=a.clone()),s.lightmapIndex=r.lightmapIndex,s.receiveShadow=r.receiveShadow,s.sortingFudge=r.sortingFudge,laya.d3.core.Sprite3D.prototype._cloneTo.call(this,t,e,i)},t.destroy=function(t){void 0===t&&(t=!0),this.destroyed||(e.prototype.destroy.call(this,t),this._meshFilter.destroy())},g(0,t,"meshRenderer",function(){return this._render}),g(0,t,"meshFilter",function(){return this._meshFilter}),i.__init__=function(){i.SHADERDEFINE_UV0=i.shaderDefines.registerDefine("UV"),i.SHADERDEFINE_COLOR=i.shaderDefines.registerDefine("COLOR"),i.SHADERDEFINE_UV1=i.shaderDefines.registerDefine("UV1"),i.SHADERDEFINE_GPU_INSTANCE=i.shaderDefines.registerDefine("GPU_INSTANCE"),Bt._registerManager(cr.instance),wt._registerManager(Ur.instance)},i.SHADERDEFINE_UV0=0,i.SHADERDEFINE_COLOR=0,i.SHADERDEFINE_UV1=0,i.SHADERDEFINE_GPU_INSTANCE=0,E(i,["shaderDefines",function(){return this.shaderDefines=new ii(Is.shaderDefines)}]),i}(Is),ma=function(i){function t(){this._direction=null,this._spotAngle=NaN,this._range=NaN,t.__super.call(this),this._spotAngle=30,this._range=10,this._direction=new ln}I(t,"laya.d3.core.light.SpotLight",i);var e=t.prototype;return e._onActive=function(){i.prototype._onActive.call(this),this._lightmapBakedType!==Ms.LIGHTMAPBAKEDTYPE_BAKED&&this.scene._defineDatas.add(Rs.SHADERDEFINE_SPOTLIGHT)},e._onInActive=function(){i.prototype._onInActive.call(this),this._lightmapBakedType!==Ms.LIGHTMAPBAKEDTYPE_BAKED&&this.scene._defineDatas.remove(Rs.SHADERDEFINE_SPOTLIGHT)},e._prepareToScene=function(){var t=this._scene;if(t.enableLight&&this.activeInHierarchy){t._defineDatas;var e=t._shaderValues;return ln.scale(this.color,this._intensity,this._intensityColor),e.setVector3(Rs.SPOTLIGHTCOLOR,this._intensityColor),e.setVector3(Rs.SPOTLIGHTPOS,this.transform.position),this.transform.worldMatrix.getForward(this._direction),ln.normalize(this._direction,this._direction),e.setVector3(Rs.SPOTLIGHTDIRECTION,this._direction),e.setNumber(Rs.SPOTLIGHTRANGE,this.range),e.setNumber(Rs.SPOTLIGHTSPOTANGLE,this.spotAngle*Math.PI/180),!0}return!1},e._parse=function(t,e){i.prototype._parse.call(this,t,e),this.range=t.range,this.spotAngle=t.spotAngle},g(0,e,"range",function(){return this._range},function(t){this._range=t}),g(0,e,"spotAngle",function(){return this._spotAngle},function(t){this._spotAngle=Math.max(Math.min(t,180),0)}),E(t,["_tempMatrix0",function(){return this._tempMatrix0=new gt},"_tempMatrix1",function(){return this._tempMatrix1=new gt}]),t}(Ms),ga=function(e){function i(t){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,i.__super.call(this),this.skin=t}I(i,"laya.ui.ProgressBar",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._bg&&this._bg.destroy(t),this._bar&&this._bar.destroy(t),this._bg=this._bar=null,this.changeHandler=null},t.createChildren=function(){this.addChild(this._bg=new ra),this.addChild(this._bar=new ra),this._bar._bitmap.autoCacheCmd=!1},t._skinLoaded=function(){this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue),this._sizeChanged(),this.event("loaded")},t.measureWidth=function(){return this._bg.width},t.measureHeight=function(){return this._bg.height},t.changeValue=function(){if(this.sizeGrid){var t=this.sizeGrid.split(","),e=Number(t[3]),i=Number(t[1]),n=(this.width-e-i)*this._value;this._bar.width=e+i+n,this._bar.visible=this._bar.width>e+i}else this._bar.width=this.width*this._value},g(0,t,"height",e.prototype._$get_height,function(t){T.superSet(Ss,this,"height",t),this._bg.height=this._height,this._bar.height=this._height}),g(0,t,"bar",function(){return this._bar}),g(0,t,"dataSource",e.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)||"string"==typeof t?this.value=Number(t):T.superSet(Ss,this,"dataSource",t)}),g(0,t,"value",function(){return this._value},function(t){this._value!=t&&(t=1<t?1:t<0?0:t,this._value=t,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith(t))}),g(0,t,"sizeGrid",function(){return this._bg.sizeGrid},function(t){this._bg.sizeGrid=this._bar.sizeGrid=t}),g(0,t,"bg",function(){return this._bg}),g(0,t,"width",e.prototype._$get_width,function(t){T.superSet(Ss,this,"width",t),this._bg.width=this._width,this.callLater(this.changeValue)}),g(0,t,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this._skin&&!Hn.getRes(this._skin)?T.loader.load(this._skin,y.create(this,this._skinLoaded),null,"image",1):this._skinLoaded())}),i}(Ss),va=function(t){function l(){this._targetDic=null,this._animationData=null,this._usedFrames=null,l.__super.call(this),null===l._sortIndexFun&&(l._sortIndexFun=ge.sortByKey("index",!1,!0))}I(l,"laya.display.FrameAnimation",t);var e=l.prototype;return e._setUp=function(t,e){this._targetDic=t,this._animationData=e,this.interval=1e3/e.frameRate,e.parsed?(this._count=e.count,this._labels=e.labels,this._usedFrames=e.animationNewFrames):(this._usedFrames=[],this._calculateDatas(),e.parsed=!0,e.labels=this._labels,e.count=this._count,e.animationNewFrames=this._usedFrames)},e.clear=function(){return t.prototype.clear.call(this),this._targetDic=null,this._animationData=null,this},e._displayToIndex=function(t){if(this._animationData){t<0&&(t=0),t>this._count&&(t=this._count);var e=this._animationData.nodes,i=0,n=e.length;for(i=0;i<n;i++)this._displayNodeToFrame(e[i],t)}},e._displayNodeToFrame=function(t,e,i){i||(i=this._targetDic);var n=i[t.target];if(n){var r,s,a,o=t.frames,h=t.keys,l=0,u=h.length;for(l=0;l<u;l++)a=(s=o[r=h[l]]).length>e?s[e]:s[s.length-1],n[r]=a;var c,_=t.funkeys;if(0!=(u=_.length))for(l=0;l<u;l++)void 0!==(c=o[r=_[l]])[e]&&n[r]&&n[r].apply(n,c[e])}},e._calculateDatas=function(){if(this._animationData){var t,e=this._animationData.nodes,i=0,n=e.length;for(i=this._count=0;i<n;i++)t=e[i],this._calculateKeyFrames(t);this._count+=1}},e._calculateKeyFrames=function(t){var e,i,n=t.keyframes,r=t.target;for(e in t.frames||(t.frames={}),t.keys?t.keys.length=0:t.keys=[],t.funkeys?t.funkeys.length=0:t.funkeys=[],t.initValues||(t.initValues={}),n){var s=-1!=e.indexOf("()");if(i=n[e],s&&(e=e.substr(0,e.length-2)),t.frames[e]||(t.frames[e]=[]),s){t.funkeys.push(e);for(var a=t.frames[e],o=0;o<i.length;o++){var h=i[o];a[h.index]=h.value,h.index>this._count&&(this._count=h.index)}}else this._targetDic&&this._targetDic[r]&&(t.initValues[e]=this._targetDic[r][e]),i.sort(l._sortIndexFun),t.keys.push(e),this._calculateNodePropFrames(i,t.frames[e],e,r)}},e.resetNodes=function(){if(this._targetDic&&this._animationData){var t,e,i=this._animationData.nodes,n=0,r=i.length;for(n=0;n<r;n++)if(e=(t=i[n]).initValues){var s,a=this._targetDic[t.target];if(a)for(s in e)a[s]=e[s]}}},e._calculateNodePropFrames=function(t,e,i,n){var r=0,s=t.length-1;for(e.length=t[s].index+1,r=0;r<s;r++)this._dealKeyFrame(t[r]),this._calculateFrameValues(t[r],t[r+1],e);0==s&&(e[0]=t[0].value,this._usedFrames&&(this._usedFrames[t[0].index]=!0)),this._dealKeyFrame(t[r])},e._dealKeyFrame=function(t){t.label&&""!=t.label&&this.addLabel(t.label,t.index)},e._calculateFrameValues=function(t,e,i){var n,r=0,s=t.index,a=e.index,o=t.value,h=e.value-t.value,l=a-s,u=this._usedFrames;if(a>this._count&&(this._count=a),t.tween)for(null==(n=Ue[t.tweenMethod])&&(n=Ue.linearNone),r=s;r<a;r++)i[r]=n(r-s,o,h,l),u&&(u[r]=!0);else for(r=s;r<a;r++)i[r]=o;u&&(u[t.index]=!0,u[e.index]=!0),i[e.index]=e.value},l._sortIndexFun=null,l}(Ds),Ta=function(e){function r(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",r.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow="scroll",this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}I(r,"laya.display.Input",e);var t=r.prototype;return t.setSelection=function(t,e){this.focus=!0,laya.display.Input.inputElement.selectionStart=t,laya.display.Input.inputElement.selectionEnd=e},t._onUnDisplay=function(t){this.focus=!1},t._onMouseDown=function(t){this.focus=!0},t._syncInputTransform=function(){var t=this.nativeInput,e=nt.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),i=this._width-this.padding[1]-this.padding[3],n=this._height-this.padding[0]-this.padding[2];qi.isConchApp?(t.setScale(e.scaleX,e.scaleY),t.setSize(i,n),t.setPos(e.x,e.y)):(r.inputContainer.style.transform=r.inputContainer.style.webkitTransform="scale("+e.scaleX+","+e.scaleY+") rotate("+T.stage.canvasDegree+"deg)",t.style.width=i+"px",t.style.height=n+"px",r.inputContainer.style.left=e.x+"px",r.inputContainer.style.top=e.y+"px")},t.select=function(){this.nativeInput.select()},t._setInputMethod=function(){r.input.parentElement&&r.inputContainer.removeChild(r.input),r.area.parentElement&&r.inputContainer.removeChild(r.area),r.inputElement=this._multiline?r.area:r.input,r.inputContainer.appendChild(r.inputElement),Os.RightToLeft&&(r.inputElement.style.direction="rtl")},t._focusIn=function(){laya.display.Input.isInputting=!0;var t=this.nativeInput;this._focus=!0;var e=t.style;e.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),t.readOnly=!this._editable,qi.isConchApp&&(t.setType(this._type),t.setForbidEdit(!this._editable)),t.maxLength=this._maxChars;this.padding;if(t.type=this._type,t.value=this._content,t.placeholder=this._prompt,T.stage.off("keydown",this,this._onKeyDown),T.stage.on("keydown",this,this._onKeyDown),(T.stage.focus=this).event("focus"),Vt.onPC&&t.focus(),!(Vt.onMiniGame||Vt.onBDMiniGame||Vt.onQGMiniGame||Vt.onKGMiniGame)){this._text;this._text=null}this.typeset(),t.setColor(this._originColor),t.setFontSize(this.fontSize),t.setFontFace(Vt.onIPhone&&Os.fontFamilyMap[this.font]||this.font),qi.isConchApp&&t.setMultiAble&&t.setMultiAble(this._multiline),e.lineHeight=this.leading+this.fontSize+"px",e.fontStyle=this.italic?"italic":"normal",e.fontWeight=this.bold?"bold":"normal",e.textAlign=this.align,e.padding="0 0",this._syncInputTransform(),!qi.isConchApp&&Vt.onPC&&T.systemTimer.frameLoop(1,this,this._syncInputTransform)},t._setPromptColor=function(){(r.promptStyleDOM=Vt.getElementById("promptStyle"))||((r.promptStyleDOM=Vt.createElement("style")).setAttribute("id","promptStyle"),Vt.document.head.appendChild(r.promptStyleDOM)),r.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},t._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?(T.superSet(Os,this,"text",this._content),T.superSet(Os,this,"color",this._originColor)):(T.superSet(Os,this,"text",this._prompt),T.superSet(Os,this,"color",this._promptColor)),T.stage.off("keydown",this,this._onKeyDown),T.stage.focus=null,this.event("blur"),this.event("change"),qi.isConchApp&&this.nativeInput.blur(),Vt.onPC&&T.systemTimer.clear(this,this._syncInputTransform)},t._onKeyDown=function(t){13===t.keyCode&&(Vt.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},t.changeText=function(t){this._content=t,this._focus?(this.nativeInput.value=t||"",this.event("change")):e.prototype.changeText.call(this,t)},g(0,t,"type",function(){return this._type},function(t){this._getTextStyle().asPassword="password"===t,this._type=t}),g(0,t,"editable",function(){return this._editable},function(t){this._editable=t,qi.isConchApp&&r.input.setForbidEdit(!t)}),g(0,t,"prompt",function(){return this._prompt},function(t){!this._text&&t&&T.superSet(Os,this,"color",this._promptColor),this.promptColor=this._promptColor,this._text?T.superSet(Os,this,"text",this._text==this._prompt?t:this._text):T.superSet(Os,this,"text",t),this._prompt=Os.langPacks&&Os.langPacks[t]?Os.langPacks[t]:t}),g(0,t,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function(t){this._restrictPattern=t?(-1<(t="[^"+t+"]").indexOf("^^")&&(t=t.replace("^^","")),new RegExp(t,"g")):null}),g(0,t,"bgColor",e.prototype._$get_bgColor,function(t){T.superSet(Os,this,"bgColor",t),qi.isConchApp&&this.nativeInput.setBgColor(t)}),g(0,t,"color",e.prototype._$get_color,function(t){this._focus&&this.nativeInput.setColor(t),T.superSet(Os,this,"color",this._content?t:this._promptColor),this._originColor=t}),g(0,t,"maxChars",function(){return this._maxChars},function(t){t<=0&&(t=1e5),this._maxChars=t}),g(0,t,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function(t){T.superSet(Os,this,"color",this._originColor),t+="",this._focus?(this.nativeInput.value=t||"",this.event("change")):(this._multiline||(t=t.replace(/\r?\n/g,"")),(this._content=t)?T.superSet(Os,this,"text",t):(T.superSet(Os,this,"text",this._prompt),T.superSet(Os,this,"color",this.promptColor)))}),g(0,t,"promptColor",function(){return this._promptColor},function(t){this._promptColor=t,this._content||T.superSet(Os,this,"color",t)}),g(0,t,"focus",function(){return this._focus},function(t){var e=this.nativeInput;this._focus!==t&&(t?(e.target?e.target._focusOut():this._setInputMethod(),(e.target=this)._focusIn()):(e.target=null,this._focusOut(),Vt.document.body.scrollTop=0,e.blur(),qi.isConchApp?e.setPos(-1e4,-1e4):r.inputContainer.contains(e)&&r.inputContainer.removeChild(e)))}),g(0,t,"nativeInput",function(){return this._multiline?r.area:r.input}),g(0,t,"multiline",function(){return this._multiline},function(t){this._multiline=t,this.valign=t?"top":"middle"}),r.__init__=function(){if(r._createInputElement(),Vt.onMobile){var t=!1;(Vt.onMiniGame||Vt.onBDMiniGame||Vt.onQGMiniGame||Vt.onKGMiniGame)&&(t=!0),qi.canvas.addEventListener(r.IOS_IFRAME?t?"touchend":"click":"touchend",r._popupInputMethod)}},r._popupInputMethod=function(t){laya.display.Input.isInputting&&laya.display.Input.inputElement.focus()},r._createInputElement=function(){r._initInput(r.area=Vt.createElement("textarea")),r._initInput(r.input=Vt.createElement("input")),(r.inputContainer=Vt.createElement("div")).style.position="absolute",r.inputContainer.style.zIndex=1e5,Vt.container.appendChild(r.inputContainer),r.inputContainer.setPos=function(t,e){r.inputContainer.style.left=t+"px",r.inputContainer.style.top=e+"px"}},r._initInput=function(e){var t=e.style;t.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",t.resize="none",t.backgroundColor="transparent",t.border="none",t.outline="none",t.zIndex=1,e.addEventListener("input",r._processInputting),e.addEventListener("mousemove",r._stopEvent),e.addEventListener("mousedown",r._stopEvent),e.addEventListener("touchmove",r._stopEvent),e.setFontFace=function(t){e.style.fontFamily=t},qi.isConchApp||(e.setColor=function(t){e.style.color=t},e.setFontSize=function(t){e.style.fontSize=t+"px"})},r._processInputting=function(t){var e=laya.display.Input.inputElement.target;if(e){var i=laya.display.Input.inputElement.value;e._restrictPattern&&(i=i.replace(/\u2006|\x27/g,""),e._restrictPattern.test(i)&&(i=i.replace(e._restrictPattern,""),laya.display.Input.inputElement.value=i)),e._text=i,e.event("input")}},r._stopEvent=function(t){"touchmove"==t.type&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},r.TYPE_TEXT="text",r.TYPE_PASSWORD="password",r.TYPE_EMAIL="email",r.TYPE_URL="url",r.TYPE_NUMBER="number",r.TYPE_RANGE="range",r.TYPE_DATE="date",r.TYPE_MONTH="month",r.TYPE_WEEK="week",r.TYPE_TIME="time",r.TYPE_DATE_TIME="datetime",r.TYPE_DATE_TIME_LOCAL="datetime-local",r.TYPE_SEARCH="search",r.input=null,r.area=null,r.inputElement=null,r.inputContainer=null,r.confirmButton=null,r.promptStyleDOM=null,r.inputHeight=45,r.isInputting=!1,r.stageMatrix=null,E(r,["IOS_IFRAME",function(){return this.IOS_IFRAME=Vt.onIOS&&Vt.window.top!=Vt.window.self}]),r}(Os),ya=function(t){function r(t,e){void 0===t&&(t=0),void 0===e&&(e=!1),r.__super.call(this,t,e),this._glTextureType=34067}I(r,"laya.d3.resource.TextureCube",Cs);var e=r.prototype;return e.setSixSideImageSources=function(t,e){void 0===e&&(e=!1);for(var i=0,n=0,r=0;r<6;r++){var s=t[r];if(!s)return void console.log("TextureCube: image Source can't be null.");var a=s.width,o=s.height;if(0<r&&i!==a)return void console.log("TextureCube: each side image's width and height must same.");if((i=a)!==(n=o))return void console.log("TextureCube: each side image's width and height must same.")}this._width=i,this._height=n;var h=Nt.instance;j.bindTexture(h,this._glTextureType,this._glTexture);var l=this._getGLFormat();if(qi.isConchApp){if(1==e)for(var u=0;u<6;u++)t[u].setPremultiplyAlpha(e);h.texImage2D(34073,0,6408,6408,5121,t[0]),h.texImage2D(34074,0,6408,6408,5121,t[1]),h.texImage2D(34069,0,6408,6408,5121,t[2]),h.texImage2D(34070,0,6408,6408,5121,t[3]),h.texImage2D(34071,0,6408,6408,5121,t[4]),h.texImage2D(34072,0,6408,6408,5121,t[5])}else e&&h.pixelStorei(37441,!0),h.texImage2D(34073,0,l,l,5121,t[0]),h.texImage2D(34074,0,l,l,5121,t[1]),h.texImage2D(34069,0,l,l,5121,t[2]),h.texImage2D(34070,0,l,l,5121,t[3]),h.texImage2D(34071,0,l,l,5121,t[4]),h.texImage2D(34072,0,l,l,5121,t[5]),e&&h.pixelStorei(37441,!1);this._mipmap&&this._isPot(i)&&this._isPot(n)?(h.generateMipmap(this._glTextureType),this._setGPUMemory(i*n*4*(1+1/3)*6)):this._setGPUMemory(i*n*4*6),this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode),this._readyed=!0,this._activeResource()},e.setSixSidePixels=function(t,e,i){if(t<=0||e<=0)throw new Error("TextureCube:width or height must large than 0.");if(!i)throw new Error("TextureCube:pixels can't be null.");this._width=t,this._height=e;var n=Nt.instance;j.bindTexture(n,this._glTextureType,this._glTexture);var r=this._getGLFormat();n.texImage2D(34073,0,r,t,e,0,r,5121,i[0]),n.texImage2D(34074,0,r,t,e,0,r,5121,i[1]),n.texImage2D(34069,0,r,t,e,0,r,5121,i[2]),n.texImage2D(34070,0,r,t,e,0,r,5121,i[3]),n.texImage2D(34071,0,r,t,e,0,r,5121,i[4]),n.texImage2D(34072,0,r,t,e,0,r,5121,i[5]),this._mipmap&&this._isPot(t)&&this._isPot(e)?(n.generateMipmap(this._glTextureType),this._setGPUMemory(t*e*4*(1+1/3)*6)):this._setGPUMemory(t*e*4*6),this._setWarpMode(10242,this._wrapModeU),this._setWarpMode(10243,this._wrapModeV),this._setFilterMode(this._filterMode),this._readyed=!0,this._activeResource()},e._recoverResource=function(){},g(0,e,"defaulteTexture",function(){return r.grayTexture}),r.__init__=function(){var t=new Uint8Array(3);t[0]=128,t[1]=128,t[2]=128,(r.grayTexture=new r(0,!1)).setSixSidePixels(1,1,[t,t,t,t,t,t]),r.grayTexture.lock=!0},r._parse=function(t,e,i){var n=i?new r(i[0],i[1]):new r;return n.setSixSideImageSources(t),n},r.load=function(t,e){T.loader.create(t,e,null,"TEXTURECUBE")},r.grayTexture=null,r}(),Ea=function(t){function i(t,e){this._geometryFilter=null,void 0===t&&(t=2),i.__super.call(this,e),this._geometryFilter=new Zn(this,t),this._render=new ss(this),this._changeRenderObjects(this._render,0,Us.defaultMaterial)}I(i,"laya.d3.core.pixelLine.PixelLineSprite3D",Is);var e=i.prototype;return e._changeRenderObjects=function(t,e,i){var n=this._render._renderElements;i||(i=Us.defaultMaterial);var r=n[e];r||(r=n[e]=new Wi),r.setTransform(this._transform),r.setGeometry(this._geometryFilter),r.render=this._render,r.material=i},e.addLine=function(t,e,i,n){if(this._geometryFilter._lineCount===this._geometryFilter._maxLineCount)throw"PixelLineSprite3D: lineCount has equal with maxLineCount.";this._geometryFilter._updateLineData(this._geometryFilter._lineCount++,t,e,i,n)},e.addLines=function(t){var e=this._geometryFilter._lineCount,i=t.length;if(e+i>this._geometryFilter._maxLineCount)throw"PixelLineSprite3D: lineCount plus lines count must less than maxLineCount.";this._geometryFilter._updateLineDatas(e,t),this._geometryFilter._lineCount+=i},e.removeLine=function(t){if(!(t<this._geometryFilter._lineCount))throw"PixelLineSprite3D: index must less than lineCount.";this._geometryFilter._removeLineData(t)},e.setLine=function(t,e,i,n,r){if(!(t<this._geometryFilter._lineCount))throw"PixelLineSprite3D: index must less than lineCount.";this._geometryFilter._updateLineData(t,e,i,n,r)},e.getLine=function(t,e){if(!(t<this.lineCount))throw"PixelLineSprite3D: index must less than lineCount.";this._geometryFilter._getLineData(t,e)},e.clear=function(){this._geometryFilter._lineCount=0},g(0,e,"pixelLineRenderer",function(){return this._render}),g(0,e,"lineCount",function(){return this._geometryFilter._lineCount},function(t){if(t>this.maxLineCount)throw"PixelLineSprite3D: lineCount can't large than maxLineCount";this._geometryFilter._lineCount=t}),g(0,e,"maxLineCount",function(){return this._geometryFilter._maxLineCount},function(t){this._geometryFilter._resizeLineData(t),this._geometryFilter._lineCount=Math.min(this._geometryFilter._lineCount,t)}),i}(),xa=function(e){function t(){t.__super.call(this,this.name),this._render=new os(this),this._geometryFilter=new Ht(this)}I(t,"laya.d3.core.trail.TrailSprite3D",e);var i=t.prototype;return i._parse=function(t,e){laya.d3.core.Sprite3D.prototype._parse.call(this,t,e);var i=this._render,n=this._geometryFilter,r=0,s=0,a=t.materials;if(a){var o=i.sharedMaterials,h=a.length;for(o.length=h,r=0;r<h;r++)o[r]=Hn.getRes(a[r].path);i.sharedMaterials=o}n.time=t.time,n.minVertexDistance=t.minVertexDistance,n.widthMultiplier=t.widthMultiplier,n.textureMode=t.textureMode,null!=t.alignment&&(n.alignment=t.alignment);var l=[],u=t.widthCurve;for(r=0,s=u.length;r<s;r++){var c=new Gn;c.time=u[r].time,c.inTangent=u[r].inTangent,c.outTangent=u[r].outTangent,c.value=u[r].value,l.push(c)}n.widthCurve=l;var _=t.colorGradient,d=_.colorKeys,f=_.alphaKeys,p=new Fi(d.length,f.length);for(p.mode=_.mode,r=0,s=d.length;r<s;r++){var m=d[r];p.addColorRGB(m.time,new pe(m.value[0],m.value[1],m.value[2],1))}for(r=0,s=f.length;r<s;r++){var g=f[r];p.addColorAlpha(g.time,g.value)}n.colorGradient=p},i._onActive=function(){e.prototype._onActive.call(this),this._transform.position.cloneTo(this._geometryFilter._lastPosition)},i._cloneTo=function(t,e,i){laya.d3.core.Sprite3D.prototype._cloneTo.call(this,t,e,i);var n,r=0,s=t,a=s.trailFilter;a.time=this.trailFilter.time,a.minVertexDistance=this.trailFilter.minVertexDistance,a.widthMultiplier=this.trailFilter.widthMultiplier,a.textureMode=this.trailFilter.textureMode;var o=this.trailFilter.widthCurve,h=[];for(r=0,n=o.length;r<n;r++){var l=new Gn;o[r].cloneTo(l),h.push(l)}a.widthCurve=h;var u=new Fi(this.trailFilter.colorGradient.maxColorRGBKeysCount,this.trailFilter.colorGradient.maxColorAlphaKeysCount);this.trailFilter.colorGradient.cloneTo(u),a.colorGradient=u,s.trailRenderer.sharedMaterial=this.trailRenderer.sharedMaterial},i.destroy=function(t){void 0===t&&(t=!0),this.destroyed||(e.prototype.destroy.call(this,t),this._geometryFilter.destroy(),this._geometryFilter=null)},g(0,i,"trailRenderer",function(){return this._render}),g(0,i,"trailFilter",function(){return this._geometryFilter}),t.__init__=function(){t.SHADERDEFINE_GRADIENTMODE_BLEND=t.shaderDefines.registerDefine("GRADIENTMODE_BLEND")},t.SHADERDEFINE_GRADIENTMODE_BLEND=0,E(t,["CURTIME",function(){return this.CURTIME=We.propertyNameToID("u_CurTime")},"LIFETIME",function(){return this.LIFETIME=We.propertyNameToID("u_LifeTime")},"WIDTHCURVE",function(){return this.WIDTHCURVE=We.propertyNameToID("u_WidthCurve")},"WIDTHCURVEKEYLENGTH",function(){return this.WIDTHCURVEKEYLENGTH=We.propertyNameToID("u_WidthCurveKeyLength")},"GRADIENTCOLORKEY",function(){return this.GRADIENTCOLORKEY=We.propertyNameToID("u_GradientColorkey")},"GRADIENTALPHAKEY",function(){return this.GRADIENTALPHAKEY=We.propertyNameToID("u_GradientAlphakey")},"shaderDefines",function(){return this.shaderDefines=new ii(Is.shaderDefines)}]),t}(Is),Sa=function(t){function e(){this._direction=null,e.__super.call(this),this._direction=new ln}I(e,"laya.d3.core.light.DirectionLight",t);var i=e.prototype;return i._initShadow=function(){if(this._shadow)this._parallelSplitShadowMap=new _i,this.scene.parallelSplitShadowMaps.push(this._parallelSplitShadowMap),this.transform.worldMatrix.getForward(this._direction),ln.normalize(this._direction,this._direction),this._parallelSplitShadowMap.setInfo(this.scene,this._shadowFarPlane,this._direction,this._shadowMapSize,this._shadowMapCount,this._shadowMapPCFType);else{var t=this._scene._defineDatas,e=this.scene.parallelSplitShadowMaps;e.splice(e.indexOf(this._parallelSplitShadowMap),1),this._parallelSplitShadowMap.disposeAllRenderTarget(),this._parallelSplitShadowMap=null,t.remove(Rs.SHADERDEFINE_SHADOW_PSSM1),t.remove(Rs.SHADERDEFINE_SHADOW_PSSM2),t.remove(Rs.SHADERDEFINE_SHADOW_PSSM3)}},i._onActive=function(){t.prototype._onActive.call(this),this._shadow&&this._initShadow(),this._lightmapBakedType!==Ms.LIGHTMAPBAKEDTYPE_BAKED&&this._scene._defineDatas.add(Rs.SHADERDEFINE_DIRECTIONLIGHT)},i._onInActive=function(){t.prototype._onInActive.call(this),this._lightmapBakedType!==Ms.LIGHTMAPBAKEDTYPE_BAKED&&this._scene._defineDatas.remove(Rs.SHADERDEFINE_DIRECTIONLIGHT)},i._prepareToScene=function(){var t=this._scene;if(t.enableLight&&this.activeInHierarchy){t._defineDatas;var e=t._shaderValues;return ln.scale(this.color,this._intensity,this._intensityColor),e.setVector3(Rs.LIGHTDIRCOLOR,this._intensityColor),this.transform.worldMatrix.getForward(this._direction),ln.normalize(this._direction,this._direction),e.setVector3(Rs.LIGHTDIRECTION,this._direction),!0}return!1},g(0,i,"shadow",t.prototype._$get_shadow,function(t){this._shadow!==t&&(this._shadow=t,this.scene&&this._initShadow())}),e}(Ms),Ca=function(e){function St(){St.__super.call(this,null),this._render=new ps(this),this._particleSystem=new lr(this);var t=this._render._renderElements[0]=new Wi;t.setTransform(this._transform),t.render=this._render,t.setGeometry(this._particleSystem),t.material=js.defaultMaterial}I(St,"laya.d3.core.particleShuriKen.ShuriKenParticle3D",e);var t=St.prototype;return t._initParticleVelocity=function(t){for(var e=new yn,i=t.velocitys,n=0,r=i.length;n<r;n++){var s=i[n];e.add(s.key,s.value)}return e},t._initParticleColor=function(t){var e=new Fi(4,4),i=t.alphas,n=0,r=0;for(n=0,r=i.length;n<r;n++){var s=i[n];3===n&&1!==s.key&&(s.key=1,console.log("GradientDataColor warning:the forth key is  be force set to 1.")),e.addColorAlpha(s.key,s.value)}var a=t.rgbs;for(n=0,r=a.length;n<r;n++){var o=a[n],h=o.value;3===n&&1!==o.key&&(o.key=1,console.log("GradientDataColor warning:the forth key is  be force set to 1.")),e.addColorRGB(o.key,new pe(h[0],h[1],h[2],1))}return e},t._initParticleSize=function(t){for(var e=new yn,i=t.sizes,n=0,r=i.length;n<r;n++){var s=i[n];e.add(s.key,s.value)}return e},t._initParticleRotation=function(t){for(var e=new yn,i=t.angularVelocitys,n=0,r=i.length;n<r;n++){var s=i[n];e.add(s.key,s.value/180*Math.PI)}return e},t._initParticleFrame=function(t){for(var e=new Ji,i=t.frames,n=0,r=i.length;n<r;n++){var s=i[n];e.add(s.key,s.value)}return e},t._parse=function(t,e){laya.d3.core.Sprite3D.prototype._parse.call(this,t,e);var i,n=Math.PI/180,r=0,s=0,a=this.particleRenderer,o=t.material;o&&(i=Hn.getRes(o.path)),a.sharedMaterial=i;var h=t.meshPath;h&&(a.mesh=Hn.getRes(h)),a.renderMode=t.renderMode,a.stretchedBillboardCameraSpeedScale=t.stretchedBillboardCameraSpeedScale,a.stretchedBillboardSpeedScale=t.stretchedBillboardSpeedScale,a.stretchedBillboardLengthScale=t.stretchedBillboardLengthScale,a.sortingFudge=t.sortingFudge?t.sortingFudge:0;var l=this.particleSystem;l.isPerformanceMode=t.isPerformanceMode,l.duration=t.duration,l.looping=t.looping,l.prewarm=t.prewarm,l.startDelayType=t.startDelayType,l.startDelay=t.startDelay,l.startDelayMin=t.startDelayMin,l.startDelayMax=t.startDelayMax,l.startLifetimeType=t.startLifetimeType,l.startLifetimeConstant=t.startLifetimeConstant,l.startLifeTimeGradient=St._initStartLife(t.startLifetimeGradient),l.startLifetimeConstantMin=t.startLifetimeConstantMin,l.startLifetimeConstantMax=t.startLifetimeConstantMax,l.startLifeTimeGradientMin=St._initStartLife(t.startLifetimeGradientMin),l.startLifeTimeGradientMax=St._initStartLife(t.startLifetimeGradientMax),l.startSpeedType=t.startSpeedType,l.startSpeedConstant=t.startSpeedConstant,l.startSpeedConstantMin=t.startSpeedConstantMin,l.startSpeedConstantMax=t.startSpeedConstantMax,l.threeDStartSize=t.threeDStartSize,l.startSizeType=t.startSizeType,l.startSizeConstant=t.startSizeConstant;var u=t.startSizeConstantSeparate,c=l.startSizeConstantSeparate;c.x=u[0],c.y=u[1],c.z=u[2],l.startSizeConstantMin=t.startSizeConstantMin,l.startSizeConstantMax=t.startSizeConstantMax;var _=t.startSizeConstantMinSeparate,d=l.startSizeConstantMinSeparate;d.x=_[0],d.y=_[1],d.z=_[2];var f=t.startSizeConstantMaxSeparate,p=l.startSizeConstantMaxSeparate;p.x=f[0],p.y=f[1],p.z=f[2],l.threeDStartRotation=t.threeDStartRotation,l.startRotationType=t.startRotationType,l.startRotationConstant=t.startRotationConstant*n;var m=t.startRotationConstantSeparate,g=l.startRotationConstantSeparate;g.x=m[0]*n,g.y=m[1]*n,g.z=m[2]*n,l.startRotationConstantMin=t.startRotationConstantMin*n,l.startRotationConstantMax=t.startRotationConstantMax*n;var v=t.startRotationConstantMinSeparate,T=l.startRotationConstantMinSeparate;T.x=v[0]*n,T.y=v[1]*n,T.z=v[2]*n;var y=t.startRotationConstantMaxSeparate,E=l.startRotationConstantMaxSeparate;E.x=y[0]*n,E.y=y[1]*n,E.z=y[2]*n,l.randomizeRotationDirection=t.randomizeRotationDirection,l.startColorType=t.startColorType;var x=t.startColorConstant,S=l.startColorConstant;S.x=x[0],S.y=x[1],S.z=x[2],S.w=x[3];var C=t.startColorConstantMin,I=l.startColorConstantMin;I.x=C[0],I.y=C[1],I.z=C[2],I.w=C[3];var R=t.startColorConstantMax,A=l.startColorConstantMax;A.x=R[0],A.y=R[1],A.z=R[2],A.w=R[3],l.gravityModifier=t.gravityModifier,l.simulationSpace=t.simulationSpace,l.scaleMode=t.scaleMode,l.playOnAwake=t.playOnAwake,l.maxParticles=t.maxParticles;var M=t.autoRandomSeed;null!=M&&(l.autoRandomSeed=M);var D=t.randomSeed;null!=D&&(l.randomSeed[0]=D);var b=t.emission,w=l.emission;if(b){w.emissionRate=b.emissionRate;var L=b.bursts;if(L)for(r=0,s=L.length;r<s;r++){var O=L[r];w.addBurst(new se(O.time,O.min,O.max))}w.enbale=b.enable}else w.enbale=!1;var N=t.shape;if(N){var P;switch(N.shapeType){case 0:var F;P=F=new vr,F.radius=N.sphereRadius,F.emitFromShell=N.sphereEmitFromShell,F.randomDirection=N.sphereRandomDirection;break;case 1:var B;P=B=new Pr,B.radius=N.hemiSphereRadius,B.emitFromShell=N.hemiSphereEmitFromShell,B.randomDirection=N.hemiSphereRandomDirection;break;case 2:var V;P=V=new mr,V.angle=N.coneAngle*n,V.radius=N.coneRadius,V.length=N.coneLength,V.emitType=N.coneEmitType,V.randomDirection=N.coneRandomDirection;break;case 3:var U;P=U=new kr,U.x=N.boxX,U.y=N.boxY,U.z=N.boxZ,U.randomDirection=N.boxRandomDirection;break;case 7:var z;P=z=new Nr,z.radius=N.circleRadius,z.arc=N.circleArc*n,z.emitFromEdge=N.circleEmitFromEdge,z.randomDirection=N.circleRandomDirection;break;default:var G;P=G=new Nr,G.radius=N.circleRadius,G.arc=N.circleArc*n,G.emitFromEdge=N.circleEmitFromEdge,G.randomDirection=N.circleRandomDirection}P.enable=N.enable,l.shape=P}var H=t.velocityOverLifetime;if(H){var k,W=H.velocity;switch(W.type){case 0:var X=W.constant;k=Me.createByConstant(new ln(X[0],X[1],X[2]));break;case 1:k=Me.createByGradient(this._initParticleVelocity(W.gradientX),this._initParticleVelocity(W.gradientY),this._initParticleVelocity(W.gradientZ));break;case 2:var Y=W.constantMin,Z=W.constantMax;k=Me.createByRandomTwoConstant(new ln(Y[0],Y[1],Y[2]),new ln(Z[0],Z[1],Z[2]));break;case 3:k=Me.createByRandomTwoGradient(this._initParticleVelocity(W.gradientXMin),this._initParticleVelocity(W.gradientXMax),this._initParticleVelocity(W.gradientYMin),this._initParticleVelocity(W.gradientYMax),this._initParticleVelocity(W.gradientZMin),this._initParticleVelocity(W.gradientZMax))}var j=new gi(k);j.space=H.space,j.enbale=H.enable,l.velocityOverLifetime=j}var K=t.colorOverLifetime;if(K){var q,Q=K.color;switch(Q.type){case 0:var $=Q.constant;q=Zi.createByConstant(new on($[0],$[1],$[2],$[3]));break;case 1:q=Zi.createByGradient(this._initParticleColor(Q.gradient));break;case 2:var J=Q.constantMin,tt=Q.constantMax;q=Zi.createByRandomTwoConstant(new on(J[0],J[1],J[2],J[3]),new on(tt[0],tt[1],tt[2],tt[3]));break;case 3:q=Zi.createByRandomTwoGradient(this._initParticleColor(Q.gradientMin),this._initParticleColor(Q.gradientMax))}var et=new Pe(q);et.enbale=K.enable,l.colorOverLifetime=et}var it=t.sizeOverLifetime;if(it){var nt,rt=it.size;switch(rt.type){case 0:nt=rt.separateAxes?nn.createByGradientSeparate(this._initParticleSize(rt.gradientX),this._initParticleSize(rt.gradientY),this._initParticleSize(rt.gradientZ)):nn.createByGradient(this._initParticleSize(rt.gradient));break;case 1:if(rt.separateAxes){var st=rt.constantMinSeparate,at=rt.constantMaxSeparate;nt=nn.createByRandomTwoConstantSeparate(new ln(st[0],st[1],st[2]),new ln(at[0],at[1],at[2]))}else nt=nn.createByRandomTwoConstant(rt.constantMin,rt.constantMax);break;case 2:nt=rt.separateAxes?nn.createByRandomTwoGradientSeparate(this._initParticleSize(rt.gradientXMin),this._initParticleSize(rt.gradientYMin),this._initParticleSize(rt.gradientZMin),this._initParticleSize(rt.gradientXMax),this._initParticleSize(rt.gradientYMax),this._initParticleSize(rt.gradientZMax)):nn.createByRandomTwoGradient(this._initParticleSize(rt.gradientMin),this._initParticleSize(rt.gradientMax))}var ot=new _n(nt);ot.enbale=it.enable,l.sizeOverLifetime=ot}var ht=t.rotationOverLifetime;if(ht){var lt,ut=ht.angularVelocity;switch(ut.type){case 0:if(ut.separateAxes){var ct=ut.constantSeparate;lt=Xi.createByConstantSeparate(new ln(ct[0]*n,ct[1]*n,ct[2]*n))}else lt=Xi.createByConstant(ut.constant*n);break;case 1:lt=ut.separateAxes?Xi.createByGradientSeparate(this._initParticleRotation(ut.gradientX),this._initParticleRotation(ut.gradientY),this._initParticleRotation(ut.gradientZ)):Xi.createByGradient(this._initParticleRotation(ut.gradient));break;case 2:if(ut.separateAxes){var _t=ut.constantMinSeparate,dt=ut.constantMaxSeparate;lt=Xi.createByRandomTwoConstantSeparate(new ln(_t[0]*n,_t[1]*n,_t[2]*n),new ln(dt[0]*n,dt[1]*n,dt[2]*n))}else lt=Xi.createByRandomTwoConstant(ut.constantMin*n,ut.constantMax*n);break;case 3:ut.separateAxes||(lt=Xi.createByRandomTwoGradient(this._initParticleRotation(ut.gradientMin),this._initParticleRotation(ut.gradientMax)))}var ft=new Jt(lt);ft.enbale=ht.enable,l.rotationOverLifetime=ft}var pt=t.textureSheetAnimation;if(pt){var mt,gt=pt.frame;switch(gt.type){case 0:mt=Gi.createByConstant(gt.constant);break;case 1:mt=Gi.createByOverTime(this._initParticleFrame(gt.overTime));break;case 2:mt=Gi.createByRandomTwoConstant(gt.constantMin,gt.constantMax);break;case 3:mt=Gi.createByRandomTwoOverTime(this._initParticleFrame(gt.overTimeMin),this._initParticleFrame(gt.overTimeMax))}var vt,Tt=pt.startFrame;switch(Tt.type){case 0:vt=mi.createByConstant(Tt.constant);break;case 1:vt=mi.createByRandomTwoConstant(Tt.constantMin,Tt.constantMax)}var yt=new Ct(mt,vt);yt.enable=pt.enable;var Et=pt.tiles;yt.tiles=new un(Et[0],Et[1]),yt.type=pt.type,yt.randomRow=pt.randomRow;var xt=pt.rowIndex;void 0!==xt&&(yt.rowIndex=xt),yt.cycles=pt.cycles,l.textureSheetAnimation=yt}},t._activeHierarchy=function(t){laya.display.Node.prototype._activeHierarchy.call(this,t),this.particleSystem.playOnAwake&&this.particleSystem.play()},t._inActiveHierarchy=function(t){laya.display.Node.prototype._inActiveHierarchy.call(this,t),this.particleSystem.isAlive&&this.particleSystem.simulate(0,!0)},t._cloneTo=function(t,e,i){var n=t,r=n._particleSystem;this._particleSystem.cloneTo(r);var s=n._render,a=this._render;s.sharedMaterials=a.sharedMaterials,s.enable=a.enable,s.renderMode=a.renderMode,s.mesh=a.mesh,s.stretchedBillboardCameraSpeedScale=a.stretchedBillboardCameraSpeedScale,s.stretchedBillboardSpeedScale=a.stretchedBillboardSpeedScale,s.stretchedBillboardLengthScale=a.stretchedBillboardLengthScale,s.sortingFudge=a.sortingFudge,laya.d3.core.Sprite3D.prototype._cloneTo.call(this,t,e,i)},t.destroy=function(t){void 0===t&&(t=!0),this.destroyed||(e.prototype.destroy.call(this,t),this._particleSystem.destroy(),this._particleSystem=null)},g(0,t,"particleRenderer",function(){return this._render}),g(0,t,"particleSystem",function(){return this._particleSystem}),St.__init__=function(){St.SHADERDEFINE_RENDERMODE_BILLBOARD=St.shaderDefines.registerDefine("SPHERHBILLBOARD"),St.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD=St.shaderDefines.registerDefine("STRETCHEDBILLBOARD"),St.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD=St.shaderDefines.registerDefine("HORIZONTALBILLBOARD"),St.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD=St.shaderDefines.registerDefine("VERTICALBILLBOARD"),St.SHADERDEFINE_COLOROVERLIFETIME=St.shaderDefines.registerDefine("COLOROVERLIFETIME"),St.SHADERDEFINE_RANDOMCOLOROVERLIFETIME=St.shaderDefines.registerDefine("RANDOMCOLOROVERLIFETIME"),St.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT=St.shaderDefines.registerDefine("VELOCITYOVERLIFETIMECONSTANT"),St.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE=St.shaderDefines.registerDefine("VELOCITYOVERLIFETIMECURVE"),St.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT=St.shaderDefines.registerDefine("VELOCITYOVERLIFETIMERANDOMCONSTANT"),St.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE=St.shaderDefines.registerDefine("VELOCITYOVERLIFETIMERANDOMCURVE"),St.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE=St.shaderDefines.registerDefine("TEXTURESHEETANIMATIONCURVE"),St.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE=St.shaderDefines.registerDefine("TEXTURESHEETANIMATIONRANDOMCURVE"),St.SHADERDEFINE_ROTATIONOVERLIFETIME=St.shaderDefines.registerDefine("ROTATIONOVERLIFETIME"),St.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE=St.shaderDefines.registerDefine("ROTATIONOVERLIFETIMESEPERATE"),St.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT=St.shaderDefines.registerDefine("ROTATIONOVERLIFETIMECONSTANT"),St.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE=St.shaderDefines.registerDefine("ROTATIONOVERLIFETIMECURVE"),St.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS=St.shaderDefines.registerDefine("ROTATIONOVERLIFETIMERANDOMCONSTANTS"),St.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES=St.shaderDefines.registerDefine("ROTATIONOVERLIFETIMERANDOMCURVES"),St.SHADERDEFINE_SIZEOVERLIFETIMECURVE=St.shaderDefines.registerDefine("SIZEOVERLIFETIMECURVE"),St.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE=St.shaderDefines.registerDefine("SIZEOVERLIFETIMECURVESEPERATE"),St.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES=St.shaderDefines.registerDefine("SIZEOVERLIFETIMERANDOMCURVES"),St.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE=St.shaderDefines.registerDefine("SIZEOVERLIFETIMERANDOMCURVESSEPERATE"),St.SHADERDEFINE_RENDERMODE_MESH=St.shaderDefines.registerDefine("RENDERMODE_MESH"),St.SHADERDEFINE_SHAPE=St.shaderDefines.registerDefine("SHAPE")},St._initStartLife=function(t){for(var e=new yn,i=t.startLifetimes,n=0,r=i.length;n<r;n++){var s=i[n];e.add(s.key,s.value)}return e},St.SHADERDEFINE_RENDERMODE_BILLBOARD=0,St.SHADERDEFINE_RENDERMODE_STRETCHEDBILLBOARD=0,St.SHADERDEFINE_RENDERMODE_HORIZONTALBILLBOARD=0,St.SHADERDEFINE_RENDERMODE_VERTICALBILLBOARD=0,St.SHADERDEFINE_COLOROVERLIFETIME=0,St.SHADERDEFINE_RANDOMCOLOROVERLIFETIME=0,St.SHADERDEFINE_VELOCITYOVERLIFETIMECONSTANT=0,St.SHADERDEFINE_VELOCITYOVERLIFETIMECURVE=0,St.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCONSTANT=0,St.SHADERDEFINE_VELOCITYOVERLIFETIMERANDOMCURVE=0,St.SHADERDEFINE_TEXTURESHEETANIMATIONCURVE=0,St.SHADERDEFINE_TEXTURESHEETANIMATIONRANDOMCURVE=0,St.SHADERDEFINE_ROTATIONOVERLIFETIME=0,St.SHADERDEFINE_ROTATIONOVERLIFETIMESEPERATE=0,St.SHADERDEFINE_ROTATIONOVERLIFETIMECONSTANT=0,St.SHADERDEFINE_ROTATIONOVERLIFETIMECURVE=0,St.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCONSTANTS=0,St.SHADERDEFINE_ROTATIONOVERLIFETIMERANDOMCURVES=0,St.SHADERDEFINE_SIZEOVERLIFETIMECURVE=0,St.SHADERDEFINE_SIZEOVERLIFETIMECURVESEPERATE=0,St.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVES=0,St.SHADERDEFINE_SIZEOVERLIFETIMERANDOMCURVESSEPERATE=0,St.SHADERDEFINE_RENDERMODE_MESH=0,St.SHADERDEFINE_SHAPE=0,E(St,["WORLDPOSITION",function(){return this.WORLDPOSITION=We.propertyNameToID("u_WorldPosition")},"WORLDROTATION",function(){return this.WORLDROTATION=We.propertyNameToID("u_WorldRotation")},"POSITIONSCALE",function(){return this.POSITIONSCALE=We.propertyNameToID("u_PositionScale")},"SIZESCALE",function(){return this.SIZESCALE=We.propertyNameToID("u_SizeScale")},"SCALINGMODE",function(){return this.SCALINGMODE=We.propertyNameToID("u_ScalingMode")},"GRAVITY",function(){return this.GRAVITY=We.propertyNameToID("u_Gravity")},"THREEDSTARTROTATION",function(){return this.THREEDSTARTROTATION=We.propertyNameToID("u_ThreeDStartRotation")},"STRETCHEDBILLBOARDLENGTHSCALE",function(){return this.STRETCHEDBILLBOARDLENGTHSCALE=We.propertyNameToID("u_StretchedBillboardLengthScale")},"STRETCHEDBILLBOARDSPEEDSCALE",function(){return this.STRETCHEDBILLBOARDSPEEDSCALE=We.propertyNameToID("u_StretchedBillboardSpeedScale")},"SIMULATIONSPACE",function(){return this.SIMULATIONSPACE=We.propertyNameToID("u_SimulationSpace")},"CURRENTTIME",function(){return this.CURRENTTIME=We.propertyNameToID("u_CurrentTime")},"VOLVELOCITYCONST",function(){return this.VOLVELOCITYCONST=We.propertyNameToID("u_VOLVelocityConst")},"VOLVELOCITYGRADIENTX",function(){return this.VOLVELOCITYGRADIENTX=We.propertyNameToID("u_VOLVelocityGradientX")},"VOLVELOCITYGRADIENTY",function(){return this.VOLVELOCITYGRADIENTY=We.propertyNameToID("u_VOLVelocityGradientY")},"VOLVELOCITYGRADIENTZ",function(){return this.VOLVELOCITYGRADIENTZ=We.propertyNameToID("u_VOLVelocityGradientZ")},"VOLVELOCITYCONSTMAX",function(){return this.VOLVELOCITYCONSTMAX=We.propertyNameToID("u_VOLVelocityConstMax")},"VOLVELOCITYGRADIENTXMAX",function(){return this.VOLVELOCITYGRADIENTXMAX=We.propertyNameToID("u_VOLVelocityGradientMaxX")},"VOLVELOCITYGRADIENTYMAX",function(){return this.VOLVELOCITYGRADIENTYMAX=We.propertyNameToID("u_VOLVelocityGradientMaxY")},"VOLVELOCITYGRADIENTZMAX",function(){return this.VOLVELOCITYGRADIENTZMAX=We.propertyNameToID("u_VOLVelocityGradientMaxZ")},"VOLSPACETYPE",function(){return this.VOLSPACETYPE=We.propertyNameToID("u_VOLSpaceType")},"COLOROVERLIFEGRADIENTALPHAS",function(){return this.COLOROVERLIFEGRADIENTALPHAS=We.propertyNameToID("u_ColorOverLifeGradientAlphas")},"COLOROVERLIFEGRADIENTCOLORS",function(){return this.COLOROVERLIFEGRADIENTCOLORS=We.propertyNameToID("u_ColorOverLifeGradientColors")},"MAXCOLOROVERLIFEGRADIENTALPHAS",function(){return this.MAXCOLOROVERLIFEGRADIENTALPHAS=We.propertyNameToID("u_MaxColorOverLifeGradientAlphas")},"MAXCOLOROVERLIFEGRADIENTCOLORS",function(){return this.MAXCOLOROVERLIFEGRADIENTCOLORS=We.propertyNameToID("u_MaxColorOverLifeGradientColors")},"SOLSIZEGRADIENT",function(){return this.SOLSIZEGRADIENT=We.propertyNameToID("u_SOLSizeGradient")},"SOLSIZEGRADIENTX",function(){return this.SOLSIZEGRADIENTX=We.propertyNameToID("u_SOLSizeGradientX")},"SOLSIZEGRADIENTY",function(){return this.SOLSIZEGRADIENTY=We.propertyNameToID("u_SOLSizeGradientY")},"SOLSizeGradientZ",function(){return this.SOLSizeGradientZ=We.propertyNameToID("u_SOLSizeGradientZ")},"SOLSizeGradientMax",function(){return this.SOLSizeGradientMax=We.propertyNameToID("u_SOLSizeGradientMax")},"SOLSIZEGRADIENTXMAX",function(){return this.SOLSIZEGRADIENTXMAX=We.propertyNameToID("u_SOLSizeGradientMaxX")},"SOLSIZEGRADIENTYMAX",function(){return this.SOLSIZEGRADIENTYMAX=We.propertyNameToID("u_SOLSizeGradientMaxY")},"SOLSizeGradientZMAX",function(){return this.SOLSizeGradientZMAX=We.propertyNameToID("u_SOLSizeGradientMaxZ")},"ROLANGULARVELOCITYCONST",function(){return this.ROLANGULARVELOCITYCONST=We.propertyNameToID("u_ROLAngularVelocityConst")},"ROLANGULARVELOCITYCONSTSEPRARATE",function(){return this.ROLANGULARVELOCITYCONSTSEPRARATE=We.propertyNameToID("u_ROLAngularVelocityConstSeprarate")},"ROLANGULARVELOCITYGRADIENT",function(){return this.ROLANGULARVELOCITYGRADIENT=We.propertyNameToID("u_ROLAngularVelocityGradient")},"ROLANGULARVELOCITYGRADIENTX",function(){return this.ROLANGULARVELOCITYGRADIENTX=We.propertyNameToID("u_ROLAngularVelocityGradientX")},"ROLANGULARVELOCITYGRADIENTY",function(){return this.ROLANGULARVELOCITYGRADIENTY=We.propertyNameToID("u_ROLAngularVelocityGradientY")},"ROLANGULARVELOCITYGRADIENTZ",function(){return this.ROLANGULARVELOCITYGRADIENTZ=We.propertyNameToID("u_ROLAngularVelocityGradientZ")},"ROLANGULARVELOCITYCONSTMAX",function(){return this.ROLANGULARVELOCITYCONSTMAX=We.propertyNameToID("u_ROLAngularVelocityConstMax")},"ROLANGULARVELOCITYCONSTMAXSEPRARATE",function(){return this.ROLANGULARVELOCITYCONSTMAXSEPRARATE=We.propertyNameToID("u_ROLAngularVelocityConstMaxSeprarate")},"ROLANGULARVELOCITYGRADIENTMAX",function(){return this.ROLANGULARVELOCITYGRADIENTMAX=We.propertyNameToID("u_ROLAngularVelocityGradientMax")},"ROLANGULARVELOCITYGRADIENTXMAX",function(){return this.ROLANGULARVELOCITYGRADIENTXMAX=We.propertyNameToID("u_ROLAngularVelocityGradientMaxX")},"ROLANGULARVELOCITYGRADIENTYMAX",function(){return this.ROLANGULARVELOCITYGRADIENTYMAX=We.propertyNameToID("u_ROLAngularVelocityGradientMaxY")},"ROLANGULARVELOCITYGRADIENTZMAX",function(){return this.ROLANGULARVELOCITYGRADIENTZMAX=We.propertyNameToID("u_ROLAngularVelocityGradientMaxZ")},"ROLANGULARVELOCITYGRADIENTWMAX",function(){return this.ROLANGULARVELOCITYGRADIENTWMAX=We.propertyNameToID("u_ROLAngularVelocityGradientMaxW")},"TEXTURESHEETANIMATIONCYCLES",function(){return this.TEXTURESHEETANIMATIONCYCLES=We.propertyNameToID("u_TSACycles")},"TEXTURESHEETANIMATIONSUBUVLENGTH",function(){return this.TEXTURESHEETANIMATIONSUBUVLENGTH=We.propertyNameToID("u_TSASubUVLength")},"TEXTURESHEETANIMATIONGRADIENTUVS",function(){return this.TEXTURESHEETANIMATIONGRADIENTUVS=We.propertyNameToID("u_TSAGradientUVs")},"TEXTURESHEETANIMATIONGRADIENTMAXUVS",function(){return this.TEXTURESHEETANIMATIONGRADIENTMAXUVS=We.propertyNameToID("u_TSAMaxGradientUVs")},"shaderDefines",function(){return this.shaderDefines=new ii(Is.shaderDefines)}]),St}(Is),Ia=function(n){function r(t,e,i){this._updateViewMatrix=!0,this._offScreenRenderTexture=null,this._alwaysUseRenderTexture=!1,this._renderTexture=null,this._postProcess=null,this.enableRender=!0,this._screenShaderData=new xe,this._postProcessCommandBuffers=[],void 0===t&&(t=0),void 0===e&&(e=.3),void 0===i&&(i=1e3),this._viewMatrix=new gt,this._projectionMatrix=new gt,this._projectionViewMatrix=new gt,this._projectionViewMatrixNoTranslateScale=new gt,this._viewport=new oe(0,0,0,0),this._normalizedViewport=new oe(0,0,1,1),this._aspectRatio=t,this._boundFrustum=new ut(gt.DEFAULT),qi.supportWebGLPlusCulling&&(this._boundFrustumBuffer=new Float32Array(24)),r.__super.call(this,e,i),this.transform.on("transformchanged",this,this._onTransformChanged)}I(r,"laya.d3.core.Camera",n);var t=r.prototype;return t._isLayerVisible=function(t){return 0!=(Math.pow(2,t)&this.cullingMask)},t._onTransformChanged=function(t){(t&=64)&&(this._updateViewMatrix=!0)},t._calculationViewport=function(t,e,i){var n=t.x*e,r=t.y*i,s=n+Math.max(t.width*e,0),a=r+Math.max(t.height*i,0),o=Math.ceil(n),h=Math.ceil(r),l=Math.floor(s),u=Math.floor(a),c=.5<=o-n?Math.floor(n):o,_=.5<=h-r?Math.floor(r):h,d=.5<=s-l?Math.ceil(s):l,f=.5<=a-u?Math.ceil(a):u;this._viewport.x=c,this._viewport.y=_,this._viewport.width=d-c,this._viewport.height=f-_},t._parse=function(t,e){n.prototype._parse.call(this,t,e);var i=t.viewport;this.normalizedViewport=new oe(i[0],i[1],i[2],i[3])},t._calculateProjectionMatrix=function(){if(!this._useUserProjectionMatrix)if(this._orthographic){var t=this.orthographicVerticalSize*this.aspectRatio*.5,e=.5*this.orthographicVerticalSize;gt.createOrthoOffCenter(-t,t,-e,e,this.nearPlane,this.farPlane,this._projectionMatrix)}else gt.createPerspective(3.1416*this.fieldOfView/180,this.aspectRatio,this.nearPlane,this.farPlane,this._projectionMatrix)},t._getCanvasHeight=function(){return this._offScreenRenderTexture?this._offScreenRenderTexture.height:Ei.clientHeight},t._applyPostProcessCommandBuffers=function(){for(var t=0,e=this._postProcessCommandBuffers.length;t<e;t++)this._postProcessCommandBuffers[t]._apply()},t._needForceSetRenderTexture=function(){return this._alwaysUseRenderTexture&&!this._offScreenRenderTexture},t.render=function(t,e){if(this._scene){var i=this._needForceSetRenderTexture();i&&(this._renderTexture=Js.getTemporary(Ei.clientWidth,Ei.clientHeight,0,0,1));var n,r,s=Nt.instance,a=Ei._instance,o=a.scene=this._scene;if(o.parallelSplitShadowMaps[0]){xe.setRuntimeValueMode(!1);var h=o.parallelSplitShadowMaps[0];h._calcAllLightCameraInfo(this),o._defineDatas.add(Rs.SHADERDEFINE_CAST_SHADOW);for(var l=0,u=h.shadowMapCount;l<u;l++){var c=h.cameras[l];a.camera=c,a.projectionViewMatrix=c.projectionViewMatrix,ye.renderObjectCulling(c,o,a,o._castShadowRenders);var _=h.cameras[l+1].renderTarget;_._start(),a.camera=c,a.viewport=c.viewport,c._prepareCameraToRender(),c._prepareCameraViewProject(c.viewMatrix,c.projectionMatrix,a.projectionViewMatrix,c._projectionViewMatrixNoTranslateScale),o._clear(s,a),o._opaqueQueue._render(a,!1),_._end()}o._defineDatas.remove(Rs.SHADERDEFINE_CAST_SHADOW),xe.setRuntimeValueMode(!0)}a.camera=this,o._preRenderScript(),n=a.viewMatrix=this.viewMatrix;var d=this._renderTexture;if(a.projectionViewMatrix=d?(d._start(),gt.multiply(Bs._invertYScaleMatrix,this._projectionMatrix,Bs._invertYProjectionMatrix),gt.multiply(Bs._invertYScaleMatrix,this.projectionViewMatrix,Bs._invertYProjectionViewMatrix),r=a.projectionMatrix=Bs._invertYProjectionMatrix,Bs._invertYProjectionViewMatrix):(r=a.projectionMatrix=this._projectionMatrix,this.projectionViewMatrix),a.viewport=this.viewport,this._prepareCameraToRender(),this._prepareCameraViewProject(n,r,a.projectionViewMatrix,this._projectionViewMatrixNoTranslateScale),o._preCulling(a,this),o._clear(s,a),o._renderScene(s,a,t,e),o._postRenderScript(),d&&d._end(),this._postProcess&&this._postProcess._render(),i){var f=yr.create(this._renderTexture,null,rn.screenShader,this._screenShaderData);f.run(),f.recover(),Js.setReleaseTemporary(this._renderTexture)}}},t.viewportPointToRay=function(t,e){ee.calculateCursorRay(t,this.viewport,this._projectionMatrix,this.viewMatrix,null,e)},t.normalizedViewportPointToRay=function(t,e){var i=r._tempVector20,n=this.viewport;i.x=t.x*n.width,i.y=t.y*n.height,ee.calculateCursorRay(i,this.viewport,this._projectionMatrix,this.viewMatrix,null,e)},t.worldToViewportPoint=function(t,e){gt.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.viewport.project(t,this._projectionViewMatrix,e),e.x=e.x/T.stage.clientScaleX,e.y=e.y/T.stage.clientScaleY},t.worldToNormalizedViewportPoint=function(t,e){gt.multiply(this._projectionMatrix,this._viewMatrix,this._projectionViewMatrix),this.normalizedViewport.project(t,this._projectionViewMatrix,e),e.x=e.x/T.stage.clientScaleX,e.y=e.y/T.stage.clientScaleY},t.convertScreenCoordToOrthographicCoord=function(t,e){if(this._orthographic){var i=Ei.clientWidth,n=Ei.clientHeight,r=this.orthographicVerticalSize*this.aspectRatio/i,s=this.orthographicVerticalSize/n;return e.x=(-i/2+t.x)*r,e.y=(n/2-t.y)*s,e.z=(this.nearPlane-this.farPlane)*(t.z+1)/2-this.nearPlane,ln.transformCoordinate(e,this.transform.worldMatrix,e),!0}return!1},t.destroy=function(t){void 0===t&&(t=!0),this._offScreenRenderTexture=null,this.transform.off("transformchanged",this,this._onTransformChanged),n.prototype.destroy.call(this,t)},t.addCommandBuffer=function(t,e){switch(t){case 0:this._postProcessCommandBuffers.push(e);break;default:throw"Camera:unknown event."}},t.removeCommandBuffer=function(t,e){switch(t){case 0:var i=this._postProcessCommandBuffers.indexOf(e);-1!==i&&this._postProcessCommandBuffers.splice(i,1);break;default:throw"Camera:unknown event."}},t.removeCommandBuffers=function(t){switch(t){case 0:this._postProcessCommandBuffers.length=0;break;default:throw"Camera:unknown event."}},t.getRenderTexture=function(){return this._renderTexture},g(0,t,"alwaysUseRenderTexture",function(){return this._alwaysUseRenderTexture},function(t){this._alwaysUseRenderTexture=t}),g(0,t,"projectionViewMatrix",function(){return gt.multiply(this.projectionMatrix,this.viewMatrix,this._projectionViewMatrix),this._projectionViewMatrix}),g(0,t,"projectionMatrix",function(){return this._projectionMatrix},function(t){this._projectionMatrix=t,this._useUserProjectionMatrix=!0}),g(0,t,"renderTarget",function(){return this._offScreenRenderTexture},function(t){this._offScreenRenderTexture!==t&&(this._offScreenRenderTexture=t,this._renderTexture=t,this._calculateProjectionMatrix())}),g(0,t,"viewport",function(){return this._offScreenRenderTexture?this._calculationViewport(this._normalizedViewport,this._offScreenRenderTexture.width,this._offScreenRenderTexture.height):this._calculationViewport(this._normalizedViewport,Ei.clientWidth,Ei.clientHeight),this._viewport},function(t){var e=0,i=0;i=this._offScreenRenderTexture?(e=this._offScreenRenderTexture.width,this._offScreenRenderTexture.height):(e=Ei.clientWidth,Ei.clientHeight),this._normalizedViewport.x=t.x/e,this._normalizedViewport.y=t.y/i,this._normalizedViewport.width=t.width/e,this._normalizedViewport.height=t.height/i,this._calculationViewport(this._normalizedViewport,e,i),this._calculateProjectionMatrix()}),g(0,t,"viewMatrix",function(){if(this._updateViewMatrix){var t=this.transform.scale,e=t.x,i=t.y,n=t.z,r=this._viewMatrix.elements;this.transform.worldMatrix.cloneTo(this._viewMatrix),r[0]/=e,r[1]/=e,r[2]/=e,r[4]/=i,r[5]/=i,r[6]/=i,r[8]/=n,r[9]/=n,r[10]/=n,this._viewMatrix.invert(this._viewMatrix),this._updateViewMatrix=!1}return this._viewMatrix}),g(0,t,"normalizedViewport",function(){return this._normalizedViewport},function(t){var e=0,i=0;i=this._offScreenRenderTexture?(e=this._offScreenRenderTexture.width,this._offScreenRenderTexture.height):(e=Ei.clientWidth,Ei.clientHeight),this._normalizedViewport!==t&&t.cloneTo(this._normalizedViewport),this._calculationViewport(t,e,i),this._calculateProjectionMatrix()}),g(0,t,"postProcess",function(){return this._postProcess},function(t){this._postProcess=t,this.alwaysUseRenderTexture=!0;var e=new rn;this.addCommandBuffer(0,e),t._init(this,e)}),g(0,t,"boundFrustum",function(){if(this._boundFrustum.matrix=this.projectionViewMatrix,qi.supportWebGLPlusCulling){var t=this._boundFrustum.near,e=this._boundFrustum.far,i=this._boundFrustum.left,n=this._boundFrustum.right,r=this._boundFrustum.top,s=this._boundFrustum.bottom,a=t.normal,o=e.normal,h=i.normal,l=n.normal,u=r.normal,c=s.normal,_=this._boundFrustumBuffer;_[0]=a.x,_[1]=a.y,_[2]=a.z,_[3]=t.distance,_[4]=o.x,_[5]=o.y,_[6]=o.z,_[7]=e.distance,_[8]=h.x,_[9]=h.y,_[10]=h.z,_[11]=i.distance,_[12]=l.x,_[13]=l.y,_[14]=l.z,_[15]=n.distance,_[16]=u.x,_[17]=u.y,_[18]=u.z,_[19]=r.distance,_[20]=c.x,_[21]=c.y,_[22]=c.z,_[23]=s.distance}return this._boundFrustum}),g(0,t,"aspectRatio",function(){if(0!==this._aspectRatio)return this._aspectRatio;var t=this.viewport;return t.width/t.height},function(t){if(t<0)throw new Error("Camera: the aspect ratio has to be a positive real number.");this._aspectRatio=t,this._calculateProjectionMatrix()}),r.CAMERAEVENT_POSTPROCESS=0,r._updateMark=0,E(r,["_tempVector20",function(){return this._tempVector20=new un}]),r}(Bs),Ra=function(t){function i(t,e){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,i.__super.call(this),this.skin=e,this.labels=t}I(i,"laya.ui.UIGroup",t);var e=i.prototype;return T.imps(e,{"laya.ui.IItem":!0}),e.preinitialize=function(){this.mouseEnabled=!0},e.destroy=function(t){void 0===t&&(t=!0),laya.ui.UIComponent.prototype.destroy.call(this,t),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},e.addItem=function(t,e){void 0===e&&(e=!0);var i=t,n=this._items.length;if(i.name="item"+n,this.addChild(i),this.initItems(),e&&0<n){var r=this._items[n-1];"horizontal"==this._direction?i.x=r._x+r.width+this._space:i.y=r._y+r.height+this._space}else e&&(i.x=0,i.y=0);return n},e.delItem=function(t,e){void 0===e&&(e=!0);var i=this._items.indexOf(t);if(-1!=i){var n=t;this.removeChild(n);for(var r=i+1,s=this._items.length;r<s;r++){var a=this._items[r];a.name="item"+(r-1),e&&("horizontal"==this._direction?a.x-=n.width+this._space:a.y-=n.height+this._space)}if(this.initItems(),-1<this._selectedIndex){var o;o=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=o}}},e._afterInited=function(){this.initItems()},e.initItems=function(){this._items||(this._items=[]);for(var t=this._items.length=0;t<1e4;t++){var e=this.getChildByName("item"+t);if(null==e)break;this._items.push(e),e.selected=t===this._selectedIndex,e.clickHandler=y.create(this,this.itemClick,[t],!1)}},e.itemClick=function(t){this.selectedIndex=t},e.setSelect=function(t,e){this._items&&-1<t&&t<this._items.length&&(this._items[t].selected=e)},e._skinLoaded=function(){this._setLabelChanged(),this.event("loaded")},e.createItem=function(t,e){return null},e.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var t=0,e=0,i=this._items.length;e<i;e++){var n=this._items[e];this._skin&&(n.skin=this._skin),this._labelColors&&(n.labelColors=this._labelColors),this._labelSize&&(n.labelSize=this._labelSize),this._labelStroke&&(n.labelStroke=this._labelStroke),this._labelStrokeColor&&(n.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&(n.strokeColors=this._strokeColors),this._labelBold&&(n.labelBold=this._labelBold),this._labelPadding&&(n.labelPadding=this._labelPadding),this._labelAlign&&(n.labelAlign=this._labelAlign),this._stateNum&&(n.stateNum=this._stateNum),this._labelFont&&(n.labelFont=this._labelFont),"horizontal"===this._direction?(n.y=0,n.x=t,t+=n.width+this._space):(n.x=0,n.y=t,t+=n.height+this._space)}this._sizeChanged()},e.commitMeasure=function(){this.runCallLater(this.changeLabels)},e._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},g(0,e,"dataSource",t.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t?this.selectedIndex=parseInt(t):t instanceof Array?this.labels=t.join(","):T.superSet(Qs,this,"dataSource",t)}),g(0,e,"items",function(){return this._items}),g(0,e,"space",function(){return this._space},function(t){this._space=t,this._setLabelChanged()}),g(0,e,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(t){this.selectedIndex=this._items.indexOf(t)}),g(0,e,"direction",function(){return this._direction},function(t){this._direction=t,this._setLabelChanged()}),g(0,e,"labelPadding",function(){return this._labelPadding},function(t){this._labelPadding!=t&&(this._labelPadding=t,this._setLabelChanged())}),g(0,e,"labels",function(){return this._labels},function(t){if(this._labels!=t){if(this._labels=t,this.removeChildren(),this._setLabelChanged(),this._labels)for(var e=this._labels.split(","),i=0,n=e.length;i<n;i++){var r=this.createItem(this._skin,e[i]);r.name="item"+i,this.addChild(r)}this.initItems()}}),g(0,e,"stateNum",function(){return this._stateNum},function(t){this._stateNum!=t&&(this._stateNum=t,this._setLabelChanged())}),g(0,e,"labelFont",function(){return this._labelFont},function(t){this._labelFont!=t&&(this._labelFont=t,this._setLabelChanged())}),g(0,e,"labelStrokeColor",function(){return this._labelStrokeColor},function(t){this._labelStrokeColor!=t&&(this._labelStrokeColor=t,this._setLabelChanged())}),g(0,e,"strokeColors",function(){return this._strokeColors},function(t){this._strokeColors!=t&&(this._strokeColors=t,this._setLabelChanged())}),g(0,e,"labelColors",function(){return this._labelColors},function(t){this._labelColors!=t&&(this._labelColors=t,this._setLabelChanged())}),g(0,e,"labelStroke",function(){return this._labelStroke},function(t){this._labelStroke!=t&&(this._labelStroke=t,this._setLabelChanged())}),g(0,e,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this._skin&&!Hn.getRes(this._skin)?T.loader.load(this._skin,y.create(this,this._skinLoaded),null,"image",1):this._skinLoaded())}),g(0,e,"labelSize",function(){return this._labelSize},function(t){this._labelSize!=t&&(this._labelSize=t,this._setLabelChanged())}),g(0,e,"labelBold",function(){return this._labelBold},function(t){this._labelBold!=t&&(this._labelBold=t,this._setLabelChanged())}),g(0,e,"selectedIndex",function(){return this._selectedIndex},function(t){this._selectedIndex!=t&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=t,this.setSelect(t,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),i}(Qs),Aa=function(t){function e(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,e.__super.call(this),this.width=this.height=200}I(e,"laya.ui.Tree",t);var i=e.prototype;return T.imps(i,{"laya.ui.IRender":!0}),i.destroy=function(t){void 0===t&&(t=!0),laya.ui.UIComponent.prototype.destroy.call(this,t),this._list&&this._list.destroy(t),this._list=null,this._source=null,this._renderHandler=null},i.createChildren=function(){this.addChild(this._list=new Da),this._list.renderHandler=y.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},i.onListChange=function(t){this.event("change")},i.getArray=function(){var t,e=[];for(var i in this._source)t=this._source[i],this.getParentOpenStatus(t)&&(t.x=this._spaceLeft*this.getDepth(t),e.push(t));return e},i.getDepth=function(t,e){return void 0===e&&(e=0),null==t.nodeParent?e:this.getDepth(t.nodeParent,e+1)},i.getParentOpenStatus=function(t){var e=t.nodeParent;return null==e||!!e.isOpen&&(null==e.nodeParent||this.getParentOpenStatus(e))},i.renderItem=function(t,e){var i=t.dataSource;if(i){t.left=i.x;var n=t.getChildByName("arrow");n&&(i.hasChild?(n.visible=!0,n.index=i.isOpen?1:0,n.tag=e,n.off("click",this,this.onArrowClick),n.on("click",this,this.onArrowClick)):n.visible=!1);var r=t.getChildByName("folder");r&&(2==r.clipY?r.index=i.isDirectory?0:1:r.index=i.isDirectory?i.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([t,e])}},i.onArrowClick=function(t){var e=t.currentTarget.tag;this._list.array[e].isOpen=!this._list.array[e].isOpen,this.event("open"),this._list.array=this.getArray()},i.setItemState=function(t,e){this._list.array[t]&&(this._list.array[t].isOpen=e,this._list.array=this.getArray())},i.fresh=function(){this._list.array=this.getArray(),this.repaint()},i.parseXml=function(t,e,i,n){var r,s=t.childNodes,a=s.length;if(!n){r={};var o,h=t.attributes;for(var l in h){var u=(o=h[l]).nodeName,c=o.nodeValue;r[u]="true"==c||"false"!=c&&c}r.nodeParent=i,0<a&&(r.isDirectory=!0),r.hasChild=0<a,e.push(r)}for(var _=0;_<a;_++){var d=s[_];this.parseXml(d,e,r,!1)}},i.parseOpenStatus=function(t,e){for(var i=0,n=e.length;i<n;i++){var r=e[i];if(r.isDirectory)for(var s=0,a=t.length;s<a;s++){var o=t[s];if(o.isDirectory&&this.isSameParent(o,r)&&r.label==o.label){r.isOpen=o.isOpen;break}}}},i.isSameParent=function(t,e){return null==t.nodeParent&&null==e.nodeParent||null!=t.nodeParent&&null!=e.nodeParent&&(t.nodeParent.label==e.nodeParent.label&&this.isSameParent(t.nodeParent,e.nodeParent))},i.filter=function(t){if(Boolean(t)){var e=[];this.getFilterSource(this._source,e,t),this._list.array=e}else this._list.array=this.getArray()},i.getFilterSource=function(t,e,i){var n;for(var r in i=i.toLocaleLowerCase(),t)!(n=t[r]).isDirectory&&-1<String(n.label).toLowerCase().indexOf(i)&&(n.x=0,e.push(n)),n.child&&0<n.child.length&&this.getFilterSource(n.child,e,i)},g(0,i,"xml",null,function(t){var e=[];this.parseXml(t.childNodes[0],e,null,!0),this.array=e}),g(0,i,"height",t.prototype._$get_height,function(t){T.superSet(Qs,this,"height",t),this._list.height=t}),g(0,i,"width",t.prototype._$get_width,function(t){T.superSet(Qs,this,"width",t),this._list.width=t}),g(0,i,"selectedIndex",function(){return this._list.selectedIndex},function(t){this._list.selectedIndex=t}),g(0,i,"dataSource",t.prototype._$get_dataSource,function(t){this._dataSource=t,T.superSet(Qs,this,"dataSource",t)}),g(0,i,"scrollBar",function(){return this._list.scrollBar}),g(0,i,"spaceLeft",function(){return this._spaceLeft},function(t){this._spaceLeft=t}),g(0,i,"renderHandler",function(){return this._renderHandler},function(t){this._renderHandler=t}),g(0,i,"itemRender",function(){return this._list.itemRender},function(t){this._list.itemRender=t}),g(0,i,"mouseHandler",function(){return this._list.mouseHandler},function(t){this._list.mouseHandler=t}),g(0,i,"spaceBottom",function(){return this._list.spaceY},function(t){this._list.spaceY=t}),g(0,i,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),g(0,i,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function(t){this._list.vScrollBarSkin=t}),g(0,i,"source",function(){return this._source}),g(0,i,"array",function(){return this._list.array},function(t){this._keepStatus&&this._list.array&&t&&this.parseOpenStatus(this._list.array,t),this._source=t,this._list.array=this.getArray()}),g(0,i,"selectedItem",function(){return this._list.selectedItem},function(t){this._list.selectedItem=t}),g(0,i,"list",function(){return this._list}),g(0,i,"keepStatus",function(){return this._keepStatus},function(t){this._keepStatus=t}),e}(Qs),Ma=function(e){function n(){this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this.isShowEffect=!0,this.isPopupCenter=!0,this.closeType=null,this._dragArea=null,this._param=null,this._effectTween=null,n.__super.call(this),this.popupEffect=n.manager.popupEffectHandler,this.closeEffect=n.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)}I(n,"laya.ui.Dialog",e);var t=n.prototype;return t._dealDragArea=function(){var t=this.getChildByName("drag");t&&(this.dragArea=t._x+","+t._y+","+t.width+","+t.height,t.removeSelf())},t._onMouseDown=function(t){var e=this.getMousePoint();this._dragArea.contains(e.x,e.y)?this.startDrag():this.stopDrag()},t._onClick=function(t){var e=t.target;if(e)switch(e.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":return void this.close(e.name)}},t.open=function(t,e){void 0===t&&(t=!0),this._dealDragArea(),this._param=e,n.manager.open(this,t,this.isShowEffect),n.manager.lock(!1)},t.close=function(t){this.closeType=t,n.manager.close(this)},t.destroy=function(t){void 0===t&&(t=!0),this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this._dragArea=null,e.prototype.destroy.call(this,t)},t.show=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!0),this._open(!1,t,e)},t.popup=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!0),this._open(!0,t,e)},t._open=function(t,e,i){this.isModal=t,this.isShowEffect=i,n.manager.lock(!0),this.open(e)},g(0,t,"zOrder",e.prototype._$get_zOrder,function(t){T.superSet($s,this,"zOrder",t),n.manager._checkMask()}),g(0,t,"isPopup",function(){return null!=this.parent}),g(0,t,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function(t){if(t){var e=be.fillArray([0,0,0,0],t,Number);this._dragArea=new ve(e[0],e[1],e[2],e[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)}),g(1,n,"manager",function(){return n._manager=n._manager||new Vs},function(t){n._manager=t}),n.setLockView=function(t){n.manager.setLockView(t)},n.lock=function(t){n.manager.lock(t)},n.closeAll=function(){n.manager.closeAll()},n.getDialogsByGroup=function(t){return n.manager.getDialogsByGroup(t)},n.closeByGroup=function(t){return n.manager.closeByGroup(t)},n.CLOSE="close",n.CANCEL="cancel",n.SURE="sure",n.NO="no",n.YES="yes",n.OK="ok",n._manager=null,n}($s),Da=function(t){function e(){this.selectHandler=null,this.renderHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._$componentType="List",this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,this._usedCache=null,this._elasticEnabled=!1,this._preLen=0,e.__super.call(this),this._cells=[],this._offset=new R}I(e,"laya.ui.List",t);var i=e.prototype;return T.imps(i,{"laya.ui.IItem":!0,"laya.ui.IRender":!0}),i.destroy=function(t){void 0===t&&(t=!0),this._content&&this._content.destroy(t),this._scrollBar&&this._scrollBar.destroy(t),laya.ui.UIComponent.prototype.destroy.call(this,t),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this.selectHandler=this.renderHandler=this.mouseHandler=null},i.createChildren=function(){this.addChild(this._content=new Qs)},i.onScrollStart=function(){this._usedCache||(this._usedCache=T.superGet(Qs,this,"cacheAs")),T.superSet(Qs,this,"cacheAs","none"),this._scrollBar.once("end",this,this.onScrollEnd)},i.onScrollEnd=function(){T.superSet(Qs,this,"cacheAs",this._usedCache)},i._removePreScrollBar=function(){var t=this.removeChildByName("scrollBar");t&&t.destroy(!0)},i.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var t=this._getOneCell(),e=t.width+this._spaceX||1,i=t.height+this._spaceY||1;0<this._width&&(this._repeatX2=this._isVertical?Math.round(this._width/e):Math.ceil(this._width/e)),0<this._height&&(this._repeatY2=this._isVertical?Math.ceil(this._height/i):Math.round(this._height/i));var n=this._width?this._width:e*this.repeatX-this._spaceX,r=this._height?this._height:i*this.repeatY-this._spaceY;this._cellSize=this._isVertical?i:e,this._cellOffset=this._isVertical?i*Math.max(this._repeatY2,this._repeatY)-r-this._spaceY:e*Math.max(this._repeatX2,this._repeatX)-n-this._spaceX,this._isVertical&&this.vScrollBarSkin?this._scrollBar.height=r:!this._isVertical&&this.hScrollBarSkin&&(this._scrollBar.width=n),this.setContentSize(n,r);var s=this._isVertical?this.repeatX:this.repeatY,a=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,s,a),this._createdLine=a,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},i._getOneCell=function(){if(0===this._cells.length){var t=this.createItem();if(this._offset.setTo(t._x,t._y),this.cacheContent)return t;this._cells.push(t)}return this._cells[0]},i._createItems=function(t,e,i){var n=this._content,r=this._getOneCell(),s=r.width+this._spaceX,a=r.height+this._spaceY;if(this.cacheContent){var o=new Qs;o.cacheAs="normal",o.pos((this._isVertical?0:t)*s,(this._isVertical?t:0)*a),this._content.addChild(o),n=o}else{for(var h=[],l=this._cells.length-1;-1<l;l--){var u=this._cells[l];u.removeSelf(),h.push(u)}this._cells.length=0}for(var c=t;c<i;c++)for(var _=0;_<e;_++)(r=h&&h.length?h.pop():this.createItem()).x=(this._isVertical?_:c)*s-n._x,r.y=(this._isVertical?c:_)*a-n._y,r.name="item"+(c*e+_),n.addChild(r),this.addCell(r)},i.createItem=function(){var t=[];if("function"==typeof this._itemRender)var e=new this._itemRender;else e=Qi.createComp(this._itemRender,null,null,t);if(0==t.length&&e._watchMap){var i=e._watchMap;for(var n in i)for(var r=i[n],s=0;s<r.length;s++){var a=r[s];t.push(a.comp,a.prop,a.value)}}return t.length&&(e._$bindData=t),e},i.addCell=function(t){t.on("click",this,this.onCellMouse),t.on("rightclick",this,this.onCellMouse),t.on("mouseover",this,this.onCellMouse),t.on("mouseout",this,this.onCellMouse),t.on("mousedown",this,this.onCellMouse),t.on("mouseup",this,this.onCellMouse),this._cells.push(t)},i._afterInited=function(){this.initItems()},i.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;for(var t=0,e=t=0;e<1e4;e++){var i=this.getChildByName("item"+e);if(!i)break;this.addCell(i),t++}this.repeatY=t}},i.setContentSize=function(t,e){this._content.width=t,this._content.height=e,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content._style.scrollRect||(this._content.scrollRect=ve.create()),this._content._style.scrollRect.setTo(-this._offset.x,-this._offset.y,t,e),this._content.scrollRect=this._content.scrollRect),this.event("resize")},i.onCellMouse=function(t){"mousedown"===t.type&&(this._isMoved=!1);var e=t.currentTarget,i=this._startIndex+this._cells.indexOf(e);i<0||("click"===t.type||"rightclick"===t.type?this.selectEnable&&!this._isMoved?this.selectedIndex=i:this.changeCellState(e,!0,0):"mouseover"!==t.type&&"mouseout"!==t.type||this._selectedIndex===i||this.changeCellState(e,"mouseover"===t.type,0),this.mouseHandler&&this.mouseHandler.runWith([t,i]))},i.changeCellState=function(t,e,i){var n=t.getChildByName("selectBox");n&&(this.selectEnable=!0,n.visible=e,n.index=i)},i._sizeChanged=function(){laya.ui.UIComponent.prototype._sizeChanged.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},i.onScrollBarChange=function(t){this.runCallLater(this.changeCells);var e=this._scrollBar.value,i=this._isVertical?this.repeatX:this.repeatY,n=this._isVertical?this.repeatY:this.repeatX,r=Math.floor(e/this._cellSize);if(this.cacheContent)a=n+1,this._createdLine-r<a&&(this._createItems(this._createdLine,i,this._createdLine+a),this.renderItems(this._createdLine*i,0),this._createdLine+=a);else{var s=r*i,a=0;if(s>this._startIndex){a=s-this._startIndex;var o=!0,h=this._startIndex+i*(n+1);this._isMoved=!0}else s<this._startIndex&&(a=this._startIndex-s,o=!1,h=this._startIndex-1,this._isMoved=!0);for(var l=0;l<a;l++){if(o){var u=this._cells.shift();this._cells[this._cells.length]=u;var c=h+l}else u=this._cells.pop(),this._cells.unshift(u),c=h-l;var _=Math.floor(c/i)*this._cellSize;this._isVertical?u.y=_:u.x=_,this.renderItem(u,c)}this._startIndex=s,this.changeSelectStatus()}var d=this._content._style.scrollRect;this._isVertical?(d.y=e-this._offset.y,d.x=-this._offset.x):(d.y=-this._offset.y,d.x=e-this._offset.x),this._content.scrollRect=d},i.posCell=function(t,e){if(this._scrollBar){var i=this._isVertical?this.repeatX:this.repeatY,n=(this._isVertical?this.repeatY:this.repeatX,Math.floor(e/i)*this._cellSize);this._isVertical?t._y=n:t.x=n}},i.changeSelectStatus=function(){for(var t=0,e=this._cells.length;t<e;t++)this.changeCellState(this._cells[t],this._selectedIndex===this._startIndex+t,1)},i.renderItems=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);for(var i=t,n=e||this._cells.length;i<n;i++)this.renderItem(this._cells[i],this._startIndex+i);this.changeSelectStatus()},i.renderItem=function(t,e){this._array&&0<=e&&e<this._array.length?(t.visible=!0,t._$bindData?(t._dataSource=this._array[e],this._bindData(t,this._array[e])):t.dataSource=this._array[e],this.cacheContent||this.posCell(t,e),this.hasListener("render")&&this.event("render",[t,e]),this.renderHandler&&this.renderHandler.runWith([t,e])):(t.visible=!1,t.dataSource=null)},i._bindData=function(t,e){for(var i=t._$bindData,n=0,r=i.length;n<r;n++){var s=i[n++],a=i[n++],o=i[n],h=be.getBindFun(o);s[a]=h.call(this,e)}},i.updateArray=function(t){this._array=t;var e=0;if(this._array&&(0<=(e=this._preLen-this._startIndex)&&this.renderItems(e),this._preLen=this._array.length),this._scrollBar){var i=t.length,n=this._isVertical?this.repeatX:this.repeatY,r=this._isVertical?this.repeatY:this.repeatX,s=Math.ceil(i/n);r<=s&&(this._scrollBar.thumbPercent=r/s,this._scrollBar.slider._max=(s-r)*this._cellSize+this._cellOffset)}},i.refresh=function(){this.array=this._array},i.getItem=function(t){return-1<t&&t<this._array.length?this._array[t]:null},i.changeItem=function(t,e){-1<t&&t<this._array.length&&(this._array[t]=e,t>=this._startIndex&&t<this._startIndex+this._cells.length&&this.renderItem(this.getCell(t),t))},i.setItem=function(t,e){this.changeItem(t,e)},i.addItem=function(t){this._array.push(t),this.array=this._array},i.addItemAt=function(t,e){this._array.splice(e,0,t),this.array=this._array},i.deleteItem=function(t){this._array.splice(t,1),this.array=this._array},i.getCell=function(t){return this.runCallLater(this.changeCells),-1<t&&this._cells?this._cells[(t-this._startIndex)%this._cells.length]:null},i.scrollTo=function(t){if(this._scrollBar){var e=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor(t/e)*this._cellSize}else this.startIndex=t},i.tweenTo=function(t,e,i){if(void 0===e&&(e=200),this._scrollBar){this._scrollBar.stopScroll();var n=this._isVertical?this.repeatX:this.repeatY;Ii.to(this._scrollBar,{value:Math.floor(t/n)*this._cellSize},e,null,i,0,!0)}else this.startIndex=t,i&&i.run()},i._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},i.commitMeasure=function(){this.runCallLater(this.changeCells)},g(0,i,"length",function(){return this._array?this._array.length:0}),g(0,i,"startIndex",function(){return this._startIndex},function(t){this._startIndex=0<t?t:0,this.callLater(this.renderItems)}),g(0,i,"array",function(){return this._array},function(t){this.runCallLater(this.changeCells),this._array=t||[],this._preLen=this._array.length;var e=this._array.length;if(this.totalPage=Math.ceil(e/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<e?this._selectedIndex:e-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var i=this._isVertical?this.repeatX:this.repeatY,n=this._isVertical?this.repeatY:this.repeatX,r=Math.ceil(e/i),s=0<this._cellOffset?this.totalPage+1:this.totalPage;this._scrollBar.target=(1<s&&n<=r?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=n/r,this._scrollBar.setScroll(0,(r-n)*this._cellSize+this._cellOffset,this._scrollBar.value)):this._scrollBar.setScroll(0,0,0),this._content)}}),g(0,i,"selection",function(){return this.getCell(this._selectedIndex)},function(t){this.selectedIndex=this._startIndex+this._cells.indexOf(t)}),g(0,i,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function(t){this.selectedIndex=this._array.indexOf(t)}),g(0,i,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),g(0,i,"spaceY",function(){return this._spaceY},function(t){this._spaceY=t,this._setCellChanged()}),g(0,i,"page",function(){return this._page},function(t){this._page=t,this._array&&(this._page=0<t?t:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),g(0,i,"height",t.prototype._$get_height,function(t){t!=this._height&&(T.superSet(Qs,this,"height",t),this._setCellChanged())}),g(0,i,"repeatY",function(){return 0<this._repeatY?this._repeatY:0<this._repeatY2?this._repeatY2:1},function(t){this._repeatY=t,this._setCellChanged()}),g(0,i,"repeatX",function(){return 0<this._repeatX?this._repeatX:0<this._repeatX2?this._repeatX2:1},function(t){this._repeatX=t,this._setCellChanged()}),g(0,i,"spaceX",function(){return this._spaceX},function(t){this._spaceX=t,this._setCellChanged()}),g(0,i,"width",t.prototype._$get_width,function(t){t!=this._width&&(T.superSet(Qs,this,"width",t),this._setCellChanged())}),g(0,i,"dataSource",t.prototype._$get_dataSource,function(t){"number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t?this.selectedIndex=parseInt(t):t instanceof Array?this.array=t:T.superSet(Qs,this,"dataSource",t)}),g(0,i,"scrollBar",function(){return this._scrollBar},function(t){this._scrollBar!=t&&(this._scrollBar=t)&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange))}),g(0,i,"cacheAs",t.prototype._$get_cacheAs,function(t){T.superSet(Qs,this,"cacheAs",t),this._scrollBar&&(this._usedCache=null,"none"!==t?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),g(0,i,"itemRender",function(){return this._itemRender},function(t){if(this._itemRender!=t){this._itemRender=t;for(var e=this._cells.length-1;-1<e;e--)this._cells[e].destroy();this._cells.length=0,this._setCellChanged()}}),g(0,i,"content",function(){return this._content}),g(0,i,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(t){this._removePreScrollBar();var e=new Ha;e.name="scrollBar",e.bottom=0,e.skin=t,e.elasticDistance=this._elasticEnabled?200:0,this.scrollBar=e,this.addChild(e),this._setCellChanged()}),g(0,i,"elasticEnabled",function(){return this._elasticEnabled},function(t){this._elasticEnabled=t,this._scrollBar&&(this._scrollBar.elasticDistance=t?200:0)}),g(0,i,"selectedIndex",function(){return this._selectedIndex},function(t){this._selectedIndex!=t&&(this._selectedIndex=t,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith(t),this.startIndex=this._startIndex)}),g(0,i,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(t){this._removePreScrollBar();var e=new Ga;e.name="scrollBar",e.right=0,e.skin=t,e.elasticDistance=this._elasticEnabled?200:0,this.scrollBar=e,this.addChild(e),this._setCellChanged()}),e}(Qs),ba=function(t){function i(t,e){void 0===e&&(e=""),i.__super.call(this,t,e)}I(i,"laya.ui.CheckBox",t);var e=i.prototype;return e.preinitialize=function(){laya.ui.UIComponent.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},e.initialize=function(){t.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},g(0,e,"dataSource",t.prototype._$get_dataSource,function(t){"boolean"==typeof(this._dataSource=t)?this.selected=t:"string"==typeof t?this.selected="true"===t:T.superSet(ta,this,"dataSource",t)}),i}(ta),wa=function(t){function e(){this._space=0,this._align="none",this._itemChanged=!1,e.__super.call(this)}I(e,"laya.ui.LayoutBox",Qs);var i=e.prototype;return i.addChild=function(t){return t.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,t)},i.onResize=function(t){this._setItemChanged()},i.addChildAt=function(t,e){return t.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,t,e)},i.removeChildAt=function(t){return this.getChildAt(t).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,t)},i.refresh=function(){this._setItemChanged()},i.changeItems=function(){this._itemChanged=!1},i.sortItem=function(t){t&&t.sort(function(t,e){return t.y-e.y})},i._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},g(0,i,"align",function(){return this._align},function(t){this._align=t,this._setItemChanged()}),g(0,i,"space",function(){return this._space},function(t){this._space=t,this._setItemChanged()}),e}(),La=function(e){function i(t){this._bg=null,this._skin=null,i.__super.call(this),void 0===t&&(t=""),this.text=t,this.skin=this.skin}I(i,"laya.ui.TextInput",e);var t=i.prototype;return t.preinitialize=function(){this.mouseEnabled=!0},t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._bg&&this._bg.destroy(),this._bg=null},t.createChildren=function(){this.addChild(this._tf=new Ta),this._tf.padding=de.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},t._onFocus=function(){this.event("focus",this)},t._onBlur=function(){this.event("blur",this)},t._onInput=function(){this.event("input",this)},t._onEnter=function(){this.event("enter",this)},t.initialize=function(){this.width=128,this.height=22},t._skinLoaded=function(){this._bg||(this.graphics=this._bg=new ur),this._bg.source=Hn.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height),this._sizeChanged(),this.event("loaded")},t.select=function(){this._tf.select()},t.setSelection=function(t,e){this._tf.setSelection(t,e)},g(0,t,"type",function(){return this._tf.type},function(t){this._tf.type=t}),g(0,t,"maxChars",function(){return this._tf.maxChars},function(t){this._tf.maxChars=t}),g(0,t,"promptColor",function(){return this._tf.promptColor},function(t){this._tf.promptColor=t}),g(0,t,"editable",function(){return this._tf.editable},function(t){this._tf.editable=t}),g(0,t,"width",e.prototype._$get_width,function(t){T.superSet(na,this,"width",t),this._bg&&(this._bg.width=t)}),g(0,t,"multiline",function(){return this._tf.multiline},function(t){this._tf.multiline=t}),g(0,t,"height",e.prototype._$get_height,function(t){T.superSet(na,this,"height",t),this._bg&&(this._bg.height=t)}),g(0,t,"text",e.prototype._$get_text,function(t){this._tf.text!=t&&(t+="",this._tf.text=t,this.event("change"))}),g(0,t,"prompt",function(){return this._tf.prompt},function(t){this._tf.prompt=t}),g(0,t,"restrict",function(){return this._tf.restrict},function(t){this._tf.restrict=t}),g(0,t,"focus",function(){return this._tf.focus},function(t){this._tf.focus=t}),g(0,t,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this._skin&&!Hn.getRes(this._skin)?T.loader.load(this._skin,y.create(this,this._skinLoaded),null,"image",1):this._skinLoaded())}),g(0,t,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function(t){this._bg||(this.graphics=this._bg=new ur),this._bg.sizeGrid=be.fillArray(de.defaultSizeGrid,t,Number)}),g(0,t,"bg",function(){return this._bg},function(t){this.graphics=this._bg=t}),i}(na),Oa=function(t){function e(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,this._usedCache=null,this._elasticEnabled=!1,e.__super.call(this),this.width=this.height=100}I(e,"laya.ui.Panel",t);var i=e.prototype;return i.destroy=function(t){void 0===t&&(t=!0),laya.ui.UIComponent.prototype.destroy.call(this,t),this._content&&this._content.destroy(t),this._vScrollBar&&this._vScrollBar.destroy(t),this._hScrollBar&&this._hScrollBar.destroy(t),this._vScrollBar=null,this._hScrollBar=null,this._content=null},i.destroyChildren=function(){this._content.destroyChildren()},i.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new Qs)},i.addChild=function(t){return t.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild(t)},i.onResize=function(){this._setScrollChanged()},i.addChildAt=function(t,e){return t.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt(t,e)},i.removeChild=function(t){return t.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild(t)},i.removeChildAt=function(t){return this.getChildAt(t).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt(t)},i.removeChildren=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=2147483647),this._content.removeChildren(t,e),this._setScrollChanged(),this},i.getChildAt=function(t){return this._content.getChildAt(t)},i.getChildByName=function(t){return this._content.getChildByName(t)},i.getChildIndex=function(t){return this._content.getChildIndex(t)},i.changeScroll=function(){this._scrollChanged=!1;var t=this.contentWidth||1,e=this.contentHeight||1,i=this._vScrollBar,n=this._hScrollBar,r=i&&e>this._height,s=n&&t>this._width,a=r?this._width-i.width:this._width,o=s?this._height-n.height:this._height;i&&(i.x=this._width-i.width,i.y=0,i.height=this._height-(s?n.height:0),i.scrollSize=Math.max(.033*this._height,1),i.thumbPercent=o/e,i.setScroll(0,e-o,i.value)),n&&(n.x=0,n.y=this._height-n.height,n.width=this._width-(r?i.width:0),n.scrollSize=Math.max(.033*this._width,1),n.thumbPercent=a/t,n.setScroll(0,t-a,n.value))},i._sizeChanged=function(){laya.ui.UIComponent.prototype._sizeChanged.call(this),this.setContentSize(this._width,this._height)},i.setContentSize=function(t,e){var i=this._content;i.width=t,i.height=e,i._style.scrollRect||(i.scrollRect=ve.create()),i._style.scrollRect.setTo(0,0,t,e),i.scrollRect=i.scrollRect},i.onScrollBarChange=function(t){var e=this._content._style.scrollRect;if(e){var i=Math.round(t.value);t.isVertical?e.y=i:e.x=i,this._content.scrollRect=e}},i.scrollTo=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.vScrollBar&&(this.vScrollBar.value=e),this.hScrollBar&&(this.hScrollBar.value=t)},i.refresh=function(){this.changeScroll()},i.onScrollStart=function(){this._usedCache||(this._usedCache=T.superGet(Qs,this,"cacheAs")),T.superSet(Qs,this,"cacheAs","none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},i.onScrollEnd=function(){T.superSet(Qs,this,"cacheAs",this._usedCache)},i._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},g(0,i,"cacheAs",t.prototype._$get_cacheAs,function(t){T.superSet(Qs,this,"cacheAs",t),this._usedCache=null,"none"!==t?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),g(0,i,"content",function(){return this._content}),g(0,i,"hScrollBar",function(){return this._hScrollBar}),g(0,i,"numChildren",function(){return this._content.numChildren}),g(0,i,"contentHeight",function(){for(var t=0,e=this._content.numChildren-1;-1<e;e--){var i=this._content.getChildAt(e);t=Math.max(i._y+i.height*i.scaleY-i.pivotY,t)}return t}),g(0,i,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(t){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new Ha),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._hScrollBar.elasticDistance=this._elasticEnabled?200:0,this._setScrollChanged()),this._hScrollBar.skin=t}),g(0,i,"elasticEnabled",function(){return this._elasticEnabled},function(t){this._elasticEnabled=t,this._vScrollBar&&(this._vScrollBar.elasticDistance=t?200:0),this._hScrollBar&&(this._hScrollBar.elasticDistance=t?200:0)}),g(0,i,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(t){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new Ga),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._vScrollBar.elasticDistance=this._elasticEnabled?200:0,this._setScrollChanged()),this._vScrollBar.skin=t}),g(0,i,"height",t.prototype._$get_height,function(t){T.superSet(Qs,this,"height",t),this._setScrollChanged()}),g(0,i,"vScrollBar",function(){return this._vScrollBar}),g(0,i,"width",t.prototype._$get_width,function(t){T.superSet(Qs,this,"width",t),this._setScrollChanged()}),g(0,i,"contentWidth",function(){for(var t=0,e=this._content.numChildren-1;-1<e;e--){var i=this._content.getChildAt(e);t=Math.max(i._x+i.width*i.scaleX-i.pivotX,t)}return t}),e}(Qs),Na=function(t){function e(){this._oldW=0,this._oldH=0,e.__super.call(this)}I(e,"laya.ui.ScaleBox",t);var i=e.prototype;return i.onEnable=function(){T.stage.on("resize",this,this.onResize),this.onResize()},i.onDisable=function(){T.stage.off("resize",this,this.onResize)},i.onResize=function(){if(0<this.width&&0<this.height){var t=Math.min(T.stage.width/this._oldW,T.stage.height/this._oldH);T.superSet(Qs,this,"width",T.stage.width),T.superSet(Qs,this,"height",T.stage.height),this.scale(t,t)}},g(0,i,"height",t.prototype._$get_height,function(t){T.superSet(Qs,this,"height",t),this._oldH=t}),g(0,i,"width",t.prototype._$get_width,function(t){T.superSet(Qs,this,"width",t),this._oldW=t}),e}(Qs),Pa=function(e){function i(t,e){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,this._align="left",this._wordsW=0,this._wordsH=0,i.__super.call(this),t&&(this.skin=t),e&&(this.sheet=e)}I(i,"laya.ui.FontClip",e);var t=i.prototype;return t.createChildren=function(){this._bitmap=new ur,this.on("loaded",this,this._onClipLoaded)},t._onClipLoaded=function(){this.callLater(this.changeValue)},t.changeValue=function(){var t;if(this._sources&&(this._valueArr&&(this.graphics.clear(!0),t=this._sources[0]))){var e="horizontal"===this._direction;this._wordsH=e?(this._wordsW=this._valueArr.length*(t.sourceWidth+this.spaceX),t.sourceHeight):(this._wordsW=t.sourceWidth,(t.sourceHeight+this.spaceY)*this._valueArr.length);var i=0;if(this._width)switch(this._align){case"center":i=.5*(this._width-this._wordsW);break;case"right":i=this._width-this._wordsW;break;default:i=0}for(var n=0,r=this._valueArr.length;n<r;n++){var s=this._indexMap[this._valueArr.charAt(n)];this.sources[s]&&(t=this.sources[s],e?this.graphics.drawImage(t,i+n*(t.sourceWidth+this.spaceX),0,t.sourceWidth,t.sourceHeight):this.graphics.drawImage(t,0+i,n*(t.sourceHeight+this.spaceY),t.sourceWidth,t.sourceHeight))}this._width||(this._widget.resetLayoutX(),this.callLater(this._sizeChanged)),this._height||(this._widget.resetLayoutY(),this.callLater(this._sizeChanged))}},t.measureWidth=function(){return this._wordsW},t.measureHeight=function(){return this._wordsH},t.destroy=function(t){void 0===t&&(t=!0),this._valueArr=null,this._indexMap=null,this.graphics.clear(!0),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),e.prototype.destroy.call(this,t)},g(0,t,"width",e.prototype._$get_width,function(t){T.superSet(oa,this,"width",t),this.callLater(this.changeValue)}),g(0,t,"align",function(){return this._align},function(t){this._align=t,this.callLater(this.changeValue)}),g(0,t,"height",e.prototype._$get_height,function(t){T.superSet(oa,this,"height",t),this.callLater(this.changeValue)}),g(0,t,"spaceY",function(){return this._spaceY},function(t){this._spaceY=t,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),g(0,t,"value",function(){return this._valueArr?this._valueArr:""},function(t){t+="",this._valueArr=t,this.callLater(this.changeValue)}),g(0,t,"direction",function(){return this._direction},function(t){this._direction=t,this.callLater(this.changeValue)}),g(0,t,"spaceX",function(){return this._spaceX},function(t){this._spaceX=t,"horizontal"===this._direction&&this.callLater(this.changeValue)}),g(0,t,"sheet",function(){return this._sheet},function(t){t+="";var e=(this._sheet=t).split(" ");this._clipX=String(e[0]).length,this.clipY=e.length,this._indexMap={};for(var i=0;i<this._clipY;i++)for(var n=e[i].split(""),r=0,s=n.length;r<s;r++)this._indexMap[n[r]]=i*this._clipX+r}),i}(oa),Fa=function(e){function i(t,e){this._value=null,void 0===e&&(e=""),i.__super.call(this,t,e)}I(i,"laya.ui.Radio",e);var t=i.prototype;return t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._value=null},t.preinitialize=function(){laya.ui.UIComponent.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},t.initialize=function(){e.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},t.onClick=function(t){this.selected=!0},g(0,t,"value",function(){return null!=this._value?this._value:this.label},function(t){this._value=t}),i}(ta),Ba=function(t){function e(){this._items=null,this._selectedIndex=0,e.__super.call(this),this._setIndexHandler=y.create(this,this.setIndex,null,!1)}I(e,"laya.ui.ViewStack",t);var i=e.prototype;return T.imps(i,{"laya.ui.IItem":!0}),i.setItems=function(t){this.removeChildren();for(var e=0,i=0,n=t.length;i<n;i++){var r=t[i];r&&(r.name="item"+e,this.addChild(r),e++)}this.initItems()},i.addItem=function(t){t.name="item"+this._items.length,this.addChild(t),this.initItems()},i._afterInited=function(){this.initItems()},i.initItems=function(){this._items=[];for(var t=0;t<1e4;t++){var e=this.getChildByName("item"+t);if(null==e)break;this._items.push(e),e.visible=t==this._selectedIndex}},i.setSelect=function(t,e){this._items&&-1<t&&t<this._items.length&&(this._items[t].visible=e)},i.setIndex=function(t){this.selectedIndex=t},g(0,i,"dataSource",t.prototype._$get_dataSource,function(t){if("number"==typeof(this._dataSource=t)&&Math.floor(t)==t||"string"==typeof t)this.selectedIndex=parseInt(t);else for(var e in this._dataSource)this.hasOwnProperty(e)&&(this[e]=this._dataSource[e])}),g(0,i,"items",function(){return this._items}),g(0,i,"setIndexHandler",function(){return this._setIndexHandler},function(t){this._setIndexHandler=t}),g(0,i,"selection",function(){return-1<this._selectedIndex&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(t){this.selectedIndex=this._items.indexOf(t)}),g(0,i,"selectedIndex",function(){return this._selectedIndex},function(t){this._selectedIndex!=t&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=t,this.setSelect(this._selectedIndex,!0))}),e}(Qs),Va=function(t){function e(){e.__super.call(this)}return I(e,"laya.ui.VSlider",ia),e}(),Ua=function(t){function e(t){e.__super.call(this,t),this.isVertical=!1}return I(e,"laya.ui.HSlider",ia),e}(),za=function(e){var A;function M(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,M.__super.call(this)}I(M,"laya.utils.GraphicAnimation",e);var t=M.prototype;return t._parseNodeList=function(t){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[t.compId]=t.props,t.compId&&this._nodeList.push(t.compId);var e=t.child;if(e){var i=0,n=e.length;for(i=0;i<n;i++)this._parseNodeList(e[i])}},t._calGraphicData=function(t){var e;if(this._setUp(null,t),this._createGraphicData(),this._nodeIDAniDic)for(e in this._nodeIDAniDic)this._nodeIDAniDic[e]=null},t._createGraphicData=function(){var t,e=[],i=0,n=this.count,r=this._usedFrames;for(r||(r=[]),i=0;i<n;i++)!r[i]&&t||(t=this._createFrameGraphic(i)),e.push(t);this._gList=e},t._createFrameGraphic=function(t){var e=new $;return M._rootMatrix||(M._rootMatrix=new It),this._updateNodeGraphic(this._rootNode,t,M._rootMatrix,e),e},t._updateNodeGraphic=function(t,e,i,n,r){var s,a,o;void 0===r&&(r=1),(s=this._nodeGDic[t.compId]=this._getNodeGraphicData(t.compId,e,this._nodeGDic[t.compId])).resultTransform||(s.resultTransform=new It),a=s.resultTransform,It.mul(s.transform,i,a);var h=s.alpha*r;if(!(h<.01)){s.skin&&(o=this._getTextureByUrl(s.skin))&&(a._checkTransform()?(n.drawTexture(o,0,0,s.width,s.height,a,h),s.resultTransform=null):n.drawTexture(o,a.tx,a.ty,s.width,s.height,null,h));var l=t.child;if(l){var u,c=0;for(u=l.length,c=0;c<u;c++)this._updateNodeGraphic(l[c],e,a,n,h)}}},t._updateNoChilds=function(t,e){if(t.skin){var i=this._getTextureByUrl(t.skin);if(i){var n=t.transform;n._checkTransform();!n._bTransform?e.drawTexture(i,n.tx,n.ty,t.width,t.height,null,t.alpha):e.drawTexture(i,0,0,t.width,t.height,n.clone(),t.alpha)}}},t._updateNodeGraphic2=function(t,e,i){var n;if(n=this._nodeGDic[t.compId]=this._getNodeGraphicData(t.compId,e,this._nodeGDic[t.compId]),t.child){var r=n.transform;r._checkTransform();var s,a;a=(s=!r._bTransform)&&(0!=r.tx||0!=r.ty);var o;(o=r._bTransform||1!=n.alpha)&&i.save(),1!=n.alpha&&i.alpha(n.alpha),s?a&&i.translate(r.tx,r.ty):i.transform(r.clone());var h,l=t.child;if(n.skin&&(h=this._getTextureByUrl(n.skin))&&i.drawImage(h,0,0,n.width,n.height),l){var u,c=0;for(u=l.length,c=0;c<u;c++)this._updateNodeGraphic2(l[c],e,i)}o?i.restore():s?a&&i.translate(-r.tx,-r.ty):i.transform(r.clone().invert())}else this._updateNoChilds(n,i)},t._calculateKeyFrames=function(t){e.prototype._calculateKeyFrames.call(this,t),this._nodeIDAniDic[t.target]=t},t.getNodeDataByID=function(t){return this._nodeIDAniDic[t]},t._getParams=function(t,e,i,n){var r=M._temParam;r.length=e.length;var s=0,a=e.length;for(s=0;s<a;s++)r[s]=this._getObjVar(t,e[s][0],i,e[s][1],n);return r},t._getObjVar=function(t,e,i,n,r){if(t.hasOwnProperty(e)){var s=t[e];return i>=s.length&&(i=s.length-1),t[e][i]}return r.hasOwnProperty(e)?r[e]:n},t._getNodeGraphicData=function(t,e,i){i||(i=new A),i.transform?i.transform.identity():i.transform=new It;var n=this.getNodeDataByID(t);if(!n)return i;var r,s=n.frames,a=this._getParams(s,M._drawTextureCmd,e,this._nodeDefaultProps[t]),o=a[0],h=NaN,l=NaN,u=a[5],c=a[6],_=a[13],d=a[14],f=a[7],p=a[8],m=a[9],g=a[11],v=a[12];h=a[3],l=a[4],0!=h&&0!=l||(o=null),-1==h&&(h=0),-1==l&&(l=0),i.skin=o,i.width=h,i.height=l,o&&((r=this._getTextureByUrl(o))?(h||(h=r.sourceWidth),l||(l=r.sourceHeight)):console.warn("lost skin:",o,",you may load pics first")),i.alpha=a[10];var T=i.transform;0!=_&&(u=_*h),0!=d&&(c=d*l),0==u&&0==c||T.translate(-u,-c);var y=null;if(m||1!==f||1!==p||g||v){(y=M._tempMt).identity(),y._bTransform=!0;var E=.0174532922222222*(m-g),x=.0174532922222222*(m+v),S=Math.cos(x),C=Math.sin(x),I=Math.sin(E),R=Math.cos(E);y.a=f*S,y.b=f*C,y.c=-p*I,y.d=p*R,y.tx=y.ty=0}return y&&(T=It.mul(T,y,T)),T.translate(a[1],a[2]),i},t._getTextureByUrl=function(t){return Hn.getRes(t)},t.setAniData=function(t,e){if(t.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=t,this._parseNodeList(t);var i,n={},r=[],s=t.animations,a=0,o=s.length;for(a=0;a<o;a++)if(i=s[a],this._labels=null,(!e||e==i.name)&&i){try{this._calGraphicData(i)}catch(t){console.warn("parse animation fail:"+i.name+",empty animation created"),this._gList=[]}var h={};h.interval=1e3/i.frameRate,h.frames=this._gList,h.labels=this._labels,h.name=i.name,r.push(h),n[i.name]=h}this.animationList=r,this.animationDic=n}M._temParam.length=0},t.parseByData=function(t){var e,i;e=t.nodeRoot,i=t.aniO,delete t.nodeRoot,delete t.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=e,this._parseNodeList(e),this._labels=null;try{this._calGraphicData(i)}catch(t){console.warn("parse animation fail:"+i.name+",empty animation created"),this._gList=[]}var n=t;return n.interval=1e3/i.frameRate,n.frames=this._gList,n.labels=this._labels,n.name=i.name,n},t.setUpAniData=function(t){if(t.animations){var e,i={},n=[],r=t.animations,s=0,a=r.length;for(s=0;s<a;s++)if(e=r[s]){var o={};o.name=e.name,o.aniO=e,o.nodeRoot=t,n.push(o),i[e.name]=o}this.animationList=n,this.animationDic=i}},t._clear=function(){this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic=null},M.parseAnimationByData=function(t){var e;return M._I||(M._I=new M),e=M._I.parseByData(t),M._I._clear(),e},M.parseAnimationData=function(t){var e;return M._I||(M._I=new M),M._I.setUpAniData(t),(e={}).animationList=M._I.animationList,e.animationDic=M._I.animationDic,M._I._clear(),e},M._temParam=[],M._I=null,M._rootMatrix=null,E(M,["_drawTextureCmd",function(){return this._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]]},"_tempMt",function(){return this._tempMt=new It}]),M.__init$=function(){A=function(){function t(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return I(t,""),t}()},M}(va),Ga=function(t){function e(){e.__super.call(this)}return I(e,"laya.ui.VScrollBar",ua),e}(),Ha=function(t){function e(){e.__super.call(this)}return I(e,"laya.ui.HScrollBar",t),e.prototype.initialize=function(){t.prototype.initialize.call(this),this.slider.isVertical=!1},e}(ua),ka=function(t){function e(){e.__super.call(this)}return I(e,"laya.ui.Tab",Ra),e.prototype.createItem=function(t,e){return new ta(t,e)},e}(),Wa=function(t){function e(){e.__super.call(this)}I(e,"laya.ui.VBox",t);var i=e.prototype;return i.changeItems=function(){this._itemChanged=!1;for(var t=[],e=0,i=0,n=this.numChildren;i<n;i++){var r=this.getChildAt(i);r&&(t.push(r),e=this._width?this._width:Math.max(e,r.width*r.scaleX))}this.sortItem(t);var s=0;for(i=0,n=t.length;i<n;i++)(r=t[i]).y=s,s+=r.height*r.scaleY+this._space,"left"==this._align?r.x=0:"center"==this._align?r.x=.5*(e-r.width*r.scaleX):"right"==this._align&&(r.x=e-r.width*r.scaleX);this._sizeChanged()},g(0,i,"width",t.prototype._$get_width,function(t){this._width!=t&&(T.superSet(wa,this,"width",t),this.callLater(this.changeItems))}),e.NONE="none",e.LEFT="left",e.CENTER="center",e.RIGHT="right",e}(wa),Xa=function(e){function i(t){this._vScrollBar=null,this._hScrollBar=null,void 0===t&&(t=""),i.__super.call(this,t),this.on("change",this,this._onTextChange)}I(i,"laya.ui.TextArea",e);var t=i.prototype;return t._onTextChange=function(){this.callLater(this.changeScroll)},t.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},t.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},t.onVBarChanged=function(t){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},t.onHBarChanged=function(t){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},t.changeScroll=function(){var t=this._vScrollBar&&0<this._tf.maxScrollY,e=this._hScrollBar&&0<this._tf.maxScrollX,i=t?this._width-this._vScrollBar.width:this._width,n=e?this._height-this._hScrollBar.height:this._height,r=this._tf.padding||de.labelPadding;this._tf.width=i,this._tf.height=n,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-r[2],this._vScrollBar.y=r[1],this._vScrollBar.height=this._height-(e?this._hScrollBar.height:0)-r[1]-r[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=n/Math.max(this._tf.textHeight,n),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=t),this._hScrollBar&&(this._hScrollBar.x=r[0],this._hScrollBar.y=this._height-this._hScrollBar.height-r[3],this._hScrollBar.width=this._width-(t?this._vScrollBar.width:0)-r[0]-r[2],this._hScrollBar.scrollSize=Math.max(.033*i,1),this._hScrollBar.thumbPercent=i/Math.max(this._tf.textWidth,i),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=e)},t.scrollTo=function(t){this.commitMeasure(),this._tf.scrollY=t},g(0,t,"scrollX",function(){return this._tf.scrollX}),g(0,t,"maxScrollX",function(){return this._tf.maxScrollX}),g(0,t,"maxScrollY",function(){return this._tf.maxScrollY}),g(0,t,"scrollY",function(){return this._tf.scrollY}),g(0,t,"width",e.prototype._$get_width,function(t){T.superSet(La,this,"width",t),this.callLater(this.changeScroll)}),g(0,t,"vScrollBar",function(){return this._vScrollBar}),g(0,t,"hScrollBar",function(){return this._hScrollBar}),g(0,t,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(t){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new Ha),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=t}),g(0,t,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(t){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new Ga),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=t}),g(0,t,"height",e.prototype._$get_height,function(t){T.superSet(La,this,"height",t),this.callLater(this.changeScroll)}),i}(La),Ya=function(t){function e(){e.__super.call(this)}return I(e,"laya.ui.RadioGroup",Ra),e.prototype.createItem=function(t,e){return new Fa(t,e)},e}(),Za=function(t){function e(){e.__super.call(this)}I(e,"laya.ui.HBox",t);var i=e.prototype;return i.sortItem=function(t){t&&t.sort(function(t,e){return t.x-e.x})},i.changeItems=function(){this._itemChanged=!1;for(var t=[],e=0,i=0,n=this.numChildren;i<n;i++){var r=this.getChildAt(i);r&&(t.push(r),e=this._height?this._height:Math.max(e,r.height*r.scaleY))}this.sortItem(t);var s=0;for(i=0,n=t.length;i<n;i++)(r=t[i]).x=s,s+=r.width*r.scaleX+this._space,"top"==this._align?r.y=0:"middle"==this._align?r.y=.5*(e-r.height*r.scaleY):"bottom"==this._align&&(r.y=e-r.height*r.scaleY);this._sizeChanged()},g(0,i,"height",t.prototype._$get_height,function(t){this._height!=t&&(T.superSet(wa,this,"height",t),this.callLater(this.changeItems))}),e.NONE="none",e.TOP="top",e.MIDDLE="middle",e.BOTTOM="bottom",e}(wa);T.__init([ji,o,Jn,hn,za,vt,Pi,Ni,Ri,Br,qi,$s,i,Yt,Qi]),new t}(window,document,n)},{}]},{},[1]);